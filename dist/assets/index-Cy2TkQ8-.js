function Yq(u,f){for(var _=0;_<f.length;_++){const y=f[_];if(typeof y!="string"&&!Array.isArray(y)){for(const C in y)if(C!=="default"&&!(C in u)){const A=Object.getOwnPropertyDescriptor(y,C);A&&Object.defineProperty(u,C,A.get?A:{enumerable:!0,get:()=>y[C]})}}}return Object.freeze(Object.defineProperty(u,Symbol.toStringTag,{value:"Module"}))}(function(){const f=document.createElement("link").relList;if(f&&f.supports&&f.supports("modulepreload"))return;for(const C of document.querySelectorAll('link[rel="modulepreload"]'))y(C);new MutationObserver(C=>{for(const A of C)if(A.type==="childList")for(const D of A.addedNodes)D.tagName==="LINK"&&D.rel==="modulepreload"&&y(D)}).observe(document,{childList:!0,subtree:!0});function _(C){const A={};return C.integrity&&(A.integrity=C.integrity),C.referrerPolicy&&(A.referrerPolicy=C.referrerPolicy),C.crossOrigin==="use-credentials"?A.credentials="include":C.crossOrigin==="anonymous"?A.credentials="omit":A.credentials="same-origin",A}function y(C){if(C.ep)return;C.ep=!0;const A=_(C);fetch(C.href,A)}})();var QI=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function KA(u){return u&&u.__esModule&&Object.prototype.hasOwnProperty.call(u,"default")?u.default:u}var ZI={exports:{}},Ig={},$I={exports:{}},Tn={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var wj;function qq(){if(wj)return Tn;wj=1;var u=Symbol.for("react.element"),f=Symbol.for("react.portal"),_=Symbol.for("react.fragment"),y=Symbol.for("react.strict_mode"),C=Symbol.for("react.profiler"),A=Symbol.for("react.provider"),D=Symbol.for("react.context"),L=Symbol.for("react.forward_ref"),V=Symbol.for("react.suspense"),G=Symbol.for("react.memo"),W=Symbol.for("react.lazy"),K=Symbol.iterator;function ee(he){return he===null||typeof he!="object"?null:(he=K&&he[K]||he["@@iterator"],typeof he=="function"?he:null)}var X={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},re=Object.assign,q={};function $(he,Ie,it){this.props=he,this.context=Ie,this.refs=q,this.updater=it||X}$.prototype.isReactComponent={},$.prototype.setState=function(he,Ie){if(typeof he!="object"&&typeof he!="function"&&he!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,he,Ie,"setState")},$.prototype.forceUpdate=function(he){this.updater.enqueueForceUpdate(this,he,"forceUpdate")};function ae(){}ae.prototype=$.prototype;function oe(he,Ie,it){this.props=he,this.context=Ie,this.refs=q,this.updater=it||X}var le=oe.prototype=new ae;le.constructor=oe,re(le,$.prototype),le.isPureReactComponent=!0;var Se=Array.isArray,be=Object.prototype.hasOwnProperty,Ue={current:null},xe={key:!0,ref:!0,__self:!0,__source:!0};function je(he,Ie,it){var rt,Ot={},Ht=null,Ye=null;if(Ie!=null)for(rt in Ie.ref!==void 0&&(Ye=Ie.ref),Ie.key!==void 0&&(Ht=""+Ie.key),Ie)be.call(Ie,rt)&&!xe.hasOwnProperty(rt)&&(Ot[rt]=Ie[rt]);var At=arguments.length-2;if(At===1)Ot.children=it;else if(1<At){for(var Wt=Array(At),Kt=0;Kt<At;Kt++)Wt[Kt]=arguments[Kt+2];Ot.children=Wt}if(he&&he.defaultProps)for(rt in At=he.defaultProps,At)Ot[rt]===void 0&&(Ot[rt]=At[rt]);return{$$typeof:u,type:he,key:Ht,ref:Ye,props:Ot,_owner:Ue.current}}function lt(he,Ie){return{$$typeof:u,type:he.type,key:Ie,ref:he.ref,props:he.props,_owner:he._owner}}function Et(he){return typeof he=="object"&&he!==null&&he.$$typeof===u}function ht(he){var Ie={"=":"=0",":":"=2"};return"$"+he.replace(/[=:]/g,function(it){return Ie[it]})}var Ge=/\/+/g;function pt(he,Ie){return typeof he=="object"&&he!==null&&he.key!=null?ht(""+he.key):Ie.toString(36)}function Fe(he,Ie,it,rt,Ot){var Ht=typeof he;(Ht==="undefined"||Ht==="boolean")&&(he=null);var Ye=!1;if(he===null)Ye=!0;else switch(Ht){case"string":case"number":Ye=!0;break;case"object":switch(he.$$typeof){case u:case f:Ye=!0}}if(Ye)return Ye=he,Ot=Ot(Ye),he=rt===""?"."+pt(Ye,0):rt,Se(Ot)?(it="",he!=null&&(it=he.replace(Ge,"$&/")+"/"),Fe(Ot,Ie,it,"",function(Kt){return Kt})):Ot!=null&&(Et(Ot)&&(Ot=lt(Ot,it+(!Ot.key||Ye&&Ye.key===Ot.key?"":(""+Ot.key).replace(Ge,"$&/")+"/")+he)),Ie.push(Ot)),1;if(Ye=0,rt=rt===""?".":rt+":",Se(he))for(var At=0;At<he.length;At++){Ht=he[At];var Wt=rt+pt(Ht,At);Ye+=Fe(Ht,Ie,it,Wt,Ot)}else if(Wt=ee(he),typeof Wt=="function")for(he=Wt.call(he),At=0;!(Ht=he.next()).done;)Ht=Ht.value,Wt=rt+pt(Ht,At++),Ye+=Fe(Ht,Ie,it,Wt,Ot);else if(Ht==="object")throw Ie=String(he),Error("Objects are not valid as a React child (found: "+(Ie==="[object Object]"?"object with keys {"+Object.keys(he).join(", ")+"}":Ie)+"). If you meant to render a collection of children, use an array instead.");return Ye}function Ct(he,Ie,it){if(he==null)return he;var rt=[],Ot=0;return Fe(he,rt,"","",function(Ht){return Ie.call(it,Ht,Ot++)}),rt}function nt(he){if(he._status===-1){var Ie=he._result;Ie=Ie(),Ie.then(function(it){(he._status===0||he._status===-1)&&(he._status=1,he._result=it)},function(it){(he._status===0||he._status===-1)&&(he._status=2,he._result=it)}),he._status===-1&&(he._status=0,he._result=Ie)}if(he._status===1)return he._result.default;throw he._result}var Je={current:null},Oe={transition:null},ke={ReactCurrentDispatcher:Je,ReactCurrentBatchConfig:Oe,ReactCurrentOwner:Ue};function ze(){throw Error("act(...) is not supported in production builds of React.")}return Tn.Children={map:Ct,forEach:function(he,Ie,it){Ct(he,function(){Ie.apply(this,arguments)},it)},count:function(he){var Ie=0;return Ct(he,function(){Ie++}),Ie},toArray:function(he){return Ct(he,function(Ie){return Ie})||[]},only:function(he){if(!Et(he))throw Error("React.Children.only expected to receive a single React element child.");return he}},Tn.Component=$,Tn.Fragment=_,Tn.Profiler=C,Tn.PureComponent=oe,Tn.StrictMode=y,Tn.Suspense=V,Tn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=ke,Tn.act=ze,Tn.cloneElement=function(he,Ie,it){if(he==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+he+".");var rt=re({},he.props),Ot=he.key,Ht=he.ref,Ye=he._owner;if(Ie!=null){if(Ie.ref!==void 0&&(Ht=Ie.ref,Ye=Ue.current),Ie.key!==void 0&&(Ot=""+Ie.key),he.type&&he.type.defaultProps)var At=he.type.defaultProps;for(Wt in Ie)be.call(Ie,Wt)&&!xe.hasOwnProperty(Wt)&&(rt[Wt]=Ie[Wt]===void 0&&At!==void 0?At[Wt]:Ie[Wt])}var Wt=arguments.length-2;if(Wt===1)rt.children=it;else if(1<Wt){At=Array(Wt);for(var Kt=0;Kt<Wt;Kt++)At[Kt]=arguments[Kt+2];rt.children=At}return{$$typeof:u,type:he.type,key:Ot,ref:Ht,props:rt,_owner:Ye}},Tn.createContext=function(he){return he={$$typeof:D,_currentValue:he,_currentValue2:he,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},he.Provider={$$typeof:A,_context:he},he.Consumer=he},Tn.createElement=je,Tn.createFactory=function(he){var Ie=je.bind(null,he);return Ie.type=he,Ie},Tn.createRef=function(){return{current:null}},Tn.forwardRef=function(he){return{$$typeof:L,render:he}},Tn.isValidElement=Et,Tn.lazy=function(he){return{$$typeof:W,_payload:{_status:-1,_result:he},_init:nt}},Tn.memo=function(he,Ie){return{$$typeof:G,type:he,compare:Ie===void 0?null:Ie}},Tn.startTransition=function(he){var Ie=Oe.transition;Oe.transition={};try{he()}finally{Oe.transition=Ie}},Tn.unstable_act=ze,Tn.useCallback=function(he,Ie){return Je.current.useCallback(he,Ie)},Tn.useContext=function(he){return Je.current.useContext(he)},Tn.useDebugValue=function(){},Tn.useDeferredValue=function(he){return Je.current.useDeferredValue(he)},Tn.useEffect=function(he,Ie){return Je.current.useEffect(he,Ie)},Tn.useId=function(){return Je.current.useId()},Tn.useImperativeHandle=function(he,Ie,it){return Je.current.useImperativeHandle(he,Ie,it)},Tn.useInsertionEffect=function(he,Ie){return Je.current.useInsertionEffect(he,Ie)},Tn.useLayoutEffect=function(he,Ie){return Je.current.useLayoutEffect(he,Ie)},Tn.useMemo=function(he,Ie){return Je.current.useMemo(he,Ie)},Tn.useReducer=function(he,Ie,it){return Je.current.useReducer(he,Ie,it)},Tn.useRef=function(he){return Je.current.useRef(he)},Tn.useState=function(he){return Je.current.useState(he)},Tn.useSyncExternalStore=function(he,Ie,it){return Je.current.useSyncExternalStore(he,Ie,it)},Tn.useTransition=function(){return Je.current.useTransition()},Tn.version="18.3.1",Tn}var bj;function RR(){return bj||(bj=1,$I.exports=qq()),$I.exports}/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ij;function Xq(){if(Ij)return Ig;Ij=1;var u=RR(),f=Symbol.for("react.element"),_=Symbol.for("react.fragment"),y=Object.prototype.hasOwnProperty,C=u.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,A={key:!0,ref:!0,__self:!0,__source:!0};function D(L,V,G){var W,K={},ee=null,X=null;G!==void 0&&(ee=""+G),V.key!==void 0&&(ee=""+V.key),V.ref!==void 0&&(X=V.ref);for(W in V)y.call(V,W)&&!A.hasOwnProperty(W)&&(K[W]=V[W]);if(L&&L.defaultProps)for(W in V=L.defaultProps,V)K[W]===void 0&&(K[W]=V[W]);return{$$typeof:f,type:L,key:ee,ref:X,props:K,_owner:C.current}}return Ig.Fragment=_,Ig.jsx=D,Ig.jsxs=D,Ig}var Aj;function Jq(){return Aj||(Aj=1,ZI.exports=Xq()),ZI.exports}var T=Jq(),QT={},eA={exports:{}},Vs={},tA={exports:{}},nA={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Nj;function Qq(){return Nj||(Nj=1,(function(u){function f(Oe,ke){var ze=Oe.length;Oe.push(ke);e:for(;0<ze;){var he=ze-1>>>1,Ie=Oe[he];if(0<C(Ie,ke))Oe[he]=ke,Oe[ze]=Ie,ze=he;else break e}}function _(Oe){return Oe.length===0?null:Oe[0]}function y(Oe){if(Oe.length===0)return null;var ke=Oe[0],ze=Oe.pop();if(ze!==ke){Oe[0]=ze;e:for(var he=0,Ie=Oe.length,it=Ie>>>1;he<it;){var rt=2*(he+1)-1,Ot=Oe[rt],Ht=rt+1,Ye=Oe[Ht];if(0>C(Ot,ze))Ht<Ie&&0>C(Ye,Ot)?(Oe[he]=Ye,Oe[Ht]=ze,he=Ht):(Oe[he]=Ot,Oe[rt]=ze,he=rt);else if(Ht<Ie&&0>C(Ye,ze))Oe[he]=Ye,Oe[Ht]=ze,he=Ht;else break e}}return ke}function C(Oe,ke){var ze=Oe.sortIndex-ke.sortIndex;return ze!==0?ze:Oe.id-ke.id}if(typeof performance=="object"&&typeof performance.now=="function"){var A=performance;u.unstable_now=function(){return A.now()}}else{var D=Date,L=D.now();u.unstable_now=function(){return D.now()-L}}var V=[],G=[],W=1,K=null,ee=3,X=!1,re=!1,q=!1,$=typeof setTimeout=="function"?setTimeout:null,ae=typeof clearTimeout=="function"?clearTimeout:null,oe=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function le(Oe){for(var ke=_(G);ke!==null;){if(ke.callback===null)y(G);else if(ke.startTime<=Oe)y(G),ke.sortIndex=ke.expirationTime,f(V,ke);else break;ke=_(G)}}function Se(Oe){if(q=!1,le(Oe),!re)if(_(V)!==null)re=!0,nt(be);else{var ke=_(G);ke!==null&&Je(Se,ke.startTime-Oe)}}function be(Oe,ke){re=!1,q&&(q=!1,ae(je),je=-1),X=!0;var ze=ee;try{for(le(ke),K=_(V);K!==null&&(!(K.expirationTime>ke)||Oe&&!ht());){var he=K.callback;if(typeof he=="function"){K.callback=null,ee=K.priorityLevel;var Ie=he(K.expirationTime<=ke);ke=u.unstable_now(),typeof Ie=="function"?K.callback=Ie:K===_(V)&&y(V),le(ke)}else y(V);K=_(V)}if(K!==null)var it=!0;else{var rt=_(G);rt!==null&&Je(Se,rt.startTime-ke),it=!1}return it}finally{K=null,ee=ze,X=!1}}var Ue=!1,xe=null,je=-1,lt=5,Et=-1;function ht(){return!(u.unstable_now()-Et<lt)}function Ge(){if(xe!==null){var Oe=u.unstable_now();Et=Oe;var ke=!0;try{ke=xe(!0,Oe)}finally{ke?pt():(Ue=!1,xe=null)}}else Ue=!1}var pt;if(typeof oe=="function")pt=function(){oe(Ge)};else if(typeof MessageChannel<"u"){var Fe=new MessageChannel,Ct=Fe.port2;Fe.port1.onmessage=Ge,pt=function(){Ct.postMessage(null)}}else pt=function(){$(Ge,0)};function nt(Oe){xe=Oe,Ue||(Ue=!0,pt())}function Je(Oe,ke){je=$(function(){Oe(u.unstable_now())},ke)}u.unstable_IdlePriority=5,u.unstable_ImmediatePriority=1,u.unstable_LowPriority=4,u.unstable_NormalPriority=3,u.unstable_Profiling=null,u.unstable_UserBlockingPriority=2,u.unstable_cancelCallback=function(Oe){Oe.callback=null},u.unstable_continueExecution=function(){re||X||(re=!0,nt(be))},u.unstable_forceFrameRate=function(Oe){0>Oe||125<Oe?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):lt=0<Oe?Math.floor(1e3/Oe):5},u.unstable_getCurrentPriorityLevel=function(){return ee},u.unstable_getFirstCallbackNode=function(){return _(V)},u.unstable_next=function(Oe){switch(ee){case 1:case 2:case 3:var ke=3;break;default:ke=ee}var ze=ee;ee=ke;try{return Oe()}finally{ee=ze}},u.unstable_pauseExecution=function(){},u.unstable_requestPaint=function(){},u.unstable_runWithPriority=function(Oe,ke){switch(Oe){case 1:case 2:case 3:case 4:case 5:break;default:Oe=3}var ze=ee;ee=Oe;try{return ke()}finally{ee=ze}},u.unstable_scheduleCallback=function(Oe,ke,ze){var he=u.unstable_now();switch(typeof ze=="object"&&ze!==null?(ze=ze.delay,ze=typeof ze=="number"&&0<ze?he+ze:he):ze=he,Oe){case 1:var Ie=-1;break;case 2:Ie=250;break;case 5:Ie=1073741823;break;case 4:Ie=1e4;break;default:Ie=5e3}return Ie=ze+Ie,Oe={id:W++,callback:ke,priorityLevel:Oe,startTime:ze,expirationTime:Ie,sortIndex:-1},ze>he?(Oe.sortIndex=ze,f(G,Oe),_(V)===null&&Oe===_(G)&&(q?(ae(je),je=-1):q=!0,Je(Se,ze-he))):(Oe.sortIndex=Ie,f(V,Oe),re||X||(re=!0,nt(be))),Oe},u.unstable_shouldYield=ht,u.unstable_wrapCallback=function(Oe){var ke=ee;return function(){var ze=ee;ee=ke;try{return Oe.apply(this,arguments)}finally{ee=ze}}}})(nA)),nA}var Oj;function Zq(){return Oj||(Oj=1,tA.exports=Qq()),tA.exports}/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Pj;function $q(){if(Pj)return Vs;Pj=1;var u=RR(),f=Zq();function _(a){for(var d="https://reactjs.org/docs/error-decoder.html?invariant="+a,m=1;m<arguments.length;m++)d+="&args[]="+encodeURIComponent(arguments[m]);return"Minified React error #"+a+"; visit "+d+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var y=new Set,C={};function A(a,d){D(a,d),D(a+"Capture",d)}function D(a,d){for(C[a]=d,a=0;a<d.length;a++)y.add(d[a])}var L=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),V=Object.prototype.hasOwnProperty,G=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,W={},K={};function ee(a){return V.call(K,a)?!0:V.call(W,a)?!1:G.test(a)?K[a]=!0:(W[a]=!0,!1)}function X(a,d,m,S){if(m!==null&&m.type===0)return!1;switch(typeof d){case"function":case"symbol":return!0;case"boolean":return S?!1:m!==null?!m.acceptsBooleans:(a=a.toLowerCase().slice(0,5),a!=="data-"&&a!=="aria-");default:return!1}}function re(a,d,m,S){if(d===null||typeof d>"u"||X(a,d,m,S))return!0;if(S)return!1;if(m!==null)switch(m.type){case 3:return!d;case 4:return d===!1;case 5:return isNaN(d);case 6:return isNaN(d)||1>d}return!1}function q(a,d,m,S,b,P,Y){this.acceptsBooleans=d===2||d===3||d===4,this.attributeName=S,this.attributeNamespace=b,this.mustUseProperty=m,this.propertyName=a,this.type=d,this.sanitizeURL=P,this.removeEmptyString=Y}var $={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(a){$[a]=new q(a,0,!1,a,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(a){var d=a[0];$[d]=new q(d,1,!1,a[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(a){$[a]=new q(a,2,!1,a.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(a){$[a]=new q(a,2,!1,a,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(a){$[a]=new q(a,3,!1,a.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(a){$[a]=new q(a,3,!0,a,null,!1,!1)}),["capture","download"].forEach(function(a){$[a]=new q(a,4,!1,a,null,!1,!1)}),["cols","rows","size","span"].forEach(function(a){$[a]=new q(a,6,!1,a,null,!1,!1)}),["rowSpan","start"].forEach(function(a){$[a]=new q(a,5,!1,a.toLowerCase(),null,!1,!1)});var ae=/[\-:]([a-z])/g;function oe(a){return a[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(a){var d=a.replace(ae,oe);$[d]=new q(d,1,!1,a,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(a){var d=a.replace(ae,oe);$[d]=new q(d,1,!1,a,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(a){var d=a.replace(ae,oe);$[d]=new q(d,1,!1,a,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(a){$[a]=new q(a,1,!1,a.toLowerCase(),null,!1,!1)}),$.xlinkHref=new q("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(a){$[a]=new q(a,1,!1,a.toLowerCase(),null,!0,!0)});function le(a,d,m,S){var b=$.hasOwnProperty(d)?$[d]:null;(b!==null?b.type!==0:S||!(2<d.length)||d[0]!=="o"&&d[0]!=="O"||d[1]!=="n"&&d[1]!=="N")&&(re(d,m,b,S)&&(m=null),S||b===null?ee(d)&&(m===null?a.removeAttribute(d):a.setAttribute(d,""+m)):b.mustUseProperty?a[b.propertyName]=m===null?b.type===3?!1:"":m:(d=b.attributeName,S=b.attributeNamespace,m===null?a.removeAttribute(d):(b=b.type,m=b===3||b===4&&m===!0?"":""+m,S?a.setAttributeNS(S,d,m):a.setAttribute(d,m))))}var Se=u.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,be=Symbol.for("react.element"),Ue=Symbol.for("react.portal"),xe=Symbol.for("react.fragment"),je=Symbol.for("react.strict_mode"),lt=Symbol.for("react.profiler"),Et=Symbol.for("react.provider"),ht=Symbol.for("react.context"),Ge=Symbol.for("react.forward_ref"),pt=Symbol.for("react.suspense"),Fe=Symbol.for("react.suspense_list"),Ct=Symbol.for("react.memo"),nt=Symbol.for("react.lazy"),Je=Symbol.for("react.offscreen"),Oe=Symbol.iterator;function ke(a){return a===null||typeof a!="object"?null:(a=Oe&&a[Oe]||a["@@iterator"],typeof a=="function"?a:null)}var ze=Object.assign,he;function Ie(a){if(he===void 0)try{throw Error()}catch(m){var d=m.stack.trim().match(/\n( *(at )?)/);he=d&&d[1]||""}return`
`+he+a}var it=!1;function rt(a,d){if(!a||it)return"";it=!0;var m=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(d)if(d=function(){throw Error()},Object.defineProperty(d.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(d,[])}catch(Ae){var S=Ae}Reflect.construct(a,[],d)}else{try{d.call()}catch(Ae){S=Ae}a.call(d.prototype)}else{try{throw Error()}catch(Ae){S=Ae}a()}}catch(Ae){if(Ae&&S&&typeof Ae.stack=="string"){for(var b=Ae.stack.split(`
`),P=S.stack.split(`
`),Y=b.length-1,ie=P.length-1;1<=Y&&0<=ie&&b[Y]!==P[ie];)ie--;for(;1<=Y&&0<=ie;Y--,ie--)if(b[Y]!==P[ie]){if(Y!==1||ie!==1)do if(Y--,ie--,0>ie||b[Y]!==P[ie]){var ue=`
`+b[Y].replace(" at new "," at ");return a.displayName&&ue.includes("<anonymous>")&&(ue=ue.replace("<anonymous>",a.displayName)),ue}while(1<=Y&&0<=ie);break}}}finally{it=!1,Error.prepareStackTrace=m}return(a=a?a.displayName||a.name:"")?Ie(a):""}function Ot(a){switch(a.tag){case 5:return Ie(a.type);case 16:return Ie("Lazy");case 13:return Ie("Suspense");case 19:return Ie("SuspenseList");case 0:case 2:case 15:return a=rt(a.type,!1),a;case 11:return a=rt(a.type.render,!1),a;case 1:return a=rt(a.type,!0),a;default:return""}}function Ht(a){if(a==null)return null;if(typeof a=="function")return a.displayName||a.name||null;if(typeof a=="string")return a;switch(a){case xe:return"Fragment";case Ue:return"Portal";case lt:return"Profiler";case je:return"StrictMode";case pt:return"Suspense";case Fe:return"SuspenseList"}if(typeof a=="object")switch(a.$$typeof){case ht:return(a.displayName||"Context")+".Consumer";case Et:return(a._context.displayName||"Context")+".Provider";case Ge:var d=a.render;return a=a.displayName,a||(a=d.displayName||d.name||"",a=a!==""?"ForwardRef("+a+")":"ForwardRef"),a;case Ct:return d=a.displayName||null,d!==null?d:Ht(a.type)||"Memo";case nt:d=a._payload,a=a._init;try{return Ht(a(d))}catch{}}return null}function Ye(a){var d=a.type;switch(a.tag){case 24:return"Cache";case 9:return(d.displayName||"Context")+".Consumer";case 10:return(d._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return a=d.render,a=a.displayName||a.name||"",d.displayName||(a!==""?"ForwardRef("+a+")":"ForwardRef");case 7:return"Fragment";case 5:return d;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Ht(d);case 8:return d===je?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof d=="function")return d.displayName||d.name||null;if(typeof d=="string")return d}return null}function At(a){switch(typeof a){case"boolean":case"number":case"string":case"undefined":return a;case"object":return a;default:return""}}function Wt(a){var d=a.type;return(a=a.nodeName)&&a.toLowerCase()==="input"&&(d==="checkbox"||d==="radio")}function Kt(a){var d=Wt(a)?"checked":"value",m=Object.getOwnPropertyDescriptor(a.constructor.prototype,d),S=""+a[d];if(!a.hasOwnProperty(d)&&typeof m<"u"&&typeof m.get=="function"&&typeof m.set=="function"){var b=m.get,P=m.set;return Object.defineProperty(a,d,{configurable:!0,get:function(){return b.call(this)},set:function(Y){S=""+Y,P.call(this,Y)}}),Object.defineProperty(a,d,{enumerable:m.enumerable}),{getValue:function(){return S},setValue:function(Y){S=""+Y},stopTracking:function(){a._valueTracker=null,delete a[d]}}}}function Rn(a){a._valueTracker||(a._valueTracker=Kt(a))}function Yn(a){if(!a)return!1;var d=a._valueTracker;if(!d)return!0;var m=d.getValue(),S="";return a&&(S=Wt(a)?a.checked?"true":"false":a.value),a=S,a!==m?(d.setValue(a),!0):!1}function er(a){if(a=a||(typeof document<"u"?document:void 0),typeof a>"u")return null;try{return a.activeElement||a.body}catch{return a.body}}function is(a,d){var m=d.checked;return ze({},d,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:m??a._wrapperState.initialChecked})}function Fa(a,d){var m=d.defaultValue==null?"":d.defaultValue,S=d.checked!=null?d.checked:d.defaultChecked;m=At(d.value!=null?d.value:m),a._wrapperState={initialChecked:S,initialValue:m,controlled:d.type==="checkbox"||d.type==="radio"?d.checked!=null:d.value!=null}}function Ei(a,d){d=d.checked,d!=null&&le(a,"checked",d,!1)}function Zo(a,d){Ei(a,d);var m=At(d.value),S=d.type;if(m!=null)S==="number"?(m===0&&a.value===""||a.value!=m)&&(a.value=""+m):a.value!==""+m&&(a.value=""+m);else if(S==="submit"||S==="reset"){a.removeAttribute("value");return}d.hasOwnProperty("value")?ai(a,d.type,m):d.hasOwnProperty("defaultValue")&&ai(a,d.type,At(d.defaultValue)),d.checked==null&&d.defaultChecked!=null&&(a.defaultChecked=!!d.defaultChecked)}function Sr(a,d,m){if(d.hasOwnProperty("value")||d.hasOwnProperty("defaultValue")){var S=d.type;if(!(S!=="submit"&&S!=="reset"||d.value!==void 0&&d.value!==null))return;d=""+a._wrapperState.initialValue,m||d===a.value||(a.value=d),a.defaultValue=d}m=a.name,m!==""&&(a.name=""),a.defaultChecked=!!a._wrapperState.initialChecked,m!==""&&(a.name=m)}function ai(a,d,m){(d!=="number"||er(a.ownerDocument)!==a)&&(m==null?a.defaultValue=""+a._wrapperState.initialValue:a.defaultValue!==""+m&&(a.defaultValue=""+m))}var Eo=Array.isArray;function Wi(a,d,m,S){if(a=a.options,d){d={};for(var b=0;b<m.length;b++)d["$"+m[b]]=!0;for(m=0;m<a.length;m++)b=d.hasOwnProperty("$"+a[m].value),a[m].selected!==b&&(a[m].selected=b),b&&S&&(a[m].defaultSelected=!0)}else{for(m=""+At(m),d=null,b=0;b<a.length;b++){if(a[b].value===m){a[b].selected=!0,S&&(a[b].defaultSelected=!0);return}d!==null||a[b].disabled||(d=a[b])}d!==null&&(d.selected=!0)}}function Dl(a,d){if(d.dangerouslySetInnerHTML!=null)throw Error(_(91));return ze({},d,{value:void 0,defaultValue:void 0,children:""+a._wrapperState.initialValue})}function Fs(a,d){var m=d.value;if(m==null){if(m=d.children,d=d.defaultValue,m!=null){if(d!=null)throw Error(_(92));if(Eo(m)){if(1<m.length)throw Error(_(93));m=m[0]}d=m}d==null&&(d=""),m=d}a._wrapperState={initialValue:At(m)}}function Mr(a,d){var m=At(d.value),S=At(d.defaultValue);m!=null&&(m=""+m,m!==a.value&&(a.value=m),d.defaultValue==null&&a.defaultValue!==m&&(a.defaultValue=m)),S!=null&&(a.defaultValue=""+S)}function iu(a){var d=a.textContent;d===a._wrapperState.initialValue&&d!==""&&d!==null&&(a.value=d)}function gi(a){switch(a){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function ei(a,d){return a==null||a==="http://www.w3.org/1999/xhtml"?gi(d):a==="http://www.w3.org/2000/svg"&&d==="foreignObject"?"http://www.w3.org/1999/xhtml":a}var Wc,kl=(function(a){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(d,m,S,b){MSApp.execUnsafeLocalFunction(function(){return a(d,m,S,b)})}:a})(function(a,d){if(a.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in a)a.innerHTML=d;else{for(Wc=Wc||document.createElement("div"),Wc.innerHTML="<svg>"+d.valueOf().toString()+"</svg>",d=Wc.firstChild;a.firstChild;)a.removeChild(a.firstChild);for(;d.firstChild;)a.appendChild(d.firstChild)}});function Bs(a,d){if(d){var m=a.firstChild;if(m&&m===a.lastChild&&m.nodeType===3){m.nodeValue=d;return}}a.textContent=d}var Ba={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},su=["Webkit","ms","Moz","O"];Object.keys(Ba).forEach(function(a){su.forEach(function(d){d=d+a.charAt(0).toUpperCase()+a.substring(1),Ba[d]=Ba[a]})});function Gc(a,d,m){return d==null||typeof d=="boolean"||d===""?"":m||typeof d!="number"||d===0||Ba.hasOwnProperty(a)&&Ba[a]?(""+d).trim():d+"px"}function Oi(a,d){a=a.style;for(var m in d)if(d.hasOwnProperty(m)){var S=m.indexOf("--")===0,b=Gc(m,d[m],S);m==="float"&&(m="cssFloat"),S?a.setProperty(m,b):a[m]=b}}var ou=ze({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function go(a,d){if(d){if(ou[a]&&(d.children!=null||d.dangerouslySetInnerHTML!=null))throw Error(_(137,a));if(d.dangerouslySetInnerHTML!=null){if(d.children!=null)throw Error(_(60));if(typeof d.dangerouslySetInnerHTML!="object"||!("__html"in d.dangerouslySetInnerHTML))throw Error(_(61))}if(d.style!=null&&typeof d.style!="object")throw Error(_(62))}}function au(a,d){if(a.indexOf("-")===-1)return typeof d.is=="string";switch(a){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var vo=null;function Hc(a){return a=a.target||a.srcElement||window,a.correspondingUseElement&&(a=a.correspondingUseElement),a.nodeType===3?a.parentNode:a}var Ll=null,Wa=null,yo=null;function Ws(a){if(a=Nu(a)){if(typeof Ll!="function")throw Error(_(280));var d=a.stateNode;d&&(d=hp(d),Ll(a.stateNode,a.type,d))}}function Ga(a){Wa?yo?yo.push(a):yo=[a]:Wa=a}function Yt(){if(Wa){var a=Wa,d=yo;if(yo=Wa=null,Ws(a),d)for(a=0;a<d.length;a++)Ws(d[a])}}function gn(a,d){return a(d)}function qn(){}var Pi=!1;function Gi(a,d,m){if(Pi)return a(d,m);Pi=!0;try{return gn(a,d,m)}finally{Pi=!1,(Wa!==null||yo!==null)&&(qn(),Yt())}}function Xn(a,d){var m=a.stateNode;if(m===null)return null;var S=hp(m);if(S===null)return null;m=S[d];e:switch(d){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(S=!S.disabled)||(a=a.type,S=!(a==="button"||a==="input"||a==="select"||a==="textarea")),a=!S;break e;default:a=!1}if(a)return null;if(m&&typeof m!="function")throw Error(_(231,d,typeof m));return m}var Gs=!1;if(L)try{var ci={};Object.defineProperty(ci,"passive",{get:function(){Gs=!0}}),window.addEventListener("test",ci,ci),window.removeEventListener("test",ci,ci)}catch{Gs=!1}function ss(a,d,m,S,b,P,Y,ie,ue){var Ae=Array.prototype.slice.call(arguments,3);try{d.apply(m,Ae)}catch(Ke){this.onError(Ke)}}var xl=!1,cu=null,lu=!1,wm=null,Yg={onError:function(a){xl=!0,cu=a}};function qg(a,d,m,S,b,P,Y,ie,ue){xl=!1,cu=null,ss.apply(Yg,arguments)}function YR(a,d,m,S,b,P,Y,ie,ue){if(qg.apply(this,arguments),xl){if(xl){var Ae=cu;xl=!1,cu=null}else throw Error(_(198));lu||(lu=!0,wm=Ae)}}function Kc(a){var d=a,m=a;if(a.alternate)for(;d.return;)d=d.return;else{a=d;do d=a,(d.flags&4098)!==0&&(m=d.return),a=d.return;while(a)}return d.tag===3?m:null}function Xg(a){if(a.tag===13){var d=a.memoizedState;if(d===null&&(a=a.alternate,a!==null&&(d=a.memoizedState)),d!==null)return d.dehydrated}return null}function bm(a){if(Kc(a)!==a)throw Error(_(188))}function Jg(a){var d=a.alternate;if(!d){if(d=Kc(a),d===null)throw Error(_(188));return d!==a?null:a}for(var m=a,S=d;;){var b=m.return;if(b===null)break;var P=b.alternate;if(P===null){if(S=b.return,S!==null){m=S;continue}break}if(b.child===P.child){for(P=b.child;P;){if(P===m)return bm(b),a;if(P===S)return bm(b),d;P=P.sibling}throw Error(_(188))}if(m.return!==S.return)m=b,S=P;else{for(var Y=!1,ie=b.child;ie;){if(ie===m){Y=!0,m=b,S=P;break}if(ie===S){Y=!0,S=b,m=P;break}ie=ie.sibling}if(!Y){for(ie=P.child;ie;){if(ie===m){Y=!0,m=P,S=b;break}if(ie===S){Y=!0,S=P,m=b;break}ie=ie.sibling}if(!Y)throw Error(_(189))}}if(m.alternate!==S)throw Error(_(190))}if(m.tag!==3)throw Error(_(188));return m.stateNode.current===m?a:d}function zh(a){return a=Jg(a),a!==null?Im(a):null}function Im(a){if(a.tag===5||a.tag===6)return a;for(a=a.child;a!==null;){var d=Im(a);if(d!==null)return d;a=a.sibling}return null}var zc=f.unstable_scheduleCallback,Qg=f.unstable_cancelCallback,qR=f.unstable_shouldYield,So=f.unstable_requestPaint,Ir=f.unstable_now,XR=f.unstable_getCurrentPriorityLevel,Tr=f.unstable_ImmediatePriority,Zg=f.unstable_UserBlockingPriority,Yh=f.unstable_NormalPriority,JR=f.unstable_LowPriority,$g=f.unstable_IdlePriority,Ml=null,To=null;function ev(a){if(To&&typeof To.onCommitFiberRoot=="function")try{To.onCommitFiberRoot(Ml,a,void 0,(a.current.flags&128)===128)}catch{}}var Hs=Math.clz32?Math.clz32:Ul,QR=Math.log,ZR=Math.LN2;function Ul(a){return a>>>=0,a===0?32:31-(QR(a)/ZR|0)|0}var Vl=64,qh=4194304;function kn(a){switch(a&-a){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return a&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return a&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return a}}function Xh(a,d){var m=a.pendingLanes;if(m===0)return 0;var S=0,b=a.suspendedLanes,P=a.pingedLanes,Y=m&268435455;if(Y!==0){var ie=Y&~b;ie!==0?S=kn(ie):(P&=Y,P!==0&&(S=kn(P)))}else Y=m&~b,Y!==0?S=kn(Y):P!==0&&(S=kn(P));if(S===0)return 0;if(d!==0&&d!==S&&(d&b)===0&&(b=S&-S,P=d&-d,b>=P||b===16&&(P&4194240)!==0))return d;if((S&4)!==0&&(S|=m&16),d=a.entangledLanes,d!==0)for(a=a.entanglements,d&=S;0<d;)m=31-Hs(d),b=1<<m,S|=a[m],d&=~b;return S}function tv(a,d){switch(a){case 1:case 2:case 4:return d+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return d+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function nv(a,d){for(var m=a.suspendedLanes,S=a.pingedLanes,b=a.expirationTimes,P=a.pendingLanes;0<P;){var Y=31-Hs(P),ie=1<<Y,ue=b[Y];ue===-1?((ie&m)===0||(ie&S)!==0)&&(b[Y]=tv(ie,d)):ue<=d&&(a.expiredLanes|=ie),P&=~ie}}function Am(a){return a=a.pendingLanes&-1073741825,a!==0?a:a&1073741824?1073741824:0}function rv(){var a=Vl;return Vl<<=1,(Vl&4194240)===0&&(Vl=64),a}function Nm(a){for(var d=[],m=0;31>m;m++)d.push(a);return d}function du(a,d,m){a.pendingLanes|=d,d!==536870912&&(a.suspendedLanes=0,a.pingedLanes=0),a=a.eventTimes,d=31-Hs(d),a[d]=m}function $R(a,d){var m=a.pendingLanes&~d;a.pendingLanes=d,a.suspendedLanes=0,a.pingedLanes=0,a.expiredLanes&=d,a.mutableReadLanes&=d,a.entangledLanes&=d,d=a.entanglements;var S=a.eventTimes;for(a=a.expirationTimes;0<m;){var b=31-Hs(m),P=1<<b;d[b]=0,S[b]=-1,a[b]=-1,m&=~P}}function Om(a,d){var m=a.entangledLanes|=d;for(a=a.entanglements;m;){var S=31-Hs(m),b=1<<S;b&d|a[S]&d&&(a[S]|=d),m&=~b}}var Ln=0;function Pm(a){return a&=-a,1<a?4<a?(a&268435455)!==0?16:536870912:4:1}var Jh,Dm,Qh,iv,km,Lm=!1,Zh=[],Ha=null,Ka=null,za=null,uu=new Map,hu=new Map,Ya=[],sv="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function ov(a,d){switch(a){case"focusin":case"focusout":Ha=null;break;case"dragenter":case"dragleave":Ka=null;break;case"mouseover":case"mouseout":za=null;break;case"pointerover":case"pointerout":uu.delete(d.pointerId);break;case"gotpointercapture":case"lostpointercapture":hu.delete(d.pointerId)}}function pu(a,d,m,S,b,P){return a===null||a.nativeEvent!==P?(a={blockedOn:d,domEventName:m,eventSystemFlags:S,nativeEvent:P,targetContainers:[b]},d!==null&&(d=Nu(d),d!==null&&Dm(d)),a):(a.eventSystemFlags|=S,d=a.targetContainers,b!==null&&d.indexOf(b)===-1&&d.push(b),a)}function eC(a,d,m,S,b){switch(d){case"focusin":return Ha=pu(Ha,a,d,m,S,b),!0;case"dragenter":return Ka=pu(Ka,a,d,m,S,b),!0;case"mouseover":return za=pu(za,a,d,m,S,b),!0;case"pointerover":var P=b.pointerId;return uu.set(P,pu(uu.get(P)||null,a,d,m,S,b)),!0;case"gotpointercapture":return P=b.pointerId,hu.set(P,pu(hu.get(P)||null,a,d,m,S,b)),!0}return!1}function jl(a){var d=Xc(a.target);if(d!==null){var m=Kc(d);if(m!==null){if(d=m.tag,d===13){if(d=Xg(m),d!==null){a.blockedOn=d,km(a.priority,function(){Qh(m)});return}}else if(d===3&&m.stateNode.current.memoizedState.isDehydrated){a.blockedOn=m.tag===3?m.stateNode.containerInfo:null;return}}}a.blockedOn=null}function $h(a){if(a.blockedOn!==null)return!1;for(var d=a.targetContainers;0<d.length;){var m=xm(a.domEventName,a.eventSystemFlags,d[0],a.nativeEvent);if(m===null){m=a.nativeEvent;var S=new m.constructor(m.type,m);vo=S,m.target.dispatchEvent(S),vo=null}else return d=Nu(m),d!==null&&Dm(d),a.blockedOn=m,!1;d.shift()}return!0}function av(a,d,m){$h(a)&&m.delete(d)}function tC(){Lm=!1,Ha!==null&&$h(Ha)&&(Ha=null),Ka!==null&&$h(Ka)&&(Ka=null),za!==null&&$h(za)&&(za=null),uu.forEach(av),hu.forEach(av)}function fu(a,d){a.blockedOn===d&&(a.blockedOn=null,Lm||(Lm=!0,f.unstable_scheduleCallback(f.unstable_NormalPriority,tC)))}function Fl(a){function d(b){return fu(b,a)}if(0<Zh.length){fu(Zh[0],a);for(var m=1;m<Zh.length;m++){var S=Zh[m];S.blockedOn===a&&(S.blockedOn=null)}}for(Ha!==null&&fu(Ha,a),Ka!==null&&fu(Ka,a),za!==null&&fu(za,a),uu.forEach(d),hu.forEach(d),m=0;m<Ya.length;m++)S=Ya[m],S.blockedOn===a&&(S.blockedOn=null);for(;0<Ya.length&&(m=Ya[0],m.blockedOn===null);)jl(m),m.blockedOn===null&&Ya.shift()}var Bl=Se.ReactCurrentBatchConfig,ep=!0;function nC(a,d,m,S){var b=Ln,P=Bl.transition;Bl.transition=null;try{Ln=1,Hi(a,d,m,S)}finally{Ln=b,Bl.transition=P}}function qa(a,d,m,S){var b=Ln,P=Bl.transition;Bl.transition=null;try{Ln=4,Hi(a,d,m,S)}finally{Ln=b,Bl.transition=P}}function Hi(a,d,m,S){if(ep){var b=xm(a,d,m,S);if(b===null)t_(a,d,S,mu,m),ov(a,S);else if(eC(b,a,d,m,S))S.stopPropagation();else if(ov(a,S),d&4&&-1<sv.indexOf(a)){for(;b!==null;){var P=Nu(b);if(P!==null&&Jh(P),P=xm(a,d,m,S),P===null&&t_(a,d,S,mu,m),P===b)break;b=P}b!==null&&S.stopPropagation()}else t_(a,d,S,null,m)}}var mu=null;function xm(a,d,m,S){if(mu=null,a=Hc(S),a=Xc(a),a!==null)if(d=Kc(a),d===null)a=null;else if(m=d.tag,m===13){if(a=Xg(d),a!==null)return a;a=null}else if(m===3){if(d.stateNode.current.memoizedState.isDehydrated)return d.tag===3?d.stateNode.containerInfo:null;a=null}else d!==a&&(a=null);return mu=a,null}function cv(a){switch(a){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(XR()){case Tr:return 1;case Zg:return 4;case Yh:case JR:return 16;case $g:return 536870912;default:return 16}default:return 16}}var Xa=null,li=null,tp=null;function lv(){if(tp)return tp;var a,d=li,m=d.length,S,b="value"in Xa?Xa.value:Xa.textContent,P=b.length;for(a=0;a<m&&d[a]===b[a];a++);var Y=m-a;for(S=1;S<=Y&&d[m-S]===b[P-S];S++);return tp=b.slice(a,1<S?1-S:void 0)}function np(a){var d=a.keyCode;return"charCode"in a?(a=a.charCode,a===0&&d===13&&(a=13)):a=d,a===10&&(a=13),32<=a||a===13?a:0}function Yc(){return!0}function Mm(){return!1}function os(a){function d(m,S,b,P,Y){this._reactName=m,this._targetInst=b,this.type=S,this.nativeEvent=P,this.target=Y,this.currentTarget=null;for(var ie in a)a.hasOwnProperty(ie)&&(m=a[ie],this[ie]=m?m(P):P[ie]);return this.isDefaultPrevented=(P.defaultPrevented!=null?P.defaultPrevented:P.returnValue===!1)?Yc:Mm,this.isPropagationStopped=Mm,this}return ze(d.prototype,{preventDefault:function(){this.defaultPrevented=!0;var m=this.nativeEvent;m&&(m.preventDefault?m.preventDefault():typeof m.returnValue!="unknown"&&(m.returnValue=!1),this.isDefaultPrevented=Yc)},stopPropagation:function(){var m=this.nativeEvent;m&&(m.stopPropagation?m.stopPropagation():typeof m.cancelBubble!="unknown"&&(m.cancelBubble=!0),this.isPropagationStopped=Yc)},persist:function(){},isPersistent:Yc}),d}var Ja={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(a){return a.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Um=os(Ja),qc=ze({},Ja,{view:0,detail:0}),Vm=os(qc),_u,jm,Eu,Ro=ze({},qc,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Bm,button:0,buttons:0,relatedTarget:function(a){return a.relatedTarget===void 0?a.fromElement===a.srcElement?a.toElement:a.fromElement:a.relatedTarget},movementX:function(a){return"movementX"in a?a.movementX:(a!==Eu&&(Eu&&a.type==="mousemove"?(_u=a.screenX-Eu.screenX,jm=a.screenY-Eu.screenY):jm=_u=0,Eu=a),_u)},movementY:function(a){return"movementY"in a?a.movementY:jm}}),Wl=os(Ro),rC=ze({},Ro,{dataTransfer:0}),iC=os(rC),sC=ze({},qc,{relatedTarget:0}),Fm=os(sC),oC=ze({},Ja,{animationName:0,elapsedTime:0,pseudoElement:0}),Gl=os(oC),aC=ze({},Ja,{clipboardData:function(a){return"clipboardData"in a?a.clipboardData:window.clipboardData}}),Hl=os(aC),dv=ze({},Ja,{data:0}),uv=os(dv),Jt={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},cC={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},lC={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function dC(a){var d=this.nativeEvent;return d.getModifierState?d.getModifierState(a):(a=lC[a])?!!d[a]:!1}function Bm(){return dC}var Wm=ze({},qc,{key:function(a){if(a.key){var d=Jt[a.key]||a.key;if(d!=="Unidentified")return d}return a.type==="keypress"?(a=np(a),a===13?"Enter":String.fromCharCode(a)):a.type==="keydown"||a.type==="keyup"?cC[a.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Bm,charCode:function(a){return a.type==="keypress"?np(a):0},keyCode:function(a){return a.type==="keydown"||a.type==="keyup"?a.keyCode:0},which:function(a){return a.type==="keypress"?np(a):a.type==="keydown"||a.type==="keyup"?a.keyCode:0}}),uC=os(Wm),hC=ze({},Ro,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),hv=os(hC),Gm=ze({},qc,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Bm}),pC=os(Gm),fC=ze({},Ja,{propertyName:0,elapsedTime:0,pseudoElement:0}),pv=os(fC),mC=ze({},Ro,{deltaX:function(a){return"deltaX"in a?a.deltaX:"wheelDeltaX"in a?-a.wheelDeltaX:0},deltaY:function(a){return"deltaY"in a?a.deltaY:"wheelDeltaY"in a?-a.wheelDeltaY:"wheelDelta"in a?-a.wheelDelta:0},deltaZ:0,deltaMode:0}),Qa=os(mC),_C=[9,13,27,32],Hm=L&&"CompositionEvent"in window,gu=null;L&&"documentMode"in document&&(gu=document.documentMode);var fv=L&&"TextEvent"in window&&!gu,rp=L&&(!Hm||gu&&8<gu&&11>=gu),mv=" ",_v=!1;function Ev(a,d){switch(a){case"keyup":return _C.indexOf(d.keyCode)!==-1;case"keydown":return d.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function as(a){return a=a.detail,typeof a=="object"&&"data"in a?a.data:null}var Kl=!1;function EC(a,d){switch(a){case"compositionend":return as(d);case"keypress":return d.which!==32?null:(_v=!0,mv);case"textInput":return a=d.data,a===mv&&_v?null:a;default:return null}}function gC(a,d){if(Kl)return a==="compositionend"||!Hm&&Ev(a,d)?(a=lv(),tp=li=Xa=null,Kl=!1,a):null;switch(a){case"paste":return null;case"keypress":if(!(d.ctrlKey||d.altKey||d.metaKey)||d.ctrlKey&&d.altKey){if(d.char&&1<d.char.length)return d.char;if(d.which)return String.fromCharCode(d.which)}return null;case"compositionend":return rp&&d.locale!=="ko"?null:d.data;default:return null}}var vC={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Km(a){var d=a&&a.nodeName&&a.nodeName.toLowerCase();return d==="input"?!!vC[a.type]:d==="textarea"}function gv(a,d,m,S){Ga(S),d=wu(d,"onChange"),0<d.length&&(m=new Um("onChange","change",null,m,S),a.push({event:m,listeners:d}))}var vu=null,zl=null;function zm(a){Nv(a,0)}function ip(a){var d=$l(a);if(Yn(d))return a}function yC(a,d){if(a==="change")return d}var yu=!1;if(L){var Ym;if(L){var qm="oninput"in document;if(!qm){var vv=document.createElement("div");vv.setAttribute("oninput","return;"),qm=typeof vv.oninput=="function"}Ym=qm}else Ym=!1;yu=Ym&&(!document.documentMode||9<document.documentMode)}function $o(){vu&&(vu.detachEvent("onpropertychange",yv),zl=vu=null)}function yv(a){if(a.propertyName==="value"&&ip(zl)){var d=[];gv(d,zl,a,Hc(a)),Gi(zm,d)}}function SC(a,d,m){a==="focusin"?($o(),vu=d,zl=m,vu.attachEvent("onpropertychange",yv)):a==="focusout"&&$o()}function Ki(a){if(a==="selectionchange"||a==="keyup"||a==="keydown")return ip(zl)}function TC(a,d){if(a==="click")return ip(d)}function RC(a,d){if(a==="input"||a==="change")return ip(d)}function CC(a,d){return a===d&&(a!==0||1/a===1/d)||a!==a&&d!==d}var Ks=typeof Object.is=="function"?Object.is:CC;function Yl(a,d){if(Ks(a,d))return!0;if(typeof a!="object"||a===null||typeof d!="object"||d===null)return!1;var m=Object.keys(a),S=Object.keys(d);if(m.length!==S.length)return!1;for(S=0;S<m.length;S++){var b=m[S];if(!V.call(d,b)||!Ks(a[b],d[b]))return!1}return!0}function Sv(a){for(;a&&a.firstChild;)a=a.firstChild;return a}function Tv(a,d){var m=Sv(a);a=0;for(var S;m;){if(m.nodeType===3){if(S=a+m.textContent.length,a<=d&&S>=d)return{node:m,offset:d-a};a=S}e:{for(;m;){if(m.nextSibling){m=m.nextSibling;break e}m=m.parentNode}m=void 0}m=Sv(m)}}function Rv(a,d){return a&&d?a===d?!0:a&&a.nodeType===3?!1:d&&d.nodeType===3?Rv(a,d.parentNode):"contains"in a?a.contains(d):a.compareDocumentPosition?!!(a.compareDocumentPosition(d)&16):!1:!1}function Xm(){for(var a=window,d=er();d instanceof a.HTMLIFrameElement;){try{var m=typeof d.contentWindow.location.href=="string"}catch{m=!1}if(m)a=d.contentWindow;else break;d=er(a.document)}return d}function Jm(a){var d=a&&a.nodeName&&a.nodeName.toLowerCase();return d&&(d==="input"&&(a.type==="text"||a.type==="search"||a.type==="tel"||a.type==="url"||a.type==="password")||d==="textarea"||a.contentEditable==="true")}function wC(a){var d=Xm(),m=a.focusedElem,S=a.selectionRange;if(d!==m&&m&&m.ownerDocument&&Rv(m.ownerDocument.documentElement,m)){if(S!==null&&Jm(m)){if(d=S.start,a=S.end,a===void 0&&(a=d),"selectionStart"in m)m.selectionStart=d,m.selectionEnd=Math.min(a,m.value.length);else if(a=(d=m.ownerDocument||document)&&d.defaultView||window,a.getSelection){a=a.getSelection();var b=m.textContent.length,P=Math.min(S.start,b);S=S.end===void 0?P:Math.min(S.end,b),!a.extend&&P>S&&(b=S,S=P,P=b),b=Tv(m,P);var Y=Tv(m,S);b&&Y&&(a.rangeCount!==1||a.anchorNode!==b.node||a.anchorOffset!==b.offset||a.focusNode!==Y.node||a.focusOffset!==Y.offset)&&(d=d.createRange(),d.setStart(b.node,b.offset),a.removeAllRanges(),P>S?(a.addRange(d),a.extend(Y.node,Y.offset)):(d.setEnd(Y.node,Y.offset),a.addRange(d)))}}for(d=[],a=m;a=a.parentNode;)a.nodeType===1&&d.push({element:a,left:a.scrollLeft,top:a.scrollTop});for(typeof m.focus=="function"&&m.focus(),m=0;m<d.length;m++)a=d[m],a.element.scrollLeft=a.left,a.element.scrollTop=a.top}}var Qm=L&&"documentMode"in document&&11>=document.documentMode,Za=null,Zm=null,Re=null,$m=!1;function Cv(a,d,m){var S=m.window===m?m.document:m.nodeType===9?m:m.ownerDocument;$m||Za==null||Za!==er(S)||(S=Za,"selectionStart"in S&&Jm(S)?S={start:S.selectionStart,end:S.selectionEnd}:(S=(S.ownerDocument&&S.ownerDocument.defaultView||window).getSelection(),S={anchorNode:S.anchorNode,anchorOffset:S.anchorOffset,focusNode:S.focusNode,focusOffset:S.focusOffset}),Re&&Yl(Re,S)||(Re=S,S=wu(Zm,"onSelect"),0<S.length&&(d=new Um("onSelect","select",null,d,m),a.push({event:d,listeners:S}),d.target=Za)))}function sp(a,d){var m={};return m[a.toLowerCase()]=d.toLowerCase(),m["Webkit"+a]="webkit"+d,m["Moz"+a]="moz"+d,m}var ql={animationend:sp("Animation","AnimationEnd"),animationiteration:sp("Animation","AnimationIteration"),animationstart:sp("Animation","AnimationStart"),transitionend:sp("Transition","TransitionEnd")},op={},e_={};L&&(e_=document.createElement("div").style,"AnimationEvent"in window||(delete ql.animationend.animation,delete ql.animationiteration.animation,delete ql.animationstart.animation),"TransitionEvent"in window||delete ql.transitionend.transition);function ap(a){if(op[a])return op[a];if(!ql[a])return a;var d=ql[a],m;for(m in d)if(d.hasOwnProperty(m)&&m in e_)return op[a]=d[m];return a}var wv=ap("animationend"),bv=ap("animationiteration"),Su=ap("animationstart"),Xl=ap("transitionend"),Iv=new Map,Av="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function zs(a,d){Iv.set(a,d),A(d,[a])}for(var Tu=0;Tu<Av.length;Tu++){var Jl=Av[Tu],bC=Jl.toLowerCase(),IC=Jl[0].toUpperCase()+Jl.slice(1);zs(bC,"on"+IC)}zs(wv,"onAnimationEnd"),zs(bv,"onAnimationIteration"),zs(Su,"onAnimationStart"),zs("dblclick","onDoubleClick"),zs("focusin","onFocus"),zs("focusout","onBlur"),zs(Xl,"onTransitionEnd"),D("onMouseEnter",["mouseout","mouseover"]),D("onMouseLeave",["mouseout","mouseover"]),D("onPointerEnter",["pointerout","pointerover"]),D("onPointerLeave",["pointerout","pointerover"]),A("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),A("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),A("onBeforeInput",["compositionend","keypress","textInput","paste"]),A("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),A("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),A("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Ru="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),AC=new Set("cancel close invalid load scroll toggle".split(" ").concat(Ru));function cp(a,d,m){var S=a.type||"unknown-event";a.currentTarget=m,YR(S,d,void 0,a),a.currentTarget=null}function Nv(a,d){d=(d&4)!==0;for(var m=0;m<a.length;m++){var S=a[m],b=S.event;S=S.listeners;e:{var P=void 0;if(d)for(var Y=S.length-1;0<=Y;Y--){var ie=S[Y],ue=ie.instance,Ae=ie.currentTarget;if(ie=ie.listener,ue!==P&&b.isPropagationStopped())break e;cp(b,ie,Ae),P=ue}else for(Y=0;Y<S.length;Y++){if(ie=S[Y],ue=ie.instance,Ae=ie.currentTarget,ie=ie.listener,ue!==P&&b.isPropagationStopped())break e;cp(b,ie,Ae),P=ue}}}if(lu)throw a=wm,lu=!1,wm=null,a}function tr(a,d){var m=d[s_];m===void 0&&(m=d[s_]=new Set);var S=a+"__bubble";m.has(S)||(Ov(d,a,2,!1),m.add(S))}function zi(a,d,m){var S=0;d&&(S|=4),Ov(m,a,S,d)}var lp="_reactListening"+Math.random().toString(36).slice(2);function ea(a){if(!a[lp]){a[lp]=!0,y.forEach(function(m){m!=="selectionchange"&&(AC.has(m)||zi(m,!1,a),zi(m,!0,a))});var d=a.nodeType===9?a:a.ownerDocument;d===null||d[lp]||(d[lp]=!0,zi("selectionchange",!1,d))}}function Ov(a,d,m,S){switch(cv(d)){case 1:var b=nC;break;case 4:b=qa;break;default:b=Hi}m=b.bind(null,d,m,a),b=void 0,!Gs||d!=="touchstart"&&d!=="touchmove"&&d!=="wheel"||(b=!0),S?b!==void 0?a.addEventListener(d,m,{capture:!0,passive:b}):a.addEventListener(d,m,!0):b!==void 0?a.addEventListener(d,m,{passive:b}):a.addEventListener(d,m,!1)}function t_(a,d,m,S,b){var P=S;if((d&1)===0&&(d&2)===0&&S!==null)e:for(;;){if(S===null)return;var Y=S.tag;if(Y===3||Y===4){var ie=S.stateNode.containerInfo;if(ie===b||ie.nodeType===8&&ie.parentNode===b)break;if(Y===4)for(Y=S.return;Y!==null;){var ue=Y.tag;if((ue===3||ue===4)&&(ue=Y.stateNode.containerInfo,ue===b||ue.nodeType===8&&ue.parentNode===b))return;Y=Y.return}for(;ie!==null;){if(Y=Xc(ie),Y===null)return;if(ue=Y.tag,ue===5||ue===6){S=P=Y;continue e}ie=ie.parentNode}}S=S.return}Gi(function(){var Ae=P,Ke=Hc(m),qe=[];e:{var He=Iv.get(a);if(He!==void 0){var ft=Um,yt=a;switch(a){case"keypress":if(np(m)===0)break e;case"keydown":case"keyup":ft=uC;break;case"focusin":yt="focus",ft=Fm;break;case"focusout":yt="blur",ft=Fm;break;case"beforeblur":case"afterblur":ft=Fm;break;case"click":if(m.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":ft=Wl;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":ft=iC;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":ft=pC;break;case wv:case bv:case Su:ft=Gl;break;case Xl:ft=pv;break;case"scroll":ft=Vm;break;case"wheel":ft=Qa;break;case"copy":case"cut":case"paste":ft=Hl;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":ft=hv}var Tt=(d&4)!==0,_r=!Tt&&a==="scroll",ge=Tt?He!==null?He+"Capture":null:He;Tt=[];for(var pe=Ae,Ce;pe!==null;){Ce=pe;var Qe=Ce.stateNode;if(Ce.tag===5&&Qe!==null&&(Ce=Qe,ge!==null&&(Qe=Xn(pe,ge),Qe!=null&&Tt.push(Cu(pe,Qe,Ce)))),_r)break;pe=pe.return}0<Tt.length&&(He=new ft(He,yt,null,m,Ke),qe.push({event:He,listeners:Tt}))}}if((d&7)===0){e:{if(He=a==="mouseover"||a==="pointerover",ft=a==="mouseout"||a==="pointerout",He&&m!==vo&&(yt=m.relatedTarget||m.fromElement)&&(Xc(yt)||yt[ta]))break e;if((ft||He)&&(He=Ke.window===Ke?Ke:(He=Ke.ownerDocument)?He.defaultView||He.parentWindow:window,ft?(yt=m.relatedTarget||m.toElement,ft=Ae,yt=yt?Xc(yt):null,yt!==null&&(_r=Kc(yt),yt!==_r||yt.tag!==5&&yt.tag!==6)&&(yt=null)):(ft=null,yt=Ae),ft!==yt)){if(Tt=Wl,Qe="onMouseLeave",ge="onMouseEnter",pe="mouse",(a==="pointerout"||a==="pointerover")&&(Tt=hv,Qe="onPointerLeave",ge="onPointerEnter",pe="pointer"),_r=ft==null?He:$l(ft),Ce=yt==null?He:$l(yt),He=new Tt(Qe,pe+"leave",ft,m,Ke),He.target=_r,He.relatedTarget=Ce,Qe=null,Xc(Ke)===Ae&&(Tt=new Tt(ge,pe+"enter",yt,m,Ke),Tt.target=Ce,Tt.relatedTarget=_r,Qe=Tt),_r=Qe,ft&&yt)t:{for(Tt=ft,ge=yt,pe=0,Ce=Tt;Ce;Ce=Ql(Ce))pe++;for(Ce=0,Qe=ge;Qe;Qe=Ql(Qe))Ce++;for(;0<pe-Ce;)Tt=Ql(Tt),pe--;for(;0<Ce-pe;)ge=Ql(ge),Ce--;for(;pe--;){if(Tt===ge||ge!==null&&Tt===ge.alternate)break t;Tt=Ql(Tt),ge=Ql(ge)}Tt=null}else Tt=null;ft!==null&&Pv(qe,He,ft,Tt,!1),yt!==null&&_r!==null&&Pv(qe,_r,yt,Tt,!0)}}e:{if(He=Ae?$l(Ae):window,ft=He.nodeName&&He.nodeName.toLowerCase(),ft==="select"||ft==="input"&&He.type==="file")var Rt=yC;else if(Km(He))if(yu)Rt=RC;else{Rt=Ki;var Dt=SC}else(ft=He.nodeName)&&ft.toLowerCase()==="input"&&(He.type==="checkbox"||He.type==="radio")&&(Rt=TC);if(Rt&&(Rt=Rt(a,Ae))){gv(qe,Rt,m,Ke);break e}Dt&&Dt(a,He,Ae),a==="focusout"&&(Dt=He._wrapperState)&&Dt.controlled&&He.type==="number"&&ai(He,"number",He.value)}switch(Dt=Ae?$l(Ae):window,a){case"focusin":(Km(Dt)||Dt.contentEditable==="true")&&(Za=Dt,Zm=Ae,Re=null);break;case"focusout":Re=Zm=Za=null;break;case"mousedown":$m=!0;break;case"contextmenu":case"mouseup":case"dragend":$m=!1,Cv(qe,m,Ke);break;case"selectionchange":if(Qm)break;case"keydown":case"keyup":Cv(qe,m,Ke)}var kt;if(Hm)e:{switch(a){case"compositionstart":var Vt="onCompositionStart";break e;case"compositionend":Vt="onCompositionEnd";break e;case"compositionupdate":Vt="onCompositionUpdate";break e}Vt=void 0}else Kl?Ev(a,m)&&(Vt="onCompositionEnd"):a==="keydown"&&m.keyCode===229&&(Vt="onCompositionStart");Vt&&(rp&&m.locale!=="ko"&&(Kl||Vt!=="onCompositionStart"?Vt==="onCompositionEnd"&&Kl&&(kt=lv()):(Xa=Ke,li="value"in Xa?Xa.value:Xa.textContent,Kl=!0)),Dt=wu(Ae,Vt),0<Dt.length&&(Vt=new uv(Vt,a,null,m,Ke),qe.push({event:Vt,listeners:Dt}),kt?Vt.data=kt:(kt=as(m),kt!==null&&(Vt.data=kt)))),(kt=fv?EC(a,m):gC(a,m))&&(Ae=wu(Ae,"onBeforeInput"),0<Ae.length&&(Ke=new uv("onBeforeInput","beforeinput",null,m,Ke),qe.push({event:Ke,listeners:Ae}),Ke.data=kt))}Nv(qe,d)})}function Cu(a,d,m){return{instance:a,listener:d,currentTarget:m}}function wu(a,d){for(var m=d+"Capture",S=[];a!==null;){var b=a,P=b.stateNode;b.tag===5&&P!==null&&(b=P,P=Xn(a,m),P!=null&&S.unshift(Cu(a,P,b)),P=Xn(a,d),P!=null&&S.push(Cu(a,P,b))),a=a.return}return S}function Ql(a){if(a===null)return null;do a=a.return;while(a&&a.tag!==5);return a||null}function Pv(a,d,m,S,b){for(var P=d._reactName,Y=[];m!==null&&m!==S;){var ie=m,ue=ie.alternate,Ae=ie.stateNode;if(ue!==null&&ue===S)break;ie.tag===5&&Ae!==null&&(ie=Ae,b?(ue=Xn(m,P),ue!=null&&Y.unshift(Cu(m,ue,ie))):b||(ue=Xn(m,P),ue!=null&&Y.push(Cu(m,ue,ie)))),m=m.return}Y.length!==0&&a.push({event:d,listeners:Y})}var NC=/\r\n?/g,n_=/\u0000|\uFFFD/g;function Dv(a){return(typeof a=="string"?a:""+a).replace(NC,`
`).replace(n_,"")}function bu(a,d,m){if(d=Dv(d),Dv(a)!==d&&m)throw Error(_(425))}function Iu(){}var r_=null,dp=null;function Zl(a,d){return a==="textarea"||a==="noscript"||typeof d.children=="string"||typeof d.children=="number"||typeof d.dangerouslySetInnerHTML=="object"&&d.dangerouslySetInnerHTML!==null&&d.dangerouslySetInnerHTML.__html!=null}var i_=typeof setTimeout=="function"?setTimeout:void 0,OC=typeof clearTimeout=="function"?clearTimeout:void 0,kv=typeof Promise=="function"?Promise:void 0,PC=typeof queueMicrotask=="function"?queueMicrotask:typeof kv<"u"?function(a){return kv.resolve(null).then(a).catch(DC)}:i_;function DC(a){setTimeout(function(){throw a})}function up(a,d){var m=d,S=0;do{var b=m.nextSibling;if(a.removeChild(m),b&&b.nodeType===8)if(m=b.data,m==="/$"){if(S===0){a.removeChild(b),Fl(d);return}S--}else m!=="$"&&m!=="$?"&&m!=="$!"||S++;m=b}while(m);Fl(d)}function Co(a){for(;a!=null;a=a.nextSibling){var d=a.nodeType;if(d===1||d===3)break;if(d===8){if(d=a.data,d==="$"||d==="$!"||d==="$?")break;if(d==="/$")return null}}return a}function Lv(a){a=a.previousSibling;for(var d=0;a;){if(a.nodeType===8){var m=a.data;if(m==="$"||m==="$!"||m==="$?"){if(d===0)return a;d--}else m==="/$"&&d++}a=a.previousSibling}return null}var $a=Math.random().toString(36).slice(2),wo="__reactFiber$"+$a,Au="__reactProps$"+$a,ta="__reactContainer$"+$a,s_="__reactEvents$"+$a,kC="__reactListeners$"+$a,LC="__reactHandles$"+$a;function Xc(a){var d=a[wo];if(d)return d;for(var m=a.parentNode;m;){if(d=m[ta]||m[wo]){if(m=d.alternate,d.child!==null||m!==null&&m.child!==null)for(a=Lv(a);a!==null;){if(m=a[wo])return m;a=Lv(a)}return d}a=m,m=a.parentNode}return null}function Nu(a){return a=a[wo]||a[ta],!a||a.tag!==5&&a.tag!==6&&a.tag!==13&&a.tag!==3?null:a}function $l(a){if(a.tag===5||a.tag===6)return a.stateNode;throw Error(_(33))}function hp(a){return a[Au]||null}var o_=[],na=-1;function Ys(a){return{current:a}}function Jn(a){0>na||(a.current=o_[na],o_[na]=null,na--)}function nr(a,d){na++,o_[na]=a.current,a.current=d}var ec={},vi=Ys(ec),Di=Ys(!1),tc=ec;function nc(a,d){var m=a.type.contextTypes;if(!m)return ec;var S=a.stateNode;if(S&&S.__reactInternalMemoizedUnmaskedChildContext===d)return S.__reactInternalMemoizedMaskedChildContext;var b={},P;for(P in m)b[P]=d[P];return S&&(a=a.stateNode,a.__reactInternalMemoizedUnmaskedChildContext=d,a.__reactInternalMemoizedMaskedChildContext=b),b}function Yi(a){return a=a.childContextTypes,a!=null}function pp(){Jn(Di),Jn(vi)}function ed(a,d,m){if(vi.current!==ec)throw Error(_(168));nr(vi,d),nr(Di,m)}function xv(a,d,m){var S=a.stateNode;if(d=d.childContextTypes,typeof S.getChildContext!="function")return m;S=S.getChildContext();for(var b in S)if(!(b in d))throw Error(_(108,Ye(a)||"Unknown",b));return ze({},m,S)}function fp(a){return a=(a=a.stateNode)&&a.__reactInternalMemoizedMergedChildContext||ec,tc=vi.current,nr(vi,a),nr(Di,Di.current),!0}function Mv(a,d,m){var S=a.stateNode;if(!S)throw Error(_(169));m?(a=xv(a,d,tc),S.__reactInternalMemoizedMergedChildContext=a,Jn(Di),Jn(vi),nr(vi,a)):Jn(Di),nr(Di,m)}var ra=null,mp=!1,a_=!1;function c_(a){ra===null?ra=[a]:ra.push(a)}function xC(a){mp=!0,c_(a)}function rc(){if(!a_&&ra!==null){a_=!0;var a=0,d=Ln;try{var m=ra;for(Ln=1;a<m.length;a++){var S=m[a];do S=S(!0);while(S!==null)}ra=null,mp=!1}catch(b){throw ra!==null&&(ra=ra.slice(a+1)),zc(Tr,rc),b}finally{Ln=d,a_=!1}}return null}var td=[],ic=0,_p=null,Ep=0,ki=[],vs=0,Jc=null,ia=1,sa="";function Qc(a,d){td[ic++]=Ep,td[ic++]=_p,_p=a,Ep=d}function Uv(a,d,m){ki[vs++]=ia,ki[vs++]=sa,ki[vs++]=Jc,Jc=a;var S=ia;a=sa;var b=32-Hs(S)-1;S&=~(1<<b),m+=1;var P=32-Hs(d)+b;if(30<P){var Y=b-b%5;P=(S&(1<<Y)-1).toString(32),S>>=Y,b-=Y,ia=1<<32-Hs(d)+b|m<<b|S,sa=P+a}else ia=1<<P|m<<b|S,sa=a}function nd(a){a.return!==null&&(Qc(a,1),Uv(a,1,0))}function gp(a){for(;a===_p;)_p=td[--ic],td[ic]=null,Ep=td[--ic],td[ic]=null;for(;a===Jc;)Jc=ki[--vs],ki[vs]=null,sa=ki[--vs],ki[vs]=null,ia=ki[--vs],ki[vs]=null}var cs=null,ls=null,or=!1,qs=null;function Vv(a,d){var m=Cs(5,null,null,0);m.elementType="DELETED",m.stateNode=d,m.return=a,d=a.deletions,d===null?(a.deletions=[m],a.flags|=16):d.push(m)}function jv(a,d){switch(a.tag){case 5:var m=a.type;return d=d.nodeType!==1||m.toLowerCase()!==d.nodeName.toLowerCase()?null:d,d!==null?(a.stateNode=d,cs=a,ls=Co(d.firstChild),!0):!1;case 6:return d=a.pendingProps===""||d.nodeType!==3?null:d,d!==null?(a.stateNode=d,cs=a,ls=null,!0):!1;case 13:return d=d.nodeType!==8?null:d,d!==null?(m=Jc!==null?{id:ia,overflow:sa}:null,a.memoizedState={dehydrated:d,treeContext:m,retryLane:1073741824},m=Cs(18,null,null,0),m.stateNode=d,m.return=a,a.child=m,cs=a,ls=null,!0):!1;default:return!1}}function Ou(a){return(a.mode&1)!==0&&(a.flags&128)===0}function Pu(a){if(or){var d=ls;if(d){var m=d;if(!jv(a,d)){if(Ou(a))throw Error(_(418));d=Co(m.nextSibling);var S=cs;d&&jv(a,d)?Vv(S,m):(a.flags=a.flags&-4097|2,or=!1,cs=a)}}else{if(Ou(a))throw Error(_(418));a.flags=a.flags&-4097|2,or=!1,cs=a}}}function l_(a){for(a=a.return;a!==null&&a.tag!==5&&a.tag!==3&&a.tag!==13;)a=a.return;cs=a}function rd(a){if(a!==cs)return!1;if(!or)return l_(a),or=!0,!1;var d;if((d=a.tag!==3)&&!(d=a.tag!==5)&&(d=a.type,d=d!=="head"&&d!=="body"&&!Zl(a.type,a.memoizedProps)),d&&(d=ls)){if(Ou(a))throw d_(),Error(_(418));for(;d;)Vv(a,d),d=Co(d.nextSibling)}if(l_(a),a.tag===13){if(a=a.memoizedState,a=a!==null?a.dehydrated:null,!a)throw Error(_(317));e:{for(a=a.nextSibling,d=0;a;){if(a.nodeType===8){var m=a.data;if(m==="/$"){if(d===0){ls=Co(a.nextSibling);break e}d--}else m!=="$"&&m!=="$!"&&m!=="$?"||d++}a=a.nextSibling}ls=null}}else ls=cs?Co(a.stateNode.nextSibling):null;return!0}function d_(){for(var a=ls;a;)a=Co(a.nextSibling)}function Zc(){ls=cs=null,or=!1}function id(a){qs===null?qs=[a]:qs.push(a)}var Du=Se.ReactCurrentBatchConfig;function ku(a,d,m){if(a=m.ref,a!==null&&typeof a!="function"&&typeof a!="object"){if(m._owner){if(m=m._owner,m){if(m.tag!==1)throw Error(_(309));var S=m.stateNode}if(!S)throw Error(_(147,a));var b=S,P=""+a;return d!==null&&d.ref!==null&&typeof d.ref=="function"&&d.ref._stringRef===P?d.ref:(d=function(Y){var ie=b.refs;Y===null?delete ie[P]:ie[P]=Y},d._stringRef=P,d)}if(typeof a!="string")throw Error(_(284));if(!m._owner)throw Error(_(290,a))}return a}function vp(a,d){throw a=Object.prototype.toString.call(d),Error(_(31,a==="[object Object]"?"object with keys {"+Object.keys(d).join(", ")+"}":a))}function u_(a){var d=a._init;return d(a._payload)}function Fv(a){function d(ge,pe){if(a){var Ce=ge.deletions;Ce===null?(ge.deletions=[pe],ge.flags|=16):Ce.push(pe)}}function m(ge,pe){if(!a)return null;for(;pe!==null;)d(ge,pe),pe=pe.sibling;return null}function S(ge,pe){for(ge=new Map;pe!==null;)pe.key!==null?ge.set(pe.key,pe):ge.set(pe.index,pe),pe=pe.sibling;return ge}function b(ge,pe){return ge=_c(ge,pe),ge.index=0,ge.sibling=null,ge}function P(ge,pe,Ce){return ge.index=Ce,a?(Ce=ge.alternate,Ce!==null?(Ce=Ce.index,Ce<pe?(ge.flags|=2,pe):Ce):(ge.flags|=2,pe)):(ge.flags|=1048576,pe)}function Y(ge){return a&&ge.alternate===null&&(ge.flags|=2),ge}function ie(ge,pe,Ce,Qe){return pe===null||pe.tag!==6?(pe=Xp(Ce,ge.mode,Qe),pe.return=ge,pe):(pe=b(pe,Ce),pe.return=ge,pe)}function ue(ge,pe,Ce,Qe){var Rt=Ce.type;return Rt===xe?Ke(ge,pe,Ce.props.children,Qe,Ce.key):pe!==null&&(pe.elementType===Rt||typeof Rt=="object"&&Rt!==null&&Rt.$$typeof===nt&&u_(Rt)===pe.type)?(Qe=b(pe,Ce.props),Qe.ref=ku(ge,pe,Ce),Qe.return=ge,Qe):(Qe=_d(Ce.type,Ce.key,Ce.props,null,ge.mode,Qe),Qe.ref=ku(ge,pe,Ce),Qe.return=ge,Qe)}function Ae(ge,pe,Ce,Qe){return pe===null||pe.tag!==4||pe.stateNode.containerInfo!==Ce.containerInfo||pe.stateNode.implementation!==Ce.implementation?(pe=Ed(Ce,ge.mode,Qe),pe.return=ge,pe):(pe=b(pe,Ce.children||[]),pe.return=ge,pe)}function Ke(ge,pe,Ce,Qe,Rt){return pe===null||pe.tag!==7?(pe=Ec(Ce,ge.mode,Qe,Rt),pe.return=ge,pe):(pe=b(pe,Ce),pe.return=ge,pe)}function qe(ge,pe,Ce){if(typeof pe=="string"&&pe!==""||typeof pe=="number")return pe=Xp(""+pe,ge.mode,Ce),pe.return=ge,pe;if(typeof pe=="object"&&pe!==null){switch(pe.$$typeof){case be:return Ce=_d(pe.type,pe.key,pe.props,null,ge.mode,Ce),Ce.ref=ku(ge,null,pe),Ce.return=ge,Ce;case Ue:return pe=Ed(pe,ge.mode,Ce),pe.return=ge,pe;case nt:var Qe=pe._init;return qe(ge,Qe(pe._payload),Ce)}if(Eo(pe)||ke(pe))return pe=Ec(pe,ge.mode,Ce,null),pe.return=ge,pe;vp(ge,pe)}return null}function He(ge,pe,Ce,Qe){var Rt=pe!==null?pe.key:null;if(typeof Ce=="string"&&Ce!==""||typeof Ce=="number")return Rt!==null?null:ie(ge,pe,""+Ce,Qe);if(typeof Ce=="object"&&Ce!==null){switch(Ce.$$typeof){case be:return Ce.key===Rt?ue(ge,pe,Ce,Qe):null;case Ue:return Ce.key===Rt?Ae(ge,pe,Ce,Qe):null;case nt:return Rt=Ce._init,He(ge,pe,Rt(Ce._payload),Qe)}if(Eo(Ce)||ke(Ce))return Rt!==null?null:Ke(ge,pe,Ce,Qe,null);vp(ge,Ce)}return null}function ft(ge,pe,Ce,Qe,Rt){if(typeof Qe=="string"&&Qe!==""||typeof Qe=="number")return ge=ge.get(Ce)||null,ie(pe,ge,""+Qe,Rt);if(typeof Qe=="object"&&Qe!==null){switch(Qe.$$typeof){case be:return ge=ge.get(Qe.key===null?Ce:Qe.key)||null,ue(pe,ge,Qe,Rt);case Ue:return ge=ge.get(Qe.key===null?Ce:Qe.key)||null,Ae(pe,ge,Qe,Rt);case nt:var Dt=Qe._init;return ft(ge,pe,Ce,Dt(Qe._payload),Rt)}if(Eo(Qe)||ke(Qe))return ge=ge.get(Ce)||null,Ke(pe,ge,Qe,Rt,null);vp(pe,Qe)}return null}function yt(ge,pe,Ce,Qe){for(var Rt=null,Dt=null,kt=pe,Vt=pe=0,zr=null;kt!==null&&Vt<Ce.length;Vt++){kt.index>Vt?(zr=kt,kt=null):zr=kt.sibling;var On=He(ge,kt,Ce[Vt],Qe);if(On===null){kt===null&&(kt=zr);break}a&&kt&&On.alternate===null&&d(ge,kt),pe=P(On,pe,Vt),Dt===null?Rt=On:Dt.sibling=On,Dt=On,kt=zr}if(Vt===Ce.length)return m(ge,kt),or&&Qc(ge,Vt),Rt;if(kt===null){for(;Vt<Ce.length;Vt++)kt=qe(ge,Ce[Vt],Qe),kt!==null&&(pe=P(kt,pe,Vt),Dt===null?Rt=kt:Dt.sibling=kt,Dt=kt);return or&&Qc(ge,Vt),Rt}for(kt=S(ge,kt);Vt<Ce.length;Vt++)zr=ft(kt,ge,Vt,Ce[Vt],Qe),zr!==null&&(a&&zr.alternate!==null&&kt.delete(zr.key===null?Vt:zr.key),pe=P(zr,pe,Vt),Dt===null?Rt=zr:Dt.sibling=zr,Dt=zr);return a&&kt.forEach(function(Po){return d(ge,Po)}),or&&Qc(ge,Vt),Rt}function Tt(ge,pe,Ce,Qe){var Rt=ke(Ce);if(typeof Rt!="function")throw Error(_(150));if(Ce=Rt.call(Ce),Ce==null)throw Error(_(151));for(var Dt=Rt=null,kt=pe,Vt=pe=0,zr=null,On=Ce.next();kt!==null&&!On.done;Vt++,On=Ce.next()){kt.index>Vt?(zr=kt,kt=null):zr=kt.sibling;var Po=He(ge,kt,On.value,Qe);if(Po===null){kt===null&&(kt=zr);break}a&&kt&&Po.alternate===null&&d(ge,kt),pe=P(Po,pe,Vt),Dt===null?Rt=Po:Dt.sibling=Po,Dt=Po,kt=zr}if(On.done)return m(ge,kt),or&&Qc(ge,Vt),Rt;if(kt===null){for(;!On.done;Vt++,On=Ce.next())On=qe(ge,On.value,Qe),On!==null&&(pe=P(On,pe,Vt),Dt===null?Rt=On:Dt.sibling=On,Dt=On);return or&&Qc(ge,Vt),Rt}for(kt=S(ge,kt);!On.done;Vt++,On=Ce.next())On=ft(kt,ge,Vt,On.value,Qe),On!==null&&(a&&On.alternate!==null&&kt.delete(On.key===null?Vt:On.key),pe=P(On,pe,Vt),Dt===null?Rt=On:Dt.sibling=On,Dt=On);return a&&kt.forEach(function(ZC){return d(ge,ZC)}),or&&Qc(ge,Vt),Rt}function _r(ge,pe,Ce,Qe){if(typeof Ce=="object"&&Ce!==null&&Ce.type===xe&&Ce.key===null&&(Ce=Ce.props.children),typeof Ce=="object"&&Ce!==null){switch(Ce.$$typeof){case be:e:{for(var Rt=Ce.key,Dt=pe;Dt!==null;){if(Dt.key===Rt){if(Rt=Ce.type,Rt===xe){if(Dt.tag===7){m(ge,Dt.sibling),pe=b(Dt,Ce.props.children),pe.return=ge,ge=pe;break e}}else if(Dt.elementType===Rt||typeof Rt=="object"&&Rt!==null&&Rt.$$typeof===nt&&u_(Rt)===Dt.type){m(ge,Dt.sibling),pe=b(Dt,Ce.props),pe.ref=ku(ge,Dt,Ce),pe.return=ge,ge=pe;break e}m(ge,Dt);break}else d(ge,Dt);Dt=Dt.sibling}Ce.type===xe?(pe=Ec(Ce.props.children,ge.mode,Qe,Ce.key),pe.return=ge,ge=pe):(Qe=_d(Ce.type,Ce.key,Ce.props,null,ge.mode,Qe),Qe.ref=ku(ge,pe,Ce),Qe.return=ge,ge=Qe)}return Y(ge);case Ue:e:{for(Dt=Ce.key;pe!==null;){if(pe.key===Dt)if(pe.tag===4&&pe.stateNode.containerInfo===Ce.containerInfo&&pe.stateNode.implementation===Ce.implementation){m(ge,pe.sibling),pe=b(pe,Ce.children||[]),pe.return=ge,ge=pe;break e}else{m(ge,pe);break}else d(ge,pe);pe=pe.sibling}pe=Ed(Ce,ge.mode,Qe),pe.return=ge,ge=pe}return Y(ge);case nt:return Dt=Ce._init,_r(ge,pe,Dt(Ce._payload),Qe)}if(Eo(Ce))return yt(ge,pe,Ce,Qe);if(ke(Ce))return Tt(ge,pe,Ce,Qe);vp(ge,Ce)}return typeof Ce=="string"&&Ce!==""||typeof Ce=="number"?(Ce=""+Ce,pe!==null&&pe.tag===6?(m(ge,pe.sibling),pe=b(pe,Ce),pe.return=ge,ge=pe):(m(ge,pe),pe=Xp(Ce,ge.mode,Qe),pe.return=ge,ge=pe),Y(ge)):m(ge,pe)}return _r}var sd=Fv(!0),h_=Fv(!1),yp=Ys(null),Sp=null,od=null,p_=null;function f_(){p_=od=Sp=null}function m_(a){var d=yp.current;Jn(yp),a._currentValue=d}function Tp(a,d,m){for(;a!==null;){var S=a.alternate;if((a.childLanes&d)!==d?(a.childLanes|=d,S!==null&&(S.childLanes|=d)):S!==null&&(S.childLanes&d)!==d&&(S.childLanes|=d),a===m)break;a=a.return}}function Xs(a,d){Sp=a,p_=od=null,a=a.dependencies,a!==null&&a.firstContext!==null&&((a.lanes&d)!==0&&(Xi=!0),a.firstContext=null)}function ys(a){var d=a._currentValue;if(p_!==a)if(a={context:a,memoizedValue:d,next:null},od===null){if(Sp===null)throw Error(_(308));od=a,Sp.dependencies={lanes:0,firstContext:a}}else od=od.next=a;return d}var $c=null;function __(a){$c===null?$c=[a]:$c.push(a)}function E_(a,d,m,S){var b=d.interleaved;return b===null?(m.next=m,__(d)):(m.next=b.next,b.next=m),d.interleaved=m,oa(a,S)}function oa(a,d){a.lanes|=d;var m=a.alternate;for(m!==null&&(m.lanes|=d),m=a,a=a.return;a!==null;)a.childLanes|=d,m=a.alternate,m!==null&&(m.childLanes|=d),m=a,a=a.return;return m.tag===3?m.stateNode:null}var aa=!1;function g_(a){a.updateQueue={baseState:a.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Bv(a,d){a=a.updateQueue,d.updateQueue===a&&(d.updateQueue={baseState:a.baseState,firstBaseUpdate:a.firstBaseUpdate,lastBaseUpdate:a.lastBaseUpdate,shared:a.shared,effects:a.effects})}function ca(a,d){return{eventTime:a,lane:d,tag:0,payload:null,callback:null,next:null}}function Js(a,d,m){var S=a.updateQueue;if(S===null)return null;if(S=S.shared,(pn&2)!==0){var b=S.pending;return b===null?d.next=d:(d.next=b.next,b.next=d),S.pending=d,oa(a,m)}return b=S.interleaved,b===null?(d.next=d,__(S)):(d.next=b.next,b.next=d),S.interleaved=d,oa(a,m)}function Rp(a,d,m){if(d=d.updateQueue,d!==null&&(d=d.shared,(m&4194240)!==0)){var S=d.lanes;S&=a.pendingLanes,m|=S,d.lanes=m,Om(a,m)}}function Wv(a,d){var m=a.updateQueue,S=a.alternate;if(S!==null&&(S=S.updateQueue,m===S)){var b=null,P=null;if(m=m.firstBaseUpdate,m!==null){do{var Y={eventTime:m.eventTime,lane:m.lane,tag:m.tag,payload:m.payload,callback:m.callback,next:null};P===null?b=P=Y:P=P.next=Y,m=m.next}while(m!==null);P===null?b=P=d:P=P.next=d}else b=P=d;m={baseState:S.baseState,firstBaseUpdate:b,lastBaseUpdate:P,shared:S.shared,effects:S.effects},a.updateQueue=m;return}a=m.lastBaseUpdate,a===null?m.firstBaseUpdate=d:a.next=d,m.lastBaseUpdate=d}function Cp(a,d,m,S){var b=a.updateQueue;aa=!1;var P=b.firstBaseUpdate,Y=b.lastBaseUpdate,ie=b.shared.pending;if(ie!==null){b.shared.pending=null;var ue=ie,Ae=ue.next;ue.next=null,Y===null?P=Ae:Y.next=Ae,Y=ue;var Ke=a.alternate;Ke!==null&&(Ke=Ke.updateQueue,ie=Ke.lastBaseUpdate,ie!==Y&&(ie===null?Ke.firstBaseUpdate=Ae:ie.next=Ae,Ke.lastBaseUpdate=ue))}if(P!==null){var qe=b.baseState;Y=0,Ke=Ae=ue=null,ie=P;do{var He=ie.lane,ft=ie.eventTime;if((S&He)===He){Ke!==null&&(Ke=Ke.next={eventTime:ft,lane:0,tag:ie.tag,payload:ie.payload,callback:ie.callback,next:null});e:{var yt=a,Tt=ie;switch(He=d,ft=m,Tt.tag){case 1:if(yt=Tt.payload,typeof yt=="function"){qe=yt.call(ft,qe,He);break e}qe=yt;break e;case 3:yt.flags=yt.flags&-65537|128;case 0:if(yt=Tt.payload,He=typeof yt=="function"?yt.call(ft,qe,He):yt,He==null)break e;qe=ze({},qe,He);break e;case 2:aa=!0}}ie.callback!==null&&ie.lane!==0&&(a.flags|=64,He=b.effects,He===null?b.effects=[ie]:He.push(ie))}else ft={eventTime:ft,lane:He,tag:ie.tag,payload:ie.payload,callback:ie.callback,next:null},Ke===null?(Ae=Ke=ft,ue=qe):Ke=Ke.next=ft,Y|=He;if(ie=ie.next,ie===null){if(ie=b.shared.pending,ie===null)break;He=ie,ie=He.next,He.next=null,b.lastBaseUpdate=He,b.shared.pending=null}}while(!0);if(Ke===null&&(ue=qe),b.baseState=ue,b.firstBaseUpdate=Ae,b.lastBaseUpdate=Ke,d=b.shared.interleaved,d!==null){b=d;do Y|=b.lane,b=b.next;while(b!==d)}else P===null&&(b.shared.lanes=0);al|=Y,a.lanes=Y,a.memoizedState=qe}}function Gv(a,d,m){if(a=d.effects,d.effects=null,a!==null)for(d=0;d<a.length;d++){var S=a[d],b=S.callback;if(b!==null){if(S.callback=null,S=m,typeof b!="function")throw Error(_(191,b));b.call(S)}}}var Lu={},bo=Ys(Lu),el=Ys(Lu),xu=Ys(Lu);function sc(a){if(a===Lu)throw Error(_(174));return a}function v_(a,d){switch(nr(xu,d),nr(el,a),nr(bo,Lu),a=d.nodeType,a){case 9:case 11:d=(d=d.documentElement)?d.namespaceURI:ei(null,"");break;default:a=a===8?d.parentNode:d,d=a.namespaceURI||null,a=a.tagName,d=ei(d,a)}Jn(bo),nr(bo,d)}function tl(){Jn(bo),Jn(el),Jn(xu)}function Hv(a){sc(xu.current);var d=sc(bo.current),m=ei(d,a.type);d!==m&&(nr(el,a),nr(bo,m))}function y_(a){el.current===a&&(Jn(bo),Jn(el))}var fr=Ys(0);function wp(a){for(var d=a;d!==null;){if(d.tag===13){var m=d.memoizedState;if(m!==null&&(m=m.dehydrated,m===null||m.data==="$?"||m.data==="$!"))return d}else if(d.tag===19&&d.memoizedProps.revealOrder!==void 0){if((d.flags&128)!==0)return d}else if(d.child!==null){d.child.return=d,d=d.child;continue}if(d===a)break;for(;d.sibling===null;){if(d.return===null||d.return===a)return null;d=d.return}d.sibling.return=d.return,d=d.sibling}return null}var S_=[];function T_(){for(var a=0;a<S_.length;a++)S_[a]._workInProgressVersionPrimary=null;S_.length=0}var Mu=Se.ReactCurrentDispatcher,R_=Se.ReactCurrentBatchConfig,nl=0,ur=null,Gr=null,Ar=null,Uu=!1,la=!1,Vu=0,MC=0;function yi(){throw Error(_(321))}function C_(a,d){if(d===null)return!1;for(var m=0;m<d.length&&m<a.length;m++)if(!Ks(a[m],d[m]))return!1;return!0}function ad(a,d,m,S,b,P){if(nl=P,ur=d,d.memoizedState=null,d.updateQueue=null,d.lanes=0,Mu.current=a===null||a.memoizedState===null?VC:$v,a=m(S,b),la){P=0;do{if(la=!1,Vu=0,25<=P)throw Error(_(301));P+=1,Ar=Gr=null,d.updateQueue=null,Mu.current=jC,a=m(S,b)}while(la)}if(Mu.current=ld,d=Gr!==null&&Gr.next!==null,nl=0,Ar=Gr=ur=null,Uu=!1,d)throw Error(_(300));return a}function w_(){var a=Vu!==0;return Vu=0,a}function Qs(){var a={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Ar===null?ur.memoizedState=Ar=a:Ar=Ar.next=a,Ar}function qi(){if(Gr===null){var a=ur.alternate;a=a!==null?a.memoizedState:null}else a=Gr.next;var d=Ar===null?ur.memoizedState:Ar.next;if(d!==null)Ar=d,Gr=a;else{if(a===null)throw Error(_(310));Gr=a,a={memoizedState:Gr.memoizedState,baseState:Gr.baseState,baseQueue:Gr.baseQueue,queue:Gr.queue,next:null},Ar===null?ur.memoizedState=Ar=a:Ar=Ar.next=a}return Ar}function rl(a,d){return typeof d=="function"?d(a):d}function b_(a){var d=qi(),m=d.queue;if(m===null)throw Error(_(311));m.lastRenderedReducer=a;var S=Gr,b=S.baseQueue,P=m.pending;if(P!==null){if(b!==null){var Y=b.next;b.next=P.next,P.next=Y}S.baseQueue=b=P,m.pending=null}if(b!==null){P=b.next,S=S.baseState;var ie=Y=null,ue=null,Ae=P;do{var Ke=Ae.lane;if((nl&Ke)===Ke)ue!==null&&(ue=ue.next={lane:0,action:Ae.action,hasEagerState:Ae.hasEagerState,eagerState:Ae.eagerState,next:null}),S=Ae.hasEagerState?Ae.eagerState:a(S,Ae.action);else{var qe={lane:Ke,action:Ae.action,hasEagerState:Ae.hasEagerState,eagerState:Ae.eagerState,next:null};ue===null?(ie=ue=qe,Y=S):ue=ue.next=qe,ur.lanes|=Ke,al|=Ke}Ae=Ae.next}while(Ae!==null&&Ae!==P);ue===null?Y=S:ue.next=ie,Ks(S,d.memoizedState)||(Xi=!0),d.memoizedState=S,d.baseState=Y,d.baseQueue=ue,m.lastRenderedState=S}if(a=m.interleaved,a!==null){b=a;do P=b.lane,ur.lanes|=P,al|=P,b=b.next;while(b!==a)}else b===null&&(m.lanes=0);return[d.memoizedState,m.dispatch]}function I_(a){var d=qi(),m=d.queue;if(m===null)throw Error(_(311));m.lastRenderedReducer=a;var S=m.dispatch,b=m.pending,P=d.memoizedState;if(b!==null){m.pending=null;var Y=b=b.next;do P=a(P,Y.action),Y=Y.next;while(Y!==b);Ks(P,d.memoizedState)||(Xi=!0),d.memoizedState=P,d.baseQueue===null&&(d.baseState=P),m.lastRenderedState=P}return[P,S]}function Kv(){}function zv(a,d){var m=ur,S=qi(),b=d(),P=!Ks(S.memoizedState,b);if(P&&(S.memoizedState=b,Xi=!0),S=S.queue,Ap(qv.bind(null,m,S,a),[a]),S.getSnapshot!==d||P||Ar!==null&&Ar.memoizedState.tag&1){if(m.flags|=2048,da(9,ju.bind(null,m,S,b,d),void 0,null),Hr===null)throw Error(_(349));(nl&30)!==0||Yv(m,d,b)}return b}function Yv(a,d,m){a.flags|=16384,a={getSnapshot:d,value:m},d=ur.updateQueue,d===null?(d={lastEffect:null,stores:null},ur.updateQueue=d,d.stores=[a]):(m=d.stores,m===null?d.stores=[a]:m.push(a))}function ju(a,d,m,S){d.value=m,d.getSnapshot=S,il(d)&&bp(a)}function qv(a,d,m){return m(function(){il(d)&&bp(a)})}function il(a){var d=a.getSnapshot;a=a.value;try{var m=d();return!Ks(a,m)}catch{return!0}}function bp(a){var d=oa(a,1);d!==null&&hs(d,a,1,-1)}function Fu(a){var d=Qs();return typeof a=="function"&&(a=a()),d.memoizedState=d.baseState=a,a={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:rl,lastRenderedState:a},d.queue=a,a=a.dispatch=sl.bind(null,ur,a),[d.memoizedState,a]}function da(a,d,m,S){return a={tag:a,create:d,destroy:m,deps:S,next:null},d=ur.updateQueue,d===null?(d={lastEffect:null,stores:null},ur.updateQueue=d,d.lastEffect=a.next=a):(m=d.lastEffect,m===null?d.lastEffect=a.next=a:(S=m.next,m.next=a,a.next=S,d.lastEffect=a)),a}function Bu(){return qi().memoizedState}function Ip(a,d,m,S){var b=Qs();ur.flags|=a,b.memoizedState=da(1|d,m,void 0,S===void 0?null:S)}function Wu(a,d,m,S){var b=qi();S=S===void 0?null:S;var P=void 0;if(Gr!==null){var Y=Gr.memoizedState;if(P=Y.destroy,S!==null&&C_(S,Y.deps)){b.memoizedState=da(d,m,P,S);return}}ur.flags|=a,b.memoizedState=da(1|d,m,P,S)}function Xv(a,d){return Ip(8390656,8,a,d)}function Ap(a,d){return Wu(2048,8,a,d)}function Jv(a,d){return Wu(4,2,a,d)}function Qv(a,d){return Wu(4,4,a,d)}function Np(a,d){if(typeof d=="function")return a=a(),d(a),function(){d(null)};if(d!=null)return a=a(),d.current=a,function(){d.current=null}}function Op(a,d,m){return m=m!=null?m.concat([a]):null,Wu(4,4,Np.bind(null,d,a),m)}function A_(){}function Zv(a,d){var m=qi();d=d===void 0?null:d;var S=m.memoizedState;return S!==null&&d!==null&&C_(d,S[1])?S[0]:(m.memoizedState=[a,d],a)}function N_(a,d){var m=qi();d=d===void 0?null:d;var S=m.memoizedState;return S!==null&&d!==null&&C_(d,S[1])?S[0]:(a=a(),m.memoizedState=[a,d],a)}function Pp(a,d,m){return(nl&21)===0?(a.baseState&&(a.baseState=!1,Xi=!0),a.memoizedState=m):(Ks(m,d)||(m=rv(),ur.lanes|=m,al|=m,a.baseState=!0),d)}function UC(a,d){var m=Ln;Ln=m!==0&&4>m?m:4,a(!0);var S=R_.transition;R_.transition={};try{a(!1),d()}finally{Ln=m,R_.transition=S}}function Zs(){return qi().memoizedState}function cd(a,d,m){var S=hc(a);if(m={lane:S,action:m,hasEagerState:!1,eagerState:null,next:null},O_(a))P_(d,m);else if(m=E_(a,d,m,S),m!==null){var b=xi();hs(m,a,S,b),oc(m,d,S)}}function sl(a,d,m){var S=hc(a),b={lane:S,action:m,hasEagerState:!1,eagerState:null,next:null};if(O_(a))P_(d,b);else{var P=a.alternate;if(a.lanes===0&&(P===null||P.lanes===0)&&(P=d.lastRenderedReducer,P!==null))try{var Y=d.lastRenderedState,ie=P(Y,m);if(b.hasEagerState=!0,b.eagerState=ie,Ks(ie,Y)){var ue=d.interleaved;ue===null?(b.next=b,__(d)):(b.next=ue.next,ue.next=b),d.interleaved=b;return}}catch{}finally{}m=E_(a,d,b,S),m!==null&&(b=xi(),hs(m,a,S,b),oc(m,d,S))}}function O_(a){var d=a.alternate;return a===ur||d!==null&&d===ur}function P_(a,d){la=Uu=!0;var m=a.pending;m===null?d.next=d:(d.next=m.next,m.next=d),a.pending=d}function oc(a,d,m){if((m&4194240)!==0){var S=d.lanes;S&=a.pendingLanes,m|=S,d.lanes=m,Om(a,m)}}var ld={readContext:ys,useCallback:yi,useContext:yi,useEffect:yi,useImperativeHandle:yi,useInsertionEffect:yi,useLayoutEffect:yi,useMemo:yi,useReducer:yi,useRef:yi,useState:yi,useDebugValue:yi,useDeferredValue:yi,useTransition:yi,useMutableSource:yi,useSyncExternalStore:yi,useId:yi,unstable_isNewReconciler:!1},VC={readContext:ys,useCallback:function(a,d){return Qs().memoizedState=[a,d===void 0?null:d],a},useContext:ys,useEffect:Xv,useImperativeHandle:function(a,d,m){return m=m!=null?m.concat([a]):null,Ip(4194308,4,Np.bind(null,d,a),m)},useLayoutEffect:function(a,d){return Ip(4194308,4,a,d)},useInsertionEffect:function(a,d){return Ip(4,2,a,d)},useMemo:function(a,d){var m=Qs();return d=d===void 0?null:d,a=a(),m.memoizedState=[a,d],a},useReducer:function(a,d,m){var S=Qs();return d=m!==void 0?m(d):d,S.memoizedState=S.baseState=d,a={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:a,lastRenderedState:d},S.queue=a,a=a.dispatch=cd.bind(null,ur,a),[S.memoizedState,a]},useRef:function(a){var d=Qs();return a={current:a},d.memoizedState=a},useState:Fu,useDebugValue:A_,useDeferredValue:function(a){return Qs().memoizedState=a},useTransition:function(){var a=Fu(!1),d=a[0];return a=UC.bind(null,a[1]),Qs().memoizedState=a,[d,a]},useMutableSource:function(){},useSyncExternalStore:function(a,d,m){var S=ur,b=Qs();if(or){if(m===void 0)throw Error(_(407));m=m()}else{if(m=d(),Hr===null)throw Error(_(349));(nl&30)!==0||Yv(S,d,m)}b.memoizedState=m;var P={value:m,getSnapshot:d};return b.queue=P,Xv(qv.bind(null,S,P,a),[a]),S.flags|=2048,da(9,ju.bind(null,S,P,m,d),void 0,null),m},useId:function(){var a=Qs(),d=Hr.identifierPrefix;if(or){var m=sa,S=ia;m=(S&~(1<<32-Hs(S)-1)).toString(32)+m,d=":"+d+"R"+m,m=Vu++,0<m&&(d+="H"+m.toString(32)),d+=":"}else m=MC++,d=":"+d+"r"+m.toString(32)+":";return a.memoizedState=d},unstable_isNewReconciler:!1},$v={readContext:ys,useCallback:Zv,useContext:ys,useEffect:Ap,useImperativeHandle:Op,useInsertionEffect:Jv,useLayoutEffect:Qv,useMemo:N_,useReducer:b_,useRef:Bu,useState:function(){return b_(rl)},useDebugValue:A_,useDeferredValue:function(a){var d=qi();return Pp(d,Gr.memoizedState,a)},useTransition:function(){var a=b_(rl)[0],d=qi().memoizedState;return[a,d]},useMutableSource:Kv,useSyncExternalStore:zv,useId:Zs,unstable_isNewReconciler:!1},jC={readContext:ys,useCallback:Zv,useContext:ys,useEffect:Ap,useImperativeHandle:Op,useInsertionEffect:Jv,useLayoutEffect:Qv,useMemo:N_,useReducer:I_,useRef:Bu,useState:function(){return I_(rl)},useDebugValue:A_,useDeferredValue:function(a){var d=qi();return Gr===null?d.memoizedState=a:Pp(d,Gr.memoizedState,a)},useTransition:function(){var a=I_(rl)[0],d=qi().memoizedState;return[a,d]},useMutableSource:Kv,useSyncExternalStore:zv,useId:Zs,unstable_isNewReconciler:!1};function Ss(a,d){if(a&&a.defaultProps){d=ze({},d),a=a.defaultProps;for(var m in a)d[m]===void 0&&(d[m]=a[m]);return d}return d}function Dp(a,d,m,S){d=a.memoizedState,m=m(S,d),m=m==null?d:ze({},d,m),a.memoizedState=m,a.lanes===0&&(a.updateQueue.baseState=m)}var kp={isMounted:function(a){return(a=a._reactInternals)?Kc(a)===a:!1},enqueueSetState:function(a,d,m){a=a._reactInternals;var S=xi(),b=hc(a),P=ca(S,b);P.payload=d,m!=null&&(P.callback=m),d=Js(a,P,b),d!==null&&(hs(d,a,b,S),Rp(d,a,b))},enqueueReplaceState:function(a,d,m){a=a._reactInternals;var S=xi(),b=hc(a),P=ca(S,b);P.tag=1,P.payload=d,m!=null&&(P.callback=m),d=Js(a,P,b),d!==null&&(hs(d,a,b,S),Rp(d,a,b))},enqueueForceUpdate:function(a,d){a=a._reactInternals;var m=xi(),S=hc(a),b=ca(m,S);b.tag=2,d!=null&&(b.callback=d),d=Js(a,b,S),d!==null&&(hs(d,a,S,m),Rp(d,a,S))}};function ua(a,d,m,S,b,P,Y){return a=a.stateNode,typeof a.shouldComponentUpdate=="function"?a.shouldComponentUpdate(S,P,Y):d.prototype&&d.prototype.isPureReactComponent?!Yl(m,S)||!Yl(b,P):!0}function ey(a,d,m){var S=!1,b=ec,P=d.contextType;return typeof P=="object"&&P!==null?P=ys(P):(b=Yi(d)?tc:vi.current,S=d.contextTypes,P=(S=S!=null)?nc(a,b):ec),d=new d(m,P),a.memoizedState=d.state!==null&&d.state!==void 0?d.state:null,d.updater=kp,a.stateNode=d,d._reactInternals=a,S&&(a=a.stateNode,a.__reactInternalMemoizedUnmaskedChildContext=b,a.__reactInternalMemoizedMaskedChildContext=P),d}function ty(a,d,m,S){a=d.state,typeof d.componentWillReceiveProps=="function"&&d.componentWillReceiveProps(m,S),typeof d.UNSAFE_componentWillReceiveProps=="function"&&d.UNSAFE_componentWillReceiveProps(m,S),d.state!==a&&kp.enqueueReplaceState(d,d.state,null)}function D_(a,d,m,S){var b=a.stateNode;b.props=m,b.state=a.memoizedState,b.refs={},g_(a);var P=d.contextType;typeof P=="object"&&P!==null?b.context=ys(P):(P=Yi(d)?tc:vi.current,b.context=nc(a,P)),b.state=a.memoizedState,P=d.getDerivedStateFromProps,typeof P=="function"&&(Dp(a,d,P,m),b.state=a.memoizedState),typeof d.getDerivedStateFromProps=="function"||typeof b.getSnapshotBeforeUpdate=="function"||typeof b.UNSAFE_componentWillMount!="function"&&typeof b.componentWillMount!="function"||(d=b.state,typeof b.componentWillMount=="function"&&b.componentWillMount(),typeof b.UNSAFE_componentWillMount=="function"&&b.UNSAFE_componentWillMount(),d!==b.state&&kp.enqueueReplaceState(b,b.state,null),Cp(a,m,b,S),b.state=a.memoizedState),typeof b.componentDidMount=="function"&&(a.flags|=4194308)}function dd(a,d){try{var m="",S=d;do m+=Ot(S),S=S.return;while(S);var b=m}catch(P){b=`
Error generating stack: `+P.message+`
`+P.stack}return{value:a,source:d,stack:b,digest:null}}function Lp(a,d,m){return{value:a,source:null,stack:m??null,digest:d??null}}function k_(a,d){try{console.error(d.value)}catch(m){setTimeout(function(){throw m})}}var L_=typeof WeakMap=="function"?WeakMap:Map;function x_(a,d,m){m=ca(-1,m),m.tag=3,m.payload={element:null};var S=d.value;return m.callback=function(){Ti||(Ti=!0,eE=S),k_(a,d)},m}function ny(a,d,m){m=ca(-1,m),m.tag=3;var S=a.type.getDerivedStateFromError;if(typeof S=="function"){var b=d.value;m.payload=function(){return S(b)},m.callback=function(){k_(a,d)}}var P=a.stateNode;return P!==null&&typeof P.componentDidCatch=="function"&&(m.callback=function(){k_(a,d),typeof S!="function"&&(dc===null?dc=new Set([this]):dc.add(this));var Y=d.stack;this.componentDidCatch(d.value,{componentStack:Y!==null?Y:""})}),m}function M_(a,d,m){var S=a.pingCache;if(S===null){S=a.pingCache=new L_;var b=new Set;S.set(d,b)}else b=S.get(d),b===void 0&&(b=new Set,S.set(d,b));b.has(m)||(b.add(m),a=yy.bind(null,a,d,m),d.then(a,a))}function ry(a){do{var d;if((d=a.tag===13)&&(d=a.memoizedState,d=d!==null?d.dehydrated!==null:!0),d)return a;a=a.return}while(a!==null);return null}function iy(a,d,m,S,b){return(a.mode&1)===0?(a===d?a.flags|=65536:(a.flags|=128,m.flags|=131072,m.flags&=-52805,m.tag===1&&(m.alternate===null?m.tag=17:(d=ca(-1,1),d.tag=2,Js(m,d,1))),m.lanes|=1),a):(a.flags|=65536,a.lanes=b,a)}var FC=Se.ReactCurrentOwner,Xi=!1;function Li(a,d,m,S){d.child=a===null?h_(d,null,m,S):sd(d,a.child,m,S)}function sy(a,d,m,S,b){m=m.render;var P=d.ref;return Xs(d,b),S=ad(a,d,m,S,P,b),m=w_(),a!==null&&!Xi?(d.updateQueue=a.updateQueue,d.flags&=-2053,a.lanes&=~b,ha(a,d,b)):(or&&m&&nd(d),d.flags|=1,Li(a,d,S,b),d.child)}function oy(a,d,m,S,b){if(a===null){var P=m.type;return typeof P=="function"&&!dE(P)&&P.defaultProps===void 0&&m.compare===null&&m.defaultProps===void 0?(d.tag=15,d.type=P,U_(a,d,P,S,b)):(a=_d(m.type,null,S,d,d.mode,b),a.ref=d.ref,a.return=d,d.child=a)}if(P=a.child,(a.lanes&b)===0){var Y=P.memoizedProps;if(m=m.compare,m=m!==null?m:Yl,m(Y,S)&&a.ref===d.ref)return ha(a,d,b)}return d.flags|=1,a=_c(P,S),a.ref=d.ref,a.return=d,d.child=a}function U_(a,d,m,S,b){if(a!==null){var P=a.memoizedProps;if(Yl(P,S)&&a.ref===d.ref)if(Xi=!1,d.pendingProps=S=P,(a.lanes&b)!==0)(a.flags&131072)!==0&&(Xi=!0);else return d.lanes=a.lanes,ha(a,d,b)}return V_(a,d,m,S,b)}function Io(a,d,m){var S=d.pendingProps,b=S.children,P=a!==null?a.memoizedState:null;if(S.mode==="hidden")if((d.mode&1)===0)d.memoizedState={baseLanes:0,cachePool:null,transitions:null},nr(ud,us),us|=m;else{if((m&1073741824)===0)return a=P!==null?P.baseLanes|m:m,d.lanes=d.childLanes=1073741824,d.memoizedState={baseLanes:a,cachePool:null,transitions:null},d.updateQueue=null,nr(ud,us),us|=a,null;d.memoizedState={baseLanes:0,cachePool:null,transitions:null},S=P!==null?P.baseLanes:m,nr(ud,us),us|=S}else P!==null?(S=P.baseLanes|m,d.memoizedState=null):S=m,nr(ud,us),us|=S;return Li(a,d,b,m),d.child}function ay(a,d){var m=d.ref;(a===null&&m!==null||a!==null&&a.ref!==m)&&(d.flags|=512,d.flags|=2097152)}function V_(a,d,m,S,b){var P=Yi(m)?tc:vi.current;return P=nc(d,P),Xs(d,b),m=ad(a,d,m,S,P,b),S=w_(),a!==null&&!Xi?(d.updateQueue=a.updateQueue,d.flags&=-2053,a.lanes&=~b,ha(a,d,b)):(or&&S&&nd(d),d.flags|=1,Li(a,d,m,b),d.child)}function cy(a,d,m,S,b){if(Yi(m)){var P=!0;fp(d)}else P=!1;if(Xs(d,b),d.stateNode===null)Up(a,d),ey(d,m,S),D_(d,m,S,b),S=!0;else if(a===null){var Y=d.stateNode,ie=d.memoizedProps;Y.props=ie;var ue=Y.context,Ae=m.contextType;typeof Ae=="object"&&Ae!==null?Ae=ys(Ae):(Ae=Yi(m)?tc:vi.current,Ae=nc(d,Ae));var Ke=m.getDerivedStateFromProps,qe=typeof Ke=="function"||typeof Y.getSnapshotBeforeUpdate=="function";qe||typeof Y.UNSAFE_componentWillReceiveProps!="function"&&typeof Y.componentWillReceiveProps!="function"||(ie!==S||ue!==Ae)&&ty(d,Y,S,Ae),aa=!1;var He=d.memoizedState;Y.state=He,Cp(d,S,Y,b),ue=d.memoizedState,ie!==S||He!==ue||Di.current||aa?(typeof Ke=="function"&&(Dp(d,m,Ke,S),ue=d.memoizedState),(ie=aa||ua(d,m,ie,S,He,ue,Ae))?(qe||typeof Y.UNSAFE_componentWillMount!="function"&&typeof Y.componentWillMount!="function"||(typeof Y.componentWillMount=="function"&&Y.componentWillMount(),typeof Y.UNSAFE_componentWillMount=="function"&&Y.UNSAFE_componentWillMount()),typeof Y.componentDidMount=="function"&&(d.flags|=4194308)):(typeof Y.componentDidMount=="function"&&(d.flags|=4194308),d.memoizedProps=S,d.memoizedState=ue),Y.props=S,Y.state=ue,Y.context=Ae,S=ie):(typeof Y.componentDidMount=="function"&&(d.flags|=4194308),S=!1)}else{Y=d.stateNode,Bv(a,d),ie=d.memoizedProps,Ae=d.type===d.elementType?ie:Ss(d.type,ie),Y.props=Ae,qe=d.pendingProps,He=Y.context,ue=m.contextType,typeof ue=="object"&&ue!==null?ue=ys(ue):(ue=Yi(m)?tc:vi.current,ue=nc(d,ue));var ft=m.getDerivedStateFromProps;(Ke=typeof ft=="function"||typeof Y.getSnapshotBeforeUpdate=="function")||typeof Y.UNSAFE_componentWillReceiveProps!="function"&&typeof Y.componentWillReceiveProps!="function"||(ie!==qe||He!==ue)&&ty(d,Y,S,ue),aa=!1,He=d.memoizedState,Y.state=He,Cp(d,S,Y,b);var yt=d.memoizedState;ie!==qe||He!==yt||Di.current||aa?(typeof ft=="function"&&(Dp(d,m,ft,S),yt=d.memoizedState),(Ae=aa||ua(d,m,Ae,S,He,yt,ue)||!1)?(Ke||typeof Y.UNSAFE_componentWillUpdate!="function"&&typeof Y.componentWillUpdate!="function"||(typeof Y.componentWillUpdate=="function"&&Y.componentWillUpdate(S,yt,ue),typeof Y.UNSAFE_componentWillUpdate=="function"&&Y.UNSAFE_componentWillUpdate(S,yt,ue)),typeof Y.componentDidUpdate=="function"&&(d.flags|=4),typeof Y.getSnapshotBeforeUpdate=="function"&&(d.flags|=1024)):(typeof Y.componentDidUpdate!="function"||ie===a.memoizedProps&&He===a.memoizedState||(d.flags|=4),typeof Y.getSnapshotBeforeUpdate!="function"||ie===a.memoizedProps&&He===a.memoizedState||(d.flags|=1024),d.memoizedProps=S,d.memoizedState=yt),Y.props=S,Y.state=yt,Y.context=ue,S=Ae):(typeof Y.componentDidUpdate!="function"||ie===a.memoizedProps&&He===a.memoizedState||(d.flags|=4),typeof Y.getSnapshotBeforeUpdate!="function"||ie===a.memoizedProps&&He===a.memoizedState||(d.flags|=1024),S=!1)}return j_(a,d,m,S,P,b)}function j_(a,d,m,S,b,P){ay(a,d);var Y=(d.flags&128)!==0;if(!S&&!Y)return b&&Mv(d,m,!1),ha(a,d,P);S=d.stateNode,FC.current=d;var ie=Y&&typeof m.getDerivedStateFromError!="function"?null:S.render();return d.flags|=1,a!==null&&Y?(d.child=sd(d,a.child,null,P),d.child=sd(d,null,ie,P)):Li(a,d,ie,P),d.memoizedState=S.state,b&&Mv(d,m,!0),d.child}function ly(a){var d=a.stateNode;d.pendingContext?ed(a,d.pendingContext,d.pendingContext!==d.context):d.context&&ed(a,d.context,!1),v_(a,d.containerInfo)}function dy(a,d,m,S,b){return Zc(),id(b),d.flags|=256,Li(a,d,m,S),d.child}var Gu={dehydrated:null,treeContext:null,retryLane:0};function F_(a){return{baseLanes:a,cachePool:null,transitions:null}}function uy(a,d,m){var S=d.pendingProps,b=fr.current,P=!1,Y=(d.flags&128)!==0,ie;if((ie=Y)||(ie=a!==null&&a.memoizedState===null?!1:(b&2)!==0),ie?(P=!0,d.flags&=-129):(a===null||a.memoizedState!==null)&&(b|=1),nr(fr,b&1),a===null)return Pu(d),a=d.memoizedState,a!==null&&(a=a.dehydrated,a!==null)?((d.mode&1)===0?d.lanes=1:a.data==="$!"?d.lanes=8:d.lanes=1073741824,null):(Y=S.children,a=S.fallback,P?(S=d.mode,P=d.child,Y={mode:"hidden",children:Y},(S&1)===0&&P!==null?(P.childLanes=0,P.pendingProps=Y):P=eh(Y,S,0,null),a=Ec(a,S,m,null),P.return=d,a.return=d,P.sibling=a,d.child=P,d.child.memoizedState=F_(m),d.memoizedState=Gu,a):B_(d,Y));if(b=a.memoizedState,b!==null&&(ie=b.dehydrated,ie!==null))return BC(a,d,Y,S,ie,b,m);if(P){P=S.fallback,Y=d.mode,b=a.child,ie=b.sibling;var ue={mode:"hidden",children:S.children};return(Y&1)===0&&d.child!==b?(S=d.child,S.childLanes=0,S.pendingProps=ue,d.deletions=null):(S=_c(b,ue),S.subtreeFlags=b.subtreeFlags&14680064),ie!==null?P=_c(ie,P):(P=Ec(P,Y,m,null),P.flags|=2),P.return=d,S.return=d,S.sibling=P,d.child=S,S=P,P=d.child,Y=a.child.memoizedState,Y=Y===null?F_(m):{baseLanes:Y.baseLanes|m,cachePool:null,transitions:Y.transitions},P.memoizedState=Y,P.childLanes=a.childLanes&~m,d.memoizedState=Gu,S}return P=a.child,a=P.sibling,S=_c(P,{mode:"visible",children:S.children}),(d.mode&1)===0&&(S.lanes=m),S.return=d,S.sibling=null,a!==null&&(m=d.deletions,m===null?(d.deletions=[a],d.flags|=16):m.push(a)),d.child=S,d.memoizedState=null,S}function B_(a,d){return d=eh({mode:"visible",children:d},a.mode,0,null),d.return=a,a.child=d}function xp(a,d,m,S){return S!==null&&id(S),sd(d,a.child,null,m),a=B_(d,d.pendingProps.children),a.flags|=2,d.memoizedState=null,a}function BC(a,d,m,S,b,P,Y){if(m)return d.flags&256?(d.flags&=-257,S=Lp(Error(_(422))),xp(a,d,Y,S)):d.memoizedState!==null?(d.child=a.child,d.flags|=128,null):(P=S.fallback,b=d.mode,S=eh({mode:"visible",children:S.children},b,0,null),P=Ec(P,b,Y,null),P.flags|=2,S.return=d,P.return=d,S.sibling=P,d.child=S,(d.mode&1)!==0&&sd(d,a.child,null,Y),d.child.memoizedState=F_(Y),d.memoizedState=Gu,P);if((d.mode&1)===0)return xp(a,d,Y,null);if(b.data==="$!"){if(S=b.nextSibling&&b.nextSibling.dataset,S)var ie=S.dgst;return S=ie,P=Error(_(419)),S=Lp(P,S,void 0),xp(a,d,Y,S)}if(ie=(Y&a.childLanes)!==0,Xi||ie){if(S=Hr,S!==null){switch(Y&-Y){case 4:b=2;break;case 16:b=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:b=32;break;case 536870912:b=268435456;break;default:b=0}b=(b&(S.suspendedLanes|Y))!==0?0:b,b!==0&&b!==P.retryLane&&(P.retryLane=b,oa(a,b),hs(S,a,b,-1))}return fd(),S=Lp(Error(_(421))),xp(a,d,Y,S)}return b.data==="$?"?(d.flags|=128,d.child=a.child,d=XC.bind(null,a),b._reactRetry=d,null):(a=P.treeContext,ls=Co(b.nextSibling),cs=d,or=!0,qs=null,a!==null&&(ki[vs++]=ia,ki[vs++]=sa,ki[vs++]=Jc,ia=a.id,sa=a.overflow,Jc=d),d=B_(d,S.children),d.flags|=4096,d)}function hy(a,d,m){a.lanes|=d;var S=a.alternate;S!==null&&(S.lanes|=d),Tp(a.return,d,m)}function Mp(a,d,m,S,b){var P=a.memoizedState;P===null?a.memoizedState={isBackwards:d,rendering:null,renderingStartTime:0,last:S,tail:m,tailMode:b}:(P.isBackwards=d,P.rendering=null,P.renderingStartTime=0,P.last=S,P.tail=m,P.tailMode=b)}function W_(a,d,m){var S=d.pendingProps,b=S.revealOrder,P=S.tail;if(Li(a,d,S.children,m),S=fr.current,(S&2)!==0)S=S&1|2,d.flags|=128;else{if(a!==null&&(a.flags&128)!==0)e:for(a=d.child;a!==null;){if(a.tag===13)a.memoizedState!==null&&hy(a,m,d);else if(a.tag===19)hy(a,m,d);else if(a.child!==null){a.child.return=a,a=a.child;continue}if(a===d)break e;for(;a.sibling===null;){if(a.return===null||a.return===d)break e;a=a.return}a.sibling.return=a.return,a=a.sibling}S&=1}if(nr(fr,S),(d.mode&1)===0)d.memoizedState=null;else switch(b){case"forwards":for(m=d.child,b=null;m!==null;)a=m.alternate,a!==null&&wp(a)===null&&(b=m),m=m.sibling;m=b,m===null?(b=d.child,d.child=null):(b=m.sibling,m.sibling=null),Mp(d,!1,b,m,P);break;case"backwards":for(m=null,b=d.child,d.child=null;b!==null;){if(a=b.alternate,a!==null&&wp(a)===null){d.child=b;break}a=b.sibling,b.sibling=m,m=b,b=a}Mp(d,!0,m,null,P);break;case"together":Mp(d,!1,null,null,void 0);break;default:d.memoizedState=null}return d.child}function Up(a,d){(d.mode&1)===0&&a!==null&&(a.alternate=null,d.alternate=null,d.flags|=2)}function ha(a,d,m){if(a!==null&&(d.dependencies=a.dependencies),al|=d.lanes,(m&d.childLanes)===0)return null;if(a!==null&&d.child!==a.child)throw Error(_(153));if(d.child!==null){for(a=d.child,m=_c(a,a.pendingProps),d.child=m,m.return=d;a.sibling!==null;)a=a.sibling,m=m.sibling=_c(a,a.pendingProps),m.return=d;m.sibling=null}return d.child}function Vp(a,d,m){switch(d.tag){case 3:ly(d),Zc();break;case 5:Hv(d);break;case 1:Yi(d.type)&&fp(d);break;case 4:v_(d,d.stateNode.containerInfo);break;case 10:var S=d.type._context,b=d.memoizedProps.value;nr(yp,S._currentValue),S._currentValue=b;break;case 13:if(S=d.memoizedState,S!==null)return S.dehydrated!==null?(nr(fr,fr.current&1),d.flags|=128,null):(m&d.child.childLanes)!==0?uy(a,d,m):(nr(fr,fr.current&1),a=ha(a,d,m),a!==null?a.sibling:null);nr(fr,fr.current&1);break;case 19:if(S=(m&d.childLanes)!==0,(a.flags&128)!==0){if(S)return W_(a,d,m);d.flags|=128}if(b=d.memoizedState,b!==null&&(b.rendering=null,b.tail=null,b.lastEffect=null),nr(fr,fr.current),S)break;return null;case 22:case 23:return d.lanes=0,Io(a,d,m)}return ha(a,d,m)}var jp,Fp,Hu,G_;jp=function(a,d){for(var m=d.child;m!==null;){if(m.tag===5||m.tag===6)a.appendChild(m.stateNode);else if(m.tag!==4&&m.child!==null){m.child.return=m,m=m.child;continue}if(m===d)break;for(;m.sibling===null;){if(m.return===null||m.return===d)return;m=m.return}m.sibling.return=m.return,m=m.sibling}},Fp=function(){},Hu=function(a,d,m,S){var b=a.memoizedProps;if(b!==S){a=d.stateNode,sc(bo.current);var P=null;switch(m){case"input":b=is(a,b),S=is(a,S),P=[];break;case"select":b=ze({},b,{value:void 0}),S=ze({},S,{value:void 0}),P=[];break;case"textarea":b=Dl(a,b),S=Dl(a,S),P=[];break;default:typeof b.onClick!="function"&&typeof S.onClick=="function"&&(a.onclick=Iu)}go(m,S);var Y;m=null;for(Ae in b)if(!S.hasOwnProperty(Ae)&&b.hasOwnProperty(Ae)&&b[Ae]!=null)if(Ae==="style"){var ie=b[Ae];for(Y in ie)ie.hasOwnProperty(Y)&&(m||(m={}),m[Y]="")}else Ae!=="dangerouslySetInnerHTML"&&Ae!=="children"&&Ae!=="suppressContentEditableWarning"&&Ae!=="suppressHydrationWarning"&&Ae!=="autoFocus"&&(C.hasOwnProperty(Ae)?P||(P=[]):(P=P||[]).push(Ae,null));for(Ae in S){var ue=S[Ae];if(ie=b?.[Ae],S.hasOwnProperty(Ae)&&ue!==ie&&(ue!=null||ie!=null))if(Ae==="style")if(ie){for(Y in ie)!ie.hasOwnProperty(Y)||ue&&ue.hasOwnProperty(Y)||(m||(m={}),m[Y]="");for(Y in ue)ue.hasOwnProperty(Y)&&ie[Y]!==ue[Y]&&(m||(m={}),m[Y]=ue[Y])}else m||(P||(P=[]),P.push(Ae,m)),m=ue;else Ae==="dangerouslySetInnerHTML"?(ue=ue?ue.__html:void 0,ie=ie?ie.__html:void 0,ue!=null&&ie!==ue&&(P=P||[]).push(Ae,ue)):Ae==="children"?typeof ue!="string"&&typeof ue!="number"||(P=P||[]).push(Ae,""+ue):Ae!=="suppressContentEditableWarning"&&Ae!=="suppressHydrationWarning"&&(C.hasOwnProperty(Ae)?(ue!=null&&Ae==="onScroll"&&tr("scroll",a),P||ie===ue||(P=[])):(P=P||[]).push(Ae,ue))}m&&(P=P||[]).push("style",m);var Ae=P;(d.updateQueue=Ae)&&(d.flags|=4)}},G_=function(a,d,m,S){m!==S&&(d.flags|=4)};function Ku(a,d){if(!or)switch(a.tailMode){case"hidden":d=a.tail;for(var m=null;d!==null;)d.alternate!==null&&(m=d),d=d.sibling;m===null?a.tail=null:m.sibling=null;break;case"collapsed":m=a.tail;for(var S=null;m!==null;)m.alternate!==null&&(S=m),m=m.sibling;S===null?d||a.tail===null?a.tail=null:a.tail.sibling=null:S.sibling=null}}function di(a){var d=a.alternate!==null&&a.alternate.child===a.child,m=0,S=0;if(d)for(var b=a.child;b!==null;)m|=b.lanes|b.childLanes,S|=b.subtreeFlags&14680064,S|=b.flags&14680064,b.return=a,b=b.sibling;else for(b=a.child;b!==null;)m|=b.lanes|b.childLanes,S|=b.subtreeFlags,S|=b.flags,b.return=a,b=b.sibling;return a.subtreeFlags|=S,a.childLanes=m,d}function Bp(a,d,m){var S=d.pendingProps;switch(gp(d),d.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return di(d),null;case 1:return Yi(d.type)&&pp(),di(d),null;case 3:return S=d.stateNode,tl(),Jn(Di),Jn(vi),T_(),S.pendingContext&&(S.context=S.pendingContext,S.pendingContext=null),(a===null||a.child===null)&&(rd(d)?d.flags|=4:a===null||a.memoizedState.isDehydrated&&(d.flags&256)===0||(d.flags|=1024,qs!==null&&(nE(qs),qs=null))),Fp(a,d),di(d),null;case 5:y_(d);var b=sc(xu.current);if(m=d.type,a!==null&&d.stateNode!=null)Hu(a,d,m,S,b),a.ref!==d.ref&&(d.flags|=512,d.flags|=2097152);else{if(!S){if(d.stateNode===null)throw Error(_(166));return di(d),null}if(a=sc(bo.current),rd(d)){S=d.stateNode,m=d.type;var P=d.memoizedProps;switch(S[wo]=d,S[Au]=P,a=(d.mode&1)!==0,m){case"dialog":tr("cancel",S),tr("close",S);break;case"iframe":case"object":case"embed":tr("load",S);break;case"video":case"audio":for(b=0;b<Ru.length;b++)tr(Ru[b],S);break;case"source":tr("error",S);break;case"img":case"image":case"link":tr("error",S),tr("load",S);break;case"details":tr("toggle",S);break;case"input":Fa(S,P),tr("invalid",S);break;case"select":S._wrapperState={wasMultiple:!!P.multiple},tr("invalid",S);break;case"textarea":Fs(S,P),tr("invalid",S)}go(m,P),b=null;for(var Y in P)if(P.hasOwnProperty(Y)){var ie=P[Y];Y==="children"?typeof ie=="string"?S.textContent!==ie&&(P.suppressHydrationWarning!==!0&&bu(S.textContent,ie,a),b=["children",ie]):typeof ie=="number"&&S.textContent!==""+ie&&(P.suppressHydrationWarning!==!0&&bu(S.textContent,ie,a),b=["children",""+ie]):C.hasOwnProperty(Y)&&ie!=null&&Y==="onScroll"&&tr("scroll",S)}switch(m){case"input":Rn(S),Sr(S,P,!0);break;case"textarea":Rn(S),iu(S);break;case"select":case"option":break;default:typeof P.onClick=="function"&&(S.onclick=Iu)}S=b,d.updateQueue=S,S!==null&&(d.flags|=4)}else{Y=b.nodeType===9?b:b.ownerDocument,a==="http://www.w3.org/1999/xhtml"&&(a=gi(m)),a==="http://www.w3.org/1999/xhtml"?m==="script"?(a=Y.createElement("div"),a.innerHTML="<script><\/script>",a=a.removeChild(a.firstChild)):typeof S.is=="string"?a=Y.createElement(m,{is:S.is}):(a=Y.createElement(m),m==="select"&&(Y=a,S.multiple?Y.multiple=!0:S.size&&(Y.size=S.size))):a=Y.createElementNS(a,m),a[wo]=d,a[Au]=S,jp(a,d,!1,!1),d.stateNode=a;e:{switch(Y=au(m,S),m){case"dialog":tr("cancel",a),tr("close",a),b=S;break;case"iframe":case"object":case"embed":tr("load",a),b=S;break;case"video":case"audio":for(b=0;b<Ru.length;b++)tr(Ru[b],a);b=S;break;case"source":tr("error",a),b=S;break;case"img":case"image":case"link":tr("error",a),tr("load",a),b=S;break;case"details":tr("toggle",a),b=S;break;case"input":Fa(a,S),b=is(a,S),tr("invalid",a);break;case"option":b=S;break;case"select":a._wrapperState={wasMultiple:!!S.multiple},b=ze({},S,{value:void 0}),tr("invalid",a);break;case"textarea":Fs(a,S),b=Dl(a,S),tr("invalid",a);break;default:b=S}go(m,b),ie=b;for(P in ie)if(ie.hasOwnProperty(P)){var ue=ie[P];P==="style"?Oi(a,ue):P==="dangerouslySetInnerHTML"?(ue=ue?ue.__html:void 0,ue!=null&&kl(a,ue)):P==="children"?typeof ue=="string"?(m!=="textarea"||ue!=="")&&Bs(a,ue):typeof ue=="number"&&Bs(a,""+ue):P!=="suppressContentEditableWarning"&&P!=="suppressHydrationWarning"&&P!=="autoFocus"&&(C.hasOwnProperty(P)?ue!=null&&P==="onScroll"&&tr("scroll",a):ue!=null&&le(a,P,ue,Y))}switch(m){case"input":Rn(a),Sr(a,S,!1);break;case"textarea":Rn(a),iu(a);break;case"option":S.value!=null&&a.setAttribute("value",""+At(S.value));break;case"select":a.multiple=!!S.multiple,P=S.value,P!=null?Wi(a,!!S.multiple,P,!1):S.defaultValue!=null&&Wi(a,!!S.multiple,S.defaultValue,!0);break;default:typeof b.onClick=="function"&&(a.onclick=Iu)}switch(m){case"button":case"input":case"select":case"textarea":S=!!S.autoFocus;break e;case"img":S=!0;break e;default:S=!1}}S&&(d.flags|=4)}d.ref!==null&&(d.flags|=512,d.flags|=2097152)}return di(d),null;case 6:if(a&&d.stateNode!=null)G_(a,d,a.memoizedProps,S);else{if(typeof S!="string"&&d.stateNode===null)throw Error(_(166));if(m=sc(xu.current),sc(bo.current),rd(d)){if(S=d.stateNode,m=d.memoizedProps,S[wo]=d,(P=S.nodeValue!==m)&&(a=cs,a!==null))switch(a.tag){case 3:bu(S.nodeValue,m,(a.mode&1)!==0);break;case 5:a.memoizedProps.suppressHydrationWarning!==!0&&bu(S.nodeValue,m,(a.mode&1)!==0)}P&&(d.flags|=4)}else S=(m.nodeType===9?m:m.ownerDocument).createTextNode(S),S[wo]=d,d.stateNode=S}return di(d),null;case 13:if(Jn(fr),S=d.memoizedState,a===null||a.memoizedState!==null&&a.memoizedState.dehydrated!==null){if(or&&ls!==null&&(d.mode&1)!==0&&(d.flags&128)===0)d_(),Zc(),d.flags|=98560,P=!1;else if(P=rd(d),S!==null&&S.dehydrated!==null){if(a===null){if(!P)throw Error(_(318));if(P=d.memoizedState,P=P!==null?P.dehydrated:null,!P)throw Error(_(317));P[wo]=d}else Zc(),(d.flags&128)===0&&(d.memoizedState=null),d.flags|=4;di(d),P=!1}else qs!==null&&(nE(qs),qs=null),P=!0;if(!P)return d.flags&65536?d:null}return(d.flags&128)!==0?(d.lanes=m,d):(S=S!==null,S!==(a!==null&&a.memoizedState!==null)&&S&&(d.child.flags|=8192,(d.mode&1)!==0&&(a===null||(fr.current&1)!==0?Kr===0&&(Kr=3):fd())),d.updateQueue!==null&&(d.flags|=4),di(d),null);case 4:return tl(),Fp(a,d),a===null&&ea(d.stateNode.containerInfo),di(d),null;case 10:return m_(d.type._context),di(d),null;case 17:return Yi(d.type)&&pp(),di(d),null;case 19:if(Jn(fr),P=d.memoizedState,P===null)return di(d),null;if(S=(d.flags&128)!==0,Y=P.rendering,Y===null)if(S)Ku(P,!1);else{if(Kr!==0||a!==null&&(a.flags&128)!==0)for(a=d.child;a!==null;){if(Y=wp(a),Y!==null){for(d.flags|=128,Ku(P,!1),S=Y.updateQueue,S!==null&&(d.updateQueue=S,d.flags|=4),d.subtreeFlags=0,S=m,m=d.child;m!==null;)P=m,a=S,P.flags&=14680066,Y=P.alternate,Y===null?(P.childLanes=0,P.lanes=a,P.child=null,P.subtreeFlags=0,P.memoizedProps=null,P.memoizedState=null,P.updateQueue=null,P.dependencies=null,P.stateNode=null):(P.childLanes=Y.childLanes,P.lanes=Y.lanes,P.child=Y.child,P.subtreeFlags=0,P.deletions=null,P.memoizedProps=Y.memoizedProps,P.memoizedState=Y.memoizedState,P.updateQueue=Y.updateQueue,P.type=Y.type,a=Y.dependencies,P.dependencies=a===null?null:{lanes:a.lanes,firstContext:a.firstContext}),m=m.sibling;return nr(fr,fr.current&1|2),d.child}a=a.sibling}P.tail!==null&&Ir()>Ts&&(d.flags|=128,S=!0,Ku(P,!1),d.lanes=4194304)}else{if(!S)if(a=wp(Y),a!==null){if(d.flags|=128,S=!0,m=a.updateQueue,m!==null&&(d.updateQueue=m,d.flags|=4),Ku(P,!0),P.tail===null&&P.tailMode==="hidden"&&!Y.alternate&&!or)return di(d),null}else 2*Ir()-P.renderingStartTime>Ts&&m!==1073741824&&(d.flags|=128,S=!0,Ku(P,!1),d.lanes=4194304);P.isBackwards?(Y.sibling=d.child,d.child=Y):(m=P.last,m!==null?m.sibling=Y:d.child=Y,P.last=Y)}return P.tail!==null?(d=P.tail,P.rendering=d,P.tail=d.sibling,P.renderingStartTime=Ir(),d.sibling=null,m=fr.current,nr(fr,S?m&1|2:m&1),d):(di(d),null);case 22:case 23:return Zu(),S=d.memoizedState!==null,a!==null&&a.memoizedState!==null!==S&&(d.flags|=8192),S&&(d.mode&1)!==0?(us&1073741824)!==0&&(di(d),d.subtreeFlags&6&&(d.flags|=8192)):di(d),null;case 24:return null;case 25:return null}throw Error(_(156,d.tag))}function WC(a,d){switch(gp(d),d.tag){case 1:return Yi(d.type)&&pp(),a=d.flags,a&65536?(d.flags=a&-65537|128,d):null;case 3:return tl(),Jn(Di),Jn(vi),T_(),a=d.flags,(a&65536)!==0&&(a&128)===0?(d.flags=a&-65537|128,d):null;case 5:return y_(d),null;case 13:if(Jn(fr),a=d.memoizedState,a!==null&&a.dehydrated!==null){if(d.alternate===null)throw Error(_(340));Zc()}return a=d.flags,a&65536?(d.flags=a&-65537|128,d):null;case 19:return Jn(fr),null;case 4:return tl(),null;case 10:return m_(d.type._context),null;case 22:case 23:return Zu(),null;case 24:return null;default:return null}}var zu=!1,ui=!1,GC=typeof WeakSet=="function"?WeakSet:Set,_t=null;function ol(a,d){var m=a.ref;if(m!==null)if(typeof m=="function")try{m(null)}catch(S){mr(a,d,S)}else m.current=null}function H_(a,d,m){try{m()}catch(S){mr(a,d,S)}}var py=!1;function HC(a,d){if(r_=ep,a=Xm(),Jm(a)){if("selectionStart"in a)var m={start:a.selectionStart,end:a.selectionEnd};else e:{m=(m=a.ownerDocument)&&m.defaultView||window;var S=m.getSelection&&m.getSelection();if(S&&S.rangeCount!==0){m=S.anchorNode;var b=S.anchorOffset,P=S.focusNode;S=S.focusOffset;try{m.nodeType,P.nodeType}catch{m=null;break e}var Y=0,ie=-1,ue=-1,Ae=0,Ke=0,qe=a,He=null;t:for(;;){for(var ft;qe!==m||b!==0&&qe.nodeType!==3||(ie=Y+b),qe!==P||S!==0&&qe.nodeType!==3||(ue=Y+S),qe.nodeType===3&&(Y+=qe.nodeValue.length),(ft=qe.firstChild)!==null;)He=qe,qe=ft;for(;;){if(qe===a)break t;if(He===m&&++Ae===b&&(ie=Y),He===P&&++Ke===S&&(ue=Y),(ft=qe.nextSibling)!==null)break;qe=He,He=qe.parentNode}qe=ft}m=ie===-1||ue===-1?null:{start:ie,end:ue}}else m=null}m=m||{start:0,end:0}}else m=null;for(dp={focusedElem:a,selectionRange:m},ep=!1,_t=d;_t!==null;)if(d=_t,a=d.child,(d.subtreeFlags&1028)!==0&&a!==null)a.return=d,_t=a;else for(;_t!==null;){d=_t;try{var yt=d.alternate;if((d.flags&1024)!==0)switch(d.tag){case 0:case 11:case 15:break;case 1:if(yt!==null){var Tt=yt.memoizedProps,_r=yt.memoizedState,ge=d.stateNode,pe=ge.getSnapshotBeforeUpdate(d.elementType===d.type?Tt:Ss(d.type,Tt),_r);ge.__reactInternalSnapshotBeforeUpdate=pe}break;case 3:var Ce=d.stateNode.containerInfo;Ce.nodeType===1?Ce.textContent="":Ce.nodeType===9&&Ce.documentElement&&Ce.removeChild(Ce.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(_(163))}}catch(Qe){mr(d,d.return,Qe)}if(a=d.sibling,a!==null){a.return=d.return,_t=a;break}_t=d.return}return yt=py,py=!1,yt}function ac(a,d,m){var S=d.updateQueue;if(S=S!==null?S.lastEffect:null,S!==null){var b=S=S.next;do{if((b.tag&a)===a){var P=b.destroy;b.destroy=void 0,P!==void 0&&H_(d,m,P)}b=b.next}while(b!==S)}}function Wp(a,d){if(d=d.updateQueue,d=d!==null?d.lastEffect:null,d!==null){var m=d=d.next;do{if((m.tag&a)===a){var S=m.create;m.destroy=S()}m=m.next}while(m!==d)}}function K_(a){var d=a.ref;if(d!==null){var m=a.stateNode;switch(a.tag){case 5:a=m;break;default:a=m}typeof d=="function"?d(a):d.current=a}}function fy(a){var d=a.alternate;d!==null&&(a.alternate=null,fy(d)),a.child=null,a.deletions=null,a.sibling=null,a.tag===5&&(d=a.stateNode,d!==null&&(delete d[wo],delete d[Au],delete d[s_],delete d[kC],delete d[LC])),a.stateNode=null,a.return=null,a.dependencies=null,a.memoizedProps=null,a.memoizedState=null,a.pendingProps=null,a.stateNode=null,a.updateQueue=null}function z_(a){return a.tag===5||a.tag===3||a.tag===4}function my(a){e:for(;;){for(;a.sibling===null;){if(a.return===null||z_(a.return))return null;a=a.return}for(a.sibling.return=a.return,a=a.sibling;a.tag!==5&&a.tag!==6&&a.tag!==18;){if(a.flags&2||a.child===null||a.tag===4)continue e;a.child.return=a,a=a.child}if(!(a.flags&2))return a.stateNode}}function Y_(a,d,m){var S=a.tag;if(S===5||S===6)a=a.stateNode,d?m.nodeType===8?m.parentNode.insertBefore(a,d):m.insertBefore(a,d):(m.nodeType===8?(d=m.parentNode,d.insertBefore(a,m)):(d=m,d.appendChild(a)),m=m._reactRootContainer,m!=null||d.onclick!==null||(d.onclick=Iu));else if(S!==4&&(a=a.child,a!==null))for(Y_(a,d,m),a=a.sibling;a!==null;)Y_(a,d,m),a=a.sibling}function Yu(a,d,m){var S=a.tag;if(S===5||S===6)a=a.stateNode,d?m.insertBefore(a,d):m.appendChild(a);else if(S!==4&&(a=a.child,a!==null))for(Yu(a,d,m),a=a.sibling;a!==null;)Yu(a,d,m),a=a.sibling}var hi=null,ds=!1;function cc(a,d,m){for(m=m.child;m!==null;)q_(a,d,m),m=m.sibling}function q_(a,d,m){if(To&&typeof To.onCommitFiberUnmount=="function")try{To.onCommitFiberUnmount(Ml,m)}catch{}switch(m.tag){case 5:ui||ol(m,d);case 6:var S=hi,b=ds;hi=null,cc(a,d,m),hi=S,ds=b,hi!==null&&(ds?(a=hi,m=m.stateNode,a.nodeType===8?a.parentNode.removeChild(m):a.removeChild(m)):hi.removeChild(m.stateNode));break;case 18:hi!==null&&(ds?(a=hi,m=m.stateNode,a.nodeType===8?up(a.parentNode,m):a.nodeType===1&&up(a,m),Fl(a)):up(hi,m.stateNode));break;case 4:S=hi,b=ds,hi=m.stateNode.containerInfo,ds=!0,cc(a,d,m),hi=S,ds=b;break;case 0:case 11:case 14:case 15:if(!ui&&(S=m.updateQueue,S!==null&&(S=S.lastEffect,S!==null))){b=S=S.next;do{var P=b,Y=P.destroy;P=P.tag,Y!==void 0&&((P&2)!==0||(P&4)!==0)&&H_(m,d,Y),b=b.next}while(b!==S)}cc(a,d,m);break;case 1:if(!ui&&(ol(m,d),S=m.stateNode,typeof S.componentWillUnmount=="function"))try{S.props=m.memoizedProps,S.state=m.memoizedState,S.componentWillUnmount()}catch(ie){mr(m,d,ie)}cc(a,d,m);break;case 21:cc(a,d,m);break;case 22:m.mode&1?(ui=(S=ui)||m.memoizedState!==null,cc(a,d,m),ui=S):cc(a,d,m);break;default:cc(a,d,m)}}function _y(a){var d=a.updateQueue;if(d!==null){a.updateQueue=null;var m=a.stateNode;m===null&&(m=a.stateNode=new GC),d.forEach(function(S){var b=md.bind(null,a,S);m.has(S)||(m.add(S),S.then(b,b))})}}function $s(a,d){var m=d.deletions;if(m!==null)for(var S=0;S<m.length;S++){var b=m[S];try{var P=a,Y=d,ie=Y;e:for(;ie!==null;){switch(ie.tag){case 5:hi=ie.stateNode,ds=!1;break e;case 3:hi=ie.stateNode.containerInfo,ds=!0;break e;case 4:hi=ie.stateNode.containerInfo,ds=!0;break e}ie=ie.return}if(hi===null)throw Error(_(160));q_(P,Y,b),hi=null,ds=!1;var ue=b.alternate;ue!==null&&(ue.return=null),b.return=null}catch(Ae){mr(b,d,Ae)}}if(d.subtreeFlags&12854)for(d=d.child;d!==null;)X_(d,a),d=d.sibling}function X_(a,d){var m=a.alternate,S=a.flags;switch(a.tag){case 0:case 11:case 14:case 15:if($s(d,a),Ao(a),S&4){try{ac(3,a,a.return),Wp(3,a)}catch(Tt){mr(a,a.return,Tt)}try{ac(5,a,a.return)}catch(Tt){mr(a,a.return,Tt)}}break;case 1:$s(d,a),Ao(a),S&512&&m!==null&&ol(m,m.return);break;case 5:if($s(d,a),Ao(a),S&512&&m!==null&&ol(m,m.return),a.flags&32){var b=a.stateNode;try{Bs(b,"")}catch(Tt){mr(a,a.return,Tt)}}if(S&4&&(b=a.stateNode,b!=null)){var P=a.memoizedProps,Y=m!==null?m.memoizedProps:P,ie=a.type,ue=a.updateQueue;if(a.updateQueue=null,ue!==null)try{ie==="input"&&P.type==="radio"&&P.name!=null&&Ei(b,P),au(ie,Y);var Ae=au(ie,P);for(Y=0;Y<ue.length;Y+=2){var Ke=ue[Y],qe=ue[Y+1];Ke==="style"?Oi(b,qe):Ke==="dangerouslySetInnerHTML"?kl(b,qe):Ke==="children"?Bs(b,qe):le(b,Ke,qe,Ae)}switch(ie){case"input":Zo(b,P);break;case"textarea":Mr(b,P);break;case"select":var He=b._wrapperState.wasMultiple;b._wrapperState.wasMultiple=!!P.multiple;var ft=P.value;ft!=null?Wi(b,!!P.multiple,ft,!1):He!==!!P.multiple&&(P.defaultValue!=null?Wi(b,!!P.multiple,P.defaultValue,!0):Wi(b,!!P.multiple,P.multiple?[]:"",!1))}b[Au]=P}catch(Tt){mr(a,a.return,Tt)}}break;case 6:if($s(d,a),Ao(a),S&4){if(a.stateNode===null)throw Error(_(162));b=a.stateNode,P=a.memoizedProps;try{b.nodeValue=P}catch(Tt){mr(a,a.return,Tt)}}break;case 3:if($s(d,a),Ao(a),S&4&&m!==null&&m.memoizedState.isDehydrated)try{Fl(d.containerInfo)}catch(Tt){mr(a,a.return,Tt)}break;case 4:$s(d,a),Ao(a);break;case 13:$s(d,a),Ao(a),b=a.child,b.flags&8192&&(P=b.memoizedState!==null,b.stateNode.isHidden=P,!P||b.alternate!==null&&b.alternate.memoizedState!==null||($_=Ir())),S&4&&_y(a);break;case 22:if(Ke=m!==null&&m.memoizedState!==null,a.mode&1?(ui=(Ae=ui)||Ke,$s(d,a),ui=Ae):$s(d,a),Ao(a),S&8192){if(Ae=a.memoizedState!==null,(a.stateNode.isHidden=Ae)&&!Ke&&(a.mode&1)!==0)for(_t=a,Ke=a.child;Ke!==null;){for(qe=_t=Ke;_t!==null;){switch(He=_t,ft=He.child,He.tag){case 0:case 11:case 14:case 15:ac(4,He,He.return);break;case 1:ol(He,He.return);var yt=He.stateNode;if(typeof yt.componentWillUnmount=="function"){S=He,m=He.return;try{d=S,yt.props=d.memoizedProps,yt.state=d.memoizedState,yt.componentWillUnmount()}catch(Tt){mr(S,m,Tt)}}break;case 5:ol(He,He.return);break;case 22:if(He.memoizedState!==null){Gp(qe);continue}}ft!==null?(ft.return=He,_t=ft):Gp(qe)}Ke=Ke.sibling}e:for(Ke=null,qe=a;;){if(qe.tag===5){if(Ke===null){Ke=qe;try{b=qe.stateNode,Ae?(P=b.style,typeof P.setProperty=="function"?P.setProperty("display","none","important"):P.display="none"):(ie=qe.stateNode,ue=qe.memoizedProps.style,Y=ue!=null&&ue.hasOwnProperty("display")?ue.display:null,ie.style.display=Gc("display",Y))}catch(Tt){mr(a,a.return,Tt)}}}else if(qe.tag===6){if(Ke===null)try{qe.stateNode.nodeValue=Ae?"":qe.memoizedProps}catch(Tt){mr(a,a.return,Tt)}}else if((qe.tag!==22&&qe.tag!==23||qe.memoizedState===null||qe===a)&&qe.child!==null){qe.child.return=qe,qe=qe.child;continue}if(qe===a)break e;for(;qe.sibling===null;){if(qe.return===null||qe.return===a)break e;Ke===qe&&(Ke=null),qe=qe.return}Ke===qe&&(Ke=null),qe.sibling.return=qe.return,qe=qe.sibling}}break;case 19:$s(d,a),Ao(a),S&4&&_y(a);break;case 21:break;default:$s(d,a),Ao(a)}}function Ao(a){var d=a.flags;if(d&2){try{e:{for(var m=a.return;m!==null;){if(z_(m)){var S=m;break e}m=m.return}throw Error(_(160))}switch(S.tag){case 5:var b=S.stateNode;S.flags&32&&(Bs(b,""),S.flags&=-33);var P=my(a);Yu(a,P,b);break;case 3:case 4:var Y=S.stateNode.containerInfo,ie=my(a);Y_(a,ie,Y);break;default:throw Error(_(161))}}catch(ue){mr(a,a.return,ue)}a.flags&=-3}d&4096&&(a.flags&=-4097)}function KC(a,d,m){_t=a,J_(a)}function J_(a,d,m){for(var S=(a.mode&1)!==0;_t!==null;){var b=_t,P=b.child;if(b.tag===22&&S){var Y=b.memoizedState!==null||zu;if(!Y){var ie=b.alternate,ue=ie!==null&&ie.memoizedState!==null||ui;ie=zu;var Ae=ui;if(zu=Y,(ui=ue)&&!Ae)for(_t=b;_t!==null;)Y=_t,ue=Y.child,Y.tag===22&&Y.memoizedState!==null?Ey(b):ue!==null?(ue.return=Y,_t=ue):Ey(b);for(;P!==null;)_t=P,J_(P),P=P.sibling;_t=b,zu=ie,ui=Ae}Q_(a)}else(b.subtreeFlags&8772)!==0&&P!==null?(P.return=b,_t=P):Q_(a)}}function Q_(a){for(;_t!==null;){var d=_t;if((d.flags&8772)!==0){var m=d.alternate;try{if((d.flags&8772)!==0)switch(d.tag){case 0:case 11:case 15:ui||Wp(5,d);break;case 1:var S=d.stateNode;if(d.flags&4&&!ui)if(m===null)S.componentDidMount();else{var b=d.elementType===d.type?m.memoizedProps:Ss(d.type,m.memoizedProps);S.componentDidUpdate(b,m.memoizedState,S.__reactInternalSnapshotBeforeUpdate)}var P=d.updateQueue;P!==null&&Gv(d,P,S);break;case 3:var Y=d.updateQueue;if(Y!==null){if(m=null,d.child!==null)switch(d.child.tag){case 5:m=d.child.stateNode;break;case 1:m=d.child.stateNode}Gv(d,Y,m)}break;case 5:var ie=d.stateNode;if(m===null&&d.flags&4){m=ie;var ue=d.memoizedProps;switch(d.type){case"button":case"input":case"select":case"textarea":ue.autoFocus&&m.focus();break;case"img":ue.src&&(m.src=ue.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(d.memoizedState===null){var Ae=d.alternate;if(Ae!==null){var Ke=Ae.memoizedState;if(Ke!==null){var qe=Ke.dehydrated;qe!==null&&Fl(qe)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(_(163))}ui||d.flags&512&&K_(d)}catch(He){mr(d,d.return,He)}}if(d===a){_t=null;break}if(m=d.sibling,m!==null){m.return=d.return,_t=m;break}_t=d.return}}function Gp(a){for(;_t!==null;){var d=_t;if(d===a){_t=null;break}var m=d.sibling;if(m!==null){m.return=d.return,_t=m;break}_t=d.return}}function Ey(a){for(;_t!==null;){var d=_t;try{switch(d.tag){case 0:case 11:case 15:var m=d.return;try{Wp(4,d)}catch(ue){mr(d,m,ue)}break;case 1:var S=d.stateNode;if(typeof S.componentDidMount=="function"){var b=d.return;try{S.componentDidMount()}catch(ue){mr(d,b,ue)}}var P=d.return;try{K_(d)}catch(ue){mr(d,P,ue)}break;case 5:var Y=d.return;try{K_(d)}catch(ue){mr(d,Y,ue)}}}catch(ue){mr(d,d.return,ue)}if(d===a){_t=null;break}var ie=d.sibling;if(ie!==null){ie.return=d.return,_t=ie;break}_t=d.return}}var zC=Math.ceil,lc=Se.ReactCurrentDispatcher,Hp=Se.ReactCurrentOwner,Si=Se.ReactCurrentBatchConfig,pn=0,Hr=null,Rr=null,Ur=0,us=0,ud=Ys(0),Kr=0,hd=null,al=0,Kp=0,Z_=0,cl=null,Nr=null,$_=0,Ts=1/0,No=null,Ti=!1,eE=null,dc=null,qu=!1,uc=null,Xu=0,pd=0,tE=null,Ju=-1,zp=0;function xi(){return(pn&6)!==0?Ir():Ju!==-1?Ju:Ju=Ir()}function hc(a){return(a.mode&1)===0?1:(pn&2)!==0&&Ur!==0?Ur&-Ur:Du.transition!==null?(zp===0&&(zp=rv()),zp):(a=Ln,a!==0||(a=window.event,a=a===void 0?16:cv(a.type)),a)}function hs(a,d,m,S){if(50<pd)throw pd=0,tE=null,Error(_(185));du(a,m,S),((pn&2)===0||a!==Hr)&&(a===Hr&&((pn&2)===0&&(Kp|=m),Kr===4&&pc(a,Ur)),Ri(a,S),m===1&&pn===0&&(d.mode&1)===0&&(Ts=Ir()+500,mp&&rc()))}function Ri(a,d){var m=a.callbackNode;nv(a,d);var S=Xh(a,a===Hr?Ur:0);if(S===0)m!==null&&Qg(m),a.callbackNode=null,a.callbackPriority=0;else if(d=S&-S,a.callbackPriority!==d){if(m!=null&&Qg(m),d===1)a.tag===0?xC(Yp.bind(null,a)):c_(Yp.bind(null,a)),PC(function(){(pn&6)===0&&rc()}),m=null;else{switch(Pm(S)){case 1:m=Tr;break;case 4:m=Zg;break;case 16:m=Yh;break;case 536870912:m=$g;break;default:m=Yh}m=cE(m,gy.bind(null,a))}a.callbackPriority=d,a.callbackNode=m}}function gy(a,d){if(Ju=-1,zp=0,(pn&6)!==0)throw Error(_(327));var m=a.callbackNode;if(mc()&&a.callbackNode!==m)return null;var S=Xh(a,a===Hr?Ur:0);if(S===0)return null;if((S&30)!==0||(S&a.expiredLanes)!==0||d)d=$u(a,S);else{d=S;var b=pn;pn|=2;var P=iE();(Hr!==a||Ur!==d)&&(No=null,Ts=Ir()+500,pa(a,d));do try{qC();break}catch(ie){rE(a,ie)}while(!0);f_(),lc.current=P,pn=b,Rr!==null?d=0:(Hr=null,Ur=0,d=Kr)}if(d!==0){if(d===2&&(b=Am(a),b!==0&&(S=b,d=Qu(a,b))),d===1)throw m=hd,pa(a,0),pc(a,S),Ri(a,Ir()),m;if(d===6)pc(a,S);else{if(b=a.current.alternate,(S&30)===0&&!vy(b)&&(d=$u(a,S),d===2&&(P=Am(a),P!==0&&(S=P,d=Qu(a,P))),d===1))throw m=hd,pa(a,0),pc(a,S),Ri(a,Ir()),m;switch(a.finishedWork=b,a.finishedLanes=S,d){case 0:case 1:throw Error(_(345));case 2:Rs(a,Nr,No);break;case 3:if(pc(a,S),(S&130023424)===S&&(d=$_+500-Ir(),10<d)){if(Xh(a,0)!==0)break;if(b=a.suspendedLanes,(b&S)!==S){xi(),a.pingedLanes|=a.suspendedLanes&b;break}a.timeoutHandle=i_(Rs.bind(null,a,Nr,No),d);break}Rs(a,Nr,No);break;case 4:if(pc(a,S),(S&4194240)===S)break;for(d=a.eventTimes,b=-1;0<S;){var Y=31-Hs(S);P=1<<Y,Y=d[Y],Y>b&&(b=Y),S&=~P}if(S=b,S=Ir()-S,S=(120>S?120:480>S?480:1080>S?1080:1920>S?1920:3e3>S?3e3:4320>S?4320:1960*zC(S/1960))-S,10<S){a.timeoutHandle=i_(Rs.bind(null,a,Nr,No),S);break}Rs(a,Nr,No);break;case 5:Rs(a,Nr,No);break;default:throw Error(_(329))}}}return Ri(a,Ir()),a.callbackNode===m?gy.bind(null,a):null}function Qu(a,d){var m=cl;return a.current.memoizedState.isDehydrated&&(pa(a,d).flags|=256),a=$u(a,d),a!==2&&(d=Nr,Nr=m,d!==null&&nE(d)),a}function nE(a){Nr===null?Nr=a:Nr.push.apply(Nr,a)}function vy(a){for(var d=a;;){if(d.flags&16384){var m=d.updateQueue;if(m!==null&&(m=m.stores,m!==null))for(var S=0;S<m.length;S++){var b=m[S],P=b.getSnapshot;b=b.value;try{if(!Ks(P(),b))return!1}catch{return!1}}}if(m=d.child,d.subtreeFlags&16384&&m!==null)m.return=d,d=m;else{if(d===a)break;for(;d.sibling===null;){if(d.return===null||d.return===a)return!0;d=d.return}d.sibling.return=d.return,d=d.sibling}}return!0}function pc(a,d){for(d&=~Z_,d&=~Kp,a.suspendedLanes|=d,a.pingedLanes&=~d,a=a.expirationTimes;0<d;){var m=31-Hs(d),S=1<<m;a[m]=-1,d&=~S}}function Yp(a){if((pn&6)!==0)throw Error(_(327));mc();var d=Xh(a,0);if((d&1)===0)return Ri(a,Ir()),null;var m=$u(a,d);if(a.tag!==0&&m===2){var S=Am(a);S!==0&&(d=S,m=Qu(a,S))}if(m===1)throw m=hd,pa(a,0),pc(a,d),Ri(a,Ir()),m;if(m===6)throw Error(_(345));return a.finishedWork=a.current.alternate,a.finishedLanes=d,Rs(a,Nr,No),Ri(a,Ir()),null}function ll(a,d){var m=pn;pn|=1;try{return a(d)}finally{pn=m,pn===0&&(Ts=Ir()+500,mp&&rc())}}function fc(a){uc!==null&&uc.tag===0&&(pn&6)===0&&mc();var d=pn;pn|=1;var m=Si.transition,S=Ln;try{if(Si.transition=null,Ln=1,a)return a()}finally{Ln=S,Si.transition=m,pn=d,(pn&6)===0&&rc()}}function Zu(){us=ud.current,Jn(ud)}function pa(a,d){a.finishedWork=null,a.finishedLanes=0;var m=a.timeoutHandle;if(m!==-1&&(a.timeoutHandle=-1,OC(m)),Rr!==null)for(m=Rr.return;m!==null;){var S=m;switch(gp(S),S.tag){case 1:S=S.type.childContextTypes,S!=null&&pp();break;case 3:tl(),Jn(Di),Jn(vi),T_();break;case 5:y_(S);break;case 4:tl();break;case 13:Jn(fr);break;case 19:Jn(fr);break;case 10:m_(S.type._context);break;case 22:case 23:Zu()}m=m.return}if(Hr=a,Rr=a=_c(a.current,null),Ur=us=d,Kr=0,hd=null,Z_=Kp=al=0,Nr=cl=null,$c!==null){for(d=0;d<$c.length;d++)if(m=$c[d],S=m.interleaved,S!==null){m.interleaved=null;var b=S.next,P=m.pending;if(P!==null){var Y=P.next;P.next=b,S.next=Y}m.pending=S}$c=null}return a}function rE(a,d){do{var m=Rr;try{if(f_(),Mu.current=ld,Uu){for(var S=ur.memoizedState;S!==null;){var b=S.queue;b!==null&&(b.pending=null),S=S.next}Uu=!1}if(nl=0,Ar=Gr=ur=null,la=!1,Vu=0,Hp.current=null,m===null||m.return===null){Kr=1,hd=d,Rr=null;break}e:{var P=a,Y=m.return,ie=m,ue=d;if(d=Ur,ie.flags|=32768,ue!==null&&typeof ue=="object"&&typeof ue.then=="function"){var Ae=ue,Ke=ie,qe=Ke.tag;if((Ke.mode&1)===0&&(qe===0||qe===11||qe===15)){var He=Ke.alternate;He?(Ke.updateQueue=He.updateQueue,Ke.memoizedState=He.memoizedState,Ke.lanes=He.lanes):(Ke.updateQueue=null,Ke.memoizedState=null)}var ft=ry(Y);if(ft!==null){ft.flags&=-257,iy(ft,Y,ie,P,d),ft.mode&1&&M_(P,Ae,d),d=ft,ue=Ae;var yt=d.updateQueue;if(yt===null){var Tt=new Set;Tt.add(ue),d.updateQueue=Tt}else yt.add(ue);break e}else{if((d&1)===0){M_(P,Ae,d),fd();break e}ue=Error(_(426))}}else if(or&&ie.mode&1){var _r=ry(Y);if(_r!==null){(_r.flags&65536)===0&&(_r.flags|=256),iy(_r,Y,ie,P,d),id(dd(ue,ie));break e}}P=ue=dd(ue,ie),Kr!==4&&(Kr=2),cl===null?cl=[P]:cl.push(P),P=Y;do{switch(P.tag){case 3:P.flags|=65536,d&=-d,P.lanes|=d;var ge=x_(P,ue,d);Wv(P,ge);break e;case 1:ie=ue;var pe=P.type,Ce=P.stateNode;if((P.flags&128)===0&&(typeof pe.getDerivedStateFromError=="function"||Ce!==null&&typeof Ce.componentDidCatch=="function"&&(dc===null||!dc.has(Ce)))){P.flags|=65536,d&=-d,P.lanes|=d;var Qe=ny(P,ie,d);Wv(P,Qe);break e}}P=P.return}while(P!==null)}oE(m)}catch(Rt){d=Rt,Rr===m&&m!==null&&(Rr=m=m.return);continue}break}while(!0)}function iE(){var a=lc.current;return lc.current=ld,a===null?ld:a}function fd(){(Kr===0||Kr===3||Kr===2)&&(Kr=4),Hr===null||(al&268435455)===0&&(Kp&268435455)===0||pc(Hr,Ur)}function $u(a,d){var m=pn;pn|=2;var S=iE();(Hr!==a||Ur!==d)&&(No=null,pa(a,d));do try{YC();break}catch(b){rE(a,b)}while(!0);if(f_(),pn=m,lc.current=S,Rr!==null)throw Error(_(261));return Hr=null,Ur=0,Kr}function YC(){for(;Rr!==null;)sE(Rr)}function qC(){for(;Rr!==null&&!qR();)sE(Rr)}function sE(a){var d=Ty(a.alternate,a,us);a.memoizedProps=a.pendingProps,d===null?oE(a):Rr=d,Hp.current=null}function oE(a){var d=a;do{var m=d.alternate;if(a=d.return,(d.flags&32768)===0){if(m=Bp(m,d,us),m!==null){Rr=m;return}}else{if(m=WC(m,d),m!==null){m.flags&=32767,Rr=m;return}if(a!==null)a.flags|=32768,a.subtreeFlags=0,a.deletions=null;else{Kr=6,Rr=null;return}}if(d=d.sibling,d!==null){Rr=d;return}Rr=d=a}while(d!==null);Kr===0&&(Kr=5)}function Rs(a,d,m){var S=Ln,b=Si.transition;try{Si.transition=null,Ln=1,aE(a,d,m,S)}finally{Si.transition=b,Ln=S}return null}function aE(a,d,m,S){do mc();while(uc!==null);if((pn&6)!==0)throw Error(_(327));m=a.finishedWork;var b=a.finishedLanes;if(m===null)return null;if(a.finishedWork=null,a.finishedLanes=0,m===a.current)throw Error(_(177));a.callbackNode=null,a.callbackPriority=0;var P=m.lanes|m.childLanes;if($R(a,P),a===Hr&&(Rr=Hr=null,Ur=0),(m.subtreeFlags&2064)===0&&(m.flags&2064)===0||qu||(qu=!0,cE(Yh,function(){return mc(),null})),P=(m.flags&15990)!==0,(m.subtreeFlags&15990)!==0||P){P=Si.transition,Si.transition=null;var Y=Ln;Ln=1;var ie=pn;pn|=4,Hp.current=null,HC(a,m),X_(m,a),wC(dp),ep=!!r_,dp=r_=null,a.current=m,KC(m),So(),pn=ie,Ln=Y,Si.transition=P}else a.current=m;if(qu&&(qu=!1,uc=a,Xu=b),P=a.pendingLanes,P===0&&(dc=null),ev(m.stateNode),Ri(a,Ir()),d!==null)for(S=a.onRecoverableError,m=0;m<d.length;m++)b=d[m],S(b.value,{componentStack:b.stack,digest:b.digest});if(Ti)throw Ti=!1,a=eE,eE=null,a;return(Xu&1)!==0&&a.tag!==0&&mc(),P=a.pendingLanes,(P&1)!==0?a===tE?pd++:(pd=0,tE=a):pd=0,rc(),null}function mc(){if(uc!==null){var a=Pm(Xu),d=Si.transition,m=Ln;try{if(Si.transition=null,Ln=16>a?16:a,uc===null)var S=!1;else{if(a=uc,uc=null,Xu=0,(pn&6)!==0)throw Error(_(331));var b=pn;for(pn|=4,_t=a.current;_t!==null;){var P=_t,Y=P.child;if((_t.flags&16)!==0){var ie=P.deletions;if(ie!==null){for(var ue=0;ue<ie.length;ue++){var Ae=ie[ue];for(_t=Ae;_t!==null;){var Ke=_t;switch(Ke.tag){case 0:case 11:case 15:ac(8,Ke,P)}var qe=Ke.child;if(qe!==null)qe.return=Ke,_t=qe;else for(;_t!==null;){Ke=_t;var He=Ke.sibling,ft=Ke.return;if(fy(Ke),Ke===Ae){_t=null;break}if(He!==null){He.return=ft,_t=He;break}_t=ft}}}var yt=P.alternate;if(yt!==null){var Tt=yt.child;if(Tt!==null){yt.child=null;do{var _r=Tt.sibling;Tt.sibling=null,Tt=_r}while(Tt!==null)}}_t=P}}if((P.subtreeFlags&2064)!==0&&Y!==null)Y.return=P,_t=Y;else e:for(;_t!==null;){if(P=_t,(P.flags&2048)!==0)switch(P.tag){case 0:case 11:case 15:ac(9,P,P.return)}var ge=P.sibling;if(ge!==null){ge.return=P.return,_t=ge;break e}_t=P.return}}var pe=a.current;for(_t=pe;_t!==null;){Y=_t;var Ce=Y.child;if((Y.subtreeFlags&2064)!==0&&Ce!==null)Ce.return=Y,_t=Ce;else e:for(Y=pe;_t!==null;){if(ie=_t,(ie.flags&2048)!==0)try{switch(ie.tag){case 0:case 11:case 15:Wp(9,ie)}}catch(Rt){mr(ie,ie.return,Rt)}if(ie===Y){_t=null;break e}var Qe=ie.sibling;if(Qe!==null){Qe.return=ie.return,_t=Qe;break e}_t=ie.return}}if(pn=b,rc(),To&&typeof To.onPostCommitFiberRoot=="function")try{To.onPostCommitFiberRoot(Ml,a)}catch{}S=!0}return S}finally{Ln=m,Si.transition=d}}return!1}function qp(a,d,m){d=dd(m,d),d=x_(a,d,1),a=Js(a,d,1),d=xi(),a!==null&&(du(a,1,d),Ri(a,d))}function mr(a,d,m){if(a.tag===3)qp(a,a,m);else for(;d!==null;){if(d.tag===3){qp(d,a,m);break}else if(d.tag===1){var S=d.stateNode;if(typeof d.type.getDerivedStateFromError=="function"||typeof S.componentDidCatch=="function"&&(dc===null||!dc.has(S))){a=dd(m,a),a=ny(d,a,1),d=Js(d,a,1),a=xi(),d!==null&&(du(d,1,a),Ri(d,a));break}}d=d.return}}function yy(a,d,m){var S=a.pingCache;S!==null&&S.delete(d),d=xi(),a.pingedLanes|=a.suspendedLanes&m,Hr===a&&(Ur&m)===m&&(Kr===4||Kr===3&&(Ur&130023424)===Ur&&500>Ir()-$_?pa(a,0):Z_|=m),Ri(a,d)}function Sy(a,d){d===0&&((a.mode&1)===0?d=1:(d=qh,qh<<=1,(qh&130023424)===0&&(qh=4194304)));var m=xi();a=oa(a,d),a!==null&&(du(a,d,m),Ri(a,m))}function XC(a){var d=a.memoizedState,m=0;d!==null&&(m=d.retryLane),Sy(a,m)}function md(a,d){var m=0;switch(a.tag){case 13:var S=a.stateNode,b=a.memoizedState;b!==null&&(m=b.retryLane);break;case 19:S=a.stateNode;break;default:throw Error(_(314))}S!==null&&S.delete(d),Sy(a,m)}var Ty;Ty=function(a,d,m){if(a!==null)if(a.memoizedProps!==d.pendingProps||Di.current)Xi=!0;else{if((a.lanes&m)===0&&(d.flags&128)===0)return Xi=!1,Vp(a,d,m);Xi=(a.flags&131072)!==0}else Xi=!1,or&&(d.flags&1048576)!==0&&Uv(d,Ep,d.index);switch(d.lanes=0,d.tag){case 2:var S=d.type;Up(a,d),a=d.pendingProps;var b=nc(d,vi.current);Xs(d,m),b=ad(null,d,S,a,b,m);var P=w_();return d.flags|=1,typeof b=="object"&&b!==null&&typeof b.render=="function"&&b.$$typeof===void 0?(d.tag=1,d.memoizedState=null,d.updateQueue=null,Yi(S)?(P=!0,fp(d)):P=!1,d.memoizedState=b.state!==null&&b.state!==void 0?b.state:null,g_(d),b.updater=kp,d.stateNode=b,b._reactInternals=d,D_(d,S,a,m),d=j_(null,d,S,!0,P,m)):(d.tag=0,or&&P&&nd(d),Li(null,d,b,m),d=d.child),d;case 16:S=d.elementType;e:{switch(Up(a,d),a=d.pendingProps,b=S._init,S=b(S._payload),d.type=S,b=d.tag=JC(S),a=Ss(S,a),b){case 0:d=V_(null,d,S,a,m);break e;case 1:d=cy(null,d,S,a,m);break e;case 11:d=sy(null,d,S,a,m);break e;case 14:d=oy(null,d,S,Ss(S.type,a),m);break e}throw Error(_(306,S,""))}return d;case 0:return S=d.type,b=d.pendingProps,b=d.elementType===S?b:Ss(S,b),V_(a,d,S,b,m);case 1:return S=d.type,b=d.pendingProps,b=d.elementType===S?b:Ss(S,b),cy(a,d,S,b,m);case 3:e:{if(ly(d),a===null)throw Error(_(387));S=d.pendingProps,P=d.memoizedState,b=P.element,Bv(a,d),Cp(d,S,null,m);var Y=d.memoizedState;if(S=Y.element,P.isDehydrated)if(P={element:S,isDehydrated:!1,cache:Y.cache,pendingSuspenseBoundaries:Y.pendingSuspenseBoundaries,transitions:Y.transitions},d.updateQueue.baseState=P,d.memoizedState=P,d.flags&256){b=dd(Error(_(423)),d),d=dy(a,d,S,m,b);break e}else if(S!==b){b=dd(Error(_(424)),d),d=dy(a,d,S,m,b);break e}else for(ls=Co(d.stateNode.containerInfo.firstChild),cs=d,or=!0,qs=null,m=h_(d,null,S,m),d.child=m;m;)m.flags=m.flags&-3|4096,m=m.sibling;else{if(Zc(),S===b){d=ha(a,d,m);break e}Li(a,d,S,m)}d=d.child}return d;case 5:return Hv(d),a===null&&Pu(d),S=d.type,b=d.pendingProps,P=a!==null?a.memoizedProps:null,Y=b.children,Zl(S,b)?Y=null:P!==null&&Zl(S,P)&&(d.flags|=32),ay(a,d),Li(a,d,Y,m),d.child;case 6:return a===null&&Pu(d),null;case 13:return uy(a,d,m);case 4:return v_(d,d.stateNode.containerInfo),S=d.pendingProps,a===null?d.child=sd(d,null,S,m):Li(a,d,S,m),d.child;case 11:return S=d.type,b=d.pendingProps,b=d.elementType===S?b:Ss(S,b),sy(a,d,S,b,m);case 7:return Li(a,d,d.pendingProps,m),d.child;case 8:return Li(a,d,d.pendingProps.children,m),d.child;case 12:return Li(a,d,d.pendingProps.children,m),d.child;case 10:e:{if(S=d.type._context,b=d.pendingProps,P=d.memoizedProps,Y=b.value,nr(yp,S._currentValue),S._currentValue=Y,P!==null)if(Ks(P.value,Y)){if(P.children===b.children&&!Di.current){d=ha(a,d,m);break e}}else for(P=d.child,P!==null&&(P.return=d);P!==null;){var ie=P.dependencies;if(ie!==null){Y=P.child;for(var ue=ie.firstContext;ue!==null;){if(ue.context===S){if(P.tag===1){ue=ca(-1,m&-m),ue.tag=2;var Ae=P.updateQueue;if(Ae!==null){Ae=Ae.shared;var Ke=Ae.pending;Ke===null?ue.next=ue:(ue.next=Ke.next,Ke.next=ue),Ae.pending=ue}}P.lanes|=m,ue=P.alternate,ue!==null&&(ue.lanes|=m),Tp(P.return,m,d),ie.lanes|=m;break}ue=ue.next}}else if(P.tag===10)Y=P.type===d.type?null:P.child;else if(P.tag===18){if(Y=P.return,Y===null)throw Error(_(341));Y.lanes|=m,ie=Y.alternate,ie!==null&&(ie.lanes|=m),Tp(Y,m,d),Y=P.sibling}else Y=P.child;if(Y!==null)Y.return=P;else for(Y=P;Y!==null;){if(Y===d){Y=null;break}if(P=Y.sibling,P!==null){P.return=Y.return,Y=P;break}Y=Y.return}P=Y}Li(a,d,b.children,m),d=d.child}return d;case 9:return b=d.type,S=d.pendingProps.children,Xs(d,m),b=ys(b),S=S(b),d.flags|=1,Li(a,d,S,m),d.child;case 14:return S=d.type,b=Ss(S,d.pendingProps),b=Ss(S.type,b),oy(a,d,S,b,m);case 15:return U_(a,d,d.type,d.pendingProps,m);case 17:return S=d.type,b=d.pendingProps,b=d.elementType===S?b:Ss(S,b),Up(a,d),d.tag=1,Yi(S)?(a=!0,fp(d)):a=!1,Xs(d,m),ey(d,S,b),D_(d,S,b,m),j_(null,d,S,!0,a,m);case 19:return W_(a,d,m);case 22:return Io(a,d,m)}throw Error(_(156,d.tag))};function cE(a,d){return zc(a,d)}function lE(a,d,m,S){this.tag=a,this.key=m,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=d,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=S,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Cs(a,d,m,S){return new lE(a,d,m,S)}function dE(a){return a=a.prototype,!(!a||!a.isReactComponent)}function JC(a){if(typeof a=="function")return dE(a)?1:0;if(a!=null){if(a=a.$$typeof,a===Ge)return 11;if(a===Ct)return 14}return 2}function _c(a,d){var m=a.alternate;return m===null?(m=Cs(a.tag,d,a.key,a.mode),m.elementType=a.elementType,m.type=a.type,m.stateNode=a.stateNode,m.alternate=a,a.alternate=m):(m.pendingProps=d,m.type=a.type,m.flags=0,m.subtreeFlags=0,m.deletions=null),m.flags=a.flags&14680064,m.childLanes=a.childLanes,m.lanes=a.lanes,m.child=a.child,m.memoizedProps=a.memoizedProps,m.memoizedState=a.memoizedState,m.updateQueue=a.updateQueue,d=a.dependencies,m.dependencies=d===null?null:{lanes:d.lanes,firstContext:d.firstContext},m.sibling=a.sibling,m.index=a.index,m.ref=a.ref,m}function _d(a,d,m,S,b,P){var Y=2;if(S=a,typeof a=="function")dE(a)&&(Y=1);else if(typeof a=="string")Y=5;else e:switch(a){case xe:return Ec(m.children,b,P,d);case je:Y=8,b|=8;break;case lt:return a=Cs(12,m,d,b|2),a.elementType=lt,a.lanes=P,a;case pt:return a=Cs(13,m,d,b),a.elementType=pt,a.lanes=P,a;case Fe:return a=Cs(19,m,d,b),a.elementType=Fe,a.lanes=P,a;case Je:return eh(m,b,P,d);default:if(typeof a=="object"&&a!==null)switch(a.$$typeof){case Et:Y=10;break e;case ht:Y=9;break e;case Ge:Y=11;break e;case Ct:Y=14;break e;case nt:Y=16,S=null;break e}throw Error(_(130,a==null?a:typeof a,""))}return d=Cs(Y,m,d,b),d.elementType=a,d.type=S,d.lanes=P,d}function Ec(a,d,m,S){return a=Cs(7,a,S,d),a.lanes=m,a}function eh(a,d,m,S){return a=Cs(22,a,S,d),a.elementType=Je,a.lanes=m,a.stateNode={isHidden:!1},a}function Xp(a,d,m){return a=Cs(6,a,null,d),a.lanes=m,a}function Ed(a,d,m){return d=Cs(4,a.children!==null?a.children:[],a.key,d),d.lanes=m,d.stateNode={containerInfo:a.containerInfo,pendingChildren:null,implementation:a.implementation},d}function uE(a,d,m,S,b){this.tag=d,this.containerInfo=a,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Nm(0),this.expirationTimes=Nm(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Nm(0),this.identifierPrefix=S,this.onRecoverableError=b,this.mutableSourceEagerHydrationData=null}function gd(a,d,m,S,b,P,Y,ie,ue){return a=new uE(a,d,m,ie,ue),d===1?(d=1,P===!0&&(d|=8)):d=0,P=Cs(3,null,null,d),a.current=P,P.stateNode=a,P.memoizedState={element:S,isDehydrated:m,cache:null,transitions:null,pendingSuspenseBoundaries:null},g_(P),a}function Jp(a,d,m){var S=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Ue,key:S==null?null:""+S,children:a,containerInfo:d,implementation:m}}function hE(a){if(!a)return ec;a=a._reactInternals;e:{if(Kc(a)!==a||a.tag!==1)throw Error(_(170));var d=a;do{switch(d.tag){case 3:d=d.stateNode.context;break e;case 1:if(Yi(d.type)){d=d.stateNode.__reactInternalMemoizedMergedChildContext;break e}}d=d.return}while(d!==null);throw Error(_(171))}if(a.tag===1){var m=a.type;if(Yi(m))return xv(a,m,d)}return d}function dl(a,d,m,S,b,P,Y,ie,ue){return a=gd(m,S,!0,a,b,P,Y,ie,ue),a.context=hE(null),m=a.current,S=xi(),b=hc(m),P=ca(S,b),P.callback=d??null,Js(m,P,b),a.current.lanes=b,du(a,b,S),Ri(a,S),a}function Oo(a,d,m,S){var b=d.current,P=xi(),Y=hc(b);return m=hE(m),d.context===null?d.context=m:d.pendingContext=m,d=ca(P,Y),d.payload={element:a},S=S===void 0?null:S,S!==null&&(d.callback=S),a=Js(b,d,Y),a!==null&&(hs(a,b,Y,P),Rp(a,b,Y)),Y}function Qp(a){if(a=a.current,!a.child)return null;switch(a.child.tag){case 5:return a.child.stateNode;default:return a.child.stateNode}}function vd(a,d){if(a=a.memoizedState,a!==null&&a.dehydrated!==null){var m=a.retryLane;a.retryLane=m!==0&&m<d?m:d}}function pE(a,d){vd(a,d),(a=a.alternate)&&vd(a,d)}function QC(){return null}var Ry=typeof reportError=="function"?reportError:function(a){console.error(a)};function fE(a){this._internalRoot=a}th.prototype.render=fE.prototype.render=function(a){var d=this._internalRoot;if(d===null)throw Error(_(409));Oo(a,d,null,null)},th.prototype.unmount=fE.prototype.unmount=function(){var a=this._internalRoot;if(a!==null){this._internalRoot=null;var d=a.containerInfo;fc(function(){Oo(null,a,null,null)}),d[ta]=null}};function th(a){this._internalRoot=a}th.prototype.unstable_scheduleHydration=function(a){if(a){var d=iv();a={blockedOn:null,target:a,priority:d};for(var m=0;m<Ya.length&&d!==0&&d<Ya[m].priority;m++);Ya.splice(m,0,a),m===0&&jl(a)}};function nh(a){return!(!a||a.nodeType!==1&&a.nodeType!==9&&a.nodeType!==11)}function rh(a){return!(!a||a.nodeType!==1&&a.nodeType!==9&&a.nodeType!==11&&(a.nodeType!==8||a.nodeValue!==" react-mount-point-unstable "))}function Cy(){}function wy(a,d,m,S,b){if(b){if(typeof S=="function"){var P=S;S=function(){var Ae=Qp(Y);P.call(Ae)}}var Y=dl(d,S,a,0,null,!1,!1,"",Cy);return a._reactRootContainer=Y,a[ta]=Y.current,ea(a.nodeType===8?a.parentNode:a),fc(),Y}for(;b=a.lastChild;)a.removeChild(b);if(typeof S=="function"){var ie=S;S=function(){var Ae=Qp(ue);ie.call(Ae)}}var ue=gd(a,0,!1,null,null,!1,!1,"",Cy);return a._reactRootContainer=ue,a[ta]=ue.current,ea(a.nodeType===8?a.parentNode:a),fc(function(){Oo(d,ue,m,S)}),ue}function Zp(a,d,m,S,b){var P=m._reactRootContainer;if(P){var Y=P;if(typeof b=="function"){var ie=b;b=function(){var ue=Qp(Y);ie.call(ue)}}Oo(d,Y,a,b)}else Y=wy(m,d,a,b,S);return Qp(Y)}Jh=function(a){switch(a.tag){case 3:var d=a.stateNode;if(d.current.memoizedState.isDehydrated){var m=kn(d.pendingLanes);m!==0&&(Om(d,m|1),Ri(d,Ir()),(pn&6)===0&&(Ts=Ir()+500,rc()))}break;case 13:fc(function(){var S=oa(a,1);if(S!==null){var b=xi();hs(S,a,1,b)}}),pE(a,1)}},Dm=function(a){if(a.tag===13){var d=oa(a,134217728);if(d!==null){var m=xi();hs(d,a,134217728,m)}pE(a,134217728)}},Qh=function(a){if(a.tag===13){var d=hc(a),m=oa(a,d);if(m!==null){var S=xi();hs(m,a,d,S)}pE(a,d)}},iv=function(){return Ln},km=function(a,d){var m=Ln;try{return Ln=a,d()}finally{Ln=m}},Ll=function(a,d,m){switch(d){case"input":if(Zo(a,m),d=m.name,m.type==="radio"&&d!=null){for(m=a;m.parentNode;)m=m.parentNode;for(m=m.querySelectorAll("input[name="+JSON.stringify(""+d)+'][type="radio"]'),d=0;d<m.length;d++){var S=m[d];if(S!==a&&S.form===a.form){var b=hp(S);if(!b)throw Error(_(90));Yn(S),Zo(S,b)}}}break;case"textarea":Mr(a,m);break;case"select":d=m.value,d!=null&&Wi(a,!!m.multiple,d,!1)}},gn=ll,qn=fc;var ih={usingClientEntryPoint:!1,Events:[Nu,$l,hp,Ga,Yt,ll]},Ji={findFiberByHostInstance:Xc,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},by={bundleType:Ji.bundleType,version:Ji.version,rendererPackageName:Ji.rendererPackageName,rendererConfig:Ji.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Se.ReactCurrentDispatcher,findHostInstanceByFiber:function(a){return a=zh(a),a===null?null:a.stateNode},findFiberByHostInstance:Ji.findFiberByHostInstance||QC,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var $p=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!$p.isDisabled&&$p.supportsFiber)try{Ml=$p.inject(by),To=$p}catch{}}return Vs.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=ih,Vs.createPortal=function(a,d){var m=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!nh(d))throw Error(_(200));return Jp(a,d,null,m)},Vs.createRoot=function(a,d){if(!nh(a))throw Error(_(299));var m=!1,S="",b=Ry;return d!=null&&(d.unstable_strictMode===!0&&(m=!0),d.identifierPrefix!==void 0&&(S=d.identifierPrefix),d.onRecoverableError!==void 0&&(b=d.onRecoverableError)),d=gd(a,1,!1,null,null,m,!1,S,b),a[ta]=d.current,ea(a.nodeType===8?a.parentNode:a),new fE(d)},Vs.findDOMNode=function(a){if(a==null)return null;if(a.nodeType===1)return a;var d=a._reactInternals;if(d===void 0)throw typeof a.render=="function"?Error(_(188)):(a=Object.keys(a).join(","),Error(_(268,a)));return a=zh(d),a=a===null?null:a.stateNode,a},Vs.flushSync=function(a){return fc(a)},Vs.hydrate=function(a,d,m){if(!rh(d))throw Error(_(200));return Zp(null,a,d,!0,m)},Vs.hydrateRoot=function(a,d,m){if(!nh(a))throw Error(_(405));var S=m!=null&&m.hydratedSources||null,b=!1,P="",Y=Ry;if(m!=null&&(m.unstable_strictMode===!0&&(b=!0),m.identifierPrefix!==void 0&&(P=m.identifierPrefix),m.onRecoverableError!==void 0&&(Y=m.onRecoverableError)),d=dl(d,null,a,1,m??null,b,!1,P,Y),a[ta]=d.current,ea(a),S)for(a=0;a<S.length;a++)m=S[a],b=m._getVersion,b=b(m._source),d.mutableSourceEagerHydrationData==null?d.mutableSourceEagerHydrationData=[m,b]:d.mutableSourceEagerHydrationData.push(m,b);return new th(d)},Vs.render=function(a,d,m){if(!rh(d))throw Error(_(200));return Zp(null,a,d,!1,m)},Vs.unmountComponentAtNode=function(a){if(!rh(a))throw Error(_(40));return a._reactRootContainer?(fc(function(){Zp(null,null,a,!1,function(){a._reactRootContainer=null,a[ta]=null})}),!0):!1},Vs.unstable_batchedUpdates=ll,Vs.unstable_renderSubtreeIntoContainer=function(a,d,m,S){if(!rh(m))throw Error(_(200));if(a==null||a._reactInternals===void 0)throw Error(_(38));return Zp(a,d,m,!1,S)},Vs.version="18.3.1-next-f1338f8080-20240426",Vs}var Dj;function BF(){if(Dj)return eA.exports;Dj=1;function u(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(u)}catch(f){console.error(f)}}return u(),eA.exports=$q(),eA.exports}var kj;function eX(){if(kj)return QT;kj=1;var u=BF();return QT.createRoot=u.createRoot,QT.hydrateRoot=u.hydrateRoot,QT}var tX=eX(),j=RR();const tt=KA(j),zA=Yq({__proto__:null,default:tt},[j]),nX=1,rX=1e6;let rA=0;function iX(){return rA=(rA+1)%Number.MAX_SAFE_INTEGER,rA.toString()}const iA=new Map,Lj=u=>{if(iA.has(u))return;const f=setTimeout(()=>{iA.delete(u),Dg({type:"REMOVE_TOAST",toastId:u})},rX);iA.set(u,f)},sX=(u,f)=>{switch(f.type){case"ADD_TOAST":return{...u,toasts:[f.toast,...u.toasts].slice(0,nX)};case"UPDATE_TOAST":return{...u,toasts:u.toasts.map(_=>_.id===f.toast.id?{..._,...f.toast}:_)};case"DISMISS_TOAST":{const{toastId:_}=f;return _?Lj(_):u.toasts.forEach(y=>{Lj(y.id)}),{...u,toasts:u.toasts.map(y=>y.id===_||_===void 0?{...y,open:!1}:y)}}case"REMOVE_TOAST":return f.toastId===void 0?{...u,toasts:[]}:{...u,toasts:u.toasts.filter(_=>_.id!==f.toastId)}}},cR=[];let lR={toasts:[]};function Dg(u){lR=sX(lR,u),cR.forEach(f=>{f(lR)})}function oX({...u}){const f=iX(),_=C=>Dg({type:"UPDATE_TOAST",toast:{...C,id:f}}),y=()=>Dg({type:"DISMISS_TOAST",toastId:f});return Dg({type:"ADD_TOAST",toast:{...u,id:f,open:!0,onOpenChange:C=>{C||y()}}}),{id:f,dismiss:y,update:_}}function Bg(){const[u,f]=j.useState(lR);return j.useEffect(()=>(cR.push(f),()=>{const _=cR.indexOf(f);_>-1&&cR.splice(_,1)}),[u]),{...u,toast:oX,dismiss:_=>Dg({type:"DISMISS_TOAST",toastId:_})}}var gm=BF();const WF=KA(gm);function $t(u,f,{checkForDefaultPrevented:_=!0}={}){return function(C){if(u?.(C),_===!1||!C.defaultPrevented)return f?.(C)}}function xj(u,f){if(typeof u=="function")return u(f);u!=null&&(u.current=f)}function GF(...u){return f=>{let _=!1;const y=u.map(C=>{const A=xj(C,f);return!_&&typeof A=="function"&&(_=!0),A});if(_)return()=>{for(let C=0;C<y.length;C++){const A=y[C];typeof A=="function"?A():xj(u[C],null)}}}}function yr(...u){return j.useCallback(GF(...u),u)}function Ol(u,f=[]){let _=[];function y(A,D){const L=j.createContext(D),V=_.length;_=[..._,D];const G=K=>{const{scope:ee,children:X,...re}=K,q=ee?.[u]?.[V]||L,$=j.useMemo(()=>re,Object.values(re));return T.jsx(q.Provider,{value:$,children:X})};G.displayName=A+"Provider";function W(K,ee){const X=ee?.[u]?.[V]||L,re=j.useContext(X);if(re)return re;if(D!==void 0)return D;throw new Error(`\`${K}\` must be used within \`${A}\``)}return[G,W]}const C=()=>{const A=_.map(D=>j.createContext(D));return function(L){const V=L?.[u]||A;return j.useMemo(()=>({[`__scope${u}`]:{...L,[u]:V}}),[L,V])}};return C.scopeName=u,[y,aX(C,...f)]}function aX(...u){const f=u[0];if(u.length===1)return f;const _=()=>{const y=u.map(C=>({useScope:C(),scopeName:C.scopeName}));return function(A){const D=y.reduce((L,{useScope:V,scopeName:G})=>{const K=V(A)[`__scope${G}`];return{...L,...K}},{});return j.useMemo(()=>({[`__scope${f.scopeName}`]:D}),[D])}};return _.scopeName=f.scopeName,_}function Lg(u){const f=lX(u),_=j.forwardRef((y,C)=>{const{children:A,...D}=y,L=j.Children.toArray(A),V=L.find(uX);if(V){const G=V.props.children,W=L.map(K=>K===V?j.Children.count(G)>1?j.Children.only(null):j.isValidElement(G)?G.props.children:null:K);return T.jsx(f,{...D,ref:C,children:j.isValidElement(G)?j.cloneElement(G,void 0,W):null})}return T.jsx(f,{...D,ref:C,children:A})});return _.displayName=`${u}.Slot`,_}var cX=Lg("Slot");function lX(u){const f=j.forwardRef((_,y)=>{const{children:C,...A}=_;if(j.isValidElement(C)){const D=pX(C),L=hX(A,C.props);return C.type!==j.Fragment&&(L.ref=y?GF(y,D):D),j.cloneElement(C,L)}return j.Children.count(C)>1?j.Children.only(null):null});return f.displayName=`${u}.SlotClone`,f}var HF=Symbol("radix.slottable");function dX(u){const f=({children:_})=>T.jsx(T.Fragment,{children:_});return f.displayName=`${u}.Slottable`,f.__radixId=HF,f}function uX(u){return j.isValidElement(u)&&typeof u.type=="function"&&"__radixId"in u.type&&u.type.__radixId===HF}function hX(u,f){const _={...f};for(const y in f){const C=u[y],A=f[y];/^on[A-Z]/.test(y)?C&&A?_[y]=(...L)=>{const V=A(...L);return C(...L),V}:C&&(_[y]=C):y==="style"?_[y]={...C,...A}:y==="className"&&(_[y]=[C,A].filter(Boolean).join(" "))}return{...u,..._}}function pX(u){let f=Object.getOwnPropertyDescriptor(u.props,"ref")?.get,_=f&&"isReactWarning"in f&&f.isReactWarning;return _?u.ref:(f=Object.getOwnPropertyDescriptor(u,"ref")?.get,_=f&&"isReactWarning"in f&&f.isReactWarning,_?u.props.ref:u.props.ref||u.ref)}function YA(u){const f=u+"CollectionProvider",[_,y]=Ol(f),[C,A]=_(f,{collectionRef:{current:null},itemMap:new Map}),D=q=>{const{scope:$,children:ae}=q,oe=tt.useRef(null),le=tt.useRef(new Map).current;return T.jsx(C,{scope:$,itemMap:le,collectionRef:oe,children:ae})};D.displayName=f;const L=u+"CollectionSlot",V=Lg(L),G=tt.forwardRef((q,$)=>{const{scope:ae,children:oe}=q,le=A(L,ae),Se=yr($,le.collectionRef);return T.jsx(V,{ref:Se,children:oe})});G.displayName=L;const W=u+"CollectionItemSlot",K="data-radix-collection-item",ee=Lg(W),X=tt.forwardRef((q,$)=>{const{scope:ae,children:oe,...le}=q,Se=tt.useRef(null),be=yr($,Se),Ue=A(W,ae);return tt.useEffect(()=>(Ue.itemMap.set(Se,{ref:Se,...le}),()=>void Ue.itemMap.delete(Se))),T.jsx(ee,{[K]:"",ref:be,children:oe})});X.displayName=W;function re(q){const $=A(u+"CollectionConsumer",q);return tt.useCallback(()=>{const oe=$.collectionRef.current;if(!oe)return[];const le=Array.from(oe.querySelectorAll(`[${K}]`));return Array.from($.itemMap.values()).sort((Ue,xe)=>le.indexOf(Ue.ref.current)-le.indexOf(xe.ref.current))},[$.collectionRef,$.itemMap])}return[{Provider:D,Slot:G,ItemSlot:X},re,y]}var fX=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],En=fX.reduce((u,f)=>{const _=Lg(`Primitive.${f}`),y=j.forwardRef((C,A)=>{const{asChild:D,...L}=C,V=D?_:f;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),T.jsx(V,{...L,ref:A})});return y.displayName=`Primitive.${f}`,{...u,[f]:y}},{});function KF(u,f){u&&gm.flushSync(()=>u.dispatchEvent(f))}function _o(u){const f=j.useRef(u);return j.useEffect(()=>{f.current=u}),j.useMemo(()=>(..._)=>f.current?.(..._),[])}function mX(u,f=globalThis?.document){const _=_o(u);j.useEffect(()=>{const y=C=>{C.key==="Escape"&&_(C)};return f.addEventListener("keydown",y,{capture:!0}),()=>f.removeEventListener("keydown",y,{capture:!0})},[_,f])}var _X="DismissableLayer",TA="dismissableLayer.update",EX="dismissableLayer.pointerDownOutside",gX="dismissableLayer.focusOutside",Mj,zF=j.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),CR=j.forwardRef((u,f)=>{const{disableOutsidePointerEvents:_=!1,onEscapeKeyDown:y,onPointerDownOutside:C,onFocusOutside:A,onInteractOutside:D,onDismiss:L,...V}=u,G=j.useContext(zF),[W,K]=j.useState(null),ee=W?.ownerDocument??globalThis?.document,[,X]=j.useState({}),re=yr(f,xe=>K(xe)),q=Array.from(G.layers),[$]=[...G.layersWithOutsidePointerEventsDisabled].slice(-1),ae=q.indexOf($),oe=W?q.indexOf(W):-1,le=G.layersWithOutsidePointerEventsDisabled.size>0,Se=oe>=ae,be=yX(xe=>{const je=xe.target,lt=[...G.branches].some(Et=>Et.contains(je));!Se||lt||(C?.(xe),D?.(xe),xe.defaultPrevented||L?.())},ee),Ue=SX(xe=>{const je=xe.target;[...G.branches].some(Et=>Et.contains(je))||(A?.(xe),D?.(xe),xe.defaultPrevented||L?.())},ee);return mX(xe=>{oe===G.layers.size-1&&(y?.(xe),!xe.defaultPrevented&&L&&(xe.preventDefault(),L()))},ee),j.useEffect(()=>{if(W)return _&&(G.layersWithOutsidePointerEventsDisabled.size===0&&(Mj=ee.body.style.pointerEvents,ee.body.style.pointerEvents="none"),G.layersWithOutsidePointerEventsDisabled.add(W)),G.layers.add(W),Uj(),()=>{_&&G.layersWithOutsidePointerEventsDisabled.size===1&&(ee.body.style.pointerEvents=Mj)}},[W,ee,_,G]),j.useEffect(()=>()=>{W&&(G.layers.delete(W),G.layersWithOutsidePointerEventsDisabled.delete(W),Uj())},[W,G]),j.useEffect(()=>{const xe=()=>X({});return document.addEventListener(TA,xe),()=>document.removeEventListener(TA,xe)},[]),T.jsx(En.div,{...V,ref:re,style:{pointerEvents:le?Se?"auto":"none":void 0,...u.style},onFocusCapture:$t(u.onFocusCapture,Ue.onFocusCapture),onBlurCapture:$t(u.onBlurCapture,Ue.onBlurCapture),onPointerDownCapture:$t(u.onPointerDownCapture,be.onPointerDownCapture)})});CR.displayName=_X;var vX="DismissableLayerBranch",YF=j.forwardRef((u,f)=>{const _=j.useContext(zF),y=j.useRef(null),C=yr(f,y);return j.useEffect(()=>{const A=y.current;if(A)return _.branches.add(A),()=>{_.branches.delete(A)}},[_.branches]),T.jsx(En.div,{...u,ref:C})});YF.displayName=vX;function yX(u,f=globalThis?.document){const _=_o(u),y=j.useRef(!1),C=j.useRef(()=>{});return j.useEffect(()=>{const A=L=>{if(L.target&&!y.current){let V=function(){qF(EX,_,G,{discrete:!0})};const G={originalEvent:L};L.pointerType==="touch"?(f.removeEventListener("click",C.current),C.current=V,f.addEventListener("click",C.current,{once:!0})):V()}else f.removeEventListener("click",C.current);y.current=!1},D=window.setTimeout(()=>{f.addEventListener("pointerdown",A)},0);return()=>{window.clearTimeout(D),f.removeEventListener("pointerdown",A),f.removeEventListener("click",C.current)}},[f,_]),{onPointerDownCapture:()=>y.current=!0}}function SX(u,f=globalThis?.document){const _=_o(u),y=j.useRef(!1);return j.useEffect(()=>{const C=A=>{A.target&&!y.current&&qF(gX,_,{originalEvent:A},{discrete:!1})};return f.addEventListener("focusin",C),()=>f.removeEventListener("focusin",C)},[f,_]),{onFocusCapture:()=>y.current=!0,onBlurCapture:()=>y.current=!1}}function Uj(){const u=new CustomEvent(TA);document.dispatchEvent(u)}function qF(u,f,_,{discrete:y}){const C=_.originalEvent.target,A=new CustomEvent(u,{bubbles:!1,cancelable:!0,detail:_});f&&C.addEventListener(u,f,{once:!0}),y?KF(C,A):C.dispatchEvent(A)}var TX=CR,RX=YF,oi=globalThis?.document?j.useLayoutEffect:()=>{},CX="Portal",qA=j.forwardRef((u,f)=>{const{container:_,...y}=u,[C,A]=j.useState(!1);oi(()=>A(!0),[]);const D=_||C&&globalThis?.document?.body;return D?WF.createPortal(T.jsx(En.div,{...y,ref:f}),D):null});qA.displayName=CX;function wX(u,f){return j.useReducer((_,y)=>f[_][y]??_,u)}var wR=u=>{const{present:f,children:_}=u,y=bX(f),C=typeof _=="function"?_({present:y.isPresent}):j.Children.only(_),A=yr(y.ref,IX(C));return typeof _=="function"||y.isPresent?j.cloneElement(C,{ref:A}):null};wR.displayName="Presence";function bX(u){const[f,_]=j.useState(),y=j.useRef(null),C=j.useRef(u),A=j.useRef("none"),D=u?"mounted":"unmounted",[L,V]=wX(D,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return j.useEffect(()=>{const G=ZT(y.current);A.current=L==="mounted"?G:"none"},[L]),oi(()=>{const G=y.current,W=C.current;if(W!==u){const ee=A.current,X=ZT(G);u?V("MOUNT"):X==="none"||G?.display==="none"?V("UNMOUNT"):V(W&&ee!==X?"ANIMATION_OUT":"UNMOUNT"),C.current=u}},[u,V]),oi(()=>{if(f){let G;const W=f.ownerDocument.defaultView??window,K=X=>{const q=ZT(y.current).includes(X.animationName);if(X.target===f&&q&&(V("ANIMATION_END"),!C.current)){const $=f.style.animationFillMode;f.style.animationFillMode="forwards",G=W.setTimeout(()=>{f.style.animationFillMode==="forwards"&&(f.style.animationFillMode=$)})}},ee=X=>{X.target===f&&(A.current=ZT(y.current))};return f.addEventListener("animationstart",ee),f.addEventListener("animationcancel",K),f.addEventListener("animationend",K),()=>{W.clearTimeout(G),f.removeEventListener("animationstart",ee),f.removeEventListener("animationcancel",K),f.removeEventListener("animationend",K)}}else V("ANIMATION_END")},[f,V]),{isPresent:["mounted","unmountSuspended"].includes(L),ref:j.useCallback(G=>{y.current=G?getComputedStyle(G):null,_(G)},[])}}function ZT(u){return u?.animationName||"none"}function IX(u){let f=Object.getOwnPropertyDescriptor(u.props,"ref")?.get,_=f&&"isReactWarning"in f&&f.isReactWarning;return _?u.ref:(f=Object.getOwnPropertyDescriptor(u,"ref")?.get,_=f&&"isReactWarning"in f&&f.isReactWarning,_?u.props.ref:u.props.ref||u.ref)}var AX=zA[" useInsertionEffect ".trim().toString()]||oi;function fm({prop:u,defaultProp:f,onChange:_=()=>{},caller:y}){const[C,A,D]=NX({defaultProp:f,onChange:_}),L=u!==void 0,V=L?u:C;{const W=j.useRef(u!==void 0);j.useEffect(()=>{const K=W.current;K!==L&&console.warn(`${y} is changing from ${K?"controlled":"uncontrolled"} to ${L?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),W.current=L},[L,y])}const G=j.useCallback(W=>{if(L){const K=OX(W)?W(u):W;K!==u&&D.current?.(K)}else A(W)},[L,u,A,D]);return[V,G]}function NX({defaultProp:u,onChange:f}){const[_,y]=j.useState(u),C=j.useRef(_),A=j.useRef(f);return AX(()=>{A.current=f},[f]),j.useEffect(()=>{C.current!==_&&(A.current?.(_),C.current=_)},[_,C]),[_,y,A]}function OX(u){return typeof u=="function"}var XF=Object.freeze({position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal"}),PX="VisuallyHidden",bR=j.forwardRef((u,f)=>T.jsx(En.span,{...u,ref:f,style:{...XF,...u.style}}));bR.displayName=PX;var DX=bR,XA="ToastProvider",[JA,kX,LX]=YA("Toast"),[JF]=Ol("Toast",[LX]),[xX,IR]=JF(XA),QF=u=>{const{__scopeToast:f,label:_="Notification",duration:y=5e3,swipeDirection:C="right",swipeThreshold:A=50,children:D}=u,[L,V]=j.useState(null),[G,W]=j.useState(0),K=j.useRef(!1),ee=j.useRef(!1);return _.trim()||console.error(`Invalid prop \`label\` supplied to \`${XA}\`. Expected non-empty \`string\`.`),T.jsx(JA.Provider,{scope:f,children:T.jsx(xX,{scope:f,label:_,duration:y,swipeDirection:C,swipeThreshold:A,toastCount:G,viewport:L,onViewportChange:V,onToastAdd:j.useCallback(()=>W(X=>X+1),[]),onToastRemove:j.useCallback(()=>W(X=>X-1),[]),isFocusedToastEscapeKeyDownRef:K,isClosePausedRef:ee,children:D})})};QF.displayName=XA;var ZF="ToastViewport",MX=["F8"],RA="toast.viewportPause",CA="toast.viewportResume",$F=j.forwardRef((u,f)=>{const{__scopeToast:_,hotkey:y=MX,label:C="Notifications ({hotkey})",...A}=u,D=IR(ZF,_),L=kX(_),V=j.useRef(null),G=j.useRef(null),W=j.useRef(null),K=j.useRef(null),ee=yr(f,K,D.onViewportChange),X=y.join("+").replace(/Key/g,"").replace(/Digit/g,""),re=D.toastCount>0;j.useEffect(()=>{const $=ae=>{y.length!==0&&y.every(le=>ae[le]||ae.code===le)&&K.current?.focus()};return document.addEventListener("keydown",$),()=>document.removeEventListener("keydown",$)},[y]),j.useEffect(()=>{const $=V.current,ae=K.current;if(re&&$&&ae){const oe=()=>{if(!D.isClosePausedRef.current){const Ue=new CustomEvent(RA);ae.dispatchEvent(Ue),D.isClosePausedRef.current=!0}},le=()=>{if(D.isClosePausedRef.current){const Ue=new CustomEvent(CA);ae.dispatchEvent(Ue),D.isClosePausedRef.current=!1}},Se=Ue=>{!$.contains(Ue.relatedTarget)&&le()},be=()=>{$.contains(document.activeElement)||le()};return $.addEventListener("focusin",oe),$.addEventListener("focusout",Se),$.addEventListener("pointermove",oe),$.addEventListener("pointerleave",be),window.addEventListener("blur",oe),window.addEventListener("focus",le),()=>{$.removeEventListener("focusin",oe),$.removeEventListener("focusout",Se),$.removeEventListener("pointermove",oe),$.removeEventListener("pointerleave",be),window.removeEventListener("blur",oe),window.removeEventListener("focus",le)}}},[re,D.isClosePausedRef]);const q=j.useCallback(({tabbingDirection:$})=>{const oe=L().map(le=>{const Se=le.ref.current,be=[Se,...XX(Se)];return $==="forwards"?be:be.reverse()});return($==="forwards"?oe.reverse():oe).flat()},[L]);return j.useEffect(()=>{const $=K.current;if($){const ae=oe=>{const le=oe.altKey||oe.ctrlKey||oe.metaKey;if(oe.key==="Tab"&&!le){const be=document.activeElement,Ue=oe.shiftKey;if(oe.target===$&&Ue){G.current?.focus();return}const lt=q({tabbingDirection:Ue?"backwards":"forwards"}),Et=lt.findIndex(ht=>ht===be);sA(lt.slice(Et+1))?oe.preventDefault():Ue?G.current?.focus():W.current?.focus()}};return $.addEventListener("keydown",ae),()=>$.removeEventListener("keydown",ae)}},[L,q]),T.jsxs(RX,{ref:V,role:"region","aria-label":C.replace("{hotkey}",X),tabIndex:-1,style:{pointerEvents:re?void 0:"none"},children:[re&&T.jsx(wA,{ref:G,onFocusFromOutsideViewport:()=>{const $=q({tabbingDirection:"forwards"});sA($)}}),T.jsx(JA.Slot,{scope:_,children:T.jsx(En.ol,{tabIndex:-1,...A,ref:ee})}),re&&T.jsx(wA,{ref:W,onFocusFromOutsideViewport:()=>{const $=q({tabbingDirection:"backwards"});sA($)}})]})});$F.displayName=ZF;var eB="ToastFocusProxy",wA=j.forwardRef((u,f)=>{const{__scopeToast:_,onFocusFromOutsideViewport:y,...C}=u,A=IR(eB,_);return T.jsx(bR,{"aria-hidden":!0,tabIndex:0,...C,ref:f,style:{position:"fixed"},onFocus:D=>{const L=D.relatedTarget;!A.viewport?.contains(L)&&y()}})});wA.displayName=eB;var Wg="Toast",UX="toast.swipeStart",VX="toast.swipeMove",jX="toast.swipeCancel",FX="toast.swipeEnd",tB=j.forwardRef((u,f)=>{const{forceMount:_,open:y,defaultOpen:C,onOpenChange:A,...D}=u,[L,V]=fm({prop:y,defaultProp:C??!0,onChange:A,caller:Wg});return T.jsx(wR,{present:_||L,children:T.jsx(GX,{open:L,...D,ref:f,onClose:()=>V(!1),onPause:_o(u.onPause),onResume:_o(u.onResume),onSwipeStart:$t(u.onSwipeStart,G=>{G.currentTarget.setAttribute("data-swipe","start")}),onSwipeMove:$t(u.onSwipeMove,G=>{const{x:W,y:K}=G.detail.delta;G.currentTarget.setAttribute("data-swipe","move"),G.currentTarget.style.setProperty("--radix-toast-swipe-move-x",`${W}px`),G.currentTarget.style.setProperty("--radix-toast-swipe-move-y",`${K}px`)}),onSwipeCancel:$t(u.onSwipeCancel,G=>{G.currentTarget.setAttribute("data-swipe","cancel"),G.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),G.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),G.currentTarget.style.removeProperty("--radix-toast-swipe-end-x"),G.currentTarget.style.removeProperty("--radix-toast-swipe-end-y")}),onSwipeEnd:$t(u.onSwipeEnd,G=>{const{x:W,y:K}=G.detail.delta;G.currentTarget.setAttribute("data-swipe","end"),G.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),G.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),G.currentTarget.style.setProperty("--radix-toast-swipe-end-x",`${W}px`),G.currentTarget.style.setProperty("--radix-toast-swipe-end-y",`${K}px`),V(!1)})})})});tB.displayName=Wg;var[BX,WX]=JF(Wg,{onClose(){}}),GX=j.forwardRef((u,f)=>{const{__scopeToast:_,type:y="foreground",duration:C,open:A,onClose:D,onEscapeKeyDown:L,onPause:V,onResume:G,onSwipeStart:W,onSwipeMove:K,onSwipeCancel:ee,onSwipeEnd:X,...re}=u,q=IR(Wg,_),[$,ae]=j.useState(null),oe=yr(f,Fe=>ae(Fe)),le=j.useRef(null),Se=j.useRef(null),be=C||q.duration,Ue=j.useRef(0),xe=j.useRef(be),je=j.useRef(0),{onToastAdd:lt,onToastRemove:Et}=q,ht=_o(()=>{$?.contains(document.activeElement)&&q.viewport?.focus(),D()}),Ge=j.useCallback(Fe=>{!Fe||Fe===1/0||(window.clearTimeout(je.current),Ue.current=new Date().getTime(),je.current=window.setTimeout(ht,Fe))},[ht]);j.useEffect(()=>{const Fe=q.viewport;if(Fe){const Ct=()=>{Ge(xe.current),G?.()},nt=()=>{const Je=new Date().getTime()-Ue.current;xe.current=xe.current-Je,window.clearTimeout(je.current),V?.()};return Fe.addEventListener(RA,nt),Fe.addEventListener(CA,Ct),()=>{Fe.removeEventListener(RA,nt),Fe.removeEventListener(CA,Ct)}}},[q.viewport,be,V,G,Ge]),j.useEffect(()=>{A&&!q.isClosePausedRef.current&&Ge(be)},[A,be,q.isClosePausedRef,Ge]),j.useEffect(()=>(lt(),()=>Et()),[lt,Et]);const pt=j.useMemo(()=>$?cB($):null,[$]);return q.viewport?T.jsxs(T.Fragment,{children:[pt&&T.jsx(HX,{__scopeToast:_,role:"status","aria-live":y==="foreground"?"assertive":"polite","aria-atomic":!0,children:pt}),T.jsx(BX,{scope:_,onClose:ht,children:gm.createPortal(T.jsx(JA.ItemSlot,{scope:_,children:T.jsx(TX,{asChild:!0,onEscapeKeyDown:$t(L,()=>{q.isFocusedToastEscapeKeyDownRef.current||ht(),q.isFocusedToastEscapeKeyDownRef.current=!1}),children:T.jsx(En.li,{role:"status","aria-live":"off","aria-atomic":!0,tabIndex:0,"data-state":A?"open":"closed","data-swipe-direction":q.swipeDirection,...re,ref:oe,style:{userSelect:"none",touchAction:"none",...u.style},onKeyDown:$t(u.onKeyDown,Fe=>{Fe.key==="Escape"&&(L?.(Fe.nativeEvent),Fe.nativeEvent.defaultPrevented||(q.isFocusedToastEscapeKeyDownRef.current=!0,ht()))}),onPointerDown:$t(u.onPointerDown,Fe=>{Fe.button===0&&(le.current={x:Fe.clientX,y:Fe.clientY})}),onPointerMove:$t(u.onPointerMove,Fe=>{if(!le.current)return;const Ct=Fe.clientX-le.current.x,nt=Fe.clientY-le.current.y,Je=!!Se.current,Oe=["left","right"].includes(q.swipeDirection),ke=["left","up"].includes(q.swipeDirection)?Math.min:Math.max,ze=Oe?ke(0,Ct):0,he=Oe?0:ke(0,nt),Ie=Fe.pointerType==="touch"?10:2,it={x:ze,y:he},rt={originalEvent:Fe,delta:it};Je?(Se.current=it,$T(VX,K,rt,{discrete:!1})):Vj(it,q.swipeDirection,Ie)?(Se.current=it,$T(UX,W,rt,{discrete:!1}),Fe.target.setPointerCapture(Fe.pointerId)):(Math.abs(Ct)>Ie||Math.abs(nt)>Ie)&&(le.current=null)}),onPointerUp:$t(u.onPointerUp,Fe=>{const Ct=Se.current,nt=Fe.target;if(nt.hasPointerCapture(Fe.pointerId)&&nt.releasePointerCapture(Fe.pointerId),Se.current=null,le.current=null,Ct){const Je=Fe.currentTarget,Oe={originalEvent:Fe,delta:Ct};Vj(Ct,q.swipeDirection,q.swipeThreshold)?$T(FX,X,Oe,{discrete:!0}):$T(jX,ee,Oe,{discrete:!0}),Je.addEventListener("click",ke=>ke.preventDefault(),{once:!0})}})})})}),q.viewport)})]}):null}),HX=u=>{const{__scopeToast:f,children:_,...y}=u,C=IR(Wg,f),[A,D]=j.useState(!1),[L,V]=j.useState(!1);return YX(()=>D(!0)),j.useEffect(()=>{const G=window.setTimeout(()=>V(!0),1e3);return()=>window.clearTimeout(G)},[]),L?null:T.jsx(qA,{asChild:!0,children:T.jsx(bR,{...y,children:A&&T.jsxs(T.Fragment,{children:[C.label," ",_]})})})},KX="ToastTitle",nB=j.forwardRef((u,f)=>{const{__scopeToast:_,...y}=u;return T.jsx(En.div,{...y,ref:f})});nB.displayName=KX;var zX="ToastDescription",rB=j.forwardRef((u,f)=>{const{__scopeToast:_,...y}=u;return T.jsx(En.div,{...y,ref:f})});rB.displayName=zX;var iB="ToastAction",sB=j.forwardRef((u,f)=>{const{altText:_,...y}=u;return _.trim()?T.jsx(aB,{altText:_,asChild:!0,children:T.jsx(QA,{...y,ref:f})}):(console.error(`Invalid prop \`altText\` supplied to \`${iB}\`. Expected non-empty \`string\`.`),null)});sB.displayName=iB;var oB="ToastClose",QA=j.forwardRef((u,f)=>{const{__scopeToast:_,...y}=u,C=WX(oB,_);return T.jsx(aB,{asChild:!0,children:T.jsx(En.button,{type:"button",...y,ref:f,onClick:$t(u.onClick,C.onClose)})})});QA.displayName=oB;var aB=j.forwardRef((u,f)=>{const{__scopeToast:_,altText:y,...C}=u;return T.jsx(En.div,{"data-radix-toast-announce-exclude":"","data-radix-toast-announce-alt":y||void 0,...C,ref:f})});function cB(u){const f=[];return Array.from(u.childNodes).forEach(y=>{if(y.nodeType===y.TEXT_NODE&&y.textContent&&f.push(y.textContent),qX(y)){const C=y.ariaHidden||y.hidden||y.style.display==="none",A=y.dataset.radixToastAnnounceExclude==="";if(!C)if(A){const D=y.dataset.radixToastAnnounceAlt;D&&f.push(D)}else f.push(...cB(y))}}),f}function $T(u,f,_,{discrete:y}){const C=_.originalEvent.currentTarget,A=new CustomEvent(u,{bubbles:!0,cancelable:!0,detail:_});f&&C.addEventListener(u,f,{once:!0}),y?KF(C,A):C.dispatchEvent(A)}var Vj=(u,f,_=0)=>{const y=Math.abs(u.x),C=Math.abs(u.y),A=y>C;return f==="left"||f==="right"?A&&y>_:!A&&C>_};function YX(u=()=>{}){const f=_o(u);oi(()=>{let _=0,y=0;return _=window.requestAnimationFrame(()=>y=window.requestAnimationFrame(f)),()=>{window.cancelAnimationFrame(_),window.cancelAnimationFrame(y)}},[f])}function qX(u){return u.nodeType===u.ELEMENT_NODE}function XX(u){const f=[],_=document.createTreeWalker(u,NodeFilter.SHOW_ELEMENT,{acceptNode:y=>{const C=y.tagName==="INPUT"&&y.type==="hidden";return y.disabled||y.hidden||C?NodeFilter.FILTER_SKIP:y.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;_.nextNode();)f.push(_.currentNode);return f}function sA(u){const f=document.activeElement;return u.some(_=>_===f?!0:(_.focus(),document.activeElement!==f))}var JX=QF,lB=$F,dB=tB,uB=nB,hB=rB,pB=sB,fB=QA;function mB(u){var f,_,y="";if(typeof u=="string"||typeof u=="number")y+=u;else if(typeof u=="object")if(Array.isArray(u)){var C=u.length;for(f=0;f<C;f++)u[f]&&(_=mB(u[f]))&&(y&&(y+=" "),y+=_)}else for(_ in u)u[_]&&(y&&(y+=" "),y+=_);return y}function _B(){for(var u,f,_=0,y="",C=arguments.length;_<C;_++)(u=arguments[_])&&(f=mB(u))&&(y&&(y+=" "),y+=f);return y}const jj=u=>typeof u=="boolean"?`${u}`:u===0?"0":u,Fj=_B,ZA=(u,f)=>_=>{var y;if(f?.variants==null)return Fj(u,_?.class,_?.className);const{variants:C,defaultVariants:A}=f,D=Object.keys(C).map(G=>{const W=_?.[G],K=A?.[G];if(W===null)return null;const ee=jj(W)||jj(K);return C[G][ee]}),L=_&&Object.entries(_).reduce((G,W)=>{let[K,ee]=W;return ee===void 0||(G[K]=ee),G},{}),V=f==null||(y=f.compoundVariants)===null||y===void 0?void 0:y.reduce((G,W)=>{let{class:K,className:ee,...X}=W;return Object.entries(X).every(re=>{let[q,$]=re;return Array.isArray($)?$.includes({...A,...L}[q]):{...A,...L}[q]===$})?[...G,K,ee]:G},[]);return Fj(u,D,V,_?.class,_?.className)};/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const QX=u=>u.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),EB=(...u)=>u.filter((f,_,y)=>!!f&&f.trim()!==""&&y.indexOf(f)===_).join(" ").trim();/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var ZX={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $X=j.forwardRef(({color:u="currentColor",size:f=24,strokeWidth:_=2,absoluteStrokeWidth:y,className:C="",children:A,iconNode:D,...L},V)=>j.createElement("svg",{ref:V,...ZX,width:f,height:f,stroke:u,strokeWidth:y?Number(_)*24/Number(f):_,className:EB("lucide",C),...L},[...D.map(([G,W])=>j.createElement(G,W)),...Array.isArray(A)?A:[A]]));/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hn=(u,f)=>{const _=j.forwardRef(({className:y,...C},A)=>j.createElement($X,{ref:A,iconNode:f,className:EB(`lucide-${QX(u)}`,y),...C}));return _.displayName=`${u}`,_};/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $A=hn("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bA=hn("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const eJ=hn("Award",[["path",{d:"m15.477 12.89 1.515 8.526a.5.5 0 0 1-.81.47l-3.58-2.687a1 1 0 0 0-1.197 0l-3.586 2.686a.5.5 0 0 1-.81-.469l1.514-8.526",key:"1yiouv"}],["circle",{cx:"12",cy:"8",r:"6",key:"1vp47v"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tJ=hn("Bell",[["path",{d:"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9",key:"1qo2s2"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gB=hn("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nJ=hn("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vB=hn("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rJ=hn("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mm=hn("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yB=hn("Coffee",[["path",{d:"M10 2v2",key:"7u0qdc"}],["path",{d:"M14 2v2",key:"6buw04"}],["path",{d:"M16 8a1 1 0 0 1 1 1v8a4 4 0 0 1-4 4H7a4 4 0 0 1-4-4V9a1 1 0 0 1 1-1h14a4 4 0 1 1 0 8h-1",key:"pwadti"}],["path",{d:"M6 2v2",key:"colzsn"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bj=hn("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const iJ=hn("Ellipsis",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wj=hn("EyeOff",[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gj=hn("Eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sJ=hn("Flag",[["path",{d:"M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z",key:"i9b6wo"}],["line",{x1:"4",x2:"4",y1:"22",y2:"15",key:"1cm3nv"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oJ=hn("Flame",[["path",{d:"M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z",key:"96xj49"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Hj=hn("Ghost",[["path",{d:"M9 10h.01",key:"qbtxuw"}],["path",{d:"M15 10h.01",key:"1qmjsl"}],["path",{d:"M12 2a8 8 0 0 0-8 8v12l3-3 2.5 2.5L12 19l2.5 2.5L17 19l3 3V10a8 8 0 0 0-8-8z",key:"uwwb07"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const aJ=hn("Globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Kj=hn("Hash",[["line",{x1:"4",x2:"20",y1:"9",y2:"9",key:"4lhtct"}],["line",{x1:"4",x2:"20",y1:"15",y2:"15",key:"vyu0kd"}],["line",{x1:"10",x2:"8",y1:"3",y2:"21",key:"1ggp8o"}],["line",{x1:"16",x2:"14",y1:"3",y2:"21",key:"weycgp"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cJ=hn("Heart",[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lJ=hn("House",[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8",key:"5wwlr5"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-5.999a2 2 0 0 1 2.582 0l7 5.999A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"1d0kgt"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zj=hn("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yj=hn("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const AR=hn("MessageCircle",[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z",key:"vv11sd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qj=hn("Mic",[["path",{d:"M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z",key:"131961"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dJ=hn("Moon",[["path",{d:"M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z",key:"a7tn18"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const uJ=hn("Pen",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xj=hn("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const SB=hn("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hJ=hn("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pJ=hn("Share2",[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const NR=hn("Shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const TB=hn("Sun",[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"m17.66 17.66 1.41 1.41",key:"ptbguv"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m6.34 17.66-1.41 1.41",key:"1m8zz5"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fJ=hn("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dR=hn("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mJ=hn("TriangleAlert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _J=hn("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const RB=hn("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const EJ=hn("Video",[["path",{d:"m16 13 5.223 3.482a.5.5 0 0 0 .777-.416V7.87a.5.5 0 0 0-.752-.432L16 10.5",key:"ftymec"}],["rect",{x:"2",y:"6",width:"14",height:"12",rx:"2",key:"158x01"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gJ=hn("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const CB=hn("Zap",[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]]),eN="-",vJ=u=>{const f=SJ(u),{conflictingClassGroups:_,conflictingClassGroupModifiers:y}=u;return{getClassGroupId:D=>{const L=D.split(eN);return L[0]===""&&L.length!==1&&L.shift(),wB(L,f)||yJ(D)},getConflictingClassGroupIds:(D,L)=>{const V=_[D]||[];return L&&y[D]?[...V,...y[D]]:V}}},wB=(u,f)=>{if(u.length===0)return f.classGroupId;const _=u[0],y=f.nextPart.get(_),C=y?wB(u.slice(1),y):void 0;if(C)return C;if(f.validators.length===0)return;const A=u.join(eN);return f.validators.find(({validator:D})=>D(A))?.classGroupId},Jj=/^\[(.+)\]$/,yJ=u=>{if(Jj.test(u)){const f=Jj.exec(u)[1],_=f?.substring(0,f.indexOf(":"));if(_)return"arbitrary.."+_}},SJ=u=>{const{theme:f,prefix:_}=u,y={nextPart:new Map,validators:[]};return RJ(Object.entries(u.classGroups),_).forEach(([A,D])=>{IA(D,y,A,f)}),y},IA=(u,f,_,y)=>{u.forEach(C=>{if(typeof C=="string"){const A=C===""?f:Qj(f,C);A.classGroupId=_;return}if(typeof C=="function"){if(TJ(C)){IA(C(y),f,_,y);return}f.validators.push({validator:C,classGroupId:_});return}Object.entries(C).forEach(([A,D])=>{IA(D,Qj(f,A),_,y)})})},Qj=(u,f)=>{let _=u;return f.split(eN).forEach(y=>{_.nextPart.has(y)||_.nextPart.set(y,{nextPart:new Map,validators:[]}),_=_.nextPart.get(y)}),_},TJ=u=>u.isThemeGetter,RJ=(u,f)=>f?u.map(([_,y])=>{const C=y.map(A=>typeof A=="string"?f+A:typeof A=="object"?Object.fromEntries(Object.entries(A).map(([D,L])=>[f+D,L])):A);return[_,C]}):u,CJ=u=>{if(u<1)return{get:()=>{},set:()=>{}};let f=0,_=new Map,y=new Map;const C=(A,D)=>{_.set(A,D),f++,f>u&&(f=0,y=_,_=new Map)};return{get(A){let D=_.get(A);if(D!==void 0)return D;if((D=y.get(A))!==void 0)return C(A,D),D},set(A,D){_.has(A)?_.set(A,D):C(A,D)}}},bB="!",wJ=u=>{const{separator:f,experimentalParseClassName:_}=u,y=f.length===1,C=f[0],A=f.length,D=L=>{const V=[];let G=0,W=0,K;for(let $=0;$<L.length;$++){let ae=L[$];if(G===0){if(ae===C&&(y||L.slice($,$+A)===f)){V.push(L.slice(W,$)),W=$+A;continue}if(ae==="/"){K=$;continue}}ae==="["?G++:ae==="]"&&G--}const ee=V.length===0?L:L.substring(W),X=ee.startsWith(bB),re=X?ee.substring(1):ee,q=K&&K>W?K-W:void 0;return{modifiers:V,hasImportantModifier:X,baseClassName:re,maybePostfixModifierPosition:q}};return _?L=>_({className:L,parseClassName:D}):D},bJ=u=>{if(u.length<=1)return u;const f=[];let _=[];return u.forEach(y=>{y[0]==="["?(f.push(..._.sort(),y),_=[]):_.push(y)}),f.push(..._.sort()),f},IJ=u=>({cache:CJ(u.cacheSize),parseClassName:wJ(u),...vJ(u)}),AJ=/\s+/,NJ=(u,f)=>{const{parseClassName:_,getClassGroupId:y,getConflictingClassGroupIds:C}=f,A=[],D=u.trim().split(AJ);let L="";for(let V=D.length-1;V>=0;V-=1){const G=D[V],{modifiers:W,hasImportantModifier:K,baseClassName:ee,maybePostfixModifierPosition:X}=_(G);let re=!!X,q=y(re?ee.substring(0,X):ee);if(!q){if(!re){L=G+(L.length>0?" "+L:L);continue}if(q=y(ee),!q){L=G+(L.length>0?" "+L:L);continue}re=!1}const $=bJ(W).join(":"),ae=K?$+bB:$,oe=ae+q;if(A.includes(oe))continue;A.push(oe);const le=C(q,re);for(let Se=0;Se<le.length;++Se){const be=le[Se];A.push(ae+be)}L=G+(L.length>0?" "+L:L)}return L};function OJ(){let u=0,f,_,y="";for(;u<arguments.length;)(f=arguments[u++])&&(_=IB(f))&&(y&&(y+=" "),y+=_);return y}const IB=u=>{if(typeof u=="string")return u;let f,_="";for(let y=0;y<u.length;y++)u[y]&&(f=IB(u[y]))&&(_&&(_+=" "),_+=f);return _};function PJ(u,...f){let _,y,C,A=D;function D(V){const G=f.reduce((W,K)=>K(W),u());return _=IJ(G),y=_.cache.get,C=_.cache.set,A=L,L(V)}function L(V){const G=y(V);if(G)return G;const W=NJ(V,_);return C(V,W),W}return function(){return A(OJ.apply(null,arguments))}}const vr=u=>{const f=_=>_[u]||[];return f.isThemeGetter=!0,f},AB=/^\[(?:([a-z-]+):)?(.+)\]$/i,DJ=/^\d+\/\d+$/,kJ=new Set(["px","full","screen"]),LJ=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,xJ=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,MJ=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,UJ=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,VJ=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,Il=u=>dm(u)||kJ.has(u)||DJ.test(u),Yd=u=>vm(u,"length",zJ),dm=u=>!!u&&!Number.isNaN(Number(u)),oA=u=>vm(u,"number",dm),Ag=u=>!!u&&Number.isInteger(Number(u)),jJ=u=>u.endsWith("%")&&dm(u.slice(0,-1)),un=u=>AB.test(u),qd=u=>LJ.test(u),FJ=new Set(["length","size","percentage"]),BJ=u=>vm(u,FJ,NB),WJ=u=>vm(u,"position",NB),GJ=new Set(["image","url"]),HJ=u=>vm(u,GJ,qJ),KJ=u=>vm(u,"",YJ),Ng=()=>!0,vm=(u,f,_)=>{const y=AB.exec(u);return y?y[1]?typeof f=="string"?y[1]===f:f.has(y[1]):_(y[2]):!1},zJ=u=>xJ.test(u)&&!MJ.test(u),NB=()=>!1,YJ=u=>UJ.test(u),qJ=u=>VJ.test(u),XJ=()=>{const u=vr("colors"),f=vr("spacing"),_=vr("blur"),y=vr("brightness"),C=vr("borderColor"),A=vr("borderRadius"),D=vr("borderSpacing"),L=vr("borderWidth"),V=vr("contrast"),G=vr("grayscale"),W=vr("hueRotate"),K=vr("invert"),ee=vr("gap"),X=vr("gradientColorStops"),re=vr("gradientColorStopPositions"),q=vr("inset"),$=vr("margin"),ae=vr("opacity"),oe=vr("padding"),le=vr("saturate"),Se=vr("scale"),be=vr("sepia"),Ue=vr("skew"),xe=vr("space"),je=vr("translate"),lt=()=>["auto","contain","none"],Et=()=>["auto","hidden","clip","visible","scroll"],ht=()=>["auto",un,f],Ge=()=>[un,f],pt=()=>["",Il,Yd],Fe=()=>["auto",dm,un],Ct=()=>["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top"],nt=()=>["solid","dashed","dotted","double","none"],Je=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],Oe=()=>["start","end","center","between","around","evenly","stretch"],ke=()=>["","0",un],ze=()=>["auto","avoid","all","avoid-page","page","left","right","column"],he=()=>[dm,un];return{cacheSize:500,separator:":",theme:{colors:[Ng],spacing:[Il,Yd],blur:["none","",qd,un],brightness:he(),borderColor:[u],borderRadius:["none","","full",qd,un],borderSpacing:Ge(),borderWidth:pt(),contrast:he(),grayscale:ke(),hueRotate:he(),invert:ke(),gap:Ge(),gradientColorStops:[u],gradientColorStopPositions:[jJ,Yd],inset:ht(),margin:ht(),opacity:he(),padding:Ge(),saturate:he(),scale:he(),sepia:ke(),skew:he(),space:Ge(),translate:Ge()},classGroups:{aspect:[{aspect:["auto","square","video",un]}],container:["container"],columns:[{columns:[qd]}],"break-after":[{"break-after":ze()}],"break-before":[{"break-before":ze()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:[...Ct(),un]}],overflow:[{overflow:Et()}],"overflow-x":[{"overflow-x":Et()}],"overflow-y":[{"overflow-y":Et()}],overscroll:[{overscroll:lt()}],"overscroll-x":[{"overscroll-x":lt()}],"overscroll-y":[{"overscroll-y":lt()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:[q]}],"inset-x":[{"inset-x":[q]}],"inset-y":[{"inset-y":[q]}],start:[{start:[q]}],end:[{end:[q]}],top:[{top:[q]}],right:[{right:[q]}],bottom:[{bottom:[q]}],left:[{left:[q]}],visibility:["visible","invisible","collapse"],z:[{z:["auto",Ag,un]}],basis:[{basis:ht()}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["wrap","wrap-reverse","nowrap"]}],flex:[{flex:["1","auto","initial","none",un]}],grow:[{grow:ke()}],shrink:[{shrink:ke()}],order:[{order:["first","last","none",Ag,un]}],"grid-cols":[{"grid-cols":[Ng]}],"col-start-end":[{col:["auto",{span:["full",Ag,un]},un]}],"col-start":[{"col-start":Fe()}],"col-end":[{"col-end":Fe()}],"grid-rows":[{"grid-rows":[Ng]}],"row-start-end":[{row:["auto",{span:[Ag,un]},un]}],"row-start":[{"row-start":Fe()}],"row-end":[{"row-end":Fe()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":["auto","min","max","fr",un]}],"auto-rows":[{"auto-rows":["auto","min","max","fr",un]}],gap:[{gap:[ee]}],"gap-x":[{"gap-x":[ee]}],"gap-y":[{"gap-y":[ee]}],"justify-content":[{justify:["normal",...Oe()]}],"justify-items":[{"justify-items":["start","end","center","stretch"]}],"justify-self":[{"justify-self":["auto","start","end","center","stretch"]}],"align-content":[{content:["normal",...Oe(),"baseline"]}],"align-items":[{items:["start","end","center","baseline","stretch"]}],"align-self":[{self:["auto","start","end","center","stretch","baseline"]}],"place-content":[{"place-content":[...Oe(),"baseline"]}],"place-items":[{"place-items":["start","end","center","baseline","stretch"]}],"place-self":[{"place-self":["auto","start","end","center","stretch"]}],p:[{p:[oe]}],px:[{px:[oe]}],py:[{py:[oe]}],ps:[{ps:[oe]}],pe:[{pe:[oe]}],pt:[{pt:[oe]}],pr:[{pr:[oe]}],pb:[{pb:[oe]}],pl:[{pl:[oe]}],m:[{m:[$]}],mx:[{mx:[$]}],my:[{my:[$]}],ms:[{ms:[$]}],me:[{me:[$]}],mt:[{mt:[$]}],mr:[{mr:[$]}],mb:[{mb:[$]}],ml:[{ml:[$]}],"space-x":[{"space-x":[xe]}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":[xe]}],"space-y-reverse":["space-y-reverse"],w:[{w:["auto","min","max","fit","svw","lvw","dvw",un,f]}],"min-w":[{"min-w":[un,f,"min","max","fit"]}],"max-w":[{"max-w":[un,f,"none","full","min","max","fit","prose",{screen:[qd]},qd]}],h:[{h:[un,f,"auto","min","max","fit","svh","lvh","dvh"]}],"min-h":[{"min-h":[un,f,"min","max","fit","svh","lvh","dvh"]}],"max-h":[{"max-h":[un,f,"min","max","fit","svh","lvh","dvh"]}],size:[{size:[un,f,"auto","min","max","fit"]}],"font-size":[{text:["base",qd,Yd]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:["thin","extralight","light","normal","medium","semibold","bold","extrabold","black",oA]}],"font-family":[{font:[Ng]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:["tighter","tight","normal","wide","wider","widest",un]}],"line-clamp":[{"line-clamp":["none",dm,oA]}],leading:[{leading:["none","tight","snug","normal","relaxed","loose",Il,un]}],"list-image":[{"list-image":["none",un]}],"list-style-type":[{list:["none","disc","decimal",un]}],"list-style-position":[{list:["inside","outside"]}],"placeholder-color":[{placeholder:[u]}],"placeholder-opacity":[{"placeholder-opacity":[ae]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"text-color":[{text:[u]}],"text-opacity":[{"text-opacity":[ae]}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...nt(),"wavy"]}],"text-decoration-thickness":[{decoration:["auto","from-font",Il,Yd]}],"underline-offset":[{"underline-offset":["auto",Il,un]}],"text-decoration-color":[{decoration:[u]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:Ge()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",un]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",un]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-opacity":[{"bg-opacity":[ae]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:[...Ct(),WJ]}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","round","space"]}]}],"bg-size":[{bg:["auto","cover","contain",BJ]}],"bg-image":[{bg:["none",{"gradient-to":["t","tr","r","br","b","bl","l","tl"]},HJ]}],"bg-color":[{bg:[u]}],"gradient-from-pos":[{from:[re]}],"gradient-via-pos":[{via:[re]}],"gradient-to-pos":[{to:[re]}],"gradient-from":[{from:[X]}],"gradient-via":[{via:[X]}],"gradient-to":[{to:[X]}],rounded:[{rounded:[A]}],"rounded-s":[{"rounded-s":[A]}],"rounded-e":[{"rounded-e":[A]}],"rounded-t":[{"rounded-t":[A]}],"rounded-r":[{"rounded-r":[A]}],"rounded-b":[{"rounded-b":[A]}],"rounded-l":[{"rounded-l":[A]}],"rounded-ss":[{"rounded-ss":[A]}],"rounded-se":[{"rounded-se":[A]}],"rounded-ee":[{"rounded-ee":[A]}],"rounded-es":[{"rounded-es":[A]}],"rounded-tl":[{"rounded-tl":[A]}],"rounded-tr":[{"rounded-tr":[A]}],"rounded-br":[{"rounded-br":[A]}],"rounded-bl":[{"rounded-bl":[A]}],"border-w":[{border:[L]}],"border-w-x":[{"border-x":[L]}],"border-w-y":[{"border-y":[L]}],"border-w-s":[{"border-s":[L]}],"border-w-e":[{"border-e":[L]}],"border-w-t":[{"border-t":[L]}],"border-w-r":[{"border-r":[L]}],"border-w-b":[{"border-b":[L]}],"border-w-l":[{"border-l":[L]}],"border-opacity":[{"border-opacity":[ae]}],"border-style":[{border:[...nt(),"hidden"]}],"divide-x":[{"divide-x":[L]}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":[L]}],"divide-y-reverse":["divide-y-reverse"],"divide-opacity":[{"divide-opacity":[ae]}],"divide-style":[{divide:nt()}],"border-color":[{border:[C]}],"border-color-x":[{"border-x":[C]}],"border-color-y":[{"border-y":[C]}],"border-color-s":[{"border-s":[C]}],"border-color-e":[{"border-e":[C]}],"border-color-t":[{"border-t":[C]}],"border-color-r":[{"border-r":[C]}],"border-color-b":[{"border-b":[C]}],"border-color-l":[{"border-l":[C]}],"divide-color":[{divide:[C]}],"outline-style":[{outline:["",...nt()]}],"outline-offset":[{"outline-offset":[Il,un]}],"outline-w":[{outline:[Il,Yd]}],"outline-color":[{outline:[u]}],"ring-w":[{ring:pt()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:[u]}],"ring-opacity":[{"ring-opacity":[ae]}],"ring-offset-w":[{"ring-offset":[Il,Yd]}],"ring-offset-color":[{"ring-offset":[u]}],shadow:[{shadow:["","inner","none",qd,KJ]}],"shadow-color":[{shadow:[Ng]}],opacity:[{opacity:[ae]}],"mix-blend":[{"mix-blend":[...Je(),"plus-lighter","plus-darker"]}],"bg-blend":[{"bg-blend":Je()}],filter:[{filter:["","none"]}],blur:[{blur:[_]}],brightness:[{brightness:[y]}],contrast:[{contrast:[V]}],"drop-shadow":[{"drop-shadow":["","none",qd,un]}],grayscale:[{grayscale:[G]}],"hue-rotate":[{"hue-rotate":[W]}],invert:[{invert:[K]}],saturate:[{saturate:[le]}],sepia:[{sepia:[be]}],"backdrop-filter":[{"backdrop-filter":["","none"]}],"backdrop-blur":[{"backdrop-blur":[_]}],"backdrop-brightness":[{"backdrop-brightness":[y]}],"backdrop-contrast":[{"backdrop-contrast":[V]}],"backdrop-grayscale":[{"backdrop-grayscale":[G]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[W]}],"backdrop-invert":[{"backdrop-invert":[K]}],"backdrop-opacity":[{"backdrop-opacity":[ae]}],"backdrop-saturate":[{"backdrop-saturate":[le]}],"backdrop-sepia":[{"backdrop-sepia":[be]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":[D]}],"border-spacing-x":[{"border-spacing-x":[D]}],"border-spacing-y":[{"border-spacing-y":[D]}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["none","all","","colors","opacity","shadow","transform",un]}],duration:[{duration:he()}],ease:[{ease:["linear","in","out","in-out",un]}],delay:[{delay:he()}],animate:[{animate:["none","spin","ping","pulse","bounce",un]}],transform:[{transform:["","gpu","none"]}],scale:[{scale:[Se]}],"scale-x":[{"scale-x":[Se]}],"scale-y":[{"scale-y":[Se]}],rotate:[{rotate:[Ag,un]}],"translate-x":[{"translate-x":[je]}],"translate-y":[{"translate-y":[je]}],"skew-x":[{"skew-x":[Ue]}],"skew-y":[{"skew-y":[Ue]}],"transform-origin":[{origin:["center","top","top-right","right","bottom-right","bottom","bottom-left","left","top-left",un]}],accent:[{accent:["auto",u]}],appearance:[{appearance:["none","auto"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",un]}],"caret-color":[{caret:[u]}],"pointer-events":[{"pointer-events":["none","auto"]}],resize:[{resize:["none","y","x",""]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":Ge()}],"scroll-mx":[{"scroll-mx":Ge()}],"scroll-my":[{"scroll-my":Ge()}],"scroll-ms":[{"scroll-ms":Ge()}],"scroll-me":[{"scroll-me":Ge()}],"scroll-mt":[{"scroll-mt":Ge()}],"scroll-mr":[{"scroll-mr":Ge()}],"scroll-mb":[{"scroll-mb":Ge()}],"scroll-ml":[{"scroll-ml":Ge()}],"scroll-p":[{"scroll-p":Ge()}],"scroll-px":[{"scroll-px":Ge()}],"scroll-py":[{"scroll-py":Ge()}],"scroll-ps":[{"scroll-ps":Ge()}],"scroll-pe":[{"scroll-pe":Ge()}],"scroll-pt":[{"scroll-pt":Ge()}],"scroll-pr":[{"scroll-pr":Ge()}],"scroll-pb":[{"scroll-pb":Ge()}],"scroll-pl":[{"scroll-pl":Ge()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",un]}],fill:[{fill:[u,"none"]}],"stroke-w":[{stroke:[Il,Yd,oA]}],stroke:[{stroke:[u,"none"]}],sr:["sr-only","not-sr-only"],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]}}},JJ=PJ(XJ);function Vn(...u){return JJ(_B(u))}const QJ=JX,OB=j.forwardRef(({className:u,...f},_)=>T.jsx(lB,{ref:_,className:Vn("fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",u),...f}));OB.displayName=lB.displayName;const ZJ=ZA("group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full",{variants:{variant:{default:"border bg-background text-foreground",destructive:"destructive group border-destructive bg-destructive text-destructive-foreground"}},defaultVariants:{variant:"default"}}),PB=j.forwardRef(({className:u,variant:f,..._},y)=>T.jsx(dB,{ref:y,className:Vn(ZJ({variant:f}),u),..._}));PB.displayName=dB.displayName;const $J=j.forwardRef(({className:u,...f},_)=>T.jsx(pB,{ref:_,className:Vn("inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors group-[.destructive]:border-muted/40 hover:bg-secondary group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 group-[.destructive]:focus:ring-destructive disabled:pointer-events-none disabled:opacity-50",u),...f}));$J.displayName=pB.displayName;const DB=j.forwardRef(({className:u,...f},_)=>T.jsx(fB,{ref:_,className:Vn("absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity group-hover:opacity-100 group-[.destructive]:text-red-300 hover:text-foreground group-[.destructive]:hover:text-red-50 focus:opacity-100 focus:outline-none focus:ring-2 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",u),"toast-close":"",...f,children:T.jsx(gJ,{className:"h-4 w-4"})}));DB.displayName=fB.displayName;const kB=j.forwardRef(({className:u,...f},_)=>T.jsx(uB,{ref:_,className:Vn("text-sm font-semibold",u),...f}));kB.displayName=uB.displayName;const LB=j.forwardRef(({className:u,...f},_)=>T.jsx(hB,{ref:_,className:Vn("text-sm opacity-90",u),...f}));LB.displayName=hB.displayName;function eQ(){const{toasts:u}=Bg();return T.jsxs(QJ,{children:[u.map(function({id:f,title:_,description:y,action:C,...A}){return T.jsxs(PB,{...A,children:[T.jsxs("div",{className:"grid gap-1",children:[_&&T.jsx(kB,{children:_}),y&&T.jsx(LB,{children:y})]}),C,T.jsx(DB,{})]},f)}),T.jsx(OB,{})]})}var tQ=(u,f,_,y,C,A,D,L)=>{let V=document.documentElement,G=["light","dark"];function W(X){(Array.isArray(u)?u:[u]).forEach(re=>{let q=re==="class",$=q&&A?C.map(ae=>A[ae]||ae):C;q?(V.classList.remove(...$),V.classList.add(A&&A[X]?A[X]:X)):V.setAttribute(re,X)}),K(X)}function K(X){L&&G.includes(X)&&(V.style.colorScheme=X)}function ee(){return window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"}if(y)W(y);else try{let X=localStorage.getItem(f)||_,re=D&&X==="system"?ee():X;W(re)}catch{}},Zj=["light","dark"],xB="(prefers-color-scheme: dark)",nQ=typeof window>"u",tN=j.createContext(void 0),rQ={setTheme:u=>{},themes:[]},MB=()=>{var u;return(u=j.useContext(tN))!=null?u:rQ},iQ=u=>j.useContext(tN)?j.createElement(j.Fragment,null,u.children):j.createElement(oQ,{...u}),sQ=["light","dark"],oQ=({forcedTheme:u,disableTransitionOnChange:f=!1,enableSystem:_=!0,enableColorScheme:y=!0,storageKey:C="theme",themes:A=sQ,defaultTheme:D=_?"system":"light",attribute:L="data-theme",value:V,children:G,nonce:W,scriptProps:K})=>{let[ee,X]=j.useState(()=>cQ(C,D)),[re,q]=j.useState(()=>ee==="system"?aA():ee),$=V?Object.values(V):A,ae=j.useCallback(be=>{let Ue=be;if(!Ue)return;be==="system"&&_&&(Ue=aA());let xe=V?V[Ue]:Ue,je=f?lQ(W):null,lt=document.documentElement,Et=ht=>{ht==="class"?(lt.classList.remove(...$),xe&&lt.classList.add(xe)):ht.startsWith("data-")&&(xe?lt.setAttribute(ht,xe):lt.removeAttribute(ht))};if(Array.isArray(L)?L.forEach(Et):Et(L),y){let ht=Zj.includes(D)?D:null,Ge=Zj.includes(Ue)?Ue:ht;lt.style.colorScheme=Ge}je?.()},[W]),oe=j.useCallback(be=>{let Ue=typeof be=="function"?be(ee):be;X(Ue);try{localStorage.setItem(C,Ue)}catch{}},[ee]),le=j.useCallback(be=>{let Ue=aA(be);q(Ue),ee==="system"&&_&&!u&&ae("system")},[ee,u]);j.useEffect(()=>{let be=window.matchMedia(xB);return be.addListener(le),le(be),()=>be.removeListener(le)},[le]),j.useEffect(()=>{let be=Ue=>{Ue.key===C&&(Ue.newValue?X(Ue.newValue):oe(D))};return window.addEventListener("storage",be),()=>window.removeEventListener("storage",be)},[oe]),j.useEffect(()=>{ae(u??ee)},[u,ee]);let Se=j.useMemo(()=>({theme:ee,setTheme:oe,forcedTheme:u,resolvedTheme:ee==="system"?re:ee,themes:_?[...A,"system"]:A,systemTheme:_?re:void 0}),[ee,oe,u,re,_,A]);return j.createElement(tN.Provider,{value:Se},j.createElement(aQ,{forcedTheme:u,storageKey:C,attribute:L,enableSystem:_,enableColorScheme:y,defaultTheme:D,value:V,themes:A,nonce:W,scriptProps:K}),G)},aQ=j.memo(({forcedTheme:u,storageKey:f,attribute:_,enableSystem:y,enableColorScheme:C,defaultTheme:A,value:D,themes:L,nonce:V,scriptProps:G})=>{let W=JSON.stringify([_,f,A,u,L,D,y,C]).slice(1,-1);return j.createElement("script",{...G,suppressHydrationWarning:!0,nonce:typeof window>"u"?V:"",dangerouslySetInnerHTML:{__html:`(${tQ.toString()})(${W})`}})}),cQ=(u,f)=>{if(nQ)return;let _;try{_=localStorage.getItem(u)||void 0}catch{}return _||f},lQ=u=>{let f=document.createElement("style");return u&&f.setAttribute("nonce",u),f.appendChild(document.createTextNode("*,*::before,*::after{-webkit-transition:none!important;-moz-transition:none!important;-o-transition:none!important;-ms-transition:none!important;transition:none!important}")),document.head.appendChild(f),()=>{window.getComputedStyle(document.body),setTimeout(()=>{document.head.removeChild(f)},1)}},aA=u=>(u||(u=window.matchMedia(xB)),u.matches?"dark":"light"),dQ=u=>{switch(u){case"success":return pQ;case"info":return mQ;case"warning":return fQ;case"error":return _Q;default:return null}},uQ=Array(12).fill(0),hQ=({visible:u,className:f})=>tt.createElement("div",{className:["sonner-loading-wrapper",f].filter(Boolean).join(" "),"data-visible":u},tt.createElement("div",{className:"sonner-spinner"},uQ.map((_,y)=>tt.createElement("div",{className:"sonner-loading-bar",key:`spinner-bar-${y}`})))),pQ=tt.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},tt.createElement("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.809a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z",clipRule:"evenodd"})),fQ=tt.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",height:"20",width:"20"},tt.createElement("path",{fillRule:"evenodd",d:"M9.401 3.003c1.155-2 4.043-2 5.197 0l7.355 12.748c1.154 2-.29 4.5-2.599 4.5H4.645c-2.309 0-3.752-2.5-2.598-4.5L9.4 3.003zM12 8.25a.75.75 0 01.75.75v3.75a.75.75 0 01-1.5 0V9a.75.75 0 01.75-.75zm0 8.25a.75.75 0 100-1.5.75.75 0 000 1.5z",clipRule:"evenodd"})),mQ=tt.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},tt.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a.75.75 0 000 1.5h.253a.25.25 0 01.244.304l-.459 2.066A1.75 1.75 0 0010.747 15H11a.75.75 0 000-1.5h-.253a.25.25 0 01-.244-.304l.459-2.066A1.75 1.75 0 009.253 9H9z",clipRule:"evenodd"})),_Q=tt.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},tt.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-5a.75.75 0 01.75.75v4.5a.75.75 0 01-1.5 0v-4.5A.75.75 0 0110 5zm0 10a1 1 0 100-2 1 1 0 000 2z",clipRule:"evenodd"})),EQ=tt.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"},tt.createElement("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),tt.createElement("line",{x1:"6",y1:"6",x2:"18",y2:"18"})),gQ=()=>{let[u,f]=tt.useState(document.hidden);return tt.useEffect(()=>{let _=()=>{f(document.hidden)};return document.addEventListener("visibilitychange",_),()=>window.removeEventListener("visibilitychange",_)},[]),u},AA=1,vQ=class{constructor(){this.subscribe=u=>(this.subscribers.push(u),()=>{let f=this.subscribers.indexOf(u);this.subscribers.splice(f,1)}),this.publish=u=>{this.subscribers.forEach(f=>f(u))},this.addToast=u=>{this.publish(u),this.toasts=[...this.toasts,u]},this.create=u=>{var f;let{message:_,...y}=u,C=typeof u?.id=="number"||((f=u.id)==null?void 0:f.length)>0?u.id:AA++,A=this.toasts.find(L=>L.id===C),D=u.dismissible===void 0?!0:u.dismissible;return this.dismissedToasts.has(C)&&this.dismissedToasts.delete(C),A?this.toasts=this.toasts.map(L=>L.id===C?(this.publish({...L,...u,id:C,title:_}),{...L,...u,id:C,dismissible:D,title:_}):L):this.addToast({title:_,...y,dismissible:D,id:C}),C},this.dismiss=u=>(this.dismissedToasts.add(u),u||this.toasts.forEach(f=>{this.subscribers.forEach(_=>_({id:f.id,dismiss:!0}))}),this.subscribers.forEach(f=>f({id:u,dismiss:!0})),u),this.message=(u,f)=>this.create({...f,message:u}),this.error=(u,f)=>this.create({...f,message:u,type:"error"}),this.success=(u,f)=>this.create({...f,type:"success",message:u}),this.info=(u,f)=>this.create({...f,type:"info",message:u}),this.warning=(u,f)=>this.create({...f,type:"warning",message:u}),this.loading=(u,f)=>this.create({...f,type:"loading",message:u}),this.promise=(u,f)=>{if(!f)return;let _;f.loading!==void 0&&(_=this.create({...f,promise:u,type:"loading",message:f.loading,description:typeof f.description!="function"?f.description:void 0}));let y=u instanceof Promise?u:u(),C=_!==void 0,A,D=y.then(async V=>{if(A=["resolve",V],tt.isValidElement(V))C=!1,this.create({id:_,type:"default",message:V});else if(SQ(V)&&!V.ok){C=!1;let G=typeof f.error=="function"?await f.error(`HTTP error! status: ${V.status}`):f.error,W=typeof f.description=="function"?await f.description(`HTTP error! status: ${V.status}`):f.description;this.create({id:_,type:"error",message:G,description:W})}else if(f.success!==void 0){C=!1;let G=typeof f.success=="function"?await f.success(V):f.success,W=typeof f.description=="function"?await f.description(V):f.description;this.create({id:_,type:"success",message:G,description:W})}}).catch(async V=>{if(A=["reject",V],f.error!==void 0){C=!1;let G=typeof f.error=="function"?await f.error(V):f.error,W=typeof f.description=="function"?await f.description(V):f.description;this.create({id:_,type:"error",message:G,description:W})}}).finally(()=>{var V;C&&(this.dismiss(_),_=void 0),(V=f.finally)==null||V.call(f)}),L=()=>new Promise((V,G)=>D.then(()=>A[0]==="reject"?G(A[1]):V(A[1])).catch(G));return typeof _!="string"&&typeof _!="number"?{unwrap:L}:Object.assign(_,{unwrap:L})},this.custom=(u,f)=>{let _=f?.id||AA++;return this.create({jsx:u(_),id:_,...f}),_},this.getActiveToasts=()=>this.toasts.filter(u=>!this.dismissedToasts.has(u.id)),this.subscribers=[],this.toasts=[],this.dismissedToasts=new Set}},js=new vQ,yQ=(u,f)=>{let _=f?.id||AA++;return js.addToast({title:u,...f,id:_}),_},SQ=u=>u&&typeof u=="object"&&"ok"in u&&typeof u.ok=="boolean"&&"status"in u&&typeof u.status=="number",TQ=yQ,RQ=()=>js.toasts,CQ=()=>js.getActiveToasts();Object.assign(TQ,{success:js.success,info:js.info,warning:js.warning,error:js.error,custom:js.custom,message:js.message,promise:js.promise,dismiss:js.dismiss,loading:js.loading},{getHistory:RQ,getToasts:CQ});function wQ(u,{insertAt:f}={}){if(typeof document>"u")return;let _=document.head||document.getElementsByTagName("head")[0],y=document.createElement("style");y.type="text/css",f==="top"&&_.firstChild?_.insertBefore(y,_.firstChild):_.appendChild(y),y.styleSheet?y.styleSheet.cssText=u:y.appendChild(document.createTextNode(u))}wQ(`:where(html[dir="ltr"]),:where([data-sonner-toaster][dir="ltr"]){--toast-icon-margin-start: -3px;--toast-icon-margin-end: 4px;--toast-svg-margin-start: -1px;--toast-svg-margin-end: 0px;--toast-button-margin-start: auto;--toast-button-margin-end: 0;--toast-close-button-start: 0;--toast-close-button-end: unset;--toast-close-button-transform: translate(-35%, -35%)}:where(html[dir="rtl"]),:where([data-sonner-toaster][dir="rtl"]){--toast-icon-margin-start: 4px;--toast-icon-margin-end: -3px;--toast-svg-margin-start: 0px;--toast-svg-margin-end: -1px;--toast-button-margin-start: 0;--toast-button-margin-end: auto;--toast-close-button-start: unset;--toast-close-button-end: 0;--toast-close-button-transform: translate(35%, -35%)}:where([data-sonner-toaster]){position:fixed;width:var(--width);font-family:ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;--gray1: hsl(0, 0%, 99%);--gray2: hsl(0, 0%, 97.3%);--gray3: hsl(0, 0%, 95.1%);--gray4: hsl(0, 0%, 93%);--gray5: hsl(0, 0%, 90.9%);--gray6: hsl(0, 0%, 88.7%);--gray7: hsl(0, 0%, 85.8%);--gray8: hsl(0, 0%, 78%);--gray9: hsl(0, 0%, 56.1%);--gray10: hsl(0, 0%, 52.3%);--gray11: hsl(0, 0%, 43.5%);--gray12: hsl(0, 0%, 9%);--border-radius: 8px;box-sizing:border-box;padding:0;margin:0;list-style:none;outline:none;z-index:999999999;transition:transform .4s ease}:where([data-sonner-toaster][data-lifted="true"]){transform:translateY(-10px)}@media (hover: none) and (pointer: coarse){:where([data-sonner-toaster][data-lifted="true"]){transform:none}}:where([data-sonner-toaster][data-x-position="right"]){right:var(--offset-right)}:where([data-sonner-toaster][data-x-position="left"]){left:var(--offset-left)}:where([data-sonner-toaster][data-x-position="center"]){left:50%;transform:translate(-50%)}:where([data-sonner-toaster][data-y-position="top"]){top:var(--offset-top)}:where([data-sonner-toaster][data-y-position="bottom"]){bottom:var(--offset-bottom)}:where([data-sonner-toast]){--y: translateY(100%);--lift-amount: calc(var(--lift) * var(--gap));z-index:var(--z-index);position:absolute;opacity:0;transform:var(--y);filter:blur(0);touch-action:none;transition:transform .4s,opacity .4s,height .4s,box-shadow .2s;box-sizing:border-box;outline:none;overflow-wrap:anywhere}:where([data-sonner-toast][data-styled="true"]){padding:16px;background:var(--normal-bg);border:1px solid var(--normal-border);color:var(--normal-text);border-radius:var(--border-radius);box-shadow:0 4px 12px #0000001a;width:var(--width);font-size:13px;display:flex;align-items:center;gap:6px}:where([data-sonner-toast]:focus-visible){box-shadow:0 4px 12px #0000001a,0 0 0 2px #0003}:where([data-sonner-toast][data-y-position="top"]){top:0;--y: translateY(-100%);--lift: 1;--lift-amount: calc(1 * var(--gap))}:where([data-sonner-toast][data-y-position="bottom"]){bottom:0;--y: translateY(100%);--lift: -1;--lift-amount: calc(var(--lift) * var(--gap))}:where([data-sonner-toast]) :where([data-description]){font-weight:400;line-height:1.4;color:inherit}:where([data-sonner-toast]) :where([data-title]){font-weight:500;line-height:1.5;color:inherit}:where([data-sonner-toast]) :where([data-icon]){display:flex;height:16px;width:16px;position:relative;justify-content:flex-start;align-items:center;flex-shrink:0;margin-left:var(--toast-icon-margin-start);margin-right:var(--toast-icon-margin-end)}:where([data-sonner-toast][data-promise="true"]) :where([data-icon])>svg{opacity:0;transform:scale(.8);transform-origin:center;animation:sonner-fade-in .3s ease forwards}:where([data-sonner-toast]) :where([data-icon])>*{flex-shrink:0}:where([data-sonner-toast]) :where([data-icon]) svg{margin-left:var(--toast-svg-margin-start);margin-right:var(--toast-svg-margin-end)}:where([data-sonner-toast]) :where([data-content]){display:flex;flex-direction:column;gap:2px}[data-sonner-toast][data-styled=true] [data-button]{border-radius:4px;padding-left:8px;padding-right:8px;height:24px;font-size:12px;color:var(--normal-bg);background:var(--normal-text);margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end);border:none;cursor:pointer;outline:none;display:flex;align-items:center;flex-shrink:0;transition:opacity .4s,box-shadow .2s}:where([data-sonner-toast]) :where([data-button]):focus-visible{box-shadow:0 0 0 2px #0006}:where([data-sonner-toast]) :where([data-button]):first-of-type{margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end)}:where([data-sonner-toast]) :where([data-cancel]){color:var(--normal-text);background:rgba(0,0,0,.08)}:where([data-sonner-toast][data-theme="dark"]) :where([data-cancel]){background:rgba(255,255,255,.3)}:where([data-sonner-toast]) :where([data-close-button]){position:absolute;left:var(--toast-close-button-start);right:var(--toast-close-button-end);top:0;height:20px;width:20px;display:flex;justify-content:center;align-items:center;padding:0;color:var(--gray12);border:1px solid var(--gray4);transform:var(--toast-close-button-transform);border-radius:50%;cursor:pointer;z-index:1;transition:opacity .1s,background .2s,border-color .2s}[data-sonner-toast] [data-close-button]{background:var(--gray1)}:where([data-sonner-toast]) :where([data-close-button]):focus-visible{box-shadow:0 4px 12px #0000001a,0 0 0 2px #0003}:where([data-sonner-toast]) :where([data-disabled="true"]){cursor:not-allowed}:where([data-sonner-toast]):hover :where([data-close-button]):hover{background:var(--gray2);border-color:var(--gray5)}:where([data-sonner-toast][data-swiping="true"]):before{content:"";position:absolute;left:-50%;right:-50%;height:100%;z-index:-1}:where([data-sonner-toast][data-y-position="top"][data-swiping="true"]):before{bottom:50%;transform:scaleY(3) translateY(50%)}:where([data-sonner-toast][data-y-position="bottom"][data-swiping="true"]):before{top:50%;transform:scaleY(3) translateY(-50%)}:where([data-sonner-toast][data-swiping="false"][data-removed="true"]):before{content:"";position:absolute;inset:0;transform:scaleY(2)}:where([data-sonner-toast]):after{content:"";position:absolute;left:0;height:calc(var(--gap) + 1px);bottom:100%;width:100%}:where([data-sonner-toast][data-mounted="true"]){--y: translateY(0);opacity:1}:where([data-sonner-toast][data-expanded="false"][data-front="false"]){--scale: var(--toasts-before) * .05 + 1;--y: translateY(calc(var(--lift-amount) * var(--toasts-before))) scale(calc(-1 * var(--scale)));height:var(--front-toast-height)}:where([data-sonner-toast])>*{transition:opacity .4s}:where([data-sonner-toast][data-expanded="false"][data-front="false"][data-styled="true"])>*{opacity:0}:where([data-sonner-toast][data-visible="false"]){opacity:0;pointer-events:none}:where([data-sonner-toast][data-mounted="true"][data-expanded="true"]){--y: translateY(calc(var(--lift) * var(--offset)));height:var(--initial-height)}:where([data-sonner-toast][data-removed="true"][data-front="true"][data-swipe-out="false"]){--y: translateY(calc(var(--lift) * -100%));opacity:0}:where([data-sonner-toast][data-removed="true"][data-front="false"][data-swipe-out="false"][data-expanded="true"]){--y: translateY(calc(var(--lift) * var(--offset) + var(--lift) * -100%));opacity:0}:where([data-sonner-toast][data-removed="true"][data-front="false"][data-swipe-out="false"][data-expanded="false"]){--y: translateY(40%);opacity:0;transition:transform .5s,opacity .2s}:where([data-sonner-toast][data-removed="true"][data-front="false"]):before{height:calc(var(--initial-height) + 20%)}[data-sonner-toast][data-swiping=true]{transform:var(--y) translateY(var(--swipe-amount-y, 0px)) translate(var(--swipe-amount-x, 0px));transition:none}[data-sonner-toast][data-swiped=true]{user-select:none}[data-sonner-toast][data-swipe-out=true][data-y-position=bottom],[data-sonner-toast][data-swipe-out=true][data-y-position=top]{animation-duration:.2s;animation-timing-function:ease-out;animation-fill-mode:forwards}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=left]{animation-name:swipe-out-left}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=right]{animation-name:swipe-out-right}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=up]{animation-name:swipe-out-up}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=down]{animation-name:swipe-out-down}@keyframes swipe-out-left{0%{transform:var(--y) translate(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translate(calc(var(--swipe-amount-x) - 100%));opacity:0}}@keyframes swipe-out-right{0%{transform:var(--y) translate(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translate(calc(var(--swipe-amount-x) + 100%));opacity:0}}@keyframes swipe-out-up{0%{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) - 100%));opacity:0}}@keyframes swipe-out-down{0%{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) + 100%));opacity:0}}@media (max-width: 600px){[data-sonner-toaster]{position:fixed;right:var(--mobile-offset-right);left:var(--mobile-offset-left);width:100%}[data-sonner-toaster][dir=rtl]{left:calc(var(--mobile-offset-left) * -1)}[data-sonner-toaster] [data-sonner-toast]{left:0;right:0;width:calc(100% - var(--mobile-offset-left) * 2)}[data-sonner-toaster][data-x-position=left]{left:var(--mobile-offset-left)}[data-sonner-toaster][data-y-position=bottom]{bottom:var(--mobile-offset-bottom)}[data-sonner-toaster][data-y-position=top]{top:var(--mobile-offset-top)}[data-sonner-toaster][data-x-position=center]{left:var(--mobile-offset-left);right:var(--mobile-offset-right);transform:none}}[data-sonner-toaster][data-theme=light]{--normal-bg: #fff;--normal-border: var(--gray4);--normal-text: var(--gray12);--success-bg: hsl(143, 85%, 96%);--success-border: hsl(145, 92%, 91%);--success-text: hsl(140, 100%, 27%);--info-bg: hsl(208, 100%, 97%);--info-border: hsl(221, 91%, 91%);--info-text: hsl(210, 92%, 45%);--warning-bg: hsl(49, 100%, 97%);--warning-border: hsl(49, 91%, 91%);--warning-text: hsl(31, 92%, 45%);--error-bg: hsl(359, 100%, 97%);--error-border: hsl(359, 100%, 94%);--error-text: hsl(360, 100%, 45%)}[data-sonner-toaster][data-theme=light] [data-sonner-toast][data-invert=true]{--normal-bg: #000;--normal-border: hsl(0, 0%, 20%);--normal-text: var(--gray1)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast][data-invert=true]{--normal-bg: #fff;--normal-border: var(--gray3);--normal-text: var(--gray12)}[data-sonner-toaster][data-theme=dark]{--normal-bg: #000;--normal-bg-hover: hsl(0, 0%, 12%);--normal-border: hsl(0, 0%, 20%);--normal-border-hover: hsl(0, 0%, 25%);--normal-text: var(--gray1);--success-bg: hsl(150, 100%, 6%);--success-border: hsl(147, 100%, 12%);--success-text: hsl(150, 86%, 65%);--info-bg: hsl(215, 100%, 6%);--info-border: hsl(223, 100%, 12%);--info-text: hsl(216, 87%, 65%);--warning-bg: hsl(64, 100%, 6%);--warning-border: hsl(60, 100%, 12%);--warning-text: hsl(46, 87%, 65%);--error-bg: hsl(358, 76%, 10%);--error-border: hsl(357, 89%, 16%);--error-text: hsl(358, 100%, 81%)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast] [data-close-button]{background:var(--normal-bg);border-color:var(--normal-border);color:var(--normal-text)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast] [data-close-button]:hover{background:var(--normal-bg-hover);border-color:var(--normal-border-hover)}[data-rich-colors=true][data-sonner-toast][data-type=success],[data-rich-colors=true][data-sonner-toast][data-type=success] [data-close-button]{background:var(--success-bg);border-color:var(--success-border);color:var(--success-text)}[data-rich-colors=true][data-sonner-toast][data-type=info],[data-rich-colors=true][data-sonner-toast][data-type=info] [data-close-button]{background:var(--info-bg);border-color:var(--info-border);color:var(--info-text)}[data-rich-colors=true][data-sonner-toast][data-type=warning],[data-rich-colors=true][data-sonner-toast][data-type=warning] [data-close-button]{background:var(--warning-bg);border-color:var(--warning-border);color:var(--warning-text)}[data-rich-colors=true][data-sonner-toast][data-type=error],[data-rich-colors=true][data-sonner-toast][data-type=error] [data-close-button]{background:var(--error-bg);border-color:var(--error-border);color:var(--error-text)}.sonner-loading-wrapper{--size: 16px;height:var(--size);width:var(--size);position:absolute;inset:0;z-index:10}.sonner-loading-wrapper[data-visible=false]{transform-origin:center;animation:sonner-fade-out .2s ease forwards}.sonner-spinner{position:relative;top:50%;left:50%;height:var(--size);width:var(--size)}.sonner-loading-bar{animation:sonner-spin 1.2s linear infinite;background:var(--gray11);border-radius:6px;height:8%;left:-10%;position:absolute;top:-3.9%;width:24%}.sonner-loading-bar:nth-child(1){animation-delay:-1.2s;transform:rotate(.0001deg) translate(146%)}.sonner-loading-bar:nth-child(2){animation-delay:-1.1s;transform:rotate(30deg) translate(146%)}.sonner-loading-bar:nth-child(3){animation-delay:-1s;transform:rotate(60deg) translate(146%)}.sonner-loading-bar:nth-child(4){animation-delay:-.9s;transform:rotate(90deg) translate(146%)}.sonner-loading-bar:nth-child(5){animation-delay:-.8s;transform:rotate(120deg) translate(146%)}.sonner-loading-bar:nth-child(6){animation-delay:-.7s;transform:rotate(150deg) translate(146%)}.sonner-loading-bar:nth-child(7){animation-delay:-.6s;transform:rotate(180deg) translate(146%)}.sonner-loading-bar:nth-child(8){animation-delay:-.5s;transform:rotate(210deg) translate(146%)}.sonner-loading-bar:nth-child(9){animation-delay:-.4s;transform:rotate(240deg) translate(146%)}.sonner-loading-bar:nth-child(10){animation-delay:-.3s;transform:rotate(270deg) translate(146%)}.sonner-loading-bar:nth-child(11){animation-delay:-.2s;transform:rotate(300deg) translate(146%)}.sonner-loading-bar:nth-child(12){animation-delay:-.1s;transform:rotate(330deg) translate(146%)}@keyframes sonner-fade-in{0%{opacity:0;transform:scale(.8)}to{opacity:1;transform:scale(1)}}@keyframes sonner-fade-out{0%{opacity:1;transform:scale(1)}to{opacity:0;transform:scale(.8)}}@keyframes sonner-spin{0%{opacity:1}to{opacity:.15}}@media (prefers-reduced-motion){[data-sonner-toast],[data-sonner-toast]>*,.sonner-loading-bar{transition:none!important;animation:none!important}}.sonner-loader{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);transform-origin:center;transition:opacity .2s,transform .2s}.sonner-loader[data-visible=false]{opacity:0;transform:scale(.8) translate(-50%,-50%)}
`);function eR(u){return u.label!==void 0}var bQ=3,IQ="32px",AQ="16px",$j=4e3,NQ=356,OQ=14,PQ=20,DQ=200;function La(...u){return u.filter(Boolean).join(" ")}function kQ(u){let[f,_]=u.split("-"),y=[];return f&&y.push(f),_&&y.push(_),y}var LQ=u=>{var f,_,y,C,A,D,L,V,G,W,K;let{invert:ee,toast:X,unstyled:re,interacting:q,setHeights:$,visibleToasts:ae,heights:oe,index:le,toasts:Se,expanded:be,removeToast:Ue,defaultRichColors:xe,closeButton:je,style:lt,cancelButtonStyle:Et,actionButtonStyle:ht,className:Ge="",descriptionClassName:pt="",duration:Fe,position:Ct,gap:nt,loadingIcon:Je,expandByDefault:Oe,classNames:ke,icons:ze,closeButtonAriaLabel:he="Close toast",pauseWhenPageIsHidden:Ie}=u,[it,rt]=tt.useState(null),[Ot,Ht]=tt.useState(null),[Ye,At]=tt.useState(!1),[Wt,Kt]=tt.useState(!1),[Rn,Yn]=tt.useState(!1),[er,is]=tt.useState(!1),[Fa,Ei]=tt.useState(!1),[Zo,Sr]=tt.useState(0),[ai,Eo]=tt.useState(0),Wi=tt.useRef(X.duration||Fe||$j),Dl=tt.useRef(null),Fs=tt.useRef(null),Mr=le===0,iu=le+1<=ae,gi=X.type,ei=X.dismissible!==!1,Wc=X.className||"",kl=X.descriptionClassName||"",Bs=tt.useMemo(()=>oe.findIndex(Yt=>Yt.toastId===X.id)||0,[oe,X.id]),Ba=tt.useMemo(()=>{var Yt;return(Yt=X.closeButton)!=null?Yt:je},[X.closeButton,je]),su=tt.useMemo(()=>X.duration||Fe||$j,[X.duration,Fe]),Gc=tt.useRef(0),Oi=tt.useRef(0),ou=tt.useRef(0),go=tt.useRef(null),[au,vo]=Ct.split("-"),Hc=tt.useMemo(()=>oe.reduce((Yt,gn,qn)=>qn>=Bs?Yt:Yt+gn.height,0),[oe,Bs]),Ll=gQ(),Wa=X.invert||ee,yo=gi==="loading";Oi.current=tt.useMemo(()=>Bs*nt+Hc,[Bs,Hc]),tt.useEffect(()=>{Wi.current=su},[su]),tt.useEffect(()=>{At(!0)},[]),tt.useEffect(()=>{let Yt=Fs.current;if(Yt){let gn=Yt.getBoundingClientRect().height;return Eo(gn),$(qn=>[{toastId:X.id,height:gn,position:X.position},...qn]),()=>$(qn=>qn.filter(Pi=>Pi.toastId!==X.id))}},[$,X.id]),tt.useLayoutEffect(()=>{if(!Ye)return;let Yt=Fs.current,gn=Yt.style.height;Yt.style.height="auto";let qn=Yt.getBoundingClientRect().height;Yt.style.height=gn,Eo(qn),$(Pi=>Pi.find(Gi=>Gi.toastId===X.id)?Pi.map(Gi=>Gi.toastId===X.id?{...Gi,height:qn}:Gi):[{toastId:X.id,height:qn,position:X.position},...Pi])},[Ye,X.title,X.description,$,X.id]);let Ws=tt.useCallback(()=>{Kt(!0),Sr(Oi.current),$(Yt=>Yt.filter(gn=>gn.toastId!==X.id)),setTimeout(()=>{Ue(X)},DQ)},[X,Ue,$,Oi]);tt.useEffect(()=>{if(X.promise&&gi==="loading"||X.duration===1/0||X.type==="loading")return;let Yt;return be||q||Ie&&Ll?(()=>{if(ou.current<Gc.current){let gn=new Date().getTime()-Gc.current;Wi.current=Wi.current-gn}ou.current=new Date().getTime()})():Wi.current!==1/0&&(Gc.current=new Date().getTime(),Yt=setTimeout(()=>{var gn;(gn=X.onAutoClose)==null||gn.call(X,X),Ws()},Wi.current)),()=>clearTimeout(Yt)},[be,q,X,gi,Ie,Ll,Ws]),tt.useEffect(()=>{X.delete&&Ws()},[Ws,X.delete]);function Ga(){var Yt,gn,qn;return ze!=null&&ze.loading?tt.createElement("div",{className:La(ke?.loader,(Yt=X?.classNames)==null?void 0:Yt.loader,"sonner-loader"),"data-visible":gi==="loading"},ze.loading):Je?tt.createElement("div",{className:La(ke?.loader,(gn=X?.classNames)==null?void 0:gn.loader,"sonner-loader"),"data-visible":gi==="loading"},Je):tt.createElement(hQ,{className:La(ke?.loader,(qn=X?.classNames)==null?void 0:qn.loader),visible:gi==="loading"})}return tt.createElement("li",{tabIndex:0,ref:Fs,className:La(Ge,Wc,ke?.toast,(f=X?.classNames)==null?void 0:f.toast,ke?.default,ke?.[gi],(_=X?.classNames)==null?void 0:_[gi]),"data-sonner-toast":"","data-rich-colors":(y=X.richColors)!=null?y:xe,"data-styled":!(X.jsx||X.unstyled||re),"data-mounted":Ye,"data-promise":!!X.promise,"data-swiped":Fa,"data-removed":Wt,"data-visible":iu,"data-y-position":au,"data-x-position":vo,"data-index":le,"data-front":Mr,"data-swiping":Rn,"data-dismissible":ei,"data-type":gi,"data-invert":Wa,"data-swipe-out":er,"data-swipe-direction":Ot,"data-expanded":!!(be||Oe&&Ye),style:{"--index":le,"--toasts-before":le,"--z-index":Se.length-le,"--offset":`${Wt?Zo:Oi.current}px`,"--initial-height":Oe?"auto":`${ai}px`,...lt,...X.style},onDragEnd:()=>{Yn(!1),rt(null),go.current=null},onPointerDown:Yt=>{yo||!ei||(Dl.current=new Date,Sr(Oi.current),Yt.target.setPointerCapture(Yt.pointerId),Yt.target.tagName!=="BUTTON"&&(Yn(!0),go.current={x:Yt.clientX,y:Yt.clientY}))},onPointerUp:()=>{var Yt,gn,qn,Pi;if(er||!ei)return;go.current=null;let Gi=Number(((Yt=Fs.current)==null?void 0:Yt.style.getPropertyValue("--swipe-amount-x").replace("px",""))||0),Xn=Number(((gn=Fs.current)==null?void 0:gn.style.getPropertyValue("--swipe-amount-y").replace("px",""))||0),Gs=new Date().getTime()-((qn=Dl.current)==null?void 0:qn.getTime()),ci=it==="x"?Gi:Xn,ss=Math.abs(ci)/Gs;if(Math.abs(ci)>=PQ||ss>.11){Sr(Oi.current),(Pi=X.onDismiss)==null||Pi.call(X,X),Ht(it==="x"?Gi>0?"right":"left":Xn>0?"down":"up"),Ws(),is(!0),Ei(!1);return}Yn(!1),rt(null)},onPointerMove:Yt=>{var gn,qn,Pi,Gi;if(!go.current||!ei||((gn=window.getSelection())==null?void 0:gn.toString().length)>0)return;let Xn=Yt.clientY-go.current.y,Gs=Yt.clientX-go.current.x,ci=(qn=u.swipeDirections)!=null?qn:kQ(Ct);!it&&(Math.abs(Gs)>1||Math.abs(Xn)>1)&&rt(Math.abs(Gs)>Math.abs(Xn)?"x":"y");let ss={x:0,y:0};it==="y"?(ci.includes("top")||ci.includes("bottom"))&&(ci.includes("top")&&Xn<0||ci.includes("bottom")&&Xn>0)&&(ss.y=Xn):it==="x"&&(ci.includes("left")||ci.includes("right"))&&(ci.includes("left")&&Gs<0||ci.includes("right")&&Gs>0)&&(ss.x=Gs),(Math.abs(ss.x)>0||Math.abs(ss.y)>0)&&Ei(!0),(Pi=Fs.current)==null||Pi.style.setProperty("--swipe-amount-x",`${ss.x}px`),(Gi=Fs.current)==null||Gi.style.setProperty("--swipe-amount-y",`${ss.y}px`)}},Ba&&!X.jsx?tt.createElement("button",{"aria-label":he,"data-disabled":yo,"data-close-button":!0,onClick:yo||!ei?()=>{}:()=>{var Yt;Ws(),(Yt=X.onDismiss)==null||Yt.call(X,X)},className:La(ke?.closeButton,(C=X?.classNames)==null?void 0:C.closeButton)},(A=ze?.close)!=null?A:EQ):null,X.jsx||j.isValidElement(X.title)?X.jsx?X.jsx:typeof X.title=="function"?X.title():X.title:tt.createElement(tt.Fragment,null,gi||X.icon||X.promise?tt.createElement("div",{"data-icon":"",className:La(ke?.icon,(D=X?.classNames)==null?void 0:D.icon)},X.promise||X.type==="loading"&&!X.icon?X.icon||Ga():null,X.type!=="loading"?X.icon||ze?.[gi]||dQ(gi):null):null,tt.createElement("div",{"data-content":"",className:La(ke?.content,(L=X?.classNames)==null?void 0:L.content)},tt.createElement("div",{"data-title":"",className:La(ke?.title,(V=X?.classNames)==null?void 0:V.title)},typeof X.title=="function"?X.title():X.title),X.description?tt.createElement("div",{"data-description":"",className:La(pt,kl,ke?.description,(G=X?.classNames)==null?void 0:G.description)},typeof X.description=="function"?X.description():X.description):null),j.isValidElement(X.cancel)?X.cancel:X.cancel&&eR(X.cancel)?tt.createElement("button",{"data-button":!0,"data-cancel":!0,style:X.cancelButtonStyle||Et,onClick:Yt=>{var gn,qn;eR(X.cancel)&&ei&&((qn=(gn=X.cancel).onClick)==null||qn.call(gn,Yt),Ws())},className:La(ke?.cancelButton,(W=X?.classNames)==null?void 0:W.cancelButton)},X.cancel.label):null,j.isValidElement(X.action)?X.action:X.action&&eR(X.action)?tt.createElement("button",{"data-button":!0,"data-action":!0,style:X.actionButtonStyle||ht,onClick:Yt=>{var gn,qn;eR(X.action)&&((qn=(gn=X.action).onClick)==null||qn.call(gn,Yt),!Yt.defaultPrevented&&Ws())},className:La(ke?.actionButton,(K=X?.classNames)==null?void 0:K.actionButton)},X.action.label):null))};function eF(){if(typeof window>"u"||typeof document>"u")return"ltr";let u=document.documentElement.getAttribute("dir");return u==="auto"||!u?window.getComputedStyle(document.documentElement).direction:u}function xQ(u,f){let _={};return[u,f].forEach((y,C)=>{let A=C===1,D=A?"--mobile-offset":"--offset",L=A?AQ:IQ;function V(G){["top","right","bottom","left"].forEach(W=>{_[`${D}-${W}`]=typeof G=="number"?`${G}px`:G})}typeof y=="number"||typeof y=="string"?V(y):typeof y=="object"?["top","right","bottom","left"].forEach(G=>{y[G]===void 0?_[`${D}-${G}`]=L:_[`${D}-${G}`]=typeof y[G]=="number"?`${y[G]}px`:y[G]}):V(L)}),_}var MQ=j.forwardRef(function(u,f){let{invert:_,position:y="bottom-right",hotkey:C=["altKey","KeyT"],expand:A,closeButton:D,className:L,offset:V,mobileOffset:G,theme:W="light",richColors:K,duration:ee,style:X,visibleToasts:re=bQ,toastOptions:q,dir:$=eF(),gap:ae=OQ,loadingIcon:oe,icons:le,containerAriaLabel:Se="Notifications",pauseWhenPageIsHidden:be}=u,[Ue,xe]=tt.useState([]),je=tt.useMemo(()=>Array.from(new Set([y].concat(Ue.filter(Ie=>Ie.position).map(Ie=>Ie.position)))),[Ue,y]),[lt,Et]=tt.useState([]),[ht,Ge]=tt.useState(!1),[pt,Fe]=tt.useState(!1),[Ct,nt]=tt.useState(W!=="system"?W:typeof window<"u"&&window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"),Je=tt.useRef(null),Oe=C.join("+").replace(/Key/g,"").replace(/Digit/g,""),ke=tt.useRef(null),ze=tt.useRef(!1),he=tt.useCallback(Ie=>{xe(it=>{var rt;return(rt=it.find(Ot=>Ot.id===Ie.id))!=null&&rt.delete||js.dismiss(Ie.id),it.filter(({id:Ot})=>Ot!==Ie.id)})},[]);return tt.useEffect(()=>js.subscribe(Ie=>{if(Ie.dismiss){xe(it=>it.map(rt=>rt.id===Ie.id?{...rt,delete:!0}:rt));return}setTimeout(()=>{WF.flushSync(()=>{xe(it=>{let rt=it.findIndex(Ot=>Ot.id===Ie.id);return rt!==-1?[...it.slice(0,rt),{...it[rt],...Ie},...it.slice(rt+1)]:[Ie,...it]})})})}),[]),tt.useEffect(()=>{if(W!=="system"){nt(W);return}if(W==="system"&&(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?nt("dark"):nt("light")),typeof window>"u")return;let Ie=window.matchMedia("(prefers-color-scheme: dark)");try{Ie.addEventListener("change",({matches:it})=>{nt(it?"dark":"light")})}catch{Ie.addListener(({matches:rt})=>{try{nt(rt?"dark":"light")}catch(Ot){console.error(Ot)}})}},[W]),tt.useEffect(()=>{Ue.length<=1&&Ge(!1)},[Ue]),tt.useEffect(()=>{let Ie=it=>{var rt,Ot;C.every(Ht=>it[Ht]||it.code===Ht)&&(Ge(!0),(rt=Je.current)==null||rt.focus()),it.code==="Escape"&&(document.activeElement===Je.current||(Ot=Je.current)!=null&&Ot.contains(document.activeElement))&&Ge(!1)};return document.addEventListener("keydown",Ie),()=>document.removeEventListener("keydown",Ie)},[C]),tt.useEffect(()=>{if(Je.current)return()=>{ke.current&&(ke.current.focus({preventScroll:!0}),ke.current=null,ze.current=!1)}},[Je.current]),tt.createElement("section",{ref:f,"aria-label":`${Se} ${Oe}`,tabIndex:-1,"aria-live":"polite","aria-relevant":"additions text","aria-atomic":"false",suppressHydrationWarning:!0},je.map((Ie,it)=>{var rt;let[Ot,Ht]=Ie.split("-");return Ue.length?tt.createElement("ol",{key:Ie,dir:$==="auto"?eF():$,tabIndex:-1,ref:Je,className:L,"data-sonner-toaster":!0,"data-theme":Ct,"data-y-position":Ot,"data-lifted":ht&&Ue.length>1&&!A,"data-x-position":Ht,style:{"--front-toast-height":`${((rt=lt[0])==null?void 0:rt.height)||0}px`,"--width":`${NQ}px`,"--gap":`${ae}px`,...X,...xQ(V,G)},onBlur:Ye=>{ze.current&&!Ye.currentTarget.contains(Ye.relatedTarget)&&(ze.current=!1,ke.current&&(ke.current.focus({preventScroll:!0}),ke.current=null))},onFocus:Ye=>{Ye.target instanceof HTMLElement&&Ye.target.dataset.dismissible==="false"||ze.current||(ze.current=!0,ke.current=Ye.relatedTarget)},onMouseEnter:()=>Ge(!0),onMouseMove:()=>Ge(!0),onMouseLeave:()=>{pt||Ge(!1)},onDragEnd:()=>Ge(!1),onPointerDown:Ye=>{Ye.target instanceof HTMLElement&&Ye.target.dataset.dismissible==="false"||Fe(!0)},onPointerUp:()=>Fe(!1)},Ue.filter(Ye=>!Ye.position&&it===0||Ye.position===Ie).map((Ye,At)=>{var Wt,Kt;return tt.createElement(LQ,{key:Ye.id,icons:le,index:At,toast:Ye,defaultRichColors:K,duration:(Wt=q?.duration)!=null?Wt:ee,className:q?.className,descriptionClassName:q?.descriptionClassName,invert:_,visibleToasts:re,closeButton:(Kt=q?.closeButton)!=null?Kt:D,interacting:pt,position:Ie,style:q?.style,unstyled:q?.unstyled,classNames:q?.classNames,cancelButtonStyle:q?.cancelButtonStyle,actionButtonStyle:q?.actionButtonStyle,removeToast:he,toasts:Ue.filter(Rn=>Rn.position==Ye.position),heights:lt.filter(Rn=>Rn.position==Ye.position),setHeights:Et,expandByDefault:A,gap:ae,loadingIcon:oe,expanded:ht,pauseWhenPageIsHidden:be,swipeDirections:u.swipeDirections})})):null}))});const UQ=({...u})=>{const{theme:f="system"}=MB();return T.jsx(MQ,{theme:f,className:"toaster group",toastOptions:{classNames:{toast:"group toast group-[.toaster]:bg-background group-[.toaster]:text-foreground group-[.toaster]:border-border group-[.toaster]:shadow-lg",description:"group-[.toast]:text-muted-foreground",actionButton:"group-[.toast]:bg-primary group-[.toast]:text-primary-foreground",cancelButton:"group-[.toast]:bg-muted group-[.toast]:text-muted-foreground"}},...u})};var VQ=zA[" useId ".trim().toString()]||(()=>{}),jQ=0;function Gg(u){const[f,_]=j.useState(VQ());return oi(()=>{_(y=>y??String(jQ++))},[u]),f?`radix-${f}`:""}const FQ=["top","right","bottom","left"],eu=Math.min,po=Math.max,_R=Math.round,tR=Math.floor,jc=u=>({x:u,y:u}),BQ={left:"right",right:"left",bottom:"top",top:"bottom"},WQ={start:"end",end:"start"};function NA(u,f,_){return po(u,eu(f,_))}function Al(u,f){return typeof u=="function"?u(f):u}function Nl(u){return u.split("-")[0]}function ym(u){return u.split("-")[1]}function nN(u){return u==="x"?"y":"x"}function rN(u){return u==="y"?"height":"width"}const GQ=new Set(["top","bottom"]);function Uc(u){return GQ.has(Nl(u))?"y":"x"}function iN(u){return nN(Uc(u))}function HQ(u,f,_){_===void 0&&(_=!1);const y=ym(u),C=iN(u),A=rN(C);let D=C==="x"?y===(_?"end":"start")?"right":"left":y==="start"?"bottom":"top";return f.reference[A]>f.floating[A]&&(D=ER(D)),[D,ER(D)]}function KQ(u){const f=ER(u);return[OA(u),f,OA(f)]}function OA(u){return u.replace(/start|end/g,f=>WQ[f])}const tF=["left","right"],nF=["right","left"],zQ=["top","bottom"],YQ=["bottom","top"];function qQ(u,f,_){switch(u){case"top":case"bottom":return _?f?nF:tF:f?tF:nF;case"left":case"right":return f?zQ:YQ;default:return[]}}function XQ(u,f,_,y){const C=ym(u);let A=qQ(Nl(u),_==="start",y);return C&&(A=A.map(D=>D+"-"+C),f&&(A=A.concat(A.map(OA)))),A}function ER(u){return u.replace(/left|right|bottom|top/g,f=>BQ[f])}function JQ(u){return{top:0,right:0,bottom:0,left:0,...u}}function UB(u){return typeof u!="number"?JQ(u):{top:u,right:u,bottom:u,left:u}}function gR(u){const{x:f,y:_,width:y,height:C}=u;return{width:y,height:C,top:_,left:f,right:f+y,bottom:_+C,x:f,y:_}}function rF(u,f,_){let{reference:y,floating:C}=u;const A=Uc(f),D=iN(f),L=rN(D),V=Nl(f),G=A==="y",W=y.x+y.width/2-C.width/2,K=y.y+y.height/2-C.height/2,ee=y[L]/2-C[L]/2;let X;switch(V){case"top":X={x:W,y:y.y-C.height};break;case"bottom":X={x:W,y:y.y+y.height};break;case"right":X={x:y.x+y.width,y:K};break;case"left":X={x:y.x-C.width,y:K};break;default:X={x:y.x,y:y.y}}switch(ym(f)){case"start":X[D]-=ee*(_&&G?-1:1);break;case"end":X[D]+=ee*(_&&G?-1:1);break}return X}const QQ=async(u,f,_)=>{const{placement:y="bottom",strategy:C="absolute",middleware:A=[],platform:D}=_,L=A.filter(Boolean),V=await(D.isRTL==null?void 0:D.isRTL(f));let G=await D.getElementRects({reference:u,floating:f,strategy:C}),{x:W,y:K}=rF(G,y,V),ee=y,X={},re=0;for(let q=0;q<L.length;q++){const{name:$,fn:ae}=L[q],{x:oe,y:le,data:Se,reset:be}=await ae({x:W,y:K,initialPlacement:y,placement:ee,strategy:C,middlewareData:X,rects:G,platform:D,elements:{reference:u,floating:f}});W=oe??W,K=le??K,X={...X,[$]:{...X[$],...Se}},be&&re<=50&&(re++,typeof be=="object"&&(be.placement&&(ee=be.placement),be.rects&&(G=be.rects===!0?await D.getElementRects({reference:u,floating:f,strategy:C}):be.rects),{x:W,y:K}=rF(G,ee,V)),q=-1)}return{x:W,y:K,placement:ee,strategy:C,middlewareData:X}};async function xg(u,f){var _;f===void 0&&(f={});const{x:y,y:C,platform:A,rects:D,elements:L,strategy:V}=u,{boundary:G="clippingAncestors",rootBoundary:W="viewport",elementContext:K="floating",altBoundary:ee=!1,padding:X=0}=Al(f,u),re=UB(X),$=L[ee?K==="floating"?"reference":"floating":K],ae=gR(await A.getClippingRect({element:(_=await(A.isElement==null?void 0:A.isElement($)))==null||_?$:$.contextElement||await(A.getDocumentElement==null?void 0:A.getDocumentElement(L.floating)),boundary:G,rootBoundary:W,strategy:V})),oe=K==="floating"?{x:y,y:C,width:D.floating.width,height:D.floating.height}:D.reference,le=await(A.getOffsetParent==null?void 0:A.getOffsetParent(L.floating)),Se=await(A.isElement==null?void 0:A.isElement(le))?await(A.getScale==null?void 0:A.getScale(le))||{x:1,y:1}:{x:1,y:1},be=gR(A.convertOffsetParentRelativeRectToViewportRelativeRect?await A.convertOffsetParentRelativeRectToViewportRelativeRect({elements:L,rect:oe,offsetParent:le,strategy:V}):oe);return{top:(ae.top-be.top+re.top)/Se.y,bottom:(be.bottom-ae.bottom+re.bottom)/Se.y,left:(ae.left-be.left+re.left)/Se.x,right:(be.right-ae.right+re.right)/Se.x}}const ZQ=u=>({name:"arrow",options:u,async fn(f){const{x:_,y,placement:C,rects:A,platform:D,elements:L,middlewareData:V}=f,{element:G,padding:W=0}=Al(u,f)||{};if(G==null)return{};const K=UB(W),ee={x:_,y},X=iN(C),re=rN(X),q=await D.getDimensions(G),$=X==="y",ae=$?"top":"left",oe=$?"bottom":"right",le=$?"clientHeight":"clientWidth",Se=A.reference[re]+A.reference[X]-ee[X]-A.floating[re],be=ee[X]-A.reference[X],Ue=await(D.getOffsetParent==null?void 0:D.getOffsetParent(G));let xe=Ue?Ue[le]:0;(!xe||!await(D.isElement==null?void 0:D.isElement(Ue)))&&(xe=L.floating[le]||A.floating[re]);const je=Se/2-be/2,lt=xe/2-q[re]/2-1,Et=eu(K[ae],lt),ht=eu(K[oe],lt),Ge=Et,pt=xe-q[re]-ht,Fe=xe/2-q[re]/2+je,Ct=NA(Ge,Fe,pt),nt=!V.arrow&&ym(C)!=null&&Fe!==Ct&&A.reference[re]/2-(Fe<Ge?Et:ht)-q[re]/2<0,Je=nt?Fe<Ge?Fe-Ge:Fe-pt:0;return{[X]:ee[X]+Je,data:{[X]:Ct,centerOffset:Fe-Ct-Je,...nt&&{alignmentOffset:Je}},reset:nt}}}),$Q=function(u){return u===void 0&&(u={}),{name:"flip",options:u,async fn(f){var _,y;const{placement:C,middlewareData:A,rects:D,initialPlacement:L,platform:V,elements:G}=f,{mainAxis:W=!0,crossAxis:K=!0,fallbackPlacements:ee,fallbackStrategy:X="bestFit",fallbackAxisSideDirection:re="none",flipAlignment:q=!0,...$}=Al(u,f);if((_=A.arrow)!=null&&_.alignmentOffset)return{};const ae=Nl(C),oe=Uc(L),le=Nl(L)===L,Se=await(V.isRTL==null?void 0:V.isRTL(G.floating)),be=ee||(le||!q?[ER(L)]:KQ(L)),Ue=re!=="none";!ee&&Ue&&be.push(...XQ(L,q,re,Se));const xe=[L,...be],je=await xg(f,$),lt=[];let Et=((y=A.flip)==null?void 0:y.overflows)||[];if(W&&lt.push(je[ae]),K){const Fe=HQ(C,D,Se);lt.push(je[Fe[0]],je[Fe[1]])}if(Et=[...Et,{placement:C,overflows:lt}],!lt.every(Fe=>Fe<=0)){var ht,Ge;const Fe=(((ht=A.flip)==null?void 0:ht.index)||0)+1,Ct=xe[Fe];if(Ct&&(!(K==="alignment"?oe!==Uc(Ct):!1)||Et.every(Oe=>Oe.overflows[0]>0&&Uc(Oe.placement)===oe)))return{data:{index:Fe,overflows:Et},reset:{placement:Ct}};let nt=(Ge=Et.filter(Je=>Je.overflows[0]<=0).sort((Je,Oe)=>Je.overflows[1]-Oe.overflows[1])[0])==null?void 0:Ge.placement;if(!nt)switch(X){case"bestFit":{var pt;const Je=(pt=Et.filter(Oe=>{if(Ue){const ke=Uc(Oe.placement);return ke===oe||ke==="y"}return!0}).map(Oe=>[Oe.placement,Oe.overflows.filter(ke=>ke>0).reduce((ke,ze)=>ke+ze,0)]).sort((Oe,ke)=>Oe[1]-ke[1])[0])==null?void 0:pt[0];Je&&(nt=Je);break}case"initialPlacement":nt=L;break}if(C!==nt)return{reset:{placement:nt}}}return{}}}};function iF(u,f){return{top:u.top-f.height,right:u.right-f.width,bottom:u.bottom-f.height,left:u.left-f.width}}function sF(u){return FQ.some(f=>u[f]>=0)}const eZ=function(u){return u===void 0&&(u={}),{name:"hide",options:u,async fn(f){const{rects:_}=f,{strategy:y="referenceHidden",...C}=Al(u,f);switch(y){case"referenceHidden":{const A=await xg(f,{...C,elementContext:"reference"}),D=iF(A,_.reference);return{data:{referenceHiddenOffsets:D,referenceHidden:sF(D)}}}case"escaped":{const A=await xg(f,{...C,altBoundary:!0}),D=iF(A,_.floating);return{data:{escapedOffsets:D,escaped:sF(D)}}}default:return{}}}}},VB=new Set(["left","top"]);async function tZ(u,f){const{placement:_,platform:y,elements:C}=u,A=await(y.isRTL==null?void 0:y.isRTL(C.floating)),D=Nl(_),L=ym(_),V=Uc(_)==="y",G=VB.has(D)?-1:1,W=A&&V?-1:1,K=Al(f,u);let{mainAxis:ee,crossAxis:X,alignmentAxis:re}=typeof K=="number"?{mainAxis:K,crossAxis:0,alignmentAxis:null}:{mainAxis:K.mainAxis||0,crossAxis:K.crossAxis||0,alignmentAxis:K.alignmentAxis};return L&&typeof re=="number"&&(X=L==="end"?re*-1:re),V?{x:X*W,y:ee*G}:{x:ee*G,y:X*W}}const nZ=function(u){return u===void 0&&(u=0),{name:"offset",options:u,async fn(f){var _,y;const{x:C,y:A,placement:D,middlewareData:L}=f,V=await tZ(f,u);return D===((_=L.offset)==null?void 0:_.placement)&&(y=L.arrow)!=null&&y.alignmentOffset?{}:{x:C+V.x,y:A+V.y,data:{...V,placement:D}}}}},rZ=function(u){return u===void 0&&(u={}),{name:"shift",options:u,async fn(f){const{x:_,y,placement:C}=f,{mainAxis:A=!0,crossAxis:D=!1,limiter:L={fn:$=>{let{x:ae,y:oe}=$;return{x:ae,y:oe}}},...V}=Al(u,f),G={x:_,y},W=await xg(f,V),K=Uc(Nl(C)),ee=nN(K);let X=G[ee],re=G[K];if(A){const $=ee==="y"?"top":"left",ae=ee==="y"?"bottom":"right",oe=X+W[$],le=X-W[ae];X=NA(oe,X,le)}if(D){const $=K==="y"?"top":"left",ae=K==="y"?"bottom":"right",oe=re+W[$],le=re-W[ae];re=NA(oe,re,le)}const q=L.fn({...f,[ee]:X,[K]:re});return{...q,data:{x:q.x-_,y:q.y-y,enabled:{[ee]:A,[K]:D}}}}}},iZ=function(u){return u===void 0&&(u={}),{options:u,fn(f){const{x:_,y,placement:C,rects:A,middlewareData:D}=f,{offset:L=0,mainAxis:V=!0,crossAxis:G=!0}=Al(u,f),W={x:_,y},K=Uc(C),ee=nN(K);let X=W[ee],re=W[K];const q=Al(L,f),$=typeof q=="number"?{mainAxis:q,crossAxis:0}:{mainAxis:0,crossAxis:0,...q};if(V){const le=ee==="y"?"height":"width",Se=A.reference[ee]-A.floating[le]+$.mainAxis,be=A.reference[ee]+A.reference[le]-$.mainAxis;X<Se?X=Se:X>be&&(X=be)}if(G){var ae,oe;const le=ee==="y"?"width":"height",Se=VB.has(Nl(C)),be=A.reference[K]-A.floating[le]+(Se&&((ae=D.offset)==null?void 0:ae[K])||0)+(Se?0:$.crossAxis),Ue=A.reference[K]+A.reference[le]+(Se?0:((oe=D.offset)==null?void 0:oe[K])||0)-(Se?$.crossAxis:0);re<be?re=be:re>Ue&&(re=Ue)}return{[ee]:X,[K]:re}}}},sZ=function(u){return u===void 0&&(u={}),{name:"size",options:u,async fn(f){var _,y;const{placement:C,rects:A,platform:D,elements:L}=f,{apply:V=()=>{},...G}=Al(u,f),W=await xg(f,G),K=Nl(C),ee=ym(C),X=Uc(C)==="y",{width:re,height:q}=A.floating;let $,ae;K==="top"||K==="bottom"?($=K,ae=ee===(await(D.isRTL==null?void 0:D.isRTL(L.floating))?"start":"end")?"left":"right"):(ae=K,$=ee==="end"?"top":"bottom");const oe=q-W.top-W.bottom,le=re-W.left-W.right,Se=eu(q-W[$],oe),be=eu(re-W[ae],le),Ue=!f.middlewareData.shift;let xe=Se,je=be;if((_=f.middlewareData.shift)!=null&&_.enabled.x&&(je=le),(y=f.middlewareData.shift)!=null&&y.enabled.y&&(xe=oe),Ue&&!ee){const Et=po(W.left,0),ht=po(W.right,0),Ge=po(W.top,0),pt=po(W.bottom,0);X?je=re-2*(Et!==0||ht!==0?Et+ht:po(W.left,W.right)):xe=q-2*(Ge!==0||pt!==0?Ge+pt:po(W.top,W.bottom))}await V({...f,availableWidth:je,availableHeight:xe});const lt=await D.getDimensions(L.floating);return re!==lt.width||q!==lt.height?{reset:{rects:!0}}:{}}}};function OR(){return typeof window<"u"}function Sm(u){return jB(u)?(u.nodeName||"").toLowerCase():"#document"}function mo(u){var f;return(u==null||(f=u.ownerDocument)==null?void 0:f.defaultView)||window}function Bc(u){var f;return(f=(jB(u)?u.ownerDocument:u.document)||window.document)==null?void 0:f.documentElement}function jB(u){return OR()?u instanceof Node||u instanceof mo(u).Node:!1}function Va(u){return OR()?u instanceof Element||u instanceof mo(u).Element:!1}function Fc(u){return OR()?u instanceof HTMLElement||u instanceof mo(u).HTMLElement:!1}function oF(u){return!OR()||typeof ShadowRoot>"u"?!1:u instanceof ShadowRoot||u instanceof mo(u).ShadowRoot}const oZ=new Set(["inline","contents"]);function Hg(u){const{overflow:f,overflowX:_,overflowY:y,display:C}=ja(u);return/auto|scroll|overlay|hidden|clip/.test(f+y+_)&&!oZ.has(C)}const aZ=new Set(["table","td","th"]);function cZ(u){return aZ.has(Sm(u))}const lZ=[":popover-open",":modal"];function PR(u){return lZ.some(f=>{try{return u.matches(f)}catch{return!1}})}const dZ=["transform","translate","scale","rotate","perspective"],uZ=["transform","translate","scale","rotate","perspective","filter"],hZ=["paint","layout","strict","content"];function sN(u){const f=oN(),_=Va(u)?ja(u):u;return dZ.some(y=>_[y]?_[y]!=="none":!1)||(_.containerType?_.containerType!=="normal":!1)||!f&&(_.backdropFilter?_.backdropFilter!=="none":!1)||!f&&(_.filter?_.filter!=="none":!1)||uZ.some(y=>(_.willChange||"").includes(y))||hZ.some(y=>(_.contain||"").includes(y))}function pZ(u){let f=tu(u);for(;Fc(f)&&!_m(f);){if(sN(f))return f;if(PR(f))return null;f=tu(f)}return null}function oN(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}const fZ=new Set(["html","body","#document"]);function _m(u){return fZ.has(Sm(u))}function ja(u){return mo(u).getComputedStyle(u)}function DR(u){return Va(u)?{scrollLeft:u.scrollLeft,scrollTop:u.scrollTop}:{scrollLeft:u.scrollX,scrollTop:u.scrollY}}function tu(u){if(Sm(u)==="html")return u;const f=u.assignedSlot||u.parentNode||oF(u)&&u.host||Bc(u);return oF(f)?f.host:f}function FB(u){const f=tu(u);return _m(f)?u.ownerDocument?u.ownerDocument.body:u.body:Fc(f)&&Hg(f)?f:FB(f)}function Mg(u,f,_){var y;f===void 0&&(f=[]),_===void 0&&(_=!0);const C=FB(u),A=C===((y=u.ownerDocument)==null?void 0:y.body),D=mo(C);if(A){const L=PA(D);return f.concat(D,D.visualViewport||[],Hg(C)?C:[],L&&_?Mg(L):[])}return f.concat(C,Mg(C,[],_))}function PA(u){return u.parent&&Object.getPrototypeOf(u.parent)?u.frameElement:null}function BB(u){const f=ja(u);let _=parseFloat(f.width)||0,y=parseFloat(f.height)||0;const C=Fc(u),A=C?u.offsetWidth:_,D=C?u.offsetHeight:y,L=_R(_)!==A||_R(y)!==D;return L&&(_=A,y=D),{width:_,height:y,$:L}}function aN(u){return Va(u)?u:u.contextElement}function um(u){const f=aN(u);if(!Fc(f))return jc(1);const _=f.getBoundingClientRect(),{width:y,height:C,$:A}=BB(f);let D=(A?_R(_.width):_.width)/y,L=(A?_R(_.height):_.height)/C;return(!D||!Number.isFinite(D))&&(D=1),(!L||!Number.isFinite(L))&&(L=1),{x:D,y:L}}const mZ=jc(0);function WB(u){const f=mo(u);return!oN()||!f.visualViewport?mZ:{x:f.visualViewport.offsetLeft,y:f.visualViewport.offsetTop}}function _Z(u,f,_){return f===void 0&&(f=!1),!_||f&&_!==mo(u)?!1:f}function Bh(u,f,_,y){f===void 0&&(f=!1),_===void 0&&(_=!1);const C=u.getBoundingClientRect(),A=aN(u);let D=jc(1);f&&(y?Va(y)&&(D=um(y)):D=um(u));const L=_Z(A,_,y)?WB(A):jc(0);let V=(C.left+L.x)/D.x,G=(C.top+L.y)/D.y,W=C.width/D.x,K=C.height/D.y;if(A){const ee=mo(A),X=y&&Va(y)?mo(y):y;let re=ee,q=PA(re);for(;q&&y&&X!==re;){const $=um(q),ae=q.getBoundingClientRect(),oe=ja(q),le=ae.left+(q.clientLeft+parseFloat(oe.paddingLeft))*$.x,Se=ae.top+(q.clientTop+parseFloat(oe.paddingTop))*$.y;V*=$.x,G*=$.y,W*=$.x,K*=$.y,V+=le,G+=Se,re=mo(q),q=PA(re)}}return gR({width:W,height:K,x:V,y:G})}function cN(u,f){const _=DR(u).scrollLeft;return f?f.left+_:Bh(Bc(u)).left+_}function GB(u,f,_){_===void 0&&(_=!1);const y=u.getBoundingClientRect(),C=y.left+f.scrollLeft-(_?0:cN(u,y)),A=y.top+f.scrollTop;return{x:C,y:A}}function EZ(u){let{elements:f,rect:_,offsetParent:y,strategy:C}=u;const A=C==="fixed",D=Bc(y),L=f?PR(f.floating):!1;if(y===D||L&&A)return _;let V={scrollLeft:0,scrollTop:0},G=jc(1);const W=jc(0),K=Fc(y);if((K||!K&&!A)&&((Sm(y)!=="body"||Hg(D))&&(V=DR(y)),Fc(y))){const X=Bh(y);G=um(y),W.x=X.x+y.clientLeft,W.y=X.y+y.clientTop}const ee=D&&!K&&!A?GB(D,V,!0):jc(0);return{width:_.width*G.x,height:_.height*G.y,x:_.x*G.x-V.scrollLeft*G.x+W.x+ee.x,y:_.y*G.y-V.scrollTop*G.y+W.y+ee.y}}function gZ(u){return Array.from(u.getClientRects())}function vZ(u){const f=Bc(u),_=DR(u),y=u.ownerDocument.body,C=po(f.scrollWidth,f.clientWidth,y.scrollWidth,y.clientWidth),A=po(f.scrollHeight,f.clientHeight,y.scrollHeight,y.clientHeight);let D=-_.scrollLeft+cN(u);const L=-_.scrollTop;return ja(y).direction==="rtl"&&(D+=po(f.clientWidth,y.clientWidth)-C),{width:C,height:A,x:D,y:L}}function yZ(u,f){const _=mo(u),y=Bc(u),C=_.visualViewport;let A=y.clientWidth,D=y.clientHeight,L=0,V=0;if(C){A=C.width,D=C.height;const G=oN();(!G||G&&f==="fixed")&&(L=C.offsetLeft,V=C.offsetTop)}return{width:A,height:D,x:L,y:V}}const SZ=new Set(["absolute","fixed"]);function TZ(u,f){const _=Bh(u,!0,f==="fixed"),y=_.top+u.clientTop,C=_.left+u.clientLeft,A=Fc(u)?um(u):jc(1),D=u.clientWidth*A.x,L=u.clientHeight*A.y,V=C*A.x,G=y*A.y;return{width:D,height:L,x:V,y:G}}function aF(u,f,_){let y;if(f==="viewport")y=yZ(u,_);else if(f==="document")y=vZ(Bc(u));else if(Va(f))y=TZ(f,_);else{const C=WB(u);y={x:f.x-C.x,y:f.y-C.y,width:f.width,height:f.height}}return gR(y)}function HB(u,f){const _=tu(u);return _===f||!Va(_)||_m(_)?!1:ja(_).position==="fixed"||HB(_,f)}function RZ(u,f){const _=f.get(u);if(_)return _;let y=Mg(u,[],!1).filter(L=>Va(L)&&Sm(L)!=="body"),C=null;const A=ja(u).position==="fixed";let D=A?tu(u):u;for(;Va(D)&&!_m(D);){const L=ja(D),V=sN(D);!V&&L.position==="fixed"&&(C=null),(A?!V&&!C:!V&&L.position==="static"&&!!C&&SZ.has(C.position)||Hg(D)&&!V&&HB(u,D))?y=y.filter(W=>W!==D):C=L,D=tu(D)}return f.set(u,y),y}function CZ(u){let{element:f,boundary:_,rootBoundary:y,strategy:C}=u;const D=[..._==="clippingAncestors"?PR(f)?[]:RZ(f,this._c):[].concat(_),y],L=D[0],V=D.reduce((G,W)=>{const K=aF(f,W,C);return G.top=po(K.top,G.top),G.right=eu(K.right,G.right),G.bottom=eu(K.bottom,G.bottom),G.left=po(K.left,G.left),G},aF(f,L,C));return{width:V.right-V.left,height:V.bottom-V.top,x:V.left,y:V.top}}function wZ(u){const{width:f,height:_}=BB(u);return{width:f,height:_}}function bZ(u,f,_){const y=Fc(f),C=Bc(f),A=_==="fixed",D=Bh(u,!0,A,f);let L={scrollLeft:0,scrollTop:0};const V=jc(0);function G(){V.x=cN(C)}if(y||!y&&!A)if((Sm(f)!=="body"||Hg(C))&&(L=DR(f)),y){const X=Bh(f,!0,A,f);V.x=X.x+f.clientLeft,V.y=X.y+f.clientTop}else C&&G();A&&!y&&C&&G();const W=C&&!y&&!A?GB(C,L):jc(0),K=D.left+L.scrollLeft-V.x-W.x,ee=D.top+L.scrollTop-V.y-W.y;return{x:K,y:ee,width:D.width,height:D.height}}function cA(u){return ja(u).position==="static"}function cF(u,f){if(!Fc(u)||ja(u).position==="fixed")return null;if(f)return f(u);let _=u.offsetParent;return Bc(u)===_&&(_=_.ownerDocument.body),_}function KB(u,f){const _=mo(u);if(PR(u))return _;if(!Fc(u)){let C=tu(u);for(;C&&!_m(C);){if(Va(C)&&!cA(C))return C;C=tu(C)}return _}let y=cF(u,f);for(;y&&cZ(y)&&cA(y);)y=cF(y,f);return y&&_m(y)&&cA(y)&&!sN(y)?_:y||pZ(u)||_}const IZ=async function(u){const f=this.getOffsetParent||KB,_=this.getDimensions,y=await _(u.floating);return{reference:bZ(u.reference,await f(u.floating),u.strategy),floating:{x:0,y:0,width:y.width,height:y.height}}};function AZ(u){return ja(u).direction==="rtl"}const NZ={convertOffsetParentRelativeRectToViewportRelativeRect:EZ,getDocumentElement:Bc,getClippingRect:CZ,getOffsetParent:KB,getElementRects:IZ,getClientRects:gZ,getDimensions:wZ,getScale:um,isElement:Va,isRTL:AZ};function zB(u,f){return u.x===f.x&&u.y===f.y&&u.width===f.width&&u.height===f.height}function OZ(u,f){let _=null,y;const C=Bc(u);function A(){var L;clearTimeout(y),(L=_)==null||L.disconnect(),_=null}function D(L,V){L===void 0&&(L=!1),V===void 0&&(V=1),A();const G=u.getBoundingClientRect(),{left:W,top:K,width:ee,height:X}=G;if(L||f(),!ee||!X)return;const re=tR(K),q=tR(C.clientWidth-(W+ee)),$=tR(C.clientHeight-(K+X)),ae=tR(W),le={rootMargin:-re+"px "+-q+"px "+-$+"px "+-ae+"px",threshold:po(0,eu(1,V))||1};let Se=!0;function be(Ue){const xe=Ue[0].intersectionRatio;if(xe!==V){if(!Se)return D();xe?D(!1,xe):y=setTimeout(()=>{D(!1,1e-7)},1e3)}xe===1&&!zB(G,u.getBoundingClientRect())&&D(),Se=!1}try{_=new IntersectionObserver(be,{...le,root:C.ownerDocument})}catch{_=new IntersectionObserver(be,le)}_.observe(u)}return D(!0),A}function PZ(u,f,_,y){y===void 0&&(y={});const{ancestorScroll:C=!0,ancestorResize:A=!0,elementResize:D=typeof ResizeObserver=="function",layoutShift:L=typeof IntersectionObserver=="function",animationFrame:V=!1}=y,G=aN(u),W=C||A?[...G?Mg(G):[],...Mg(f)]:[];W.forEach(ae=>{C&&ae.addEventListener("scroll",_,{passive:!0}),A&&ae.addEventListener("resize",_)});const K=G&&L?OZ(G,_):null;let ee=-1,X=null;D&&(X=new ResizeObserver(ae=>{let[oe]=ae;oe&&oe.target===G&&X&&(X.unobserve(f),cancelAnimationFrame(ee),ee=requestAnimationFrame(()=>{var le;(le=X)==null||le.observe(f)})),_()}),G&&!V&&X.observe(G),X.observe(f));let re,q=V?Bh(u):null;V&&$();function $(){const ae=Bh(u);q&&!zB(q,ae)&&_(),q=ae,re=requestAnimationFrame($)}return _(),()=>{var ae;W.forEach(oe=>{C&&oe.removeEventListener("scroll",_),A&&oe.removeEventListener("resize",_)}),K?.(),(ae=X)==null||ae.disconnect(),X=null,V&&cancelAnimationFrame(re)}}const DZ=nZ,kZ=rZ,LZ=$Q,xZ=sZ,MZ=eZ,lF=ZQ,UZ=iZ,VZ=(u,f,_)=>{const y=new Map,C={platform:NZ,..._},A={...C.platform,_c:y};return QQ(u,f,{...C,platform:A})};var jZ=typeof document<"u",FZ=function(){},uR=jZ?j.useLayoutEffect:FZ;function vR(u,f){if(u===f)return!0;if(typeof u!=typeof f)return!1;if(typeof u=="function"&&u.toString()===f.toString())return!0;let _,y,C;if(u&&f&&typeof u=="object"){if(Array.isArray(u)){if(_=u.length,_!==f.length)return!1;for(y=_;y--!==0;)if(!vR(u[y],f[y]))return!1;return!0}if(C=Object.keys(u),_=C.length,_!==Object.keys(f).length)return!1;for(y=_;y--!==0;)if(!{}.hasOwnProperty.call(f,C[y]))return!1;for(y=_;y--!==0;){const A=C[y];if(!(A==="_owner"&&u.$$typeof)&&!vR(u[A],f[A]))return!1}return!0}return u!==u&&f!==f}function YB(u){return typeof window>"u"?1:(u.ownerDocument.defaultView||window).devicePixelRatio||1}function dF(u,f){const _=YB(u);return Math.round(f*_)/_}function lA(u){const f=j.useRef(u);return uR(()=>{f.current=u}),f}function BZ(u){u===void 0&&(u={});const{placement:f="bottom",strategy:_="absolute",middleware:y=[],platform:C,elements:{reference:A,floating:D}={},transform:L=!0,whileElementsMounted:V,open:G}=u,[W,K]=j.useState({x:0,y:0,strategy:_,placement:f,middlewareData:{},isPositioned:!1}),[ee,X]=j.useState(y);vR(ee,y)||X(y);const[re,q]=j.useState(null),[$,ae]=j.useState(null),oe=j.useCallback(Oe=>{Oe!==Ue.current&&(Ue.current=Oe,q(Oe))},[]),le=j.useCallback(Oe=>{Oe!==xe.current&&(xe.current=Oe,ae(Oe))},[]),Se=A||re,be=D||$,Ue=j.useRef(null),xe=j.useRef(null),je=j.useRef(W),lt=V!=null,Et=lA(V),ht=lA(C),Ge=lA(G),pt=j.useCallback(()=>{if(!Ue.current||!xe.current)return;const Oe={placement:f,strategy:_,middleware:ee};ht.current&&(Oe.platform=ht.current),VZ(Ue.current,xe.current,Oe).then(ke=>{const ze={...ke,isPositioned:Ge.current!==!1};Fe.current&&!vR(je.current,ze)&&(je.current=ze,gm.flushSync(()=>{K(ze)}))})},[ee,f,_,ht,Ge]);uR(()=>{G===!1&&je.current.isPositioned&&(je.current.isPositioned=!1,K(Oe=>({...Oe,isPositioned:!1})))},[G]);const Fe=j.useRef(!1);uR(()=>(Fe.current=!0,()=>{Fe.current=!1}),[]),uR(()=>{if(Se&&(Ue.current=Se),be&&(xe.current=be),Se&&be){if(Et.current)return Et.current(Se,be,pt);pt()}},[Se,be,pt,Et,lt]);const Ct=j.useMemo(()=>({reference:Ue,floating:xe,setReference:oe,setFloating:le}),[oe,le]),nt=j.useMemo(()=>({reference:Se,floating:be}),[Se,be]),Je=j.useMemo(()=>{const Oe={position:_,left:0,top:0};if(!nt.floating)return Oe;const ke=dF(nt.floating,W.x),ze=dF(nt.floating,W.y);return L?{...Oe,transform:"translate("+ke+"px, "+ze+"px)",...YB(nt.floating)>=1.5&&{willChange:"transform"}}:{position:_,left:ke,top:ze}},[_,L,nt.floating,W.x,W.y]);return j.useMemo(()=>({...W,update:pt,refs:Ct,elements:nt,floatingStyles:Je}),[W,pt,Ct,nt,Je])}const WZ=u=>{function f(_){return{}.hasOwnProperty.call(_,"current")}return{name:"arrow",options:u,fn(_){const{element:y,padding:C}=typeof u=="function"?u(_):u;return y&&f(y)?y.current!=null?lF({element:y.current,padding:C}).fn(_):{}:y?lF({element:y,padding:C}).fn(_):{}}}},GZ=(u,f)=>({...DZ(u),options:[u,f]}),HZ=(u,f)=>({...kZ(u),options:[u,f]}),KZ=(u,f)=>({...UZ(u),options:[u,f]}),zZ=(u,f)=>({...LZ(u),options:[u,f]}),YZ=(u,f)=>({...xZ(u),options:[u,f]}),qZ=(u,f)=>({...MZ(u),options:[u,f]}),XZ=(u,f)=>({...WZ(u),options:[u,f]});var JZ="Arrow",qB=j.forwardRef((u,f)=>{const{children:_,width:y=10,height:C=5,...A}=u;return T.jsx(En.svg,{...A,ref:f,width:y,height:C,viewBox:"0 0 30 10",preserveAspectRatio:"none",children:u.asChild?_:T.jsx("polygon",{points:"0,0 30,0 15,10"})})});qB.displayName=JZ;var QZ=qB;function XB(u){const[f,_]=j.useState(void 0);return oi(()=>{if(u){_({width:u.offsetWidth,height:u.offsetHeight});const y=new ResizeObserver(C=>{if(!Array.isArray(C)||!C.length)return;const A=C[0];let D,L;if("borderBoxSize"in A){const V=A.borderBoxSize,G=Array.isArray(V)?V[0]:V;D=G.inlineSize,L=G.blockSize}else D=u.offsetWidth,L=u.offsetHeight;_({width:D,height:L})});return y.observe(u,{box:"border-box"}),()=>y.unobserve(u)}else _(void 0)},[u]),f}var lN="Popper",[JB,kR]=Ol(lN),[ZZ,QB]=JB(lN),ZB=u=>{const{__scopePopper:f,children:_}=u,[y,C]=j.useState(null);return T.jsx(ZZ,{scope:f,anchor:y,onAnchorChange:C,children:_})};ZB.displayName=lN;var $B="PopperAnchor",e3=j.forwardRef((u,f)=>{const{__scopePopper:_,virtualRef:y,...C}=u,A=QB($B,_),D=j.useRef(null),L=yr(f,D);return j.useEffect(()=>{A.onAnchorChange(y?.current||D.current)}),y?null:T.jsx(En.div,{...C,ref:L})});e3.displayName=$B;var dN="PopperContent",[$Z,e$]=JB(dN),t3=j.forwardRef((u,f)=>{const{__scopePopper:_,side:y="bottom",sideOffset:C=0,align:A="center",alignOffset:D=0,arrowPadding:L=0,avoidCollisions:V=!0,collisionBoundary:G=[],collisionPadding:W=0,sticky:K="partial",hideWhenDetached:ee=!1,updatePositionStrategy:X="optimized",onPlaced:re,...q}=u,$=QB(dN,_),[ae,oe]=j.useState(null),le=yr(f,Ye=>oe(Ye)),[Se,be]=j.useState(null),Ue=XB(Se),xe=Ue?.width??0,je=Ue?.height??0,lt=y+(A!=="center"?"-"+A:""),Et=typeof W=="number"?W:{top:0,right:0,bottom:0,left:0,...W},ht=Array.isArray(G)?G:[G],Ge=ht.length>0,pt={padding:Et,boundary:ht.filter(n$),altBoundary:Ge},{refs:Fe,floatingStyles:Ct,placement:nt,isPositioned:Je,middlewareData:Oe}=BZ({strategy:"fixed",placement:lt,whileElementsMounted:(...Ye)=>PZ(...Ye,{animationFrame:X==="always"}),elements:{reference:$.anchor},middleware:[GZ({mainAxis:C+je,alignmentAxis:D}),V&&HZ({mainAxis:!0,crossAxis:!1,limiter:K==="partial"?KZ():void 0,...pt}),V&&zZ({...pt}),YZ({...pt,apply:({elements:Ye,rects:At,availableWidth:Wt,availableHeight:Kt})=>{const{width:Rn,height:Yn}=At.reference,er=Ye.floating.style;er.setProperty("--radix-popper-available-width",`${Wt}px`),er.setProperty("--radix-popper-available-height",`${Kt}px`),er.setProperty("--radix-popper-anchor-width",`${Rn}px`),er.setProperty("--radix-popper-anchor-height",`${Yn}px`)}}),Se&&XZ({element:Se,padding:L}),r$({arrowWidth:xe,arrowHeight:je}),ee&&qZ({strategy:"referenceHidden",...pt})]}),[ke,ze]=i3(nt),he=_o(re);oi(()=>{Je&&he?.()},[Je,he]);const Ie=Oe.arrow?.x,it=Oe.arrow?.y,rt=Oe.arrow?.centerOffset!==0,[Ot,Ht]=j.useState();return oi(()=>{ae&&Ht(window.getComputedStyle(ae).zIndex)},[ae]),T.jsx("div",{ref:Fe.setFloating,"data-radix-popper-content-wrapper":"",style:{...Ct,transform:Je?Ct.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:Ot,"--radix-popper-transform-origin":[Oe.transformOrigin?.x,Oe.transformOrigin?.y].join(" "),...Oe.hide?.referenceHidden&&{visibility:"hidden",pointerEvents:"none"}},dir:u.dir,children:T.jsx($Z,{scope:_,placedSide:ke,onArrowChange:be,arrowX:Ie,arrowY:it,shouldHideArrow:rt,children:T.jsx(En.div,{"data-side":ke,"data-align":ze,...q,ref:le,style:{...q.style,animation:Je?void 0:"none"}})})})});t3.displayName=dN;var n3="PopperArrow",t$={top:"bottom",right:"left",bottom:"top",left:"right"},r3=j.forwardRef(function(f,_){const{__scopePopper:y,...C}=f,A=e$(n3,y),D=t$[A.placedSide];return T.jsx("span",{ref:A.onArrowChange,style:{position:"absolute",left:A.arrowX,top:A.arrowY,[D]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[A.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[A.placedSide],visibility:A.shouldHideArrow?"hidden":void 0},children:T.jsx(QZ,{...C,ref:_,style:{...C.style,display:"block"}})})});r3.displayName=n3;function n$(u){return u!==null}var r$=u=>({name:"transformOrigin",options:u,fn(f){const{placement:_,rects:y,middlewareData:C}=f,D=C.arrow?.centerOffset!==0,L=D?0:u.arrowWidth,V=D?0:u.arrowHeight,[G,W]=i3(_),K={start:"0%",center:"50%",end:"100%"}[W],ee=(C.arrow?.x??0)+L/2,X=(C.arrow?.y??0)+V/2;let re="",q="";return G==="bottom"?(re=D?K:`${ee}px`,q=`${-V}px`):G==="top"?(re=D?K:`${ee}px`,q=`${y.floating.height+V}px`):G==="right"?(re=`${-V}px`,q=D?K:`${X}px`):G==="left"&&(re=`${y.floating.width+V}px`,q=D?K:`${X}px`),{data:{x:re,y:q}}}});function i3(u){const[f,_="center"]=u.split("-");return[f,_]}var i$=ZB,s3=e3,o3=t3,a3=r3,[LR]=Ol("Tooltip",[kR]),uN=kR(),c3="TooltipProvider",s$=700,uF="tooltip.open",[o$,l3]=LR(c3),d3=u=>{const{__scopeTooltip:f,delayDuration:_=s$,skipDelayDuration:y=300,disableHoverableContent:C=!1,children:A}=u,D=j.useRef(!0),L=j.useRef(!1),V=j.useRef(0);return j.useEffect(()=>{const G=V.current;return()=>window.clearTimeout(G)},[]),T.jsx(o$,{scope:f,isOpenDelayedRef:D,delayDuration:_,onOpen:j.useCallback(()=>{window.clearTimeout(V.current),D.current=!1},[]),onClose:j.useCallback(()=>{window.clearTimeout(V.current),V.current=window.setTimeout(()=>D.current=!0,y)},[y]),isPointerInTransitRef:L,onPointerInTransitChange:j.useCallback(G=>{L.current=G},[]),disableHoverableContent:C,children:A})};d3.displayName=c3;var u3="Tooltip",[Ire,xR]=LR(u3),DA="TooltipTrigger",a$=j.forwardRef((u,f)=>{const{__scopeTooltip:_,...y}=u,C=xR(DA,_),A=l3(DA,_),D=uN(_),L=j.useRef(null),V=yr(f,L,C.onTriggerChange),G=j.useRef(!1),W=j.useRef(!1),K=j.useCallback(()=>G.current=!1,[]);return j.useEffect(()=>()=>document.removeEventListener("pointerup",K),[K]),T.jsx(s3,{asChild:!0,...D,children:T.jsx(En.button,{"aria-describedby":C.open?C.contentId:void 0,"data-state":C.stateAttribute,...y,ref:V,onPointerMove:$t(u.onPointerMove,ee=>{ee.pointerType!=="touch"&&!W.current&&!A.isPointerInTransitRef.current&&(C.onTriggerEnter(),W.current=!0)}),onPointerLeave:$t(u.onPointerLeave,()=>{C.onTriggerLeave(),W.current=!1}),onPointerDown:$t(u.onPointerDown,()=>{C.open&&C.onClose(),G.current=!0,document.addEventListener("pointerup",K,{once:!0})}),onFocus:$t(u.onFocus,()=>{G.current||C.onOpen()}),onBlur:$t(u.onBlur,C.onClose),onClick:$t(u.onClick,C.onClose)})})});a$.displayName=DA;var c$="TooltipPortal",[Are,l$]=LR(c$,{forceMount:void 0}),Em="TooltipContent",h3=j.forwardRef((u,f)=>{const _=l$(Em,u.__scopeTooltip),{forceMount:y=_.forceMount,side:C="top",...A}=u,D=xR(Em,u.__scopeTooltip);return T.jsx(wR,{present:y||D.open,children:D.disableHoverableContent?T.jsx(p3,{side:C,...A,ref:f}):T.jsx(d$,{side:C,...A,ref:f})})}),d$=j.forwardRef((u,f)=>{const _=xR(Em,u.__scopeTooltip),y=l3(Em,u.__scopeTooltip),C=j.useRef(null),A=yr(f,C),[D,L]=j.useState(null),{trigger:V,onClose:G}=_,W=C.current,{onPointerInTransitChange:K}=y,ee=j.useCallback(()=>{L(null),K(!1)},[K]),X=j.useCallback((re,q)=>{const $=re.currentTarget,ae={x:re.clientX,y:re.clientY},oe=m$(ae,$.getBoundingClientRect()),le=_$(ae,oe),Se=E$(q.getBoundingClientRect()),be=v$([...le,...Se]);L(be),K(!0)},[K]);return j.useEffect(()=>()=>ee(),[ee]),j.useEffect(()=>{if(V&&W){const re=$=>X($,W),q=$=>X($,V);return V.addEventListener("pointerleave",re),W.addEventListener("pointerleave",q),()=>{V.removeEventListener("pointerleave",re),W.removeEventListener("pointerleave",q)}}},[V,W,X,ee]),j.useEffect(()=>{if(D){const re=q=>{const $=q.target,ae={x:q.clientX,y:q.clientY},oe=V?.contains($)||W?.contains($),le=!g$(ae,D);oe?ee():le&&(ee(),G())};return document.addEventListener("pointermove",re),()=>document.removeEventListener("pointermove",re)}},[V,W,D,G,ee]),T.jsx(p3,{...u,ref:A})}),[u$,h$]=LR(u3,{isInside:!1}),p$=dX("TooltipContent"),p3=j.forwardRef((u,f)=>{const{__scopeTooltip:_,children:y,"aria-label":C,onEscapeKeyDown:A,onPointerDownOutside:D,...L}=u,V=xR(Em,_),G=uN(_),{onClose:W}=V;return j.useEffect(()=>(document.addEventListener(uF,W),()=>document.removeEventListener(uF,W)),[W]),j.useEffect(()=>{if(V.trigger){const K=ee=>{ee.target?.contains(V.trigger)&&W()};return window.addEventListener("scroll",K,{capture:!0}),()=>window.removeEventListener("scroll",K,{capture:!0})}},[V.trigger,W]),T.jsx(CR,{asChild:!0,disableOutsidePointerEvents:!1,onEscapeKeyDown:A,onPointerDownOutside:D,onFocusOutside:K=>K.preventDefault(),onDismiss:W,children:T.jsxs(o3,{"data-state":V.stateAttribute,...G,...L,ref:f,style:{...L.style,"--radix-tooltip-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-tooltip-content-available-width":"var(--radix-popper-available-width)","--radix-tooltip-content-available-height":"var(--radix-popper-available-height)","--radix-tooltip-trigger-width":"var(--radix-popper-anchor-width)","--radix-tooltip-trigger-height":"var(--radix-popper-anchor-height)"},children:[T.jsx(p$,{children:y}),T.jsx(u$,{scope:_,isInside:!0,children:T.jsx(DX,{id:V.contentId,role:"tooltip",children:C||y})})]})})});h3.displayName=Em;var f3="TooltipArrow",f$=j.forwardRef((u,f)=>{const{__scopeTooltip:_,...y}=u,C=uN(_);return h$(f3,_).isInside?null:T.jsx(a3,{...C,...y,ref:f})});f$.displayName=f3;function m$(u,f){const _=Math.abs(f.top-u.y),y=Math.abs(f.bottom-u.y),C=Math.abs(f.right-u.x),A=Math.abs(f.left-u.x);switch(Math.min(_,y,C,A)){case A:return"left";case C:return"right";case _:return"top";case y:return"bottom";default:throw new Error("unreachable")}}function _$(u,f,_=5){const y=[];switch(f){case"top":y.push({x:u.x-_,y:u.y+_},{x:u.x+_,y:u.y+_});break;case"bottom":y.push({x:u.x-_,y:u.y-_},{x:u.x+_,y:u.y-_});break;case"left":y.push({x:u.x+_,y:u.y-_},{x:u.x+_,y:u.y+_});break;case"right":y.push({x:u.x-_,y:u.y-_},{x:u.x-_,y:u.y+_});break}return y}function E$(u){const{top:f,right:_,bottom:y,left:C}=u;return[{x:C,y:f},{x:_,y:f},{x:_,y},{x:C,y}]}function g$(u,f){const{x:_,y}=u;let C=!1;for(let A=0,D=f.length-1;A<f.length;D=A++){const L=f[A],V=f[D],G=L.x,W=L.y,K=V.x,ee=V.y;W>y!=ee>y&&_<(K-G)*(y-W)/(ee-W)+G&&(C=!C)}return C}function v$(u){const f=u.slice();return f.sort((_,y)=>_.x<y.x?-1:_.x>y.x?1:_.y<y.y?-1:_.y>y.y?1:0),y$(f)}function y$(u){if(u.length<=1)return u.slice();const f=[];for(let y=0;y<u.length;y++){const C=u[y];for(;f.length>=2;){const A=f[f.length-1],D=f[f.length-2];if((A.x-D.x)*(C.y-D.y)>=(A.y-D.y)*(C.x-D.x))f.pop();else break}f.push(C)}f.pop();const _=[];for(let y=u.length-1;y>=0;y--){const C=u[y];for(;_.length>=2;){const A=_[_.length-1],D=_[_.length-2];if((A.x-D.x)*(C.y-D.y)>=(A.y-D.y)*(C.x-D.x))_.pop();else break}_.push(C)}return _.pop(),f.length===1&&_.length===1&&f[0].x===_[0].x&&f[0].y===_[0].y?f:f.concat(_)}var S$=d3,m3=h3;const T$=S$,R$=j.forwardRef(({className:u,sideOffset:f=4,..._},y)=>T.jsx(m3,{ref:y,sideOffset:f,className:Vn("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",u),..._}));R$.displayName=m3.displayName;var MR=class{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(u){return this.listeners.add(u),this.onSubscribe(),()=>{this.listeners.delete(u),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}},UR=typeof window>"u"||"Deno"in globalThis;function Ua(){}function C$(u,f){return typeof u=="function"?u(f):u}function w$(u){return typeof u=="number"&&u>=0&&u!==1/0}function b$(u,f){return Math.max(u+(f||0)-Date.now(),0)}function kA(u,f){return typeof u=="function"?u(f):u}function I$(u,f){return typeof u=="function"?u(f):u}function hF(u,f){const{type:_="all",exact:y,fetchStatus:C,predicate:A,queryKey:D,stale:L}=u;if(D){if(y){if(f.queryHash!==hN(D,f.options))return!1}else if(!Vg(f.queryKey,D))return!1}if(_!=="all"){const V=f.isActive();if(_==="active"&&!V||_==="inactive"&&V)return!1}return!(typeof L=="boolean"&&f.isStale()!==L||C&&C!==f.state.fetchStatus||A&&!A(f))}function pF(u,f){const{exact:_,status:y,predicate:C,mutationKey:A}=u;if(A){if(!f.options.mutationKey)return!1;if(_){if(Ug(f.options.mutationKey)!==Ug(A))return!1}else if(!Vg(f.options.mutationKey,A))return!1}return!(y&&f.state.status!==y||C&&!C(f))}function hN(u,f){return(f?.queryKeyHashFn||Ug)(u)}function Ug(u){return JSON.stringify(u,(f,_)=>LA(_)?Object.keys(_).sort().reduce((y,C)=>(y[C]=_[C],y),{}):_)}function Vg(u,f){return u===f?!0:typeof u!=typeof f?!1:u&&f&&typeof u=="object"&&typeof f=="object"?Object.keys(f).every(_=>Vg(u[_],f[_])):!1}function _3(u,f){if(u===f)return u;const _=fF(u)&&fF(f);if(_||LA(u)&&LA(f)){const y=_?u:Object.keys(u),C=y.length,A=_?f:Object.keys(f),D=A.length,L=_?[]:{},V=new Set(y);let G=0;for(let W=0;W<D;W++){const K=_?W:A[W];(!_&&V.has(K)||_)&&u[K]===void 0&&f[K]===void 0?(L[K]=void 0,G++):(L[K]=_3(u[K],f[K]),L[K]===u[K]&&u[K]!==void 0&&G++)}return C===D&&G===C?u:L}return f}function fF(u){return Array.isArray(u)&&u.length===Object.keys(u).length}function LA(u){if(!mF(u))return!1;const f=u.constructor;if(f===void 0)return!0;const _=f.prototype;return!(!mF(_)||!_.hasOwnProperty("isPrototypeOf")||Object.getPrototypeOf(u)!==Object.prototype)}function mF(u){return Object.prototype.toString.call(u)==="[object Object]"}function A$(u){return new Promise(f=>{setTimeout(f,u)})}function N$(u,f,_){return typeof _.structuralSharing=="function"?_.structuralSharing(u,f):_.structuralSharing!==!1?_3(u,f):f}function O$(u,f,_=0){const y=[...u,f];return _&&y.length>_?y.slice(1):y}function P$(u,f,_=0){const y=[f,...u];return _&&y.length>_?y.slice(0,-1):y}var pN=Symbol();function E3(u,f){return!u.queryFn&&f?.initialPromise?()=>f.initialPromise:!u.queryFn||u.queryFn===pN?()=>Promise.reject(new Error(`Missing queryFn: '${u.queryHash}'`)):u.queryFn}var D$=class extends MR{#e;#t;#n;constructor(){super(),this.#n=u=>{if(!UR&&window.addEventListener){const f=()=>u();return window.addEventListener("visibilitychange",f,!1),()=>{window.removeEventListener("visibilitychange",f)}}}}onSubscribe(){this.#t||this.setEventListener(this.#n)}onUnsubscribe(){this.hasListeners()||(this.#t?.(),this.#t=void 0)}setEventListener(u){this.#n=u,this.#t?.(),this.#t=u(f=>{typeof f=="boolean"?this.setFocused(f):this.onFocus()})}setFocused(u){this.#e!==u&&(this.#e=u,this.onFocus())}onFocus(){const u=this.isFocused();this.listeners.forEach(f=>{f(u)})}isFocused(){return typeof this.#e=="boolean"?this.#e:globalThis.document?.visibilityState!=="hidden"}},g3=new D$,k$=class extends MR{#e=!0;#t;#n;constructor(){super(),this.#n=u=>{if(!UR&&window.addEventListener){const f=()=>u(!0),_=()=>u(!1);return window.addEventListener("online",f,!1),window.addEventListener("offline",_,!1),()=>{window.removeEventListener("online",f),window.removeEventListener("offline",_)}}}}onSubscribe(){this.#t||this.setEventListener(this.#n)}onUnsubscribe(){this.hasListeners()||(this.#t?.(),this.#t=void 0)}setEventListener(u){this.#n=u,this.#t?.(),this.#t=u(this.setOnline.bind(this))}setOnline(u){this.#e!==u&&(this.#e=u,this.listeners.forEach(_=>{_(u)}))}isOnline(){return this.#e}},yR=new k$;function L$(){let u,f;const _=new Promise((C,A)=>{u=C,f=A});_.status="pending",_.catch(()=>{});function y(C){Object.assign(_,C),delete _.resolve,delete _.reject}return _.resolve=C=>{y({status:"fulfilled",value:C}),u(C)},_.reject=C=>{y({status:"rejected",reason:C}),f(C)},_}function x$(u){return Math.min(1e3*2**u,3e4)}function v3(u){return(u??"online")==="online"?yR.isOnline():!0}var y3=class extends Error{constructor(u){super("CancelledError"),this.revert=u?.revert,this.silent=u?.silent}};function dA(u){return u instanceof y3}function S3(u){let f=!1,_=0,y=!1,C;const A=L$(),D=q=>{y||(ee(new y3(q)),u.abort?.())},L=()=>{f=!0},V=()=>{f=!1},G=()=>g3.isFocused()&&(u.networkMode==="always"||yR.isOnline())&&u.canRun(),W=()=>v3(u.networkMode)&&u.canRun(),K=q=>{y||(y=!0,u.onSuccess?.(q),C?.(),A.resolve(q))},ee=q=>{y||(y=!0,u.onError?.(q),C?.(),A.reject(q))},X=()=>new Promise(q=>{C=$=>{(y||G())&&q($)},u.onPause?.()}).then(()=>{C=void 0,y||u.onContinue?.()}),re=()=>{if(y)return;let q;const $=_===0?u.initialPromise:void 0;try{q=$??u.fn()}catch(ae){q=Promise.reject(ae)}Promise.resolve(q).then(K).catch(ae=>{if(y)return;const oe=u.retry??(UR?0:3),le=u.retryDelay??x$,Se=typeof le=="function"?le(_,ae):le,be=oe===!0||typeof oe=="number"&&_<oe||typeof oe=="function"&&oe(_,ae);if(f||!be){ee(ae);return}_++,u.onFail?.(_,ae),A$(Se).then(()=>G()?void 0:X()).then(()=>{f?ee(ae):re()})})};return{promise:A,cancel:D,continue:()=>(C?.(),A),cancelRetry:L,continueRetry:V,canStart:W,start:()=>(W()?re():X().then(re),A)}}var M$=u=>setTimeout(u,0);function U$(){let u=[],f=0,_=L=>{L()},y=L=>{L()},C=M$;const A=L=>{f?u.push(L):C(()=>{_(L)})},D=()=>{const L=u;u=[],L.length&&C(()=>{y(()=>{L.forEach(V=>{_(V)})})})};return{batch:L=>{let V;f++;try{V=L()}finally{f--,f||D()}return V},batchCalls:L=>(...V)=>{A(()=>{L(...V)})},schedule:A,setNotifyFunction:L=>{_=L},setBatchNotifyFunction:L=>{y=L},setScheduler:L=>{C=L}}}var gs=U$(),T3=class{#e;destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),w$(this.gcTime)&&(this.#e=setTimeout(()=>{this.optionalRemove()},this.gcTime))}updateGcTime(u){this.gcTime=Math.max(this.gcTime||0,u??(UR?1/0:300*1e3))}clearGcTimeout(){this.#e&&(clearTimeout(this.#e),this.#e=void 0)}},V$=class extends T3{#e;#t;#n;#i;#r;#o;#a;constructor(u){super(),this.#a=!1,this.#o=u.defaultOptions,this.setOptions(u.options),this.observers=[],this.#i=u.client,this.#n=this.#i.getQueryCache(),this.queryKey=u.queryKey,this.queryHash=u.queryHash,this.#e=F$(this.options),this.state=u.state??this.#e,this.scheduleGc()}get meta(){return this.options.meta}get promise(){return this.#r?.promise}setOptions(u){this.options={...this.#o,...u},this.updateGcTime(this.options.gcTime)}optionalRemove(){!this.observers.length&&this.state.fetchStatus==="idle"&&this.#n.remove(this)}setData(u,f){const _=N$(this.state.data,u,this.options);return this.#s({data:_,type:"success",dataUpdatedAt:f?.updatedAt,manual:f?.manual}),_}setState(u,f){this.#s({type:"setState",state:u,setStateOptions:f})}cancel(u){const f=this.#r?.promise;return this.#r?.cancel(u),f?f.then(Ua).catch(Ua):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(this.#e)}isActive(){return this.observers.some(u=>I$(u.options.enabled,this)!==!1)}isDisabled(){return this.getObserversCount()>0?!this.isActive():this.options.queryFn===pN||this.state.dataUpdateCount+this.state.errorUpdateCount===0}isStatic(){return this.getObserversCount()>0?this.observers.some(u=>kA(u.options.staleTime,this)==="static"):!1}isStale(){return this.getObserversCount()>0?this.observers.some(u=>u.getCurrentResult().isStale):this.state.data===void 0||this.state.isInvalidated}isStaleByTime(u=0){return this.state.data===void 0?!0:u==="static"?!1:this.state.isInvalidated?!0:!b$(this.state.dataUpdatedAt,u)}onFocus(){this.observers.find(f=>f.shouldFetchOnWindowFocus())?.refetch({cancelRefetch:!1}),this.#r?.continue()}onOnline(){this.observers.find(f=>f.shouldFetchOnReconnect())?.refetch({cancelRefetch:!1}),this.#r?.continue()}addObserver(u){this.observers.includes(u)||(this.observers.push(u),this.clearGcTimeout(),this.#n.notify({type:"observerAdded",query:this,observer:u}))}removeObserver(u){this.observers.includes(u)&&(this.observers=this.observers.filter(f=>f!==u),this.observers.length||(this.#r&&(this.#a?this.#r.cancel({revert:!0}):this.#r.cancelRetry()),this.scheduleGc()),this.#n.notify({type:"observerRemoved",query:this,observer:u}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||this.#s({type:"invalidate"})}fetch(u,f){if(this.state.fetchStatus!=="idle"){if(this.state.data!==void 0&&f?.cancelRefetch)this.cancel({silent:!0});else if(this.#r)return this.#r.continueRetry(),this.#r.promise}if(u&&this.setOptions(u),!this.options.queryFn){const V=this.observers.find(G=>G.options.queryFn);V&&this.setOptions(V.options)}const _=new AbortController,y=V=>{Object.defineProperty(V,"signal",{enumerable:!0,get:()=>(this.#a=!0,_.signal)})},C=()=>{const V=E3(this.options,f),W=(()=>{const K={client:this.#i,queryKey:this.queryKey,meta:this.meta};return y(K),K})();return this.#a=!1,this.options.persister?this.options.persister(V,W,this):V(W)},D=(()=>{const V={fetchOptions:f,options:this.options,queryKey:this.queryKey,client:this.#i,state:this.state,fetchFn:C};return y(V),V})();this.options.behavior?.onFetch(D,this),this.#t=this.state,(this.state.fetchStatus==="idle"||this.state.fetchMeta!==D.fetchOptions?.meta)&&this.#s({type:"fetch",meta:D.fetchOptions?.meta});const L=V=>{dA(V)&&V.silent||this.#s({type:"error",error:V}),dA(V)||(this.#n.config.onError?.(V,this),this.#n.config.onSettled?.(this.state.data,V,this)),this.scheduleGc()};return this.#r=S3({initialPromise:f?.initialPromise,fn:D.fetchFn,abort:_.abort.bind(_),onSuccess:V=>{if(V===void 0){L(new Error(`${this.queryHash} data is undefined`));return}try{this.setData(V)}catch(G){L(G);return}this.#n.config.onSuccess?.(V,this),this.#n.config.onSettled?.(V,this.state.error,this),this.scheduleGc()},onError:L,onFail:(V,G)=>{this.#s({type:"failed",failureCount:V,error:G})},onPause:()=>{this.#s({type:"pause"})},onContinue:()=>{this.#s({type:"continue"})},retry:D.options.retry,retryDelay:D.options.retryDelay,networkMode:D.options.networkMode,canRun:()=>!0}),this.#r.start()}#s(u){const f=_=>{switch(u.type){case"failed":return{..._,fetchFailureCount:u.failureCount,fetchFailureReason:u.error};case"pause":return{..._,fetchStatus:"paused"};case"continue":return{..._,fetchStatus:"fetching"};case"fetch":return{..._,...j$(_.data,this.options),fetchMeta:u.meta??null};case"success":return this.#t=void 0,{..._,data:u.data,dataUpdateCount:_.dataUpdateCount+1,dataUpdatedAt:u.dataUpdatedAt??Date.now(),error:null,isInvalidated:!1,status:"success",...!u.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};case"error":const y=u.error;return dA(y)&&y.revert&&this.#t?{...this.#t,fetchStatus:"idle"}:{..._,error:y,errorUpdateCount:_.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:_.fetchFailureCount+1,fetchFailureReason:y,fetchStatus:"idle",status:"error"};case"invalidate":return{..._,isInvalidated:!0};case"setState":return{..._,...u.state}}};this.state=f(this.state),gs.batch(()=>{this.observers.forEach(_=>{_.onQueryUpdate()}),this.#n.notify({query:this,type:"updated",action:u})})}};function j$(u,f){return{fetchFailureCount:0,fetchFailureReason:null,fetchStatus:v3(f.networkMode)?"fetching":"paused",...u===void 0&&{error:null,status:"pending"}}}function F$(u){const f=typeof u.initialData=="function"?u.initialData():u.initialData,_=f!==void 0,y=_?typeof u.initialDataUpdatedAt=="function"?u.initialDataUpdatedAt():u.initialDataUpdatedAt:0;return{data:f,dataUpdateCount:0,dataUpdatedAt:_?y??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:_?"success":"pending",fetchStatus:"idle"}}var B$=class extends MR{constructor(u={}){super(),this.config=u,this.#e=new Map}#e;build(u,f,_){const y=f.queryKey,C=f.queryHash??hN(y,f);let A=this.get(C);return A||(A=new V$({client:u,queryKey:y,queryHash:C,options:u.defaultQueryOptions(f),state:_,defaultOptions:u.getQueryDefaults(y)}),this.add(A)),A}add(u){this.#e.has(u.queryHash)||(this.#e.set(u.queryHash,u),this.notify({type:"added",query:u}))}remove(u){const f=this.#e.get(u.queryHash);f&&(u.destroy(),f===u&&this.#e.delete(u.queryHash),this.notify({type:"removed",query:u}))}clear(){gs.batch(()=>{this.getAll().forEach(u=>{this.remove(u)})})}get(u){return this.#e.get(u)}getAll(){return[...this.#e.values()]}find(u){const f={exact:!0,...u};return this.getAll().find(_=>hF(f,_))}findAll(u={}){const f=this.getAll();return Object.keys(u).length>0?f.filter(_=>hF(u,_)):f}notify(u){gs.batch(()=>{this.listeners.forEach(f=>{f(u)})})}onFocus(){gs.batch(()=>{this.getAll().forEach(u=>{u.onFocus()})})}onOnline(){gs.batch(()=>{this.getAll().forEach(u=>{u.onOnline()})})}},W$=class extends T3{#e;#t;#n;constructor(u){super(),this.mutationId=u.mutationId,this.#t=u.mutationCache,this.#e=[],this.state=u.state||G$(),this.setOptions(u.options),this.scheduleGc()}setOptions(u){this.options=u,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(u){this.#e.includes(u)||(this.#e.push(u),this.clearGcTimeout(),this.#t.notify({type:"observerAdded",mutation:this,observer:u}))}removeObserver(u){this.#e=this.#e.filter(f=>f!==u),this.scheduleGc(),this.#t.notify({type:"observerRemoved",mutation:this,observer:u})}optionalRemove(){this.#e.length||(this.state.status==="pending"?this.scheduleGc():this.#t.remove(this))}continue(){return this.#n?.continue()??this.execute(this.state.variables)}async execute(u){const f=()=>{this.#i({type:"continue"})};this.#n=S3({fn:()=>this.options.mutationFn?this.options.mutationFn(u):Promise.reject(new Error("No mutationFn found")),onFail:(C,A)=>{this.#i({type:"failed",failureCount:C,error:A})},onPause:()=>{this.#i({type:"pause"})},onContinue:f,retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>this.#t.canRun(this)});const _=this.state.status==="pending",y=!this.#n.canStart();try{if(_)f();else{this.#i({type:"pending",variables:u,isPaused:y}),await this.#t.config.onMutate?.(u,this);const A=await this.options.onMutate?.(u);A!==this.state.context&&this.#i({type:"pending",context:A,variables:u,isPaused:y})}const C=await this.#n.start();return await this.#t.config.onSuccess?.(C,u,this.state.context,this),await this.options.onSuccess?.(C,u,this.state.context),await this.#t.config.onSettled?.(C,null,this.state.variables,this.state.context,this),await this.options.onSettled?.(C,null,u,this.state.context),this.#i({type:"success",data:C}),C}catch(C){try{throw await this.#t.config.onError?.(C,u,this.state.context,this),await this.options.onError?.(C,u,this.state.context),await this.#t.config.onSettled?.(void 0,C,this.state.variables,this.state.context,this),await this.options.onSettled?.(void 0,C,u,this.state.context),C}finally{this.#i({type:"error",error:C})}}finally{this.#t.runNext(this)}}#i(u){const f=_=>{switch(u.type){case"failed":return{..._,failureCount:u.failureCount,failureReason:u.error};case"pause":return{..._,isPaused:!0};case"continue":return{..._,isPaused:!1};case"pending":return{..._,context:u.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:u.isPaused,status:"pending",variables:u.variables,submittedAt:Date.now()};case"success":return{..._,data:u.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{..._,data:void 0,error:u.error,failureCount:_.failureCount+1,failureReason:u.error,isPaused:!1,status:"error"}}};this.state=f(this.state),gs.batch(()=>{this.#e.forEach(_=>{_.onMutationUpdate(u)}),this.#t.notify({mutation:this,type:"updated",action:u})})}};function G$(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0}}var H$=class extends MR{constructor(u={}){super(),this.config=u,this.#e=new Set,this.#t=new Map,this.#n=0}#e;#t;#n;build(u,f,_){const y=new W$({mutationCache:this,mutationId:++this.#n,options:u.defaultMutationOptions(f),state:_});return this.add(y),y}add(u){this.#e.add(u);const f=nR(u);if(typeof f=="string"){const _=this.#t.get(f);_?_.push(u):this.#t.set(f,[u])}this.notify({type:"added",mutation:u})}remove(u){if(this.#e.delete(u)){const f=nR(u);if(typeof f=="string"){const _=this.#t.get(f);if(_)if(_.length>1){const y=_.indexOf(u);y!==-1&&_.splice(y,1)}else _[0]===u&&this.#t.delete(f)}}this.notify({type:"removed",mutation:u})}canRun(u){const f=nR(u);if(typeof f=="string"){const y=this.#t.get(f)?.find(C=>C.state.status==="pending");return!y||y===u}else return!0}runNext(u){const f=nR(u);return typeof f=="string"?this.#t.get(f)?.find(y=>y!==u&&y.state.isPaused)?.continue()??Promise.resolve():Promise.resolve()}clear(){gs.batch(()=>{this.#e.forEach(u=>{this.notify({type:"removed",mutation:u})}),this.#e.clear(),this.#t.clear()})}getAll(){return Array.from(this.#e)}find(u){const f={exact:!0,...u};return this.getAll().find(_=>pF(f,_))}findAll(u={}){return this.getAll().filter(f=>pF(u,f))}notify(u){gs.batch(()=>{this.listeners.forEach(f=>{f(u)})})}resumePausedMutations(){const u=this.getAll().filter(f=>f.state.isPaused);return gs.batch(()=>Promise.all(u.map(f=>f.continue().catch(Ua))))}};function nR(u){return u.options.scope?.id}function _F(u){return{onFetch:(f,_)=>{const y=f.options,C=f.fetchOptions?.meta?.fetchMore?.direction,A=f.state.data?.pages||[],D=f.state.data?.pageParams||[];let L={pages:[],pageParams:[]},V=0;const G=async()=>{let W=!1;const K=re=>{Object.defineProperty(re,"signal",{enumerable:!0,get:()=>(f.signal.aborted?W=!0:f.signal.addEventListener("abort",()=>{W=!0}),f.signal)})},ee=E3(f.options,f.fetchOptions),X=async(re,q,$)=>{if(W)return Promise.reject();if(q==null&&re.pages.length)return Promise.resolve(re);const oe=(()=>{const Ue={client:f.client,queryKey:f.queryKey,pageParam:q,direction:$?"backward":"forward",meta:f.options.meta};return K(Ue),Ue})(),le=await ee(oe),{maxPages:Se}=f.options,be=$?P$:O$;return{pages:be(re.pages,le,Se),pageParams:be(re.pageParams,q,Se)}};if(C&&A.length){const re=C==="backward",q=re?K$:EF,$={pages:A,pageParams:D},ae=q(y,$);L=await X($,ae,re)}else{const re=u??A.length;do{const q=V===0?D[0]??y.initialPageParam:EF(y,L);if(V>0&&q==null)break;L=await X(L,q),V++}while(V<re)}return L};f.options.persister?f.fetchFn=()=>f.options.persister?.(G,{client:f.client,queryKey:f.queryKey,meta:f.options.meta,signal:f.signal},_):f.fetchFn=G}}}function EF(u,{pages:f,pageParams:_}){const y=f.length-1;return f.length>0?u.getNextPageParam(f[y],f,_[y],_):void 0}function K$(u,{pages:f,pageParams:_}){return f.length>0?u.getPreviousPageParam?.(f[0],f,_[0],_):void 0}var z$=class{#e;#t;#n;#i;#r;#o;#a;#s;constructor(u={}){this.#e=u.queryCache||new B$,this.#t=u.mutationCache||new H$,this.#n=u.defaultOptions||{},this.#i=new Map,this.#r=new Map,this.#o=0}mount(){this.#o++,this.#o===1&&(this.#a=g3.subscribe(async u=>{u&&(await this.resumePausedMutations(),this.#e.onFocus())}),this.#s=yR.subscribe(async u=>{u&&(await this.resumePausedMutations(),this.#e.onOnline())}))}unmount(){this.#o--,this.#o===0&&(this.#a?.(),this.#a=void 0,this.#s?.(),this.#s=void 0)}isFetching(u){return this.#e.findAll({...u,fetchStatus:"fetching"}).length}isMutating(u){return this.#t.findAll({...u,status:"pending"}).length}getQueryData(u){const f=this.defaultQueryOptions({queryKey:u});return this.#e.get(f.queryHash)?.state.data}ensureQueryData(u){const f=this.defaultQueryOptions(u),_=this.#e.build(this,f),y=_.state.data;return y===void 0?this.fetchQuery(u):(u.revalidateIfStale&&_.isStaleByTime(kA(f.staleTime,_))&&this.prefetchQuery(f),Promise.resolve(y))}getQueriesData(u){return this.#e.findAll(u).map(({queryKey:f,state:_})=>{const y=_.data;return[f,y]})}setQueryData(u,f,_){const y=this.defaultQueryOptions({queryKey:u}),A=this.#e.get(y.queryHash)?.state.data,D=C$(f,A);if(D!==void 0)return this.#e.build(this,y).setData(D,{..._,manual:!0})}setQueriesData(u,f,_){return gs.batch(()=>this.#e.findAll(u).map(({queryKey:y})=>[y,this.setQueryData(y,f,_)]))}getQueryState(u){const f=this.defaultQueryOptions({queryKey:u});return this.#e.get(f.queryHash)?.state}removeQueries(u){const f=this.#e;gs.batch(()=>{f.findAll(u).forEach(_=>{f.remove(_)})})}resetQueries(u,f){const _=this.#e;return gs.batch(()=>(_.findAll(u).forEach(y=>{y.reset()}),this.refetchQueries({type:"active",...u},f)))}cancelQueries(u,f={}){const _={revert:!0,...f},y=gs.batch(()=>this.#e.findAll(u).map(C=>C.cancel(_)));return Promise.all(y).then(Ua).catch(Ua)}invalidateQueries(u,f={}){return gs.batch(()=>(this.#e.findAll(u).forEach(_=>{_.invalidate()}),u?.refetchType==="none"?Promise.resolve():this.refetchQueries({...u,type:u?.refetchType??u?.type??"active"},f)))}refetchQueries(u,f={}){const _={...f,cancelRefetch:f.cancelRefetch??!0},y=gs.batch(()=>this.#e.findAll(u).filter(C=>!C.isDisabled()&&!C.isStatic()).map(C=>{let A=C.fetch(void 0,_);return _.throwOnError||(A=A.catch(Ua)),C.state.fetchStatus==="paused"?Promise.resolve():A}));return Promise.all(y).then(Ua)}fetchQuery(u){const f=this.defaultQueryOptions(u);f.retry===void 0&&(f.retry=!1);const _=this.#e.build(this,f);return _.isStaleByTime(kA(f.staleTime,_))?_.fetch(f):Promise.resolve(_.state.data)}prefetchQuery(u){return this.fetchQuery(u).then(Ua).catch(Ua)}fetchInfiniteQuery(u){return u.behavior=_F(u.pages),this.fetchQuery(u)}prefetchInfiniteQuery(u){return this.fetchInfiniteQuery(u).then(Ua).catch(Ua)}ensureInfiniteQueryData(u){return u.behavior=_F(u.pages),this.ensureQueryData(u)}resumePausedMutations(){return yR.isOnline()?this.#t.resumePausedMutations():Promise.resolve()}getQueryCache(){return this.#e}getMutationCache(){return this.#t}getDefaultOptions(){return this.#n}setDefaultOptions(u){this.#n=u}setQueryDefaults(u,f){this.#i.set(Ug(u),{queryKey:u,defaultOptions:f})}getQueryDefaults(u){const f=[...this.#i.values()],_={};return f.forEach(y=>{Vg(u,y.queryKey)&&Object.assign(_,y.defaultOptions)}),_}setMutationDefaults(u,f){this.#r.set(Ug(u),{mutationKey:u,defaultOptions:f})}getMutationDefaults(u){const f=[...this.#r.values()],_={};return f.forEach(y=>{Vg(u,y.mutationKey)&&Object.assign(_,y.defaultOptions)}),_}defaultQueryOptions(u){if(u._defaulted)return u;const f={...this.#n.queries,...this.getQueryDefaults(u.queryKey),...u,_defaulted:!0};return f.queryHash||(f.queryHash=hN(f.queryKey,f)),f.refetchOnReconnect===void 0&&(f.refetchOnReconnect=f.networkMode!=="always"),f.throwOnError===void 0&&(f.throwOnError=!!f.suspense),!f.networkMode&&f.persister&&(f.networkMode="offlineFirst"),f.queryFn===pN&&(f.enabled=!1),f}defaultMutationOptions(u){return u?._defaulted?u:{...this.#n.mutations,...u?.mutationKey&&this.getMutationDefaults(u.mutationKey),...u,_defaulted:!0}}clear(){this.#e.clear(),this.#t.clear()}},Y$=j.createContext(void 0),q$=({client:u,children:f})=>(j.useEffect(()=>(u.mount(),()=>{u.unmount()}),[u]),T.jsx(Y$.Provider,{value:u,children:f}));/**
 * @remix-run/router v1.23.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function jg(){return jg=Object.assign?Object.assign.bind():function(u){for(var f=1;f<arguments.length;f++){var _=arguments[f];for(var y in _)Object.prototype.hasOwnProperty.call(_,y)&&(u[y]=_[y])}return u},jg.apply(this,arguments)}var Jd;(function(u){u.Pop="POP",u.Push="PUSH",u.Replace="REPLACE"})(Jd||(Jd={}));const gF="popstate";function X$(u){u===void 0&&(u={});function f(y,C){let{pathname:A,search:D,hash:L}=y.location;return xA("",{pathname:A,search:D,hash:L},C.state&&C.state.usr||null,C.state&&C.state.key||"default")}function _(y,C){return typeof C=="string"?C:SR(C)}return Q$(f,_,null,u)}function si(u,f){if(u===!1||u===null||typeof u>"u")throw new Error(f)}function R3(u,f){if(!u){typeof console<"u"&&console.warn(f);try{throw new Error(f)}catch{}}}function J$(){return Math.random().toString(36).substr(2,8)}function vF(u,f){return{usr:u.state,key:u.key,idx:f}}function xA(u,f,_,y){return _===void 0&&(_=null),jg({pathname:typeof u=="string"?u:u.pathname,search:"",hash:""},typeof f=="string"?Tm(f):f,{state:_,key:f&&f.key||y||J$()})}function SR(u){let{pathname:f="/",search:_="",hash:y=""}=u;return _&&_!=="?"&&(f+=_.charAt(0)==="?"?_:"?"+_),y&&y!=="#"&&(f+=y.charAt(0)==="#"?y:"#"+y),f}function Tm(u){let f={};if(u){let _=u.indexOf("#");_>=0&&(f.hash=u.substr(_),u=u.substr(0,_));let y=u.indexOf("?");y>=0&&(f.search=u.substr(y),u=u.substr(0,y)),u&&(f.pathname=u)}return f}function Q$(u,f,_,y){y===void 0&&(y={});let{window:C=document.defaultView,v5Compat:A=!1}=y,D=C.history,L=Jd.Pop,V=null,G=W();G==null&&(G=0,D.replaceState(jg({},D.state,{idx:G}),""));function W(){return(D.state||{idx:null}).idx}function K(){L=Jd.Pop;let $=W(),ae=$==null?null:$-G;G=$,V&&V({action:L,location:q.location,delta:ae})}function ee($,ae){L=Jd.Push;let oe=xA(q.location,$,ae);G=W()+1;let le=vF(oe,G),Se=q.createHref(oe);try{D.pushState(le,"",Se)}catch(be){if(be instanceof DOMException&&be.name==="DataCloneError")throw be;C.location.assign(Se)}A&&V&&V({action:L,location:q.location,delta:1})}function X($,ae){L=Jd.Replace;let oe=xA(q.location,$,ae);G=W();let le=vF(oe,G),Se=q.createHref(oe);D.replaceState(le,"",Se),A&&V&&V({action:L,location:q.location,delta:0})}function re($){let ae=C.location.origin!=="null"?C.location.origin:C.location.href,oe=typeof $=="string"?$:SR($);return oe=oe.replace(/ $/,"%20"),si(ae,"No window.location.(origin|href) available to create URL for href: "+oe),new URL(oe,ae)}let q={get action(){return L},get location(){return u(C,D)},listen($){if(V)throw new Error("A history only accepts one active listener");return C.addEventListener(gF,K),V=$,()=>{C.removeEventListener(gF,K),V=null}},createHref($){return f(C,$)},createURL:re,encodeLocation($){let ae=re($);return{pathname:ae.pathname,search:ae.search,hash:ae.hash}},push:ee,replace:X,go($){return D.go($)}};return q}var yF;(function(u){u.data="data",u.deferred="deferred",u.redirect="redirect",u.error="error"})(yF||(yF={}));function Z$(u,f,_){return _===void 0&&(_="/"),$$(u,f,_)}function $$(u,f,_,y){let C=typeof f=="string"?Tm(f):f,A=fN(C.pathname||"/",_);if(A==null)return null;let D=C3(u);eee(D);let L=null;for(let V=0;L==null&&V<D.length;++V){let G=hee(A);L=lee(D[V],G)}return L}function C3(u,f,_,y){f===void 0&&(f=[]),_===void 0&&(_=[]),y===void 0&&(y="");let C=(A,D,L)=>{let V={relativePath:L===void 0?A.path||"":L,caseSensitive:A.caseSensitive===!0,childrenIndex:D,route:A};V.relativePath.startsWith("/")&&(si(V.relativePath.startsWith(y),'Absolute route path "'+V.relativePath+'" nested under path '+('"'+y+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),V.relativePath=V.relativePath.slice(y.length));let G=Qd([y,V.relativePath]),W=_.concat(V);A.children&&A.children.length>0&&(si(A.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+G+'".')),C3(A.children,f,W,G)),!(A.path==null&&!A.index)&&f.push({path:G,score:aee(G,A.index),routesMeta:W})};return u.forEach((A,D)=>{var L;if(A.path===""||!((L=A.path)!=null&&L.includes("?")))C(A,D);else for(let V of w3(A.path))C(A,D,V)}),f}function w3(u){let f=u.split("/");if(f.length===0)return[];let[_,...y]=f,C=_.endsWith("?"),A=_.replace(/\?$/,"");if(y.length===0)return C?[A,""]:[A];let D=w3(y.join("/")),L=[];return L.push(...D.map(V=>V===""?A:[A,V].join("/"))),C&&L.push(...D),L.map(V=>u.startsWith("/")&&V===""?"/":V)}function eee(u){u.sort((f,_)=>f.score!==_.score?_.score-f.score:cee(f.routesMeta.map(y=>y.childrenIndex),_.routesMeta.map(y=>y.childrenIndex)))}const tee=/^:[\w-]+$/,nee=3,ree=2,iee=1,see=10,oee=-2,SF=u=>u==="*";function aee(u,f){let _=u.split("/"),y=_.length;return _.some(SF)&&(y+=oee),f&&(y+=ree),_.filter(C=>!SF(C)).reduce((C,A)=>C+(tee.test(A)?nee:A===""?iee:see),y)}function cee(u,f){return u.length===f.length&&u.slice(0,-1).every((y,C)=>y===f[C])?u[u.length-1]-f[f.length-1]:0}function lee(u,f,_){let{routesMeta:y}=u,C={},A="/",D=[];for(let L=0;L<y.length;++L){let V=y[L],G=L===y.length-1,W=A==="/"?f:f.slice(A.length)||"/",K=dee({path:V.relativePath,caseSensitive:V.caseSensitive,end:G},W),ee=V.route;if(!K)return null;Object.assign(C,K.params),D.push({params:C,pathname:Qd([A,K.pathname]),pathnameBase:_ee(Qd([A,K.pathnameBase])),route:ee}),K.pathnameBase!=="/"&&(A=Qd([A,K.pathnameBase]))}return D}function dee(u,f){typeof u=="string"&&(u={path:u,caseSensitive:!1,end:!0});let[_,y]=uee(u.path,u.caseSensitive,u.end),C=f.match(_);if(!C)return null;let A=C[0],D=A.replace(/(.)\/+$/,"$1"),L=C.slice(1);return{params:y.reduce((G,W,K)=>{let{paramName:ee,isOptional:X}=W;if(ee==="*"){let q=L[K]||"";D=A.slice(0,A.length-q.length).replace(/(.)\/+$/,"$1")}const re=L[K];return X&&!re?G[ee]=void 0:G[ee]=(re||"").replace(/%2F/g,"/"),G},{}),pathname:A,pathnameBase:D,pattern:u}}function uee(u,f,_){f===void 0&&(f=!1),_===void 0&&(_=!0),R3(u==="*"||!u.endsWith("*")||u.endsWith("/*"),'Route path "'+u+'" will be treated as if it were '+('"'+u.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+u.replace(/\*$/,"/*")+'".'));let y=[],C="^"+u.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(D,L,V)=>(y.push({paramName:L,isOptional:V!=null}),V?"/?([^\\/]+)?":"/([^\\/]+)"));return u.endsWith("*")?(y.push({paramName:"*"}),C+=u==="*"||u==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):_?C+="\\/*$":u!==""&&u!=="/"&&(C+="(?:(?=\\/|$))"),[new RegExp(C,f?void 0:"i"),y]}function hee(u){try{return u.split("/").map(f=>decodeURIComponent(f).replace(/\//g,"%2F")).join("/")}catch(f){return R3(!1,'The URL path "'+u+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+f+").")),u}}function fN(u,f){if(f==="/")return u;if(!u.toLowerCase().startsWith(f.toLowerCase()))return null;let _=f.endsWith("/")?f.length-1:f.length,y=u.charAt(_);return y&&y!=="/"?null:u.slice(_)||"/"}function pee(u,f){f===void 0&&(f="/");let{pathname:_,search:y="",hash:C=""}=typeof u=="string"?Tm(u):u;return{pathname:_?_.startsWith("/")?_:fee(_,f):f,search:Eee(y),hash:gee(C)}}function fee(u,f){let _=f.replace(/\/+$/,"").split("/");return u.split("/").forEach(C=>{C===".."?_.length>1&&_.pop():C!=="."&&_.push(C)}),_.length>1?_.join("/"):"/"}function uA(u,f,_,y){return"Cannot include a '"+u+"' character in a manually specified "+("`to."+f+"` field ["+JSON.stringify(y)+"].  Please separate it out to the ")+("`to."+_+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function mee(u){return u.filter((f,_)=>_===0||f.route.path&&f.route.path.length>0)}function b3(u,f){let _=mee(u);return f?_.map((y,C)=>C===_.length-1?y.pathname:y.pathnameBase):_.map(y=>y.pathnameBase)}function I3(u,f,_,y){y===void 0&&(y=!1);let C;typeof u=="string"?C=Tm(u):(C=jg({},u),si(!C.pathname||!C.pathname.includes("?"),uA("?","pathname","search",C)),si(!C.pathname||!C.pathname.includes("#"),uA("#","pathname","hash",C)),si(!C.search||!C.search.includes("#"),uA("#","search","hash",C)));let A=u===""||C.pathname==="",D=A?"/":C.pathname,L;if(D==null)L=_;else{let K=f.length-1;if(!y&&D.startsWith("..")){let ee=D.split("/");for(;ee[0]==="..";)ee.shift(),K-=1;C.pathname=ee.join("/")}L=K>=0?f[K]:"/"}let V=pee(C,L),G=D&&D!=="/"&&D.endsWith("/"),W=(A||D===".")&&_.endsWith("/");return!V.pathname.endsWith("/")&&(G||W)&&(V.pathname+="/"),V}const Qd=u=>u.join("/").replace(/\/\/+/g,"/"),_ee=u=>u.replace(/\/+$/,"").replace(/^\/*/,"/"),Eee=u=>!u||u==="?"?"":u.startsWith("?")?u:"?"+u,gee=u=>!u||u==="#"?"":u.startsWith("#")?u:"#"+u;function vee(u){return u!=null&&typeof u.status=="number"&&typeof u.statusText=="string"&&typeof u.internal=="boolean"&&"data"in u}const A3=["post","put","patch","delete"];new Set(A3);const yee=["get",...A3];new Set(yee);/**
 * React Router v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Fg(){return Fg=Object.assign?Object.assign.bind():function(u){for(var f=1;f<arguments.length;f++){var _=arguments[f];for(var y in _)Object.prototype.hasOwnProperty.call(_,y)&&(u[y]=_[y])}return u},Fg.apply(this,arguments)}const mN=j.createContext(null),See=j.createContext(null),Hh=j.createContext(null),VR=j.createContext(null),Kh=j.createContext({outlet:null,matches:[],isDataRoute:!1}),N3=j.createContext(null);function Tee(u,f){let{relative:_}=f===void 0?{}:f;Kg()||si(!1);let{basename:y,navigator:C}=j.useContext(Hh),{hash:A,pathname:D,search:L}=P3(u,{relative:_}),V=D;return y!=="/"&&(V=D==="/"?y:Qd([y,D])),C.createHref({pathname:V,search:L,hash:A})}function Kg(){return j.useContext(VR)!=null}function Rm(){return Kg()||si(!1),j.useContext(VR).location}function O3(u){j.useContext(Hh).static||j.useLayoutEffect(u)}function _N(){let{isDataRoute:u}=j.useContext(Kh);return u?xee():Ree()}function Ree(){Kg()||si(!1);let u=j.useContext(mN),{basename:f,future:_,navigator:y}=j.useContext(Hh),{matches:C}=j.useContext(Kh),{pathname:A}=Rm(),D=JSON.stringify(b3(C,_.v7_relativeSplatPath)),L=j.useRef(!1);return O3(()=>{L.current=!0}),j.useCallback(function(G,W){if(W===void 0&&(W={}),!L.current)return;if(typeof G=="number"){y.go(G);return}let K=I3(G,JSON.parse(D),A,W.relative==="path");u==null&&f!=="/"&&(K.pathname=K.pathname==="/"?f:Qd([f,K.pathname])),(W.replace?y.replace:y.push)(K,W.state,W)},[f,y,D,A,u])}function P3(u,f){let{relative:_}=f===void 0?{}:f,{future:y}=j.useContext(Hh),{matches:C}=j.useContext(Kh),{pathname:A}=Rm(),D=JSON.stringify(b3(C,y.v7_relativeSplatPath));return j.useMemo(()=>I3(u,JSON.parse(D),A,_==="path"),[u,D,A,_])}function Cee(u,f){return wee(u,f)}function wee(u,f,_,y){Kg()||si(!1);let{navigator:C}=j.useContext(Hh),{matches:A}=j.useContext(Kh),D=A[A.length-1],L=D?D.params:{};D&&D.pathname;let V=D?D.pathnameBase:"/";D&&D.route;let G=Rm(),W;if(f){var K;let $=typeof f=="string"?Tm(f):f;V==="/"||(K=$.pathname)!=null&&K.startsWith(V)||si(!1),W=$}else W=G;let ee=W.pathname||"/",X=ee;if(V!=="/"){let $=V.replace(/^\//,"").split("/");X="/"+ee.replace(/^\//,"").split("/").slice($.length).join("/")}let re=Z$(u,{pathname:X}),q=Oee(re&&re.map($=>Object.assign({},$,{params:Object.assign({},L,$.params),pathname:Qd([V,C.encodeLocation?C.encodeLocation($.pathname).pathname:$.pathname]),pathnameBase:$.pathnameBase==="/"?V:Qd([V,C.encodeLocation?C.encodeLocation($.pathnameBase).pathname:$.pathnameBase])})),A,_,y);return f&&q?j.createElement(VR.Provider,{value:{location:Fg({pathname:"/",search:"",hash:"",state:null,key:"default"},W),navigationType:Jd.Pop}},q):q}function bee(){let u=Lee(),f=vee(u)?u.status+" "+u.statusText:u instanceof Error?u.message:JSON.stringify(u),_=u instanceof Error?u.stack:null,C={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return j.createElement(j.Fragment,null,j.createElement("h2",null,"Unexpected Application Error!"),j.createElement("h3",{style:{fontStyle:"italic"}},f),_?j.createElement("pre",{style:C},_):null,null)}const Iee=j.createElement(bee,null);class Aee extends j.Component{constructor(f){super(f),this.state={location:f.location,revalidation:f.revalidation,error:f.error}}static getDerivedStateFromError(f){return{error:f}}static getDerivedStateFromProps(f,_){return _.location!==f.location||_.revalidation!=="idle"&&f.revalidation==="idle"?{error:f.error,location:f.location,revalidation:f.revalidation}:{error:f.error!==void 0?f.error:_.error,location:_.location,revalidation:f.revalidation||_.revalidation}}componentDidCatch(f,_){console.error("React Router caught the following error during render",f,_)}render(){return this.state.error!==void 0?j.createElement(Kh.Provider,{value:this.props.routeContext},j.createElement(N3.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function Nee(u){let{routeContext:f,match:_,children:y}=u,C=j.useContext(mN);return C&&C.static&&C.staticContext&&(_.route.errorElement||_.route.ErrorBoundary)&&(C.staticContext._deepestRenderedBoundaryId=_.route.id),j.createElement(Kh.Provider,{value:f},y)}function Oee(u,f,_,y){var C;if(f===void 0&&(f=[]),_===void 0&&(_=null),y===void 0&&(y=null),u==null){var A;if(!_)return null;if(_.errors)u=_.matches;else if((A=y)!=null&&A.v7_partialHydration&&f.length===0&&!_.initialized&&_.matches.length>0)u=_.matches;else return null}let D=u,L=(C=_)==null?void 0:C.errors;if(L!=null){let W=D.findIndex(K=>K.route.id&&L?.[K.route.id]!==void 0);W>=0||si(!1),D=D.slice(0,Math.min(D.length,W+1))}let V=!1,G=-1;if(_&&y&&y.v7_partialHydration)for(let W=0;W<D.length;W++){let K=D[W];if((K.route.HydrateFallback||K.route.hydrateFallbackElement)&&(G=W),K.route.id){let{loaderData:ee,errors:X}=_,re=K.route.loader&&ee[K.route.id]===void 0&&(!X||X[K.route.id]===void 0);if(K.route.lazy||re){V=!0,G>=0?D=D.slice(0,G+1):D=[D[0]];break}}}return D.reduceRight((W,K,ee)=>{let X,re=!1,q=null,$=null;_&&(X=L&&K.route.id?L[K.route.id]:void 0,q=K.route.errorElement||Iee,V&&(G<0&&ee===0?(Mee("route-fallback"),re=!0,$=null):G===ee&&(re=!0,$=K.route.hydrateFallbackElement||null)));let ae=f.concat(D.slice(0,ee+1)),oe=()=>{let le;return X?le=q:re?le=$:K.route.Component?le=j.createElement(K.route.Component,null):K.route.element?le=K.route.element:le=W,j.createElement(Nee,{match:K,routeContext:{outlet:W,matches:ae,isDataRoute:_!=null},children:le})};return _&&(K.route.ErrorBoundary||K.route.errorElement||ee===0)?j.createElement(Aee,{location:_.location,revalidation:_.revalidation,component:q,error:X,children:oe(),routeContext:{outlet:null,matches:ae,isDataRoute:!0}}):oe()},null)}var D3=(function(u){return u.UseBlocker="useBlocker",u.UseRevalidator="useRevalidator",u.UseNavigateStable="useNavigate",u})(D3||{}),k3=(function(u){return u.UseBlocker="useBlocker",u.UseLoaderData="useLoaderData",u.UseActionData="useActionData",u.UseRouteError="useRouteError",u.UseNavigation="useNavigation",u.UseRouteLoaderData="useRouteLoaderData",u.UseMatches="useMatches",u.UseRevalidator="useRevalidator",u.UseNavigateStable="useNavigate",u.UseRouteId="useRouteId",u})(k3||{});function Pee(u){let f=j.useContext(mN);return f||si(!1),f}function Dee(u){let f=j.useContext(See);return f||si(!1),f}function kee(u){let f=j.useContext(Kh);return f||si(!1),f}function L3(u){let f=kee(),_=f.matches[f.matches.length-1];return _.route.id||si(!1),_.route.id}function Lee(){var u;let f=j.useContext(N3),_=Dee(),y=L3();return f!==void 0?f:(u=_.errors)==null?void 0:u[y]}function xee(){let{router:u}=Pee(D3.UseNavigateStable),f=L3(k3.UseNavigateStable),_=j.useRef(!1);return O3(()=>{_.current=!0}),j.useCallback(function(C,A){A===void 0&&(A={}),_.current&&(typeof C=="number"?u.navigate(C):u.navigate(C,Fg({fromRouteId:f},A)))},[u,f])}const TF={};function Mee(u,f,_){TF[u]||(TF[u]=!0)}function Uee(u,f){u?.v7_startTransition,u?.v7_relativeSplatPath}function xa(u){si(!1)}function Vee(u){let{basename:f="/",children:_=null,location:y,navigationType:C=Jd.Pop,navigator:A,static:D=!1,future:L}=u;Kg()&&si(!1);let V=f.replace(/^\/*/,"/"),G=j.useMemo(()=>({basename:V,navigator:A,static:D,future:Fg({v7_relativeSplatPath:!1},L)}),[V,L,A,D]);typeof y=="string"&&(y=Tm(y));let{pathname:W="/",search:K="",hash:ee="",state:X=null,key:re="default"}=y,q=j.useMemo(()=>{let $=fN(W,V);return $==null?null:{location:{pathname:$,search:K,hash:ee,state:X,key:re},navigationType:C}},[V,W,K,ee,X,re,C]);return q==null?null:j.createElement(Hh.Provider,{value:G},j.createElement(VR.Provider,{children:_,value:q}))}function jee(u){let{children:f,location:_}=u;return Cee(MA(f),_)}new Promise(()=>{});function MA(u,f){f===void 0&&(f=[]);let _=[];return j.Children.forEach(u,(y,C)=>{if(!j.isValidElement(y))return;let A=[...f,C];if(y.type===j.Fragment){_.push.apply(_,MA(y.props.children,A));return}y.type!==xa&&si(!1),!y.props.index||!y.props.children||si(!1);let D={id:y.props.id||A.join("-"),caseSensitive:y.props.caseSensitive,element:y.props.element,Component:y.props.Component,index:y.props.index,path:y.props.path,loader:y.props.loader,action:y.props.action,errorElement:y.props.errorElement,ErrorBoundary:y.props.ErrorBoundary,hasErrorBoundary:y.props.ErrorBoundary!=null||y.props.errorElement!=null,shouldRevalidate:y.props.shouldRevalidate,handle:y.props.handle,lazy:y.props.lazy};y.props.children&&(D.children=MA(y.props.children,A)),_.push(D)}),_}/**
 * React Router DOM v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function UA(){return UA=Object.assign?Object.assign.bind():function(u){for(var f=1;f<arguments.length;f++){var _=arguments[f];for(var y in _)Object.prototype.hasOwnProperty.call(_,y)&&(u[y]=_[y])}return u},UA.apply(this,arguments)}function Fee(u,f){if(u==null)return{};var _={},y=Object.keys(u),C,A;for(A=0;A<y.length;A++)C=y[A],!(f.indexOf(C)>=0)&&(_[C]=u[C]);return _}function Bee(u){return!!(u.metaKey||u.altKey||u.ctrlKey||u.shiftKey)}function Wee(u,f){return u.button===0&&(!f||f==="_self")&&!Bee(u)}const Gee=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"],Hee="6";try{window.__reactRouterVersion=Hee}catch{}const Kee="startTransition",RF=zA[Kee];function zee(u){let{basename:f,children:_,future:y,window:C}=u,A=j.useRef();A.current==null&&(A.current=X$({window:C,v5Compat:!0}));let D=A.current,[L,V]=j.useState({action:D.action,location:D.location}),{v7_startTransition:G}=y||{},W=j.useCallback(K=>{G&&RF?RF(()=>V(K)):V(K)},[V,G]);return j.useLayoutEffect(()=>D.listen(W),[D,W]),j.useEffect(()=>Uee(y),[y]),j.createElement(Vee,{basename:f,children:_,location:L.location,navigationType:L.action,navigator:D,future:y})}const Yee=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",qee=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,ii=j.forwardRef(function(f,_){let{onClick:y,relative:C,reloadDocument:A,replace:D,state:L,target:V,to:G,preventScrollReset:W,viewTransition:K}=f,ee=Fee(f,Gee),{basename:X}=j.useContext(Hh),re,q=!1;if(typeof G=="string"&&qee.test(G)&&(re=G,Yee))try{let le=new URL(window.location.href),Se=G.startsWith("//")?new URL(le.protocol+G):new URL(G),be=fN(Se.pathname,X);Se.origin===le.origin&&be!=null?G=be+Se.search+Se.hash:q=!0}catch{}let $=Tee(G,{relative:C}),ae=Xee(G,{replace:D,state:L,target:V,preventScrollReset:W,relative:C,viewTransition:K});function oe(le){y&&y(le),le.defaultPrevented||ae(le)}return j.createElement("a",UA({},ee,{href:re||$,onClick:q||A?y:oe,ref:_,target:V}))});var CF;(function(u){u.UseScrollRestoration="useScrollRestoration",u.UseSubmit="useSubmit",u.UseSubmitFetcher="useSubmitFetcher",u.UseFetcher="useFetcher",u.useViewTransitionState="useViewTransitionState"})(CF||(CF={}));var wF;(function(u){u.UseFetcher="useFetcher",u.UseFetchers="useFetchers",u.UseScrollRestoration="useScrollRestoration"})(wF||(wF={}));function Xee(u,f){let{target:_,replace:y,state:C,preventScrollReset:A,relative:D,viewTransition:L}=f===void 0?{}:f,V=_N(),G=Rm(),W=P3(u,{relative:D});return j.useCallback(K=>{if(Wee(K,_)){K.preventDefault();let ee=y!==void 0?y:SR(G)===SR(W);V(u,{replace:ee,state:C,preventScrollReset:A,relative:D,viewTransition:L})}},[G,V,W,y,C,_,u,A,D,L])}function Jee({children:u,attribute:f="class",defaultTheme:_="dark",enableSystem:y=!0,disableTransitionOnChange:C=!1,...A}){return T.jsx(iQ,{attribute:f,defaultTheme:_,enableSystem:y,disableTransitionOnChange:C,...A,children:u})}const Qee=ZA("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),Cn=j.forwardRef(({className:u,variant:f,size:_,asChild:y=!1,...C},A)=>{const D=y?cX:"button";return T.jsx(D,{className:Vn(Qee({variant:f,size:_,className:u})),ref:A,...C})});Cn.displayName="Button";function EN(){const{theme:u,setTheme:f}=MB();return T.jsxs(Cn,{variant:"ghost",size:"icon",onClick:()=>f(u==="light"?"dark":"light"),className:"hover-scale transition-smooth",children:[T.jsx(TB,{className:"h-[1.2rem] w-[1.2rem] rotate-0 scale-100 transition-all dark:-rotate-90 dark:scale-0"}),T.jsx(dJ,{className:"absolute h-[1.2rem] w-[1.2rem] rotate-90 scale-0 transition-all dark:rotate-0 dark:scale-100"}),T.jsx("span",{className:"sr-only",children:"Toggle theme"})]})}function Zee(){return T.jsxs("div",{className:"min-h-screen bg-background",children:[T.jsxs("header",{className:"container mx-auto px-4 py-6 flex justify-between items-center",children:[T.jsxs("div",{className:"flex items-center space-x-3",children:[T.jsx("img",{src:"/logo.png",alt:"TeaTok Logo",className:"hidden dark:block h-12 w-12 md:h-14 md:w-14 animate-float rounded object-contain"}),T.jsx("img",{src:"/logo-light.png",alt:"TeaTok Logo",className:"block dark:hidden h-12 w-12 md:h-14 md:w-14 animate-float rounded object-contain"}),T.jsx("img",{src:"/teatok.png",alt:"TeaTok",className:"hidden dark:block h-8 md:h-9 w-auto object-contain"}),T.jsx("img",{src:"/teatok-light.png",alt:"TeaTok",className:"block dark:hidden h-8 md:h-9 w-auto object-contain"})]}),T.jsxs("div",{className:"flex items-center space-x-4",children:[T.jsx(EN,{}),T.jsx(Cn,{variant:"ghost",asChild:!0,children:T.jsx(ii,{to:"/auth",children:"Sign In"})})]})]}),T.jsx("section",{className:"container mx-auto px-4 py-20 text-center animate-fade-in",children:T.jsxs("div",{className:"max-w-4xl mx-auto space-y-8",children:[T.jsxs("div",{className:"flex justify-center mb-8",children:[T.jsx("img",{src:"/teatok.png",alt:"TeaTok",className:"hidden dark:block h-32 md:h-40 animate-float object-contain"}),T.jsx("img",{src:"/teatok-light.png",alt:"TeaTok",className:"block dark:hidden h-32 md:h-40 animate-float object-contain"})]}),T.jsx("h1",{className:"text-4xl md:text-6xl font-bold mb-6",children:T.jsx("span",{className:"gradient-hero bg-clip-text text-transparent",children:"Spill it. Sip it. TeaTok it."})}),T.jsx("p",{className:"text-xl md:text-2xl text-muted-foreground mb-12 max-w-2xl mx-auto",children:"The anonymous social playground where you spill gossip, drop reviews, and connect through tea, threads, and hot takes."}),T.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-center mb-16",children:[T.jsx(Cn,{asChild:!0,size:"lg",className:"spill-button text-lg px-8 py-4 animate-bounce-subtle",children:T.jsxs(ii,{to:"/auth",children:["Join Now",T.jsx(bA,{className:"ml-2 h-5 w-5"})]})}),T.jsx(Cn,{asChild:!0,variant:"outline",size:"lg",className:"text-lg px-8 py-4 neon-border hover-glow",children:T.jsx(ii,{to:"/feed",children:"Explore Tea"})})]}),T.jsxs("div",{className:"grid md:grid-cols-3 gap-8 mt-20",children:[T.jsxs("div",{className:"tea-card animate-slide-in-right text-center",children:[T.jsx("div",{className:"gradient-primary w-12 h-12 rounded-full flex items-center justify-center mx-auto mb-4",children:T.jsx(AR,{className:"h-6 w-6 text-primary-foreground"})}),T.jsx("h3",{className:"font-semibold text-lg mb-2",children:"Anonymous Vibes"}),T.jsx("p",{className:"text-muted-foreground",children:"Share your hottest takes without revealing your identity. Create personas and keep it mysterious."})]}),T.jsxs("div",{className:"tea-card animate-slide-in-right text-center",style:{animationDelay:"0.2s"},children:[T.jsx("div",{className:"gradient-accent w-12 h-12 rounded-full flex items-center justify-center mx-auto mb-4",children:T.jsx(CB,{className:"h-6 w-6 text-accent-foreground"})}),T.jsx("h3",{className:"font-semibold text-lg mb-2",children:"Instant Reactions"}),T.jsx("p",{className:"text-muted-foreground",children:"React with Tea , Spicy , or Cap . Express yourself beyond basic likes and hearts."})]}),T.jsxs("div",{className:"tea-card animate-slide-in-right text-center",style:{animationDelay:"0.4s"},children:[T.jsx("div",{className:"gradient-warm w-12 h-12 rounded-full flex items-center justify-center mx-auto mb-4",children:T.jsx(NR,{className:"h-6 w-6 text-white"})}),T.jsx("h3",{className:"font-semibold text-lg mb-2",children:"Safe & Playful"}),T.jsx("p",{className:"text-muted-foreground",children:"Built for fun, not drama. Smart moderation keeps the tea hot but the vibes positive."})]})]})]})}),T.jsx("section",{className:"gradient-hero py-20 mt-20",children:T.jsxs("div",{className:"container mx-auto px-4 text-center",children:[T.jsx("h2",{className:"text-3xl md:text-4xl font-bold text-white mb-6",children:"Ready to spill some tea?"}),T.jsx("p",{className:"text-xl text-white/90 mb-8 max-w-2xl mx-auto",children:"Join thousands already sharing gossip, reviews, and anonymous connections."}),T.jsx(Cn,{asChild:!0,size:"lg",variant:"secondary",className:"text-lg px-8 py-4 hover-scale shadow-soft",children:T.jsxs(ii,{to:"/auth",children:["Get Started Now",T.jsx(bA,{className:"ml-2 h-5 w-5"})]})})]})}),T.jsxs("footer",{className:"container mx-auto px-4 py-12 text-center text-muted-foreground",children:[T.jsxs("div",{className:"flex justify-center items-center space-x-4 mb-4",children:[T.jsx("img",{src:"/logo.png",alt:"TeaTok Logo",className:"hidden dark:inline-block h-8 w-8 rounded object-contain"}),T.jsx("img",{src:"/logo-light.png",alt:"TeaTok Logo",className:"inline-block dark:hidden h-8 w-8 rounded object-contain"}),T.jsx("span",{className:"font-semibold",children:"TeaTok"})]}),T.jsxs("div",{className:"flex justify-center space-x-6 text-sm",children:[T.jsx(ii,{to:"/about",className:"hover:text-foreground transition-colors",children:"About"}),T.jsx(ii,{to:"/settings",className:"hover:text-foreground transition-colors",children:"Privacy"}),T.jsx(ii,{to:"/settings",className:"hover:text-foreground transition-colors",children:"Terms"})]})]})]})}const Vc=j.forwardRef(({className:u,type:f,..._},y)=>T.jsx("input",{type:f,className:Vn("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",u),ref:y,..._}));Vc.displayName="Input";const Gn=j.forwardRef(({className:u,...f},_)=>T.jsx("div",{ref:_,className:Vn("rounded-lg border bg-card text-card-foreground shadow-sm",u),...f}));Gn.displayName="Card";const $r=j.forwardRef(({className:u,...f},_)=>T.jsx("div",{ref:_,className:Vn("flex flex-col space-y-1.5 p-6",u),...f}));$r.displayName="CardHeader";const Bi=j.forwardRef(({className:u,...f},_)=>T.jsx("h3",{ref:_,className:Vn("text-2xl font-semibold leading-none tracking-tight",u),...f}));Bi.displayName="CardTitle";const fo=j.forwardRef(({className:u,...f},_)=>T.jsx("p",{ref:_,className:Vn("text-sm text-muted-foreground",u),...f}));fo.displayName="CardDescription";const zn=j.forwardRef(({className:u,...f},_)=>T.jsx("div",{ref:_,className:Vn("p-6 pt-0",u),...f}));zn.displayName="CardContent";const kg=j.forwardRef(({className:u,...f},_)=>T.jsx("div",{ref:_,className:Vn("flex items-center p-6 pt-0",u),...f}));kg.displayName="CardFooter";var $ee=j.createContext(void 0);function gN(u){const f=j.useContext($ee);return u||f||"ltr"}var hA="rovingFocusGroup.onEntryFocus",ete={bubbles:!1,cancelable:!0},zg="RovingFocusGroup",[VA,x3,tte]=YA(zg),[nte,M3]=Ol(zg,[tte]),[rte,ite]=nte(zg),U3=j.forwardRef((u,f)=>T.jsx(VA.Provider,{scope:u.__scopeRovingFocusGroup,children:T.jsx(VA.Slot,{scope:u.__scopeRovingFocusGroup,children:T.jsx(ste,{...u,ref:f})})}));U3.displayName=zg;var ste=j.forwardRef((u,f)=>{const{__scopeRovingFocusGroup:_,orientation:y,loop:C=!1,dir:A,currentTabStopId:D,defaultCurrentTabStopId:L,onCurrentTabStopIdChange:V,onEntryFocus:G,preventScrollOnEntryFocus:W=!1,...K}=u,ee=j.useRef(null),X=yr(f,ee),re=gN(A),[q,$]=fm({prop:D,defaultProp:L??null,onChange:V,caller:zg}),[ae,oe]=j.useState(!1),le=_o(G),Se=x3(_),be=j.useRef(!1),[Ue,xe]=j.useState(0);return j.useEffect(()=>{const je=ee.current;if(je)return je.addEventListener(hA,le),()=>je.removeEventListener(hA,le)},[le]),T.jsx(rte,{scope:_,orientation:y,dir:re,loop:C,currentTabStopId:q,onItemFocus:j.useCallback(je=>$(je),[$]),onItemShiftTab:j.useCallback(()=>oe(!0),[]),onFocusableItemAdd:j.useCallback(()=>xe(je=>je+1),[]),onFocusableItemRemove:j.useCallback(()=>xe(je=>je-1),[]),children:T.jsx(En.div,{tabIndex:ae||Ue===0?-1:0,"data-orientation":y,...K,ref:X,style:{outline:"none",...u.style},onMouseDown:$t(u.onMouseDown,()=>{be.current=!0}),onFocus:$t(u.onFocus,je=>{const lt=!be.current;if(je.target===je.currentTarget&&lt&&!ae){const Et=new CustomEvent(hA,ete);if(je.currentTarget.dispatchEvent(Et),!Et.defaultPrevented){const ht=Se().filter(nt=>nt.focusable),Ge=ht.find(nt=>nt.active),pt=ht.find(nt=>nt.id===q),Ct=[Ge,pt,...ht].filter(Boolean).map(nt=>nt.ref.current);F3(Ct,W)}}be.current=!1}),onBlur:$t(u.onBlur,()=>oe(!1))})})}),V3="RovingFocusGroupItem",j3=j.forwardRef((u,f)=>{const{__scopeRovingFocusGroup:_,focusable:y=!0,active:C=!1,tabStopId:A,children:D,...L}=u,V=Gg(),G=A||V,W=ite(V3,_),K=W.currentTabStopId===G,ee=x3(_),{onFocusableItemAdd:X,onFocusableItemRemove:re,currentTabStopId:q}=W;return j.useEffect(()=>{if(y)return X(),()=>re()},[y,X,re]),T.jsx(VA.ItemSlot,{scope:_,id:G,focusable:y,active:C,children:T.jsx(En.span,{tabIndex:K?0:-1,"data-orientation":W.orientation,...L,ref:f,onMouseDown:$t(u.onMouseDown,$=>{y?W.onItemFocus(G):$.preventDefault()}),onFocus:$t(u.onFocus,()=>W.onItemFocus(G)),onKeyDown:$t(u.onKeyDown,$=>{if($.key==="Tab"&&$.shiftKey){W.onItemShiftTab();return}if($.target!==$.currentTarget)return;const ae=cte($,W.orientation,W.dir);if(ae!==void 0){if($.metaKey||$.ctrlKey||$.altKey||$.shiftKey)return;$.preventDefault();let le=ee().filter(Se=>Se.focusable).map(Se=>Se.ref.current);if(ae==="last")le.reverse();else if(ae==="prev"||ae==="next"){ae==="prev"&&le.reverse();const Se=le.indexOf($.currentTarget);le=W.loop?lte(le,Se+1):le.slice(Se+1)}setTimeout(()=>F3(le))}}),children:typeof D=="function"?D({isCurrentTabStop:K,hasTabStop:q!=null}):D})})});j3.displayName=V3;var ote={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function ate(u,f){return f!=="rtl"?u:u==="ArrowLeft"?"ArrowRight":u==="ArrowRight"?"ArrowLeft":u}function cte(u,f,_){const y=ate(u.key,_);if(!(f==="vertical"&&["ArrowLeft","ArrowRight"].includes(y))&&!(f==="horizontal"&&["ArrowUp","ArrowDown"].includes(y)))return ote[y]}function F3(u,f=!1){const _=document.activeElement;for(const y of u)if(y===_||(y.focus({preventScroll:f}),document.activeElement!==_))return}function lte(u,f){return u.map((_,y)=>u[(f+y)%u.length])}var dte=U3,ute=j3,jR="Tabs",[hte]=Ol(jR,[M3]),B3=M3(),[pte,vN]=hte(jR),W3=j.forwardRef((u,f)=>{const{__scopeTabs:_,value:y,onValueChange:C,defaultValue:A,orientation:D="horizontal",dir:L,activationMode:V="automatic",...G}=u,W=gN(L),[K,ee]=fm({prop:y,onChange:C,defaultProp:A??"",caller:jR});return T.jsx(pte,{scope:_,baseId:Gg(),value:K,onValueChange:ee,orientation:D,dir:W,activationMode:V,children:T.jsx(En.div,{dir:W,"data-orientation":D,...G,ref:f})})});W3.displayName=jR;var G3="TabsList",H3=j.forwardRef((u,f)=>{const{__scopeTabs:_,loop:y=!0,...C}=u,A=vN(G3,_),D=B3(_);return T.jsx(dte,{asChild:!0,...D,orientation:A.orientation,dir:A.dir,loop:y,children:T.jsx(En.div,{role:"tablist","aria-orientation":A.orientation,...C,ref:f})})});H3.displayName=G3;var K3="TabsTrigger",z3=j.forwardRef((u,f)=>{const{__scopeTabs:_,value:y,disabled:C=!1,...A}=u,D=vN(K3,_),L=B3(_),V=X3(D.baseId,y),G=J3(D.baseId,y),W=y===D.value;return T.jsx(ute,{asChild:!0,...L,focusable:!C,active:W,children:T.jsx(En.button,{type:"button",role:"tab","aria-selected":W,"aria-controls":G,"data-state":W?"active":"inactive","data-disabled":C?"":void 0,disabled:C,id:V,...A,ref:f,onMouseDown:$t(u.onMouseDown,K=>{!C&&K.button===0&&K.ctrlKey===!1?D.onValueChange(y):K.preventDefault()}),onKeyDown:$t(u.onKeyDown,K=>{[" ","Enter"].includes(K.key)&&D.onValueChange(y)}),onFocus:$t(u.onFocus,()=>{const K=D.activationMode!=="manual";!W&&!C&&K&&D.onValueChange(y)})})})});z3.displayName=K3;var Y3="TabsContent",q3=j.forwardRef((u,f)=>{const{__scopeTabs:_,value:y,forceMount:C,children:A,...D}=u,L=vN(Y3,_),V=X3(L.baseId,y),G=J3(L.baseId,y),W=y===L.value,K=j.useRef(W);return j.useEffect(()=>{const ee=requestAnimationFrame(()=>K.current=!1);return()=>cancelAnimationFrame(ee)},[]),T.jsx(wR,{present:C||W,children:({present:ee})=>T.jsx(En.div,{"data-state":W?"active":"inactive","data-orientation":L.orientation,role:"tabpanel","aria-labelledby":V,hidden:!ee,id:G,tabIndex:0,...D,ref:f,style:{...u.style,animationDuration:K.current?"0s":void 0},children:ee&&A})})});q3.displayName=Y3;function X3(u,f){return`${u}-trigger-${f}`}function J3(u,f){return`${u}-content-${f}`}var fte=W3,Q3=H3,Z3=z3,$3=q3;const yN=fte,FR=j.forwardRef(({className:u,...f},_)=>T.jsx(Q3,{ref:_,className:Vn("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",u),...f}));FR.displayName=Q3.displayName;const Zd=j.forwardRef(({className:u,...f},_)=>T.jsx(Z3,{ref:_,className:Vn("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",u),...f}));Zd.displayName=Z3.displayName;const $d=j.forwardRef(({className:u,...f},_)=>T.jsx($3,{ref:_,className:Vn("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",u),...f}));$d.displayName=$3.displayName;function mte(){const[u,f]=j.useState(!1),[_,y]=j.useState(!1),C=_N(),{toast:A}=Bg(),D=async(L,V)=>{L.preventDefault(),y(!0),setTimeout(()=>{y(!1),A({title:V==="anonymous"?"Welcome, Anonymous!":"Welcome to TeaTok!",description:V==="anonymous"?"You're now browsing anonymously. Start spilling some tea!":"Ready to spill some tea?"}),C("/feed")},1500)};return T.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center p-4",children:T.jsxs("div",{className:"w-full max-w-md space-y-6 animate-fade-in",children:[T.jsxs("div",{className:"text-center space-y-4",children:[T.jsxs(ii,{to:"/",className:"inline-flex items-center text-muted-foreground hover:text-foreground transition-colors mb-4",children:[T.jsx($A,{className:"h-4 w-4 mr-2"}),"Back to Home"]}),T.jsx("div",{className:"flex justify-center",children:T.jsxs("div",{className:"relative",children:[T.jsx("img",{src:"/logo.png",alt:"TeaTok Logo",className:"hidden dark:block h-20 w-20 md:h-24 md:w-24 animate-pulse-glow rounded object-contain"}),T.jsx("img",{src:"/logo-light.png",alt:"TeaTok Logo",className:"block dark:hidden h-20 w-20 md:h-24 md:w-24 animate-pulse-glow rounded object-contain"})]})}),T.jsxs("div",{children:[T.jsx("h1",{className:"text-2xl font-bold gradient-primary bg-clip-text text-transparent",children:"Welcome to TeaTok"}),T.jsx("p",{className:"text-muted-foreground",children:"Spill anonymously, connect authentically"})]})]}),T.jsx(Gn,{className:"tea-card",children:T.jsxs(yN,{defaultValue:"signin",children:[T.jsx($r,{className:"space-y-1 pb-4",children:T.jsxs(FR,{className:"grid w-full grid-cols-2",children:[T.jsx(Zd,{value:"signin",children:"Sign In"}),T.jsx(Zd,{value:"signup",children:"Sign Up"})]})}),T.jsx($d,{value:"signin",children:T.jsxs("form",{onSubmit:L=>D(L,"signin"),children:[T.jsxs(zn,{className:"space-y-4",children:[T.jsxs("div",{className:"space-y-2",children:[T.jsx("label",{className:"text-sm font-medium",children:"Email"}),T.jsxs("div",{className:"relative",children:[T.jsx(Vc,{type:"email",placeholder:"spill@teatime.com",className:"pl-10",required:!0}),T.jsx(Yj,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"})]})]}),T.jsxs("div",{className:"space-y-2",children:[T.jsx("label",{className:"text-sm font-medium",children:"Password"}),T.jsxs("div",{className:"relative",children:[T.jsx(Vc,{type:u?"text":"password",placeholder:"Your secret brew...",className:"pl-10 pr-10",required:!0}),T.jsx(zj,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),T.jsx(Cn,{type:"button",variant:"ghost",size:"icon",className:"absolute right-1 top-1 h-8 w-8",onClick:()=>f(!u),children:u?T.jsx(Wj,{className:"h-4 w-4"}):T.jsx(Gj,{className:"h-4 w-4"})})]})]})]}),T.jsx(kg,{className:"flex flex-col space-y-3",children:T.jsx(Cn,{type:"submit",className:"w-full spill-button",disabled:_,children:_?"Brewing...":"Sign In"})})]})}),T.jsx($d,{value:"signup",children:T.jsxs("form",{onSubmit:L=>D(L,"signup"),children:[T.jsxs(zn,{className:"space-y-4",children:[T.jsxs("div",{className:"space-y-2",children:[T.jsx("label",{className:"text-sm font-medium",children:"Email"}),T.jsxs("div",{className:"relative",children:[T.jsx(Vc,{type:"email",placeholder:"newbie@teatime.com",className:"pl-10",required:!0}),T.jsx(Yj,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"})]})]}),T.jsxs("div",{className:"space-y-2",children:[T.jsx("label",{className:"text-sm font-medium",children:"Password"}),T.jsxs("div",{className:"relative",children:[T.jsx(Vc,{type:u?"text":"password",placeholder:"Create your secret...",className:"pl-10 pr-10",required:!0}),T.jsx(zj,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),T.jsx(Cn,{type:"button",variant:"ghost",size:"icon",className:"absolute right-1 top-1 h-8 w-8",onClick:()=>f(!u),children:u?T.jsx(Wj,{className:"h-4 w-4"}):T.jsx(Gj,{className:"h-4 w-4"})})]})]})]}),T.jsx(kg,{className:"flex flex-col space-y-3",children:T.jsx(Cn,{type:"submit",className:"w-full spill-button",disabled:_,children:_?"Brewing...":"Join TeaTok"})})]})})]})}),T.jsxs(Gn,{className:"tea-card",children:[T.jsxs($r,{className:"text-center pb-4",children:[T.jsxs(Bi,{className:"flex items-center justify-center space-x-2 text-lg",children:[T.jsx(Hj,{className:"h-5 w-5 text-accent"}),T.jsx("span",{children:"Go Anonymous"})]}),T.jsx(fo,{children:"Explore TeaTok without creating an account"})]}),T.jsx(kg,{children:T.jsxs(Cn,{onClick:L=>D(L,"anonymous"),variant:"outline",className:"w-full neon-border hover-glow",disabled:_,children:[T.jsx(Hj,{className:"h-4 w-4 mr-2"}),_?"Materializing...":"Browse Anonymously"]})})]}),T.jsxs("p",{className:"text-center text-sm text-muted-foreground",children:["By continuing, you agree to TeaTok's"," ",T.jsx(ii,{to:"/about",className:"underline hover:text-foreground",children:"Terms of Service"})," ","and"," ",T.jsx(ii,{to:"/about",className:"underline hover:text-foreground",children:"Privacy Policy"})]})]})})}var pA={exports:{}},fA={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var bF;function _te(){if(bF)return fA;bF=1;var u=RR();function f(K,ee){return K===ee&&(K!==0||1/K===1/ee)||K!==K&&ee!==ee}var _=typeof Object.is=="function"?Object.is:f,y=u.useState,C=u.useEffect,A=u.useLayoutEffect,D=u.useDebugValue;function L(K,ee){var X=ee(),re=y({inst:{value:X,getSnapshot:ee}}),q=re[0].inst,$=re[1];return A(function(){q.value=X,q.getSnapshot=ee,V(q)&&$({inst:q})},[K,X,ee]),C(function(){return V(q)&&$({inst:q}),K(function(){V(q)&&$({inst:q})})},[K]),D(X),X}function V(K){var ee=K.getSnapshot;K=K.value;try{var X=ee();return!_(K,X)}catch{return!0}}function G(K,ee){return ee()}var W=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?G:L;return fA.useSyncExternalStore=u.useSyncExternalStore!==void 0?u.useSyncExternalStore:W,fA}var IF;function Ete(){return IF||(IF=1,pA.exports=_te()),pA.exports}var gte=Ete();function vte(){return gte.useSyncExternalStore(yte,()=>!0,()=>!1)}function yte(){return()=>{}}var SN="Avatar",[Ste]=Ol(SN),[Tte,e4]=Ste(SN),t4=j.forwardRef((u,f)=>{const{__scopeAvatar:_,...y}=u,[C,A]=j.useState("idle");return T.jsx(Tte,{scope:_,imageLoadingStatus:C,onImageLoadingStatusChange:A,children:T.jsx(En.span,{...y,ref:f})})});t4.displayName=SN;var n4="AvatarImage",r4=j.forwardRef((u,f)=>{const{__scopeAvatar:_,src:y,onLoadingStatusChange:C=()=>{},...A}=u,D=e4(n4,_),L=Rte(y,A),V=_o(G=>{C(G),D.onImageLoadingStatusChange(G)});return oi(()=>{L!=="idle"&&V(L)},[L,V]),L==="loaded"?T.jsx(En.img,{...A,ref:f,src:y}):null});r4.displayName=n4;var i4="AvatarFallback",s4=j.forwardRef((u,f)=>{const{__scopeAvatar:_,delayMs:y,...C}=u,A=e4(i4,_),[D,L]=j.useState(y===void 0);return j.useEffect(()=>{if(y!==void 0){const V=window.setTimeout(()=>L(!0),y);return()=>window.clearTimeout(V)}},[y]),D&&A.imageLoadingStatus!=="loaded"?T.jsx(En.span,{...C,ref:f}):null});s4.displayName=i4;function AF(u,f){return u?f?(u.src!==f&&(u.src=f),u.complete&&u.naturalWidth>0?"loaded":"loading"):"error":"idle"}function Rte(u,{referrerPolicy:f,crossOrigin:_}){const y=vte(),C=j.useRef(null),A=y?(C.current||(C.current=new window.Image),C.current):null,[D,L]=j.useState(()=>AF(A,u));return oi(()=>{L(AF(A,u))},[A,u]),oi(()=>{const V=K=>()=>{L(K)};if(!A)return;const G=V("loaded"),W=V("error");return A.addEventListener("load",G),A.addEventListener("error",W),f&&(A.referrerPolicy=f),typeof _=="string"&&(A.crossOrigin=_),()=>{A.removeEventListener("load",G),A.removeEventListener("error",W)}},[A,_,f]),D}var o4=t4,a4=r4,c4=s4;const TN=j.forwardRef(({className:u,...f},_)=>T.jsx(o4,{ref:_,className:Vn("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",u),...f}));TN.displayName=o4.displayName;const Cte=j.forwardRef(({className:u,...f},_)=>T.jsx(a4,{ref:_,className:Vn("aspect-square h-full w-full",u),...f}));Cte.displayName=a4.displayName;const RN=j.forwardRef(({className:u,...f},_)=>T.jsx(c4,{ref:_,className:Vn("flex h-full w-full items-center justify-center rounded-full bg-muted",u),...f}));RN.displayName=c4.displayName;const wte=ZA("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function hm({className:u,variant:f,..._}){return T.jsx("div",{className:Vn(wte({variant:f}),u),..._})}function BR(){const u=Rm(),f=[{name:"Feed",href:"/feed",icon:lJ},{name:"Rooms",href:"/rooms",icon:SB},{name:"Profile",href:"/profile",icon:_J},{name:"Settings",href:"/settings",icon:hJ},{name:"Video Call",href:"/video-call",icon:EJ}];return T.jsxs("nav",{className:"fixed top-0 left-0 right-0 z-50 bg-background/95 backdrop-blur-md border-b border-border",children:[T.jsxs("div",{className:"container mx-auto px-4 h-16 flex items-center justify-between",children:[T.jsx(ii,{to:"/",className:"flex items-center space-x-3 hover-scale transition-smooth",children:T.jsxs("div",{className:"flex items-center space-x-2",children:[T.jsx("img",{src:"/logo.png",alt:"TeaTok Logo",className:"hidden dark:block h-12 w-12 md:h-14 md:w-14 rounded object-contain"}),T.jsx("img",{src:"/logo-light.png",alt:"TeaTok Logo",className:"block dark:hidden h-12 w-12 md:h-14 md:w-14 rounded object-contain"}),T.jsx("img",{src:"/teatok.png",alt:"TeaTok Text",className:"hidden dark:block h-10 md:h-12 w-auto object-contain"}),T.jsx("img",{src:"/teatok-light.png",alt:"TeaTok Text",className:"block dark:hidden h-10 md:h-12 w-auto object-contain"})]})}),T.jsx("div",{className:"hidden md:flex items-center space-x-6",children:f.map(_=>{const y=u.pathname===_.href;return T.jsxs(ii,{to:_.href,className:`flex items-center space-x-2 px-3 py-2 rounded-lg transition-smooth hover-lift ${y?"bg-primary text-primary-foreground shadow-glow":"text-muted-foreground hover:text-foreground hover:bg-muted"}`,children:[T.jsx(_.icon,{className:"h-4 w-4"}),T.jsx("span",{className:"font-medium",children:_.name})]},_.name)})}),T.jsxs("div",{className:"flex items-center space-x-3",children:[T.jsx(EN,{}),T.jsx(Cn,{asChild:!0,className:"spill-button animate-pulse-glow hidden sm:flex",children:T.jsxs(ii,{to:"/create",children:[T.jsx(Xj,{className:"h-4 w-4 mr-2"}),"Spill Tea"]})})]})]}),T.jsx("div",{className:"md:hidden fixed bottom-0 left-0 right-0 bg-background/95 backdrop-blur-md border-t border-border",children:T.jsxs("div",{className:"flex items-center justify-around py-2",children:[f.map(_=>{const y=u.pathname===_.href;return T.jsxs(ii,{to:_.href,className:`flex flex-col items-center p-3 rounded-lg transition-smooth ${y?"text-primary":"text-muted-foreground hover:text-foreground"}`,children:[T.jsx(_.icon,{className:"h-5 w-5 mb-1"}),T.jsx("span",{className:"text-xs font-medium",children:_.name})]},_.name)}),T.jsx(Cn,{asChild:!0,size:"icon",className:"gradient-primary text-primary-foreground rounded-full shadow-glow hover-glow",children:T.jsx(ii,{to:"/create",children:T.jsx(Xj,{className:"h-5 w-5"})})})]})})]})}const bte=()=>"https://bwp-back-1.onrender.com",Pl=bte();console.log(" [API] Environment VITE_API_URL:",void 0);console.log(" [API] Environment PROD:",!0);console.log(" [API] Resolved API_BASE:",Pl);async function Ite(u){const f=await fetch(`${Pl}/token`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(u)});if(!f.ok)throw new Error("Failed to get token");return f.json()}async function Ate(u){const f=`${Pl}/posts`,_=await fetch(f);if(!_.ok)throw new Error("Failed to fetch posts");return _.json()}async function Nte(u){const f=await fetch(`${Pl}/posts`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(u)});if(!f.ok)throw new Error("Failed to create post");return f.json()}async function Ote(){const u=await fetch(`${Pl}/users`);if(!u.ok)throw new Error("Failed to fetch users");return u.json()}async function Pte(u){const f=await fetch(`${Pl}/users`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(u)});if(!f.ok)throw new Error("Failed to create user");return f.json()}async function l4(u){const f=`${Pl}/rooms`,_=await fetch(f);if(!_.ok)throw new Error("Failed to fetch rooms");return _.json()}async function Dte(u,f,_){const y=await fetch(`${Pl}/reactions`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({postId:u,userId:f,reactionType:_})});if(!y.ok)throw new Error("Failed to add reaction");return y.json()}async function kte(u){const f=await fetch(`${Pl}/reactions/${u}`);if(!f.ok)throw new Error("Failed to fetch reactions");return f.json()}function Lte(){const[u,f]=j.useState([]),[_,y]=j.useState(!0),C=async(L,V)=>{try{await Dte(L,"demo-user-id",V),f(u.map(W=>W.id===L?{...W,reactions:{...W.reactions,[V]:W.reactions[V]+1}}:W))}catch(G){console.error("Failed to add reaction:",G)}},A=L=>{switch(L){case"tea":return"";case"spicy":return"";case"cap":return"";default:return""}};j.useEffect(()=>{(async()=>{try{console.log("Loading posts from API...");const V=await Ate();console.log("Received posts:",V.length);const G=V.map(W=>({id:W.id,author:W.author.name,alias:W.author.alias||"Anon",content:W.content,timestamp:new Date(W.createdAt).toLocaleString(),duration:W.duration,reactions:{tea:0,spicy:0,cap:0,hearts:0},replies:0,category:W.room.name,isVoiceNote:W.isVoiceNote}));f(G),console.log("Posts set:",G.length);for(const W of V)try{const K=await kte(W.id);f(ee=>ee.map(X=>X.id===W.id?{...X,reactions:K.reactions}:X))}catch(K){console.error("Failed to load reactions for post:",W.id,K)}}catch(V){console.error("Failed to load posts:",V),f([])}finally{y(!1)}})()},[]);const D=L=>{switch(L){case"Celeb Gossip":return"gradient-primary";case"Movies":return"gradient-accent";case"Gaming":return"gradient-warm";default:return"bg-muted"}};return T.jsxs("div",{className:"min-h-screen bg-background pb-20 md:pb-8",children:[T.jsx(BR,{}),T.jsx("main",{className:"container mx-auto px-4 pt-20 max-w-2xl",children:T.jsxs("div",{className:"space-y-6",children:[T.jsxs("div",{className:"text-center py-6 animate-fade-in",children:[T.jsx("h1",{className:"text-2xl font-bold mb-2",children:"Latest Tea"}),T.jsx("p",{className:"text-muted-foreground",children:"Fresh gossip, hot takes, and spicy reviews"}),T.jsxs("div",{className:"mt-4 p-4 bg-muted rounded-lg text-left text-sm",children:[T.jsx("p",{children:T.jsx("strong",{children:"Debug Info:"})}),T.jsxs("p",{children:["Loading: ",_?"Yes":"No"]}),T.jsxs("p",{children:["Posts Count: ",u.length]}),T.jsx("p",{children:"Check browser console for detailed logs"})]})]}),_&&T.jsxs("div",{className:"text-center py-12",children:[T.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto"}),T.jsx("p",{className:"mt-2 text-sm text-muted-foreground",children:"Loading posts..."})]}),!_&&T.jsx("div",{className:"space-y-6",children:u.length===0?T.jsxs("div",{className:"text-center py-12",children:[T.jsx("div",{className:"text-4xl mb-4",children:""}),T.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No tea yet"}),T.jsx("p",{className:"text-muted-foreground",children:"Be the first to spill some tea in this room!"})]}):u.map((L,V)=>T.jsxs(Gn,{className:"tea-card animate-slide-in-right",style:{animationDelay:`${V*.1}s`},children:[T.jsx($r,{className:"pb-3",children:T.jsxs("div",{className:"flex items-start justify-between",children:[T.jsxs("div",{className:"flex items-center space-x-3",children:[T.jsx(TN,{className:"w-10 h-10",children:T.jsx(RN,{className:`${D(L.category)} text-white font-semibold`,children:L.author.charAt(0)})}),T.jsxs("div",{children:[T.jsx("h3",{className:"font-semibold text-sm",children:L.alias}),T.jsxs("p",{className:"text-xs text-muted-foreground",children:["@",L.author]})]})]}),T.jsxs("div",{className:"flex items-center space-x-2",children:[T.jsx(hm,{variant:"secondary",className:"text-xs",children:L.category}),T.jsx(Cn,{variant:"ghost",size:"icon",className:"h-8 w-8",children:T.jsx(iJ,{className:"h-4 w-4"})})]})]})}),T.jsx(zn,{className:"py-0",children:T.jsxs("div",{className:"space-y-3",children:[L.isVoiceNote&&T.jsxs("div",{className:"flex items-center space-x-2 p-3 bg-muted rounded-lg",children:[T.jsx("div",{className:"w-8 h-8 gradient-accent rounded-full flex items-center justify-center",children:T.jsx("div",{className:"w-4 h-4 bg-white rounded-full animate-pulse"})}),T.jsx("div",{className:"flex-1",children:T.jsx("div",{className:"h-2 bg-accent rounded-full overflow-hidden",children:T.jsx("div",{className:"h-full w-3/4 bg-accent-foreground rounded-full"})})}),T.jsx("span",{className:"text-xs text-muted-foreground",children:"1:23"})]}),T.jsx("p",{className:"text-sm leading-relaxed",children:L.content}),T.jsxs("div",{className:"flex items-center justify-between text-xs text-muted-foreground",children:[T.jsxs("div",{className:"flex items-center space-x-1",children:[T.jsx(mm,{className:"h-3 w-3"}),T.jsx("span",{children:L.timestamp})]}),T.jsxs("div",{className:"flex items-center space-x-1",children:[L.duration==="permanent"?T.jsx(oJ,{className:"h-3 w-3 text-orange-500"}):T.jsx(mm,{className:"h-3 w-3"}),T.jsx("span",{children:L.duration})]})]})]})}),T.jsx(kg,{className:"pt-4",children:T.jsx("div",{className:"w-full space-y-3",children:T.jsxs("div",{className:"flex items-center justify-between",children:[T.jsx("div",{className:"flex items-center space-x-4",children:Object.entries(L.reactions).map(([G,W])=>T.jsxs(Cn,{variant:"ghost",size:"sm",onClick:()=>C(L.id,G),className:"flex items-center space-x-1 hover-scale transition-smooth p-2 rounded-full",children:[T.jsx("span",{className:"text-base",children:A(G)}),T.jsx("span",{className:"text-xs font-medium",children:W})]},G))}),T.jsxs("div",{className:"flex items-center space-x-2",children:[T.jsxs(Cn,{variant:"ghost",size:"sm",className:"hover-scale",children:[T.jsx(AR,{className:"h-4 w-4 mr-1"}),T.jsx("span",{className:"text-xs",children:L.replies})]}),T.jsx(Cn,{variant:"ghost",size:"sm",className:"hover-scale",children:T.jsx(pJ,{className:"h-4 w-4"})}),T.jsx(Cn,{variant:"ghost",size:"sm",className:"hover-scale",children:T.jsx(sJ,{className:"h-4 w-4"})})]})]})})})]},L.id))}),T.jsx("div",{className:"text-center py-8",children:T.jsx(Cn,{variant:"outline",className:"hover-glow",children:"Load More Tea"})})]})})]})}const d4=j.forwardRef(({className:u,...f},_)=>T.jsx("textarea",{className:Vn("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",u),ref:_,...f}));d4.displayName="Textarea";const xte=[{label:"24 Hours",value:"24h",description:"Perfect for hot takes"},{label:"7 Days",value:"7d",description:"Standard gossip duration"},{label:"Permanent",value:"permanent",description:"Forever in the archives"}];function Mte(){const[u,f]=j.useState(""),[_,y]=j.useState(""),[C,A]=j.useState("24h"),[D,L]=j.useState(!1),[V,G]=j.useState("text"),[W,K]=j.useState([]),[ee,X]=j.useState(!0),re=_N(),{toast:q}=Bg();tt.useEffect(()=>{(async()=>{try{const le=await l4();K(le)}catch(le){console.error("Failed to load rooms:",le),q({title:"Error",description:"Failed to load rooms. Please try again.",variant:"destructive"})}finally{X(!1)}})()},[q]);const $=async oe=>{if(oe.preventDefault(),!u.trim()||!_){q({title:"Missing Information",description:"Please add content and select a room to spill your tea!",variant:"destructive"});return}try{let Se=(await Ote())[0]?.id;Se||(Se=(await Pte({name:"Anonymous",email:`anon_${Date.now()}@local`,password:"demo"})).id);const be=W.find(Ue=>Ue.id===_);if(!be)throw new Error("Selected room not found");await Nte({title:`${be.name} - ${V==="voice"?"Voice Note":"Text Post"}`,content:u.trim(),authorId:Se,roomId:_,category:be.name,duration:C,isVoiceNote:V==="voice"}),q({title:"Tea Spilled! ",description:"Your anonymous post is now live. Time to watch the reactions roll in!"}),re("/feed")}catch(le){console.error("Error creating post:",le),q({title:"Error",description:"Failed to create post. Please try again.",variant:"destructive"})}},ae=()=>{L(!D),D?(f("Voice note recorded (1:23)"),q({title:"Recording Saved",description:"Your voice note is ready to be spilled!"})):q({title:"Recording Started",description:"Spill your tea! Tap again when you're done."})};return T.jsx("div",{className:"min-h-screen bg-background",children:T.jsxs("div",{className:"container mx-auto px-4 py-8 max-w-2xl",children:[T.jsxs("div",{className:"flex items-center justify-between mb-8 animate-fade-in",children:[T.jsxs(Cn,{variant:"ghost",onClick:()=>re(-1),className:"flex items-center space-x-2",children:[T.jsx($A,{className:"h-4 w-4"}),T.jsx("span",{children:"Back"})]}),T.jsx("h1",{className:"text-2xl font-bold gradient-primary bg-clip-text text-transparent",children:"Spill the Tea"}),T.jsx("div",{})," "]}),T.jsxs("form",{onSubmit:$,className:"space-y-6",children:[T.jsxs(Gn,{className:"tea-card animate-slide-in-right",children:[T.jsx($r,{children:T.jsx(Bi,{className:"text-lg",children:"What's brewing?"})}),T.jsx(zn,{children:T.jsxs(yN,{value:V,onValueChange:oe=>G(oe),children:[T.jsxs(FR,{className:"grid w-full grid-cols-2",children:[T.jsxs(Zd,{value:"text",className:"flex items-center space-x-2",children:[T.jsx(Kj,{className:"h-4 w-4"}),T.jsx("span",{children:"Text Post"})]}),T.jsxs(Zd,{value:"voice",className:"flex items-center space-x-2",children:[T.jsx(qj,{className:"h-4 w-4"}),T.jsx("span",{children:"Voice Note"})]})]}),T.jsxs($d,{value:"text",className:"mt-4",children:[T.jsx(d4,{placeholder:"Spill your tea here... What's the latest gossip, hot take, or review you're dying to share anonymously?",value:u,onChange:oe=>f(oe.target.value),className:"min-h-[120px] resize-none",maxLength:500}),T.jsxs("div",{className:"flex justify-between items-center mt-2 text-sm text-muted-foreground",children:[T.jsx("span",{children:"Be spicy, but stay respectful "}),T.jsxs("span",{children:[u.length,"/500"]})]})]}),T.jsx($d,{value:"voice",className:"mt-4",children:T.jsxs("div",{className:"flex flex-col items-center justify-center p-8 border-2 border-dashed border-border rounded-lg",children:[T.jsx(Cn,{type:"button",onClick:ae,className:`w-20 h-20 rounded-full ${D?"bg-destructive hover:bg-destructive/90 animate-pulse-glow":"gradient-primary hover-glow"} transition-smooth`,children:T.jsx(qj,{className:`h-8 w-8 ${D?"text-white":"text-primary-foreground"}`})}),T.jsx("p",{className:"mt-4 text-center text-muted-foreground",children:D?"Recording... Tap to stop":"Tap to start recording"}),u.includes("Voice note")&&T.jsxs("div",{className:"mt-4 p-3 bg-muted rounded-lg flex items-center space-x-2",children:[T.jsx("div",{className:"w-6 h-6 gradient-accent rounded-full flex items-center justify-center",children:T.jsx("div",{className:"w-3 h-3 bg-white rounded-full"})}),T.jsx("span",{className:"text-sm",children:"Voice note ready (1:23)"})]})]})})]})})]}),T.jsxs(Gn,{className:"tea-card animate-slide-in-right",style:{animationDelay:"0.1s"},children:[T.jsx($r,{children:T.jsxs(Bi,{className:"text-lg flex items-center space-x-2",children:[T.jsx(Kj,{className:"h-5 w-5"}),T.jsx("span",{children:"Choose Your Room"})]})}),T.jsx(zn,{children:ee?T.jsxs("div",{className:"text-center py-8",children:[T.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto"}),T.jsx("p",{className:"mt-2 text-sm text-muted-foreground",children:"Loading rooms..."})]}):T.jsx("div",{className:"grid grid-cols-2 gap-3",children:W.map(oe=>T.jsx(Cn,{type:"button",variant:_===oe.id?"default":"outline",className:`h-auto p-4 justify-start ${_===oe.id?`${oe.gradient} text-white shadow-glow`:"hover-lift"}`,onClick:()=>y(oe.id),children:T.jsxs("div",{className:"flex items-center space-x-3",children:[T.jsx("span",{className:"text-xl",children:oe.icon}),T.jsx("span",{className:"font-medium",children:oe.name})]})},oe.id))})})]}),T.jsxs(Gn,{className:"tea-card animate-slide-in-right",style:{animationDelay:"0.2s"},children:[T.jsx($r,{children:T.jsxs(Bi,{className:"text-lg flex items-center space-x-2",children:[T.jsx(mm,{className:"h-5 w-5"}),T.jsx("span",{children:"How Long Should This Live?"})]})}),T.jsx(zn,{children:T.jsx("div",{className:"space-y-3",children:xte.map(oe=>T.jsxs(Cn,{type:"button",variant:C===oe.value?"default":"outline",className:`w-full justify-between h-auto py-4 ${C===oe.value?"gradient-accent text-white shadow-glow":"hover-lift"}`,onClick:()=>A(oe.value),children:[T.jsxs("div",{className:"text-left",children:[T.jsx("div",{className:"font-medium",children:oe.label}),T.jsx("div",{className:"text-sm opacity-80",children:oe.description})]}),oe.value==="permanent"&&T.jsx(aJ,{className:"h-5 w-5"}),oe.value!=="permanent"&&T.jsx(gB,{className:"h-5 w-5"})]},oe.value))})})]}),T.jsx("div",{className:"flex justify-center pt-4 animate-fade-in",style:{animationDelay:"0.3s"},children:T.jsxs(Cn,{type:"submit",size:"lg",className:"spill-button px-12 py-4 text-lg font-semibold animate-bounce-subtle",disabled:!u.trim()||!_,children:[T.jsx(yB,{className:"h-5 w-5 mr-3"}),"Spill This Tea"]})})]}),T.jsx(Gn,{className:"tea-card mt-8 animate-fade-in",style:{animationDelay:"0.4s"},children:T.jsxs(zn,{className:"p-4",children:[T.jsx("h3",{className:"font-semibold mb-3 text-accent",children:"Pro Tips for Better Tea "}),T.jsxs("ul",{className:"space-y-2 text-sm text-muted-foreground",children:[T.jsx("li",{children:" Be specific but protect identities - no real names!"}),T.jsx("li",{children:" Spicy takes get more engagement than mild ones"}),T.jsx("li",{children:" Voice notes feel more authentic and personal"}),T.jsx("li",{children:" Campus Tea and Celeb Gossip rooms are most active"})]})]})})]})})}function Ute(){const[u,f]=j.useState(""),[_,y]=j.useState([]),[C,A]=j.useState([]),[D,L]=j.useState(!0);j.useEffect(()=>{(async()=>{try{const K=await l4();y(K),A(K)}catch(K){console.error("Failed to load rooms:",K)}finally{L(!1)}})()},[]);const V=W=>{f(W),W.trim()===""?A(_):A(_.filter(K=>K.name.toLowerCase().includes(W.toLowerCase())||K.description.toLowerCase().includes(W.toLowerCase())))},G=_.filter(W=>W.isTrending);return T.jsxs("div",{className:"min-h-screen bg-background pb-20 md:pb-8",children:[T.jsx(BR,{}),T.jsx("main",{className:"container mx-auto px-4 pt-20 max-w-4xl",children:T.jsxs("div",{className:"space-y-8",children:[T.jsxs("div",{className:"text-center space-y-4 animate-fade-in",children:[T.jsx("h1",{className:"text-3xl font-bold gradient-primary bg-clip-text text-transparent",children:"Topic Rooms"}),T.jsx("p",{className:"text-muted-foreground max-w-2xl mx-auto",children:"Join themed rooms where the tea flows freely. Each room has its own vibe and community."})]}),T.jsxs("div",{className:"relative max-w-md mx-auto animate-slide-in-right",children:[T.jsx(SB,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),T.jsx(Vc,{placeholder:"Search rooms...",value:u,onChange:W=>V(W.target.value),className:"pl-10"})]}),D&&T.jsxs("div",{className:"text-center py-12",children:[T.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto"}),T.jsx("p",{className:"mt-2 text-sm text-muted-foreground",children:"Loading rooms..."})]}),!D&&u===""&&T.jsxs("section",{className:"animate-slide-in-right",style:{animationDelay:"0.1s"},children:[T.jsxs("div",{className:"flex items-center space-x-2 mb-4",children:[T.jsx(dR,{className:"h-5 w-5 text-accent"}),T.jsx("h2",{className:"text-xl font-semibold",children:"Trending Now"})]}),T.jsx("div",{className:"grid md:grid-cols-3 gap-4",children:G.map((W,K)=>T.jsx(Gn,{className:"tea-card hover-lift cursor-pointer group",style:{animationDelay:`${K*.1}s`},children:T.jsxs(ii,{to:`/rooms/${W.id}`,children:[T.jsxs($r,{className:"pb-3",children:[T.jsxs("div",{className:"flex items-center justify-between",children:[T.jsx("div",{className:`w-12 h-12 ${W.gradient} rounded-full flex items-center justify-center text-2xl shadow-glow`,children:W.icon}),T.jsxs(hm,{variant:"secondary",className:"bg-accent/20 text-accent border-accent/30",children:[T.jsx(dR,{className:"h-3 w-3 mr-1"}),"Hot"]})]}),T.jsx(Bi,{className:"text-lg group-hover:text-primary transition-colors",children:W.name})]}),T.jsxs(zn,{children:[T.jsx(fo,{className:"text-sm mb-4",children:W.description}),T.jsxs("div",{className:"flex items-center justify-between text-xs text-muted-foreground",children:[T.jsxs("div",{className:"flex items-center space-x-1",children:[T.jsx(RB,{className:"h-3 w-3"}),T.jsx("span",{children:W.memberCount.toLocaleString()})]}),T.jsxs("div",{className:"flex items-center space-x-1",children:[T.jsx(mm,{className:"h-3 w-3"}),T.jsx("span",{children:W.lastActivity})]})]}),T.jsx("div",{className:"mt-3 p-2 bg-muted/50 rounded-lg",children:T.jsxs("div",{className:"text-xs font-medium text-accent",children:[W.recentPostCount," posts today"]})})]})]})},W.id))})]}),!D&&T.jsxs("section",{className:"animate-slide-in-right",style:{animationDelay:"0.2s"},children:[T.jsx("div",{className:"flex items-center justify-between mb-6",children:T.jsx("h2",{className:"text-xl font-semibold",children:u?`Search Results (${C.length})`:"All Rooms"})}),T.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-6",children:C.map((W,K)=>T.jsx(Gn,{className:"tea-card hover-lift cursor-pointer group",style:{animationDelay:`${K*.05}s`},children:T.jsxs(ii,{to:`/rooms/${W.id}`,children:[T.jsxs($r,{className:"pb-4",children:[T.jsxs("div",{className:"flex items-start justify-between",children:[T.jsx("div",{className:`w-14 h-14 ${W.gradient} rounded-xl flex items-center justify-center text-3xl shadow-glow group-hover:animate-bounce-subtle`,children:W.icon}),W.trending&&T.jsxs(hm,{variant:"secondary",className:"bg-accent/20 text-accent border-accent/30",children:[T.jsx(dR,{className:"h-3 w-3 mr-1"}),"Hot"]})]}),T.jsxs("div",{className:"space-y-2",children:[T.jsx(Bi,{className:"text-lg group-hover:text-primary transition-colors",children:W.name}),T.jsx(fo,{className:"text-sm line-clamp-2",children:W.description})]})]}),T.jsxs(zn,{className:"space-y-4",children:[T.jsxs("div",{className:"grid grid-cols-2 gap-4 text-center",children:[T.jsxs("div",{className:"space-y-1",children:[T.jsx("div",{className:"text-lg font-semibold text-primary",children:W.memberCount.toLocaleString()}),T.jsx("div",{className:"text-xs text-muted-foreground",children:"Members"})]}),T.jsxs("div",{className:"space-y-1",children:[T.jsx("div",{className:"text-lg font-semibold text-accent",children:W.recentPostCount}),T.jsx("div",{className:"text-xs text-muted-foreground",children:"Posts Today"})]})]}),T.jsxs("div",{className:"flex items-center justify-between text-xs text-muted-foreground pt-2 border-t border-border",children:[T.jsxs("div",{className:"flex items-center space-x-1",children:[T.jsx(mm,{className:"h-3 w-3"}),T.jsxs("span",{children:["Active ",W.lastActivity]})]}),T.jsx(bA,{className:"h-4 w-4 opacity-0 group-hover:opacity-100 transition-opacity"})]})]})]})},W.id))}),C.length===0&&T.jsxs("div",{className:"text-center py-12",children:[T.jsx("div",{className:"text-4xl mb-4",children:""}),T.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No rooms found"}),T.jsx("p",{className:"text-muted-foreground",children:"Try searching for different keywords or browse all rooms above."})]})]}),!D&&u===""&&T.jsx(Gn,{className:"tea-card gradient-hero text-center text-white animate-fade-in",style:{animationDelay:"0.3s"},children:T.jsxs(zn,{className:"py-8",children:[T.jsx("h3",{className:"text-xl font-semibold mb-2",children:"Can't find your vibe?"}),T.jsx("p",{className:"text-white/90 mb-6",children:"Suggest a new topic room and help grow the TeaTok community"}),T.jsx(Cn,{variant:"secondary",className:"hover-scale shadow-soft",children:"Suggest a Room"})]})})]})})]})}const Vte=[{id:"1",name:"Tea Connoisseur",description:"Spilled 50+ posts that got major reactions",icon:"",earned:!0,rarity:"rare"},{id:"2",name:"Gossip Guru",description:"Master of celebrity drama and hot takes",icon:"",earned:!0,rarity:"legendary"},{id:"3",name:"Movie Buff",description:"Expert reviewer in Movies room",icon:"",earned:!0,rarity:"common"},{id:"4",name:"Anonymous Legend",description:"Been active for 100+ days",icon:"",earned:!1,rarity:"legendary"}],jte=[{id:"1",content:"That new superhero movie everyone's hyping... it's mid at best. The plot holes are bigger than the hero's ego.",category:"Movies",timestamp:"2h ago",reactions:234,replies:45,status:"active"},{id:"2",content:"Y'all the drama between those two TikTok stars is getting MESSY ",category:"Celeb Gossip",timestamp:"1d ago",reactions:567,replies:89,status:"active"},{id:"3",content:"Anyone else think that new battle royale is actually fire? Best mechanics in years.",category:"Gaming",timestamp:"3d ago",reactions:156,replies:23,status:"expired"}];function Fte(){const[u,f]=j.useState("The Campus Oracle"),[_,y]=j.useState(!1),C={totalPosts:147,totalReactions:12567,topCategory:"Celeb Gossip",memberSince:"March 2024",streak:23},A=D=>{switch(D){case"legendary":return"gradient-primary";case"rare":return"gradient-accent";case"common":return"gradient-warm";default:return"bg-muted"}};return T.jsxs("div",{className:"min-h-screen bg-background pb-20 md:pb-8",children:[T.jsx(BR,{}),T.jsx("main",{className:"container mx-auto px-4 pt-20 max-w-4xl",children:T.jsxs("div",{className:"space-y-8",children:[T.jsx(Gn,{className:"tea-card animate-fade-in",children:T.jsx($r,{className:"text-center",children:T.jsxs("div",{className:"flex flex-col items-center space-y-4",children:[T.jsx(TN,{className:"w-24 h-24",children:T.jsx(RN,{className:"gradient-primary text-white text-2xl font-bold",children:u.charAt(0)})}),T.jsxs("div",{className:"space-y-2",children:[_?T.jsxs("div",{className:"flex items-center space-x-2",children:[T.jsx("input",{type:"text",value:u,onChange:D=>f(D.target.value),className:"text-2xl font-bold bg-transparent border-b border-border focus:outline-none focus:border-primary text-center"}),T.jsx(Cn,{size:"sm",onClick:()=>y(!1),className:"spill-button",children:"Save"})]}):T.jsxs("div",{className:"flex items-center space-x-2",children:[T.jsx("h1",{className:"text-2xl font-bold",children:u}),T.jsx(Cn,{size:"icon",variant:"ghost",onClick:()=>y(!0),className:"h-8 w-8 hover-scale",children:T.jsx(uJ,{className:"h-4 w-4"})})]}),T.jsxs("div",{className:"flex items-center justify-center space-x-4 text-sm text-muted-foreground",children:[T.jsxs("div",{className:"flex items-center space-x-1",children:[T.jsx(NR,{className:"h-4 w-4"}),T.jsx("span",{children:"Anonymous ID: #T3A7OK"})]}),T.jsxs("div",{className:"flex items-center space-x-1",children:[T.jsx(gB,{className:"h-4 w-4"}),T.jsxs("span",{children:["Since ",C.memberSince]})]})]})]})]})})}),T.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 animate-slide-in-right",children:[T.jsx(Gn,{className:"tea-card text-center",children:T.jsxs(zn,{className:"p-4",children:[T.jsx("div",{className:"text-2xl font-bold text-primary",children:C.totalPosts}),T.jsx("div",{className:"text-sm text-muted-foreground",children:"Posts Spilled"})]})}),T.jsx(Gn,{className:"tea-card text-center",children:T.jsxs(zn,{className:"p-4",children:[T.jsx("div",{className:"text-2xl font-bold text-accent",children:C.totalReactions.toLocaleString()}),T.jsx("div",{className:"text-sm text-muted-foreground",children:"Total Reactions"})]})}),T.jsx(Gn,{className:"tea-card text-center",children:T.jsxs(zn,{className:"p-4",children:[T.jsx("div",{className:"text-2xl font-bold text-tea-orange",children:C.streak}),T.jsx("div",{className:"text-sm text-muted-foreground",children:"Day Streak"})]})}),T.jsx(Gn,{className:"tea-card text-center",children:T.jsxs(zn,{className:"p-4",children:[T.jsx("div",{className:"text-sm font-bold text-tea-pink",children:C.topCategory}),T.jsx("div",{className:"text-sm text-muted-foreground",children:"Top Category"})]})})]}),T.jsxs(yN,{defaultValue:"badges",className:"animate-slide-in-right",style:{animationDelay:"0.1s"},children:[T.jsxs(FR,{className:"grid w-full grid-cols-3",children:[T.jsx(Zd,{value:"badges",children:"Badges"}),T.jsx(Zd,{value:"posts",children:"My Posts"}),T.jsx(Zd,{value:"activity",children:"Activity"})]}),T.jsx($d,{value:"badges",className:"space-y-6",children:T.jsx("div",{className:"grid md:grid-cols-2 gap-4",children:Vte.map((D,L)=>T.jsxs(Gn,{className:`tea-card ${D.earned?"shadow-glow":"opacity-60"}`,style:{animationDelay:`${L*.1}s`},children:[T.jsx($r,{className:"pb-3",children:T.jsxs("div",{className:"flex items-center space-x-4",children:[T.jsx("div",{className:`w-12 h-12 ${A(D.rarity)} rounded-full flex items-center justify-center text-2xl shadow-glow`,children:D.icon}),T.jsxs("div",{className:"flex-1",children:[T.jsxs(Bi,{className:"text-lg flex items-center space-x-2",children:[T.jsx("span",{children:D.name}),D.earned&&T.jsx(eJ,{className:"h-4 w-4 text-accent"})]}),T.jsx(hm,{variant:"secondary",className:`text-xs ${A(D.rarity)} text-white border-0`,children:D.rarity})]})]})}),T.jsxs(zn,{children:[T.jsx(fo,{children:D.description}),!D.earned&&T.jsx("div",{className:"mt-3 text-xs text-muted-foreground",children:"Keep spilling tea to unlock this badge!"})]})]},D.id))})}),T.jsx($d,{value:"posts",className:"space-y-4",children:jte.map((D,L)=>T.jsxs(Gn,{className:`tea-card ${D.status==="expired"?"opacity-60":""}`,style:{animationDelay:`${L*.1}s`},children:[T.jsx($r,{className:"pb-3",children:T.jsxs("div",{className:"flex items-center justify-between",children:[T.jsxs("div",{className:"flex items-center space-x-2",children:[T.jsx(hm,{variant:"secondary",children:D.category}),T.jsx(hm,{variant:D.status==="active"?"default":"outline",className:D.status==="active"?"bg-accent text-accent-foreground":"",children:D.status})]}),T.jsxs("div",{className:"flex items-center space-x-1 text-sm text-muted-foreground",children:[T.jsx(mm,{className:"h-4 w-4"}),T.jsx("span",{children:D.timestamp})]})]})}),T.jsxs(zn,{className:"space-y-4",children:[T.jsx("p",{className:"text-sm leading-relaxed",children:D.content}),T.jsxs("div",{className:"flex items-center justify-between text-sm",children:[T.jsxs("div",{className:"flex items-center space-x-4",children:[T.jsxs("div",{className:"flex items-center space-x-1 text-accent",children:[T.jsx(dR,{className:"h-4 w-4"}),T.jsx("span",{children:D.reactions})]}),T.jsxs("div",{className:"flex items-center space-x-1 text-muted-foreground",children:[T.jsx(AR,{className:"h-4 w-4"}),T.jsx("span",{children:D.replies})]})]}),D.status==="active"&&T.jsx(Cn,{variant:"ghost",size:"sm",className:"hover-scale",children:"View Post"})]})]})]},D.id))}),T.jsxs($d,{value:"activity",className:"space-y-6",children:[T.jsxs(Gn,{className:"tea-card",children:[T.jsxs($r,{children:[T.jsx(Bi,{children:"Weekly Activity"}),T.jsx(fo,{children:"Your tea-spilling patterns"})]}),T.jsx(zn,{children:T.jsxs("div",{className:"space-y-4",children:[T.jsxs("div",{className:"flex items-center justify-between",children:[T.jsx("span",{className:"text-sm",children:"Most Active Time"}),T.jsx("span",{className:"text-sm font-medium",children:"9-11 PM"})]}),T.jsxs("div",{className:"flex items-center justify-between",children:[T.jsx("span",{className:"text-sm",children:"Favorite Room"}),T.jsx("span",{className:"text-sm font-medium",children:"Celeb Gossip"})]}),T.jsxs("div",{className:"flex items-center justify-between",children:[T.jsx("span",{className:"text-sm",children:"Average Reactions per Post"}),T.jsx("span",{className:"text-sm font-medium",children:"85.4"})]}),T.jsxs("div",{className:"flex items-center justify-between",children:[T.jsx("span",{className:"text-sm",children:"Reply Rate"}),T.jsx("span",{className:"text-sm font-medium",children:"68%"})]})]})})]}),T.jsx(Gn,{className:"tea-card gradient-hero text-white",children:T.jsxs(zn,{className:"p-6 text-center",children:[T.jsx("h3",{className:"text-xl font-semibold mb-2",children:"Keep the Tea Flowing!"}),T.jsxs("p",{className:"text-white/90 mb-4",children:["You're doing great! Your posts generate ",Math.round(C.totalReactions/C.totalPosts)," average reactions."]}),T.jsx(Cn,{variant:"secondary",className:"hover-scale shadow-soft",children:"Spill More Tea"})]})})]})]})]})})]})}function u4(u){const f=j.useRef({value:u,previous:u});return j.useMemo(()=>(f.current.value!==u&&(f.current.previous=f.current.value,f.current.value=u),f.current.previous),[u])}var WR="Switch",[Bte]=Ol(WR),[Wte,Gte]=Bte(WR),h4=j.forwardRef((u,f)=>{const{__scopeSwitch:_,name:y,checked:C,defaultChecked:A,required:D,disabled:L,value:V="on",onCheckedChange:G,form:W,...K}=u,[ee,X]=j.useState(null),re=yr(f,le=>X(le)),q=j.useRef(!1),$=ee?W||!!ee.closest("form"):!0,[ae,oe]=fm({prop:C,defaultProp:A??!1,onChange:G,caller:WR});return T.jsxs(Wte,{scope:_,checked:ae,disabled:L,children:[T.jsx(En.button,{type:"button",role:"switch","aria-checked":ae,"aria-required":D,"data-state":_4(ae),"data-disabled":L?"":void 0,disabled:L,value:V,...K,ref:re,onClick:$t(u.onClick,le=>{oe(Se=>!Se),$&&(q.current=le.isPropagationStopped(),q.current||le.stopPropagation())})}),$&&T.jsx(m4,{control:ee,bubbles:!q.current,name:y,value:V,checked:ae,required:D,disabled:L,form:W,style:{transform:"translateX(-100%)"}})]})});h4.displayName=WR;var p4="SwitchThumb",f4=j.forwardRef((u,f)=>{const{__scopeSwitch:_,...y}=u,C=Gte(p4,_);return T.jsx(En.span,{"data-state":_4(C.checked),"data-disabled":C.disabled?"":void 0,...y,ref:f})});f4.displayName=p4;var Hte="SwitchBubbleInput",m4=j.forwardRef(({__scopeSwitch:u,control:f,checked:_,bubbles:y=!0,...C},A)=>{const D=j.useRef(null),L=yr(D,A),V=u4(_),G=XB(f);return j.useEffect(()=>{const W=D.current;if(!W)return;const K=window.HTMLInputElement.prototype,X=Object.getOwnPropertyDescriptor(K,"checked").set;if(V!==_&&X){const re=new Event("click",{bubbles:y});X.call(W,_),W.dispatchEvent(re)}},[V,_,y]),T.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:_,...C,tabIndex:-1,ref:L,style:{...C.style,...G,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});m4.displayName=Hte;function _4(u){return u?"checked":"unchecked"}var E4=h4,Kte=f4;const jh=j.forwardRef(({className:u,...f},_)=>T.jsx(E4,{className:Vn("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors data-[state=checked]:bg-primary data-[state=unchecked]:bg-input focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50",u),...f,ref:_,children:T.jsx(Kte,{className:Vn("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})}));jh.displayName=E4.displayName;function NF(u,[f,_]){return Math.min(_,Math.max(f,u))}var mA=0;function zte(){j.useEffect(()=>{const u=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",u[0]??OF()),document.body.insertAdjacentElement("beforeend",u[1]??OF()),mA++,()=>{mA===1&&document.querySelectorAll("[data-radix-focus-guard]").forEach(f=>f.remove()),mA--}},[])}function OF(){const u=document.createElement("span");return u.setAttribute("data-radix-focus-guard",""),u.tabIndex=0,u.style.outline="none",u.style.opacity="0",u.style.position="fixed",u.style.pointerEvents="none",u}var _A="focusScope.autoFocusOnMount",EA="focusScope.autoFocusOnUnmount",PF={bubbles:!1,cancelable:!0},Yte="FocusScope",g4=j.forwardRef((u,f)=>{const{loop:_=!1,trapped:y=!1,onMountAutoFocus:C,onUnmountAutoFocus:A,...D}=u,[L,V]=j.useState(null),G=_o(C),W=_o(A),K=j.useRef(null),ee=yr(f,q=>V(q)),X=j.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;j.useEffect(()=>{if(y){let q=function(le){if(X.paused||!L)return;const Se=le.target;L.contains(Se)?K.current=Se:Xd(K.current,{select:!0})},$=function(le){if(X.paused||!L)return;const Se=le.relatedTarget;Se!==null&&(L.contains(Se)||Xd(K.current,{select:!0}))},ae=function(le){if(document.activeElement===document.body)for(const be of le)be.removedNodes.length>0&&Xd(L)};document.addEventListener("focusin",q),document.addEventListener("focusout",$);const oe=new MutationObserver(ae);return L&&oe.observe(L,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",q),document.removeEventListener("focusout",$),oe.disconnect()}}},[y,L,X.paused]),j.useEffect(()=>{if(L){kF.add(X);const q=document.activeElement;if(!L.contains(q)){const ae=new CustomEvent(_A,PF);L.addEventListener(_A,G),L.dispatchEvent(ae),ae.defaultPrevented||(qte($te(v4(L)),{select:!0}),document.activeElement===q&&Xd(L))}return()=>{L.removeEventListener(_A,G),setTimeout(()=>{const ae=new CustomEvent(EA,PF);L.addEventListener(EA,W),L.dispatchEvent(ae),ae.defaultPrevented||Xd(q??document.body,{select:!0}),L.removeEventListener(EA,W),kF.remove(X)},0)}}},[L,G,W,X]);const re=j.useCallback(q=>{if(!_&&!y||X.paused)return;const $=q.key==="Tab"&&!q.altKey&&!q.ctrlKey&&!q.metaKey,ae=document.activeElement;if($&&ae){const oe=q.currentTarget,[le,Se]=Xte(oe);le&&Se?!q.shiftKey&&ae===Se?(q.preventDefault(),_&&Xd(le,{select:!0})):q.shiftKey&&ae===le&&(q.preventDefault(),_&&Xd(Se,{select:!0})):ae===oe&&q.preventDefault()}},[_,y,X.paused]);return T.jsx(En.div,{tabIndex:-1,...D,ref:ee,onKeyDown:re})});g4.displayName=Yte;function qte(u,{select:f=!1}={}){const _=document.activeElement;for(const y of u)if(Xd(y,{select:f}),document.activeElement!==_)return}function Xte(u){const f=v4(u),_=DF(f,u),y=DF(f.reverse(),u);return[_,y]}function v4(u){const f=[],_=document.createTreeWalker(u,NodeFilter.SHOW_ELEMENT,{acceptNode:y=>{const C=y.tagName==="INPUT"&&y.type==="hidden";return y.disabled||y.hidden||C?NodeFilter.FILTER_SKIP:y.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;_.nextNode();)f.push(_.currentNode);return f}function DF(u,f){for(const _ of u)if(!Jte(_,{upTo:f}))return _}function Jte(u,{upTo:f}){if(getComputedStyle(u).visibility==="hidden")return!0;for(;u;){if(f!==void 0&&u===f)return!1;if(getComputedStyle(u).display==="none")return!0;u=u.parentElement}return!1}function Qte(u){return u instanceof HTMLInputElement&&"select"in u}function Xd(u,{select:f=!1}={}){if(u&&u.focus){const _=document.activeElement;u.focus({preventScroll:!0}),u!==_&&Qte(u)&&f&&u.select()}}var kF=Zte();function Zte(){let u=[];return{add(f){const _=u[0];f!==_&&_?.pause(),u=LF(u,f),u.unshift(f)},remove(f){u=LF(u,f),u[0]?.resume()}}}function LF(u,f){const _=[...u],y=_.indexOf(f);return y!==-1&&_.splice(y,1),_}function $te(u){return u.filter(f=>f.tagName!=="A")}var ene=function(u){if(typeof document>"u")return null;var f=Array.isArray(u)?u[0]:u;return f.ownerDocument.body},om=new WeakMap,rR=new WeakMap,iR={},gA=0,y4=function(u){return u&&(u.host||y4(u.parentNode))},tne=function(u,f){return f.map(function(_){if(u.contains(_))return _;var y=y4(_);return y&&u.contains(y)?y:(console.error("aria-hidden",_,"in not contained inside",u,". Doing nothing"),null)}).filter(function(_){return!!_})},nne=function(u,f,_,y){var C=tne(f,Array.isArray(u)?u:[u]);iR[_]||(iR[_]=new WeakMap);var A=iR[_],D=[],L=new Set,V=new Set(C),G=function(K){!K||L.has(K)||(L.add(K),G(K.parentNode))};C.forEach(G);var W=function(K){!K||V.has(K)||Array.prototype.forEach.call(K.children,function(ee){if(L.has(ee))W(ee);else try{var X=ee.getAttribute(y),re=X!==null&&X!=="false",q=(om.get(ee)||0)+1,$=(A.get(ee)||0)+1;om.set(ee,q),A.set(ee,$),D.push(ee),q===1&&re&&rR.set(ee,!0),$===1&&ee.setAttribute(_,"true"),re||ee.setAttribute(y,"true")}catch(ae){console.error("aria-hidden: cannot operate on ",ee,ae)}})};return W(f),L.clear(),gA++,function(){D.forEach(function(K){var ee=om.get(K)-1,X=A.get(K)-1;om.set(K,ee),A.set(K,X),ee||(rR.has(K)||K.removeAttribute(y),rR.delete(K)),X||K.removeAttribute(_)}),gA--,gA||(om=new WeakMap,om=new WeakMap,rR=new WeakMap,iR={})}},rne=function(u,f,_){_===void 0&&(_="data-aria-hidden");var y=Array.from(Array.isArray(u)?u:[u]),C=ene(u);return C?(y.push.apply(y,Array.from(C.querySelectorAll("[aria-live]"))),nne(y,C,_,"aria-hidden")):function(){return null}},Mc=function(){return Mc=Object.assign||function(f){for(var _,y=1,C=arguments.length;y<C;y++){_=arguments[y];for(var A in _)Object.prototype.hasOwnProperty.call(_,A)&&(f[A]=_[A])}return f},Mc.apply(this,arguments)};function S4(u,f){var _={};for(var y in u)Object.prototype.hasOwnProperty.call(u,y)&&f.indexOf(y)<0&&(_[y]=u[y]);if(u!=null&&typeof Object.getOwnPropertySymbols=="function")for(var C=0,y=Object.getOwnPropertySymbols(u);C<y.length;C++)f.indexOf(y[C])<0&&Object.prototype.propertyIsEnumerable.call(u,y[C])&&(_[y[C]]=u[y[C]]);return _}function ine(u,f,_){if(_||arguments.length===2)for(var y=0,C=f.length,A;y<C;y++)(A||!(y in f))&&(A||(A=Array.prototype.slice.call(f,0,y)),A[y]=f[y]);return u.concat(A||Array.prototype.slice.call(f))}var hR="right-scroll-bar-position",pR="width-before-scroll-bar",sne="with-scroll-bars-hidden",one="--removed-body-scroll-bar-size";function vA(u,f){return typeof u=="function"?u(f):u&&(u.current=f),u}function ane(u,f){var _=j.useState(function(){return{value:u,callback:f,facade:{get current(){return _.value},set current(y){var C=_.value;C!==y&&(_.value=y,_.callback(y,C))}}}})[0];return _.callback=f,_.facade}var cne=typeof window<"u"?j.useLayoutEffect:j.useEffect,xF=new WeakMap;function lne(u,f){var _=ane(null,function(y){return u.forEach(function(C){return vA(C,y)})});return cne(function(){var y=xF.get(_);if(y){var C=new Set(y),A=new Set(u),D=_.current;C.forEach(function(L){A.has(L)||vA(L,null)}),A.forEach(function(L){C.has(L)||vA(L,D)})}xF.set(_,u)},[u]),_}function dne(u){return u}function une(u,f){f===void 0&&(f=dne);var _=[],y=!1,C={read:function(){if(y)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return _.length?_[_.length-1]:u},useMedium:function(A){var D=f(A,y);return _.push(D),function(){_=_.filter(function(L){return L!==D})}},assignSyncMedium:function(A){for(y=!0;_.length;){var D=_;_=[],D.forEach(A)}_={push:function(L){return A(L)},filter:function(){return _}}},assignMedium:function(A){y=!0;var D=[];if(_.length){var L=_;_=[],L.forEach(A),D=_}var V=function(){var W=D;D=[],W.forEach(A)},G=function(){return Promise.resolve().then(V)};G(),_={push:function(W){D.push(W),G()},filter:function(W){return D=D.filter(W),_}}}};return C}function hne(u){u===void 0&&(u={});var f=une(null);return f.options=Mc({async:!0,ssr:!1},u),f}var T4=function(u){var f=u.sideCar,_=S4(u,["sideCar"]);if(!f)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var y=f.read();if(!y)throw new Error("Sidecar medium not found");return j.createElement(y,Mc({},_))};T4.isSideCarExport=!0;function pne(u,f){return u.useMedium(f),T4}var R4=hne(),yA=function(){},GR=j.forwardRef(function(u,f){var _=j.useRef(null),y=j.useState({onScrollCapture:yA,onWheelCapture:yA,onTouchMoveCapture:yA}),C=y[0],A=y[1],D=u.forwardProps,L=u.children,V=u.className,G=u.removeScrollBar,W=u.enabled,K=u.shards,ee=u.sideCar,X=u.noRelative,re=u.noIsolation,q=u.inert,$=u.allowPinchZoom,ae=u.as,oe=ae===void 0?"div":ae,le=u.gapMode,Se=S4(u,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noRelative","noIsolation","inert","allowPinchZoom","as","gapMode"]),be=ee,Ue=lne([_,f]),xe=Mc(Mc({},Se),C);return j.createElement(j.Fragment,null,W&&j.createElement(be,{sideCar:R4,removeScrollBar:G,shards:K,noRelative:X,noIsolation:re,inert:q,setCallbacks:A,allowPinchZoom:!!$,lockRef:_,gapMode:le}),D?j.cloneElement(j.Children.only(L),Mc(Mc({},xe),{ref:Ue})):j.createElement(oe,Mc({},xe,{className:V,ref:Ue}),L))});GR.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};GR.classNames={fullWidth:pR,zeroRight:hR};var fne=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function mne(){if(!document)return null;var u=document.createElement("style");u.type="text/css";var f=fne();return f&&u.setAttribute("nonce",f),u}function _ne(u,f){u.styleSheet?u.styleSheet.cssText=f:u.appendChild(document.createTextNode(f))}function Ene(u){var f=document.head||document.getElementsByTagName("head")[0];f.appendChild(u)}var gne=function(){var u=0,f=null;return{add:function(_){u==0&&(f=mne())&&(_ne(f,_),Ene(f)),u++},remove:function(){u--,!u&&f&&(f.parentNode&&f.parentNode.removeChild(f),f=null)}}},vne=function(){var u=gne();return function(f,_){j.useEffect(function(){return u.add(f),function(){u.remove()}},[f&&_])}},C4=function(){var u=vne(),f=function(_){var y=_.styles,C=_.dynamic;return u(y,C),null};return f},yne={left:0,top:0,right:0,gap:0},SA=function(u){return parseInt(u||"",10)||0},Sne=function(u){var f=window.getComputedStyle(document.body),_=f[u==="padding"?"paddingLeft":"marginLeft"],y=f[u==="padding"?"paddingTop":"marginTop"],C=f[u==="padding"?"paddingRight":"marginRight"];return[SA(_),SA(y),SA(C)]},Tne=function(u){if(u===void 0&&(u="margin"),typeof window>"u")return yne;var f=Sne(u),_=document.documentElement.clientWidth,y=window.innerWidth;return{left:f[0],top:f[1],right:f[2],gap:Math.max(0,y-_+f[2]-f[0])}},Rne=C4(),pm="data-scroll-locked",Cne=function(u,f,_,y){var C=u.left,A=u.top,D=u.right,L=u.gap;return _===void 0&&(_="margin"),`
  .`.concat(sne,` {
   overflow: hidden `).concat(y,`;
   padding-right: `).concat(L,"px ").concat(y,`;
  }
  body[`).concat(pm,`] {
    overflow: hidden `).concat(y,`;
    overscroll-behavior: contain;
    `).concat([f&&"position: relative ".concat(y,";"),_==="margin"&&`
    padding-left: `.concat(C,`px;
    padding-top: `).concat(A,`px;
    padding-right: `).concat(D,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(L,"px ").concat(y,`;
    `),_==="padding"&&"padding-right: ".concat(L,"px ").concat(y,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(hR,` {
    right: `).concat(L,"px ").concat(y,`;
  }
  
  .`).concat(pR,` {
    margin-right: `).concat(L,"px ").concat(y,`;
  }
  
  .`).concat(hR," .").concat(hR,` {
    right: 0 `).concat(y,`;
  }
  
  .`).concat(pR," .").concat(pR,` {
    margin-right: 0 `).concat(y,`;
  }
  
  body[`).concat(pm,`] {
    `).concat(one,": ").concat(L,`px;
  }
`)},MF=function(){var u=parseInt(document.body.getAttribute(pm)||"0",10);return isFinite(u)?u:0},wne=function(){j.useEffect(function(){return document.body.setAttribute(pm,(MF()+1).toString()),function(){var u=MF()-1;u<=0?document.body.removeAttribute(pm):document.body.setAttribute(pm,u.toString())}},[])},bne=function(u){var f=u.noRelative,_=u.noImportant,y=u.gapMode,C=y===void 0?"margin":y;wne();var A=j.useMemo(function(){return Tne(C)},[C]);return j.createElement(Rne,{styles:Cne(A,!f,C,_?"":"!important")})},jA=!1;if(typeof window<"u")try{var sR=Object.defineProperty({},"passive",{get:function(){return jA=!0,!0}});window.addEventListener("test",sR,sR),window.removeEventListener("test",sR,sR)}catch{jA=!1}var am=jA?{passive:!1}:!1,Ine=function(u){return u.tagName==="TEXTAREA"},w4=function(u,f){if(!(u instanceof Element))return!1;var _=window.getComputedStyle(u);return _[f]!=="hidden"&&!(_.overflowY===_.overflowX&&!Ine(u)&&_[f]==="visible")},Ane=function(u){return w4(u,"overflowY")},Nne=function(u){return w4(u,"overflowX")},UF=function(u,f){var _=f.ownerDocument,y=f;do{typeof ShadowRoot<"u"&&y instanceof ShadowRoot&&(y=y.host);var C=b4(u,y);if(C){var A=I4(u,y),D=A[1],L=A[2];if(D>L)return!0}y=y.parentNode}while(y&&y!==_.body);return!1},One=function(u){var f=u.scrollTop,_=u.scrollHeight,y=u.clientHeight;return[f,_,y]},Pne=function(u){var f=u.scrollLeft,_=u.scrollWidth,y=u.clientWidth;return[f,_,y]},b4=function(u,f){return u==="v"?Ane(f):Nne(f)},I4=function(u,f){return u==="v"?One(f):Pne(f)},Dne=function(u,f){return u==="h"&&f==="rtl"?-1:1},kne=function(u,f,_,y,C){var A=Dne(u,window.getComputedStyle(f).direction),D=A*y,L=_.target,V=f.contains(L),G=!1,W=D>0,K=0,ee=0;do{if(!L)break;var X=I4(u,L),re=X[0],q=X[1],$=X[2],ae=q-$-A*re;(re||ae)&&b4(u,L)&&(K+=ae,ee+=re);var oe=L.parentNode;L=oe&&oe.nodeType===Node.DOCUMENT_FRAGMENT_NODE?oe.host:oe}while(!V&&L!==document.body||V&&(f.contains(L)||f===L));return(W&&Math.abs(K)<1||!W&&Math.abs(ee)<1)&&(G=!0),G},oR=function(u){return"changedTouches"in u?[u.changedTouches[0].clientX,u.changedTouches[0].clientY]:[0,0]},VF=function(u){return[u.deltaX,u.deltaY]},jF=function(u){return u&&"current"in u?u.current:u},Lne=function(u,f){return u[0]===f[0]&&u[1]===f[1]},xne=function(u){return`
  .block-interactivity-`.concat(u,` {pointer-events: none;}
  .allow-interactivity-`).concat(u,` {pointer-events: all;}
`)},Mne=0,cm=[];function Une(u){var f=j.useRef([]),_=j.useRef([0,0]),y=j.useRef(),C=j.useState(Mne++)[0],A=j.useState(C4)[0],D=j.useRef(u);j.useEffect(function(){D.current=u},[u]),j.useEffect(function(){if(u.inert){document.body.classList.add("block-interactivity-".concat(C));var q=ine([u.lockRef.current],(u.shards||[]).map(jF),!0).filter(Boolean);return q.forEach(function($){return $.classList.add("allow-interactivity-".concat(C))}),function(){document.body.classList.remove("block-interactivity-".concat(C)),q.forEach(function($){return $.classList.remove("allow-interactivity-".concat(C))})}}},[u.inert,u.lockRef.current,u.shards]);var L=j.useCallback(function(q,$){if("touches"in q&&q.touches.length===2||q.type==="wheel"&&q.ctrlKey)return!D.current.allowPinchZoom;var ae=oR(q),oe=_.current,le="deltaX"in q?q.deltaX:oe[0]-ae[0],Se="deltaY"in q?q.deltaY:oe[1]-ae[1],be,Ue=q.target,xe=Math.abs(le)>Math.abs(Se)?"h":"v";if("touches"in q&&xe==="h"&&Ue.type==="range")return!1;var je=UF(xe,Ue);if(!je)return!0;if(je?be=xe:(be=xe==="v"?"h":"v",je=UF(xe,Ue)),!je)return!1;if(!y.current&&"changedTouches"in q&&(le||Se)&&(y.current=be),!be)return!0;var lt=y.current||be;return kne(lt,$,q,lt==="h"?le:Se)},[]),V=j.useCallback(function(q){var $=q;if(!(!cm.length||cm[cm.length-1]!==A)){var ae="deltaY"in $?VF($):oR($),oe=f.current.filter(function(be){return be.name===$.type&&(be.target===$.target||$.target===be.shadowParent)&&Lne(be.delta,ae)})[0];if(oe&&oe.should){$.cancelable&&$.preventDefault();return}if(!oe){var le=(D.current.shards||[]).map(jF).filter(Boolean).filter(function(be){return be.contains($.target)}),Se=le.length>0?L($,le[0]):!D.current.noIsolation;Se&&$.cancelable&&$.preventDefault()}}},[]),G=j.useCallback(function(q,$,ae,oe){var le={name:q,delta:$,target:ae,should:oe,shadowParent:Vne(ae)};f.current.push(le),setTimeout(function(){f.current=f.current.filter(function(Se){return Se!==le})},1)},[]),W=j.useCallback(function(q){_.current=oR(q),y.current=void 0},[]),K=j.useCallback(function(q){G(q.type,VF(q),q.target,L(q,u.lockRef.current))},[]),ee=j.useCallback(function(q){G(q.type,oR(q),q.target,L(q,u.lockRef.current))},[]);j.useEffect(function(){return cm.push(A),u.setCallbacks({onScrollCapture:K,onWheelCapture:K,onTouchMoveCapture:ee}),document.addEventListener("wheel",V,am),document.addEventListener("touchmove",V,am),document.addEventListener("touchstart",W,am),function(){cm=cm.filter(function(q){return q!==A}),document.removeEventListener("wheel",V,am),document.removeEventListener("touchmove",V,am),document.removeEventListener("touchstart",W,am)}},[]);var X=u.removeScrollBar,re=u.inert;return j.createElement(j.Fragment,null,re?j.createElement(A,{styles:xne(C)}):null,X?j.createElement(bne,{noRelative:u.noRelative,gapMode:u.gapMode}):null)}function Vne(u){for(var f=null;u!==null;)u instanceof ShadowRoot&&(f=u.host,u=u.host),u=u.parentNode;return f}const jne=pne(R4,Une);var A4=j.forwardRef(function(u,f){return j.createElement(GR,Mc({},u,{ref:f,sideCar:jne}))});A4.classNames=GR.classNames;var Fne=[" ","Enter","ArrowUp","ArrowDown"],Bne=[" ","Enter"],Wh="Select",[HR,KR,Wne]=YA(Wh),[Cm]=Ol(Wh,[Wne,kR]),zR=kR(),[Gne,nu]=Cm(Wh),[Hne,Kne]=Cm(Wh),N4=u=>{const{__scopeSelect:f,children:_,open:y,defaultOpen:C,onOpenChange:A,value:D,defaultValue:L,onValueChange:V,dir:G,name:W,autoComplete:K,disabled:ee,required:X,form:re}=u,q=zR(f),[$,ae]=j.useState(null),[oe,le]=j.useState(null),[Se,be]=j.useState(!1),Ue=gN(G),[xe,je]=fm({prop:y,defaultProp:C??!1,onChange:A,caller:Wh}),[lt,Et]=fm({prop:D,defaultProp:L,onChange:V,caller:Wh}),ht=j.useRef(null),Ge=$?re||!!$.closest("form"):!0,[pt,Fe]=j.useState(new Set),Ct=Array.from(pt).map(nt=>nt.props.value).join(";");return T.jsx(i$,{...q,children:T.jsxs(Gne,{required:X,scope:f,trigger:$,onTriggerChange:ae,valueNode:oe,onValueNodeChange:le,valueNodeHasChildren:Se,onValueNodeHasChildrenChange:be,contentId:Gg(),value:lt,onValueChange:Et,open:xe,onOpenChange:je,dir:Ue,triggerPointerDownPosRef:ht,disabled:ee,children:[T.jsx(HR.Provider,{scope:f,children:T.jsx(Hne,{scope:u.__scopeSelect,onNativeOptionAdd:j.useCallback(nt=>{Fe(Je=>new Set(Je).add(nt))},[]),onNativeOptionRemove:j.useCallback(nt=>{Fe(Je=>{const Oe=new Set(Je);return Oe.delete(nt),Oe})},[]),children:_})}),Ge?T.jsxs($4,{"aria-hidden":!0,required:X,tabIndex:-1,name:W,autoComplete:K,value:lt,onChange:nt=>Et(nt.target.value),disabled:ee,form:re,children:[lt===void 0?T.jsx("option",{value:""}):null,Array.from(pt)]},Ct):null]})})};N4.displayName=Wh;var O4="SelectTrigger",P4=j.forwardRef((u,f)=>{const{__scopeSelect:_,disabled:y=!1,...C}=u,A=zR(_),D=nu(O4,_),L=D.disabled||y,V=yr(f,D.onTriggerChange),G=KR(_),W=j.useRef("touch"),[K,ee,X]=t5(q=>{const $=G().filter(le=>!le.disabled),ae=$.find(le=>le.value===D.value),oe=n5($,q,ae);oe!==void 0&&D.onValueChange(oe.value)}),re=q=>{L||(D.onOpenChange(!0),X()),q&&(D.triggerPointerDownPosRef.current={x:Math.round(q.pageX),y:Math.round(q.pageY)})};return T.jsx(s3,{asChild:!0,...A,children:T.jsx(En.button,{type:"button",role:"combobox","aria-controls":D.contentId,"aria-expanded":D.open,"aria-required":D.required,"aria-autocomplete":"none",dir:D.dir,"data-state":D.open?"open":"closed",disabled:L,"data-disabled":L?"":void 0,"data-placeholder":e5(D.value)?"":void 0,...C,ref:V,onClick:$t(C.onClick,q=>{q.currentTarget.focus(),W.current!=="mouse"&&re(q)}),onPointerDown:$t(C.onPointerDown,q=>{W.current=q.pointerType;const $=q.target;$.hasPointerCapture(q.pointerId)&&$.releasePointerCapture(q.pointerId),q.button===0&&q.ctrlKey===!1&&q.pointerType==="mouse"&&(re(q),q.preventDefault())}),onKeyDown:$t(C.onKeyDown,q=>{const $=K.current!=="";!(q.ctrlKey||q.altKey||q.metaKey)&&q.key.length===1&&ee(q.key),!($&&q.key===" ")&&Fne.includes(q.key)&&(re(),q.preventDefault())})})})});P4.displayName=O4;var D4="SelectValue",k4=j.forwardRef((u,f)=>{const{__scopeSelect:_,className:y,style:C,children:A,placeholder:D="",...L}=u,V=nu(D4,_),{onValueNodeHasChildrenChange:G}=V,W=A!==void 0,K=yr(f,V.onValueNodeChange);return oi(()=>{G(W)},[G,W]),T.jsx(En.span,{...L,ref:K,style:{pointerEvents:"none"},children:e5(V.value)?T.jsx(T.Fragment,{children:D}):A})});k4.displayName=D4;var zne="SelectIcon",L4=j.forwardRef((u,f)=>{const{__scopeSelect:_,children:y,...C}=u;return T.jsx(En.span,{"aria-hidden":!0,...C,ref:f,children:y||""})});L4.displayName=zne;var Yne="SelectPortal",x4=u=>T.jsx(qA,{asChild:!0,...u});x4.displayName=Yne;var Gh="SelectContent",M4=j.forwardRef((u,f)=>{const _=nu(Gh,u.__scopeSelect),[y,C]=j.useState();if(oi(()=>{C(new DocumentFragment)},[]),!_.open){const A=y;return A?gm.createPortal(T.jsx(U4,{scope:u.__scopeSelect,children:T.jsx(HR.Slot,{scope:u.__scopeSelect,children:T.jsx("div",{children:u.children})})}),A):null}return T.jsx(V4,{...u,ref:f})});M4.displayName=Gh;var Ma=10,[U4,ru]=Cm(Gh),qne="SelectContentImpl",Xne=Lg("SelectContent.RemoveScroll"),V4=j.forwardRef((u,f)=>{const{__scopeSelect:_,position:y="item-aligned",onCloseAutoFocus:C,onEscapeKeyDown:A,onPointerDownOutside:D,side:L,sideOffset:V,align:G,alignOffset:W,arrowPadding:K,collisionBoundary:ee,collisionPadding:X,sticky:re,hideWhenDetached:q,avoidCollisions:$,...ae}=u,oe=nu(Gh,_),[le,Se]=j.useState(null),[be,Ue]=j.useState(null),xe=yr(f,Ye=>Se(Ye)),[je,lt]=j.useState(null),[Et,ht]=j.useState(null),Ge=KR(_),[pt,Fe]=j.useState(!1),Ct=j.useRef(!1);j.useEffect(()=>{if(le)return rne(le)},[le]),zte();const nt=j.useCallback(Ye=>{const[At,...Wt]=Ge().map(Yn=>Yn.ref.current),[Kt]=Wt.slice(-1),Rn=document.activeElement;for(const Yn of Ye)if(Yn===Rn||(Yn?.scrollIntoView({block:"nearest"}),Yn===At&&be&&(be.scrollTop=0),Yn===Kt&&be&&(be.scrollTop=be.scrollHeight),Yn?.focus(),document.activeElement!==Rn))return},[Ge,be]),Je=j.useCallback(()=>nt([je,le]),[nt,je,le]);j.useEffect(()=>{pt&&Je()},[pt,Je]);const{onOpenChange:Oe,triggerPointerDownPosRef:ke}=oe;j.useEffect(()=>{if(le){let Ye={x:0,y:0};const At=Kt=>{Ye={x:Math.abs(Math.round(Kt.pageX)-(ke.current?.x??0)),y:Math.abs(Math.round(Kt.pageY)-(ke.current?.y??0))}},Wt=Kt=>{Ye.x<=10&&Ye.y<=10?Kt.preventDefault():le.contains(Kt.target)||Oe(!1),document.removeEventListener("pointermove",At),ke.current=null};return ke.current!==null&&(document.addEventListener("pointermove",At),document.addEventListener("pointerup",Wt,{capture:!0,once:!0})),()=>{document.removeEventListener("pointermove",At),document.removeEventListener("pointerup",Wt,{capture:!0})}}},[le,Oe,ke]),j.useEffect(()=>{const Ye=()=>Oe(!1);return window.addEventListener("blur",Ye),window.addEventListener("resize",Ye),()=>{window.removeEventListener("blur",Ye),window.removeEventListener("resize",Ye)}},[Oe]);const[ze,he]=t5(Ye=>{const At=Ge().filter(Rn=>!Rn.disabled),Wt=At.find(Rn=>Rn.ref.current===document.activeElement),Kt=n5(At,Ye,Wt);Kt&&setTimeout(()=>Kt.ref.current.focus())}),Ie=j.useCallback((Ye,At,Wt)=>{const Kt=!Ct.current&&!Wt;(oe.value!==void 0&&oe.value===At||Kt)&&(lt(Ye),Kt&&(Ct.current=!0))},[oe.value]),it=j.useCallback(()=>le?.focus(),[le]),rt=j.useCallback((Ye,At,Wt)=>{const Kt=!Ct.current&&!Wt;(oe.value!==void 0&&oe.value===At||Kt)&&ht(Ye)},[oe.value]),Ot=y==="popper"?FA:j4,Ht=Ot===FA?{side:L,sideOffset:V,align:G,alignOffset:W,arrowPadding:K,collisionBoundary:ee,collisionPadding:X,sticky:re,hideWhenDetached:q,avoidCollisions:$}:{};return T.jsx(U4,{scope:_,content:le,viewport:be,onViewportChange:Ue,itemRefCallback:Ie,selectedItem:je,onItemLeave:it,itemTextRefCallback:rt,focusSelectedItem:Je,selectedItemText:Et,position:y,isPositioned:pt,searchRef:ze,children:T.jsx(A4,{as:Xne,allowPinchZoom:!0,children:T.jsx(g4,{asChild:!0,trapped:oe.open,onMountAutoFocus:Ye=>{Ye.preventDefault()},onUnmountAutoFocus:$t(C,Ye=>{oe.trigger?.focus({preventScroll:!0}),Ye.preventDefault()}),children:T.jsx(CR,{asChild:!0,disableOutsidePointerEvents:!0,onEscapeKeyDown:A,onPointerDownOutside:D,onFocusOutside:Ye=>Ye.preventDefault(),onDismiss:()=>oe.onOpenChange(!1),children:T.jsx(Ot,{role:"listbox",id:oe.contentId,"data-state":oe.open?"open":"closed",dir:oe.dir,onContextMenu:Ye=>Ye.preventDefault(),...ae,...Ht,onPlaced:()=>Fe(!0),ref:xe,style:{display:"flex",flexDirection:"column",outline:"none",...ae.style},onKeyDown:$t(ae.onKeyDown,Ye=>{const At=Ye.ctrlKey||Ye.altKey||Ye.metaKey;if(Ye.key==="Tab"&&Ye.preventDefault(),!At&&Ye.key.length===1&&he(Ye.key),["ArrowUp","ArrowDown","Home","End"].includes(Ye.key)){let Kt=Ge().filter(Rn=>!Rn.disabled).map(Rn=>Rn.ref.current);if(["ArrowUp","End"].includes(Ye.key)&&(Kt=Kt.slice().reverse()),["ArrowUp","ArrowDown"].includes(Ye.key)){const Rn=Ye.target,Yn=Kt.indexOf(Rn);Kt=Kt.slice(Yn+1)}setTimeout(()=>nt(Kt)),Ye.preventDefault()}})})})})})})});V4.displayName=qne;var Jne="SelectItemAlignedPosition",j4=j.forwardRef((u,f)=>{const{__scopeSelect:_,onPlaced:y,...C}=u,A=nu(Gh,_),D=ru(Gh,_),[L,V]=j.useState(null),[G,W]=j.useState(null),K=yr(f,xe=>W(xe)),ee=KR(_),X=j.useRef(!1),re=j.useRef(!0),{viewport:q,selectedItem:$,selectedItemText:ae,focusSelectedItem:oe}=D,le=j.useCallback(()=>{if(A.trigger&&A.valueNode&&L&&G&&q&&$&&ae){const xe=A.trigger.getBoundingClientRect(),je=G.getBoundingClientRect(),lt=A.valueNode.getBoundingClientRect(),Et=ae.getBoundingClientRect();if(A.dir!=="rtl"){const Rn=Et.left-je.left,Yn=lt.left-Rn,er=xe.left-Yn,is=xe.width+er,Fa=Math.max(is,je.width),Ei=window.innerWidth-Ma,Zo=NF(Yn,[Ma,Math.max(Ma,Ei-Fa)]);L.style.minWidth=is+"px",L.style.left=Zo+"px"}else{const Rn=je.right-Et.right,Yn=window.innerWidth-lt.right-Rn,er=window.innerWidth-xe.right-Yn,is=xe.width+er,Fa=Math.max(is,je.width),Ei=window.innerWidth-Ma,Zo=NF(Yn,[Ma,Math.max(Ma,Ei-Fa)]);L.style.minWidth=is+"px",L.style.right=Zo+"px"}const ht=ee(),Ge=window.innerHeight-Ma*2,pt=q.scrollHeight,Fe=window.getComputedStyle(G),Ct=parseInt(Fe.borderTopWidth,10),nt=parseInt(Fe.paddingTop,10),Je=parseInt(Fe.borderBottomWidth,10),Oe=parseInt(Fe.paddingBottom,10),ke=Ct+nt+pt+Oe+Je,ze=Math.min($.offsetHeight*5,ke),he=window.getComputedStyle(q),Ie=parseInt(he.paddingTop,10),it=parseInt(he.paddingBottom,10),rt=xe.top+xe.height/2-Ma,Ot=Ge-rt,Ht=$.offsetHeight/2,Ye=$.offsetTop+Ht,At=Ct+nt+Ye,Wt=ke-At;if(At<=rt){const Rn=ht.length>0&&$===ht[ht.length-1].ref.current;L.style.bottom="0px";const Yn=G.clientHeight-q.offsetTop-q.offsetHeight,er=Math.max(Ot,Ht+(Rn?it:0)+Yn+Je),is=At+er;L.style.height=is+"px"}else{const Rn=ht.length>0&&$===ht[0].ref.current;L.style.top="0px";const er=Math.max(rt,Ct+q.offsetTop+(Rn?Ie:0)+Ht)+Wt;L.style.height=er+"px",q.scrollTop=At-rt+q.offsetTop}L.style.margin=`${Ma}px 0`,L.style.minHeight=ze+"px",L.style.maxHeight=Ge+"px",y?.(),requestAnimationFrame(()=>X.current=!0)}},[ee,A.trigger,A.valueNode,L,G,q,$,ae,A.dir,y]);oi(()=>le(),[le]);const[Se,be]=j.useState();oi(()=>{G&&be(window.getComputedStyle(G).zIndex)},[G]);const Ue=j.useCallback(xe=>{xe&&re.current===!0&&(le(),oe?.(),re.current=!1)},[le,oe]);return T.jsx(Zne,{scope:_,contentWrapper:L,shouldExpandOnScrollRef:X,onScrollButtonChange:Ue,children:T.jsx("div",{ref:V,style:{display:"flex",flexDirection:"column",position:"fixed",zIndex:Se},children:T.jsx(En.div,{...C,ref:K,style:{boxSizing:"border-box",maxHeight:"100%",...C.style}})})})});j4.displayName=Jne;var Qne="SelectPopperPosition",FA=j.forwardRef((u,f)=>{const{__scopeSelect:_,align:y="start",collisionPadding:C=Ma,...A}=u,D=zR(_);return T.jsx(o3,{...D,...A,ref:f,align:y,collisionPadding:C,style:{boxSizing:"border-box",...A.style,"--radix-select-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-select-content-available-width":"var(--radix-popper-available-width)","--radix-select-content-available-height":"var(--radix-popper-available-height)","--radix-select-trigger-width":"var(--radix-popper-anchor-width)","--radix-select-trigger-height":"var(--radix-popper-anchor-height)"}})});FA.displayName=Qne;var[Zne,CN]=Cm(Gh,{}),BA="SelectViewport",F4=j.forwardRef((u,f)=>{const{__scopeSelect:_,nonce:y,...C}=u,A=ru(BA,_),D=CN(BA,_),L=yr(f,A.onViewportChange),V=j.useRef(0);return T.jsxs(T.Fragment,{children:[T.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-select-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-select-viewport]::-webkit-scrollbar{display:none}"},nonce:y}),T.jsx(HR.Slot,{scope:_,children:T.jsx(En.div,{"data-radix-select-viewport":"",role:"presentation",...C,ref:L,style:{position:"relative",flex:1,overflow:"hidden auto",...C.style},onScroll:$t(C.onScroll,G=>{const W=G.currentTarget,{contentWrapper:K,shouldExpandOnScrollRef:ee}=D;if(ee?.current&&K){const X=Math.abs(V.current-W.scrollTop);if(X>0){const re=window.innerHeight-Ma*2,q=parseFloat(K.style.minHeight),$=parseFloat(K.style.height),ae=Math.max(q,$);if(ae<re){const oe=ae+X,le=Math.min(re,oe),Se=oe-le;K.style.height=le+"px",K.style.bottom==="0px"&&(W.scrollTop=Se>0?Se:0,K.style.justifyContent="flex-end")}}}V.current=W.scrollTop})})})]})});F4.displayName=BA;var B4="SelectGroup",[$ne,ere]=Cm(B4),tre=j.forwardRef((u,f)=>{const{__scopeSelect:_,...y}=u,C=Gg();return T.jsx($ne,{scope:_,id:C,children:T.jsx(En.div,{role:"group","aria-labelledby":C,...y,ref:f})})});tre.displayName=B4;var W4="SelectLabel",G4=j.forwardRef((u,f)=>{const{__scopeSelect:_,...y}=u,C=ere(W4,_);return T.jsx(En.div,{id:C.id,...y,ref:f})});G4.displayName=W4;var TR="SelectItem",[nre,H4]=Cm(TR),K4=j.forwardRef((u,f)=>{const{__scopeSelect:_,value:y,disabled:C=!1,textValue:A,...D}=u,L=nu(TR,_),V=ru(TR,_),G=L.value===y,[W,K]=j.useState(A??""),[ee,X]=j.useState(!1),re=yr(f,oe=>V.itemRefCallback?.(oe,y,C)),q=Gg(),$=j.useRef("touch"),ae=()=>{C||(L.onValueChange(y),L.onOpenChange(!1))};if(y==="")throw new Error("A <Select.Item /> must have a value prop that is not an empty string. This is because the Select value can be set to an empty string to clear the selection and show the placeholder.");return T.jsx(nre,{scope:_,value:y,disabled:C,textId:q,isSelected:G,onItemTextChange:j.useCallback(oe=>{K(le=>le||(oe?.textContent??"").trim())},[]),children:T.jsx(HR.ItemSlot,{scope:_,value:y,disabled:C,textValue:W,children:T.jsx(En.div,{role:"option","aria-labelledby":q,"data-highlighted":ee?"":void 0,"aria-selected":G&&ee,"data-state":G?"checked":"unchecked","aria-disabled":C||void 0,"data-disabled":C?"":void 0,tabIndex:C?void 0:-1,...D,ref:re,onFocus:$t(D.onFocus,()=>X(!0)),onBlur:$t(D.onBlur,()=>X(!1)),onClick:$t(D.onClick,()=>{$.current!=="mouse"&&ae()}),onPointerUp:$t(D.onPointerUp,()=>{$.current==="mouse"&&ae()}),onPointerDown:$t(D.onPointerDown,oe=>{$.current=oe.pointerType}),onPointerMove:$t(D.onPointerMove,oe=>{$.current=oe.pointerType,C?V.onItemLeave?.():$.current==="mouse"&&oe.currentTarget.focus({preventScroll:!0})}),onPointerLeave:$t(D.onPointerLeave,oe=>{oe.currentTarget===document.activeElement&&V.onItemLeave?.()}),onKeyDown:$t(D.onKeyDown,oe=>{V.searchRef?.current!==""&&oe.key===" "||(Bne.includes(oe.key)&&ae(),oe.key===" "&&oe.preventDefault())})})})})});K4.displayName=TR;var Og="SelectItemText",z4=j.forwardRef((u,f)=>{const{__scopeSelect:_,className:y,style:C,...A}=u,D=nu(Og,_),L=ru(Og,_),V=H4(Og,_),G=Kne(Og,_),[W,K]=j.useState(null),ee=yr(f,ae=>K(ae),V.onItemTextChange,ae=>L.itemTextRefCallback?.(ae,V.value,V.disabled)),X=W?.textContent,re=j.useMemo(()=>T.jsx("option",{value:V.value,disabled:V.disabled,children:X},V.value),[V.disabled,V.value,X]),{onNativeOptionAdd:q,onNativeOptionRemove:$}=G;return oi(()=>(q(re),()=>$(re)),[q,$,re]),T.jsxs(T.Fragment,{children:[T.jsx(En.span,{id:V.textId,...A,ref:ee}),V.isSelected&&D.valueNode&&!D.valueNodeHasChildren?gm.createPortal(A.children,D.valueNode):null]})});z4.displayName=Og;var Y4="SelectItemIndicator",q4=j.forwardRef((u,f)=>{const{__scopeSelect:_,...y}=u;return H4(Y4,_).isSelected?T.jsx(En.span,{"aria-hidden":!0,...y,ref:f}):null});q4.displayName=Y4;var WA="SelectScrollUpButton",X4=j.forwardRef((u,f)=>{const _=ru(WA,u.__scopeSelect),y=CN(WA,u.__scopeSelect),[C,A]=j.useState(!1),D=yr(f,y.onScrollButtonChange);return oi(()=>{if(_.viewport&&_.isPositioned){let L=function(){const G=V.scrollTop>0;A(G)};const V=_.viewport;return L(),V.addEventListener("scroll",L),()=>V.removeEventListener("scroll",L)}},[_.viewport,_.isPositioned]),C?T.jsx(Q4,{...u,ref:D,onAutoScroll:()=>{const{viewport:L,selectedItem:V}=_;L&&V&&(L.scrollTop=L.scrollTop-V.offsetHeight)}}):null});X4.displayName=WA;var GA="SelectScrollDownButton",J4=j.forwardRef((u,f)=>{const _=ru(GA,u.__scopeSelect),y=CN(GA,u.__scopeSelect),[C,A]=j.useState(!1),D=yr(f,y.onScrollButtonChange);return oi(()=>{if(_.viewport&&_.isPositioned){let L=function(){const G=V.scrollHeight-V.clientHeight,W=Math.ceil(V.scrollTop)<G;A(W)};const V=_.viewport;return L(),V.addEventListener("scroll",L),()=>V.removeEventListener("scroll",L)}},[_.viewport,_.isPositioned]),C?T.jsx(Q4,{...u,ref:D,onAutoScroll:()=>{const{viewport:L,selectedItem:V}=_;L&&V&&(L.scrollTop=L.scrollTop+V.offsetHeight)}}):null});J4.displayName=GA;var Q4=j.forwardRef((u,f)=>{const{__scopeSelect:_,onAutoScroll:y,...C}=u,A=ru("SelectScrollButton",_),D=j.useRef(null),L=KR(_),V=j.useCallback(()=>{D.current!==null&&(window.clearInterval(D.current),D.current=null)},[]);return j.useEffect(()=>()=>V(),[V]),oi(()=>{L().find(W=>W.ref.current===document.activeElement)?.ref.current?.scrollIntoView({block:"nearest"})},[L]),T.jsx(En.div,{"aria-hidden":!0,...C,ref:f,style:{flexShrink:0,...C.style},onPointerDown:$t(C.onPointerDown,()=>{D.current===null&&(D.current=window.setInterval(y,50))}),onPointerMove:$t(C.onPointerMove,()=>{A.onItemLeave?.(),D.current===null&&(D.current=window.setInterval(y,50))}),onPointerLeave:$t(C.onPointerLeave,()=>{V()})})}),rre="SelectSeparator",Z4=j.forwardRef((u,f)=>{const{__scopeSelect:_,...y}=u;return T.jsx(En.div,{"aria-hidden":!0,...y,ref:f})});Z4.displayName=rre;var HA="SelectArrow",ire=j.forwardRef((u,f)=>{const{__scopeSelect:_,...y}=u,C=zR(_),A=nu(HA,_),D=ru(HA,_);return A.open&&D.position==="popper"?T.jsx(a3,{...C,...y,ref:f}):null});ire.displayName=HA;var sre="SelectBubbleInput",$4=j.forwardRef(({__scopeSelect:u,value:f,..._},y)=>{const C=j.useRef(null),A=yr(y,C),D=u4(f);return j.useEffect(()=>{const L=C.current;if(!L)return;const V=window.HTMLSelectElement.prototype,W=Object.getOwnPropertyDescriptor(V,"value").set;if(D!==f&&W){const K=new Event("change",{bubbles:!0});W.call(L,f),L.dispatchEvent(K)}},[D,f]),T.jsx(En.select,{..._,style:{...XF,..._.style},ref:A,defaultValue:f})});$4.displayName=sre;function e5(u){return u===""||u===void 0}function t5(u){const f=_o(u),_=j.useRef(""),y=j.useRef(0),C=j.useCallback(D=>{const L=_.current+D;f(L),(function V(G){_.current=G,window.clearTimeout(y.current),G!==""&&(y.current=window.setTimeout(()=>V(""),1e3))})(L)},[f]),A=j.useCallback(()=>{_.current="",window.clearTimeout(y.current)},[]);return j.useEffect(()=>()=>window.clearTimeout(y.current),[]),[_,C,A]}function n5(u,f,_){const C=f.length>1&&Array.from(f).every(G=>G===f[0])?f[0]:f,A=_?u.indexOf(_):-1;let D=ore(u,Math.max(A,0));C.length===1&&(D=D.filter(G=>G!==_));const V=D.find(G=>G.textValue.toLowerCase().startsWith(C.toLowerCase()));return V!==_?V:void 0}function ore(u,f){return u.map((_,y)=>u[(f+y)%u.length])}var are=N4,r5=P4,cre=k4,lre=L4,dre=x4,i5=M4,ure=F4,s5=G4,o5=K4,hre=z4,pre=q4,a5=X4,c5=J4,l5=Z4;const fre=are,mre=cre,d5=j.forwardRef(({className:u,children:f,..._},y)=>T.jsxs(r5,{ref:y,className:Vn("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",u),..._,children:[f,T.jsx(lre,{asChild:!0,children:T.jsx(vB,{className:"h-4 w-4 opacity-50"})})]}));d5.displayName=r5.displayName;const u5=j.forwardRef(({className:u,...f},_)=>T.jsx(a5,{ref:_,className:Vn("flex cursor-default items-center justify-center py-1",u),...f,children:T.jsx(rJ,{className:"h-4 w-4"})}));u5.displayName=a5.displayName;const h5=j.forwardRef(({className:u,...f},_)=>T.jsx(c5,{ref:_,className:Vn("flex cursor-default items-center justify-center py-1",u),...f,children:T.jsx(vB,{className:"h-4 w-4"})}));h5.displayName=c5.displayName;const p5=j.forwardRef(({className:u,children:f,position:_="popper",...y},C)=>T.jsx(dre,{children:T.jsxs(i5,{ref:C,className:Vn("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",_==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",u),position:_,...y,children:[T.jsx(u5,{}),T.jsx(ure,{className:Vn("p-1",_==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:f}),T.jsx(h5,{})]})}));p5.displayName=i5.displayName;const _re=j.forwardRef(({className:u,...f},_)=>T.jsx(s5,{ref:_,className:Vn("py-1.5 pl-8 pr-2 text-sm font-semibold",u),...f}));_re.displayName=s5.displayName;const fR=j.forwardRef(({className:u,children:f,..._},y)=>T.jsxs(o5,{ref:y,className:Vn("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 focus:bg-accent focus:text-accent-foreground",u),..._,children:[T.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:T.jsx(pre,{children:T.jsx(nJ,{className:"h-4 w-4"})})}),T.jsx(hre,{children:f})]}));fR.displayName=o5.displayName;const Ere=j.forwardRef(({className:u,...f},_)=>T.jsx(l5,{ref:_,className:Vn("-mx-1 my-1 h-px bg-muted",u),...f}));Ere.displayName=l5.displayName;function gre(){const[u,f]=j.useState({reactions:!0,replies:!0,mentions:!1,trending:!0,digest:!1}),[_,y]=j.useState({showActivity:!1,allowDMs:!1,dataCollection:!0}),[C,A]=j.useState("24h"),{toast:D}=Bg(),L=()=>{D({title:"Settings Saved",description:"Your preferences have been updated successfully."})},V=()=>{D({title:"Account Deletion",description:"This feature will permanently delete your anonymous profile. Contact support if you need assistance.",variant:"destructive"})},G=()=>{D({title:"Data Export",description:"Your anonymous data export will be ready in a few minutes. We'll notify you when it's ready."})};return T.jsxs("div",{className:"min-h-screen bg-background pb-20 md:pb-8",children:[T.jsx(BR,{}),T.jsx("main",{className:"container mx-auto px-4 pt-20 max-w-2xl",children:T.jsxs("div",{className:"space-y-8",children:[T.jsxs("div",{className:"text-center space-y-2 animate-fade-in",children:[T.jsx("h1",{className:"text-3xl font-bold gradient-primary bg-clip-text text-transparent",children:"Settings"}),T.jsx("p",{className:"text-muted-foreground",children:"Customize your anonymous TeaTok experience"})]}),T.jsxs(Gn,{className:"tea-card animate-slide-in-right",children:[T.jsxs($r,{children:[T.jsxs(Bi,{className:"flex items-center space-x-2",children:[T.jsx(TB,{className:"h-5 w-5"}),T.jsx("span",{children:"Appearance"})]}),T.jsx(fo,{children:"Customize how TeaTok looks and feels"})]}),T.jsx(zn,{className:"space-y-4",children:T.jsxs("div",{className:"flex items-center justify-between",children:[T.jsxs("div",{children:[T.jsx("div",{className:"font-medium",children:"Theme"}),T.jsx("div",{className:"text-sm text-muted-foreground",children:"Choose your preferred theme"})]}),T.jsx(EN,{})]})})]}),T.jsxs(Gn,{className:"tea-card animate-slide-in-right",style:{animationDelay:"0.1s"},children:[T.jsxs($r,{children:[T.jsxs(Bi,{className:"flex items-center space-x-2",children:[T.jsx(tJ,{className:"h-5 w-5"}),T.jsx("span",{children:"Notifications"})]}),T.jsx(fo,{children:"Control what notifications you receive"})]}),T.jsx(zn,{className:"space-y-6",children:T.jsxs("div",{className:"space-y-4",children:[T.jsxs("div",{className:"flex items-center justify-between",children:[T.jsxs("div",{children:[T.jsx("div",{className:"font-medium",children:"Reactions on my posts"}),T.jsx("div",{className:"text-sm text-muted-foreground",children:"Get notified when someone reacts to your tea"})]}),T.jsx(jh,{checked:u.reactions,onCheckedChange:W=>f(K=>({...K,reactions:W}))})]}),T.jsxs("div",{className:"flex items-center justify-between",children:[T.jsxs("div",{children:[T.jsx("div",{className:"font-medium",children:"Replies to my posts"}),T.jsx("div",{className:"text-sm text-muted-foreground",children:"When someone responds to your spilled tea"})]}),T.jsx(jh,{checked:u.replies,onCheckedChange:W=>f(K=>({...K,replies:W}))})]}),T.jsxs("div",{className:"flex items-center justify-between",children:[T.jsxs("div",{children:[T.jsx("div",{className:"font-medium",children:"Trending posts"}),T.jsx("div",{className:"text-sm text-muted-foreground",children:"Hot tea from rooms you follow"})]}),T.jsx(jh,{checked:u.trending,onCheckedChange:W=>f(K=>({...K,trending:W}))})]}),T.jsxs("div",{className:"flex items-center justify-between",children:[T.jsxs("div",{children:[T.jsx("div",{className:"font-medium",children:"Daily digest"}),T.jsx("div",{className:"text-sm text-muted-foreground",children:"Summary of the hottest tea each day"})]}),T.jsx(jh,{checked:u.digest,onCheckedChange:W=>f(K=>({...K,digest:W}))})]})]})})]}),T.jsxs(Gn,{className:"tea-card animate-slide-in-right",style:{animationDelay:"0.2s"},children:[T.jsxs($r,{children:[T.jsxs(Bi,{className:"flex items-center space-x-2",children:[T.jsx(NR,{className:"h-5 w-5"}),T.jsx("span",{children:"Privacy & Safety"})]}),T.jsx(fo,{children:"Control your anonymity and safety settings"})]}),T.jsxs(zn,{className:"space-y-6",children:[T.jsxs("div",{className:"space-y-4",children:[T.jsxs("div",{className:"flex items-center justify-between",children:[T.jsxs("div",{children:[T.jsx("div",{className:"font-medium",children:"Show activity status"}),T.jsx("div",{className:"text-sm text-muted-foreground",children:"Let others see when you're active"})]}),T.jsx(jh,{checked:_.showActivity,onCheckedChange:W=>y(K=>({...K,showActivity:W}))})]}),T.jsxs("div",{className:"flex items-center justify-between",children:[T.jsxs("div",{children:[T.jsx("div",{className:"font-medium",children:"Anonymous data collection"}),T.jsx("div",{className:"text-sm text-muted-foreground",children:"Help improve TeaTok with anonymous usage data"})]}),T.jsx(jh,{checked:_.dataCollection,onCheckedChange:W=>y(K=>({...K,dataCollection:W}))})]})]}),T.jsxs("div",{className:"pt-4 border-t border-border",children:[T.jsx("h4",{className:"font-medium mb-3",children:"Content Preferences"}),T.jsx("div",{className:"space-y-3",children:T.jsxs("div",{children:[T.jsx("label",{className:"text-sm font-medium",children:"Default post duration"}),T.jsxs(fre,{value:C,onValueChange:A,children:[T.jsx(d5,{className:"mt-1",children:T.jsx(mre,{})}),T.jsxs(p5,{children:[T.jsx(fR,{value:"24h",children:"24 Hours"}),T.jsx(fR,{value:"7d",children:"7 Days"}),T.jsx(fR,{value:"permanent",children:"Permanent"})]})]})]})})]})]})]}),T.jsxs(Gn,{className:"tea-card animate-slide-in-right",style:{animationDelay:"0.3s"},children:[T.jsxs($r,{children:[T.jsxs(Bi,{className:"flex items-center space-x-2",children:[T.jsx(Bj,{className:"h-5 w-5"}),T.jsx("span",{children:"Data & Account"})]}),T.jsx(fo,{children:"Manage your data and account settings"})]}),T.jsx(zn,{className:"space-y-4",children:T.jsxs("div",{className:"space-y-3",children:[T.jsxs(Cn,{variant:"outline",className:"w-full justify-start",onClick:G,children:[T.jsx(Bj,{className:"h-4 w-4 mr-2"}),"Export My Data"]}),T.jsx("div",{className:"pt-4 border-t border-border",children:T.jsxs("div",{className:"flex items-start space-x-3 p-4 bg-destructive/10 border border-destructive/20 rounded-lg",children:[T.jsx(mJ,{className:"h-5 w-5 text-destructive mt-0.5"}),T.jsxs("div",{className:"flex-1 space-y-2",children:[T.jsx("h4",{className:"font-medium text-destructive",children:"Delete Account"}),T.jsx("p",{className:"text-sm text-muted-foreground",children:"Permanently delete your anonymous profile and all associated data. This action cannot be undone."}),T.jsxs(Cn,{variant:"destructive",size:"sm",onClick:V,className:"hover-scale",children:[T.jsx(fJ,{className:"h-4 w-4 mr-2"}),"Delete Account"]})]})]})})]})})]}),T.jsx(Gn,{className:"tea-card animate-slide-in-right",style:{animationDelay:"0.4s"},children:T.jsxs(zn,{className:"p-6 text-center space-y-4",children:[T.jsxs("div",{className:"space-y-2",children:[T.jsx("h3",{className:"font-semibold",children:"TeaTok v1.0.0"}),T.jsx("p",{className:"text-sm text-muted-foreground",children:"The anonymous social playground where you spill, sip, and connect."})]}),T.jsxs("div",{className:"flex justify-center space-x-4 text-sm",children:[T.jsx("button",{className:"text-muted-foreground hover:text-foreground transition-colors",children:"Terms of Service"}),T.jsx("button",{className:"text-muted-foreground hover:text-foreground transition-colors",children:"Privacy Policy"}),T.jsx("button",{className:"text-muted-foreground hover:text-foreground transition-colors",children:"Support"})]})]})}),T.jsx("div",{className:"flex justify-center pt-4 animate-fade-in",style:{animationDelay:"0.5s"},children:T.jsx(Cn,{onClick:L,className:"spill-button px-12 py-3 text-lg",children:"Save Settings"})})]})})]})}function vre(){const u=[{icon:AR,title:"Anonymous Expression",description:"Share your thoughts, gossip, and reviews without revealing your identity. Create personas and keep it mysterious."},{icon:yB,title:"Unique Reactions",description:"React with Tea , Spicy , or Cap . Express yourself beyond basic likes with our themed reaction system."},{icon:RB,title:"Topic Rooms",description:"Join themed communities for Movies, Gaming, Celebrity Gossip, Campus Tea, and more. Each room has its own vibe."},{icon:CB,title:"Instant Engagement",description:"Posts can have different lifespans - from 24-hour hot takes to permanent reviews. Choose how long your tea lives."},{icon:NR,title:"Safe & Moderated",description:"Smart moderation keeps the platform fun and safe. We're built for positive anonymous interactions."},{icon:cJ,title:"Community Driven",description:"Built by tea-spillers, for tea-spillers. Every feature is designed to make anonymous sharing fun and addictive."}];return T.jsx("div",{className:"min-h-screen bg-background",children:T.jsxs("div",{className:"container mx-auto px-4 py-8 max-w-4xl",children:[T.jsx("div",{className:"flex items-center justify-between mb-8 animate-fade-in",children:T.jsx(Cn,{variant:"ghost",asChild:!0,className:"flex items-center space-x-2",children:T.jsxs(ii,{to:"/",children:[T.jsx($A,{className:"h-4 w-4"}),T.jsx("span",{children:"Back to Home"})]})})}),T.jsxs("div",{className:"space-y-12",children:[T.jsxs("section",{className:"text-center space-y-6 animate-fade-in",children:[T.jsxs("div",{className:"flex justify-center",children:[T.jsx("img",{src:"/logo.png",alt:"TeaTok Logo",className:"hidden dark:block h-24 w-24 md:h-28 md:w-28 animate-float rounded object-contain"}),T.jsx("img",{src:"/logo-light.png",alt:"TeaTok Logo",className:"block dark:hidden h-24 w-24 md:h-28 md:w-28 animate-float rounded object-contain"})]}),T.jsxs("div",{className:"space-y-4",children:[T.jsx("h1",{className:"text-4xl md:text-5xl font-bold gradient-hero bg-clip-text text-transparent",children:"About TeaTok"}),T.jsx("p",{className:"text-xl text-muted-foreground max-w-2xl mx-auto",children:"The anonymous social playground where you spill gossip, drop reviews, and connect through tea, threads, and hot takes."})]})]}),T.jsx("section",{className:"animate-slide-in-right",children:T.jsx(Gn,{className:"tea-card gradient-hero text-white",children:T.jsxs(zn,{className:"p-8 text-center",children:[T.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Our Mission"}),T.jsx("p",{className:"text-lg text-white/90 leading-relaxed",children:"TeaTok reimagines social media by putting anonymity first. We believe the best conversations happen when people can express themselves freely without judgment. Whether you're spilling celebrity gossip, reviewing the latest blockbuster, or sharing campus drama, TeaTok is your safe space to be authentic."})]})})}),T.jsxs("section",{className:"animate-slide-in-right",style:{animationDelay:"0.1s"},children:[T.jsxs("div",{className:"text-center mb-8",children:[T.jsx("h2",{className:"text-3xl font-bold mb-4",children:"What Makes TeaTok Special"}),T.jsx("p",{className:"text-muted-foreground",children:"Every feature is designed to make anonymous sharing fun, safe, and addictive."})]}),T.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-6",children:u.map((f,_)=>T.jsxs(Gn,{className:"tea-card hover-lift",style:{animationDelay:`${_*.1}s`},children:[T.jsxs($r,{className:"text-center",children:[T.jsx("div",{className:"gradient-primary w-12 h-12 rounded-full flex items-center justify-center mx-auto mb-4",children:T.jsx(f.icon,{className:"h-6 w-6 text-primary-foreground"})}),T.jsx(Bi,{className:"text-lg",children:f.title})]}),T.jsx(zn,{children:T.jsx(fo,{className:"text-center",children:f.description})})]},f.title))})]}),T.jsx("section",{className:"animate-slide-in-right",style:{animationDelay:"0.2s"},children:T.jsxs(Gn,{className:"tea-card",children:[T.jsxs($r,{className:"text-center",children:[T.jsx(Bi,{className:"text-2xl",children:"How TeaTok Works"}),T.jsx(fo,{children:"Simple, anonymous, and addictive"})]}),T.jsx(zn,{className:"space-y-6",children:T.jsxs("div",{className:"grid md:grid-cols-3 gap-6",children:[T.jsxs("div",{className:"text-center space-y-3",children:[T.jsx("div",{className:"w-16 h-16 gradient-primary rounded-full flex items-center justify-center mx-auto text-2xl text-primary-foreground font-bold",children:"1"}),T.jsx("h3",{className:"font-semibold",children:"Choose Your Persona"}),T.jsx("p",{className:"text-sm text-muted-foreground",children:"Create anonymous aliases and personas. Be whoever you want to be."})]}),T.jsxs("div",{className:"text-center space-y-3",children:[T.jsx("div",{className:"w-16 h-16 gradient-accent rounded-full flex items-center justify-center mx-auto text-2xl text-accent-foreground font-bold",children:"2"}),T.jsx("h3",{className:"font-semibold",children:"Spill Your Tea"}),T.jsx("p",{className:"text-sm text-muted-foreground",children:"Share gossip, reviews, and hot takes in themed rooms. Text or voice - your choice."})]}),T.jsxs("div",{className:"text-center space-y-3",children:[T.jsx("div",{className:"w-16 h-16 gradient-warm rounded-full flex items-center justify-center mx-auto text-2xl text-white font-bold",children:"3"}),T.jsx("h3",{className:"font-semibold",children:"Watch It Brew"}),T.jsx("p",{className:"text-sm text-muted-foreground",children:"Get reactions, replies, and engage with the community. Watch your tea spread!"})]})]})})]})}),T.jsx("section",{className:"animate-slide-in-right",style:{animationDelay:"0.3s"},children:T.jsxs(Gn,{className:"tea-card",children:[T.jsxs($r,{className:"text-center",children:[T.jsx(Bi,{className:"text-2xl",children:"Our Values"}),T.jsx(fo,{children:"What we believe in"})]}),T.jsx(zn,{children:T.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[T.jsxs("div",{className:"space-y-3",children:[T.jsx("h3",{className:"font-semibold text-accent",children:"Authenticity Over Identity"}),T.jsx("p",{className:"text-sm text-muted-foreground",children:"Real thoughts and genuine expression matter more than who you are in real life."})]}),T.jsxs("div",{className:"space-y-3",children:[T.jsx("h3",{className:"font-semibold text-accent",children:"Fun Over Drama"}),T.jsx("p",{className:"text-sm text-muted-foreground",children:"We're here to spill tea and have fun, not to spread hate or toxicity."})]}),T.jsxs("div",{className:"space-y-3",children:[T.jsx("h3",{className:"font-semibold text-accent",children:"Community Over Clout"}),T.jsx("p",{className:"text-sm text-muted-foreground",children:"It's not about followers or fame - it's about connecting with people who get your vibe."})]}),T.jsxs("div",{className:"space-y-3",children:[T.jsx("h3",{className:"font-semibold text-accent",children:"Privacy Over Profit"}),T.jsx("p",{className:"text-sm text-muted-foreground",children:"Your anonymity is sacred. We'll never compromise your privacy for business gain."})]})]})})]})}),T.jsx("section",{className:"text-center space-y-6 animate-fade-in",style:{animationDelay:"0.4s"},children:T.jsx(Gn,{className:"tea-card gradient-hero text-white",children:T.jsxs(zn,{className:"p-8",children:[T.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Ready to spill some tea?"}),T.jsx("p",{className:"text-white/90 mb-6",children:"Join the community where your voice matters more than your name."}),T.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-center",children:[T.jsx(Cn,{asChild:!0,variant:"secondary",size:"lg",className:"hover-scale shadow-soft",children:T.jsx(ii,{to:"/auth",children:"Join TeaTok"})}),T.jsx(Cn,{asChild:!0,variant:"outline",size:"lg",className:"border-white/30 text-white hover:bg-white/10",children:T.jsx(ii,{to:"/feed",children:"Explore Feed"})})]})]})})})]})]})})}const yre=()=>{const u=Rm();return j.useEffect(()=>{console.error("404 Error: User attempted to access non-existent route:",u.pathname)},[u.pathname]),T.jsx("div",{className:"flex min-h-screen items-center justify-center bg-gray-100",children:T.jsxs("div",{className:"text-center",children:[T.jsx("h1",{className:"mb-4 text-4xl font-bold",children:"404"}),T.jsx("p",{className:"mb-4 text-xl text-gray-600",children:"Oops! Page not found"}),T.jsx("a",{href:"/",className:"text-blue-500 underline hover:text-blue-700",children:"Return to Home"})]})})};var mR={exports:{}},Sre=mR.exports,FF;function Tre(){return FF||(FF=1,(function(u,f){(function(_,y){u.exports=y()})(Sre,(function(){function _(e,t){return t.forEach((function(n){n&&typeof n!="string"&&!Array.isArray(n)&&Object.keys(n).forEach((function(r){if(r!=="default"&&!(r in e)){var i=Object.getOwnPropertyDescriptor(n,r);Object.defineProperty(e,r,i.get?i:{enumerable:!0,get:function(){return n[r]}})}}))})),Object.freeze(e)}var y=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof QI<"u"?QI:typeof self<"u"?self:{};function C(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var A=function(e){try{return!!e()}catch{return!0}},D=!A((function(){var e=(function(){}).bind();return typeof e!="function"||e.hasOwnProperty("prototype")})),L=D,V=Function.prototype,G=V.call,W=L&&V.bind.bind(G,G),K=L?W:function(e){return function(){return G.apply(e,arguments)}},ee=K({}.isPrototypeOf),X=function(e){return e&&e.Math===Math&&e},re=X(typeof globalThis=="object"&&globalThis)||X(typeof window=="object"&&window)||X(typeof self=="object"&&self)||X(typeof y=="object"&&y)||X(typeof y=="object"&&y)||(function(){return this})()||Function("return this")(),q=D,$=Function.prototype,ae=$.apply,oe=$.call,le=typeof Reflect=="object"&&Reflect.apply||(q?oe.bind(ae):function(){return oe.apply(ae,arguments)}),Se=K,be=Se({}.toString),Ue=Se("".slice),xe=function(e){return Ue(be(e),8,-1)},je=xe,lt=K,Et=function(e){if(je(e)==="Function")return lt(e)},ht=typeof document=="object"&&document.all,Ge=ht===void 0&&ht!==void 0?function(e){return typeof e=="function"||e===ht}:function(e){return typeof e=="function"},pt={},Fe=!A((function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!==7})),Ct=D,nt=Function.prototype.call,Je=Ct?nt.bind(nt):function(){return nt.apply(nt,arguments)},Oe={},ke={}.propertyIsEnumerable,ze=Object.getOwnPropertyDescriptor,he=ze&&!ke.call({1:2},1);Oe.f=he?function(e){var t=ze(this,e);return!!t&&t.enumerable}:ke;var Ie,it,rt=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},Ot=A,Ht=xe,Ye=Object,At=K("".split),Wt=Ot((function(){return!Ye("z").propertyIsEnumerable(0)}))?function(e){return Ht(e)==="String"?At(e,""):Ye(e)}:Ye,Kt=function(e){return e==null},Rn=Kt,Yn=TypeError,er=function(e){if(Rn(e))throw new Yn("Can't call method on "+e);return e},is=Wt,Fa=er,Ei=function(e){return is(Fa(e))},Zo=Ge,Sr=function(e){return typeof e=="object"?e!==null:Zo(e)},ai={},Eo=ai,Wi=re,Dl=Ge,Fs=function(e){return Dl(e)?e:void 0},Mr=function(e,t){return arguments.length<2?Fs(Eo[e])||Fs(Wi[e]):Eo[e]&&Eo[e][t]||Wi[e]&&Wi[e][t]},iu=re.navigator,gi=iu&&iu.userAgent,ei=gi?String(gi):"",Wc=re,kl=ei,Bs=Wc.process,Ba=Wc.Deno,su=Bs&&Bs.versions||Ba&&Ba.version,Gc=su&&su.v8;Gc&&(it=(Ie=Gc.split("."))[0]>0&&Ie[0]<4?1:+(Ie[0]+Ie[1])),!it&&kl&&(!(Ie=kl.match(/Edge\/(\d+)/))||Ie[1]>=74)&&(Ie=kl.match(/Chrome\/(\d+)/))&&(it=+Ie[1]);var Oi=it,ou=Oi,go=A,au=re.String,vo=!!Object.getOwnPropertySymbols&&!go((function(){var e=Symbol("symbol detection");return!au(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&ou&&ou<41})),Hc=vo&&!Symbol.sham&&typeof Symbol.iterator=="symbol",Ll=Mr,Wa=Ge,yo=ee,Ws=Object,Ga=Hc?function(e){return typeof e=="symbol"}:function(e){var t=Ll("Symbol");return Wa(t)&&yo(t.prototype,Ws(e))},Yt=String,gn=function(e){try{return Yt(e)}catch{return"Object"}},qn=Ge,Pi=gn,Gi=TypeError,Xn=function(e){if(qn(e))return e;throw new Gi(Pi(e)+" is not a function")},Gs=Xn,ci=Kt,ss=function(e,t){var n=e[t];return ci(n)?void 0:Gs(n)},xl=Je,cu=Ge,lu=Sr,wm=TypeError,Yg={exports:{}},qg=re,YR=Object.defineProperty,Kc=re,Xg=function(e,t){try{YR(qg,e,{value:t,configurable:!0,writable:!0})}catch{qg[e]=t}return t},bm="__core-js_shared__",Jg=Yg.exports=Kc[bm]||Xg(bm,{});(Jg.versions||(Jg.versions=[])).push({version:"3.42.0",mode:"pure",copyright:" 2014-2025 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.42.0/LICENSE",source:"https://github.com/zloirock/core-js"});var zh=Yg.exports,Im=zh,zc=function(e,t){return Im[e]||(Im[e]=t||{})},Qg=er,qR=Object,So=function(e){return qR(Qg(e))},Ir=So,XR=K({}.hasOwnProperty),Tr=Object.hasOwn||function(e,t){return XR(Ir(e),t)},Zg=K,Yh=0,JR=Math.random(),$g=Zg(1 .toString),Ml=function(e){return"Symbol("+(e===void 0?"":e)+")_"+$g(++Yh+JR,36)},To=zc,ev=Tr,Hs=Ml,QR=vo,ZR=Hc,Ul=re.Symbol,Vl=To("wks"),qh=ZR?Ul.for||Ul:Ul&&Ul.withoutSetter||Hs,kn=function(e){return ev(Vl,e)||(Vl[e]=QR&&ev(Ul,e)?Ul[e]:qh("Symbol."+e)),Vl[e]},Xh=Je,tv=Sr,nv=Ga,Am=ss,rv=function(e,t){var n,r;if(cu(n=e.toString)&&!lu(r=xl(n,e))||cu(n=e.valueOf)&&!lu(r=xl(n,e)))return r;throw new wm("Can't convert object to primitive value")},Nm=TypeError,du=kn("toPrimitive"),$R=function(e,t){if(!tv(e)||nv(e))return e;var n,r=Am(e,du);if(r){if(n=Xh(r,e,t),!tv(n)||nv(n))return n;throw new Nm("Can't convert object to primitive value")}return rv(e)},Om=Ga,Ln=function(e){var t=$R(e,"string");return Om(t)?t:t+""},Pm=Sr,Jh=re.document,Dm=Pm(Jh)&&Pm(Jh.createElement),Qh=function(e){return Dm?Jh.createElement(e):{}},iv=Qh,km=!Fe&&!A((function(){return Object.defineProperty(iv("div"),"a",{get:function(){return 7}}).a!==7})),Lm=Fe,Zh=Je,Ha=Oe,Ka=rt,za=Ei,uu=Ln,hu=Tr,Ya=km,sv=Object.getOwnPropertyDescriptor;pt.f=Lm?sv:function(e,t){if(e=za(e),t=uu(t),Ya)try{return sv(e,t)}catch{}if(hu(e,t))return Ka(!Zh(Ha.f,e,t),e[t])};var ov=A,pu=Ge,eC=/#|\.prototype\./,jl=function(e,t){var n=av[$h(e)];return n===fu||n!==tC&&(pu(t)?ov(t):!!t)},$h=jl.normalize=function(e){return String(e).replace(eC,".").toLowerCase()},av=jl.data={},tC=jl.NATIVE="N",fu=jl.POLYFILL="P",Fl=jl,Bl=Xn,ep=D,nC=Et(Et.bind),qa=function(e,t){return Bl(e),t===void 0?e:ep?nC(e,t):function(){return e.apply(t,arguments)}},Hi={},mu=Fe&&A((function(){return Object.defineProperty((function(){}),"prototype",{value:42,writable:!1}).prototype!==42})),xm=Sr,cv=String,Xa=TypeError,li=function(e){if(xm(e))return e;throw new Xa(cv(e)+" is not an object")},tp=Fe,lv=km,np=mu,Yc=li,Mm=Ln,os=TypeError,Ja=Object.defineProperty,Um=Object.getOwnPropertyDescriptor,qc="enumerable",Vm="configurable",_u="writable";Hi.f=tp?np?function(e,t,n){if(Yc(e),t=Mm(t),Yc(n),typeof e=="function"&&t==="prototype"&&"value"in n&&_u in n&&!n[_u]){var r=Um(e,t);r&&r[_u]&&(e[t]=n.value,n={configurable:Vm in n?n[Vm]:r[Vm],enumerable:qc in n?n[qc]:r[qc],writable:!1})}return Ja(e,t,n)}:Ja:function(e,t,n){if(Yc(e),t=Mm(t),Yc(n),lv)try{return Ja(e,t,n)}catch{}if("get"in n||"set"in n)throw new os("Accessors not supported");return"value"in n&&(e[t]=n.value),e};var jm=Hi,Eu=rt,Ro=Fe?function(e,t,n){return jm.f(e,t,Eu(1,n))}:function(e,t,n){return e[t]=n,e},Wl=re,rC=le,iC=Et,sC=Ge,Fm=pt.f,oC=Fl,Gl=ai,aC=qa,Hl=Ro,dv=Tr,uv=function(e){var t=function(n,r,i){if(this instanceof t){switch(arguments.length){case 0:return new e;case 1:return new e(n);case 2:return new e(n,r)}return new e(n,r,i)}return rC(e,this,arguments)};return t.prototype=e.prototype,t},Jt=function(e,t){var n,r,i,s,o,c,l,h,p,E=e.target,g=e.global,v=e.stat,O=e.proto,I=g?Wl:v?Wl[E]:Wl[E]&&Wl[E].prototype,N=g?Gl:Gl[E]||Hl(Gl,E,{})[E],M=N.prototype;for(s in t)r=!(n=oC(g?s:E+(v?".":"#")+s,e.forced))&&I&&dv(I,s),c=N[s],r&&(l=e.dontCallGetSet?(p=Fm(I,s))&&p.value:I[s]),o=r&&l?l:t[s],(n||O||typeof c!=typeof o)&&(h=e.bind&&r?aC(o,Wl):e.wrap&&r?uv(o):O&&sC(o)?iC(o):o,(e.sham||o&&o.sham||c&&c.sham)&&Hl(h,"sham",!0),Hl(N,s,h),O&&(dv(Gl,i=E+"Prototype")||Hl(Gl,i,{}),Hl(Gl[i],s,o),e.real&&M&&(n||!M[s])&&Hl(M,s,o)))},cC=Math.ceil,lC=Math.floor,dC=Math.trunc||function(e){var t=+e;return(t>0?lC:cC)(t)},Bm=dC,Wm=function(e){var t=+e;return t!=t||t===0?0:Bm(t)},uC=Wm,hC=Math.max,hv=Math.min,Gm=function(e,t){var n=uC(e);return n<0?hC(n+t,0):hv(n,t)},pC=Wm,fC=Math.min,pv=function(e){var t=pC(e);return t>0?fC(t,9007199254740991):0},mC=pv,Qa=function(e){return mC(e.length)},_C=Ei,Hm=Gm,gu=Qa,fv=function(e){return function(t,n,r){var i=_C(t),s=gu(i);if(s===0)return!e&&-1;var o,c=Hm(r,s);if(e&&n!=n){for(;s>c;)if((o=i[c++])!=o)return!0}else for(;s>c;c++)if((e||c in i)&&i[c]===n)return e||c||0;return!e&&-1}},rp={includes:fv(!0),indexOf:fv(!1)},mv=rp.includes;Jt({target:"Array",proto:!0,forced:A((function(){return!Array(1).includes()}))},{includes:function(e){return mv(this,e,arguments.length>1?arguments[1]:void 0)}});var _v=re,Ev=ai,as=function(e,t){var n=Ev[e+"Prototype"],r=n&&n[t];if(r)return r;var i=_v[e],s=i&&i.prototype;return s&&s[t]},Kl=as("Array","includes"),EC=Sr,gC=xe,vC=kn("match"),Km=function(e){var t;return EC(e)&&((t=e[vC])!==void 0?!!t:gC(e)==="RegExp")},gv=Km,vu=TypeError,zl={};zl[kn("toStringTag")]="z";var zm=String(zl)==="[object z]",ip=zm,yC=Ge,yu=xe,Ym=kn("toStringTag"),qm=Object,vv=yu((function(){return arguments})())==="Arguments",$o=ip?yu:function(e){var t,n,r;return e===void 0?"Undefined":e===null?"Null":typeof(n=(function(i,s){try{return i[s]}catch{}})(t=qm(e),Ym))=="string"?n:vv?yu(t):(r=yu(t))==="Object"&&yC(t.callee)?"Arguments":r},yv=$o,SC=String,Ki=function(e){if(yv(e)==="Symbol")throw new TypeError("Cannot convert a Symbol value to a string");return SC(e)},TC=kn("match"),RC=Jt,CC=function(e){if(gv(e))throw new vu("The method doesn't accept regular expressions");return e},Ks=er,Yl=Ki,Sv=function(e){var t=/./;try{"/./"[e](t)}catch{try{return t[TC]=!1,"/./"[e](t)}catch{}}return!1},Tv=K("".indexOf);RC({target:"String",proto:!0,forced:!Sv("includes")},{includes:function(e){return!!~Tv(Yl(Ks(this)),Yl(CC(e)),arguments.length>1?arguments[1]:void 0)}});var Rv=as("String","includes"),Xm=ee,Jm=Kl,wC=Rv,Qm=Array.prototype,Za=String.prototype,Zm=function(e){var t=e.includes;return e===Qm||Xm(Qm,e)&&t===Qm.includes?Jm:typeof e=="string"||e===Za||Xm(Za,e)&&t===Za.includes?wC:t},Re=C(Zm),$m=Xn,Cv=So,sp=Wt,ql=Qa,op=TypeError,e_="Reduce of empty array with no initial value",ap=function(e){return function(t,n,r,i){var s=Cv(t),o=sp(s),c=ql(s);if($m(n),c===0&&r<2)throw new op(e_);var l=e?c-1:0,h=e?-1:1;if(r<2)for(;;){if(l in o){i=o[l],l+=h;break}if(l+=h,e?l<0:c<=l)throw new op(e_)}for(;e?l>=0:c>l;l+=h)l in o&&(i=n(i,o[l],l,s));return i}},wv={left:ap(!1)},bv=A,Su=function(e,t){var n=[][e];return!!n&&bv((function(){n.call(null,t||function(){return 1},1)}))},Xl=re,Iv=ei,Av=xe,zs=function(e){return Iv.slice(0,e.length)===e},Tu=zs("Bun/")?"BUN":zs("Cloudflare-Workers")?"CLOUDFLARE":zs("Deno/")?"DENO":zs("Node.js/")?"NODE":Xl.Bun&&typeof Bun.version=="string"?"BUN":Xl.Deno&&typeof Deno.version=="object"?"DENO":Av(Xl.process)==="process"?"NODE":Xl.window&&Xl.document?"BROWSER":"REST",Jl=Tu==="NODE",bC=wv.left;Jt({target:"Array",proto:!0,forced:!Jl&&Oi>79&&Oi<83||!Su("reduce")},{reduce:function(e){var t=arguments.length;return bC(this,e,t,t>1?arguments[1]:void 0)}});var IC=as("Array","reduce"),Ru=ee,AC=IC,cp=Array.prototype,Nv=function(e){var t=e.reduce;return e===cp||Ru(cp,e)&&t===cp.reduce?AC:t},tr=Nv,zi=C(tr),lp=xe,ea=Array.isArray||function(e){return lp(e)==="Array"},Ov=Jt,t_=ea,Cu=K([].reverse),wu=[1,2];Ov({target:"Array",proto:!0,forced:String(wu)===String(wu.reverse())},{reverse:function(){return t_(this)&&(this.length=this.length),Cu(this)}});var Ql=as("Array","reverse"),Pv=ee,NC=Ql,n_=Array.prototype,Dv=function(e){var t=e.reverse;return e===n_||Pv(n_,e)&&t===n_.reverse?NC:t},bu=Dv,Iu=C(bu),r_=Ml,dp=zc("keys"),Zl=function(e){return dp[e]||(dp[e]=r_(e))},i_=!A((function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype})),OC=Tr,kv=Ge,PC=So,DC=i_,up=Zl("IE_PROTO"),Co=Object,Lv=Co.prototype,$a=DC?Co.getPrototypeOf:function(e){var t=PC(e);if(OC(t,up))return t[up];var n=t.constructor;return kv(n)&&t instanceof n?n.prototype:t instanceof Co?Lv:null},wo=K,Au=Xn,ta=Sr,s_=function(e){return ta(e)||e===null},kC=String,LC=TypeError,Xc=function(e,t,n){try{return wo(Au(Object.getOwnPropertyDescriptor(e,t)[n]))}catch{}},Nu=Sr,$l=er,hp=function(e){if(s_(e))return e;throw new LC("Can't set "+kC(e)+" as a prototype")},o_=Object.setPrototypeOf||("__proto__"in{}?(function(){var e,t=!1,n={};try{(e=Xc(Object.prototype,"__proto__","set"))(n,[]),t=n instanceof Array}catch{}return function(r,i){return $l(r),hp(i),Nu(r)&&(t?e(r,i):r.__proto__=i),r}})():void 0),na={},Ys={},Jn=Tr,nr=Ei,ec=rp.indexOf,vi=Ys,Di=K([].push),tc=function(e,t){var n,r=nr(e),i=0,s=[];for(n in r)!Jn(vi,n)&&Jn(r,n)&&Di(s,n);for(;t.length>i;)Jn(r,n=t[i++])&&(~ec(s,n)||Di(s,n));return s},nc=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],Yi=tc,pp=nc.concat("length","prototype");na.f=Object.getOwnPropertyNames||function(e){return Yi(e,pp)};var ed={};ed.f=Object.getOwnPropertySymbols;var xv=Mr,fp=na,Mv=ed,ra=li,mp=K([].concat),a_=xv("Reflect","ownKeys")||function(e){var t=fp.f(ra(e)),n=Mv.f;return n?mp(t,n(e)):t},c_=Tr,xC=a_,rc=pt,td=Hi,ic={},_p=tc,Ep=nc,ki=Object.keys||function(e){return _p(e,Ep)},vs=Fe,Jc=mu,ia=Hi,sa=li,Qc=Ei,Uv=ki;ic.f=vs&&!Jc?Object.defineProperties:function(e,t){sa(e);for(var n,r=Qc(t),i=Uv(t),s=i.length,o=0;s>o;)ia.f(e,n=i[o++],r[n]);return e};var nd,gp=Mr("document","documentElement"),cs=li,ls=ic,or=nc,qs=Ys,Vv=gp,jv=Qh,Ou="prototype",Pu="script",l_=Zl("IE_PROTO"),rd=function(){},d_=function(e){return"<"+Pu+">"+e+"</"+Pu+">"},Zc=function(e){e.write(d_("")),e.close();var t=e.parentWindow.Object;return e=null,t},id=function(){try{nd=new ActiveXObject("htmlfile")}catch{}var e,t,n;id=typeof document<"u"?document.domain&&nd?Zc(nd):(t=jv("iframe"),n="java"+Pu+":",t.style.display="none",Vv.appendChild(t),t.src=String(n),(e=t.contentWindow.document).open(),e.write(d_("document.F=Object")),e.close(),e.F):Zc(nd);for(var r=or.length;r--;)delete id[Ou][or[r]];return id()};qs[l_]=!0;var Du=Object.create||function(e,t){var n;return e!==null?(rd[Ou]=cs(e),n=new rd,rd[Ou]=null,n[l_]=e):n=id(),t===void 0?n:ls.f(n,t)},ku=Sr,vp=Ro,u_=Error,Fv=K("".replace),sd=String(new u_("zxcasd").stack),h_=/\n\s*at [^:]*:[^\n]*/,yp=h_.test(sd),Sp=rt,od=!A((function(){var e=new Error("a");return!("stack"in e)||(Object.defineProperty(e,"stack",Sp(1,7)),e.stack!==7)})),p_=Ro,f_=function(e,t){if(yp&&typeof e=="string"&&!u_.prepareStackTrace)for(;t--;)e=Fv(e,h_,"");return e},m_=od,Tp=Error.captureStackTrace,Xs={},ys=Xs,$c=kn("iterator"),__=Array.prototype,E_=function(e){return e!==void 0&&(ys.Array===e||__[$c]===e)},oa=$o,aa=ss,g_=Kt,Bv=Xs,ca=kn("iterator"),Js=function(e){if(!g_(e))return aa(e,ca)||aa(e,"@@iterator")||Bv[oa(e)]},Rp=Je,Wv=Xn,Cp=li,Gv=gn,Lu=Js,bo=TypeError,el=function(e,t){var n=arguments.length<2?Lu(e):t;if(Wv(n))return Cp(Rp(n,e));throw new bo(Gv(e)+" is not iterable")},xu=Je,sc=li,v_=ss,tl=function(e,t,n){var r,i;sc(e);try{if(!(r=v_(e,"return"))){if(t==="throw")throw n;return n}r=xu(r,e)}catch(s){i=!0,r=s}if(t==="throw")throw n;if(i)throw r;return sc(r),n},Hv=qa,y_=Je,fr=li,wp=gn,S_=E_,T_=Qa,Mu=ee,R_=el,nl=Js,ur=tl,Gr=TypeError,Ar=function(e,t){this.stopped=e,this.result=t},Uu=Ar.prototype,la=function(e,t,n){var r,i,s,o,c,l,h,p=n&&n.that,E=!(!n||!n.AS_ENTRIES),g=!(!n||!n.IS_RECORD),v=!(!n||!n.IS_ITERATOR),O=!(!n||!n.INTERRUPTED),I=Hv(t,p),N=function(x){return r&&ur(r,"normal",x),new Ar(!0,x)},M=function(x){return E?(fr(x),O?I(x[0],x[1],N):I(x[0],x[1])):O?I(x,N):I(x)};if(g)r=e.iterator;else if(v)r=e;else{if(!(i=nl(e)))throw new Gr(wp(e)+" is not iterable");if(S_(i)){for(s=0,o=T_(e);o>s;s++)if((c=M(e[s]))&&Mu(Uu,c))return c;return new Ar(!1)}r=R_(e,i)}for(l=g?e.next:r.next;!(h=y_(l,r)).done;){try{c=M(h.value)}catch(x){ur(r,"throw",x)}if(typeof c=="object"&&c&&Mu(Uu,c))return c}return new Ar(!1)},Vu=Ki,MC=Jt,yi=ee,C_=$a,ad=o_,w_=function(e,t,n){for(var r=xC(t),i=td.f,s=rc.f,o=0;o<r.length;o++){var c=r[o];c_(e,c)||n&&c_(n,c)||i(e,c,s(t,c))}},Qs=Du,qi=Ro,rl=rt,b_=function(e,t){ku(t)&&"cause"in t&&vp(e,"cause",t.cause)},I_=function(e,t,n,r){m_&&(Tp?Tp(e,t):p_(e,"stack",f_(n,r)))},Kv=la,zv=function(e,t){return e===void 0?arguments.length<2?"":t:Vu(e)},Yv=kn("toStringTag"),ju=Error,qv=[].push,il=function(e,t){var n,r=yi(bp,this);ad?n=ad(new ju,r?C_(this):bp):(n=r?this:Qs(bp),qi(n,Yv,"Error")),t!==void 0&&qi(n,"message",zv(t)),I_(n,il,n.stack,1),arguments.length>2&&b_(n,arguments[2]);var i=[];return Kv(e,qv,{that:i}),qi(n,"errors",i),n};ad?ad(il,ju):w_(il,ju,{name:!0});var bp=il.prototype=Qs(ju.prototype,{constructor:rl(1,il),message:rl(1,""),name:rl(1,"AggregateError")});MC({global:!0},{AggregateError:il});var Fu,da,Bu,Ip=Ge,Wu=re.WeakMap,Xv=Ip(Wu)&&/native code/.test(String(Wu)),Ap=re,Jv=Sr,Qv=Ro,Np=Tr,Op=zh,A_=Zl,Zv=Ys,N_="Object already initialized",Pp=Ap.TypeError,UC=Ap.WeakMap;if(Xv||Op.state){var Zs=Op.state||(Op.state=new UC);Zs.get=Zs.get,Zs.has=Zs.has,Zs.set=Zs.set,Fu=function(e,t){if(Zs.has(e))throw new Pp(N_);return t.facade=e,Zs.set(e,t),t},da=function(e){return Zs.get(e)||{}},Bu=function(e){return Zs.has(e)}}else{var cd=A_("state");Zv[cd]=!0,Fu=function(e,t){if(Np(e,cd))throw new Pp(N_);return t.facade=e,Qv(e,cd,t),t},da=function(e){return Np(e,cd)?e[cd]:{}},Bu=function(e){return Np(e,cd)}}var sl,O_,P_,oc={set:Fu,get:da,has:Bu,enforce:function(e){return Bu(e)?da(e):Fu(e,{})},getterFor:function(e){return function(t){var n;if(!Jv(t)||(n=da(t)).type!==e)throw new Pp("Incompatible receiver, "+e+" required");return n}}},ld=Fe,VC=Tr,$v=Function.prototype,jC=ld&&Object.getOwnPropertyDescriptor,Ss=VC($v,"name"),Dp={PROPER:Ss&&(function(){}).name==="something",CONFIGURABLE:Ss&&(!ld||ld&&jC($v,"name").configurable)},kp=Ro,ua=function(e,t,n,r){return r&&r.enumerable?e[t]=n:kp(e,t,n),e},ey=A,ty=Ge,D_=Sr,dd=Du,Lp=$a,k_=ua,L_=kn("iterator"),x_=!1;[].keys&&("next"in(P_=[].keys())?(O_=Lp(Lp(P_)))!==Object.prototype&&(sl=O_):x_=!0);var ny=!D_(sl)||ey((function(){var e={};return sl[L_].call(e)!==e}));ty((sl=ny?{}:dd(sl))[L_])||k_(sl,L_,(function(){return this}));var M_={IteratorPrototype:sl,BUGGY_SAFARI_ITERATORS:x_},ry=$o,iy=zm?{}.toString:function(){return"[object "+ry(this)+"]"},FC=zm,Xi=Hi.f,Li=Ro,sy=Tr,oy=iy,U_=kn("toStringTag"),Io=function(e,t,n,r){var i=n?e:e&&e.prototype;i&&(sy(i,U_)||Xi(i,U_,{configurable:!0,value:t}),r&&!FC&&Li(i,"toString",oy))},ay=M_.IteratorPrototype,V_=Du,cy=rt,j_=Io,ly=Xs,dy=function(){return this},Gu=function(e,t,n,r){var i=t+" Iterator";return e.prototype=V_(ay,{next:cy(+!r,n)}),j_(e,i,!1,!0),ly[i]=dy,e},F_=Jt,uy=Je,B_=Dp,xp=Gu,BC=$a,hy=Io,Mp=ua,W_=Xs,Up=M_,ha=B_.PROPER,Vp=Up.BUGGY_SAFARI_ITERATORS,jp=kn("iterator"),Fp="keys",Hu="values",G_="entries",Ku=function(){return this},di=function(e,t,n,r,i,s,o){xp(n,t,r);var c,l,h,p=function(M){if(M===i&&I)return I;if(!Vp&&M&&M in v)return v[M];switch(M){case Fp:case Hu:case G_:return function(){return new n(this,M)}}return function(){return new n(this)}},E=t+" Iterator",g=!1,v=e.prototype,O=v[jp]||v["@@iterator"]||i&&v[i],I=!Vp&&O||p(i),N=t==="Array"&&v.entries||O;if(N&&(c=BC(N.call(new e)))!==Object.prototype&&c.next&&(hy(c,E,!0,!0),W_[E]=Ku),ha&&i===Hu&&O&&O.name!==Hu&&(g=!0,I=function(){return uy(O,this)}),i)if(l={values:p(Hu),keys:s?I:p(Fp),entries:p(G_)},o)for(h in l)(Vp||g||!(h in v))&&Mp(v,h,l[h]);else F_({target:t,proto:!0,forced:Vp||g},l);return o&&v[jp]!==I&&Mp(v,jp,I,{}),W_[t]=I,l},Bp=function(e,t){return{value:e,done:t}},WC=Ei,zu=Xs,ui=oc;Hi.f;var GC=di,_t=Bp,ol="Array Iterator",H_=ui.set,py=ui.getterFor(ol);GC(Array,"Array",(function(e,t){H_(this,{type:ol,target:WC(e),index:0,kind:t})}),(function(){var e=py(this),t=e.target,n=e.index++;if(!t||n>=t.length)return e.target=null,_t(void 0,!0);switch(e.kind){case"keys":return _t(n,!1);case"values":return _t(t[n],!1)}return _t([n,t[n]],!1)}),"values"),zu.Arguments=zu.Array;var HC=Hi,ac=function(e,t,n){return HC.f(e,t,n)},Wp=Mr,K_=ac,fy=Fe,z_=kn("species"),my=ee,Y_=TypeError,Yu=function(e,t){if(my(t,e))return e;throw new Y_("Incorrect invocation")},hi=Ge,ds=zh,cc=K(Function.toString);hi(ds.inspectSource)||(ds.inspectSource=function(e){return cc(e)});var q_=ds.inspectSource,_y=K,$s=A,X_=Ge,Ao=$o,KC=q_,J_=function(){},Q_=Mr("Reflect","construct"),Gp=/^\s*(?:class|function)\b/,Ey=_y(Gp.exec),zC=!Gp.test(J_),lc=function(e){if(!X_(e))return!1;try{return Q_(J_,[],e),!0}catch{return!1}},Hp=function(e){if(!X_(e))return!1;switch(Ao(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return zC||!!Ey(Gp,KC(e))}catch{return!0}};Hp.sham=!0;var Si,pn,Hr,Rr,Ur=!Q_||$s((function(){var e;return lc(lc.call)||!lc(Object)||!lc((function(){e=!0}))||e}))?Hp:lc,us=Ur,ud=gn,Kr=TypeError,hd=li,al=function(e){if(us(e))return e;throw new Kr(ud(e)+" is not a constructor")},Kp=Kt,Z_=kn("species"),cl=function(e,t){var n,r=hd(e).constructor;return r===void 0||Kp(n=hd(r)[Z_])?t:al(n)},Nr=K([].slice),$_=TypeError,Ts=function(e,t){if(e<t)throw new $_("Not enough arguments");return e},No=/(?:ipad|iphone|ipod).*applewebkit/i.test(ei),Ti=re,eE=le,dc=qa,qu=Ge,uc=Tr,Xu=A,pd=gp,tE=Nr,Ju=Qh,zp=Ts,xi=No,hc=Jl,hs=Ti.setImmediate,Ri=Ti.clearImmediate,gy=Ti.process,Qu=Ti.Dispatch,nE=Ti.Function,vy=Ti.MessageChannel,pc=Ti.String,Yp=0,ll={},fc="onreadystatechange";Xu((function(){Si=Ti.location}));var Zu=function(e){if(uc(ll,e)){var t=ll[e];delete ll[e],t()}},pa=function(e){return function(){Zu(e)}},rE=function(e){Zu(e.data)},iE=function(e){Ti.postMessage(pc(e),Si.protocol+"//"+Si.host)};hs&&Ri||(hs=function(e){zp(arguments.length,1);var t=qu(e)?e:nE(e),n=tE(arguments,1);return ll[++Yp]=function(){eE(t,void 0,n)},pn(Yp),Yp},Ri=function(e){delete ll[e]},hc?pn=function(e){gy.nextTick(pa(e))}:Qu&&Qu.now?pn=function(e){Qu.now(pa(e))}:vy&&!xi?(Rr=(Hr=new vy).port2,Hr.port1.onmessage=rE,pn=dc(Rr.postMessage,Rr)):Ti.addEventListener&&qu(Ti.postMessage)&&!Ti.importScripts&&Si&&Si.protocol!=="file:"&&!Xu(iE)?(pn=iE,Ti.addEventListener("message",rE,!1)):pn=fc in Ju("script")?function(e){pd.appendChild(Ju("script"))[fc]=function(){pd.removeChild(this),Zu(e)}}:function(e){setTimeout(pa(e),0)});var fd={set:hs,clear:Ri},$u=re,YC=Fe,qC=Object.getOwnPropertyDescriptor,sE=function(e){if(!YC)return $u[e];var t=qC($u,e);return t&&t.value},oE=function(){this.head=null,this.tail=null};oE.prototype={add:function(e){var t={item:e,next:null},n=this.tail;n?n.next=t:this.head=t,this.tail=t},get:function(){var e=this.head;if(e)return(this.head=e.next)===null&&(this.tail=null),e.item}};var Rs,aE,mc,qp,mr,yy=oE,Sy=/ipad|iphone|ipod/i.test(ei)&&typeof Pebble<"u",XC=/web0s(?!.*chrome)/i.test(ei),md=re,Ty=sE,cE=qa,lE=fd.set,Cs=yy,dE=No,JC=Sy,_c=XC,_d=Jl,Ec=md.MutationObserver||md.WebKitMutationObserver,eh=md.document,Xp=md.process,Ed=md.Promise,uE=Ty("queueMicrotask");if(!uE){var gd=new Cs,Jp=function(){var e,t;for(_d&&(e=Xp.domain)&&e.exit();t=gd.get();)try{t()}catch(n){throw gd.head&&Rs(),n}e&&e.enter()};dE||_d||_c||!Ec||!eh?!JC&&Ed&&Ed.resolve?((qp=Ed.resolve(void 0)).constructor=Ed,mr=cE(qp.then,qp),Rs=function(){mr(Jp)}):_d?Rs=function(){Xp.nextTick(Jp)}:(lE=cE(lE,md),Rs=function(){lE(Jp)}):(aE=!0,mc=eh.createTextNode(""),new Ec(Jp).observe(mc,{characterData:!0}),Rs=function(){mc.data=aE=!aE}),uE=function(e){gd.head||Rs(),gd.add(e)}}var hE=uE,dl=function(e){try{return{error:!1,value:e()}}catch(t){return{error:!0,value:t}}},Oo=re.Promise,Qp=re,vd=Oo,pE=Ge,QC=Fl,Ry=q_,fE=kn,th=Tu,nh=Oi,rh=vd&&vd.prototype,Cy=fE("species"),wy=pE(Qp.PromiseRejectionEvent),Zp=QC("Promise",(function(){var e=Ry(vd),t=e!==String(vd);if(!t&&nh===66||!rh.catch||!rh.finally)return!0;if(!nh||nh<51||!/native code/.test(e)){var n=new vd((function(i){i(1)})),r=function(i){i((function(){}),(function(){}))};if((n.constructor={})[Cy]=r,!(n.then((function(){}))instanceof r))return!0}return!(t||th!=="BROWSER"&&th!=="DENO"||wy)})),ih={CONSTRUCTOR:Zp,REJECTION_EVENT:wy},Ji={},by=Xn,$p=TypeError,a=function(e){var t,n;this.promise=new e((function(r,i){if(t!==void 0||n!==void 0)throw new $p("Bad Promise constructor");t=r,n=i})),this.resolve=by(t),this.reject=by(n)};Ji.f=function(e){return new a(e)};var d,m,S=Jt,b=Jl,P=re,Y=Je,ie=ua,ue=Io,Ae=function(e){var t=Wp(e);fy&&t&&!t[z_]&&K_(t,z_,{configurable:!0,get:function(){return this}})},Ke=Xn,qe=Ge,He=Sr,ft=Yu,yt=cl,Tt=fd.set,_r=hE,ge=function(e,t){try{arguments.length===1?console.error(e):console.error(e,t)}catch{}},pe=dl,Ce=yy,Qe=oc,Rt=Oo,Dt=ih,kt=Ji,Vt="Promise",zr=Dt.CONSTRUCTOR,On=Dt.REJECTION_EVENT,Po=Qe.getterFor(Vt),ZC=Qe.set,_5=Rt&&Rt.prototype,mE=Rt,$C=_5,wN=P.TypeError,ew=P.document,tw=P.process,nw=kt.f,E5=nw,g5=!!(ew&&ew.createEvent&&P.dispatchEvent),bN="unhandledrejection",IN=function(e){var t;return!(!He(e)||!qe(t=e.then))&&t},AN=function(e,t){var n,r,i,s=t.value,o=t.state===1,c=o?e.ok:e.fail,l=e.resolve,h=e.reject,p=e.domain;try{c?(o||(t.rejection===2&&y5(t),t.rejection=1),c===!0?n=s:(p&&p.enter(),n=c(s),p&&(p.exit(),i=!0)),n===e.promise?h(new wN("Promise-chain cycle")):(r=IN(n))?Y(r,n,l,h):l(n)):h(s)}catch(E){p&&!i&&p.exit(),h(E)}},NN=function(e,t){e.notified||(e.notified=!0,_r((function(){for(var n,r=e.reactions;n=r.get();)AN(n,e);e.notified=!1,t&&!e.rejection&&v5(e)})))},ON=function(e,t,n){var r,i;g5?((r=ew.createEvent("Event")).promise=t,r.reason=n,r.initEvent(e,!1,!0),P.dispatchEvent(r)):r={promise:t,reason:n},!On&&(i=P["on"+e])?i(r):e===bN&&ge("Unhandled promise rejection",n)},v5=function(e){Y(Tt,P,(function(){var t,n=e.facade,r=e.value;if(PN(e)&&(t=pe((function(){b?tw.emit("unhandledRejection",r,n):ON(bN,n,r)})),e.rejection=b||PN(e)?2:1,t.error))throw t.value}))},PN=function(e){return e.rejection!==1&&!e.parent},y5=function(e){Y(Tt,P,(function(){var t=e.facade;b?tw.emit("rejectionHandled",t):ON("rejectionhandled",t,e.value)}))},ef=function(e,t,n){return function(r){e(t,r,n)}},tf=function(e,t,n){e.done||(e.done=!0,n&&(e=n),e.value=t,e.state=2,NN(e,!0))},rw=function(e,t,n){if(!e.done){e.done=!0,n&&(e=n);try{if(e.facade===t)throw new wN("Promise can't be resolved itself");var r=IN(t);r?_r((function(){var i={done:!1};try{Y(r,t,ef(rw,i,e),ef(tf,i,e))}catch(s){tf(i,s,e)}})):(e.value=t,e.state=1,NN(e,!1))}catch(i){tf({done:!1},i,e)}}};zr&&($C=(mE=function(e){ft(this,$C),Ke(e),Y(d,this);var t=Po(this);try{e(ef(rw,t),ef(tf,t))}catch(n){tf(t,n)}}).prototype,(d=function(e){ZC(this,{type:Vt,done:!1,notified:!1,parent:!1,reactions:new Ce,rejection:!1,state:0,value:null})}).prototype=ie($C,"then",(function(e,t){var n=Po(this),r=nw(yt(this,mE));return n.parent=!0,r.ok=!qe(e)||e,r.fail=qe(t)&&t,r.domain=b?tw.domain:void 0,n.state===0?n.reactions.add(r):_r((function(){AN(r,n)})),r.promise})),m=function(){var e=new d,t=Po(e);this.promise=e,this.resolve=ef(rw,t),this.reject=ef(tf,t)},kt.f=nw=function(e){return e===mE||e===void 0?new m(e):E5(e)}),S({global:!0,wrap:!0,forced:zr},{Promise:mE}),ue(mE,Vt,!1,!0),Ae(Vt);var DN=kn("iterator"),kN=!1;try{var S5=0,LN={next:function(){return{done:!!S5++}},return:function(){kN=!0}};LN[DN]=function(){return this},Array.from(LN,(function(){throw 2}))}catch{}var T5=Oo,R5=function(e,t){try{if(!t&&!kN)return!1}catch{return!1}var n=!1;try{var r={};r[DN]=function(){return{next:function(){return{done:n=!0}}}},e(r)}catch{}return n},Iy=ih.CONSTRUCTOR||!R5((function(e){T5.all(e).then(void 0,(function(){}))})),C5=Je,w5=Xn,b5=Ji,I5=dl,A5=la;Jt({target:"Promise",stat:!0,forced:Iy},{all:function(e){var t=this,n=b5.f(t),r=n.resolve,i=n.reject,s=I5((function(){var o=w5(t.resolve),c=[],l=0,h=1;A5(e,(function(p){var E=l++,g=!1;h++,C5(o,t,p).then((function(v){g||(g=!0,c[E]=v,--h||r(c))}),i)})),--h||r(c)}));return s.error&&i(s.value),n.promise}});var N5=Jt,O5=ih.CONSTRUCTOR;Oo&&Oo.prototype,N5({target:"Promise",proto:!0,forced:O5,real:!0},{catch:function(e){return this.then(void 0,e)}});var P5=Je,D5=Xn,k5=Ji,L5=dl,x5=la;Jt({target:"Promise",stat:!0,forced:Iy},{race:function(e){var t=this,n=k5.f(t),r=n.reject,i=L5((function(){var s=D5(t.resolve);x5(e,(function(o){P5(s,t,o).then(n.resolve,r)}))}));return i.error&&r(i.value),n.promise}});var M5=Ji;Jt({target:"Promise",stat:!0,forced:ih.CONSTRUCTOR},{reject:function(e){var t=M5.f(this);return(0,t.reject)(e),t.promise}});var U5=li,V5=Sr,j5=Ji,xN=function(e,t){if(U5(e),V5(t)&&t.constructor===e)return t;var n=j5.f(e);return(0,n.resolve)(t),n.promise},F5=Jt,B5=Oo,W5=ih.CONSTRUCTOR,G5=xN,H5=Mr("Promise"),K5=!W5;F5({target:"Promise",stat:!0,forced:!0},{resolve:function(e){return G5(K5&&this===H5?B5:this,e)}});var z5=Je,Y5=Xn,q5=Ji,X5=dl,J5=la;Jt({target:"Promise",stat:!0,forced:Iy},{allSettled:function(e){var t=this,n=q5.f(t),r=n.resolve,i=n.reject,s=X5((function(){var o=Y5(t.resolve),c=[],l=0,h=1;J5(e,(function(p){var E=l++,g=!1;h++,z5(o,t,p).then((function(v){g||(g=!0,c[E]={status:"fulfilled",value:v},--h||r(c))}),(function(v){g||(g=!0,c[E]={status:"rejected",reason:v},--h||r(c))}))})),--h||r(c)}));return s.error&&i(s.value),n.promise}});var Q5=Je,Z5=Xn,$5=Mr,eW=Ji,tW=dl,nW=la,MN="No one promise resolved";Jt({target:"Promise",stat:!0,forced:Iy},{any:function(e){var t=this,n=$5("AggregateError"),r=eW.f(t),i=r.resolve,s=r.reject,o=tW((function(){var c=Z5(t.resolve),l=[],h=0,p=1,E=!1;nW(e,(function(g){var v=h++,O=!1;p++,Q5(c,t,g).then((function(I){O||E||(E=!0,i(I))}),(function(I){O||E||(O=!0,l[v]=I,--p||s(new n(l,MN)))}))})),--p||s(new n(l,MN))}));return o.error&&s(o.value),r.promise}});var rW=Jt,iW=le,sW=Nr,oW=Ji,aW=Xn,UN=dl,iw=re.Promise,VN=!1;rW({target:"Promise",stat:!0,forced:!iw||!iw.try||UN((function(){iw.try((function(e){VN=e===8}),8)})).error||!VN},{try:function(e){var t=arguments.length>1?sW(arguments,1):[],n=oW.f(this),r=UN((function(){return iW(aW(e),void 0,t)}));return(r.error?n.reject:n.resolve)(r.value),n.promise}});var cW=Ji;Jt({target:"Promise",stat:!0},{withResolvers:function(){var e=cW.f(this);return{promise:e.promise,resolve:e.resolve,reject:e.reject}}});var lW=Jt,sw=Oo,dW=A,uW=Mr,hW=Ge,pW=cl,jN=xN,fW=sw&&sw.prototype;lW({target:"Promise",proto:!0,real:!0,forced:!!sw&&dW((function(){fW.finally.call({then:function(){}},(function(){}))}))},{finally:function(e){var t=pW(this,uW("Promise")),n=hW(e);return this.then(n?function(r){return jN(t,e()).then((function(){return r}))}:e,n?function(r){return jN(t,e()).then((function(){throw r}))}:e)}});var ow=K,mW=Wm,_W=Ki,EW=er,gW=ow("".charAt),FN=ow("".charCodeAt),vW=ow("".slice),BN=function(e){return function(t,n){var r,i,s=_W(EW(t)),o=mW(n),c=s.length;return o<0||o>=c?e?"":void 0:(r=FN(s,o))<55296||r>56319||o+1===c||(i=FN(s,o+1))<56320||i>57343?e?gW(s,o):r:e?vW(s,o,o+2):i-56320+(r-55296<<10)+65536}},aw={codeAt:BN(!1),charAt:BN(!0)},yW=aw.charAt,SW=Ki,WN=oc,TW=di,GN=Bp,HN="String Iterator",RW=WN.set,CW=WN.getterFor(HN);TW(String,"String",(function(e){RW(this,{type:HN,string:SW(e),index:0})}),(function(){var e,t=CW(this),n=t.string,r=t.index;return r>=n.length?GN(void 0,!0):(e=yW(n,r),t.index+=e.length,GN(e,!1))}));var wW=ai.Promise,bW={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},IW=re,AW=Io,KN=Xs;for(var cw in bW)AW(IW[cw],cw),KN[cw]=KN.Array;var zN=wW,Pe=C(zN),NW=as("Array","values"),OW=$o,PW=Tr,DW=ee,kW=NW,lw=Array.prototype,LW={DOMTokenList:!0,NodeList:!0},xW=function(e){var t=e.values;return e===lw||DW(lw,e)&&t===lw.values||PW(LW,OW(e))?kW:t},ps=C(xW),YN=gn,MW=TypeError,qN=Nr,UW=Math.floor,dw=function(e,t){var n=e.length;if(n<8)for(var r,i,s=1;s<n;){for(i=s,r=e[s];i&&t(e[i-1],r)>0;)e[i]=e[--i];i!==s++&&(e[i]=r)}else for(var o=UW(n/2),c=dw(qN(e,0,o),t),l=dw(qN(e,o),t),h=c.length,p=l.length,E=0,g=0;E<h||g<p;)e[E+g]=E<h&&g<p?t(c[E],l[g])<=0?c[E++]:l[g++]:E<h?c[E++]:l[g++];return e},XN=dw,JN=ei.match(/firefox\/(\d+)/i),VW=!!JN&&+JN[1],jW=/MSIE|Trident/.test(ei),QN=ei.match(/AppleWebKit\/(\d+)\./),FW=!!QN&&+QN[1],BW=Jt,ZN=K,WW=Xn,GW=So,$N=Qa,HW=function(e,t){if(!delete e[t])throw new MW("Cannot delete property "+YN(t)+" of "+YN(e))},eO=Ki,uw=A,KW=XN,zW=Su,tO=VW,YW=jW,nO=Oi,rO=FW,yd=[],iO=ZN(yd.sort),qW=ZN(yd.push),XW=uw((function(){yd.sort(void 0)})),JW=uw((function(){yd.sort(null)})),QW=zW("sort"),sO=!uw((function(){if(nO)return nO<70;if(!(tO&&tO>3)){if(YW)return!0;if(rO)return rO<603;var e,t,n,r,i="";for(e=65;e<76;e++){switch(t=String.fromCharCode(e),e){case 66:case 69:case 70:case 72:n=3;break;case 68:case 71:n=4;break;default:n=2}for(r=0;r<47;r++)yd.push({k:t+r,v:n})}for(yd.sort((function(s,o){return o.v-s.v})),r=0;r<yd.length;r++)t=yd[r].k.charAt(0),i.charAt(i.length-1)!==t&&(i+=t);return i!=="DGBEFHACIJK"}}));BW({target:"Array",proto:!0,forced:XW||!JW||!QW||!sO},{sort:function(e){e!==void 0&&WW(e);var t=GW(this);if(sO)return e===void 0?iO(t):iO(t,e);var n,r,i=[],s=$N(t);for(r=0;r<s;r++)r in t&&qW(i,t[r]);for(KW(i,(function(o){return function(c,l){return l===void 0?-1:c===void 0?1:o!==void 0?+o(c,l)||0:eO(c)>eO(l)?1:-1}})(e)),n=$N(i),r=0;r<n;)t[r]=i[r++];for(;r<s;)HW(t,r++);return t}});var ZW=as("Array","sort"),$W=ee,eG=ZW,hw=Array.prototype,tG=function(e){var t=e.sort;return e===hw||$W(hw,e)&&t===hw.sort?eG:t},sh=C(tG),nG=Jt,rG=K,iG=Gm,sG=RangeError,oO=String.fromCharCode,aO=String.fromCodePoint,oG=rG([].join);nG({target:"String",stat:!0,forced:!!aO&&aO.length!==1},{fromCodePoint:function(e){for(var t,n=[],r=arguments.length,i=0;r>i;){if(t=+arguments[i++],iG(t,1114111)!==t)throw new sG(t+" is not a valid code point");n[i]=t<65536?oO(t):oO(55296+((t-=65536)>>10),t%1024+56320)}return oG(n,"")}});var aG=A,cG=kn("iterator"),Ay=!aG((function(){var e=new URL("b?a=1&b=2&c=3","https://a"),t=e.searchParams,n=new URLSearchParams("a=1&a=2&b=3"),r="";return e.pathname="c%20d",t.forEach((function(i,s){t.delete("b"),r+=s+i})),n.delete("a",2),n.delete("b",void 0),!e.toJSON||!n.has("a",1)||n.has("a",2)||!n.has("a",void 0)||n.has("b")||!t.size&&!0||!t.sort||e.href!=="https://a/c%20d?a=1&c=3"||t.get("c")!=="3"||String(new URLSearchParams("?a=1"))!=="a=1"||!t[cG]||new URL("https://a@b").username!=="a"||new URLSearchParams(new URLSearchParams("a=b")).get("a")!=="b"||new URL("https://").host!=="xn--e1aybc"||new URL("https://a#").hash!=="#%D0%B1"||r!=="a1c3"||new URL("https://x",void 0).host!=="x"})),lG=ua,pw=Jt,cO=re,fw=sE,dG=Mr,Ny=Je,fa=K,_E=Fe,lO=Ay,dO=ua,uG=ac,hG=function(e,t,n){for(var r in t)n&&n.unsafe&&e[r]?e[r]=t[r]:lG(e,r,t[r],n);return e},pG=Io,fG=Gu,mw=oc,uO=Yu,_w=Ge,mG=Tr,_G=qa,EG=$o,gG=li,hO=Sr,fs=Ki,vG=Du,pO=rt,fO=el,yG=Js,Oy=Bp,nf=Ts,SG=XN,TG=kn("iterator"),rf="URLSearchParams",mO=rf+"Iterator",_O=mw.set,Do=mw.getterFor(rf),RG=mw.getterFor(mO),EO=fw("fetch"),Py=fw("Request"),EE=fw("Headers"),Ew=Py&&Py.prototype,gO=EE&&EE.prototype,CG=cO.TypeError,wG=cO.encodeURIComponent,bG=String.fromCharCode,IG=dG("String","fromCodePoint"),AG=parseInt,Dy=fa("".charAt),vO=fa([].join),Sd=fa([].push),yO=fa("".replace),NG=fa([].shift),SO=fa([].splice),TO=fa("".split),RO=fa("".slice),OG=fa(/./.exec),PG=/\+/g,DG=/^[0-9a-f]+$/i,CO=function(e,t){var n=RO(e,t,t+2);return OG(DG,n)?AG(n,16):NaN},kG=function(e){for(var t=0,n=128;n>0&&(e&n)!=0;n>>=1)t++;return t},LG=function(e){var t=null;switch(e.length){case 1:t=e[0];break;case 2:t=(31&e[0])<<6|63&e[1];break;case 3:t=(15&e[0])<<12|(63&e[1])<<6|63&e[2];break;case 4:t=(7&e[0])<<18|(63&e[1])<<12|(63&e[2])<<6|63&e[3]}return t>1114111?null:t},wO=function(e){for(var t=(e=yO(e,PG," ")).length,n="",r=0;r<t;){var i=Dy(e,r);if(i==="%"){if(Dy(e,r+1)==="%"||r+3>t){n+="%",r++;continue}var s=CO(e,r+1);if(s!=s){n+=i,r++;continue}r+=2;var o=kG(s);if(o===0)i=bG(s);else{if(o===1||o>4){n+="",r++;continue}for(var c=[s],l=1;l<o&&!(++r+3>t||Dy(e,r)!=="%");){var h=CO(e,r+1);if(h!=h){r+=3;break}if(h>191||h<128)break;Sd(c,h),r+=2,l++}if(c.length!==o){n+="";continue}var p=LG(c);p===null?n+="":i=IG(p)}}n+=i,r++}return n},xG=/[!'()~]|%20/g,MG={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},UG=function(e){return MG[e]},bO=function(e){return yO(wG(e),xG,UG)},gw=fG((function(e,t){_O(this,{type:mO,target:Do(e).entries,index:0,kind:t})}),rf,(function(){var e=RG(this),t=e.target,n=e.index++;if(!t||n>=t.length)return e.target=null,Oy(void 0,!0);var r=t[n];switch(e.kind){case"keys":return Oy(r.key,!1);case"values":return Oy(r.value,!1)}return Oy([r.key,r.value],!1)}),!0),IO=function(e){this.entries=[],this.url=null,e!==void 0&&(hO(e)?this.parseObject(e):this.parseQuery(typeof e=="string"?Dy(e,0)==="?"?RO(e,1):e:fs(e)))};IO.prototype={type:rf,bindURL:function(e){this.url=e,this.update()},parseObject:function(e){var t,n,r,i,s,o,c,l=this.entries,h=yG(e);if(h)for(n=(t=fO(e,h)).next;!(r=Ny(n,t)).done;){if(s=(i=fO(gG(r.value))).next,(o=Ny(s,i)).done||(c=Ny(s,i)).done||!Ny(s,i).done)throw new CG("Expected sequence with length 2");Sd(l,{key:fs(o.value),value:fs(c.value)})}else for(var p in e)mG(e,p)&&Sd(l,{key:p,value:fs(e[p])})},parseQuery:function(e){if(e)for(var t,n,r=this.entries,i=TO(e,"&"),s=0;s<i.length;)(t=i[s++]).length&&(n=TO(t,"="),Sd(r,{key:wO(NG(n)),value:wO(vO(n,"="))}))},serialize:function(){for(var e,t=this.entries,n=[],r=0;r<t.length;)e=t[r++],Sd(n,bO(e.key)+"="+bO(e.value));return vO(n,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var ky=function(){uO(this,sf);var e=_O(this,new IO(arguments.length>0?arguments[0]:void 0));_E||(this.size=e.entries.length)},sf=ky.prototype;if(hG(sf,{append:function(e,t){var n=Do(this);nf(arguments.length,2),Sd(n.entries,{key:fs(e),value:fs(t)}),_E||this.length++,n.updateURL()},delete:function(e){for(var t=Do(this),n=nf(arguments.length,1),r=t.entries,i=fs(e),s=n<2?void 0:arguments[1],o=s===void 0?s:fs(s),c=0;c<r.length;){var l=r[c];if(l.key!==i||o!==void 0&&l.value!==o)c++;else if(SO(r,c,1),o!==void 0)break}_E||(this.size=r.length),t.updateURL()},get:function(e){var t=Do(this).entries;nf(arguments.length,1);for(var n=fs(e),r=0;r<t.length;r++)if(t[r].key===n)return t[r].value;return null},getAll:function(e){var t=Do(this).entries;nf(arguments.length,1);for(var n=fs(e),r=[],i=0;i<t.length;i++)t[i].key===n&&Sd(r,t[i].value);return r},has:function(e){for(var t=Do(this).entries,n=nf(arguments.length,1),r=fs(e),i=n<2?void 0:arguments[1],s=i===void 0?i:fs(i),o=0;o<t.length;){var c=t[o++];if(c.key===r&&(s===void 0||c.value===s))return!0}return!1},set:function(e,t){var n=Do(this);nf(arguments.length,1);for(var r,i=n.entries,s=!1,o=fs(e),c=fs(t),l=0;l<i.length;l++)(r=i[l]).key===o&&(s?SO(i,l--,1):(s=!0,r.value=c));s||Sd(i,{key:o,value:c}),_E||(this.size=i.length),n.updateURL()},sort:function(){var e=Do(this);SG(e.entries,(function(t,n){return t.key>n.key?1:-1})),e.updateURL()},forEach:function(e){for(var t,n=Do(this).entries,r=_G(e,arguments.length>1?arguments[1]:void 0),i=0;i<n.length;)r((t=n[i++]).value,t.key,this)},keys:function(){return new gw(this,"keys")},values:function(){return new gw(this,"values")},entries:function(){return new gw(this,"entries")}},{enumerable:!0}),dO(sf,TG,sf.entries,{}),dO(sf,"toString",(function(){return Do(this).serialize()}),{enumerable:!0}),_E&&uG(sf,"size",{get:function(){return Do(this).entries.length},configurable:!0,enumerable:!0}),pG(ky,rf),pw({global:!0,forced:!lO},{URLSearchParams:ky}),!lO&&_w(EE)){var VG=fa(gO.has),jG=fa(gO.set),AO=function(e){if(hO(e)){var t,n=e.body;if(EG(n)===rf)return t=e.headers?new EE(e.headers):new EE,VG(t,"content-type")||jG(t,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),vG(e,{body:pO(0,fs(n)),headers:pO(0,t)})}return e};if(_w(EO)&&pw({global:!0,dontCallGetSet:!0,forced:!0},{fetch:function(e){return EO(e,arguments.length>1?AO(arguments[1]):{})}}),_w(Py)){var vw=function(e){return uO(this,Ew),new Py(e,arguments.length>1?AO(arguments[1]):{})};Ew.constructor=vw,vw.prototype=Ew,pw({global:!0,dontCallGetSet:!0,forced:!0},{Request:vw})}}var ko,FG={URLSearchParams:ky,getState:Do},BG=ai.URLSearchParams,NO=Fe,WG=K,GG=Je,HG=A,yw=ki,KG=ed,zG=Oe,YG=So,qG=Wt,of=Object.assign,OO=Object.defineProperty,XG=WG([].concat),JG=!of||HG((function(){if(NO&&of({b:1},of(OO({},"a",{enumerable:!0,get:function(){OO(this,"b",{value:3,enumerable:!1})}}),{b:2})).b!==1)return!0;var e={},t={},n=Symbol("assign detection"),r="abcdefghijklmnopqrst";return e[n]=7,r.split("").forEach((function(i){t[i]=i})),of({},e)[n]!==7||yw(of({},t)).join("")!==r}))?function(e,t){for(var n=YG(e),r=arguments.length,i=1,s=KG.f,o=zG.f;r>i;)for(var c,l=qG(arguments[i++]),h=s?XG(yw(l),s(l)):yw(l),p=h.length,E=0;p>E;)c=h[E++],NO&&!GG(o,l,c)||(n[c]=l[c]);return n}:of,QG=li,ZG=tl,$G=Fe,e6=Hi,t6=rt,Sw=function(e,t,n){$G?e6.f(e,t,t6(0,n)):e[t]=n},n6=qa,r6=Je,i6=So,s6=function(e,t,n,r){try{return r?t(QG(n)[0],n[1]):t(n)}catch(i){ZG(e,"throw",i)}},o6=E_,a6=Ur,c6=Qa,PO=Sw,l6=el,d6=Js,DO=Array,oh=K,Tw=2147483647,u6=/[^\0-\u007E]/,kO=/[.\u3002\uFF0E\uFF61]/g,LO="Overflow: input needs wider integers to process",xO=RangeError,h6=oh(kO.exec),af=Math.floor,Rw=String.fromCharCode,MO=oh("".charCodeAt),UO=oh([].join),Td=oh([].push),p6=oh("".replace),f6=oh("".split),m6=oh("".toLowerCase),VO=function(e){return e+22+75*(e<26)},_6=function(e,t,n){var r=0;for(e=n?af(e/700):e>>1,e+=af(e/t);e>455;)e=af(e/35),r+=36;return af(r+36*e/(e+38))},E6=function(e){var t=[];e=(function(M){for(var x=[],B=0,Z=M.length;B<Z;){var Q=MO(M,B++);if(Q>=55296&&Q<=56319&&B<Z){var z=MO(M,B++);(64512&z)==56320?Td(x,((1023&Q)<<10)+(1023&z)+65536):(Td(x,Q),B--)}else Td(x,Q)}return x})(e);var n,r,i=e.length,s=128,o=0,c=72;for(n=0;n<e.length;n++)(r=e[n])<128&&Td(t,Rw(r));var l=t.length,h=l;for(l&&Td(t,"-");h<i;){var p=Tw;for(n=0;n<e.length;n++)(r=e[n])>=s&&r<p&&(p=r);var E=h+1;if(p-s>af((Tw-o)/E))throw new xO(LO);for(o+=(p-s)*E,s=p,n=0;n<e.length;n++){if((r=e[n])<s&&++o>Tw)throw new xO(LO);if(r===s){for(var g=o,v=36;;){var O=v<=c?1:v>=c+26?26:v-c;if(g<O)break;var I=g-O,N=36-O;Td(t,Rw(VO(O+I%N))),g=af(I/N),v+=36}Td(t,Rw(VO(g))),c=_6(o,E,h===l),o=0,h++}}o++,s++}return UO(t,"")},g6=Jt,Cw=Fe,v6=Ay,ww=re,jO=qa,Lo=K,Ly=ua,xo=ac,y6=Yu,bw=Tr,Iw=JG,cf=function(e){var t=i6(e),n=a6(this),r=arguments.length,i=r>1?arguments[1]:void 0,s=i!==void 0;s&&(i=n6(i,r>2?arguments[2]:void 0));var o,c,l,h,p,E,g=d6(t),v=0;if(!g||this===DO&&o6(g))for(o=c6(t),c=n?new this(o):DO(o);o>v;v++)E=s?i(t[v],v):t[v],PO(c,v,E);else for(c=n?new this:[],p=(h=l6(t,g)).next;!(l=r6(p,h)).done;v++)E=s?s6(h,i,[l.value,v],!0):l.value,PO(c,v,E);return c.length=v,c},ma=Nr,S6=aw.codeAt,T6=function(e){var t,n,r=[],i=f6(p6(m6(e),kO,"."),".");for(t=0;t<i.length;t++)n=i[t],Td(r,h6(u6,n)?"xn--"+E6(n):n);return UO(r,".")},ul=Ki,R6=Io,C6=Ts,FO=FG,BO=oc,w6=BO.set,xy=BO.getterFor("URL"),b6=FO.URLSearchParams,I6=FO.getState,gE=ww.URL,Aw=ww.TypeError,My=ww.parseInt,A6=Math.floor,WO=Math.pow,Mo=Lo("".charAt),_a=Lo(/./.exec),vE=Lo([].join),N6=Lo(1 .toString),O6=Lo([].pop),lf=Lo([].push),Nw=Lo("".replace),P6=Lo([].shift),D6=Lo("".split),yE=Lo("".slice),Uy=Lo("".toLowerCase),k6=Lo([].unshift),Ow="Invalid scheme",ah="Invalid host",GO="Invalid port",HO=/[a-z]/i,L6=/[\d+-.a-z]/i,Pw=/\d/,x6=/^0x/i,M6=/^[0-7]+$/,U6=/^\d+$/,KO=/^[\da-f]+$/i,V6=/[\0\t\n\r #%/:<>?@[\\\]^|]/,j6=/[\0\t\n\r #/:<>?@[\\\]^|]/,F6=/^[\u0000-\u0020]+/,B6=/(^|[^\u0000-\u0020])[\u0000-\u0020]+$/,W6=/[\t\n\r]/g,SE=function(e){var t,n,r,i;if(typeof e=="number"){for(t=[],n=0;n<4;n++)k6(t,e%256),e=A6(e/256);return vE(t,".")}if(typeof e=="object"){for(t="",r=(function(s){for(var o=null,c=1,l=null,h=0,p=0;p<8;p++)s[p]!==0?(h>c&&(o=l,c=h),l=null,h=0):(l===null&&(l=p),++h);return h>c?l:o})(e),n=0;n<8;n++)i&&e[n]===0||(i&&(i=!1),r===n?(t+=n?":":"::",i=!0):(t+=N6(e[n],16),n<7&&(t+=":")));return"["+t+"]"}return e},Vy={},zO=Iw({},Vy,{" ":1,'"':1,"<":1,">":1,"`":1}),YO=Iw({},zO,{"#":1,"?":1,"{":1,"}":1}),Dw=Iw({},YO,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),Rd=function(e,t){var n=S6(e,0);return n>32&&n<127&&!bw(t,e)?e:encodeURIComponent(e)},jy={ftp:21,file:null,http:80,https:443,ws:80,wss:443},TE=function(e,t){var n;return e.length===2&&_a(HO,Mo(e,0))&&((n=Mo(e,1))===":"||!t&&n==="|")},qO=function(e){var t;return e.length>1&&TE(yE(e,0,2))&&(e.length===2||(t=Mo(e,2))==="/"||t==="\\"||t==="?"||t==="#")},G6=function(e){return e==="."||Uy(e)==="%2e"},kw={},XO={},Lw={},JO={},QO={},xw={},ZO={},$O={},Fy={},By={},Mw={},Uw={},Vw={},jw={},eP={},Fw={},df={},gc={},tP={},ch={},hl={},Bw=function(e,t,n){var r,i,s,o=ul(e);if(t){if(i=this.parse(o))throw new Aw(i);this.searchParams=null}else{if(n!==void 0&&(r=new Bw(n,!0)),i=this.parse(o,null,r))throw new Aw(i);(s=I6(new b6)).bindURL(this),this.searchParams=s}};Bw.prototype={type:"URL",parse:function(e,t,n){var r,i,s,o,c,l=this,h=t||kw,p=0,E="",g=!1,v=!1,O=!1;for(e=ul(e),t||(l.scheme="",l.username="",l.password="",l.host=null,l.port=null,l.path=[],l.query=null,l.fragment=null,l.cannotBeABaseURL=!1,e=Nw(e,F6,""),e=Nw(e,B6,"$1")),e=Nw(e,W6,""),r=cf(e);p<=r.length;){switch(i=r[p],h){case kw:if(!i||!_a(HO,i)){if(t)return Ow;h=Lw;continue}E+=Uy(i),h=XO;break;case XO:if(i&&(_a(L6,i)||i==="+"||i==="-"||i==="."))E+=Uy(i);else{if(i!==":"){if(t)return Ow;E="",h=Lw,p=0;continue}if(t&&(l.isSpecial()!==bw(jy,E)||E==="file"&&(l.includesCredentials()||l.port!==null)||l.scheme==="file"&&!l.host))return;if(l.scheme=E,t)return void(l.isSpecial()&&jy[l.scheme]===l.port&&(l.port=null));E="",l.scheme==="file"?h=jw:l.isSpecial()&&n&&n.scheme===l.scheme?h=JO:l.isSpecial()?h=$O:r[p+1]==="/"?(h=QO,p++):(l.cannotBeABaseURL=!0,lf(l.path,""),h=tP)}break;case Lw:if(!n||n.cannotBeABaseURL&&i!=="#")return Ow;if(n.cannotBeABaseURL&&i==="#"){l.scheme=n.scheme,l.path=ma(n.path),l.query=n.query,l.fragment="",l.cannotBeABaseURL=!0,h=hl;break}h=n.scheme==="file"?jw:xw;continue;case JO:if(i!=="/"||r[p+1]!=="/"){h=xw;continue}h=Fy,p++;break;case QO:if(i==="/"){h=By;break}h=gc;continue;case xw:if(l.scheme=n.scheme,i===ko)l.username=n.username,l.password=n.password,l.host=n.host,l.port=n.port,l.path=ma(n.path),l.query=n.query;else if(i==="/"||i==="\\"&&l.isSpecial())h=ZO;else if(i==="?")l.username=n.username,l.password=n.password,l.host=n.host,l.port=n.port,l.path=ma(n.path),l.query="",h=ch;else{if(i!=="#"){l.username=n.username,l.password=n.password,l.host=n.host,l.port=n.port,l.path=ma(n.path),l.path.length--,h=gc;continue}l.username=n.username,l.password=n.password,l.host=n.host,l.port=n.port,l.path=ma(n.path),l.query=n.query,l.fragment="",h=hl}break;case ZO:if(!l.isSpecial()||i!=="/"&&i!=="\\"){if(i!=="/"){l.username=n.username,l.password=n.password,l.host=n.host,l.port=n.port,h=gc;continue}h=By}else h=Fy;break;case $O:if(h=Fy,i!=="/"||Mo(E,p+1)!=="/")continue;p++;break;case Fy:if(i!=="/"&&i!=="\\"){h=By;continue}break;case By:if(i==="@"){g&&(E="%40"+E),g=!0,s=cf(E);for(var I=0;I<s.length;I++){var N=s[I];if(N!==":"||O){var M=Rd(N,Dw);O?l.password+=M:l.username+=M}else O=!0}E=""}else if(i===ko||i==="/"||i==="?"||i==="#"||i==="\\"&&l.isSpecial()){if(g&&E==="")return"Invalid authority";p-=cf(E).length+1,E="",h=Mw}else E+=i;break;case Mw:case Uw:if(t&&l.scheme==="file"){h=Fw;continue}if(i!==":"||v){if(i===ko||i==="/"||i==="?"||i==="#"||i==="\\"&&l.isSpecial()){if(l.isSpecial()&&E==="")return ah;if(t&&E===""&&(l.includesCredentials()||l.port!==null))return;if(o=l.parseHost(E))return o;if(E="",h=df,t)return;continue}i==="["?v=!0:i==="]"&&(v=!1),E+=i}else{if(E==="")return ah;if(o=l.parseHost(E))return o;if(E="",h=Vw,t===Uw)return}break;case Vw:if(!_a(Pw,i)){if(i===ko||i==="/"||i==="?"||i==="#"||i==="\\"&&l.isSpecial()||t){if(E!==""){var x=My(E,10);if(x>65535)return GO;l.port=l.isSpecial()&&x===jy[l.scheme]?null:x,E=""}if(t)return;h=df;continue}return GO}E+=i;break;case jw:if(l.scheme="file",i==="/"||i==="\\")h=eP;else{if(!n||n.scheme!=="file"){h=gc;continue}switch(i){case ko:l.host=n.host,l.path=ma(n.path),l.query=n.query;break;case"?":l.host=n.host,l.path=ma(n.path),l.query="",h=ch;break;case"#":l.host=n.host,l.path=ma(n.path),l.query=n.query,l.fragment="",h=hl;break;default:qO(vE(ma(r,p),""))||(l.host=n.host,l.path=ma(n.path),l.shortenPath()),h=gc;continue}}break;case eP:if(i==="/"||i==="\\"){h=Fw;break}n&&n.scheme==="file"&&!qO(vE(ma(r,p),""))&&(TE(n.path[0],!0)?lf(l.path,n.path[0]):l.host=n.host),h=gc;continue;case Fw:if(i===ko||i==="/"||i==="\\"||i==="?"||i==="#"){if(!t&&TE(E))h=gc;else if(E===""){if(l.host="",t)return;h=df}else{if(o=l.parseHost(E))return o;if(l.host==="localhost"&&(l.host=""),t)return;E="",h=df}continue}E+=i;break;case df:if(l.isSpecial()){if(h=gc,i!=="/"&&i!=="\\")continue}else if(t||i!=="?")if(t||i!=="#"){if(i!==ko&&(h=gc,i!=="/"))continue}else l.fragment="",h=hl;else l.query="",h=ch;break;case gc:if(i===ko||i==="/"||i==="\\"&&l.isSpecial()||!t&&(i==="?"||i==="#")){if((c=Uy(c=E))===".."||c==="%2e."||c===".%2e"||c==="%2e%2e"?(l.shortenPath(),i==="/"||i==="\\"&&l.isSpecial()||lf(l.path,"")):G6(E)?i==="/"||i==="\\"&&l.isSpecial()||lf(l.path,""):(l.scheme==="file"&&!l.path.length&&TE(E)&&(l.host&&(l.host=""),E=Mo(E,0)+":"),lf(l.path,E)),E="",l.scheme==="file"&&(i===ko||i==="?"||i==="#"))for(;l.path.length>1&&l.path[0]==="";)P6(l.path);i==="?"?(l.query="",h=ch):i==="#"&&(l.fragment="",h=hl)}else E+=Rd(i,YO);break;case tP:i==="?"?(l.query="",h=ch):i==="#"?(l.fragment="",h=hl):i!==ko&&(l.path[0]+=Rd(i,Vy));break;case ch:t||i!=="#"?i!==ko&&(i==="'"&&l.isSpecial()?l.query+="%27":l.query+=i==="#"?"%23":Rd(i,Vy)):(l.fragment="",h=hl);break;case hl:i!==ko&&(l.fragment+=Rd(i,zO))}p++}},parseHost:function(e){var t,n,r;if(Mo(e,0)==="["){if(Mo(e,e.length-1)!=="]"||(t=(function(i){var s,o,c,l,h,p,E,g=[0,0,0,0,0,0,0,0],v=0,O=null,I=0,N=function(){return Mo(i,I)};if(N()===":"){if(Mo(i,1)!==":")return;I+=2,O=++v}for(;N();){if(v===8)return;if(N()!==":"){for(s=o=0;o<4&&_a(KO,N());)s=16*s+My(N(),16),I++,o++;if(N()==="."){if(o===0||(I-=o,v>6))return;for(c=0;N();){if(l=null,c>0){if(!(N()==="."&&c<4))return;I++}if(!_a(Pw,N()))return;for(;_a(Pw,N());){if(h=My(N(),10),l===null)l=h;else{if(l===0)return;l=10*l+h}if(l>255)return;I++}g[v]=256*g[v]+l,++c!=2&&c!==4||v++}if(c!==4)return;break}if(N()===":"){if(I++,!N())return}else if(N())return;g[v++]=s}else{if(O!==null)return;I++,O=++v}}if(O!==null)for(p=v-O,v=7;v!==0&&p>0;)E=g[v],g[v--]=g[O+p-1],g[O+--p]=E;else if(v!==8)return;return g})(yE(e,1,-1)),!t))return ah;this.host=t}else if(this.isSpecial()){if(e=T6(e),_a(V6,e)||(t=(function(i){var s,o,c,l,h,p,E,g=D6(i,".");if(g.length&&g[g.length-1]===""&&g.length--,(s=g.length)>4)return i;for(o=[],c=0;c<s;c++){if((l=g[c])==="")return i;if(h=10,l.length>1&&Mo(l,0)==="0"&&(h=_a(x6,l)?16:8,l=yE(l,h===8?1:2)),l==="")p=0;else{if(!_a(h===10?U6:h===8?M6:KO,l))return i;p=My(l,h)}lf(o,p)}for(c=0;c<s;c++)if(p=o[c],c===s-1){if(p>=WO(256,5-s))return null}else if(p>255)return null;for(E=O6(o),c=0;c<o.length;c++)E+=o[c]*WO(256,3-c);return E})(e),t===null))return ah;this.host=t}else{if(_a(j6,e))return ah;for(t="",n=cf(e),r=0;r<n.length;r++)t+=Rd(n[r],Vy);this.host=t}},cannotHaveUsernamePasswordPort:function(){return!this.host||this.cannotBeABaseURL||this.scheme==="file"},includesCredentials:function(){return this.username!==""||this.password!==""},isSpecial:function(){return bw(jy,this.scheme)},shortenPath:function(){var e=this.path,t=e.length;!t||this.scheme==="file"&&t===1&&TE(e[0],!0)||e.length--},serialize:function(){var e=this,t=e.scheme,n=e.username,r=e.password,i=e.host,s=e.port,o=e.path,c=e.query,l=e.fragment,h=t+":";return i!==null?(h+="//",e.includesCredentials()&&(h+=n+(r?":"+r:"")+"@"),h+=SE(i),s!==null&&(h+=":"+s)):t==="file"&&(h+="//"),h+=e.cannotBeABaseURL?o[0]:o.length?"/"+vE(o,"/"):"",c!==null&&(h+="?"+c),l!==null&&(h+="#"+l),h},setHref:function(e){var t=this.parse(e);if(t)throw new Aw(t);this.searchParams.update()},getOrigin:function(){var e=this.scheme,t=this.port;if(e==="blob")try{return new uf(e.path[0]).origin}catch{return"null"}return e!=="file"&&this.isSpecial()?e+"://"+SE(this.host)+(t!==null?":"+t:""):"null"},getProtocol:function(){return this.scheme+":"},setProtocol:function(e){this.parse(ul(e)+":",kw)},getUsername:function(){return this.username},setUsername:function(e){var t=cf(ul(e));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var n=0;n<t.length;n++)this.username+=Rd(t[n],Dw)}},getPassword:function(){return this.password},setPassword:function(e){var t=cf(ul(e));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var n=0;n<t.length;n++)this.password+=Rd(t[n],Dw)}},getHost:function(){var e=this.host,t=this.port;return e===null?"":t===null?SE(e):SE(e)+":"+t},setHost:function(e){this.cannotBeABaseURL||this.parse(e,Mw)},getHostname:function(){var e=this.host;return e===null?"":SE(e)},setHostname:function(e){this.cannotBeABaseURL||this.parse(e,Uw)},getPort:function(){var e=this.port;return e===null?"":ul(e)},setPort:function(e){this.cannotHaveUsernamePasswordPort()||((e=ul(e))===""?this.port=null:this.parse(e,Vw))},getPathname:function(){var e=this.path;return this.cannotBeABaseURL?e[0]:e.length?"/"+vE(e,"/"):""},setPathname:function(e){this.cannotBeABaseURL||(this.path=[],this.parse(e,df))},getSearch:function(){var e=this.query;return e?"?"+e:""},setSearch:function(e){(e=ul(e))===""?this.query=null:(Mo(e,0)==="?"&&(e=yE(e,1)),this.query="",this.parse(e,ch)),this.searchParams.update()},getSearchParams:function(){return this.searchParams.facade},getHash:function(){var e=this.fragment;return e?"#"+e:""},setHash:function(e){(e=ul(e))!==""?(Mo(e,0)==="#"&&(e=yE(e,1)),this.fragment="",this.parse(e,hl)):this.fragment=null},update:function(){this.query=this.searchParams.serialize()||null}};var uf=function(e){var t=y6(this,ms),n=C6(arguments.length,1)>1?arguments[1]:void 0,r=w6(t,new Bw(e,!1,n));Cw||(t.href=r.serialize(),t.origin=r.getOrigin(),t.protocol=r.getProtocol(),t.username=r.getUsername(),t.password=r.getPassword(),t.host=r.getHost(),t.hostname=r.getHostname(),t.port=r.getPort(),t.pathname=r.getPathname(),t.search=r.getSearch(),t.searchParams=r.getSearchParams(),t.hash=r.getHash())},ms=uf.prototype,Uo=function(e,t){return{get:function(){return xy(this)[e]()},set:t&&function(n){return xy(this)[t](n)},configurable:!0,enumerable:!0}};if(Cw&&(xo(ms,"href",Uo("serialize","setHref")),xo(ms,"origin",Uo("getOrigin")),xo(ms,"protocol",Uo("getProtocol","setProtocol")),xo(ms,"username",Uo("getUsername","setUsername")),xo(ms,"password",Uo("getPassword","setPassword")),xo(ms,"host",Uo("getHost","setHost")),xo(ms,"hostname",Uo("getHostname","setHostname")),xo(ms,"port",Uo("getPort","setPort")),xo(ms,"pathname",Uo("getPathname","setPathname")),xo(ms,"search",Uo("getSearch","setSearch")),xo(ms,"searchParams",Uo("getSearchParams")),xo(ms,"hash",Uo("getHash","setHash"))),Ly(ms,"toJSON",(function(){return xy(this).serialize()}),{enumerable:!0}),Ly(ms,"toString",(function(){return xy(this).serialize()}),{enumerable:!0}),gE){var nP=gE.createObjectURL,rP=gE.revokeObjectURL;nP&&Ly(uf,"createObjectURL",jO(nP,gE)),rP&&Ly(uf,"revokeObjectURL",jO(rP,gE))}R6(uf,"URL"),g6({global:!0,forced:!v6,sham:!Cw},{URL:uf});var H6=Jt,iP=A,K6=Ts,sP=Ki,z6=Ay,Ww=Mr("URL"),Y6=z6&&iP((function(){Ww.canParse()})),q6=iP((function(){return Ww.canParse.length!==1}));H6({target:"URL",stat:!0,forced:!Y6||q6},{canParse:function(e){var t=K6(arguments.length,1),n=sP(e),r=t<2||arguments[1]===void 0?void 0:sP(arguments[1]);try{return!!new Ww(n,r)}catch{return!1}}});var X6=Jt,J6=Ts,oP=Ki,Q6=Ay,Z6=Mr("URL");X6({target:"URL",stat:!0,forced:!Q6},{parse:function(e){var t=J6(arguments.length,1),n=oP(e),r=t<2||arguments[1]===void 0?void 0:oP(arguments[1]);try{return new Z6(n,r)}catch{return null}}});var Wy=C(ai.URL);let aP=!0,cP=!0;function Gy(e,t,n){const r=e.match(t);return r&&r.length>=n&&parseInt(r[n],10)}function lh(e,t,n){if(!e.RTCPeerConnection)return;const r=e.RTCPeerConnection.prototype,i=r.addEventListener;r.addEventListener=function(o,c){if(o!==t)return i.apply(this,arguments);const l=h=>{const p=n(h);p&&(c.handleEvent?c.handleEvent(p):c(p))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(c,l),i.apply(this,[o,l])};const s=r.removeEventListener;r.removeEventListener=function(o,c){if(o!==t||!this._eventMap||!this._eventMap[t])return s.apply(this,arguments);if(!this._eventMap[t].has(c))return s.apply(this,arguments);const l=this._eventMap[t].get(c);return this._eventMap[t].delete(c),this._eventMap[t].size===0&&delete this._eventMap[t],Object.keys(this._eventMap).length===0&&delete this._eventMap,s.apply(this,[o,l])},Object.defineProperty(r,"on"+t,{get(){return this["_on"+t]},set(o){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),o&&this.addEventListener(t,this["_on"+t]=o)},enumerable:!0,configurable:!0})}function $6(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(aP=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function e8(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(cP=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function lP(){if(typeof window=="object"){if(aP)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function Gw(e,t){cP&&console.warn(e+" is deprecated, please use "+t+" instead.")}function dP(e){return Object.prototype.toString.call(e)==="[object Object]"}function uP(e){var t;return dP(e)?zi(t=Object.keys(e)).call(t,(function(n,r){const i=dP(e[r]),s=i?uP(e[r]):e[r],o=i&&!Object.keys(s).length;return s===void 0||o?n:Object.assign(n,{[r]:s})}),{}):e}function Hw(e,t,n){t&&!n.has(t.id)&&(n.set(t.id,t),Object.keys(t).forEach((r=>{r.endsWith("Id")?Hw(e,e.get(t[r]),n):r.endsWith("Ids")&&t[r].forEach((i=>{Hw(e,e.get(i),n)}))})))}function hP(e,t,n){const r=n?"outbound-rtp":"inbound-rtp",i=new Map;if(t===null)return i;const s=[];return e.forEach((o=>{o.type==="track"&&o.trackIdentifier===t.id&&s.push(o)})),s.forEach((o=>{e.forEach((c=>{c.type===r&&c.trackId===o.id&&Hw(e,c,i)}))})),i}const pP=lP;function fP(e,t){const n=e&&e.navigator;if(!n.mediaDevices)return;const r=function(o){if(typeof o!="object"||o.mandatory||o.optional)return o;const c={};return Object.keys(o).forEach((l=>{if(l==="require"||l==="advanced"||l==="mediaSource")return;const h=typeof o[l]=="object"?o[l]:{ideal:o[l]};h.exact!==void 0&&typeof h.exact=="number"&&(h.min=h.max=h.exact);const p=function(E,g){return E?E+g.charAt(0).toUpperCase()+g.slice(1):g==="deviceId"?"sourceId":g};if(h.ideal!==void 0){c.optional=c.optional||[];let E={};typeof h.ideal=="number"?(E[p("min",l)]=h.ideal,c.optional.push(E),E={},E[p("max",l)]=h.ideal,c.optional.push(E)):(E[p("",l)]=h.ideal,c.optional.push(E))}h.exact!==void 0&&typeof h.exact!="number"?(c.mandatory=c.mandatory||{},c.mandatory[p("",l)]=h.exact):["min","max"].forEach((E=>{h[E]!==void 0&&(c.mandatory=c.mandatory||{},c.mandatory[p(E,l)]=h[E])}))})),o.advanced&&(c.optional=(c.optional||[]).concat(o.advanced)),c},i=function(o,c){if(t.version>=61)return c(o);if((o=JSON.parse(JSON.stringify(o)))&&typeof o.audio=="object"){const l=function(h,p,E){p in h&&!(E in h)&&(h[E]=h[p],delete h[p])};l((o=JSON.parse(JSON.stringify(o))).audio,"autoGainControl","googAutoGainControl"),l(o.audio,"noiseSuppression","googNoiseSuppression"),o.audio=r(o.audio)}if(o&&typeof o.video=="object"){let l=o.video.facingMode;l=l&&(typeof l=="object"?l:{ideal:l});const h=t.version<66;if(l&&(l.exact==="user"||l.exact==="environment"||l.ideal==="user"||l.ideal==="environment")&&(!n.mediaDevices.getSupportedConstraints||!n.mediaDevices.getSupportedConstraints().facingMode||h)){let p;if(delete o.video.facingMode,l.exact==="environment"||l.ideal==="environment"?p=["back","rear"]:l.exact!=="user"&&l.ideal!=="user"||(p=["front"]),p)return n.mediaDevices.enumerateDevices().then((E=>{E=E.filter((v=>v.kind==="videoinput"));let g=E.find((v=>p.some((O=>{var I;return Re(I=v.label.toLowerCase()).call(I,O)}))));return!g&&E.length&&Re(p).call(p,"back")&&(g=E[E.length-1]),g&&(o.video.deviceId=l.exact?{exact:g.deviceId}:{ideal:g.deviceId}),o.video=r(o.video),pP("chrome: "+JSON.stringify(o)),c(o)}))}o.video=r(o.video)}return pP("chrome: "+JSON.stringify(o)),c(o)},s=function(o){return t.version>=64?o:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[o.name]||o.name,message:o.message,constraint:o.constraint||o.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(n.getUserMedia=(function(o,c,l){i(o,(h=>{n.webkitGetUserMedia(h,c,(p=>{l&&l(s(p))}))}))}).bind(n),n.mediaDevices.getUserMedia){const o=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(c){return i(c,(l=>o(l).then((h=>{if(l.audio&&!h.getAudioTracks().length||l.video&&!h.getVideoTracks().length)throw h.getTracks().forEach((p=>{p.stop()})),new DOMException("","NotFoundError");return h}),(h=>Pe.reject(s(h))))))}}}function mP(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function _P(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(n){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=n)},enumerable:!0,configurable:!0});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=n=>{n.stream.addEventListener("addtrack",(r=>{let i;i=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find((o=>o.track&&o.track.id===r.track.id)):{track:r.track};const s=new Event("track");s.track=r.track,s.receiver=i,s.transceiver={receiver:i},s.streams=[n.stream],this.dispatchEvent(s)})),n.stream.getTracks().forEach((r=>{let i;i=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find((o=>o.track&&o.track.id===r.id)):{track:r};const s=new Event("track");s.track=r,s.receiver=i,s.transceiver={receiver:i},s.streams=[n.stream],this.dispatchEvent(s)}))},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else lh(e,"track",(t=>(t.transceiver||Object.defineProperty(t,"transceiver",{value:{receiver:t.receiver}}),t)))}function EP(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){const t=function(i,s){return{track:s,get dtmf(){return this._dtmf===void 0&&(s.kind==="audio"?this._dtmf=i.createDTMFSender(s):this._dtmf=null),this._dtmf},_pc:i}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const i=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(o,c){let l=i.apply(this,arguments);return l||(l=t(this,o),this._senders.push(l)),l};const s=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(o){s.apply(this,arguments);const c=this._senders.indexOf(o);c!==-1&&this._senders.splice(c,1)}}const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(i){this._senders=this._senders||[],n.apply(this,[i]),i.getTracks().forEach((s=>{this._senders.push(t(this,s))}))};const r=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(i){this._senders=this._senders||[],r.apply(this,[i]),i.getTracks().forEach((s=>{const o=this._senders.find((c=>c.track===s));o&&this._senders.splice(this._senders.indexOf(o),1)}))}}else if(typeof e=="object"&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){const n=t.apply(this,[]);return n.forEach((r=>r._pc=this)),n},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function gP(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[n,r,i]=arguments;if(arguments.length>0&&typeof n=="function")return t.apply(this,arguments);if(t.length===0&&(arguments.length===0||typeof n!="function"))return t.apply(this,[]);const s=function(c){const l={};return c.result().forEach((h=>{const p={id:h.id,timestamp:h.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[h.type]||h.type};h.names().forEach((E=>{p[E]=h.stat(E)})),l[p.id]=p})),l},o=function(c){return new Map(Object.keys(c).map((l=>[l,c[l]])))};if(arguments.length>=2){const c=function(l){r(o(s(l)))};return t.apply(this,[c,n])}return new Pe(((c,l)=>{t.apply(this,[function(h){c(o(s(h)))},l])})).then(r,i)}}function vP(e){if(!(typeof e=="object"&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if(!("getStats"in e.RTCRtpSender.prototype)){const n=e.RTCPeerConnection.prototype.getSenders;n&&(e.RTCPeerConnection.prototype.getSenders=function(){const i=n.apply(this,[]);return i.forEach((s=>s._pc=this)),i});const r=e.RTCPeerConnection.prototype.addTrack;r&&(e.RTCPeerConnection.prototype.addTrack=function(){const i=r.apply(this,arguments);return i._pc=this,i}),e.RTCRtpSender.prototype.getStats=function(){const i=this;return this._pc.getStats().then((s=>hP(s,i.track,!0)))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){const n=e.RTCPeerConnection.prototype.getReceivers;n&&(e.RTCPeerConnection.prototype.getReceivers=function(){const r=n.apply(this,[]);return r.forEach((i=>i._pc=this)),r}),lh(e,"track",(r=>(r.receiver._pc=r.srcElement,r))),e.RTCRtpReceiver.prototype.getStats=function(){const r=this;return this._pc.getStats().then((i=>hP(i,r.track,!1)))}}if(!("getStats"in e.RTCRtpSender.prototype)||!("getStats"in e.RTCRtpReceiver.prototype))return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){const n=arguments[0];let r,i,s;return this.getSenders().forEach((o=>{o.track===n&&(r?s=!0:r=o)})),this.getReceivers().forEach((o=>(o.track===n&&(i?s=!0:i=o),o.track===n))),s||r&&i?Pe.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):r?r.getStats():i?i.getStats():Pe.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return t.apply(this,arguments)}}function yP(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map((s=>this._shimmedLocalStreams[s][0]))};const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(s,o){if(!o)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const c=t.apply(this,arguments);return this._shimmedLocalStreams[o.id]?this._shimmedLocalStreams[o.id].indexOf(c)===-1&&this._shimmedLocalStreams[o.id].push(c):this._shimmedLocalStreams[o.id]=[o,c],c};const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(s){this._shimmedLocalStreams=this._shimmedLocalStreams||{},s.getTracks().forEach((l=>{if(this.getSenders().find((p=>p.track===l)))throw new DOMException("Track already exists.","InvalidAccessError")}));const o=this.getSenders();n.apply(this,arguments);const c=this.getSenders().filter((l=>o.indexOf(l)===-1));this._shimmedLocalStreams[s.id]=[s].concat(c)};const r=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(s){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[s.id],r.apply(this,arguments)};const i=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(s){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},s&&Object.keys(this._shimmedLocalStreams).forEach((o=>{const c=this._shimmedLocalStreams[o].indexOf(s);c!==-1&&this._shimmedLocalStreams[o].splice(c,1),this._shimmedLocalStreams[o].length===1&&delete this._shimmedLocalStreams[o]})),i.apply(this,arguments)}}function SP(e,t){if(!e.RTCPeerConnection)return;if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return yP(e);const n=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){const l=n.apply(this);return this._reverseStreams=this._reverseStreams||{},l.map((h=>this._reverseStreams[h.id]))};const r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(l){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},l.getTracks().forEach((h=>{if(this.getSenders().find((E=>E.track===h)))throw new DOMException("Track already exists.","InvalidAccessError")})),!this._reverseStreams[l.id]){const h=new e.MediaStream(l.getTracks());this._streams[l.id]=h,this._reverseStreams[h.id]=l,l=h}r.apply(this,[l])};const i=e.RTCPeerConnection.prototype.removeStream;function s(l,h){let p=h.sdp;return Object.keys(l._reverseStreams||[]).forEach((E=>{const g=l._reverseStreams[E],v=l._streams[g.id];p=p.replace(new RegExp(v.id,"g"),g.id)})),new RTCSessionDescription({type:h.type,sdp:p})}e.RTCPeerConnection.prototype.removeStream=function(l){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},i.apply(this,[this._streams[l.id]||l]),delete this._reverseStreams[this._streams[l.id]?this._streams[l.id].id:l.id],delete this._streams[l.id]},e.RTCPeerConnection.prototype.addTrack=function(l,h){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const p=[].slice.call(arguments,1);if(p.length!==1||!p[0].getTracks().find((v=>v===l)))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find((v=>v.track===l)))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const g=this._streams[h.id];if(g)g.addTrack(l),Pe.resolve().then((()=>{this.dispatchEvent(new Event("negotiationneeded"))}));else{const v=new e.MediaStream([l]);this._streams[h.id]=v,this._reverseStreams[v.id]=h,this.addStream(v)}return this.getSenders().find((v=>v.track===l))},["createOffer","createAnswer"].forEach((function(l){const h=e.RTCPeerConnection.prototype[l],p={[l](){const E=arguments;return arguments.length&&typeof arguments[0]=="function"?h.apply(this,[g=>{const v=s(this,g);E[0].apply(null,[v])},g=>{E[1]&&E[1].apply(null,g)},arguments[2]]):h.apply(this,arguments).then((g=>s(this,g)))}};e.RTCPeerConnection.prototype[l]=p[l]}));const o=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=(function(l,h){let p=h.sdp;return Object.keys(l._reverseStreams||[]).forEach((E=>{const g=l._reverseStreams[E],v=l._streams[g.id];p=p.replace(new RegExp(g.id,"g"),v.id)})),new RTCSessionDescription({type:h.type,sdp:p})})(this,arguments[0]),o.apply(this,arguments)):o.apply(this,arguments)};const c=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get(){const l=c.get.apply(this);return l.type===""?l:s(this,l)}}),e.RTCPeerConnection.prototype.removeTrack=function(l){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!l._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(l._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let h;this._streams=this._streams||{},Object.keys(this._streams).forEach((p=>{this._streams[p].getTracks().find((E=>l.track===E))&&(h=this._streams[p])})),h&&(h.getTracks().length===1?this.removeStream(this._reverseStreams[h.id]):h.removeTrack(l.track),this.dispatchEvent(new Event("negotiationneeded")))}}function Kw(e,t){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection&&t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(n){const r=e.RTCPeerConnection.prototype[n],i={[n](){return arguments[0]=new(n==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}};e.RTCPeerConnection.prototype[n]=i[n]}))}function TP(e,t){lh(e,"negotiationneeded",(n=>{const r=n.target;if(!(t.version<72||r.getConfiguration&&r.getConfiguration().sdpSemantics==="plan-b")||r.signalingState==="stable")return n}))}var RP=Object.freeze({__proto__:null,fixNegotiationNeeded:TP,shimAddTrackRemoveTrack:SP,shimAddTrackRemoveTrackWithNative:yP,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(typeof t=="function"?e.navigator.mediaDevices.getDisplayMedia=function(n){return t(n).then((r=>{const i=n.video&&n.video.width,s=n.video&&n.video.height,o=n.video&&n.video.frameRate;return n.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:r,maxFrameRate:o||3}},i&&(n.video.mandatory.maxWidth=i),s&&(n.video.mandatory.maxHeight=s),e.navigator.mediaDevices.getUserMedia(n)}))}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))},shimGetSendersWithDtmf:EP,shimGetStats:gP,shimGetUserMedia:fP,shimMediaStream:mP,shimOnTrack:_P,shimPeerConnection:Kw,shimSenderReceiverGetStats:vP});function CP(e,t){const n=e&&e.navigator,r=e&&e.MediaStreamTrack;if(n.getUserMedia=function(i,s,o){Gw("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(i).then(s,o)},!(t.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){const i=function(o,c,l){c in o&&!(l in o)&&(o[l]=o[c],delete o[c])},s=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(o){return typeof o=="object"&&typeof o.audio=="object"&&(o=JSON.parse(JSON.stringify(o)),i(o.audio,"autoGainControl","mozAutoGainControl"),i(o.audio,"noiseSuppression","mozNoiseSuppression")),s(o)},r&&r.prototype.getSettings){const o=r.prototype.getSettings;r.prototype.getSettings=function(){const c=o.apply(this,arguments);return i(c,"mozAutoGainControl","autoGainControl"),i(c,"mozNoiseSuppression","noiseSuppression"),c}}if(r&&r.prototype.applyConstraints){const o=r.prototype.applyConstraints;r.prototype.applyConstraints=function(c){return this.kind==="audio"&&typeof c=="object"&&(c=JSON.parse(JSON.stringify(c)),i(c,"autoGainControl","mozAutoGainControl"),i(c,"noiseSuppression","mozNoiseSuppression")),o.apply(this,[c])}}}}function wP(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function zw(e,t){if(typeof e!="object"||!e.RTCPeerConnection&&!e.mozRTCPeerConnection)return;!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(i){const s=e.RTCPeerConnection.prototype[i],o={[i](){return arguments[0]=new(i==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),s.apply(this,arguments)}};e.RTCPeerConnection.prototype[i]=o[i]}));const n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},r=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[i,s,o]=arguments;return r.apply(this,[i||null]).then((c=>{if(t.version<53&&!s)try{c.forEach((l=>{l.type=n[l.type]||l.type}))}catch(l){if(l.name!=="TypeError")throw l;c.forEach(((h,p)=>{c.set(p,Object.assign({},h,{type:n[h.type]||h.type}))}))}return c})).then(s,o)}}function bP(e){if(typeof e!="object"||!e.RTCPeerConnection||!e.RTCRtpSender||e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)return;const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const r=t.apply(this,[]);return r.forEach((i=>i._pc=this)),r});const n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){const r=n.apply(this,arguments);return r._pc=this,r}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Pe.resolve(new Map)}}function IP(e){if(typeof e!="object"||!e.RTCPeerConnection||!e.RTCRtpSender||e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)return;const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const n=t.apply(this,[]);return n.forEach((r=>r._pc=this)),n}),lh(e,"track",(n=>(n.receiver._pc=n.srcElement,n))),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function AP(e){e.RTCPeerConnection&&!("removeStream"in e.RTCPeerConnection.prototype)&&(e.RTCPeerConnection.prototype.removeStream=function(t){Gw("removeStream","removeTrack"),this.getSenders().forEach((n=>{var r;n.track&&Re(r=t.getTracks()).call(r,n.track)&&this.removeTrack(n)}))})}function NP(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function OP(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let n=arguments[1]&&arguments[1].sendEncodings;n===void 0&&(n=[]),n=[...n];const r=n.length>0;r&&n.forEach((s=>{if("rid"in s&&!/^[a-z0-9]{0,16}$/i.test(s.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in s&&!(parseFloat(s.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in s&&!(parseFloat(s.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")}));const i=t.apply(this,arguments);if(r){const{sender:s}=i,o=s.getParameters();(!("encodings"in o)||o.encodings.length===1&&Object.keys(o.encodings[0]).length===0)&&(o.encodings=n,s.sendEncodings=n,this.setParametersPromises.push(s.setParameters(o).then((()=>{delete s.sendEncodings})).catch((()=>{delete s.sendEncodings}))))}return i})}function PP(e){if(typeof e!="object"||!e.RTCRtpSender)return;const t=e.RTCRtpSender.prototype.getParameters;t&&(e.RTCRtpSender.prototype.getParameters=function(){const n=t.apply(this,arguments);return"encodings"in n||(n.encodings=[].concat(this.sendEncodings||[{}])),n})}function DP(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Pe.all(this.setParametersPromises).then((()=>t.apply(this,arguments))).finally((()=>{this.setParametersPromises=[]})):t.apply(this,arguments)}}function kP(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Pe.all(this.setParametersPromises).then((()=>t.apply(this,arguments))).finally((()=>{this.setParametersPromises=[]})):t.apply(this,arguments)}}var LP=Object.freeze({__proto__:null,shimAddTransceiver:OP,shimCreateAnswer:kP,shimCreateOffer:DP,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(n){if(!n||!n.video){const r=new DOMException("getDisplayMedia without video constraints is undefined");return r.name="NotFoundError",r.code=8,Pe.reject(r)}return n.video===!0?n.video={mediaSource:t}:n.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(n)})},shimGetParameters:PP,shimGetUserMedia:CP,shimOnTrack:wP,shimPeerConnection:zw,shimRTCDataChannel:NP,shimReceiverGetStats:IP,shimRemoveStream:AP,shimSenderGetStats:bP});function xP(e){if(typeof e=="object"&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(n){var r;this._localStreams||(this._localStreams=[]),Re(r=this._localStreams).call(r,n)||this._localStreams.push(n),n.getAudioTracks().forEach((i=>t.call(this,i,n))),n.getVideoTracks().forEach((i=>t.call(this,i,n)))},e.RTCPeerConnection.prototype.addTrack=function(n){for(var r=arguments.length,i=new Array(r>1?r-1:0),s=1;s<r;s++)i[s-1]=arguments[s];return i&&i.forEach((o=>{var c;this._localStreams?Re(c=this._localStreams).call(c,o)||this._localStreams.push(o):this._localStreams=[o]})),t.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(t){this._localStreams||(this._localStreams=[]);const n=this._localStreams.indexOf(t);if(n===-1)return;this._localStreams.splice(n,1);const r=t.getTracks();this.getSenders().forEach((i=>{Re(r).call(r,i.track)&&this.removeTrack(i)}))})}}function MP(e){if(typeof e=="object"&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(n){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=n),this.addEventListener("track",this._onaddstreampoly=r=>{r.streams.forEach((i=>{var s;if(this._remoteStreams||(this._remoteStreams=[]),Re(s=this._remoteStreams).call(s,i))return;this._remoteStreams.push(i);const o=new Event("addstream");o.stream=i,this.dispatchEvent(o)}))})}});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){const n=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(r){r.streams.forEach((i=>{if(n._remoteStreams||(n._remoteStreams=[]),n._remoteStreams.indexOf(i)>=0)return;n._remoteStreams.push(i);const s=new Event("addstream");s.stream=i,n.dispatchEvent(s)}))}),t.apply(n,arguments)}}}function UP(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype,n=t.createOffer,r=t.createAnswer,i=t.setLocalDescription,s=t.setRemoteDescription,o=t.addIceCandidate;t.createOffer=function(l,h){const p=arguments.length>=2?arguments[2]:arguments[0],E=n.apply(this,[p]);return h?(E.then(l,h),Pe.resolve()):E},t.createAnswer=function(l,h){const p=arguments.length>=2?arguments[2]:arguments[0],E=r.apply(this,[p]);return h?(E.then(l,h),Pe.resolve()):E};let c=function(l,h,p){const E=i.apply(this,[l]);return p?(E.then(h,p),Pe.resolve()):E};t.setLocalDescription=c,c=function(l,h,p){const E=s.apply(this,[l]);return p?(E.then(h,p),Pe.resolve()):E},t.setRemoteDescription=c,c=function(l,h,p){const E=o.apply(this,[l]);return p?(E.then(h,p),Pe.resolve()):E},t.addIceCandidate=c}function VP(e){const t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){const n=t.mediaDevices,r=n.getUserMedia.bind(n);t.mediaDevices.getUserMedia=i=>r(jP(i))}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=(function(n,r,i){t.mediaDevices.getUserMedia(n).then(r,i)}).bind(t))}function jP(e){return e&&e.video!==void 0?Object.assign({},e,{video:uP(e.video)}):e}function FP(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection;e.RTCPeerConnection=function(n,r){if(n&&n.iceServers){const i=[];for(let s=0;s<n.iceServers.length;s++){let o=n.iceServers[s];!o.hasOwnProperty("urls")&&o.hasOwnProperty("url")?(Gw("RTCIceServer.url","RTCIceServer.urls"),o=JSON.parse(JSON.stringify(o)),o.urls=o.url,delete o.url,i.push(o)):i.push(n.iceServers[s])}n.iceServers=i}return new t(n,r)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:()=>t.generateCertificate})}function BP(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function WP(e){const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(n){if(n){n.offerToReceiveAudio!==void 0&&(n.offerToReceiveAudio=!!n.offerToReceiveAudio);const r=this.getTransceivers().find((s=>s.receiver.track.kind==="audio"));n.offerToReceiveAudio===!1&&r?r.direction==="sendrecv"?r.setDirection?r.setDirection("sendonly"):r.direction="sendonly":r.direction==="recvonly"&&(r.setDirection?r.setDirection("inactive"):r.direction="inactive"):n.offerToReceiveAudio!==!0||r||this.addTransceiver("audio",{direction:"recvonly"}),n.offerToReceiveVideo!==void 0&&(n.offerToReceiveVideo=!!n.offerToReceiveVideo);const i=this.getTransceivers().find((s=>s.receiver.track.kind==="video"));n.offerToReceiveVideo===!1&&i?i.direction==="sendrecv"?i.setDirection?i.setDirection("sendonly"):i.direction="sendonly":i.direction==="recvonly"&&(i.setDirection?i.setDirection("inactive"):i.direction="inactive"):n.offerToReceiveVideo!==!0||i||this.addTransceiver("video",{direction:"recvonly"})}return t.apply(this,arguments)}}function GP(e){typeof e!="object"||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}var HP=Object.freeze({__proto__:null,shimAudioContext:GP,shimCallbacksAPI:UP,shimConstraints:jP,shimCreateOfferLegacy:WP,shimGetUserMedia:VP,shimLocalStreamsAPI:xP,shimRTCIceServerUrls:FP,shimRemoteStreamsAPI:MP,shimTrackEventTransceiver:BP}),KP=`	
\v\f\r \u2028\u2029\uFEFF`,t8=er,n8=Ki,Yw=KP,zP=K("".replace),r8=RegExp("^["+Yw+"]+"),i8=RegExp("(^|[^"+Yw+"])["+Yw+"]+$"),s8=function(e){return function(t){var n=n8(t8(t));return 1&e&&(n=zP(n,r8,"")),2&e&&(n=zP(n,i8,"$1")),n}},o8={trim:s8(3)},a8=Dp.PROPER,c8=A,YP=KP,l8=o8.trim;Jt({target:"String",proto:!0,forced:(function(e){return c8((function(){return!!YP[e]()||""[e]()!==""||a8&&YP[e].name!==e}))})("trim")},{trim:function(){return l8(this)}});var d8=as("String","trim"),u8=ee,h8=d8,qw=String.prototype,p8=function(e){var t=e.trim;return typeof e=="string"||e===qw||u8(qw,e)&&t===qw.trim?h8:t},pi=C(p8),qP={exports:{}};(function(e){const t={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};t.localCName=t.generateIdentifier(),t.splitLines=function(n){return n.trim().split(`
`).map((r=>r.trim()))},t.splitSections=function(n){return n.split(`
m=`).map(((r,i)=>(i>0?"m="+r:r).trim()+`\r
`))},t.getDescription=function(n){const r=t.splitSections(n);return r&&r[0]},t.getMediaSections=function(n){const r=t.splitSections(n);return r.shift(),r},t.matchPrefix=function(n,r){return t.splitLines(n).filter((i=>i.indexOf(r)===0))},t.parseCandidate=function(n){let r;r=n.indexOf("a=candidate:")===0?n.substring(12).split(" "):n.substring(10).split(" ");const i={foundation:r[0],component:{1:"rtp",2:"rtcp"}[r[1]]||r[1],protocol:r[2].toLowerCase(),priority:parseInt(r[3],10),ip:r[4],address:r[4],port:parseInt(r[5],10),type:r[7]};for(let s=8;s<r.length;s+=2)switch(r[s]){case"raddr":i.relatedAddress=r[s+1];break;case"rport":i.relatedPort=parseInt(r[s+1],10);break;case"tcptype":i.tcpType=r[s+1];break;case"ufrag":i.ufrag=r[s+1],i.usernameFragment=r[s+1];break;default:i[r[s]]===void 0&&(i[r[s]]=r[s+1])}return i},t.writeCandidate=function(n){const r=[];r.push(n.foundation);const i=n.component;i==="rtp"?r.push(1):i==="rtcp"?r.push(2):r.push(i),r.push(n.protocol.toUpperCase()),r.push(n.priority),r.push(n.address||n.ip),r.push(n.port);const s=n.type;return r.push("typ"),r.push(s),s!=="host"&&n.relatedAddress&&n.relatedPort&&(r.push("raddr"),r.push(n.relatedAddress),r.push("rport"),r.push(n.relatedPort)),n.tcpType&&n.protocol.toLowerCase()==="tcp"&&(r.push("tcptype"),r.push(n.tcpType)),(n.usernameFragment||n.ufrag)&&(r.push("ufrag"),r.push(n.usernameFragment||n.ufrag)),"candidate:"+r.join(" ")},t.parseIceOptions=function(n){return n.substring(14).split(" ")},t.parseRtpMap=function(n){let r=n.substring(9).split(" ");const i={payloadType:parseInt(r.shift(),10)};return r=r[0].split("/"),i.name=r[0],i.clockRate=parseInt(r[1],10),i.channels=r.length===3?parseInt(r[2],10):1,i.numChannels=i.channels,i},t.writeRtpMap=function(n){let r=n.payloadType;n.preferredPayloadType!==void 0&&(r=n.preferredPayloadType);const i=n.channels||n.numChannels||1;return"a=rtpmap:"+r+" "+n.name+"/"+n.clockRate+(i!==1?"/"+i:"")+`\r
`},t.parseExtmap=function(n){const r=n.substring(9).split(" ");return{id:parseInt(r[0],10),direction:r[0].indexOf("/")>0?r[0].split("/")[1]:"sendrecv",uri:r[1],attributes:r.slice(2).join(" ")}},t.writeExtmap=function(n){return"a=extmap:"+(n.id||n.preferredId)+(n.direction&&n.direction!=="sendrecv"?"/"+n.direction:"")+" "+n.uri+(n.attributes?" "+n.attributes:"")+`\r
`},t.parseFmtp=function(n){const r={};let i;const s=n.substring(n.indexOf(" ")+1).split(";");for(let o=0;o<s.length;o++)i=s[o].trim().split("="),r[i[0].trim()]=i[1];return r},t.writeFmtp=function(n){let r="",i=n.payloadType;if(n.preferredPayloadType!==void 0&&(i=n.preferredPayloadType),n.parameters&&Object.keys(n.parameters).length){const s=[];Object.keys(n.parameters).forEach((o=>{n.parameters[o]!==void 0?s.push(o+"="+n.parameters[o]):s.push(o)})),r+="a=fmtp:"+i+" "+s.join(";")+`\r
`}return r},t.parseRtcpFb=function(n){const r=n.substring(n.indexOf(" ")+1).split(" ");return{type:r.shift(),parameter:r.join(" ")}},t.writeRtcpFb=function(n){let r="",i=n.payloadType;return n.preferredPayloadType!==void 0&&(i=n.preferredPayloadType),n.rtcpFeedback&&n.rtcpFeedback.length&&n.rtcpFeedback.forEach((s=>{r+="a=rtcp-fb:"+i+" "+s.type+(s.parameter&&s.parameter.length?" "+s.parameter:"")+`\r
`})),r},t.parseSsrcMedia=function(n){const r=n.indexOf(" "),i={ssrc:parseInt(n.substring(7,r),10)},s=n.indexOf(":",r);return s>-1?(i.attribute=n.substring(r+1,s),i.value=n.substring(s+1)):i.attribute=n.substring(r+1),i},t.parseSsrcGroup=function(n){const r=n.substring(13).split(" ");return{semantics:r.shift(),ssrcs:r.map((i=>parseInt(i,10)))}},t.getMid=function(n){const r=t.matchPrefix(n,"a=mid:")[0];if(r)return r.substring(6)},t.parseFingerprint=function(n){const r=n.substring(14).split(" ");return{algorithm:r[0].toLowerCase(),value:r[1].toUpperCase()}},t.getDtlsParameters=function(n,r){return{role:"auto",fingerprints:t.matchPrefix(n+r,"a=fingerprint:").map(t.parseFingerprint)}},t.writeDtlsParameters=function(n,r){let i="a=setup:"+r+`\r
`;return n.fingerprints.forEach((s=>{i+="a=fingerprint:"+s.algorithm+" "+s.value+`\r
`})),i},t.parseCryptoLine=function(n){const r=n.substring(9).split(" ");return{tag:parseInt(r[0],10),cryptoSuite:r[1],keyParams:r[2],sessionParams:r.slice(3)}},t.writeCryptoLine=function(n){return"a=crypto:"+n.tag+" "+n.cryptoSuite+" "+(typeof n.keyParams=="object"?t.writeCryptoKeyParams(n.keyParams):n.keyParams)+(n.sessionParams?" "+n.sessionParams.join(" "):"")+`\r
`},t.parseCryptoKeyParams=function(n){if(n.indexOf("inline:")!==0)return null;const r=n.substring(7).split("|");return{keyMethod:"inline",keySalt:r[0],lifeTime:r[1],mkiValue:r[2]?r[2].split(":")[0]:void 0,mkiLength:r[2]?r[2].split(":")[1]:void 0}},t.writeCryptoKeyParams=function(n){return n.keyMethod+":"+n.keySalt+(n.lifeTime?"|"+n.lifeTime:"")+(n.mkiValue&&n.mkiLength?"|"+n.mkiValue+":"+n.mkiLength:"")},t.getCryptoParameters=function(n,r){return t.matchPrefix(n+r,"a=crypto:").map(t.parseCryptoLine)},t.getIceParameters=function(n,r){const i=t.matchPrefix(n+r,"a=ice-ufrag:")[0],s=t.matchPrefix(n+r,"a=ice-pwd:")[0];return i&&s?{usernameFragment:i.substring(12),password:s.substring(10)}:null},t.writeIceParameters=function(n){let r="a=ice-ufrag:"+n.usernameFragment+`\r
a=ice-pwd:`+n.password+`\r
`;return n.iceLite&&(r+=`a=ice-lite\r
`),r},t.parseRtpParameters=function(n){const r={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},i=t.splitLines(n)[0].split(" ");r.profile=i[2];for(let o=3;o<i.length;o++){const c=i[o],l=t.matchPrefix(n,"a=rtpmap:"+c+" ")[0];if(l){const h=t.parseRtpMap(l),p=t.matchPrefix(n,"a=fmtp:"+c+" ");switch(h.parameters=p.length?t.parseFmtp(p[0]):{},h.rtcpFeedback=t.matchPrefix(n,"a=rtcp-fb:"+c+" ").map(t.parseRtcpFb),r.codecs.push(h),h.name.toUpperCase()){case"RED":case"ULPFEC":r.fecMechanisms.push(h.name.toUpperCase())}}}t.matchPrefix(n,"a=extmap:").forEach((o=>{r.headerExtensions.push(t.parseExtmap(o))}));const s=t.matchPrefix(n,"a=rtcp-fb:* ").map(t.parseRtcpFb);return r.codecs.forEach((o=>{s.forEach((c=>{o.rtcpFeedback.find((l=>l.type===c.type&&l.parameter===c.parameter))||o.rtcpFeedback.push(c)}))})),r},t.writeRtpDescription=function(n,r){let i="";i+="m="+n+" ",i+=r.codecs.length>0?"9":"0",i+=" "+(r.profile||"UDP/TLS/RTP/SAVPF")+" ",i+=r.codecs.map((o=>o.preferredPayloadType!==void 0?o.preferredPayloadType:o.payloadType)).join(" ")+`\r
`,i+=`c=IN IP4 0.0.0.0\r
`,i+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,r.codecs.forEach((o=>{i+=t.writeRtpMap(o),i+=t.writeFmtp(o),i+=t.writeRtcpFb(o)}));let s=0;return r.codecs.forEach((o=>{o.maxptime>s&&(s=o.maxptime)})),s>0&&(i+="a=maxptime:"+s+`\r
`),r.headerExtensions&&r.headerExtensions.forEach((o=>{i+=t.writeExtmap(o)})),i},t.parseRtpEncodingParameters=function(n){const r=[],i=t.parseRtpParameters(n),s=i.fecMechanisms.indexOf("RED")!==-1,o=i.fecMechanisms.indexOf("ULPFEC")!==-1,c=t.matchPrefix(n,"a=ssrc:").map((g=>t.parseSsrcMedia(g))).filter((g=>g.attribute==="cname")),l=c.length>0&&c[0].ssrc;let h;const p=t.matchPrefix(n,"a=ssrc-group:FID").map((g=>g.substring(17).split(" ").map((v=>parseInt(v,10)))));p.length>0&&p[0].length>1&&p[0][0]===l&&(h=p[0][1]),i.codecs.forEach((g=>{if(g.name.toUpperCase()==="RTX"&&g.parameters.apt){let v={ssrc:l,codecPayloadType:parseInt(g.parameters.apt,10)};l&&h&&(v.rtx={ssrc:h}),r.push(v),s&&(v=JSON.parse(JSON.stringify(v)),v.fec={ssrc:l,mechanism:o?"red+ulpfec":"red"},r.push(v))}})),r.length===0&&l&&r.push({ssrc:l});let E=t.matchPrefix(n,"b=");return E.length&&(E=E[0].indexOf("b=TIAS:")===0?parseInt(E[0].substring(7),10):E[0].indexOf("b=AS:")===0?1e3*parseInt(E[0].substring(5),10)*.95-16e3:void 0,r.forEach((g=>{g.maxBitrate=E}))),r},t.parseRtcpParameters=function(n){const r={},i=t.matchPrefix(n,"a=ssrc:").map((c=>t.parseSsrcMedia(c))).filter((c=>c.attribute==="cname"))[0];i&&(r.cname=i.value,r.ssrc=i.ssrc);const s=t.matchPrefix(n,"a=rtcp-rsize");r.reducedSize=s.length>0,r.compound=s.length===0;const o=t.matchPrefix(n,"a=rtcp-mux");return r.mux=o.length>0,r},t.writeRtcpParameters=function(n){let r="";return n.reducedSize&&(r+=`a=rtcp-rsize\r
`),n.mux&&(r+=`a=rtcp-mux\r
`),n.ssrc!==void 0&&n.cname&&(r+="a=ssrc:"+n.ssrc+" cname:"+n.cname+`\r
`),r},t.parseMsid=function(n){let r;const i=t.matchPrefix(n,"a=msid:");if(i.length===1)return r=i[0].substring(7).split(" "),{stream:r[0],track:r[1]};const s=t.matchPrefix(n,"a=ssrc:").map((o=>t.parseSsrcMedia(o))).filter((o=>o.attribute==="msid"));return s.length>0?(r=s[0].value.split(" "),{stream:r[0],track:r[1]}):void 0},t.parseSctpDescription=function(n){const r=t.parseMLine(n),i=t.matchPrefix(n,"a=max-message-size:");let s;i.length>0&&(s=parseInt(i[0].substring(19),10)),isNaN(s)&&(s=65536);const o=t.matchPrefix(n,"a=sctp-port:");if(o.length>0)return{port:parseInt(o[0].substring(12),10),protocol:r.fmt,maxMessageSize:s};const c=t.matchPrefix(n,"a=sctpmap:");if(c.length>0){const l=c[0].substring(10).split(" ");return{port:parseInt(l[0],10),protocol:l[1],maxMessageSize:s}}},t.writeSctpDescription=function(n,r){let i=[];return i=n.protocol!=="DTLS/SCTP"?["m="+n.kind+" 9 "+n.protocol+" "+r.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+r.port+`\r
`]:["m="+n.kind+" 9 "+n.protocol+" "+r.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+r.port+" "+r.protocol+` 65535\r
`],r.maxMessageSize!==void 0&&i.push("a=max-message-size:"+r.maxMessageSize+`\r
`),i.join("")},t.generateSessionId=function(){return Math.random().toString().substr(2,22)},t.writeSessionBoilerplate=function(n,r,i){let s;const o=r!==void 0?r:2;return s=n||t.generateSessionId(),`v=0\r
o=`+(i||"thisisadapterortc")+" "+s+" "+o+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},t.getDirection=function(n,r){const i=t.splitLines(n);for(let s=0;s<i.length;s++)switch(i[s]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return i[s].substring(2)}return r?t.getDirection(r):"sendrecv"},t.getKind=function(n){return t.splitLines(n)[0].split(" ")[0].substring(2)},t.isRejected=function(n){return n.split(" ",2)[1]==="0"},t.parseMLine=function(n){const r=t.splitLines(n)[0].substring(2).split(" ");return{kind:r[0],port:parseInt(r[1],10),protocol:r[2],fmt:r.slice(3).join(" ")}},t.parseOLine=function(n){const r=t.matchPrefix(n,"o=")[0].substring(2).split(" ");return{username:r[0],sessionId:r[1],sessionVersion:parseInt(r[2],10),netType:r[3],addressType:r[4],address:r[5]}},t.isValidSDP=function(n){if(typeof n!="string"||n.length===0)return!1;const r=t.splitLines(n);for(let i=0;i<r.length;i++)if(r[i].length<2||r[i].charAt(1)!=="=")return!1;return!0},e.exports=t})(qP);var XP=qP.exports,hf=C(XP),f8=_({__proto__:null,default:hf},[XP]);function Hy(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)return;const t=e.RTCIceCandidate;e.RTCIceCandidate=function(n){if(typeof n=="object"&&n.candidate&&n.candidate.indexOf("a=")===0&&((n=JSON.parse(JSON.stringify(n))).candidate=n.candidate.substr(2)),n.candidate&&n.candidate.length){const r=new t(n),i=hf.parseCandidate(n.candidate),s=Object.assign(r,i);return s.toJSON=function(){return{candidate:s.candidate,sdpMid:s.sdpMid,sdpMLineIndex:s.sdpMLineIndex,usernameFragment:s.usernameFragment}},s}return new t(n)},e.RTCIceCandidate.prototype=t.prototype,lh(e,"icecandidate",(n=>(n.candidate&&Object.defineProperty(n,"candidate",{value:new e.RTCIceCandidate(n.candidate),writable:"false"}),n)))}function Xw(e){!e.RTCIceCandidate||e.RTCIceCandidate&&"relayProtocol"in e.RTCIceCandidate.prototype||lh(e,"icecandidate",(t=>{if(t.candidate){const n=hf.parseCandidate(t.candidate.candidate);n.type==="relay"&&(t.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[n.priority>>24])}return t}))}function Ky(e,t){if(!e.RTCPeerConnection)return;"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get(){return this._sctp===void 0?null:this._sctp}});const n=function(c){if(!c||!c.sdp)return!1;const l=hf.splitSections(c.sdp);return l.shift(),l.some((h=>{const p=hf.parseMLine(h);return p&&p.kind==="application"&&p.protocol.indexOf("SCTP")!==-1}))},r=function(c){const l=c.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(l===null||l.length<2)return-1;const h=parseInt(l[1],10);return h!=h?-1:h},i=function(c){let l=65536;return t.browser==="firefox"&&(l=t.version<57?c===-1?16384:2147483637:t.version<60?t.version===57?65535:65536:2147483637),l},s=function(c,l){let h=65536;t.browser==="firefox"&&t.version===57&&(h=65535);const p=hf.matchPrefix(c.sdp,"a=max-message-size:");return p.length>0?h=parseInt(p[0].substr(19),10):t.browser==="firefox"&&l!==-1&&(h=2147483637),h},o=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,t.browser==="chrome"&&t.version>=76){const{sdpSemantics:c}=this.getConfiguration();c==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return this._sctp===void 0?null:this._sctp},enumerable:!0,configurable:!0})}if(n(arguments[0])){const c=r(arguments[0]),l=i(c),h=s(arguments[0],c);let p;p=l===0&&h===0?Number.POSITIVE_INFINITY:l===0||h===0?Math.max(l,h):Math.min(l,h);const E={};Object.defineProperty(E,"maxMessageSize",{get:()=>p}),this._sctp=E}return o.apply(this,arguments)}}function zy(e){if(!e.RTCPeerConnection||!("createDataChannel"in e.RTCPeerConnection.prototype))return;function t(r,i){const s=r.send;r.send=function(){const o=arguments[0],c=o.length||o.size||o.byteLength;if(r.readyState==="open"&&i.sctp&&c>i.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+i.sctp.maxMessageSize+" bytes)");return s.apply(r,arguments)}}const n=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){const r=n.apply(this,arguments);return t(r,this),r},lh(e,"datachannel",(r=>(t(r.channel,r.target),r)))}function Jw(e){if(!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype)return;const t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(n){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),n&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=n)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach((n=>{const r=t[n];t[n]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=i=>{const s=i.target;if(s._lastConnectionState!==s.connectionState){s._lastConnectionState=s.connectionState;const o=new Event("connectionstatechange",i);s.dispatchEvent(o)}return i},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),r.apply(this,arguments)}}))}function Qw(e,t){if(!e.RTCPeerConnection||t.browser==="chrome"&&t.version>=71||t.browser==="safari"&&t.version>=605)return;const n=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(r){if(r&&r.sdp&&r.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const i=r.sdp.split(`
`).filter((s=>pi(s).call(s)!=="a=extmap-allow-mixed")).join(`
`);e.RTCSessionDescription&&r instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:r.type,sdp:i}):r.sdp=i}return n.apply(this,arguments)}}function Yy(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const n=e.RTCPeerConnection.prototype.addIceCandidate;n&&n.length!==0&&(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(t.browser==="chrome"&&t.version<78||t.browser==="firefox"&&t.version<68||t.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Pe.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Pe.resolve())})}function qy(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const n=e.RTCPeerConnection.prototype.setLocalDescription;n&&n.length!==0&&(e.RTCPeerConnection.prototype.setLocalDescription=function(){let r=arguments[0]||{};if(typeof r!="object"||r.type&&r.sdp)return n.apply(this,arguments);if(r={type:r.type,sdp:r.sdp},!r.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":r.type="offer";break;default:r.type="answer"}return r.sdp||r.type!=="offer"&&r.type!=="answer"?n.apply(this,[r]):(r.type==="offer"?this.createOffer:this.createAnswer).apply(this).then((i=>n.apply(this,[i])))})}var m8=Object.freeze({__proto__:null,removeExtmapAllowMixed:Qw,shimAddIceCandidateNullOrEmpty:Yy,shimConnectionState:Jw,shimMaxMessageSize:Ky,shimParameterlessSetLocalDescription:qy,shimRTCIceCandidate:Hy,shimRTCIceCandidateRelayProtocol:Xw,shimSendThrowTypeError:zy});(function(){let{window:e}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const n=lP,r=(function(s){const o={browser:null,version:null};if(s===void 0||!s.navigator)return o.browser="Not a browser.",o;const{navigator:c}=s;if(c.mozGetUserMedia)o.browser="firefox",o.version=Gy(c.userAgent,/Firefox\/(\d+)\./,1);else if(c.webkitGetUserMedia||s.isSecureContext===!1&&s.webkitRTCPeerConnection)o.browser="chrome",o.version=Gy(c.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!s.RTCPeerConnection||!c.userAgent.match(/AppleWebKit\/(\d+)\./))return o.browser="Not a supported browser.",o;o.browser="safari",o.version=Gy(c.userAgent,/AppleWebKit\/(\d+)\./,1),o.supportsUnifiedPlan=s.RTCRtpTransceiver&&"currentDirection"in s.RTCRtpTransceiver.prototype}return o})(e),i={browserDetails:r,commonShim:m8,extractVersion:Gy,disableLog:$6,disableWarnings:e8,sdp:f8};switch(r.browser){case"chrome":if(!RP||!Kw||!t.shimChrome)return n("Chrome shim is not included in this adapter release."),i;if(r.version===null)return n("Chrome shim can not determine version, not shimming."),i;n("adapter.js shimming chrome."),i.browserShim=RP,Yy(e,r),qy(e),fP(e,r),mP(e),Kw(e,r),_P(e),SP(e,r),EP(e),gP(e),vP(e),TP(e,r),Hy(e),Xw(e),Jw(e),Ky(e,r),zy(e),Qw(e,r);break;case"firefox":if(!LP||!zw||!t.shimFirefox)return n("Firefox shim is not included in this adapter release."),i;n("adapter.js shimming firefox."),i.browserShim=LP,Yy(e,r),qy(e),CP(e,r),zw(e,r),wP(e),AP(e),bP(e),IP(e),NP(e),OP(e),PP(e),DP(e),kP(e),Hy(e),Jw(e),Ky(e,r),zy(e);break;case"safari":if(!HP||!t.shimSafari)return n("Safari shim is not included in this adapter release."),i;n("adapter.js shimming safari."),i.browserShim=HP,Yy(e,r),qy(e),FP(e),WP(e),UP(e),xP(e),MP(e),BP(e),VP(e),GP(e),Hy(e),Xw(e),Ky(e,r),zy(e),Qw(e,r);break;default:n("Unsupported browser!")}})({window:typeof window>"u"?void 0:window});var Zw=re;Jt({global:!0,forced:Zw.globalThis!==Zw},{globalThis:Zw});var JP=C(re),$w={exports:{}};(function(e,t){(function(n,r){var i="function",s="undefined",o="object",c="string",l="major",h="model",p="name",E="type",g="vendor",v="version",O="architecture",I="console",N="mobile",M="tablet",x="smarttv",B="wearable",Z="embedded",Q="Amazon",z="Apple",te="ASUS",de="BlackBerry",me="Browser",ve="Chrome",St="Firefox",wt="Google",ot="Huawei",Xt="LG",zt="Microsoft",Zr="Motorola",fe="Opera",we="Samsung",Me="Sharp",_e="Sony",w="Xiaomi",H="Zebra",J="Facebook",Te="Chromium OS",mt="Mac OS",fn=" Browser",lr=function(sr){for(var dr={},Sn=0;Sn<sr.length;Sn++)dr[sr[Sn].toUpperCase()]=sr[Sn];return dr},uo=function(sr,dr){return typeof sr===c&&Qo(dr).indexOf(Qo(sr))!==-1},Qo=function(sr){return sr.toLowerCase()},bg=function(sr,dr){if(typeof sr===c)return sr=sr.replace(/^\s\s*/,""),typeof dr===s?sr:sr.substring(0,500)},Uh=function(sr,dr){for(var Sn,rs,Da,Kn,bl,Ut,ka=0;ka<dr.length&&!bl;){var Vh=dr[ka],xc=dr[ka+1];for(Sn=rs=0;Sn<Vh.length&&!bl&&Vh[Sn];)if(bl=Vh[Sn++].exec(sr))for(Da=0;Da<xc.length;Da++)Ut=bl[++rs],typeof(Kn=xc[Da])===o&&Kn.length>0?Kn.length===2?typeof Kn[1]==i?this[Kn[0]]=Kn[1].call(this,Ut):this[Kn[0]]=Kn[1]:Kn.length===3?typeof Kn[1]!==i||Kn[1].exec&&Kn[1].test?this[Kn[0]]=Ut?Ut.replace(Kn[1],Kn[2]):r:this[Kn[0]]=Ut?Kn[1].call(this,Ut,Kn[2]):r:Kn.length===4&&(this[Kn[0]]=Ut?Kn[3].call(this,Ut.replace(Kn[1],Kn[2])):r):this[Kn]=Ut||r;ka+=2}},sm=function(sr,dr){for(var Sn in dr)if(typeof dr[Sn]===o&&dr[Sn].length>0){for(var rs=0;rs<dr[Sn].length;rs++)if(uo(dr[Sn][rs],sr))return Sn==="?"?r:Sn}else if(uo(dr[Sn],sr))return Sn==="?"?r:Sn;return dr.hasOwnProperty("*")?dr["*"]:sr},qT={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},XT={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[v,[p,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[v,[p,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[p,v],[/opios[\/ ]+([\w\.]+)/i],[v,[p,fe+" Mini"]],[/\bop(?:rg)?x\/([\w\.]+)/i],[v,[p,fe+" GX"]],[/\bopr\/([\w\.]+)/i],[v,[p,fe]],[/\bb[ai]*d(?:uhd|[ub]*[aekoprswx]{5,6})[\/ ]?([\w\.]+)/i],[v,[p,"Baidu"]],[/\b(?:mxbrowser|mxios|myie2)\/?([-\w\.]*)\b/i],[v,[p,"Maxthon"]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer|sleipnir)[\/ ]?([\w\.]*)/i,/(avant|iemobile|slim(?:browser|boat|jet))[\/ ]?([\d\.]*)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|duckduckgo|klar|helio|(?=comodo_)?dragon)\/([-\w\.]+)/i,/(heytap|ovi|115)browser\/([\d\.]+)/i,/(weibo)__([\d\.]+)/i],[p,v],[/quark(?:pc)?\/([-\w\.]+)/i],[v,[p,"Quark"]],[/\bddg\/([\w\.]+)/i],[v,[p,"DuckDuckGo"]],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[v,[p,"UC"+me]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i,/micromessenger\/([\w\.]+)/i],[v,[p,"WeChat"]],[/konqueror\/([\w\.]+)/i],[v,[p,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[v,[p,"IE"]],[/ya(?:search)?browser\/([\w\.]+)/i],[v,[p,"Yandex"]],[/slbrowser\/([\w\.]+)/i],[v,[p,"Smart Lenovo "+me]],[/(avast|avg)\/([\w\.]+)/i],[[p,/(.+)/,"$1 Secure "+me],v],[/\bfocus\/([\w\.]+)/i],[v,[p,St+" Focus"]],[/\bopt\/([\w\.]+)/i],[v,[p,fe+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[v,[p,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[v,[p,"Dolphin"]],[/coast\/([\w\.]+)/i],[v,[p,fe+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[v,[p,"MIUI"+fn]],[/fxios\/([\w\.-]+)/i],[v,[p,St]],[/\bqihoobrowser\/?([\w\.]*)/i],[v,[p,"360"]],[/\b(qq)\/([\w\.]+)/i],[[p,/(.+)/,"$1Browser"],v],[/(oculus|sailfish|huawei|vivo|pico)browser\/([\w\.]+)/i],[[p,/(.+)/,"$1"+fn],v],[/samsungbrowser\/([\w\.]+)/i],[v,[p,we+" Internet"]],[/metasr[\/ ]?([\d\.]+)/i],[v,[p,"Sogou Explorer"]],[/(sogou)mo\w+\/([\d\.]+)/i],[[p,"Sogou Mobile"],v],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|2345(?=browser|chrome|explorer))\w*[\/ ]?v?([\w\.]+)/i],[p,v],[/(lbbrowser|rekonq)/i,/\[(linkedin)app\]/i],[p],[/ome\/([\w\.]+) \w* ?(iron) saf/i,/ome\/([\w\.]+).+qihu (360)[es]e/i],[v,p],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[p,J],v],[/(Klarna)\/([\w\.]+)/i,/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(alipay)client\/([\w\.]+)/i,/(twitter)(?:and| f.+e\/([\w\.]+))/i,/(chromium|instagram|snapchat)[\/ ]([-\w\.]+)/i],[p,v],[/\bgsa\/([\w\.]+) .*safari\//i],[v,[p,"GSA"]],[/musical_ly(?:.+app_?version\/|_)([\w\.]+)/i],[v,[p,"TikTok"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[v,[p,ve+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[p,ve+" WebView"],v],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[v,[p,"Android "+me]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[p,v],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[v,[p,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[v,p],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[p,[v,sm,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[p,v],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[p,"Netscape"],v],[/(wolvic|librewolf)\/([\w\.]+)/i],[p,v],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[v,[p,St+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i],[p,[v,/_/g,"."]],[/(cobalt)\/([\w\.]+)/i],[p,[v,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[O,"amd64"]],[/(ia32(?=;))/i],[[O,Qo]],[/((?:i[346]|x)86)[;\)]/i],[[O,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[O,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[O,"armhf"]],[/windows (ce|mobile); ppc;/i],[[O,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[O,/ower/,"",Qo]],[/(sun4\w)[;\)]/i],[[O,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[O,Qo]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[h,[g,we],[E,M]],[/\b((?:s[cgp]h|gt|sm)-(?![lr])\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]((?!sm-[lr])[-\w]+)/i,/sec-(sgh\w+)/i],[h,[g,we],[E,N]],[/(?:\/|\()(ip(?:hone|od)[\w, ]*)(?:\/|;)/i],[h,[g,z],[E,N]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[h,[g,z],[E,M]],[/(macintosh);/i],[h,[g,z]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[h,[g,Me],[E,N]],[/(?:honor)([-\w ]+)[;\)]/i],[h,[g,"Honor"],[E,N]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[h,[g,ot],[E,M]],[/(?:huawei)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[h,[g,ot],[E,N]],[/\b(poco[\w ]+|m2\d{3}j\d\d[a-z]{2})(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/oid[^\)]+; (m?[12][0-389][01]\w{3,6}[c-y])( bui|; wv|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite|pro)?)(?: bui|\))/i],[[h,/_/g," "],[g,w],[E,N]],[/oid[^\)]+; (2\d{4}(283|rpbf)[cgl])( bui|\))/i,/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[h,/_/g," "],[g,w],[E,M]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[h,[g,"OPPO"],[E,N]],[/\b(opd2\d{3}a?) bui/i],[h,[g,"OPPO"],[E,M]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[h,[g,"Vivo"],[E,N]],[/\b(rmx[1-3]\d{3})(?: bui|;|\))/i],[h,[g,"Realme"],[E,N]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[h,[g,Zr],[E,N]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[h,[g,Zr],[E,M]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[h,[g,Xt],[E,M]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[h,[g,Xt],[E,N]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[h,[g,"Lenovo"],[E,M]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[h,/_/g," "],[g,"Nokia"],[E,N]],[/(pixel c)\b/i],[h,[g,wt],[E,M]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[h,[g,wt],[E,N]],[/droid.+; (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[h,[g,_e],[E,N]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[h,"Xperia Tablet"],[g,_e],[E,M]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[h,[g,"OnePlus"],[E,N]],[/(alexa)webm/i,/(kf[a-z]{2}wi|aeo(?!bc)\w\w)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[h,[g,Q],[E,M]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[h,/(.+)/g,"Fire Phone $1"],[g,Q],[E,N]],[/(playbook);[-\w\),; ]+(rim)/i],[h,g,[E,M]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[h,[g,de],[E,N]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[h,[g,te],[E,M]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[h,[g,te],[E,N]],[/(nexus 9)/i],[h,[g,"HTC"],[E,M]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[g,[h,/_/g," "],[E,N]],[/droid [\w\.]+; ((?:8[14]9[16]|9(?:0(?:48|60|8[01])|1(?:3[27]|66)|2(?:6[69]|9[56])|466))[gqswx])\w*(\)| bui)/i],[h,[g,"TCL"],[E,M]],[/(itel) ((\w+))/i],[[g,Qo],h,[E,sm,{tablet:["p10001l","w7001"],"*":"mobile"}]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[h,[g,"Acer"],[E,M]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[h,[g,"Meizu"],[E,N]],[/; ((?:power )?armor(?:[\w ]{0,8}))(?: bui|\))/i],[h,[g,"Ulefone"],[E,N]],[/; (energy ?\w+)(?: bui|\))/i,/; energizer ([\w ]+)(?: bui|\))/i],[h,[g,"Energizer"],[E,N]],[/; cat (b35);/i,/; (b15q?|s22 flip|s48c|s62 pro)(?: bui|\))/i],[h,[g,"Cat"],[E,N]],[/((?:new )?andromax[\w- ]+)(?: bui|\))/i],[h,[g,"Smartfren"],[E,N]],[/droid.+; (a(?:015|06[35]|142p?))/i],[h,[g,"Nothing"],[E,N]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron|infinix|tecno|micromax|advan)[-_ ]?([-\w]*)/i,/; (imo) ((?!tab)[\w ]+?)(?: bui|\))/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[g,h,[E,N]],[/(imo) (tab \w+)/i,/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[g,h,[E,M]],[/(surface duo)/i],[h,[g,zt],[E,M]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[h,[g,"Fairphone"],[E,N]],[/(u304aa)/i],[h,[g,"AT&T"],[E,N]],[/\bsie-(\w*)/i],[h,[g,"Siemens"],[E,N]],[/\b(rct\w+) b/i],[h,[g,"RCA"],[E,M]],[/\b(venue[\d ]{2,7}) b/i],[h,[g,"Dell"],[E,M]],[/\b(q(?:mv|ta)\w+) b/i],[h,[g,"Verizon"],[E,M]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[h,[g,"Barnes & Noble"],[E,M]],[/\b(tm\d{3}\w+) b/i],[h,[g,"NuVision"],[E,M]],[/\b(k88) b/i],[h,[g,"ZTE"],[E,M]],[/\b(nx\d{3}j) b/i],[h,[g,"ZTE"],[E,N]],[/\b(gen\d{3}) b.+49h/i],[h,[g,"Swiss"],[E,N]],[/\b(zur\d{3}) b/i],[h,[g,"Swiss"],[E,M]],[/\b((zeki)?tb.*\b) b/i],[h,[g,"Zeki"],[E,M]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[g,"Dragon Touch"],h,[E,M]],[/\b(ns-?\w{0,9}) b/i],[h,[g,"Insignia"],[E,M]],[/\b((nxa|next)-?\w{0,9}) b/i],[h,[g,"NextBook"],[E,M]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[g,"Voice"],h,[E,N]],[/\b(lvtel\-)?(v1[12]) b/i],[[g,"LvTel"],h,[E,N]],[/\b(ph-1) /i],[h,[g,"Essential"],[E,N]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[h,[g,"Envizen"],[E,M]],[/\b(trio[-\w\. ]+) b/i],[h,[g,"MachSpeed"],[E,M]],[/\btu_(1491) b/i],[h,[g,"Rotor"],[E,M]],[/(shield[\w ]+) b/i],[h,[g,"Nvidia"],[E,M]],[/(sprint) (\w+)/i],[g,h,[E,N]],[/(kin\.[onetw]{3})/i],[[h,/\./g," "],[g,zt],[E,N]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[h,[g,H],[E,M]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[h,[g,H],[E,N]],[/smart-tv.+(samsung)/i],[g,[E,x]],[/hbbtv.+maple;(\d+)/i],[[h,/^/,"SmartTV"],[g,we],[E,x]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[g,Xt],[E,x]],[/(apple) ?tv/i],[g,[h,z+" TV"],[E,x]],[/crkey/i],[[h,ve+"cast"],[g,wt],[E,x]],[/droid.+aft(\w+)( bui|\))/i],[h,[g,Q],[E,x]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[h,[g,Me],[E,x]],[/(bravia[\w ]+)( bui|\))/i],[h,[g,_e],[E,x]],[/(mitv-\w{5}) bui/i],[h,[g,w],[E,x]],[/Hbbtv.*(technisat) (.*);/i],[g,h,[E,x]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[g,bg],[h,bg],[E,x]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[E,x]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[g,h,[E,I]],[/droid.+; (shield) bui/i],[h,[g,"Nvidia"],[E,I]],[/(playstation [345portablevi]+)/i],[h,[g,_e],[E,I]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[h,[g,zt],[E,I]],[/\b(sm-[lr]\d\d[05][fnuw]?s?)\b/i],[h,[g,we],[E,B]],[/((pebble))app/i],[g,h,[E,B]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[h,[g,z],[E,B]],[/droid.+; (glass) \d/i],[h,[g,wt],[E,B]],[/droid.+; (wt63?0{2,3})\)/i],[h,[g,H],[E,B]],[/droid.+; (glass) \d/i],[h,[g,wt],[E,B]],[/(pico) (4|neo3(?: link|pro)?)/i],[g,h,[E,B]],[/; (quest( \d| pro)?)/i],[h,[g,J],[E,B]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[g,[E,Z]],[/(aeobc)\b/i],[h,[g,Q],[E,Z]],[/droid .+?; ([^;]+?)(?: bui|; wv\)|\) applew).+? mobile safari/i],[h,[E,N]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[h,[E,M]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[E,M]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[E,N]],[/(android[-\w\. ]{0,9});.+buil/i],[h,[g,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[v,[p,"EdgeHTML"]],[/(arkweb)\/([\w\.]+)/i],[p,v],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[v,[p,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna|servo)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i,/\b(libweb)/i],[p,v],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[v,p]],os:[[/microsoft (windows) (vista|xp)/i],[p,v],[/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i],[p,[v,sm,qT]],[/windows nt 6\.2; (arm)/i,/windows[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i,/(?:win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[v,sm,qT],[p,"Windows"]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/(?:ios;fbsv\/|iphone.+ios[\/ ])([\d\.]+)/i,/cfnetwork\/.+darwin/i],[[v,/_/g,"."],[p,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[p,mt],[v,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[v,p],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish|openharmony)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[p,v],[/\(bb(10);/i],[v,[p,de]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[v,[p,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[v,[p,St+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[v,[p,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[v,[p,"watchOS"]],[/crkey\/([\d\.]+)/i],[v,[p,ve+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[p,Te],v],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[p,v],[/(sunos) ?([\w\.\d]*)/i],[[p,"Solaris"],v],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux|serenityos)/i,/(unix) ?([\w\.]*)/i],[p,v]]},ho=function(sr,dr){if(typeof sr===o&&(dr=sr,sr=r),!(this instanceof ho))return new ho(sr,dr).getResult();var Sn=typeof n!==s&&n.navigator?n.navigator:r,rs=sr||(Sn&&Sn.userAgent?Sn.userAgent:""),Da=Sn&&Sn.userAgentData?Sn.userAgentData:r,Kn=dr?(function(Ut,ka){var Vh={};for(var xc in Ut)ka[xc]&&ka[xc].length%2==0?Vh[xc]=ka[xc].concat(Ut[xc]):Vh[xc]=Ut[xc];return Vh})(XT,dr):XT,bl=Sn&&Sn.userAgent==rs;return this.getBrowser=function(){var Ut={};return Ut[p]=r,Ut[v]=r,Uh.call(Ut,rs,Kn.browser),Ut[l]=(function(ka){return typeof ka===c?ka.replace(/[^\d\.]/g,"").split(".")[0]:r})(Ut[v]),bl&&Sn&&Sn.brave&&typeof Sn.brave.isBrave==i&&(Ut[p]="Brave"),Ut},this.getCPU=function(){var Ut={};return Ut[O]=r,Uh.call(Ut,rs,Kn.cpu),Ut},this.getDevice=function(){var Ut={};return Ut[g]=r,Ut[h]=r,Ut[E]=r,Uh.call(Ut,rs,Kn.device),bl&&!Ut[E]&&Da&&Da.mobile&&(Ut[E]=N),bl&&Ut[h]=="Macintosh"&&Sn&&typeof Sn.standalone!==s&&Sn.maxTouchPoints&&Sn.maxTouchPoints>2&&(Ut[h]="iPad",Ut[E]=M),Ut},this.getEngine=function(){var Ut={};return Ut[p]=r,Ut[v]=r,Uh.call(Ut,rs,Kn.engine),Ut},this.getOS=function(){var Ut={};return Ut[p]=r,Ut[v]=r,Uh.call(Ut,rs,Kn.os),bl&&!Ut[p]&&Da&&Da.platform&&Da.platform!="Unknown"&&(Ut[p]=Da.platform.replace(/chrome os/i,Te).replace(/macos/i,mt)),Ut},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return rs},this.setUA=function(Ut){return rs=typeof Ut===c&&Ut.length>500?bg(Ut,500):Ut,this},this.setUA(rs),this};ho.VERSION="0.7.40",ho.BROWSER=lr([p,v,l]),ho.CPU=lr([O]),ho.DEVICE=lr([h,g,E,I,N,x,M,B,Z]),ho.ENGINE=ho.OS=lr([p,v]),e.exports&&(t=e.exports=ho),t.UAParser=ho;var wl=typeof n!==s&&(n.jQuery||n.Zepto);if(wl&&!wl.ua){var JT=new ho;wl.ua=JT.getResult(),wl.ua.get=function(){return JT.getUA()},wl.ua.set=function(sr){JT.setUA(sr);var dr=JT.getResult();for(var Sn in dr)wl.ua[Sn]=dr[Sn]}}})(typeof window=="object"?window:y)})($w,$w.exports);var _8=C($w.exports),QP=fd.clear;Jt({global:!0,bind:!0,forced:re.clearImmediate!==QP},{clearImmediate:QP});var ZP=re,E8=le,g8=Ge,v8=Tu,y8=ei,S8=Nr,T8=Ts,R8=ZP.Function,C8=/MSIE .\./.test(y8)||v8==="BUN"&&(function(){var e=ZP.Bun.version.split(".");return e.length<3||e[0]==="0"&&(e[1]<3||e[1]==="3"&&e[2]==="0")})(),w8=Jt,$P=re,eD=fd.set,b8=function(e,t){var n=1;return C8?function(r,i){var s=T8(arguments.length,1)>n,o=g8(r)?r:R8(r),c=s?S8(arguments,n):[],l=s?function(){E8(o,this,c)}:o;return e(l)}:e},tD=$P.setImmediate?b8(eD):eD;w8({global:!0,bind:!0,forced:$P.setImmediate!==tD},{setImmediate:tD});var nD=C(ai.setImmediate),I8=re,A8=hE,N8=Xn,O8=Ts,P8=Fe;Jt({global:!0,dontCallGetSet:!0,forced:A((function(){return P8&&Object.getOwnPropertyDescriptor(I8,"queueMicrotask").value.length!==1}))},{queueMicrotask:function(e){O8(arguments.length,1),A8(N8(e))}});var rD=C(ai.queueMicrotask);function iD(e,t){return function(){return e.apply(t,arguments)}}const{toString:D8}=Object.prototype,{getPrototypeOf:e0}=Object,{iterator:Xy,toStringTag:sD}=Symbol,Jy=(t0=Object.create(null),e=>{const t=D8.call(e);return t0[t]||(t0[t]=t.slice(8,-1).toLowerCase())});var t0;const Ea=e=>(e=e.toLowerCase(),t=>Jy(t)===e),Qy=e=>t=>typeof t===e,{isArray:pf}=Array,RE=Qy("undefined"),oD=Ea("ArrayBuffer"),k8=Qy("string"),ws=Qy("function"),aD=Qy("number"),Zy=e=>e!==null&&typeof e=="object",$y=e=>{if(Jy(e)!=="object")return!1;const t=e0(e);return!(t!==null&&t!==Object.prototype&&Object.getPrototypeOf(t)!==null||sD in e||Xy in e)},L8=Ea("Date"),x8=Ea("File"),M8=Ea("Blob"),U8=Ea("FileList"),V8=Ea("URLSearchParams"),[j8,F8,B8,W8]=["ReadableStream","Request","Response","Headers"].map(Ea);function CE(e,t){let n,r,{allOwnKeys:i=!1}=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(e!=null)if(typeof e!="object"&&(e=[e]),pf(e))for(n=0,r=e.length;n<r;n++)t.call(null,e[n],n,e);else{const s=i?Object.getOwnPropertyNames(e):Object.keys(e),o=s.length;let c;for(n=0;n<o;n++)c=s[n],t.call(null,e[c],c,e)}}function cD(e,t){t=t.toLowerCase();const n=Object.keys(e);let r,i=n.length;for(;i-- >0;)if(r=n[i],t===r.toLowerCase())return r;return null}const dh=JP!==void 0?JP:typeof self<"u"?self:typeof window<"u"?window:QI,lD=e=>!RE(e)&&e!==dh,G8=(n0=typeof Uint8Array<"u"&&e0(Uint8Array),e=>n0&&e instanceof n0);var n0;const H8=Ea("HTMLFormElement"),dD=(e=>{let{hasOwnProperty:t}=e;return(n,r)=>t.call(n,r)})(Object.prototype),K8=Ea("RegExp"),uD=(e,t)=>{const n=Object.getOwnPropertyDescriptors(e),r={};CE(n,((i,s)=>{let o;(o=t(i,s,e))!==!1&&(r[s]=o||i)})),Object.defineProperties(e,r)},z8=Ea("AsyncFunction"),hD=(pD=typeof nD=="function",fD=ws(dh.postMessage),pD?nD:fD?(r0="axios@".concat(Math.random()),eS=[],dh.addEventListener("message",(e=>{let{source:t,data:n}=e;t===dh&&n===r0&&eS.length&&eS.shift()()}),!1),e=>{eS.push(e),dh.postMessage(r0,"*")}):e=>setTimeout(e));var pD,fD,r0,eS;const Y8=rD!==void 0?rD.bind(dh):typeof process<"u"&&process.nextTick||hD;var Ne={isArray:pf,isArrayBuffer:oD,isBuffer:function(e){return e!==null&&!RE(e)&&e.constructor!==null&&!RE(e.constructor)&&ws(e.constructor.isBuffer)&&e.constructor.isBuffer(e)},isFormData:e=>{let t;return e&&(typeof FormData=="function"&&e instanceof FormData||ws(e.append)&&((t=Jy(e))==="formdata"||t==="object"&&ws(e.toString)&&e.toString()==="[object FormData]"))},isArrayBufferView:function(e){let t;return t=typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&oD(e.buffer),t},isString:k8,isNumber:aD,isBoolean:e=>e===!0||e===!1,isObject:Zy,isPlainObject:$y,isReadableStream:j8,isRequest:F8,isResponse:B8,isHeaders:W8,isUndefined:RE,isDate:L8,isFile:x8,isBlob:M8,isRegExp:K8,isFunction:ws,isStream:e=>Zy(e)&&ws(e.pipe),isURLSearchParams:V8,isTypedArray:G8,isFileList:U8,forEach:CE,merge:function e(){const{caseless:t}=lD(this)&&this||{},n={},r=(i,s)=>{const o=t&&cD(n,s)||s;$y(n[o])&&$y(i)?n[o]=e(n[o],i):$y(i)?n[o]=e({},i):pf(i)?n[o]=i.slice():n[o]=i};for(let i=0,s=arguments.length;i<s;i++)arguments[i]&&CE(arguments[i],r);return n},extend:function(e,t,n){let{allOwnKeys:r}=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return CE(t,((i,s)=>{n&&ws(i)?e[s]=iD(i,n):e[s]=i}),{allOwnKeys:r}),e},trim:e=>pi(e)?pi(e).call(e):e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:e=>(e.charCodeAt(0)===65279&&(e=e.slice(1)),e),inherits:(e,t,n,r)=>{e.prototype=Object.create(t.prototype,r),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:t.prototype}),n&&Object.assign(e.prototype,n)},toFlatObject:(e,t,n,r)=>{let i,s,o;const c={};if(t=t||{},e==null)return t;do{for(i=Object.getOwnPropertyNames(e),s=i.length;s-- >0;)o=i[s],r&&!r(o,e,t)||c[o]||(t[o]=e[o],c[o]=!0);e=n!==!1&&e0(e)}while(e&&(!n||n(e,t))&&e!==Object.prototype);return t},kindOf:Jy,kindOfTest:Ea,endsWith:(e,t,n)=>{e=String(e),(n===void 0||n>e.length)&&(n=e.length),n-=t.length;const r=e.indexOf(t,n);return r!==-1&&r===n},toArray:e=>{if(!e)return null;if(pf(e))return e;let t=e.length;if(!aD(t))return null;const n=new Array(t);for(;t-- >0;)n[t]=e[t];return n},forEachEntry:(e,t)=>{const n=(e&&e[Xy]).call(e);let r;for(;(r=n.next())&&!r.done;){const i=r.value;t.call(e,i[0],i[1])}},matchAll:(e,t)=>{let n;const r=[];for(;(n=e.exec(t))!==null;)r.push(n);return r},isHTMLForm:H8,hasOwnProperty:dD,hasOwnProp:dD,reduceDescriptors:uD,freezeMethods:e=>{uD(e,((t,n)=>{if(ws(e)&&["arguments","caller","callee"].indexOf(n)!==-1)return!1;const r=e[n];ws(r)&&(t.enumerable=!1,"writable"in t?t.writable=!1:t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+n+"'")}))}))},toObjectSet:(e,t)=>{const n={},r=i=>{i.forEach((s=>{n[s]=!0}))};return pf(e)?r(e):r(String(e).split(t)),n},toCamelCase:e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,(function(t,n,r){return n.toUpperCase()+r})),noop:()=>{},toFiniteNumber:(e,t)=>e!=null&&Number.isFinite(e=+e)?e:t,findKey:cD,global:dh,isContextDefined:lD,isSpecCompliantForm:function(e){return!!(e&&ws(e.append)&&e[sD]==="FormData"&&e[Xy])},toJSONObject:e=>{const t=new Array(10),n=(r,i)=>{if(Zy(r)){if(t.indexOf(r)>=0)return;if(!("toJSON"in r)){t[i]=r;const s=pf(r)?[]:{};return CE(r,((o,c)=>{const l=n(o,i+1);!RE(l)&&(s[c]=l)})),t[i]=void 0,s}}return r};return n(e,0)},isAsyncFn:z8,isThenable:e=>e&&(Zy(e)||ws(e))&&ws(e.then)&&ws(e.catch),setImmediate:hD,asap:Y8,isIterable:e=>e!=null&&ws(e[Xy])};function sn(e,t,n,r,i){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=e,this.name="AxiosError",t&&(this.code=t),n&&(this.config=n),r&&(this.request=r),i&&(this.response=i,this.status=i.status?i.status:null)}Ne.inherits(sn,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:Ne.toJSONObject(this.config),code:this.code,status:this.status}}});const mD=sn.prototype,_D={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach((e=>{_D[e]={value:e}})),Object.defineProperties(sn,_D),Object.defineProperty(mD,"isAxiosError",{value:!0}),sn.from=(e,t,n,r,i,s)=>{const o=Object.create(mD);return Ne.toFlatObject(e,o,(function(c){return c!==Error.prototype}),(c=>c!=="isAxiosError")),sn.call(o,e.message,t,n,r,i),o.cause=e,o.name=e.name,s&&Object.assign(o,s),o};function i0(e){return Ne.isPlainObject(e)||Ne.isArray(e)}function ED(e){return Ne.endsWith(e,"[]")?e.slice(0,-2):e}function gD(e,t,n){return e?e.concat(t).map((function(r,i){return r=ED(r),!n&&i?"["+r+"]":r})).join(n?".":""):t}const q8=Ne.toFlatObject(Ne,{},null,(function(e){return/^is[A-Z]/.test(e)}));function tS(e,t,n){if(!Ne.isObject(e))throw new TypeError("target must be an object");t=t||new FormData;const r=(n=Ne.toFlatObject(n,{metaTokens:!0,dots:!1,indexes:!1},!1,(function(g,v){return!Ne.isUndefined(v[g])}))).metaTokens,i=n.visitor||h,s=n.dots,o=n.indexes,c=(n.Blob||typeof Blob<"u"&&Blob)&&Ne.isSpecCompliantForm(t);if(!Ne.isFunction(i))throw new TypeError("visitor must be a function");function l(g){if(g===null)return"";if(Ne.isDate(g))return g.toISOString();if(!c&&Ne.isBlob(g))throw new sn("Blob is not supported. Use a Buffer instead.");return Ne.isArrayBuffer(g)||Ne.isTypedArray(g)?c&&typeof Blob=="function"?new Blob([g]):Buffer.from(g):g}function h(g,v,O){let I=g;if(g&&!O&&typeof g=="object"){if(Ne.endsWith(v,"{}"))v=r?v:v.slice(0,-2),g=JSON.stringify(g);else if(Ne.isArray(g)&&(function(N){return Ne.isArray(N)&&!N.some(i0)})(g)||(Ne.isFileList(g)||Ne.endsWith(v,"[]"))&&(I=Ne.toArray(g)))return v=ED(v),I.forEach((function(N,M){!Ne.isUndefined(N)&&N!==null&&t.append(o===!0?gD([v],M,s):o===null?v:v+"[]",l(N))})),!1}return!!i0(g)||(t.append(gD(O,v,s),l(g)),!1)}const p=[],E=Object.assign(q8,{defaultVisitor:h,convertValue:l,isVisitable:i0});if(!Ne.isObject(e))throw new TypeError("data must be an object");return(function g(v,O){if(!Ne.isUndefined(v)){if(p.indexOf(v)!==-1)throw Error("Circular reference detected in "+O.join("."));p.push(v),Ne.forEach(v,(function(I,N){(!(Ne.isUndefined(I)||I===null)&&i.call(t,I,Ne.isString(N)?pi(N).call(N):N,O,E))===!0&&g(I,O?O.concat(N):[N])})),p.pop()}})(e),t}function vD(e){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,(function(n){return t[n]}))}function s0(e,t){this._pairs=[],e&&tS(e,this,t)}const yD=s0.prototype;function X8(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function SD(e,t,n){if(!t)return e;const r=n&&n.encode||X8;Ne.isFunction(n)&&(n={serialize:n});const i=n&&n.serialize;let s;if(s=i?i(t,n):Ne.isURLSearchParams(t)?t.toString():new s0(t,n).toString(r),s){const o=e.indexOf("#");o!==-1&&(e=e.slice(0,o)),e+=(e.indexOf("?")===-1?"?":"&")+s}return e}yD.append=function(e,t){this._pairs.push([e,t])},yD.toString=function(e){const t=e?function(n){return e.call(this,n,vD)}:vD;return this._pairs.map((function(n){return t(n[0])+"="+t(n[1])}),"").join("&")};var TD=class{constructor(){this.handlers=[]}use(e,t,n){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!n&&n.synchronous,runWhen:n?n.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){Ne.forEach(this.handlers,(function(t){t!==null&&e(t)}))}},RD={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},CD={exports:{}},J8=Jt,Q8=Fe,wD=Hi.f;J8({target:"Object",stat:!0,forced:Object.defineProperty!==wD,sham:!Q8},{defineProperty:wD});var bD=ai.Object,Z8=CD.exports=function(e,t,n){return bD.defineProperty(e,t,n)};bD.defineProperty.sham&&(Z8.sham=!0);var ID=C(CD.exports),$8=TypeError,AD=ea,eH=Ur,tH=Sr,nH=kn("species"),ND=Array,rH=function(e){var t;return AD(e)&&(t=e.constructor,(eH(t)&&(t===ND||AD(t.prototype))||tH(t)&&(t=t[nH])===null)&&(t=void 0)),t===void 0?ND:t},OD=function(e,t){return new(rH(e))(t===0?0:t)},iH=A,sH=Oi,oH=kn("species"),PD=function(e){return sH>=51||!iH((function(){var t=[];return(t.constructor={})[oH]=function(){return{foo:1}},t[e](Boolean).foo!==1}))},aH=Jt,cH=A,lH=ea,dH=Sr,uH=So,hH=Qa,DD=function(e){if(e>9007199254740991)throw $8("Maximum allowed index exceeded");return e},kD=Sw,pH=OD,fH=PD,mH=Oi,LD=kn("isConcatSpreadable"),_H=mH>=51||!cH((function(){var e=[];return e[LD]=!1,e.concat()[0]!==e})),EH=function(e){if(!dH(e))return!1;var t=e[LD];return t!==void 0?!!t:lH(e)};aH({target:"Array",proto:!0,forced:!_H||!fH("concat")},{concat:function(e){var t,n,r,i,s,o=uH(this),c=pH(o,0),l=0;for(t=-1,r=arguments.length;t<r;t++)if(EH(s=t===-1?o:arguments[t]))for(i=hH(s),DD(l+i),n=0;n<i;n++,l++)n in s&&kD(c,l,s[n]);else DD(l+1),kD(c,l++,s);return c.length=l,c}});var xD={},gH=xe,vH=Ei,MD=na.f,yH=Nr,UD=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];xD.f=function(e){return UD&&gH(e)==="Window"?(function(t){try{return MD(t)}catch{return yH(UD)}})(e):MD(vH(e))};var ff={},SH=kn;ff.f=SH;var VD=ai,TH=Tr,RH=ff,CH=Hi.f,Or=function(e){var t=VD.Symbol||(VD.Symbol={});TH(t,e)||CH(t,e,{value:RH.f(e)})},wH=Je,bH=Mr,IH=kn,AH=ua,jD=function(){var e=bH("Symbol"),t=e&&e.prototype,n=t&&t.valueOf,r=IH("toPrimitive");t&&!t[r]&&AH(t,r,(function(i){return wH(n,this)}),{})},NH=qa,OH=Wt,PH=So,DH=Qa,kH=OD,FD=K([].push),LH=function(e){var t=e===1,n=e===2,r=e===3,i=e===4,s=e===6,o=e===7,c=e===5||s;return function(l,h,p,E){for(var g,v,O=PH(l),I=OH(O),N=DH(I),M=NH(h,p),x=0,B=E||kH,Z=t?B(l,N):n||o?B(l,0):void 0;N>x;x++)if((c||x in I)&&(v=M(g=I[x],x,O),e))if(t)Z[x]=v;else if(v)switch(e){case 3:return!0;case 5:return g;case 6:return x;case 2:FD(Z,g)}else switch(e){case 4:return!1;case 7:FD(Z,g)}return s?-1:r||i?i:Z}},BD={forEach:LH(0)},nS=Jt,wE=re,o0=Je,xH=K,mf=Fe,_f=vo,MH=A,Ci=Tr,UH=ee,a0=li,rS=Ei,c0=Ln,VH=Ki,l0=rt,Ef=Du,WD=ki,jH=na,GD=xD,FH=ed,HD=pt,KD=Hi,BH=ic,zD=Oe,YD=ua,WH=ac,d0=zc,qD=Ys,XD=Ml,GH=kn,HH=ff,KH=Or,zH=jD,YH=Io,JD=oc,iS=BD.forEach,bs=Zl("hidden"),sS="Symbol",bE="prototype",qH=JD.set,QD=JD.getterFor(sS),ga=Object[bE],uh=wE.Symbol,oS=uh&&uh[bE],XH=wE.RangeError,JH=wE.TypeError,u0=wE.QObject,ZD=HD.f,hh=KD.f,$D=GD.f,QH=zD.f,ek=xH([].push),pl=d0("symbols"),IE=d0("op-symbols"),ZH=d0("wks"),h0=!u0||!u0[bE]||!u0[bE].findChild,tk=function(e,t,n){var r=ZD(ga,t);r&&delete ga[t],hh(e,t,n),r&&e!==ga&&hh(ga,t,r)},p0=mf&&MH((function(){return Ef(hh({},"a",{get:function(){return hh(this,"a",{value:7}).a}})).a!==7}))?tk:hh,f0=function(e,t){var n=pl[e]=Ef(oS);return qH(n,{type:sS,tag:e,description:t}),mf||(n.description=t),n},aS=function(e,t,n){e===ga&&aS(IE,t,n),a0(e);var r=c0(t);return a0(n),Ci(pl,r)?(n.enumerable?(Ci(e,bs)&&e[bs][r]&&(e[bs][r]=!1),n=Ef(n,{enumerable:l0(0,!1)})):(Ci(e,bs)||hh(e,bs,l0(1,Ef(null))),e[bs][r]=!0),p0(e,r,n)):hh(e,r,n)},m0=function(e,t){a0(e);var n=rS(t),r=WD(n).concat(sk(n));return iS(r,(function(i){mf&&!o0(nk,n,i)||aS(e,i,n[i])})),e},nk=function(e){var t=c0(e),n=o0(QH,this,t);return!(this===ga&&Ci(pl,t)&&!Ci(IE,t))&&(!(n||!Ci(this,t)||!Ci(pl,t)||Ci(this,bs)&&this[bs][t])||n)},rk=function(e,t){var n=rS(e),r=c0(t);if(n!==ga||!Ci(pl,r)||Ci(IE,r)){var i=ZD(n,r);return!i||!Ci(pl,r)||Ci(n,bs)&&n[bs][r]||(i.enumerable=!0),i}},ik=function(e){var t=$D(rS(e)),n=[];return iS(t,(function(r){Ci(pl,r)||Ci(qD,r)||ek(n,r)})),n},sk=function(e){var t=e===ga,n=$D(t?IE:rS(e)),r=[];return iS(n,(function(i){!Ci(pl,i)||t&&!Ci(ga,i)||ek(r,pl[i])})),r};_f||(uh=function(){if(UH(oS,this))throw new JH("Symbol is not a constructor");var e=arguments.length&&arguments[0]!==void 0?VH(arguments[0]):void 0,t=XD(e),n=function(r){var i=this===void 0?wE:this;i===ga&&o0(n,IE,r),Ci(i,bs)&&Ci(i[bs],t)&&(i[bs][t]=!1);var s=l0(1,r);try{p0(i,t,s)}catch(o){if(!(o instanceof XH))throw o;tk(i,t,s)}};return mf&&h0&&p0(ga,t,{configurable:!0,set:n}),f0(t,e)},YD(oS=uh[bE],"toString",(function(){return QD(this).tag})),YD(uh,"withoutSetter",(function(e){return f0(XD(e),e)})),zD.f=nk,KD.f=aS,BH.f=m0,HD.f=rk,jH.f=GD.f=ik,FH.f=sk,HH.f=function(e){return f0(GH(e),e)},mf&&WH(oS,"description",{configurable:!0,get:function(){return QD(this).description}})),nS({global:!0,wrap:!0,forced:!_f,sham:!_f},{Symbol:uh}),iS(WD(ZH),(function(e){KH(e)})),nS({target:sS,stat:!0,forced:!_f},{useSetter:function(){h0=!0},useSimple:function(){h0=!1}}),nS({target:"Object",stat:!0,forced:!_f,sham:!mf},{create:function(e,t){return t===void 0?Ef(e):m0(Ef(e),t)},defineProperty:aS,defineProperties:m0,getOwnPropertyDescriptor:rk}),nS({target:"Object",stat:!0,forced:!_f},{getOwnPropertyNames:ik}),zH(),YH(uh,sS),qD[bs]=!0;var ok=vo&&!!Symbol.for&&!!Symbol.keyFor,$H=Jt,eK=Mr,tK=Tr,nK=Ki,ak=zc,rK=ok,_0=ak("string-to-symbol-registry"),iK=ak("symbol-to-string-registry");$H({target:"Symbol",stat:!0,forced:!rK},{for:function(e){var t=nK(e);if(tK(_0,t))return _0[t];var n=eK("Symbol")(t);return _0[t]=n,iK[n]=t,n}});var sK=Jt,oK=Tr,aK=Ga,cK=gn,lK=ok,ck=zc("symbol-to-string-registry");sK({target:"Symbol",stat:!0,forced:!lK},{keyFor:function(e){if(!aK(e))throw new TypeError(cK(e)+" is not a symbol");if(oK(ck,e))return ck[e]}});var lk=ea,dK=Ge,dk=xe,uK=Ki,uk=K([].push),hK=Jt,hk=Mr,pk=le,pK=Je,AE=K,fk=A,mk=Ge,_k=Ga,Ek=Nr,fK=function(e){if(dK(e))return e;if(lk(e)){for(var t=e.length,n=[],r=0;r<t;r++){var i=e[r];typeof i=="string"?uk(n,i):typeof i!="number"&&dk(i)!=="Number"&&dk(i)!=="String"||uk(n,uK(i))}var s=n.length,o=!0;return function(c,l){if(o)return o=!1,l;if(lk(this))return l;for(var h=0;h<s;h++)if(n[h]===c)return l}}},mK=vo,_K=String,Cd=hk("JSON","stringify"),cS=AE(/./.exec),gk=AE("".charAt),EK=AE("".charCodeAt),gK=AE("".replace),vK=AE(1 .toString),yK=/[\uD800-\uDFFF]/g,vk=/^[\uD800-\uDBFF]$/,yk=/^[\uDC00-\uDFFF]$/,Sk=!mK||fk((function(){var e=hk("Symbol")("stringify detection");return Cd([e])!=="[null]"||Cd({a:e})!=="{}"||Cd(Object(e))!=="{}"})),Tk=fk((function(){return Cd("\uDF06\uD834")!=='"\\udf06\\ud834"'||Cd("\uDEAD")!=='"\\udead"'})),SK=function(e,t){var n=Ek(arguments),r=fK(t);if(mk(r)||e!==void 0&&!_k(e))return n[1]=function(i,s){if(mk(r)&&(s=pK(r,this,_K(i),s)),!_k(s))return s},pk(Cd,null,n)},TK=function(e,t,n){var r=gk(n,t-1),i=gk(n,t+1);return cS(vk,e)&&!cS(yk,i)||cS(yk,e)&&!cS(vk,r)?"\\u"+vK(EK(e,0),16):e};Cd&&hK({target:"JSON",stat:!0,forced:Sk||Tk},{stringify:function(e,t,n){var r=Ek(arguments),i=pk(Sk?SK:Cd,null,r);return Tk&&typeof i=="string"?gK(i,yK,TK):i}});var Rk=ed,RK=So;Jt({target:"Object",stat:!0,forced:!vo||A((function(){Rk.f(1)}))},{getOwnPropertySymbols:function(e){var t=Rk.f;return t?t(RK(e)):[]}}),Or("asyncIterator"),Or("hasInstance"),Or("isConcatSpreadable"),Or("iterator"),Or("match"),Or("matchAll"),Or("replace"),Or("search"),Or("species"),Or("split");var CK=jD;Or("toPrimitive"),CK();var wK=Mr,bK=Io;Or("toStringTag"),bK(wK("Symbol"),"Symbol"),Or("unscopables"),Io(re.JSON,"JSON",!0);var IK=ai.Symbol,AK=kn,NK=Hi.f,Ck=AK("metadata"),wk=Function.prototype;wk[Ck]===void 0&&NK(wk,Ck,{value:null}),Or("asyncDispose"),Or("dispose"),Or("metadata");var OK=IK,PK=K,E0=Mr("Symbol"),DK=E0.keyFor,kK=PK(E0.prototype.valueOf),bk=E0.isRegisteredSymbol||function(e){try{return DK(kK(e))!==void 0}catch{return!1}};Jt({target:"Symbol",stat:!0},{isRegisteredSymbol:bk});for(var LK=zc,Ik=Mr,xK=K,MK=Ga,UK=kn,lS=Ik("Symbol"),Ak=lS.isWellKnownSymbol,Nk=Ik("Object","getOwnPropertyNames"),VK=xK(lS.prototype.valueOf),Ok=LK("wks"),g0=0,Pk=Nk(lS),jK=Pk.length;g0<jK;g0++)try{var Dk=Pk[g0];MK(lS[Dk])&&UK(Dk)}catch{}var kk=function(e){if(Ak&&Ak(e))return!0;try{for(var t=VK(e),n=0,r=Nk(Ok),i=r.length;n<i;n++)if(Ok[r[n]]==t)return!0}catch{}return!1};Jt({target:"Symbol",stat:!0,forced:!0},{isWellKnownSymbol:kk}),Or("customMatcher"),Or("observable"),Jt({target:"Symbol",stat:!0},{isRegistered:bk}),Jt({target:"Symbol",stat:!0,forced:!0},{isWellKnown:kk}),Or("matcher"),Or("metadataKey"),Or("patternMatch"),Or("replaceAll");var gf=C(OK),Lk=C(ff.f("iterator"));function NE(e){return NE=typeof gf=="function"&&typeof Lk=="symbol"?function(t){return typeof t}:function(t){return t&&typeof gf=="function"&&t.constructor===gf&&t!==gf.prototype?"symbol":typeof t},NE(e)}var FK=C(ff.f("toPrimitive"));function BK(e){var t=(function(n,r){if(NE(n)!="object"||!n)return n;var i=n[FK];if(i!==void 0){var s=i.call(n,r);if(NE(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(r==="string"?String:Number)(n)})(e,"string");return NE(t)=="symbol"?t:t+""}function k(e,t,n){return(t=BK(t))in e?ID(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var xk=C(BG),WK={isBrowser:!0,classes:{URLSearchParams:xk!==void 0?xk:s0,FormData:typeof FormData<"u"?FormData:null,Blob:typeof Blob<"u"?Blob:null},protocols:["http","https","file","blob","url","data"]};const v0=typeof window<"u"&&typeof document<"u",y0=typeof navigator=="object"&&navigator||void 0,GK=v0&&(!y0||["ReactNative","NativeScript","NS"].indexOf(y0.product)<0),HK=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",KK=v0&&window.location.href||"http://localhost";function Mk(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable}))),n.push.apply(n,r)}return n}function Uk(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Mk(Object(n),!0).forEach((function(r){k(e,r,n[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Mk(Object(n)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))}))}return e}var Qi=Uk(Uk({},Object.freeze({__proto__:null,hasBrowserEnv:v0,hasStandardBrowserEnv:GK,hasStandardBrowserWebWorkerEnv:HK,navigator:y0,origin:KK})),WK),zK=li,YK=Je,qK=Tr,XK=ee,JK=function(){var e=zK(this),t="";return e.hasIndices&&(t+="d"),e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.unicodeSets&&(t+="v"),e.sticky&&(t+="y"),t},Vk=RegExp.prototype,jk=function(e){var t=e.flags;return t!==void 0||"flags"in Vk||qK(e,"flags")||!XK(Vk,e)?t:YK(JK,e)},QK=aw.charAt,Fk=Je,ZK=li,$K=Ge,ez=xe,tz=/./.exec,nz=TypeError,rz=Jt,Bk=Je,Wk=Et,iz=Gu,dS=Bp,Gk=er,Hk=pv,OE=Ki,sz=li,oz=Sr,az=xe,cz=Km,Kk=jk,lz=ss,dz=A,uz=cl,hz=function(e,t,n){return t+(n?QK(e,t).length:1)},pz=function(e,t){var n=e.exec;if($K(n)){var r=Fk(n,e,t);return r!==null&&ZK(r),r}if(ez(e)==="RegExp")return Fk(tz,e,t);throw new nz("RegExp#exec called on incompatible receiver")},zk=oc,fz=kn("matchAll"),Yk="RegExp String",qk=Yk+" Iterator",mz=zk.set,_z=zk.getterFor(qk),Ez=TypeError,S0=Wk("".indexOf),uS=Wk("".matchAll),T0=!!uS&&!dz((function(){uS("a",/./)})),gz=iz((function(e,t,n,r){mz(this,{type:qk,regexp:e,string:t,global:n,unicode:r,done:!1})}),Yk,(function(){var e=_z(this);if(e.done)return dS(void 0,!0);var t=e.regexp,n=e.string,r=pz(t,n);return r===null?(e.done=!0,dS(void 0,!0)):e.global?(OE(r[0])===""&&(t.lastIndex=hz(n,Hk(t.lastIndex),e.unicode)),dS(r,!1)):(e.done=!0,dS(r,!1))})),Xk=function(e){var t,n,r,i=sz(this),s=OE(e),o=uz(i,RegExp),c=OE(Kk(i));return t=new o(o===RegExp?i.source:i,c),n=!!~S0(c,"g"),r=!!~S0(c,"u"),t.lastIndex=Hk(i.lastIndex),new gz(t,s,n,r)};rz({target:"String",proto:!0,forced:T0},{matchAll:function(e){var t,n,r,i,s=Gk(this);if(oz(e)){if(cz(e)&&(t=OE(Gk(Kk(e))),!~S0(t,"g")))throw new Ez("`.matchAll` does not allow non-global regexes");if(T0)return uS(s,e);if((r=lz(e,fz))===void 0&&az(e)==="RegExp"&&(r=Xk),r)return Bk(r,e,s)}else if(T0)return uS(s,e);return n=OE(s),i=new RegExp(e,"g"),Bk(Xk,i,n)}});var vz=as("String","matchAll"),yz=ee,Sz=vz,R0=String.prototype,Tz=function(e){var t=e.matchAll;return typeof e=="string"||e===R0||yz(R0,e)&&t===R0.matchAll?Sz:t},Rz=C(Tz);function Jk(e){function t(n,r,i,s){let o=n[s++];if(o==="__proto__")return!0;const c=Number.isFinite(+o),l=s>=n.length;return o=!o&&Ne.isArray(i)?i.length:o,l?(Ne.hasOwnProp(i,o)?i[o]=[i[o],r]:i[o]=r,!c):(i[o]&&Ne.isObject(i[o])||(i[o]=[]),t(n,r,i[o],s)&&Ne.isArray(i[o])&&(i[o]=(function(h){const p={},E=Object.keys(h);let g;const v=E.length;let O;for(g=0;g<v;g++)O=E[g],p[O]=h[O];return p})(i[o])),!c)}if(Ne.isFormData(e)&&Ne.isFunction(e.entries)){const n={};return Ne.forEachEntry(e,((r,i)=>{t((function(s){return Rz(Ne).call(Ne,/\w+|\[(\w*)]/g,s).map((o=>o[0]==="[]"?"":o[1]||o[0]))})(r),i,n,0)})),n}return null}const C0={transitional:RD,adapter:["xhr","http","fetch"],transformRequest:[function(e,t){const n=t.getContentType()||"",r=n.indexOf("application/json")>-1,i=Ne.isObject(e);if(i&&Ne.isHTMLForm(e)&&(e=new FormData(e)),Ne.isFormData(e))return r?JSON.stringify(Jk(e)):e;if(Ne.isArrayBuffer(e)||Ne.isBuffer(e)||Ne.isStream(e)||Ne.isFile(e)||Ne.isBlob(e)||Ne.isReadableStream(e))return e;if(Ne.isArrayBufferView(e))return e.buffer;if(Ne.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let s;if(i){if(n.indexOf("application/x-www-form-urlencoded")>-1)return(function(o,c){return tS(o,new Qi.classes.URLSearchParams,Object.assign({visitor:function(l,h,p,E){return Qi.isNode&&Ne.isBuffer(l)?(this.append(h,l.toString("base64")),!1):E.defaultVisitor.apply(this,arguments)}},c))})(e,this.formSerializer).toString();if((s=Ne.isFileList(e))||n.indexOf("multipart/form-data")>-1){const o=this.env&&this.env.FormData;return tS(s?{"files[]":e}:e,o&&new o,this.formSerializer)}}return i||r?(t.setContentType("application/json",!1),(function(o,c,l){if(Ne.isString(o))try{return(c||JSON.parse)(o),pi(Ne).call(Ne,o)}catch(h){if(h.name!=="SyntaxError")throw h}return(l||JSON.stringify)(o)})(e)):e}],transformResponse:[function(e){const t=this.transitional||C0.transitional,n=t&&t.forcedJSONParsing,r=this.responseType==="json";if(Ne.isResponse(e)||Ne.isReadableStream(e))return e;if(e&&Ne.isString(e)&&(n&&!this.responseType||r)){const i=!(t&&t.silentJSONParsing)&&r;try{return JSON.parse(e)}catch(s){if(i)throw s.name==="SyntaxError"?sn.from(s,sn.ERR_BAD_RESPONSE,this,null,this.response):s}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Qi.classes.FormData,Blob:Qi.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};Ne.forEach(["delete","get","head","post","put","patch"],(e=>{C0.headers[e]={}}));var w0=C0;const Cz=Ne.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),Qk=Symbol("internals");function PE(e){var t;return e&&pi(t=String(e)).call(t).toLowerCase()}function hS(e){return e===!1||e==null?e:Ne.isArray(e)?e.map(hS):String(e)}function b0(e,t,n,r,i){return Ne.isFunction(r)?r.call(this,t,n):(i&&(t=n),Ne.isString(t)?Ne.isString(r)?t.indexOf(r)!==-1:Ne.isRegExp(r)?r.test(t):void 0:void 0)}class pS{constructor(t){t&&this.set(t)}set(t,n,r){const i=this;function s(l,h,p){const E=PE(h);if(!E)throw new Error("header name must be a non-empty string");const g=Ne.findKey(i,E);(!g||i[g]===void 0||p===!0||p===void 0&&i[g]!==!1)&&(i[g||h]=hS(l))}const o=(l,h)=>Ne.forEach(l,((p,E)=>s(p,E,h)));if(Ne.isPlainObject(t)||t instanceof this.constructor)o(t,n);else if(Ne.isString(t)&&(t=pi(t).call(t))&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(pi(c=t).call(c)))o((l=>{const h={};let p,E,g;return l&&l.split(`
`).forEach((function(v){var O,I;g=v.indexOf(":"),p=pi(O=v.substring(0,g)).call(O).toLowerCase(),E=pi(I=v.substring(g+1)).call(I),!p||h[p]&&Cz[p]||(p==="set-cookie"?h[p]?h[p].push(E):h[p]=[E]:h[p]=h[p]?h[p]+", "+E:E)})),h})(t),n);else if(Ne.isObject(t)&&Ne.isIterable(t)){let l,h,p={};for(const E of t){if(!Ne.isArray(E))throw TypeError("Object iterator must return a key-value pair");p[h=E[0]]=(l=p[h])?Ne.isArray(l)?[...l,E[1]]:[l,E[1]]:E[1]}o(p,n)}else t!=null&&s(n,t,r);var c;return this}get(t,n){if(t=PE(t)){const r=Ne.findKey(this,t);if(r){const i=this[r];if(!n)return i;if(n===!0)return(function(s){const o=Object.create(null),c=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let l;for(;l=c.exec(s);)o[l[1]]=l[2];return o})(i);if(Ne.isFunction(n))return n.call(this,i,r);if(Ne.isRegExp(n))return n.exec(i);throw new TypeError("parser must be boolean|regexp|function")}}}has(t,n){if(t=PE(t)){const r=Ne.findKey(this,t);return!(!r||this[r]===void 0||n&&!b0(0,this[r],r,n))}return!1}delete(t,n){const r=this;let i=!1;function s(o){if(o=PE(o)){const c=Ne.findKey(r,o);!c||n&&!b0(0,r[c],c,n)||(delete r[c],i=!0)}}return Ne.isArray(t)?t.forEach(s):s(t),i}clear(t){const n=Object.keys(this);let r=n.length,i=!1;for(;r--;){const s=n[r];t&&!b0(0,this[s],s,t,!0)||(delete this[s],i=!0)}return i}normalize(t){const n=this,r={};return Ne.forEach(this,((i,s)=>{var o;const c=Ne.findKey(r,s);if(c)return n[c]=hS(i),void delete n[s];const l=t?(function(h){return pi(h).call(h).toLowerCase().replace(/([a-z\d])(\w*)/g,((p,E,g)=>E.toUpperCase()+g))})(s):pi(o=String(s)).call(o);l!==s&&delete n[s],n[l]=hS(i),r[l]=!0})),this}concat(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return this.constructor.concat(this,...n)}toJSON(t){const n=Object.create(null);return Ne.forEach(this,((r,i)=>{r!=null&&r!==!1&&(n[i]=t&&Ne.isArray(r)?r.join(", "):r)})),n}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map((t=>{let[n,r]=t;return n+": "+r})).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(t){return t instanceof this?t:new this(t)}static concat(t){const n=new this(t);for(var r=arguments.length,i=new Array(r>1?r-1:0),s=1;s<r;s++)i[s-1]=arguments[s];return i.forEach((o=>n.set(o))),n}static accessor(t){const n=(this[Qk]=this[Qk]={accessors:{}}).accessors,r=this.prototype;function i(s){const o=PE(s);n[o]||((function(c,l){const h=Ne.toCamelCase(" "+l);["get","set","has"].forEach((p=>{Object.defineProperty(c,p+h,{value:function(E,g,v){return this[p].call(this,l,E,g,v)},configurable:!0})}))})(r,s),n[o]=!0)}return Ne.isArray(t)?t.forEach(i):i(t),this}}pS.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),Ne.reduceDescriptors(pS.prototype,((e,t)=>{let{value:n}=e,r=t[0].toUpperCase()+t.slice(1);return{get:()=>n,set(i){this[r]=i}}})),Ne.freezeMethods(pS);var va=pS;function I0(e,t){const n=this||w0,r=t||n,i=va.from(r.headers);let s=r.data;return Ne.forEach(e,(function(o){s=o.call(n,s,i.normalize(),t?t.status:void 0)})),i.normalize(),s}function Zk(e){return!(!e||!e.__CANCEL__)}function vf(e,t,n){sn.call(this,e??"canceled",sn.ERR_CANCELED,t,n),this.name="CanceledError"}function $k(e,t,n){const r=n.config.validateStatus;n.status&&r&&!r(n.status)?t(new sn("Request failed with status code "+n.status,[sn.ERR_BAD_REQUEST,sn.ERR_BAD_RESPONSE][Math.floor(n.status/100)-4],n.config,n.request,n)):e(n)}Ne.inherits(vf,sn,{__CANCEL__:!0});const fS=function(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,r=0;const i=(function(s,o){s=s||10;const c=new Array(s),l=new Array(s);let h,p=0,E=0;return o=o!==void 0?o:1e3,function(g){const v=Date.now(),O=l[E];h||(h=v),c[p]=g,l[p]=v;let I=E,N=0;for(;I!==p;)N+=c[I++],I%=s;if(p=(p+1)%s,p===E&&(E=(E+1)%s),v-h<o)return;const M=O&&v-O;return M?Math.round(1e3*N/M):void 0}})(50,250);return(function(s,o){let c,l,h=0,p=1e3/o;const E=function(g){h=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Date.now(),c=null,l&&(clearTimeout(l),l=null),s.apply(null,g)};return[function(){const g=Date.now(),v=g-h;for(var O=arguments.length,I=new Array(O),N=0;N<O;N++)I[N]=arguments[N];v>=p?E(I,g):(c=I,l||(l=setTimeout((()=>{l=null,E(c)}),p-v)))},()=>c&&E(c)]})((s=>{const o=s.loaded,c=s.lengthComputable?s.total:void 0,l=o-r,h=i(l);r=o,e({loaded:o,total:c,progress:c?o/c:void 0,bytes:l,rate:h||void 0,estimated:h&&c&&o<=c?(c-o)/h:void 0,event:s,lengthComputable:c!=null,[t?"download":"upload"]:!0})}),n)},e1=(e,t)=>{const n=e!=null;return[r=>t[0]({lengthComputable:n,total:e,loaded:r}),t[1]]},t1=e=>function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return Ne.asap((()=>e(...n)))};var wz=Qi.hasStandardBrowserEnv?((e,t)=>n=>(n=new Wy(n,Qi.origin),e.protocol===n.protocol&&e.host===n.host&&(t||e.port===n.port)))(new Wy(Qi.origin),Qi.navigator&&/(msie|trident)/i.test(Qi.navigator.userAgent)):()=>!0,bz=Qi.hasStandardBrowserEnv?{write(e,t,n,r,i,s){const o=[e+"="+encodeURIComponent(t)];Ne.isNumber(n)&&o.push("expires="+new Date(n).toGMTString()),Ne.isString(r)&&o.push("path="+r),Ne.isString(i)&&o.push("domain="+i),s===!0&&o.push("secure"),document.cookie=o.join("; ")},read(e){const t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove(e){this.write(e,"",Date.now()-864e5)}}:{write(){},read:()=>null,remove(){}};function n1(e,t,n){let r=!(function(i){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(i)})(t);return e&&(r||n==0)?(function(i,s){return s?i.replace(/\/?\/$/,"")+"/"+s.replace(/^\/+/,""):i})(e,t):t}function r1(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable}))),n.push.apply(n,r)}return n}const i1=e=>e instanceof va?(function(t){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?r1(Object(r),!0).forEach((function(i){k(t,i,r[i])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):r1(Object(r)).forEach((function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(r,i))}))}return t})({},e):e;function ph(e,t){t=t||{};const n={};function r(h,p,E,g){return Ne.isPlainObject(h)&&Ne.isPlainObject(p)?Ne.merge.call({caseless:g},h,p):Ne.isPlainObject(p)?Ne.merge({},p):Ne.isArray(p)?p.slice():p}function i(h,p,E,g){return Ne.isUndefined(p)?Ne.isUndefined(h)?void 0:r(void 0,h,0,g):r(h,p,0,g)}function s(h,p){if(!Ne.isUndefined(p))return r(void 0,p)}function o(h,p){return Ne.isUndefined(p)?Ne.isUndefined(h)?void 0:r(void 0,h):r(void 0,p)}function c(h,p,E){return E in t?r(h,p):E in e?r(void 0,h):void 0}const l={url:s,method:s,data:s,baseURL:o,transformRequest:o,transformResponse:o,paramsSerializer:o,timeout:o,timeoutMessage:o,withCredentials:o,withXSRFToken:o,adapter:o,responseType:o,xsrfCookieName:o,xsrfHeaderName:o,onUploadProgress:o,onDownloadProgress:o,decompress:o,maxContentLength:o,maxBodyLength:o,beforeRedirect:o,transport:o,httpAgent:o,httpsAgent:o,cancelToken:o,socketPath:o,responseEncoding:o,validateStatus:c,headers:(h,p,E)=>i(i1(h),i1(p),0,!0)};return Ne.forEach(Object.keys(Object.assign({},e,t)),(function(h){const p=l[h]||i,E=p(e[h],t[h],h);Ne.isUndefined(E)&&p!==c||(n[h]=E)})),n}var s1=e=>{const t=ph({},e);let n,{data:r,withXSRFToken:i,xsrfHeaderName:s,xsrfCookieName:o,headers:c,auth:l}=t;if(t.headers=c=va.from(c),t.url=SD(n1(t.baseURL,t.url,t.allowAbsoluteUrls),e.params,e.paramsSerializer),l&&c.set("Authorization","Basic "+btoa((l.username||"")+":"+(l.password?unescape(encodeURIComponent(l.password)):""))),Ne.isFormData(r)){if(Qi.hasStandardBrowserEnv||Qi.hasStandardBrowserWebWorkerEnv)c.setContentType(void 0);else if((n=c.getContentType())!==!1){const[h,...p]=n?n.split(";").map((E=>pi(E).call(E))).filter(Boolean):[];c.setContentType([h||"multipart/form-data",...p].join("; "))}}if(Qi.hasStandardBrowserEnv&&(i&&Ne.isFunction(i)&&(i=i(t)),i||i!==!1&&wz(t.url))){const h=s&&o&&bz.read(o);h&&c.set(s,h)}return t},Iz=typeof XMLHttpRequest<"u"&&function(e){return new Pe((function(t,n){const r=s1(e);let i=r.data;const s=va.from(r.headers).normalize();let o,c,l,h,p,{responseType:E,onUploadProgress:g,onDownloadProgress:v}=r;function O(){h&&h(),p&&p(),r.cancelToken&&r.cancelToken.unsubscribe(o),r.signal&&r.signal.removeEventListener("abort",o)}let I=new XMLHttpRequest;function N(){if(!I)return;const x=va.from("getAllResponseHeaders"in I&&I.getAllResponseHeaders());$k((function(B){t(B),O()}),(function(B){n(B),O()}),{data:E&&E!=="text"&&E!=="json"?I.response:I.responseText,status:I.status,statusText:I.statusText,headers:x,config:e,request:I}),I=null}I.open(r.method.toUpperCase(),r.url,!0),I.timeout=r.timeout,"onloadend"in I?I.onloadend=N:I.onreadystatechange=function(){I&&I.readyState===4&&(I.status!==0||I.responseURL&&I.responseURL.indexOf("file:")===0)&&setTimeout(N)},I.onabort=function(){I&&(n(new sn("Request aborted",sn.ECONNABORTED,e,I)),I=null)},I.onerror=function(){n(new sn("Network Error",sn.ERR_NETWORK,e,I)),I=null},I.ontimeout=function(){let x=r.timeout?"timeout of "+r.timeout+"ms exceeded":"timeout exceeded";const B=r.transitional||RD;r.timeoutErrorMessage&&(x=r.timeoutErrorMessage),n(new sn(x,B.clarifyTimeoutError?sn.ETIMEDOUT:sn.ECONNABORTED,e,I)),I=null},i===void 0&&s.setContentType(null),"setRequestHeader"in I&&Ne.forEach(s.toJSON(),(function(x,B){I.setRequestHeader(B,x)})),Ne.isUndefined(r.withCredentials)||(I.withCredentials=!!r.withCredentials),E&&E!=="json"&&(I.responseType=r.responseType),v&&([l,p]=fS(v,!0),I.addEventListener("progress",l)),g&&I.upload&&([c,h]=fS(g),I.upload.addEventListener("progress",c),I.upload.addEventListener("loadend",h)),(r.cancelToken||r.signal)&&(o=x=>{I&&(n(!x||x.type?new vf(null,e,I):x),I.abort(),I=null)},r.cancelToken&&r.cancelToken.subscribe(o),r.signal&&(r.signal.aborted?o():r.signal.addEventListener("abort",o)));const M=(function(x){const B=/^([-+\w]{1,25})(:?\/\/|:)/.exec(x);return B&&B[1]||""})(r.url);M&&Qi.protocols.indexOf(M)===-1?n(new sn("Unsupported protocol "+M+":",sn.ERR_BAD_REQUEST,e)):I.send(i||null)}))},Az=(e,t)=>{const{length:n}=e=e?e.filter(Boolean):[];if(t||n){let r,i=new AbortController;const s=function(h){if(!r){r=!0,c();const p=h instanceof Error?h:this.reason;i.abort(p instanceof sn?p:new vf(p instanceof Error?p.message:p))}};let o=t&&setTimeout((()=>{o=null,s(new sn("timeout ".concat(t," of ms exceeded"),sn.ETIMEDOUT))}),t);const c=()=>{e&&(o&&clearTimeout(o),o=null,e.forEach((h=>{h.unsubscribe?h.unsubscribe(s):h.removeEventListener("abort",s)})),e=null)};e.forEach((h=>h.addEventListener("abort",s)));const{signal:l}=i;return l.unsubscribe=()=>Ne.asap(c),l}},A0=C(zN),o1=ff.f("asyncIterator"),Nz=C(o1);function N0(e,t){this.v=e,this.k=t}function eo(e){return function(){return new DE(e.apply(this,arguments))}}function DE(e){var t,n;function r(s,o){try{var c=e[s](o),l=c.value,h=l instanceof N0;A0.resolve(h?l.v:l).then((function(p){if(h){var E=s==="return"?"return":"next";if(!l.k||p.done)return r(E,p);p=e[E](p).value}i(c.done?"return":"normal",p)}),(function(p){r("throw",p)}))}catch(p){i("throw",p)}}function i(s,o){switch(s){case"return":t.resolve({value:o,done:!0});break;case"throw":t.reject(o);break;default:t.resolve({value:o,done:!1})}(t=t.next)?r(t.key,t.arg):n=null}this._invoke=function(s,o){return new A0((function(c,l){var h={key:s,arg:o,resolve:c,reject:l,next:null};n?n=n.next=h:(t=n=h,r(s,o))}))},typeof e.return!="function"&&(this.return=void 0)}function jt(e){return new N0(e,0)}function mS(e){var t={},n=!1;function r(i,s){return n=!0,s=new A0((function(o){o(e[i](s))})),{done:!1,value:new N0(s,1)}}return t[gf!==void 0&&Lk||"@@iterator"]=function(){return this},t.next=function(i){return n?(n=!1,i):r("next",i)},typeof e.throw=="function"&&(t.throw=function(i){if(n)throw n=!1,i;return r("throw",i)}),typeof e.return=="function"&&(t.return=function(i){return n?(n=!1,i):r("return",i)}),t}DE.prototype[typeof gf=="function"&&Nz||"@@asyncIterator"]=function(){return this},DE.prototype.next=function(e){return this._invoke("next",e)},DE.prototype.throw=function(e){return this._invoke("throw",e)},DE.prototype.return=function(e){return this._invoke("return",e)};var O0=C(o1);function P0(e){var t,n,r,i=2;for(typeof Symbol<"u"&&(n=O0,r=Symbol.iterator);i--;){if(n&&(t=e[n])!=null)return t.call(e);if(r&&(t=e[r])!=null)return new _S(t.call(e));n="@@asyncIterator",r="@@iterator"}throw new TypeError("Object is not async iterable")}function _S(e){function t(n){if(Object(n)!==n)return Pe.reject(new TypeError(n+" is not an object."));var r=n.done;return Pe.resolve(n.value).then((function(i){return{value:i,done:r}}))}return _S=function(n){this.s=n,this.n=n.next},_S.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(n){var r=this.s.return;return r===void 0?Pe.resolve({value:n,done:!0}):t(r.apply(this.s,arguments))},throw:function(n){var r=this.s.return;return r===void 0?Pe.reject(n):t(r.apply(this.s,arguments))}},new _S(e)}const Oz=function*(e,t){let n=e.byteLength;if(!t||n<t)return void(yield e);let r,i=0;for(;i<n;)r=i+t,yield e.slice(i,r),i=r},Pz=(function(){var e=eo((function*(t,n){var r,i=!1,s=!1;try{for(var o,c=P0(Dz(t));i=!(o=yield jt(c.next())).done;i=!1){const l=o.value;yield*mS(P0(Oz(l,n)))}}catch(l){s=!0,r=l}finally{try{i&&c.return!=null&&(yield jt(c.return()))}finally{if(s)throw r}}}));return function(t,n){return e.apply(this,arguments)}})(),Dz=(function(){var e=eo((function*(t){if(t[O0])return void(yield*mS(P0(t)));const n=t.getReader();try{for(;;){const{done:r,value:i}=yield jt(n.read());if(r)break;yield i}}finally{yield jt(n.cancel())}}));return function(t){return e.apply(this,arguments)}})(),a1=(e,t,n,r)=>{const i=Pz(e,t);let s,o=0,c=l=>{s||(s=!0,r&&r(l))};return new ReadableStream({async pull(l){try{const{done:h,value:p}=await i.next();if(h)return c(),void l.close();let E=p.byteLength;if(n){let g=o+=E;n(g)}l.enqueue(new Uint8Array(p))}catch(h){throw c(h),h}},cancel:l=>(c(l),i.return())},{highWaterMark:2})};function c1(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable}))),n.push.apply(n,r)}return n}function l1(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?c1(Object(n),!0).forEach((function(r){k(e,r,n[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):c1(Object(n)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))}))}return e}const ES=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",d1=ES&&typeof ReadableStream=="function",kz=ES&&(typeof TextEncoder=="function"?(u1=new TextEncoder,e=>u1.encode(e)):async e=>new Uint8Array(await new Response(e).arrayBuffer()));var u1;const h1=function(e){try{for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return!!e(...n)}catch{return!1}},Lz=d1&&h1((()=>{let e=!1;const t=new Request(Qi.origin,{body:new ReadableStream,method:"POST",get duplex(){return e=!0,"half"}}).headers.has("Content-Type");return e&&!t})),D0=d1&&h1((()=>Ne.isReadableStream(new Response("").body))),gS={stream:D0&&(e=>e.body)};var p1;ES&&(p1=new Response,["text","arrayBuffer","blob","formData","stream"].forEach((e=>{!gS[e]&&(gS[e]=Ne.isFunction(p1[e])?t=>t[e]():(t,n)=>{throw new sn("Response type '".concat(e,"' is not supported"),sn.ERR_NOT_SUPPORT,n)})})));const xz=async(e,t)=>{const n=Ne.toFiniteNumber(e.getContentLength());return n??(async r=>r==null?0:Ne.isBlob(r)?r.size:Ne.isSpecCompliantForm(r)?(await new Request(Qi.origin,{method:"POST",body:r}).arrayBuffer()).byteLength:Ne.isArrayBufferView(r)||Ne.isArrayBuffer(r)?r.byteLength:(Ne.isURLSearchParams(r)&&(r+=""),Ne.isString(r)?(await kz(r)).byteLength:void 0))(t)};var Mz=ES&&(async e=>{let{url:t,method:n,data:r,signal:i,cancelToken:s,timeout:o,onDownloadProgress:c,onUploadProgress:l,responseType:h,headers:p,withCredentials:E="same-origin",fetchOptions:g}=s1(e);h=h?(h+"").toLowerCase():"text";let v,O=Az([i,s&&s.toAbortSignal()],o);const I=O&&O.unsubscribe&&(()=>{O.unsubscribe()});let N;try{if(l&&Lz&&n!=="get"&&n!=="head"&&(N=await xz(p,r))!==0){let Q,z=new Request(t,{method:"POST",body:r,duplex:"half"});if(Ne.isFormData(r)&&(Q=z.headers.get("content-type"))&&p.setContentType(Q),z.body){const[te,de]=e1(N,fS(t1(l)));r=a1(z.body,65536,te,de)}}Ne.isString(E)||(E=E?"include":"omit");const M="credentials"in Request.prototype;v=new Request(t,l1(l1({},g),{},{signal:O,method:n.toUpperCase(),headers:p.normalize().toJSON(),body:r,duplex:"half",credentials:M?E:void 0}));let x=await fetch(v);const B=D0&&(h==="stream"||h==="response");if(D0&&(c||B&&I)){const Q={};["status","statusText","headers"].forEach((me=>{Q[me]=x[me]}));const z=Ne.toFiniteNumber(x.headers.get("content-length")),[te,de]=c&&e1(z,fS(t1(c),!0))||[];x=new Response(a1(x.body,65536,te,(()=>{de&&de(),I&&I()})),Q)}h=h||"text";let Z=await gS[Ne.findKey(gS,h)||"text"](x,e);return!B&&I&&I(),await new Pe(((Q,z)=>{$k(Q,z,{data:Z,headers:va.from(x.headers),status:x.status,statusText:x.statusText,config:e,request:v})}))}catch(M){throw I&&I(),M&&M.name==="TypeError"&&/Load failed|fetch/i.test(M.message)?Object.assign(new sn("Network Error",sn.ERR_NETWORK,e,v),{cause:M.cause||M}):sn.from(M,M&&M.code,e,v)}});const k0={http:null,xhr:Iz,fetch:Mz};Ne.forEach(k0,((e,t)=>{if(e){try{Object.defineProperty(e,"name",{value:t})}catch{}Object.defineProperty(e,"adapterName",{value:t})}}));const f1=e=>"- ".concat(e),Uz=e=>Ne.isFunction(e)||e===null||e===!1;var m1={getAdapter:e=>{e=Ne.isArray(e)?e:[e];const{length:t}=e;let n,r;const i={};for(let s=0;s<t;s++){let o;if(n=e[s],r=n,!Uz(n)&&(r=k0[(o=String(n)).toLowerCase()],r===void 0))throw new sn("Unknown adapter '".concat(o,"'"));if(r)break;i[o||"#"+s]=r}if(!r){const s=Object.entries(i).map((o=>{let[c,l]=o;return"adapter ".concat(c," ")+(l===!1?"is not supported by the environment":"is not available in the build")}));throw new sn("There is no suitable adapter to dispatch the request "+(t?s.length>1?`since :
`+s.map(f1).join(`
`):" "+f1(s[0]):"as no adapter specified"),"ERR_NOT_SUPPORT")}return r},adapters:k0};function L0(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new vf(null,e)}function _1(e){return L0(e),e.headers=va.from(e.headers),e.data=I0.call(e,e.transformRequest),["post","put","patch"].indexOf(e.method)!==-1&&e.headers.setContentType("application/x-www-form-urlencoded",!1),m1.getAdapter(e.adapter||w0.adapter)(e).then((function(t){return L0(e),t.data=I0.call(e,e.transformResponse,t),t.headers=va.from(t.headers),t}),(function(t){return Zk(t)||(L0(e),t&&t.response&&(t.response.data=I0.call(e,e.transformResponse,t.response),t.response.headers=va.from(t.response.headers))),Pe.reject(t)}))}const E1="1.9.0",vS={};["object","boolean","number","function","string","symbol"].forEach(((e,t)=>{vS[e]=function(n){return typeof n===e||"a"+(t<1?"n ":" ")+e}}));const g1={};vS.transitional=function(e,t,n){function r(i,s){return"[Axios v"+E1+"] Transitional option '"+i+"'"+s+(n?". "+n:"")}return(i,s,o)=>{if(e===!1)throw new sn(r(s," has been removed"+(t?" in "+t:"")),sn.ERR_DEPRECATED);return t&&!g1[s]&&(g1[s]=!0,console.warn(r(s," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(i,s,o)}},vS.spelling=function(e){return(t,n)=>(console.warn("".concat(n," is likely a misspelling of ").concat(e)),!0)};var yS={assertOptions:function(e,t,n){if(typeof e!="object")throw new sn("options must be an object",sn.ERR_BAD_OPTION_VALUE);const r=Object.keys(e);let i=r.length;for(;i-- >0;){const s=r[i],o=t[s];if(o){const c=e[s],l=c===void 0||o(c,s,e);if(l!==!0)throw new sn("option "+s+" must be "+l,sn.ERR_BAD_OPTION_VALUE)}else if(n!==!0)throw new sn("Unknown option "+s,sn.ERR_BAD_OPTION)}},validators:vS};const vc=yS.validators;let SS=class{constructor(e){this.defaults=e||{},this.interceptors={request:new TD,response:new TD}}async request(e,t){try{return await this._request(e,t)}catch(n){if(n instanceof Error){let r={};Error.captureStackTrace?Error.captureStackTrace(r):r=new Error;const i=r.stack?r.stack.replace(/^.+\n/,""):"";try{n.stack?i&&!String(n.stack).endsWith(i.replace(/^.+\n.+\n/,""))&&(n.stack+=`
`+i):n.stack=i}catch{}}throw n}}_request(e,t){typeof e=="string"?(t=t||{}).url=e:t=e||{},t=ph(this.defaults,t);const{transitional:n,paramsSerializer:r,headers:i}=t;n!==void 0&&yS.assertOptions(n,{silentJSONParsing:vc.transitional(vc.boolean),forcedJSONParsing:vc.transitional(vc.boolean),clarifyTimeoutError:vc.transitional(vc.boolean)},!1),r!=null&&(Ne.isFunction(r)?t.paramsSerializer={serialize:r}:yS.assertOptions(r,{encode:vc.function,serialize:vc.function},!0)),t.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?t.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:t.allowAbsoluteUrls=!0),yS.assertOptions(t,{baseUrl:vc.spelling("baseURL"),withXsrfToken:vc.spelling("withXSRFToken")},!0),t.method=(t.method||this.defaults.method||"get").toLowerCase();let s=i&&Ne.merge(i.common,i[t.method]);i&&Ne.forEach(["delete","get","head","post","put","patch","common"],(v=>{delete i[v]})),t.headers=va.concat(s,i);const o=[];let c=!0;this.interceptors.request.forEach((function(v){typeof v.runWhen=="function"&&v.runWhen(t)===!1||(c=c&&v.synchronous,o.unshift(v.fulfilled,v.rejected))}));const l=[];let h;this.interceptors.response.forEach((function(v){l.push(v.fulfilled,v.rejected)}));let p,E=0;if(!c){const v=[_1.bind(this),void 0];for(v.unshift.apply(v,o),v.push.apply(v,l),p=v.length,h=Pe.resolve(t);E<p;)h=h.then(v[E++],v[E++]);return h}p=o.length;let g=t;for(E=0;E<p;){const v=o[E++],O=o[E++];try{g=v(g)}catch(I){O.call(this,I);break}}try{h=_1.call(this,g)}catch(v){return Pe.reject(v)}for(E=0,p=l.length;E<p;)h=h.then(l[E++],l[E++]);return h}getUri(e){return SD(n1((e=ph(this.defaults,e)).baseURL,e.url,e.allowAbsoluteUrls),e.params,e.paramsSerializer)}};Ne.forEach(["delete","get","head","options"],(function(e){SS.prototype[e]=function(t,n){return this.request(ph(n||{},{method:e,url:t,data:(n||{}).data}))}})),Ne.forEach(["post","put","patch"],(function(e){function t(n){return function(r,i,s){return this.request(ph(s||{},{method:e,headers:n?{"Content-Type":"multipart/form-data"}:{},url:r,data:i}))}}SS.prototype[e]=t(),SS.prototype[e+"Form"]=t(!0)}));var TS=SS;class x0{constructor(t){if(typeof t!="function")throw new TypeError("executor must be a function.");let n;this.promise=new Pe((function(i){n=i}));const r=this;this.promise.then((i=>{if(!r._listeners)return;let s=r._listeners.length;for(;s-- >0;)r._listeners[s](i);r._listeners=null})),this.promise.then=i=>{let s;const o=new Pe((c=>{r.subscribe(c),s=c})).then(i);return o.cancel=function(){r.unsubscribe(s)},o},t((function(i,s,o){r.reason||(r.reason=new vf(i,s,o),n(r.reason))}))}throwIfRequested(){if(this.reason)throw this.reason}subscribe(t){this.reason?t(this.reason):this._listeners?this._listeners.push(t):this._listeners=[t]}unsubscribe(t){if(!this._listeners)return;const n=this._listeners.indexOf(t);n!==-1&&this._listeners.splice(n,1)}toAbortSignal(){const t=new AbortController,n=r=>{t.abort(r)};return this.subscribe(n),t.signal.unsubscribe=()=>this.unsubscribe(n),t.signal}static source(){let t;return{token:new x0((function(r){t=r})),cancel:t}}}var Vz=x0;const M0={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(M0).forEach((e=>{let[t,n]=e;M0[n]=t}));var jz=M0;const ti=(function e(t){const n=new TS(t),r=iD(TS.prototype.request,n);return Ne.extend(r,TS.prototype,n,{allOwnKeys:!0}),Ne.extend(r,n,null,{allOwnKeys:!0}),r.create=function(i){return e(ph(t,i))},r})(w0);ti.Axios=TS,ti.CanceledError=vf,ti.CancelToken=Vz,ti.isCancel=Zk,ti.VERSION=E1,ti.toFormData=tS,ti.AxiosError=sn,ti.Cancel=ti.CanceledError,ti.all=function(e){return Pe.all(e)},ti.spread=function(e){return function(t){return e.apply(null,t)}},ti.isAxiosError=function(e){return Ne.isObject(e)&&e.isAxiosError===!0},ti.mergeConfig=ph,ti.AxiosHeaders=va,ti.formToJSON=e=>Jk(Ne.isHTMLForm(e)?new FormData(e):e),ti.getAdapter=m1.getAdapter,ti.HttpStatusCode=jz,ti.default=ti;var Mi=ti;const Fz=()=>{};function kE(){const e={promise:void 0,isResolved:!1,isRejected:!1,isFinished:!1,resolve:void 0,reject:void 0,cancel:Fz};return e.promise=new Pe(((t,n)=>{e.resolve=r=>{e.isFinished||(e.isResolved=!0,e.isFinished=!0,t(r),e.value=r)},e.reject=r=>{e.isFinished||(e.isRejected=!0,e.isFinished=!0,n(r))}})),e}const RS=new Map,CS=new Map,yc=new Map;let Er=(function(e){return e.WIN_10="Windows 10",e.WIN_81="Windows 8.1",e.WIN_8="Windows 8",e.WIN_7="Windows 7",e.WIN_VISTA="Windows Vista",e.WIN_SERVER_2003="Windows Server 2003",e.WIN_XP="Windows XP",e.WIN_2000="Windows 2000",e.ANDROID="Android",e.HARMONY_OS="HarmonyOS",e.OPEN_BSD="Open BSD",e.SUN_OS="Sun OS",e.LINUX="Linux",e.IOS="iOS",e.MAC_OS="Mac OS",e.CHROMIUM_OS="Chromium OS",e.QNX="QNX",e.UNIX="UNIX",e.BEOS="BeOS",e.OS_2="OS/2",e.SEARCH_BOT="Search Bot",e})({}),Gt=(function(e){return e.CHROME="Chrome",e.SAFARI="Safari",e.EDGE="Edge",e.FIREFOX="Firefox",e.OPERA="OPR",e.QQ="QQBrowser",e.WECHAT="MicroMessenger",e})({});const v1=new _8;let ya=v1.getResult(),U0=null;function xt(e){if(!U0){ya=v1.getResult();const t=(function(c){if(c.engine.name==="Blink"&&c.browser.name!=="WeChat")return Gt.CHROME;switch(c.browser.name){case"Chrome Headless":case"Chrome":case"Chromium":return Gt.CHROME;case"Safari":case"Mobile Safari":return Gt.SAFARI;case"Edge":return Gt.EDGE;case"Firefox":return Gt.FIREFOX;case"QQ":case"QQBrowser":return Gt.QQ;case"Opera":return Gt.OPERA;case"WeChat":return Gt.WECHAT;default:return c.browser.name||""}})(ya),n=y1(ya),r=(function(c){return c.os.name==="Windows"?c.os.version?c.os.name+" "+c.os.version:c.os.name:c.os.name||""})(ya),i=ya.os.version,s=y1(ya,!1),o=ya.device.type;if(!(t&&n&&r&&i))return{name:t,version:n,os:r,osVersion:i,browserVersion:s,deviceType:o};U0={name:t,version:n,os:r,osVersion:i,browserVersion:s,deviceType:o}}return U0}function y1(e){let t,n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];return t=e.engine.name==="Blink"?e.engine.version||"":e.browser.version||"",n?t.split(".")[0]:t}function wS(){return xt().os}function S1(){const e=xt();return"".concat(e.os," ").concat(e.osVersion)}function bS(){const e=xt();return!!(ya.engine.name==="WebKit"&&e.os===Er.MAC_OS&&navigator.maxTouchPoints&&navigator.maxTouchPoints>0&&e.name!==Gt.SAFARI||ni()&&e.name!==Gt.SAFARI)}function fl(){return xt().name===Gt.CHROME}function Vr(){return xt().name===Gt.SAFARI}function T1(){const e=xt();if(e.name!==Gt.SAFARI||!e.browserVersion)return!1;const t=e.browserVersion.split(".");return Number(t[0])>15||Number(t[0])===15&&Number(t[1])>=4}function R1(){return xt().name===Gt.EDGE}function xn(){return xt().name===Gt.FIREFOX}function ni(){return xt().os===Er.IOS}function yf(e){const t=xt();return!(t.name!==Gt.CHROME||!t.osVersion)&&Number(t.version)>=e}function C1(e){const t=xt();return!(t.name!==Gt.CHROME||!t.osVersion)&&Number(t.version)<e}function V0(e,t,n){const r=xt();return!(r.name!==e||!r.osVersion)&&(n?Number(r.version)>=t&&Number(r.version)<=n:Number(r.version)===t)}function j0(e){const t=xt();return!(t.name!==Gt.EDGE||!t.osVersion)&&Number(t.version)>=e}function F0(e){const t=xt();return!(t.name!==Gt.FIREFOX||!t.osVersion)&&Number(t.version)>=e}function w1(e){const t=xt();return!(t.name!==Gt.SAFARI||!t.osVersion)&&Number(t.version)>=e}function b1(e,t,n){const r=xt();if(r.os!==Er.IOS||!r.osVersion)return!1;const i=r.osVersion.split(".");return n?t&&Number(i[0])===e&&Number(i[1])>t||Number(i[0])>e:t?Number(i[0])===e&&Number(i[1])>=t||Number(i[0])>e:Number(i[0])>=e}function I1(e,t,n){const r=xt();if(r.os!==Er.IOS||!r.osVersion)return!1;const i=r.osVersion.split(".");return t&&Number(i[0])===e&&Number(i[1])<t||Number(i[0])<e}function B0(e,t,n){const r=xt();if(r.name!==Gt.SAFARI||!r.osVersion||!r.browserVersion)return!1;const i=r.browserVersion.split(".");return n?t&&Number(i[0])===e&&Number(i[1])<t||Number(i[0])<e:t?Number(i[0])===e&&Number(i[1])<=t||Number(i[0])<e:Number(i[0])<=e}function W0(e){const t=xt();return!(t.name!==Gt.OPERA||!t.osVersion)&&Number(t.version)>=e}function A1(){const e=xt();if(e.os!==Er.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return Number(t[0])<14||Number(t[0])===14&&Number(t[1])<=6}function Sf(){const e=xt();if(e.os!==Er.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return Number(t[0])===15}function G0(){const e=xt();if(e.os!==Er.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return Number(t[0])===16}function N1(){const e=xt();if(e.os!==Er.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return Number(t[0])===15&&Number(t[1])>=1}function Vo(){return Vr()&&navigator.maxTouchPoints>0}function O1(){return xt().name===Gt.WECHAT}function P1(){return window.navigator.appVersion&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)!==null&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<=35}function H0(){const e=wS();return(function(){const{deviceType:t}=xt();return t==="mobile"||t==="tablet"})()||e===Er.ANDROID||e===Er.IOS||e===Er.HARMONY_OS}function ml(){const e=xt();return e.name!==Gt.EDGE&&e.name!==Gt.SAFARI&&!!navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i)}function IS(){return wS()===Er.ANDROID}function LE(){const e=xt();return IS()&&(e.name===Gt.CHROME||e.name===Gt.WECHAT||/chrome|chromium/i.test(navigator.userAgent))}function ct(e,t,n){return(t=(function(r){var i=(function(s,o){if(typeof s!="object"||!s)return s;var c=s[Symbol.toPrimitive];if(c!==void 0){var l=c.call(s,"string");if(typeof l!="object")return l;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(s)})(r);return typeof i=="symbol"?i:i+""})(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function D1(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable}))),n.push.apply(n,r)}return n}function ye(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?D1(Object(n),!0).forEach((function(r){ct(e,r,n[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):D1(Object(n)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))}))}return e}let U=(function(e){return e.UNEXPECTED_ERROR="UNEXPECTED_ERROR",e.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",e.TIMEOUT="TIMEOUT",e.INVALID_PARAMS="INVALID_PARAMS",e.NOT_READABLE="NOT_READABLE",e.NOT_SUPPORTED="NOT_SUPPORTED",e.INVALID_OPERATION="INVALID_OPERATION",e.OPERATION_ABORTED="OPERATION_ABORTED",e.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",e.EXCHANGE_SDP_FAILED="EXCHANGE_SDP_FAILED",e.ADD_CANDIDATE_FAILED="ADD_CANDIDATE_FAILED",e.DATACHANNEL_FAILED="DATACHANNEL_FAILED",e.NETWORK_ERROR="NETWORK_ERROR",e.NETWORK_TIMEOUT="NETWORK_TIMEOUT",e.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",e.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",e.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",e.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",e.ELECTRON_IS_NULL="ELECTRON_IS_NULL",e.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",e.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",e.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",e.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",e.PERMISSION_DENIED="PERMISSION_DENIED",e.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",e.TRACK_IS_DISABLED="TRACK_IS_DISABLED",e.GET_VIDEO_ELEMENT_VISIBLE_ERROR="GET_VIDEO_ELEMENT_VISIBLE_ERROR",e.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",e.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",e.SET_ENCODING_PARAMETER_ERROR="SET_ENCODING_PARAMETER_ERROR",e.TRACK_STATE_UNREACHABLE="TRACK_STATE_UNREACHABLE",e.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",e.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",e.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",e.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",e.UID_CONFLICT="UID_CONFLICT",e.MULTI_UNILBS_RESPONSE_ERROR="MULTI_UNILBS_RESPONSE_ERROR",e.UPDATE_TICKET_FAILED="UPDATE_TICKET_FAILED",e.TOKEN_EXPIRE="TOKEN_EXPIRE",e.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",e.INVALID_TRACK="INVALID_TRACK",e.SENDER_NOT_FOUND="SENDER_NOT_FOUND",e.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",e.SET_ANSWER_FAILED="SET_ANSWER_FAILED",e.ICE_FAILED="ICE_FAILED",e.PC_CLOSED="PC_CLOSED",e.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",e.GET_LOCAL_CAPABILITIES_FAILED="GET_LOCAL_CAPABILITIES_FAILED",e.GET_LOCAL_CONNECTION_PARAMS_FAILED="GET_LOCAL_CONNECTION_PARAMS_FAILED",e.SUBSCRIBE_FAILED="SUBSCRIBE_FAILED",e.UNSUBSCRIBE_FAILED="UNSUBSCRIBE_FAILED",e.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",e.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",e.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",e.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",e.INVALID_REMOTE_USER="INVALID_REMOTE_USER",e.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",e.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",e.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",e.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",e.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",e.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",e.WS_ABORT="WS_ABORT",e.WS_DISCONNECT="WS_DISCONNECT",e.WS_ERR="WS_ERR",e.EXTERNAL_SIGNAL_ABORT="EXTERNAL_SIGNAL_ABORT",e.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",e.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",e.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",e.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",e.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",e.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",e.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",e.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",e.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",e.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",e.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",e.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",e.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",e.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",e.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",e.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",e.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",e.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE",e.LOCAL_AEC_ERROR="LOCAL_AEC_ERROR",e.INVALID_PLUGIN="INVALID_PLUGIN",e.DISCONNECT_P2P="DISCONNECT_P2P",e.CONVERTING_IMAGEDATA_TO_BLOB_FAILED="CONVERTING_IMAGEDATA_TO_BLOB_FAILED",e.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED="CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED",e.INIT_DATACHANNEL_TIMEOUT="INIT_DATACHANNEL_TIMEOUT",e.CREATE_DATACHANNEL_ERROR="CREATE_DATACHANNEL_ERROR",e.DATACHANNEL_CONNECTION_TIMEOUT="DATACHANNEL_CONNECTION_TIMEOUT",e.PROHIBITED_OPERATION="PROHIBITED_OPERATION",e.IMAGE_MODERATION_UPLOAD_FAILED="IMAGE_MODERATION_UPLOAD_FAILED",e.P2P_MESSAGE_FAILED="P2P_MESSAGE_FAILED",e})({}),ce=class extends Error{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",n=arguments.length>2?arguments[2]:void 0;super(t),ct(this,"code",void 0),ct(this,"message",void 0),ct(this,"data",void 0),ct(this,"name","AgoraRTCException"),this.code=e,this.message="AgoraRTCError ".concat(this.code,": ").concat(t),this.data=n}toString(){return this.data?"".concat(this.message,`
data: `).concat(JSON.stringify(this.data)):this.message}print(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error",t=arguments.length>1?arguments[1]:void 0;return e==="error"&&(t||console).error(this.toString()),e==="warning"&&(t||console).warn(this.toString()),this}throw(e){throw this.print("error",e),this}};function Sa(e,t){if(typeof e!="boolean")throw new ce(U.INVALID_PARAMS,"Invalid ".concat(t,": The value is of the boolean type."))}function hr(e,t,n){if(!Re(n).call(n,e))throw new ce(U.INVALID_PARAMS,"".concat(t," can only be set as ").concat(JSON.stringify(n)))}function on(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1e4;if(e<n||e>r||(!(arguments.length>4&&arguments[4]!==void 0)||arguments[4])&&!(function(i){return typeof i=="number"&&i%1==0})(e))throw new ce(U.INVALID_PARAMS,"invalid ".concat(t,": the value range is [").concat(n,", ").concat(r,"]. integer only"))}function K0(e,t){if(typeof e!="number"){if(!(e.min||e.max||e.ideal||e.exact))throw new ce(U.INVALID_PARAMS,"".concat(t," is not a valid ConstrainLong"));e.min!==void 0&&on(e.min,"".concat(t,".min"),0,1/0),e.max!==void 0&&on(e.max,"".concat(t,".max"),1,1/0),e.exact!==void 0&&on(e.exact,"".concat(t,".exact"),1,1/0),e.ideal!==void 0&&on(e.ideal,"".concat(t,".ideal"),1,1/0)}else on(e,t,1,1/0)}function Pr(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:255,i=!(arguments.length>4&&arguments[4]!==void 0)||arguments[4];if(e==null)throw new ce(U.INVALID_PARAMS,"".concat(t||"param"," cannot be empty"));if(!k1(e,n,r,i))throw new ce(U.INVALID_PARAMS,"Invalid ".concat(t||"string param",": Length of the string: [").concat(n,",").concat(r,"].").concat(i?" ASCII characters only.":""))}function _l(e,t){if(!Array.isArray(e))throw new ce(U.INVALID_PARAMS,"".concat(t," should be an array"))}function Mn(e){return e==null}function k1(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:255,r=!(arguments.length>3&&arguments[3]!==void 0)||arguments[3];return typeof e=="string"&&e.length<=n&&e.length>=t&&(!r||(function(i){if(typeof i!="string")return!1;for(let s=0;s<i.length;s+=1){const o=i.charCodeAt(s);if(o<0||o>255)return!1}return!0})(e))}var xE=(function(e){return e.COVERED="COVERED",e.POSITION="POSITION",e.SIZE="SIZE",e.STYLE="STYLE",e})(xE||{}),z0=(function(e){return e.UNMOUNTED="UNMOUNTED",e.INVALID_HTML_ELEMENT="INVALID_HTML_ELEMENT",e})(z0||{});const L1=new class{constructor(){ct(this,"_clientSize",null),ct(this,"getClientWidth",(()=>document.documentElement?document.documentElement.clientWidth:document.body.clientWidth)),ct(this,"getClientHeight",(()=>document.documentElement?document.documentElement.clientHeight:document.body.clientHeight)),ct(this,"getStyle",(e=>window.getComputedStyle(e,null))),ct(this,"checkCssVisibleProperty",(e=>{var t;let n=!0;const r=this.getStyle(e),{display:i,visibility:s,opacity:o,filter:c}=r;return(i==="none"||Re(t=["hidden","collapse"]).call(t,s)||Number(o)<.1)&&(n=!1),!!n&&(c&&c.split(" ").filter((l=>{var h;const p=l.split("(")[0];return Re(h=["brightness","blur","opacity"]).call(h,p)})).map((l=>{const[h,p]=l.split(/\(|\)/);return[h,Number(p.match(/^[0-9\.]+/))]})).forEach((l=>{const[h,p]=l;switch(h){case"brightness":(p<.1||p>3)&&(n=!1);break;case"blur":p>3&&(n=!1);break;case"opacity":p<.1&&(n=!1)}})),n)})),ct(this,"checkPropertyUpToAllParentNodes",((e,t)=>{let n=!0,r=!0;const i=o=>t(o);let s=e;for(;s&&r;)i(s)||(n=!1,r=!1),s=s.parentElement,s||(r=!1);return n})),ct(this,"checkActualCssVisibleIncludeInherit",(e=>this.checkPropertyUpToAllParentNodes(e,this.checkCssVisibleProperty))),ct(this,"getSizeAboutClient",(e=>{const{width:t,height:n,left:r,right:i,top:s,bottom:o}=e.getBoundingClientRect(),c=this.getClientWidth(),l=this.getClientHeight();return{width:t,height:n,left:r,right:i,top:s,bottom:o,clientWidth:c,clientHeight:l,clientMin:Math.min(c,l)}})),ct(this,"checkActualSize",(()=>{const{width:e,height:t,clientMin:n}=this._clientSize;return this.checkSizeIsVisible(e,t,n)})),ct(this,"elementFromPoint",((e,t)=>document.elementFromPoint?document.elementFromPoint(e,t):null)),ct(this,"checkCoverForAPoint",((e,t,n)=>{const r=this.elementFromPoint(e,t);return r!==null&&r!==n})),ct(this,"getPointPositionList",(()=>{const{width:e,height:t,left:n,top:r}=this._clientSize,i=e/6,s=t/6,o=[],c=10**6;for(let l=0;l<5;l++)for(let h=0;h<5;h++){const p=(n*c+(l===0?.1:l===4?(i*l*c-1e5)/c:i*l)*c)/c,E=(r*c+(h===0?.1:h===4?(s*h*c-1e5)/c:s*h)*c)/c;o.push({x:p,y:E})}return[...o]})),ct(this,"checkElementCover",(e=>this.getPointPositionList().map((t=>this.checkCoverForAPoint(t.x,t.y,e))).filter((t=>!!t)).length>6)),ct(this,"checkSizeIsVisible",((e,t,n)=>(e>50||n/e<=10)&&(t>50||n/t<=10))),ct(this,"checkSizeOfPartInClient",(()=>{const{left:e,right:t,top:n,bottom:r,clientHeight:i,clientWidth:s,clientMin:o}=this._clientSize;let c,l,h,p;if(e<0)c=0;else{if(!(e<s))return!1;c=e}if(t<0)return!1;if(l=t<s?t:s,n<0)h=0;else{if(!(n<i))return!1;h=n}if(r<0)return!1;p=r<i?r:i;const E=l-c,g=p-h;return this.checkSizeIsVisible(E,g,o)})),ct(this,"returnHiddenResult",(e=>(this._clientSize=null,{visible:!1,reason:e}))),ct(this,"checkOneElementVisible",(e=>{if(e instanceof HTMLElement){if(this.checkElementIsMountedOnDom(e)){if(this.checkActualCssVisibleIncludeInherit(e)){if(this._clientSize=this.getSizeAboutClient(e),this.checkElementCover(e))return this.returnHiddenResult(xE.COVERED);{const t=this.checkActualSize(),n=this.checkSizeOfPartInClient();return t&&!n?this.returnHiddenResult(xE.POSITION):t?(this._clientSize=null,{visible:!0}):this.returnHiddenResult(xE.SIZE)}}return this.returnHiddenResult(xE.STYLE)}return this.returnHiddenResult(z0.UNMOUNTED)}return this.returnHiddenResult(z0.INVALID_HTML_ELEMENT)})),ct(this,"checkElementIsMountedOnDom",(e=>this.checkPropertyUpToAllParentNodes(e,(t=>t.nodeName.toUpperCase()!=="HTML"?t.parentElement!==null:!!document.documentElement))))}};function Y0(e){return new TextEncoder().encode(e)}const x1=function(e,t){const n=new Uint8Array(e.byteLength+t.byteLength);return n.set(new Uint8Array(e),0),n.set(new Uint8Array(t),e.byteLength),n},q0=async e=>(function(t,n){let r="";return new Uint8Array(t).forEach((i=>{r+=i.toString(n).padStart(2,"0")})),r})(await crypto.subtle.digest("SHA-256",Y0(e)),16);class Pn{constructor(){ct(this,"_events",{}),ct(this,"addListener",this.on)}getListeners(t){return this._events[t]?this._events[t].map((n=>n.listener)):[]}on(t,n){this._events[t]||(this._events[t]=[]);const r=this._events[t];this._indexOfListener(r,n)===-1&&r.push({listener:n,once:!1})}once(t,n){this._events[t]||(this._events[t]=[]);const r=this._events[t];this._indexOfListener(r,n)===-1&&r.push({listener:n,once:!0})}off(t,n){if(!this._events[t])return;const r=this._events[t],i=this._indexOfListener(r,n);i!==-1&&r.splice(i,1),this._events[t].length===0&&delete this._events[t]}removeAllListeners(t){t?delete this._events[t]:this._events={}}emit(t){this._events[t]||(this._events[t]=[]);const n=this._events[t].map((o=>o));for(var r=arguments.length,i=new Array(r>1?r-1:0),s=1;s<r;s++)i[s-1]=arguments[s];for(let o=0;o<n.length;o+=1){const c=n[o];c.once&&this.off(t,c.listener),c.listener.apply(this,i||[])}}safeEmit(t){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];[...this._events[t]||[]].forEach((s=>{s.once&&this.off(t,s.listener);try{s.listener.apply(this,r)}catch(o){console.error("safeEmit event:".concat(t," error ").concat(o?.toString()))}}))}_indexOfListener(t,n){let r=t.length;for(;r--;)if(t[r].listener===n)return r;return-1}}let ME=null;function M1(){if(ME)return ME;if(window.electron)return ME=window.electron;if(!window.require)return null;try{return ME=window.require("electron"),ME}catch{return null}}let Bn=(function(e){return e.CREATE_CLIENT="createClient",e.CHECK_SYSTEM_REQUIREMENTS="checkSystemRequirements",e.SET_AREA="setArea",e.PRELOAD="PRELOAD",e.CHECK_VIDEO_TRACK_IS_ACTIVE="checkVideoTrackIsActive",e.CHECK_AUDIO_TRACK_IS_ACTIVE="checkAudioTrackIsActive",e.CREATE_MIC_AUDIO_TRACK="createMicrophoneAudioTrack",e.CREATE_CUSTOM_AUDIO_TRACK="createCustomAudioTrack",e.CREATE_BUFFER_AUDIO_TRACK="createBufferSourceAudioTrack",e.CREATE_CAM_VIDEO_TRACK="createCameraVideoTrack",e.CREATE_CUSTOM_VIDEO_TRACK="createCustomVideoTrack",e.CREATE_MIC_AND_CAM_TRACKS="createMicrophoneAndCameraTracks",e.CREATE_SCREEN_VIDEO_TRACK="createScreenVideoTrack",e.SET_ENCRYPTION_CONFIG="Client.setEncryptionConfig",e.START_PROXY_SERVER="Client.startProxyServer",e.STOP_PROXY_SERVER="Client.stopProxyServer",e.SET_PROXY_SERVER="Client.setProxyServer",e.SET_TURN_SERVER="Client.setTurnServer",e.SET_CLIENT_ROLE="Client.setClientRole",e.SET_LOW_STREAM_PARAMETER="Client.setLowStreamParameter",e.ENABLE_DUAL_STREAM="Client.enableDualStream",e.DISABLE_DUAL_STREAM="Client.disableDualStream",e.JOIN="Client.join",e.LEAVE="Client.leave",e.PUBLISH="Client.publish",e.UNPUBLISH="Client.unpublish",e.SUBSCRIBE="Client.subscribe",e.MASS_SUBSCRIBE="Client.massSubscribe",e.MASS_UNSUBSCRIBE="Client.massUnsubscribe",e.UNSUBSCRIBE="Client.unsubscribe",e.RENEW_TOKEN="Client.renewToken",e.SET_REMOTE_VIDEO_STREAM_TYPE="Client.setRemoteVideoStreamType",e.SET_STREAM_FALLBACK_OPTION="Client.setStreamFallbackOption",e.ENABLE_AUDIO_VOLUME_INDICATOR="Client.enableAudioVolumeIndicator",e.SEND_CUSTOM_REPORT_MESSAGE="Client.sendCustomReportMessage",e.INSPECT_VIDEO_CONTENT="Client.inspectVideoContent",e.STOP_INSPECT_VIDEO_CONTENT="Client.stopInspectVideoContent",e.JOIN_FALLBACK_TO_PROXY="Client._joinFallbackToProxy",e.ON_LIVE_STREAM_WARNING="Client.onLiveStreamWarning",e.ON_LIVE_STREAM_ERROR="Client.onLiveStreamingError",e.START_LIVE_STREAMING="Client.startLiveStreaming",e.SET_LIVE_TRANSCODING="Client.setLiveTranscoding",e.STOP_LIVE_STREAMING="Client.stopLiveStreaming",e.START_CHANNEL_MEDIA_RELAY="Client.startChannelMediaRelay",e.UPDATE_CHANNEL_MEDIA_RELAY="Client.updateChannelMediaRelay",e.STOP_CHANNEL_MEDIA_RELAY="Client.stopChannelMediaRelay",e.REQUEST_CONFIG_DISTRIBUTE="_config-distribute-request",e.SET_CONFIG_DISTRIBUTE="_configDistribute",e.LOCAL_TRACK_SET_MUTED="LocalTrack.setMute",e.LOCAL_AUDIO_TRACK_PLAY="LocalAudioTrack.play",e.LOCAL_AUDIO_TRACK_PLAY_IN_ELEMENT="LocalAudioTrack.playInElement",e.LOCAL_AUDIO_TRACK_STOP="LocalAudioTrack.stop",e.LOCAL_AUDIO_TRACK_SET_VOLUME="LocalAudioTrack.setVolume",e.MIC_AUDIO_TRACK_SET_DEVICE="MicrophoneAudioTrack.setDevice",e.BUFFER_AUDIO_TRACK_START="BufferSourceAudioTrack.startProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_STOP="BufferSourceAudioTrack.stopProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_PAUSE="BufferSourceAudioTrack.pauseProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_RESUME="BufferSourceAudioTrack.resumeProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_SEEK="BufferSourceAudioTrack.seekAudioBuffer",e.LOCAL_VIDEO_TRACK_PLAY="LocalVideoTrack.play",e.LOCAL_VIDEO_TRACK_STOP="LocalVideoTrack.stop",e.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE="LocalVideoTrack.getVideoElementVisibleStatus",e.LOCAL_VIDEO_TRACK_BEAUTY="LocalVideoTrack.setBeautyEffect",e.LOCAL_VIDEO_SEND_SEI_DATA="LocalVideoTrack.sendSeiData",e.CAM_VIDEO_TRACK_SET_DEVICE="CameraVideoTrack.setDevice",e.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG="CameraVideoTrack.setEncoderConfiguration",e.REMOTE_VIDEO_TRACK_PLAY="RemoteVideoTrack.play",e.REMOTE_VIDEO_TRACK_STOP="RemoteVideoTrack.stop",e.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE="RemoteVideoTrack.getVideoElementVisibleStatus",e.REMOTE_AUDIO_TRACK_PLAY="RemoteAudioTrack.play",e.REMOTE_AUDIO_TRACK_STOP="RemoteAudioTrack.stop",e.REMOTE_AUDIO_SET_VOLUME="RemoteAudioTrack.setVolume",e.REMOTE_AUDIO_SET_OUTPUT_DEVICE="RemoteAudioTrack.setOutputDevice",e.GET_MEDIA_STREAM_TRACK="Track.getMediaStreamTrack",e.STREAM_TYPE_CHANGE="streamTypeChange",e.CONNECTION_STATE_CHANGE="connectionStateChange",e.LOAD_CONFIG_FROM_LOCALSTORAGE="loadConfigFromLocalStorage",e.IMAGE_MODERATION_UPLOAD="imageModerationUpload",e.REPUB_AFTER_PC_CONNECTED="repubAfterPCConnected",e.PRELOAD_MEDIA_FAILED="preloadMediaFailed",e.MISMATCH_DTLS_PARAMETERS="mismatchDtlsParameters",e})({}),In=(function(e){return e.TRACER="tracer",e})({});function U1(e){return on(e.timeout,"config.timeout",0,1e5),on(e.timeoutFactor,"config.timeoutFactor",0,100,!1),on(e.maxRetryCount,"config.maxRetryConfig",0,1/0),on(e.maxRetryTimeout,"config.maxRetryTimeout",0,1/0),!0}let Bz=(function(e){return e[e.AUDIENCE_LEVEL_LOW_LATENCY=1]="AUDIENCE_LEVEL_LOW_LATENCY",e[e.AUDIENCE_LEVEL_ULTRA_LOW_LATENCY=2]="AUDIENCE_LEVEL_ULTRA_LOW_LATENCY",e[e.AUDIENCE_LEVEL_SYNC_LATENCY=3]="AUDIENCE_LEVEL_SYNC_LATENCY",e})({}),Qt=(function(e){return e.LEAVE="LEAVE",e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.UID_BANNED="UID_BANNED",e.FALLBACK="FALLBACK",e.IP_BANNED="IP_BANNED",e.CHANNEL_BANNED="CHANNEL_BANNED",e.LICENSE_MISSING="LICENSE_MISSING",e.LICENSE_EXPIRED="LICENSE_EXPIRED",e.LICENSE_MINUTES_EXCEEDED="LICENSE_MINUTES_EXCEEDED",e.LICENSE_PERIOD_INVALID="LICENSE_PERIOD_INVALID",e.LICENSE_MULTIPLE_SDK_SERVICE="LICENSE_MULTIPLE_SDK_SERVICE",e.LICENSE_ILLEGAL="LICENSE_ILLEGAL",e.TOKEN_EXPIRE="TOKEN_EXPIRE",e})({});function UE(e){if(!Array.isArray(e)||e.length<1)return!1;try{e.forEach((t=>{if(!t.urls)throw Error()}))}catch{return!1}return!0}function V1(e){return Pr(e.turnServerURL,"turnServerURL"),Pr(e.username,"username"),Pr(e.password,"password"),e.udpport&&on(e.udpport,"udpport",1,99999,!0),e.forceturn&&Sa(e.forceturn,"forceturn"),e.security&&Sa(e.security,"security"),e.tcpport&&on(e.tcpport,"tcpport",1,99999,!0),!0}function X0(e){return e.level!==void 0&&hr(e.level,"level",[1,2,3]),e.delay!==void 0&&on(e.delay,"delay",0,3e3,!0),!0}let Nt=(function(e){return e.PEERCONNECTION_STATE_CHANGE="peerconnection-state-change",e.AUDIO_METADATA="audio-metadata",e.AUDIO_PTS="audio-pts",e.CONNECTION_STATE_CHANGE="connection-state-change",e.MEDIA_RECONNECT_START="media-reconnect-start",e.MEDIA_RECONNECT_END="media-reconnect-end",e.IS_USING_CLOUD_PROXY="is-using-cloud-proxy",e.USER_JOINED="user-joined",e.USER_LEAVED="user-left",e.USER_PUBLISHED="user-published",e.USER_UNPUBLISHED="user-unpublished",e.USER_INFO_UPDATED="user-info-updated",e.CLIENT_BANNED="client-banned",e.CHANNEL_MEDIA_RELAY_STATE="channel-media-relay-state",e.CHANNEL_MEDIA_RELAY_EVENT="channel-media-relay-event",e.VOLUME_INDICATOR="volume-indicator",e.CRYPT_ERROR="crypt-error",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="token-privilege-will-expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="token-privilege-did-expire",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGED="stream-type-changed",e.STREAM_FALLBACK="stream-fallback",e.RECEIVE_METADATA="receive-metadata",e.STREAM_MESSAGE="stream-message",e.LIVE_STREAMING_ERROR="live-streaming-error",e.LIVE_STREAMING_WARNING="live-streaming-warning",e.EXCEPTION="exception",e.ERROR="error",e.P2P_LOST="p2p_lost",e.JOIN_FALLBACK_TO_PROXY="join-fallback-to-proxy",e.CHANNEL_FALLBACK_TO_WEBSOCKET="channel-fallback-to-websocket",e.MEDIA_CONNECTION_TYPE_CHANGE="media-connection-type-change",e.PUBLISHED_USER_LIST="published-user-list",e.CONTENT_INSPECT_CONNECTION_STATE_CHANGE="content-inspect-connection-state-change",e.CONTENT_INSPECT_ERROR="content-inspect-error",e.CONTENT_INSPECT_RESULT="content-inspect-result",e.IMAGE_MODERATION_CONNECTION_STATE_CHANGE="image-moderation-connection-state-change",e})({}),jr=(function(e){return e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.MULTI_IP="MULTI_IP",e.TIMEOUT="TIMEOUT",e.OFFLINE="OFFLINE",e.LEAVE="LEAVE",e.P2P_FAILED="P2P_FAILED",e.FALLBACK="FALLBACK",e.REGIONAL_DISTRIBUTION="REGIONAL_DISTRIBUTION",e})({}),_s=(function(e){return e.ONLINE="ONLINE",e.OFFLINE="OFFLINE",e})({}),Tf=(function(e){return e.NETWORK_STATE_CHANGE="NETWORK_STATE_CHANGE",e.ONLINE="ONLINE",e.OFFLINE="OFFLINE",e})({});function Fr(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];return e.getListeners(t).length===0?Pe.reject(new ce(U.UNEXPECTED_ERROR,"can not emit promise")):new Pe(((s,o)=>{e.emit(t,...r,s,o)}))}function cn(e,t){if(e.getListeners(t).length===0)return Pe.resolve();for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];return Fr(e,t,...r)}function Is(e,t){if(e.getListeners(t).length===0)return null;for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];return VE(e,t,...r)}function VE(e,t){let n=null,r=null;for(var i=arguments.length,s=new Array(i>2?i-2:0),o=2;o<i;o++)s[o-2]=arguments[o];if(e.emit(t,...s,(c=>{n=c}),(c=>{r=c})),r!==null)throw r;if(n===null)throw new ce(U.UNEXPECTED_ERROR,"handler is not sync");return n}const Qn=new class extends Pn{set networkState(e){this.emit(Tf.NETWORK_STATE_CHANGE,e,this._networkState),e===_s.ONLINE?this.emit(Tf.ONLINE):e===_s.OFFLINE&&(this.onlineWaiter=new Pe((t=>{this.once(Tf.ONLINE,(()=>{this.onlineWaiter=void 0,t(_s.ONLINE)}))})),this.emit(Tf.OFFLINE)),this._networkState=e}get networkState(){return this._networkState}get isOnline(){return this._networkState===_s.ONLINE}constructor(){super(),ct(this,"_moduleName","network-indicator"),ct(this,"_networkState",_s.ONLINE),ct(this,"onlineWaiter",void 0),window.addEventListener("online",(()=>{this.networkState=_s.ONLINE})),window.addEventListener("offline",(()=>{this.networkState=_s.OFFLINE}))}};function AS(e,t){const n=e.indexOf(t);n!==-1&&e.splice(n,1)}function Rf(e){const t=[];return e.forEach((n=>{t.indexOf(n)===-1&&t.push(n)})),t}function NS(e){Pe!==void 0?Pe.resolve().then(e):setTimeout(e,0)}function An(e){return JSON.parse(JSON.stringify(e))}function fh(e){try{return An(e)}catch{return e}}const j1={};function wd(e,t){j1[t]||(j1[t]=!0,e())}function mh(e){const t=window.atob(e),n=new Uint8Array(new ArrayBuffer(t.length));for(let r=0;r<t.length;r+=1)n[r]=t.charCodeAt(r);return n}function bd(e){let t="";for(let n=0;n<e.length;n+=1)t+=String.fromCharCode(e[n]);return window.btoa(t)}function F1(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:16,n=new TextEncoder().encode(e);if(n.length>t)n=n.slice(0,t);else if(n.length<t){const r=new Uint8Array(t);r.set(n),n=r}return n}function B1(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const r=zi(t).call(t,((o,c)=>o+c.length),0),i=new Uint8Array(new ArrayBuffer(r));let s=0;return t.forEach((o=>{i.set(o,s),s+=o.length})),i}function Sc(e){return window.TextEncoder?new TextEncoder().encode(e).length:e.length}function W1(e){let t=0;return(/DingTalk/i.test(navigator.userAgent)||/AliApp/i.test(navigator.userAgent))&&e.realFormData&&(e=e.realFormData),e.forEach((n=>{t+=typeof n=="string"?Sc(n):n.size})),t+138}function Wz(e){const t=new ce(U.TIMEOUT,"timeout");return new Pe(((n,r)=>{window.setTimeout((()=>r(t)),e)}))}function Dr(e){return new Pe((t=>{window.setTimeout(t,e)}))}function ln(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:7,t=arguments.length>1?arguments[1]:void 0;const n=Math.random().toString(16).substr(2,e).toLowerCase();return n.length===e?"".concat(t).concat(n):"".concat(t).concat(n)+ln(e-n.length,"")}function _h(){return ln(32,"").toUpperCase()}const OS=()=>{},G1=new class{constructor(){ct(this,"fnMap",new Map)}throttleByKey(e,t,n,r){for(var i=arguments.length,s=new Array(i>4?i-4:0),o=4;o<i;o++)s[o-4]=arguments[o];if(this.fnMap.has(t)){const c=this.fnMap.get(t);if(c.threshold!==n){c.fn(...c.args),clearTimeout(c.timer);const l=window.setTimeout((()=>{const h=this.fnMap.get(t);h&&h.fn(...h.args),this.fnMap.delete(t)}),n);this.fnMap.set(t,{fn:e,threshold:n,timer:l,args:s,skipFn:r})}else c.skipFn&&c.skipFn(...c.args),this.fnMap.set(t,ye(ye({},c),{},{fn:e,args:s,skipFn:r}))}else{const c=window.setTimeout((()=>{const l=this.fnMap.get(t);l&&l.fn(...l.args),this.fnMap.delete(t)}),n);this.fnMap.set(t,{fn:e,threshold:n,timer:c,args:s,skipFn:r})}}},H1=G1.throttleByKey.bind(G1);function K1(e){return typeof e=="object"&&e!==null&&!(e instanceof RegExp)}function J0(e,t){if(!K1(e)||!K1(t)||Array.isArray(e)&&!Array.isArray(t)||!Array.isArray(e)&&Array.isArray(t))return t;if(Array.isArray(t)&&Array.isArray(e)){const n=[...e];for(let r=0;r<t.length;r++)n[r]=J0(e[r],t[r]);return n}{const n=ye({},e);for(const r in t)Object.prototype.hasOwnProperty.call(t,r)&&(Object.prototype.hasOwnProperty.call(e,r)?n[r]=J0(e[r],t[r]):n[r]=t[r]);return n}}function z1(e,t){let n=[0];if(n=new Array(t).fill(0),e===0)return n;let r=0;for(;e>0&&(n[r]=255&e,e>>=8,r++,r!==t););return n}function Cf(e){return typeof e=="number"?e:e.exact||e.ideal||e.max||e.min||0}function Q0(e){return zi(e).call(e,((t,n)=>t+n),0)}function Y1(e){const t="0123456789abcdef";function n(B){let Z,Q="";for(Z=0;Z<=3;Z++)Q+=t.charAt(B>>8*Z+4&15)+t.charAt(B>>8*Z&15);return Q}function r(B,Z){const Q=(65535&B)+(65535&Z);return(B>>16)+(Z>>16)+(Q>>16)<<16|65535&Q}function i(B,Z,Q,z,te,de){return r((function(me,ve){return me<<ve|me>>>32-ve})(r(r(Z,B),r(z,de)),te),Q)}function s(B,Z,Q,z,te,de,me){return i(Z&Q|~Z&z,B,Z,te,de,me)}function o(B,Z,Q,z,te,de,me){return i(Z&z|Q&~z,B,Z,te,de,me)}function c(B,Z,Q,z,te,de,me){return i(Z^Q^z,B,Z,te,de,me)}function l(B,Z,Q,z,te,de,me){return i(Q^(Z|~z),B,Z,te,de,me)}const h=(function(B){let Z;const Q=1+(B.length+8>>6),z=new Array(16*Q);for(Z=0;Z<16*Q;Z++)z[Z]=0;for(Z=0;Z<B.length;Z++)z[Z>>2]|=B.charCodeAt(Z)<<Z%4*8;return z[Z>>2]|=128<<Z%4*8,z[16*Q-2]=8*B.length,z})(e);let p,E,g,v,O,I=1732584193,N=-271733879,M=-1732584194,x=271733878;for(p=0;p<h.length;p+=16)E=I,g=N,v=M,O=x,I=s(I,N,M,x,h[p+0],7,-680876936),x=s(x,I,N,M,h[p+1],12,-389564586),M=s(M,x,I,N,h[p+2],17,606105819),N=s(N,M,x,I,h[p+3],22,-1044525330),I=s(I,N,M,x,h[p+4],7,-176418897),x=s(x,I,N,M,h[p+5],12,1200080426),M=s(M,x,I,N,h[p+6],17,-1473231341),N=s(N,M,x,I,h[p+7],22,-45705983),I=s(I,N,M,x,h[p+8],7,1770035416),x=s(x,I,N,M,h[p+9],12,-1958414417),M=s(M,x,I,N,h[p+10],17,-42063),N=s(N,M,x,I,h[p+11],22,-1990404162),I=s(I,N,M,x,h[p+12],7,1804603682),x=s(x,I,N,M,h[p+13],12,-40341101),M=s(M,x,I,N,h[p+14],17,-1502002290),N=s(N,M,x,I,h[p+15],22,1236535329),I=o(I,N,M,x,h[p+1],5,-165796510),x=o(x,I,N,M,h[p+6],9,-1069501632),M=o(M,x,I,N,h[p+11],14,643717713),N=o(N,M,x,I,h[p+0],20,-373897302),I=o(I,N,M,x,h[p+5],5,-701558691),x=o(x,I,N,M,h[p+10],9,38016083),M=o(M,x,I,N,h[p+15],14,-660478335),N=o(N,M,x,I,h[p+4],20,-405537848),I=o(I,N,M,x,h[p+9],5,568446438),x=o(x,I,N,M,h[p+14],9,-1019803690),M=o(M,x,I,N,h[p+3],14,-187363961),N=o(N,M,x,I,h[p+8],20,1163531501),I=o(I,N,M,x,h[p+13],5,-1444681467),x=o(x,I,N,M,h[p+2],9,-51403784),M=o(M,x,I,N,h[p+7],14,1735328473),N=o(N,M,x,I,h[p+12],20,-1926607734),I=c(I,N,M,x,h[p+5],4,-378558),x=c(x,I,N,M,h[p+8],11,-2022574463),M=c(M,x,I,N,h[p+11],16,1839030562),N=c(N,M,x,I,h[p+14],23,-35309556),I=c(I,N,M,x,h[p+1],4,-1530992060),x=c(x,I,N,M,h[p+4],11,1272893353),M=c(M,x,I,N,h[p+7],16,-155497632),N=c(N,M,x,I,h[p+10],23,-1094730640),I=c(I,N,M,x,h[p+13],4,681279174),x=c(x,I,N,M,h[p+0],11,-358537222),M=c(M,x,I,N,h[p+3],16,-722521979),N=c(N,M,x,I,h[p+6],23,76029189),I=c(I,N,M,x,h[p+9],4,-640364487),x=c(x,I,N,M,h[p+12],11,-421815835),M=c(M,x,I,N,h[p+15],16,530742520),N=c(N,M,x,I,h[p+2],23,-995338651),I=l(I,N,M,x,h[p+0],6,-198630844),x=l(x,I,N,M,h[p+7],10,1126891415),M=l(M,x,I,N,h[p+14],15,-1416354905),N=l(N,M,x,I,h[p+5],21,-57434055),I=l(I,N,M,x,h[p+12],6,1700485571),x=l(x,I,N,M,h[p+3],10,-1894986606),M=l(M,x,I,N,h[p+10],15,-1051523),N=l(N,M,x,I,h[p+1],21,-2054922799),I=l(I,N,M,x,h[p+8],6,1873313359),x=l(x,I,N,M,h[p+15],10,-30611744),M=l(M,x,I,N,h[p+6],15,-1560198380),N=l(N,M,x,I,h[p+13],21,1309151649),I=l(I,N,M,x,h[p+4],6,-145523070),x=l(x,I,N,M,h[p+11],10,-1120210379),M=l(M,x,I,N,h[p+2],15,718787259),N=l(N,M,x,I,h[p+9],21,-343485551),I=r(I,E),N=r(N,g),M=r(M,v),x=r(x,O);return n(I)+n(N)+n(M)+n(x)}let Gz=1,q1=console,Yr=class{static setLogger(e){q1=e}constructor(e,t){ct(this,"id",void 0),ct(this,"lockingPromise",Pe.resolve()),ct(this,"locks",0),ct(this,"name",""),ct(this,"lockId",void 0),this.lockId=Gz++,e&&(this.name=e),t&&(this.id=t),this.logger("created")}logger(e,t){const n=(this.id?"[".concat(this.id,"]"):"")+"[lock-".concat(this.name,"-").concat(this.lockId,"]"),r=e==="created"?"is ".concat(e,"."):"is ".concat(e,", current queue ").concat(this.locks,". ").concat(t??"");q1.debug("".concat(n," ").concat(r))}setId(e){this.id=e}get isLocked(){return this.locks>0}lock(e){let t;this.locks+=1,this.logger("locked",e);const n=new Pe((i=>{t=()=>{this.locks-=1,this.logger("unlocked",e),i()}})),r=this.lockingPromise.then((()=>t));return this.lockingPromise=this.lockingPromise.then((()=>n)),r}};function wf(e,t){return function(n,r,i){const s=i.value;if(typeof s!="function")throw new Error("Cannot use mutex on object property.");return i.value=async function(){const o=this[t];if(!o)throw new Error("mutex property key ".concat(t," doesn't exist on ").concat(e));const c=await o.lock("From ".concat(e,".").concat(r));try{for(var l=arguments.length,h=new Array(l),p=0;p<l;p++)h[p]=arguments[p];return await s.apply(this,h)}finally{c()}},i}}const rr={timeout:500,timeoutFactor:1.5,maxRetryCount:1/0,maxRetryTimeout:1e4};function Z0(e,t){const n=Math.floor(t.timeout*Math.pow(t.timeoutFactor,e));return Math.min(t.maxRetryTimeout,n)}function Ta(e,t,n,r){const i=Object.assign({},rr,r);let s=i.timeout;const o=async()=>{await(function(h){return new Pe((p=>{window.setTimeout(p,h)}))})(s),s*=i.timeoutFactor,s=Math.min(i.maxRetryTimeout,s)};let c=!1;const l=new Pe((async(h,p)=>{t=t||(()=>!1),n=n||(()=>!0);for(let E=0;E<i.maxRetryCount;E+=1){if(c)return p(new ce(U.OPERATION_ABORTED));try{const g=await e();if(!t(g,E)||E+1===i.maxRetryCount)return h(g);await o()}catch(g){if(!n(g,E)||E+1===i.maxRetryCount)return p(g);await o()}}}));return l.cancel=()=>c=!0,l}let PS,X1=class{constructor(e){ct(this,"input",[]),ct(this,"size",void 0),this.size=e}add(e){this.input.push(e),this.input.length>this.size&&this.input.splice(0,1)}mean(){var e;return this.input.length===0?0:zi(e=this.input).call(e,((t,n)=>t+n))/this.input.length}},DS=0,$0=0;function eb(e,t,n,r){return new Pe(((i,s)=>{t.responseType=t.responseType||"json",t.data&&!n?(t.data=JSON.stringify(t.data),DS+=Sc(t.data)):n&&(t.data.size?DS+=t.data.size:t.data instanceof FormData?DS+=W1(t.data):DS+=Sc(JSON.stringify(t.data))),t.headers=t.headers||{},t.headers["Content-Type"]=t.headers["Content-Type"]||"application/json",t.method="POST",t.url=e,Mi.request(t).then((o=>{typeof o.data=="string"?$0+=Sc(o.data):o.data instanceof ArrayBuffer||o.data instanceof Uint8Array?$0+=o.data.byteLength:$0+=Sc(JSON.stringify(o.data)),i(o.data)})).catch((o=>{Mi.isCancel(o)?s(new ce(U.OPERATION_ABORTED,"cancel token canceled")):o.code==="ECONNABORTED"?s(new ce(U.NETWORK_TIMEOUT,o.message)):o.response?s(new ce(U.NETWORK_RESPONSE_ERROR,o.response.status)):s(new ce(U.NETWORK_ERROR,o.message))}))}))}async function Hz(e,t){const n=new Blob([t.data],{type:"buffer"});return await eb(e,ye(ye({},t),{},{data:n,headers:{"Content-Type":"application/octet-stream"}}),!0)}const J1=()=>window.isSecureContext!==void 0;function jo(e){if(Array.isArray(e))return e.map((n=>n));if(!Q1(e))return e;const t={};for(const n in e){const r=e[n];Q1(r)||Array.isArray(r)?t[n]=jo(r):t[n]=r}return t}function Q1(e){return!(typeof e!="object"||Array.isArray(e)||!e)}let tb=class{constructor(e){ct(this,"input",[]),ct(this,"size",void 0),this.size=e}add(e){this.input.push(e),this.input.length>this.size&&this.input.splice(0,1)}diffMean(){return this.input.length===0?0:(this.input[this.input.length-1]-this.input[0])/this.input.length}};const Tc={address:"unknown",candidateType:"unknown",id:"unknown",port:0,priority:0,protocol:"unknown",type:"unknown"},jE={timestamp:0,bitrate:{actualEncoded:0,transmit:0},sendPacketLossRate:0,recvPacketLossRate:0,videoRecv:[],videoSend:[],audioRecv:[],audioSend:[],selectedCandidatePair:{id:"unknown",localCandidate:Tc,remoteCandidate:Tc},updateInterval:0},Z1={firsCount:0,nacksCount:0,plisCount:0,framesDecodeCount:0,framesDecodeInterval:0,framesDecodeFreezeTime:0,decodeFrameRate:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,qpSumPerFrame:0,framesDroppedCount:0,outputFrameRate:0,packetsDiscarded:0,framesAssembledFromMultiplePackets:0,totalProcessingDelay:0,avgDecodeMs:0,avgFramesAssembledFromMultiplePacketsMs:0,avgProcessingDelayMs:0,avgInterFrameDelayMs:0,totalAssemblyTime:0},$1={firsCount:0,nacksCount:0,plisCount:0,frameCount:0,bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0,qpSumPerFrame:0},eL={bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0},tL={jitterBufferMs:0,jitterMs:0,bytes:0,packetsLost:0,packetLostRate:0,packetsDiscarded:0,packets:0,ssrc:0,receivedFrames:0,droppedFrames:0,concealedSamples:0,totalSamplesReceived:0,silentConcealedSamples:0,concealmentEvents:0,freezeMs80:0,freezeMs200:0,freezeSamples80:0,freezeSamples200:0};let nb=class{constructor(e,t){ct(this,"onFirstVideoReceived",void 0),ct(this,"onFirstVideoDecoded",void 0),ct(this,"onFirstAudioReceived",void 0),ct(this,"onFirstVideoDecodedTimeout",void 0),ct(this,"onFirstAudioDecoded",void 0),ct(this,"onSelectedLocalCandidateChanged",void 0),ct(this,"onSelectedRemoteCandidateChanged",void 0),ct(this,"videoIsReady",!1),ct(this,"videoIsReady2",{}),ct(this,"pc",void 0),ct(this,"options",void 0),ct(this,"intervalTimer",void 0),ct(this,"stats",jo(jE)),ct(this,"isFirstVideoReceived",{}),ct(this,"isFirstVideoDecoded",{}),ct(this,"isFirstAudioReceived",{}),ct(this,"isFirstAudioDecoded",{}),ct(this,"isFirstVideoDecodedTimeout",{}),ct(this,"lossRateWindowStats",[]),this.pc=e,this.options=t,this.intervalTimer=window.setInterval((async()=>{this.updateStats()}),this.options.updateInterval)}getStats(){return this.stats}getSelectedCandidatePair(){return new Pe((e=>{e({local:ye({},Tc),remote:ye({},Tc)})}))}setVideoIsReady(e){this.videoIsReady=e}setVideoIsReady2(e,t){this.videoIsReady2[e]=t}getVideoIsReady(e){return this.videoIsReady2[e]||!1}setIsFirstAudioDecoded(e){}destroy(){window.clearInterval(this.intervalTimer),this.pc=void 0}calcLossRate(e){this.lossRateWindowStats.push(e),this.lossRateWindowStats.length>this.options.lossRateInterval&&this.lossRateWindowStats.splice(0,1);const t=this.lossRateWindowStats.length,n=["videoSend","audioSend","videoRecv","audioRecv"];let r=0,i=0,s=0,o=0;for(const c of n)e[c].forEach(((l,h)=>{if(!this.lossRateWindowStats[t-1][c][h]||!this.lossRateWindowStats[0][c][h])return;const p=this.lossRateWindowStats[t-1][c][h].packets-this.lossRateWindowStats[0][c][h].packets,E=this.lossRateWindowStats[t-1][c][h].packetsLost-this.lossRateWindowStats[0][c][h].packetsLost;c==="videoSend"||c==="audioSend"?(r+=p,s+=E):(i+=p,o+=E),Number.isNaN(p)||Number.isNaN(p)?l.packetLostRate=0:l.packetLostRate=p<=0||E<=0?0:E/(p+E)}));e.sendPacketLossRate=r<=0||s<=0?0:s/(r+s),e.recvPacketLossRate=i<=0||o<=0?0:o/(i+o)}},Kz=class extends nb{constructor(){super(...arguments),ct(this,"_stats",jE),ct(this,"lastDecodeVideoReceiverStats",new Map)}async updateStats(){const e=await this._getStats(),t=this.statsResponsesToObjects(e);this._stats=jo(jE);const n=t.filter((i=>i.type==="ssrc"));this.processSSRCStats(n);const r=t.find((i=>i.type==="VideoBwe"));r&&this.processBandwidthStats(r),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}processBandwidthStats(e){this._stats.bitrate={actualEncoded:Number(e.googActualEncBitrate),targetEncoded:Number(e.googTargetEncBitrate),retransmit:Number(e.googRetransmitBitrate),transmit:Number(e.googTransmitBitrate)},this._stats.sendBandwidth=Number(e.googAvailableSendBandwidth)}processSSRCStats(e){e.forEach((t=>{var n;const r=Re(n=t.id).call(n,"send");switch("".concat(t.mediaType,"_").concat(r?"send":"recv")){case"video_send":{const i=jo($1);i.codec=t.googCodecName,i.adaptionChangeReason="none",t.googCpuLimitedResolution&&(i.adaptionChangeReason="cpu"),t.googBandwidthLimitedResolution&&(i.adaptionChangeReason="bandwidth"),i.avgEncodeMs=Number(t.googAvgEncodeMs),i.inputFrame={width:Number(t.googFrameWidthInput)||Number(t.googFrameWidthSent),height:Number(t.googFrameHeightInput)||Number(t.googFrameHeightSent),frameRate:Number(t.googFrameRateInput)},i.sentFrame={width:Number(t.googFrameWidthSent),height:Number(t.googFrameHeightSent),frameRate:Number(t.googFrameRateInput)},i.firsCount=Number(t.googFirReceived),i.nacksCount=Number(t.googNacksReceived),i.plisCount=Number(t.googPlisReceived),i.frameCount=Number(t.framesEncoded),i.bytes=Number(t.bytesSent),i.packets=Number(t.packetsSent),i.packetsLost=Number(t.packetsLost),i.ssrc=Number(t.ssrc),i.rttMs=Number(t.googRtt||0),this._stats.videoSend.push(i),this._stats.rtt=i.rttMs;break}case"video_recv":{const i=jo(Z1),s=this.lastDecodeVideoReceiverStats.get(Number(t.ssrc));if(i.codec=t.googCodecName,i.targetDelayMs=Number(t.googTargetDelayMs),i.renderDelayMs=Number(t.googRenderDelayMs),i.currentDelayMs=Number(t.googCurrentDelayMs),i.minPlayoutDelayMs=Number(t.googMinPlayoutDelayMs),i.decodeMs=Number(t.googDecodeMs),i.maxDecodeMs=Number(t.googMaxDecodeMs),i.receivedFrame={width:Number(t.googFrameWidthReceived),height:Number(t.googFrameHeightReceived),frameRate:Number(t.googFrameRateReceived)},i.decodedFrame={width:Number(t.googFrameWidthReceived),height:Number(t.googFrameHeightReceived),frameRate:Number(t.googFrameRateDecoded)},i.decodeFrameRate=Number(t.googFrameRateDecoded),i.outputFrame={width:Number(t.googFrameWidthReceived),height:Number(t.googFrameHeightReceived),frameRate:Number(t.googFrameRateOutput)},i.jitterBufferMs=Number(t.googJitterBufferMs),i.firsCount=Number(t.googFirsSent),i.nacksCount=Number(t.googNacksSent),i.plisCount=Number(t.googPlisSent),i.framesDecodeCount=Number(t.framesDecoded),i.bytes=Number(t.bytesReceived),i.packets=Number(t.packetsReceived),i.packetsLost=Number(t.packetsLost),i.ssrc=Number(t.ssrc),i.packets>0&&!this.isFirstVideoReceived[i.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(i.ssrc),this.isFirstVideoReceived[i.ssrc]=!0),i.framesDecodeCount>0&&!this.isFirstVideoDecoded[i.ssrc]&&(this.onFirstVideoDecoded&&this.onFirstVideoDecoded(i.ssrc,i.decodedFrame.width,i.decodedFrame.height),this.isFirstVideoDecoded[i.ssrc]=!0),s){const o=s.stats,c=Date.now()-s.lts;i.framesDecodeFreezeTime=o.framesDecodeFreezeTime,i.framesDecodeInterval=o.framesDecodeInterval,i.framesDecodeCount>o.framesDecodeCount&&this.isFirstVideoDecoded[i.ssrc]?(s.lts=Date.now(),i.framesDecodeInterval=c,i.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(t.ssrc,10))?i.framesDecodeFreezeTime+=i.framesDecodeInterval:this.setVideoIsReady2(parseInt(t.ssrc,10),!0))):i.framesDecodeCount<s.stats.framesDecodeCount&&(i.framesDecodeInterval=0)}this.lastDecodeVideoReceiverStats.set(i.ssrc,{stats:ye({},i),lts:Date.now()}),this._stats.videoRecv.push(i);break}case"audio_recv":{const i=jo(tL);i.codec=t.googCodecName,i.outputLevel=Math.abs(Number(t.audioOutputLevel))/32767,i.decodingCNG=Number(t.googDecodingCNG),i.decodingCTN=Number(t.googDecodingCTN),i.decodingCTSG=Number(t.googDecodingCTSG),i.decodingNormal=Number(t.googDecodingNormal),i.decodingPLC=Number(t.googDecodingPLC),i.decodingPLCCNG=Number(t.googDecodingPLCCNG),i.expandRate=Number(t.googExpandRate),i.accelerateRate=Number(t.googAccelerateRate),i.preemptiveExpandRate=Number(t.googPreemptiveExpandRate),i.secondaryDecodedRate=Number(t.googSecondaryDecodedRate),i.speechExpandRate=Number(t.googSpeechExpandRate),i.preferredJitterBufferMs=Number(t.googPreferredJitterBufferMs),i.jitterBufferMs=Number(t.googJitterBufferMs),i.jitterMs=Number(t.googJitterReceived),i.bytes=Number(t.bytesReceived),i.packets=Number(t.packetsReceived),i.packetsLost=Number(t.packetsLost),i.ssrc=Number(t.ssrc),i.receivedFrames=Number(t.googDecodingCTN)||Number(t.packetsReceived),i.droppedFrames=Number(t.googDecodingPLC)+Number(t.googDecodingPLCCNG)||Number(t.packetsLost),i.receivedFrames>0&&!this.isFirstAudioReceived[i.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(i.ssrc),this.isFirstAudioReceived[i.ssrc]=!0),i.decodingNormal>0&&!this.isFirstAudioDecoded[i.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(i.ssrc),this.isFirstAudioDecoded[i.ssrc]=!0),this._stats.audioRecv.push(i);break}case"audio_send":{const i=jo(eL);i.codec=t.googCodecName,i.inputLevel=Math.abs(Number(t.audioInputLevel))/32767,i.aecReturnLoss=Number(t.googEchoCancellationReturnLoss||0),i.aecReturnLossEnhancement=Number(t.googEchoCancellationReturnLossEnhancement||0),i.residualEchoLikelihood=Number(t.googResidualEchoLikelihood||0),i.residualEchoLikelihoodRecentMax=Number(t.googResidualEchoLikelihoodRecentMax||0),i.bytes=Number(t.bytesSent),i.packets=Number(t.packetsSent),i.packetsLost=Number(t.packetsLost),i.ssrc=Number(t.ssrc),i.rttMs=Number(t.googRtt||0),this._stats.rtt=i.rttMs,this._stats.audioSend.push(i);break}}}))}_getStats(){return new Pe(((e,t)=>{this.pc.getStats(e,t)}))}statsResponsesToObjects(e){const t=[];return e.result().forEach((n=>{const r={id:n.id,timestamp:n.timestamp.valueOf().toString(),type:n.type};n.names().forEach((i=>{r[i]=n.stat(i)})),t.push(r)})),t}},FE=(function(e){return e.BANDWIDTH="bandwidth",e.CPU="cpu",e.NONE="none",e.OTHER="other",e})({}),kS=(function(e){return e.L1T1="L1T1",e.L1T2="L1T2",e.L1T3="L1T3",e.L1T3_KEY="L1T3_KEY",e.L2T1_KEY="L2T1_KEY",e.L2T2_KEY="L2T2_KEY",e.L2T3_KEY="L2T3_KEY",e.L3T1_KEY="L3T1_KEY",e.L3T2_KEY="L3T2_KEY",e.L3T3_KEY="L3T3_KEY",e})({}),rb=(function(e){return e[e.new=0]="new",e[e.connecting=1]="connecting",e[e.connected=2]="connected",e[e.disconnected=3]="disconnected",e[e.failed=4]="failed",e[e.closed=5]="closed",e})({}),As=(function(e){return e.CERTIFICATE="certificate",e.CODEC="codec",e.CANDIDATE_PAIR="candidate-pair",e.LOCAL_CANDIDATE="local-candidate",e.REMOTE_CANDIDATE="remote-candidate",e.INBOUND="inbound-rtp",e.TRACK="track",e.OUTBOUND="outbound-rtp",e.PC="peer-connection",e.REMOTE_INBOUND="remote-inbound-rtp",e.REMOTE_OUTBOUND="remote-outbound-rtp",e.TRANSPORT="transport",e.CSRC="csrc",e.DATA_CHANNEL="data-channel",e.STREAM="stream",e.SENDER="sender",e.RECEIVER="receiver",e})({});var bf=(function(e){return e[e.kNone=1]="kNone",e[e.kMillisecondsFromSeconds=1e3]="kMillisecondsFromSeconds",e[e.kBytesToBits=8]="kBytesToBits",e})(bf||{});function BE(e,t,n,r){let i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:bf.kNone;if(!t)return;const s=Number(t[n]);if(typeof s!="number")return;const o=Number(t[r]);if(typeof o!="number")return;if(!e)return o?s/o*i:void 0;const c=Number(e[n]);if(typeof c!="number")return;const l=Number(e[r]);if(typeof l!="number")return;const h=o-l;return h?(s-c)/h*i:void 0}let nL=class extends nb{constructor(){super(...arguments),ct(this,"_stats",jE),ct(this,"report",void 0),ct(this,"lastDecodeVideoReceiverStats",new Map),ct(this,"lastVideoFramesRecv",new Map),ct(this,"lastVideoFramesSent",new Map),ct(this,"lastVideoFramesDecode",new Map),ct(this,"lastVideoFramesOutput",new Map),ct(this,"lastVideoJBDelay",new Map),ct(this,"lastAudioJBDelay",new Map),ct(this,"mediaBytesSent",new Map),ct(this,"mediaBytesRetransmit",new Map),ct(this,"mediaBytesTargetEncode",new Map),ct(this,"lastDecodeAudioReceiverStats",new Map),ct(this,"lastAudioConcealment",new Map),ct(this,"lastEncoderMs",new Map)}async updateStats(){this.report=await this.pc.getStats(),this._stats=jo(jE),this.report.forEach((e=>{switch(e.type){case As.OUTBOUND:case As.INBOUND:{const t=e.mediaType||e.kind,n=!t&&"frameWidth"in e,r=!t&&!("frameWidth"in e);e.type===As.OUTBOUND?t==="audio"||r?this.processAudioOutboundStats(e):(t==="video"||n)&&this.processVideoOutboundStats(e):e.type===As.INBOUND&&(t==="audio"||r?this.processAudioInboundStats(e):(t==="video"||n)&&this.processVideoInboundStats(e));break}case As.TRANSPORT:{const t=this.report.get(e.selectedCandidatePairId);t&&this.processCandidatePairStats(t);break}case As.CANDIDATE_PAIR:e.selected&&this.processCandidatePairStats(e)}})),this.updateSendBitrate(),this._stats.updateInterval=Date.now()-this.stats.timestamp,this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}async getSelectedCandidatePair(){const e=await this.pc.getStats(),t={local:ye({},Tc),remote:ye({},Tc)};return e.forEach((n=>{let r;if(n.type===As.TRANSPORT&&(r=e.get(n.selectedCandidatePairId)),n.type===As.CANDIDATE_PAIR&&n.selected&&(r=n),r){const i=(s,o)=>{s.type=o.type,s.id=o.id,o.address&&(s.address=o.address),o.candidateType&&(s.candidateType=o.candidateType),o.port&&(s.port=o.port),o.priority&&(s.priority=o.priority),o.protocol&&(s.protocol=o.protocol),o.relayProtocol&&(s.relayProtocol=o.relayProtocol)};if(r.localCandidateId){const s=e.get(r.localCandidateId);s&&i(t.local,s)}if(r.remoteCandidateId){const s=e.get(r.remoteCandidateId);s&&i(t.remote,s)}}})),t}processCandidatePairStats(e){if(this._stats.sendBandwidth=e.availableOutgoingBitrate||0,e.currentRoundTripTime&&(this._stats.rtt=1e3*e.currentRoundTripTime),this._stats.videoSend.forEach((t=>{e.currentRoundTripTime&&(t.rttMs=1e3*e.currentRoundTripTime)})),this._stats.audioSend.forEach((t=>{e.currentRoundTripTime&&(t.rttMs=1e3*e.currentRoundTripTime)})),this._stats.selectedCandidatePair.id=e.id,e.localCandidateId){const t=this.report.get(e.localCandidateId);t&&this.processCandidateStats(t)}if(e.remoteCandidateId){const t=this.report.get(e.remoteCandidateId);t&&this.processCandidateStats(t)}}processCandidateStats(e){let t;e.type===As.LOCAL_CANDIDATE&&(t=this._stats.selectedCandidatePair.localCandidate),e.type===As.REMOTE_CANDIDATE&&(t=this._stats.selectedCandidatePair.remoteCandidate),t&&(t.type=e.type,t.id=e.id,e.address&&(t.address=e.address),e.candidateType&&(t.candidateType=e.candidateType),e.port&&(t.port=e.port),e.priority&&(t.priority=e.priority),e.protocol&&(t.protocol=e.protocol),e.relayProtocol&&(t.relayProtocol=e.relayProtocol),e.type===As.LOCAL_CANDIDATE&&this.stats.selectedCandidatePair.localCandidate.id!==t.id&&this.onSelectedLocalCandidateChanged&&this.onSelectedLocalCandidateChanged(ye({},t),ye({},this.stats.selectedCandidatePair.localCandidate)),e.type===As.REMOTE_CANDIDATE&&this.stats.selectedCandidatePair.remoteCandidate.id!==t.id&&this.onSelectedRemoteCandidateChanged&&this.onSelectedRemoteCandidateChanged(ye({},t),ye({},this.stats.selectedCandidatePair.remoteCandidate)))}processAudioInboundStats(e){let t=this._stats.audioRecv.find((r=>r.ssrc===e.ssrc));t||(t=jo(tL),this._stats.audioRecv.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsReceived,t.packetsLost=e.packetsLost,t.packetsDiscarded=e.packetsDiscarded,t.bytes=e.bytesReceived,t.jitterMs=1e3*e.jitter,t.retransmittedBytesReceived=e.retransmittedBytesReceived,t.retransmittedPacketsReceived=e.retransmittedPacketsReceived,t.totalProcessingDelay=e.totalProcessingDelay,t.jitterBufferEmittedCount=e.jitterBufferEmittedCount;const n=this.lastDecodeAudioReceiverStats.get(t.ssrc);t.avgProcessingDelayMs=BE(n,t,"totalProcessingDelay","jitterBufferEmittedCount",bf.kMillisecondsFromSeconds),this.processAudioTrackReceiverStats(e,e.trackId,t),this.calculateAudioFreeze(t,n,e),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),t.receivedFrames||(t.receivedFrames=e.packetsReceived),t.droppedFrames||(t.droppedFrames=e.packetsLost),t.receivedFrames>0&&!this.isFirstAudioReceived[t.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(t.ssrc),this.isFirstAudioReceived[t.ssrc]=!0),t.outputLevel&&t.outputLevel>0&&!this.isFirstAudioDecoded[t.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(t.ssrc),this.isFirstAudioDecoded[t.ssrc]=!0),typeof e.concealedSamples=="number"&&(t.concealedSamples=e.concealedSamples),this.lastDecodeAudioReceiverStats.set(t.ssrc,ye({},t))}calculateAudioFreeze(e,t,n){const r=this.lastAudioConcealment.get(e.ssrc);if(t!=null&&r!=null){const i=r.lts,s=n.timestamp,o=s-i;if(o<=0)return;const c=e.concealedSamples-t.concealedSamples-0,l=r.nonSilent+c,h=e.totalSamplesReceived-t.totalSamplesReceived;if(h<=0)return;const p=80*h/o,E=200*h/o,g=o/h;let v=0;e.freezeSamples80=t.freezeSamples80,e.freezeMs80=t.freezeMs80,l>p&&(r.plc80>0?(e.freezeSamples80+=c,e.freezeMs80+=Math.round(c*g)):(e.freezeSamples80+=l,e.freezeMs80+=Math.round(l*g)),v=r.plc80+1);let O=0;e.freezeSamples200=t.freezeSamples200,e.freezeMs200=t.freezeMs200,l>E&&(r.plc200>0?(e.freezeSamples200+=c,e.freezeMs200+=Math.round(c*g)):(e.freezeSamples200+=l,e.freezeMs200+=Math.round(l*g)),O=r.plc200+1),this.lastAudioConcealment.set(e.ssrc,{nonSilent:c,lts:s,plc80:v,plc200:O})}else e.freezeSamples80=0,e.freezeSamples200=0,e.freezeMs80=0,e.freezeMs200=0,this.lastAudioConcealment.set(e.ssrc,{nonSilent:0,lts:n.timestamp,plc80:0,plc200:0})}processVideoInboundStats(e){let t=this._stats.videoRecv.find((o=>o.ssrc===e.ssrc));t||(t=jo(Z1),this._stats.videoRecv.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsReceived,t.packetsLost=e.packetsLost,t.bytes=e.bytesReceived,t.firsCount=e.firCount,t.nacksCount=e.nackCount,t.plisCount=e.pliCount,t.framesDecodeCount=e.framesDecoded,t.framesDroppedCount=e.framesDropped,t.totalInterFrameDelay=e.totalInterFrameDelay,t.totalSquaredInterFrameDelay=e.totalSquaredInterFrameDelay,t.totalFreezesDuration=e.totalFreezesDuration,t.totalProcessingDelay=e.totalProcessingDelay,t.packetsDiscarded=e.packetsDiscarded,t.framesAssembledFromMultiplePackets=e.framesAssembledFromMultiplePackets,t.totalAssemblyTime=e.totalAssemblyTime,t.keyFramesDecoded=e.keyFramesDecoded,t.retransmittedBytesReceived=e.retransmittedBytesReceived,t.retransmittedPacketsReceived=e.retransmittedPacketsReceived;const n=this.lastDecodeVideoReceiverStats.get(t.ssrc),r=this.lastVideoFramesDecode.get(t.ssrc),i=this.lastVideoFramesOutput.get(t.ssrc),s=Date.now();if(t.framesDecodeCount>0&&!this.isFirstVideoDecoded[t.ssrc]){const o=t.decodedFrame?t.decodedFrame.width:0,c=t.decodedFrame?t.decodedFrame.height:0;this.onFirstVideoDecoded&&this.onFirstVideoDecoded(t.ssrc,o,c),this.isFirstVideoDecoded[t.ssrc]=!0}if(n){const o=n.stats,c=s-n.lts;t.framesDecodeFreezeTime=o.framesDecodeFreezeTime,t.framesDecodeInterval=o.framesDecodeInterval,!this.isFirstVideoDecoded[t.ssrc]&&c>this.options.firstVideoDecodedTimeout&&!this.isFirstVideoDecodedTimeout[t.ssrc]&&(this.onFirstVideoDecodedTimeout&&this.onFirstVideoDecodedTimeout(t.ssrc),this.isFirstVideoDecodedTimeout[t.ssrc]=!0),t.framesDecodeCount>o.framesDecodeCount&&this.isFirstVideoDecoded[t.ssrc]?(n.lts=Date.now(),t.framesDecodeInterval=c,t.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(e.ssrc))?t.framesDecodeFreezeTime+=t.framesDecodeInterval:this.setVideoIsReady2(parseInt(e.ssrc,10),!0))):t.framesDecodeCount<o.framesDecodeCount&&(t.framesDecodeInterval=0),e.framesDecoded&&e.qpSum&&(n.stats.framesDecodeCount>e.framesDecoded?t.qpSumPerFrame=e.qpSum/e.framesDecoded:t.qpSumPerFrame=(e.qpSum-n.qpSum)/(e.framesDecoded-n.stats.framesDecodeCount))}e.totalDecodeTime&&(t.decodeMs=1e3*e.totalDecodeTime,t.avgDecodeMs=BE(n?.stats,t,"decodeMs","framesDecodeCount")),t.avgProcessingDelayMs=BE(n?.stats,t,"totalProcessingDelay","framesDecodeCount",bf.kMillisecondsFromSeconds),t.avgFramesAssembledFromMultiplePacketsMs=BE(n?.stats,t,"totalAssemblyTime","framesAssembledFromMultiplePackets",bf.kMillisecondsFromSeconds),t.avgInterFrameDelayMs=BE(n?.stats,t,"totalInterFrameDelay","framesDecodeCount",bf.kMillisecondsFromSeconds),r&&s-r.lts>=800?(t.decodeFrameRate=Math.round((t.framesDecodeCount-r.count)/((s-r.lts)/1e3)),this.lastVideoFramesDecode.set(t.ssrc,{count:t.framesDecodeCount,lts:s,rate:t.decodeFrameRate})):r?t.decodeFrameRate=r.rate:this.lastVideoFramesDecode.set(t.ssrc,{count:t.framesDecodeCount,lts:s,rate:0}),t.framesDroppedCount&&e.framesReceived&&(i&&s-i.lts>=800?(t.outputFrameRate=Math.round((e.framesReceived-t.framesDroppedCount-i.count)/((s-i.lts)/1e3)),this.lastVideoFramesOutput.set(t.ssrc,{count:e.framesReceived-t.framesDroppedCount,lts:s,rate:Math.max(t.outputFrameRate,0)})):i?t.outputFrameRate=i.rate:this.lastVideoFramesOutput.set(t.ssrc,{count:e.framesReceived-t.framesDroppedCount,lts:s,rate:0})),this.processVideoTrackReceiverStats(e,e.trackId,t),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),e.framerateMean&&(t.framesRateFirefox=e.framerateMean),t.packets>0&&!this.isFirstVideoReceived[t.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(t.ssrc),this.isFirstVideoReceived[t.ssrc]=!0),this.lastDecodeVideoReceiverStats.set(t.ssrc,{stats:ye({},t),lts:n?n.lts:Date.now(),qpSum:e.qpSum})}processVideoOutboundStats(e){let t=this._stats.videoSend.find((r=>r.ssrc===e.ssrc));t||(t=jo($1),this._stats.videoSend.push(t));const n=this.mediaBytesSent.get(e.ssrc);if(n)n.add(e.bytesSent);else{const r=new tb(10);r.add(e.bytesSent),this.mediaBytesSent.set(e.ssrc,r)}if(e.retransmittedBytesSent!==void 0){const r=this.mediaBytesRetransmit.get(e.ssrc);if(r)r.add(e.retransmittedBytesSent);else{const i=new tb(10);i.add(e.retransmittedBytesSent),this.mediaBytesRetransmit.set(e.ssrc,i)}}if(e.totalEncodedBytesTarget){const r=this.mediaBytesTargetEncode.get(e.ssrc);if(r)r.add(e.totalEncodedBytesTarget);else{const i=new tb(10);i.add(e.totalEncodedBytesTarget),this.mediaBytesTargetEncode.set(e.ssrc,i)}}if(t.ssrc=e.ssrc,t.bytes=e.bytesSent,t.packets=e.packetsSent,t.firsCount=e.firCount,t.nacksCount=e.nackCount,t.plisCount=e.pliCount,t.frameCount=e.framesEncoded,t.adaptionChangeReason=e.qualityLimitationReason,t.scalabilityMode=e.scalabilityMode,t.retransmittedBytesSent=e.retransmittedBytesSent,t.retransmittedPacketsSent=e.retransmittedPacketsSent,t.hugeFramesSent=e.hugeFramesSent,t.keyFramesEncoded=e.keyFramesEncoded,t.targetBitrate=e.targetBitrate,e.totalEncodeTime&&e.framesEncoded){const r=this.lastEncoderMs.get(e.ssrc);if(!r||r.lastFrameCount>e.framesEncoded)t.avgEncodeMs=1e3*e.totalEncodeTime/e.framesEncoded;else{const i=e.framesEncoded-r.lastFrameCount,s=e.totalEncodeTime-r.lastEncoderTime;t.avgEncodeMs=1e3*s/i}}if(e.framesEncoded&&e.qpSum){const r=this.lastEncoderMs.get(e.ssrc);!r||r.lastFrameCount>e.framesEncoded?t.qpSumPerFrame=e.qpSum/e.framesEncoded:t.qpSumPerFrame=(e.qpSum-r.lastQpSum)/(e.framesEncoded-r.lastFrameCount)}if(this.lastEncoderMs.set(e.ssrc,{lastFrameCount:e.framesEncoded,lastEncoderTime:e.totalEncodeTime,lastQpSum:e.qpSum,lts:Date.now()}),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),e.mediaSourceId&&this.processVideoMediaSource(e.mediaSourceId,t),this.processVideoTrackSenderStats(e,e.trackId,t),e.remoteId)this.processRemoteInboundStats(e.remoteId,t);else{const r=this.findRemoteStatsId(e.ssrc,As.REMOTE_INBOUND);r&&this.processRemoteInboundStats(r,t)}}processAudioOutboundStats(e){let t=this._stats.audioSend.find((n=>n.ssrc===e.ssrc));if(t||(t=jo(eL),this._stats.audioSend.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsSent,t.bytes=e.bytesSent,t.retransmittedBytesSent=e.retransmittedBytesSent,t.retransmittedPacketsSent=e.retransmittedPacketsSent,e.mediaSourceId&&this.processAudioMediaSource(e.mediaSourceId,t),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),this.processAudioTrackSenderStats(e,e.trackId,t),e.remoteId)this.processRemoteInboundStats(e.remoteId,t);else{const n=this.findRemoteStatsId(e.ssrc,As.REMOTE_INBOUND);n&&this.processRemoteInboundStats(n,t)}}findRemoteStatsId(e,t){var n;const r=Array.from(ps(n=this.report).call(n)).find((i=>i.type===t&&i.ssrc===e));return r?r.id:null}processVideoMediaSource(e,t){const n=this.report.get(e);n&&n.width&&n.height&&n.framesPerSecond&&(t.inputFrame={width:n.width,height:n.height,frameRate:n.framesPerSecond})}processAudioMediaSource(e,t){const n=this.report.get(e);n&&(t.inputLevel=n.audioLevel)}processVideoTrackSenderStats(e,t,n){var r,i,s,o;const c=t?this.report.get(t):void 0,l=(r=c?.framesSent)!==null&&r!==void 0?r:e.framesSent;if(typeof l!="number")return;let h=(i=c?.frameWidth)!==null&&i!==void 0?i:e.frameWidth,p=(s=c?.frameHeight)!==null&&s!==void 0?s:e.frameHeight,E=(o=c?.framesPerSecond)!==null&&o!==void 0?o:e.framesPerSecond;if(typeof h=="number"&&typeof p=="number"||(h=0,p=0),E==null){const g=Date.now(),v=this.lastVideoFramesSent.get(n.ssrc);v&&g-v.lts>=800?(E=Math.round((l-v.count)/((g-v.lts)/1e3)),this.lastVideoFramesSent.set(n.ssrc,{count:l,lts:g,rate:E})):v?E=v.rate:this.lastVideoFramesSent.set(n.ssrc,{count:l,lts:g,rate:0})}n.sentFrame={width:h,height:p,frameRate:Math.max(0,E)}}processVideoTrackReceiverStats(e,t,n){var r,i,s,o,c;const l=t?this.report.get(t):void 0,h=(r=l?.framesReceived)!==null&&r!==void 0?r:e.framesReceived,p=(i=l?.frameWidth)!==null&&i!==void 0?i:e.frameWidth,E=(s=l?.frameHeight)!==null&&s!==void 0?s:e.frameHeight,g=(o=l?.jitterBufferDelay)!==null&&o!==void 0?o:e.jitterBufferDelay,v=(c=l?.jitterBufferEmittedCount)!==null&&c!==void 0?c:e.jitterBufferEmittedCount;if(typeof h=="number"){const O=this.lastVideoFramesRecv.get(n.ssrc),I=Date.now();n.framesReceivedCount=h;let N=0;O&&I-O.lts>=800?(N=Math.round((h-O.count)/((I-O.lts)/1e3)),this.lastVideoFramesRecv.set(n.ssrc,{count:h,lts:I,rate:N})):O?N=O.rate:this.lastVideoFramesRecv.set(n.ssrc,{count:h,lts:I,rate:0}),n.receivedFrame={width:p||0,height:E||0,frameRate:N||0},n.decodedFrame={width:p||0,height:E||0,frameRate:n.decodeFrameRate||0},n.outputFrame={width:p||0,height:E||0,frameRate:n.outputFrameRate||n.decodeFrameRate||0}}if(g&&v){const O=this.lastVideoJBDelay.get(n.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let I=O.jitterBufferMs;const N=v-O.jitterBufferEmittedCount;N>0&&(I=1e3*(g-O.jitterBufferDelay)/N),n.jitterBufferMs=I,n.currentDelayMs=Math.round(I),this.lastVideoJBDelay.set(n.ssrc,{jitterBufferDelay:g,jitterBufferEmittedCount:v,jitterBufferMs:n.currentDelayMs})}}processAudioTrackSenderStats(e,t,n){var r,i,s,o;const c=t?this.report.get(t):void 0,l=(r=(i=c?.echoReturnLoss)!==null&&i!==void 0?i:e.echoReturnLoss)!==null&&r!==void 0?r:0,h=(s=(o=c?.echoReturnLossEnhancement)!==null&&o!==void 0?o:e.echoReturnLossEnhancement)!==null&&s!==void 0?s:0;n.aecReturnLoss=l,n.aecReturnLossEnhancement=h}processAudioTrackReceiverStats(e,t,n){var r,i,s,o,c,l,h,p,E;const g=t?this.report.get(t):void 0,v=(r=g?.removedSamplesForAcceleration)!==null&&r!==void 0?r:e.removedSamplesForAcceleration,O=(i=g?.totalSamplesReceived)!==null&&i!==void 0?i:e.totalSamplesReceived,I=(s=g?.jitterBufferDelay)!==null&&s!==void 0?s:e.jitterBufferDelay,N=(o=g?.jitterBufferEmittedCount)!==null&&o!==void 0?o:e.jitterBufferEmittedCount,M=(c=g?.audioLevel)!==null&&c!==void 0?c:e?.audioLevel,x=(l=g?.totalSamplesDuration)!==null&&l!==void 0?l:e?.totalSamplesDuration,B=(h=g?.concealedSamples)!==null&&h!==void 0?h:e.concealedSamples,Z=(p=g?.silentConcealedSamples)!==null&&p!==void 0?p:e.silentConcealedSamples,Q=(E=g?.concealmentEvents)!==null&&E!==void 0?E:e.concealmentEvents;if(typeof O=="number"&&(n.totalSamplesReceived=O),typeof Z=="number"&&(n.silentConcealedSamples=Z),typeof Q=="number"&&(n.concealmentEvents=Q),typeof B=="number"&&(n.concealedSamples=B),v&&O&&(n.accelerateRate=v/O),I&&N){const te=this.lastAudioJBDelay.get(n.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let de=te.jitterBufferMs;const me=N-te.jitterBufferEmittedCount;me>0&&(de=1e3*(I-te.jitterBufferDelay)/me),n.jitterBufferMs=Math.round(de),this.lastAudioJBDelay.set(n.ssrc,{jitterBufferDelay:I,jitterBufferEmittedCount:N,jitterBufferMs:n.jitterBufferMs})}n.outputLevel=M;let z=1920;x&&O&&(z=O/x/50,n.receivedFrames=Math.round(O/z)),B&&(n.droppedFrames=Math.round(B/z))}processRemoteInboundStats(e,t){const n=this.report.get(e);n&&(t.packetsLost=n.packetsLost,n.roundTripTime&&(t.rttMs=1e3*n.roundTripTime),n.jitter&&(t.jitterMs=1e3*n.jitter),n.timestamp&&(t.timestamp=n.timestamp))}getCodecFromCodecStats(e){const t=this.report.get(e);if(!t)return"";const n=t.mimeType.match(/\/(.*)$/);return n&&n[1]?n[1]:""}updateSendBitrate(){let e=0,t=null,n=null;this.mediaBytesSent.forEach((i=>{e+=i.diffMean()})),this.mediaBytesRetransmit.forEach((i=>{t=t===null?i.diffMean():t+i.diffMean()})),this.mediaBytesTargetEncode.forEach((i=>{n=n===null?i.diffMean():n+i.diffMean()}));const r=t!==null?e-t:e;this._stats.bitrate={actualEncoded:8*r/(this.options.updateInterval/1e3),transmit:8*e/(this.options.updateInterval/1e3)},t!==null&&(this._stats.bitrate.retransmit=8*t/(this.options.updateInterval/1e3)),n!==null&&(this._stats.bitrate.targetEncoded=8*n/(this.options.updateInterval/1e3))}},zz=class extends nb{updateStats(){return Pe.resolve()}};function ib(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:250,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:8,r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:500,i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1e4;const s=(function(){const o=navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]*/i);return o&&o[0]?Number(o[0].split("/")[1]):null})();return s?s<76?new Kz(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:r,firstVideoDecodedTimeout:i}):new nL(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:r,firstVideoDecodedTimeout:i}):(function(o){if(!window.RTCStatsReport)return!1;const c=o.getStats();return!!(c instanceof Pe||(function(l){return!!l&&(typeof l=="object"||typeof l=="function")&&typeof l.then=="function"})(c))})(e)?new nL(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:r,firstVideoDecodedTimeout:i}):new zz(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:r,firstVideoDecodedTimeout:i})}const rL="websdk_ng_install_id";function sb(){try{if(F("INSTALL_ID"))return F("INSTALL_ID");let e=window.localStorage.getItem(rL);return e||(e=_h(),window.localStorage.setItem(rL,e)),nn("INSTALL_ID",e),e}catch{return}}const to=(function(e){if(e.match(/[0-9]+\.[0-9]+\.[0-9]+$/))return e;const t=e.match(/([0-9]+\.[0-9]+\.[0-9]+)\-([0-9]+)/);if(t&&t[1]&&t[2]){const n=t[1],r=t[2];return"".concat(n,".").concat(r)}return"4.0.0.999"})("4.24.0"),ob=(function(){try{return JSON.parse("true")===!0}catch{return!0}})();let Eh=(function(e){return e.Default="default",e.Auto="auto",e.Relay="relay",e.SdRtn="sd-rtn",e})({});const Br=(function(){const e="us".concat("erna","me"),t="pa".concat("sswo","rd"),n=["t","s","t"];n.splice(1,0,"e");const r=n.join(""),i=[];for(let c=0;c<6;c++)i.push("1");const s=i.join(""),o={};return o[e]=r,o[t]=s,Object.assign(o,{turnServerURL:"",tcpport:3433,udpport:3478,forceturn:!1})})();window.DEFAULT_TURN_CONFIG=Br;const LS={ENABLE_PUBLISHED_USER_LIST:!0,MAX_SUBSCRIPTION:50,SUBSCRIBE_AUDIO_FILTER_TOPN:void 0,ENABLE_PUBLISH_AUDIO_FILTER:void 0,ENABLE_USER_LICENSE_CHECK:!0,DISABLE_FEC:void 0,ENABLE_NTP_REPORT:!1,ENABLE_INSTANT_VIDEO:!1,ENABLE_USER_AUTO_REBALANCE_CHECK:!0,ENABLE_LOSSBASED_BWE:!0,ENABLE_AUT_CC:!0,FORCE_ENABLE_AUT_CC:!1,ENABLE_CC_FALLBACK:void 0,SUBSCRIBE_TWCC:!0,PUBLISH_TWCC:!1,ENABLE_SVC_DEFAULT_CODECS:["H264","VP8","VP9","AV1"],SVC:[],ENABLE_FULL_LINK_AV_SYNC:!1,SVC_MODE:null,PRE_SUB_NUM:1,ENABLE_AUT_FEEDBACK:!0,SVC_EXTENDED:["VP9"]},ab={MIN_FRAME_RATE:1,MAX_FRAME_RATE:30,MAX_THRESHOLD_FRAMERATE:30,BITRATE_MIN_THRESHOLD:100,BITRATE_MAX_THRESHOLD:100,MAX_SCALE:5,BWE_SCALE_UP_THRESHOLD:.6,BWE_SCALE_DOWN_THRESHOLD:.6,PERF_SCALE_UP_THRESHOLD:.7,PERF_SCALE_DOWN_THRESHOLD:.6,MOTION_RESOLUTION_FACTOR:.8,MOTION_BITRATE_FACTOR:.6,DETAIL_FRAMERATE_FACTOR:.8,DETAIL_BITRATE_FACTOR:.6,BALANCE_RESOLUTION_FACTOR:.9,BALANCE_FRAMERATE_FACTOR:.9,BALANCE_BITRATE_FACTOR:.6,OVERUSE_TIMES_THRESHOLD:10,UNDERUSE_TIMES_THRESHOLD:40},cb="v4.24.0-0-gf2267710-dirty(7/31/2025, 7:00:42 PM)",lb={ENABLE_EVENT_REPORT:!0,UPLOAD_LOG:!1,ENABLE_AG_ADAPTATION:!0,FORCE_AG_HIGH_FRAMERATE:!1,FORCE_SUPPORT_AG_ADAPTATION:!1,ENCODER_CONFIG_LIMIT:{},CAMERA_CAPTURE_CONFIG:void 0,ENABLE_PRELOAD:!0,NEW_ICE_RESTART:!0,ICE_RESTART_INTERVAL:1e4,RESTART_SEQUENCE:["udp_tcp_relay","relay"],FIRST_TCP_CANDIDATE:!1,FIRST_TCP_CANDIDATE_INTERVAL:1e3,TURN_DOMAIN:"edge.agora.io",USE_TURN_IP:!0,NEW_TURN_MODE:4,NEW_FORCE_TURN:!1,USE_NEW_RENDER_FREEZE_TIME:!1,ENCODE_EXCEPTION_TIMES:5,ENABLE_ENCODE_EXCEPTION:!0,ENCODE_EXCEPTION_VALIDATE_CODEC:["h264"],VIDEO_ENCODER_CONFIG_LIST:[{width:240,height:180},{width:320,height:240},{width:400,height:300},{width:480,height:360},{width:560,height:420},{width:640,height:480}],DELETE_NEQ_AFTER_USER_LEAVE:!0},wn=ye(ye(ye(ye({},lb),{},{PROCESS_ID:"",ENCRYPT_AES:!0,AREAS:["CHINA","GLOBAL"],WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io","webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io","webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-web-2.ap.sd-rtn.com","cds-ap-web-3.agora.io","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-web-2.ap.sd-rtn.com","sua-ap-web-3.agora.io","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-ap-web-1.agora.io","uap-web-2.ap.sd-rtn.com","uap-ap-web-3.agora.io","uap-web-4.ap.sd-rtn.com"],LOG_UPLOAD_SERVER:"logservice.agora.io",EVENT_REPORT_DOMAIN:"statscollector-1.agora.io",EVENT_REPORT_BACKUP_DOMAIN:"web-2.statscollector.sd-rtn.com",GATEWAY_ADDRESS:[],GATEWAY_WSS_ADDRESS:"",LIVE_STREAMING_ADDRESS:"",HTTP_CONNECT_TIMEOUT:5e3,SIGNAL_REQUEST_TIMEOUT:1e4,REPORT_STATS:!0,NOT_REPORT_EVENT:[],PING_PONG_TIME_OUT:10,WEBSOCKET_TIMEOUT_MIN:1e4,EVENT_REPORT_SEND_INTERVAL:3e3,CONFIG_DISTRIBUTE_INTERVAL:3e5,ENABLE_CONFIG_DISTRIBUTE:!0,CANDIDATE_TIMEOUT:5e3,SHOW_REPORT_INVOKER_LOG:!1,SHOW_REPORT_USER_INVOKER_LOG:!0,JOIN_EXTEND:"",PUB_EXTEND:"",SUB_EXTEND:"",FORCE_TURN:!1,TURN_ENABLE_TCP:!0,TURN_ENABLE_UDP:!0,MAX_UPLOAD_CACHE:50,UPLOAD_CACHE_INTERVAL:2e3,AJAX_REQUEST_CONCURRENT:3,REPORT_APP_SCENARIO:void 0,GATEWAY_DOMAINS:["edge.agora.io","edge.sd-rtn.com"],CONNECT_GATEWAY_WITHOUT_DOMAIN:!1,WORKER_DOMAIN:"edge.agora.io",EVENT_REPORT_RETRY:!0,CHROME_FORCE_PLAN_B:!1,AUDIO_SOURCE_VOLUME_UPDATE_INTERVAL:400,AUDIO_SOURCE_AVG_VOLUME_DURATION:3e3,AUDIO_VOLUME_INDICATION_INTERVAL:2e3,VOLUME_VOICE_WEIGHT:10,GET_VOLUME_OF_MUTED_AUDIO_TRACK:!1,STATS_UPDATE_INTERVAL:250,NORMAL_EVENT_QUEUE_CAPACITY:100,CUSTOM_REPORT:!0,CUSTOM_REPORT_LIMIT:20,PROXY_SERVER_TYPE2:"webnginx-proxy.agora.io",PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com","webrtc-cloud-proxy.agora.io"],CUSTOM_PUB_ANSWER_MODIFIER:null,CUSTOM_SUB_ANSWER_MODIFIER:null,CUSTOM_PUB_OFFER_MODIFIER:null,CUSTOM_SUB_OFFER_MODIFIER:null,DSCP_TYPE:"high",REMOVE_NEW_CODECS:!0,FRAGEMENT_LENGTH:3,WEBSOCKET_COMPRESS:!1,SIMULCAST:!1,CHECK_VIDEO_VISIBLE_INTERVAL:3e4,CHECK_LOCAL_STATS_INTERVAL:250,PROFILE_SWITCH_INTERVAL:2e3,UNSUPPORTED_VIDEO_CODEC:[],ENUMERATE_DEVICES_INTERVAL:!1,ENUMERATE_DEVICES_INTERVAL_TIME:1e4,USE_NEW_TOKEN:!1,CLOSE_AFB_FOR_LOCAL_AP:!0,JOIN_MAX_CONCURRENCY:6,JOIN_WITH_FALLBACK_SIGNAL_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE:!1,JOIN_GATEWAY_TRY_443PORT_DURATION:2e3,JOIN_GATEWAY_USE_443PORT_ONLY:!1,JOIN_GATEWAY_USE_DUAL_DOMAIN:!0,JOIN_GATEWAY_FALLBACK_PORT:443,USE_TURN_SERVER_OF_GATEWAY:!1,H264_PROFILE_LEVEL_ID:"",USE_NEW_LOG:!1,LOG_VERSION:3,MEDIA_DEVICE_CONSTRAINTS:null,ENCRYPT_PROXY_USERNAME_AND_PSW:!0,SDP_LOGGING:!1,CSP_DETECTED_HOSTNAME_LIST:["agora.io","sd-rtn.com"],REMOTE_AUDIO_TRACK_USES_WEB_AUDIO:!1,LOCAL_AUDIO_TRACK_USES_WEB_AUDIO:!1,BITRATE_ADAPTER_TYPE:"STANDARD_BITRATE",AI_DENOISER_PARAMETERS:{excludedLinks:[]},ADJUST_3A_FROM_PLUGINS:!0,RAISE_H264_BASELINE_PRIORITY:!0,FILTER_SEND_H264_BASELINE:!1,FIRST_H264_PROFILE_LEVEL_ID:"42001f",FIRST_PACKETIZATION_MODE:"",X_GOOGLE_START_BITRATE:void 0,NEW_REPORT_SERVER:!1,NEW_REPORT_SERVER_DOMAINS:["data-reporting.agora.io","data-reporting.agora.io"],VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT:3e5,VIDEO_INSPECT_INTERVAL_MINIMUM:1e3,VIDEO_INSPECT_QUALITY_RATIO:.9,VIDEO_INSPECT_WORKER_MANAGER_HOST:"edge.agora.io",VIDEO_INSPECT_WORKER_MANAGER_PORT:"",VIDEO_INSPECT_WORKER_PORT:"",SHOW_VIDEO_INSPECT_WORKER_MESSAGE:!1,STATS_COLLECTOR_PORT:443,FORCE_TURN_TCP:!1,WEBAUDIO_INIT_OPTIONS:void 0,FILTER_VIDEO_FEC:!0,FILTER_AUDIO_FEC:!1,CHROME_DUAL_STREAM_USE_ENCODING:!0,DISABLE_DUAL_STREAM_USE_ENCODING:!1,EXTENSION_USAGE_UPLOAD_INTERVAL:1e4,ICE_RESTART:!0,FINGERPRINT:null,ENABLE_VIDEO_FRAME_CALLBACK:!0,VIDEO_FREEZE_DURATION:500,SPATIALIZER_PARAMETERS:{},UPLOAD_LOG_INTERVAL:3e3,UPLOAD_LOG_REQUEST_RETRY_INTERVAL:2e3,UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL:2e4,UPLOAD_LOG_TRY_INTERVAL_WHILE_OFF:5e3,UPLOAD_LOG_RETRY_INTERVAL_V1:1e4,UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1:200,UPLOAD_LOG_LENGTH_EACH_TIME:10,APP_TYPE:0,DISABLE_WEBAUDIO:!1,CHANNEL_MEDIA_RELAY_SERVERS:void 0,KEEP_LAST_FRAME:!0,FORWARD_P2P_CREATION:!0,SYNC_GROUP:!0,BLOCK_LOCAL_CLIENT:!1,ENABLE_AUDIO_TOPN:!1,ENABLE_AUDIO_METADATA:!1,ENABLE_AUDIO_PTS:!1,TOPN_SMOOTH_LEVEL:void 0,TOPN_NEW_SPEAKER_DELAY:void 0,TOPN_SWITCH_HOLD_MS:void 0,TOPN_AUDIO_GAIN:void 0,TOPN_SILENCE_THRESHOLD:250,AP_AREA:!0,ENABLE_ENCODED_TRANSFORM:!1,ENABLE_VIDEO_SEI:!1,IMAGE_MODERATION_WORKER_HOST:"edge.agora.io",IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT:3e5,IMAGE_MODERATION_INTERVAL_MINIMUM:1e3,SHOW_IMAGE_MODERATION_WORKER_MESSAGE:!1,IMAGE_MODERATION_QUALITY_RATIO:.9,IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL:5e3,SHOW_GLOBAL_CLIENT_LIST:!1,DATASTREAM_MAX_RETRANSMITS:10,TCP_CANDIDATE_ONLY:!1,EXTERNAL_SIGNAL_REQUEST_TIMEOUT:3e3,SHOW_P2P_LOG:!1,MAX_P2P_TIMEOUT:3e4,P2P_TOKEN_INTERVAL:1e3,SHOW_DATASTREAM2_LOG:!1,RESTRICTION_SET_PLAYBACK_DEVICE:!0,USE_PURE_ENCRYPTION_MASTER_KEY:!1,ENABLE_AUDIO_RED:!1,OPUS_PTIME:void 0,AUDIO_DUPLICATE_NUM:void 0,ENABLE_ABSSENDTIME_AS_SENTTS:!0,ACCOUNT_REGISTER_RETRY_TIMEOUT:1,ACCOUNT_REGISTER_RETRY_RATIO:2,ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX:6e4,ACCOUNT_REGISTER_RETRY_COUNT_MAX:1e5,AUDIO_CONTEXT:null,WEBCS_BACKUP_CONNECT_TIMEOUT:6e3,PLAYER_STATE_DEFER:2e3,SIGNAL_REQUEST_WATCH_INTERVAL:1e3,FILEPATH_LENMAX:255,DUALSTREAM_OPERATION_CHECK:!0,MEDIA_ELEMENT_EXISTS_DEPTH:3,SHIM_CANDIDATE:!1,LEAVE_MSG_TIMEOUT:2e3,STATS_FILTER:{transportId:!0,googTrackId:!0},FILTER_VIDEO_CODEC:[],UNSUPPORTED_VIDEO_UPLINK_CODEC:[],UNSUPPORTED_VIDEO_DOWNLINK_CODEC:[],USE_NEW_NETWORK_CONFIG:!1,AUTO_RESET_AUDIO_ROUTE:!1,PLUGIN_INFO:[],OVERUSE_DETECTOR_PARAMS:ab,CUSTOM_ADAPTATION_DEFAULT_MODE:"",HIDE_NO_POSTER:!1,AP_CACHE_NUM:10,AP_UPDATE_INTERVAL:12e4,AP_CACHE_LIFETIME:12e4,MAX_PRELOAD_ASYNC_LENGTH:3,DISABLE_SCREEN_SHARE_REMB:!1},LS),{},{USE_CANDIDATE_FROM_AP_DETAIL:!1,AP_REQUEST_DETAIL:void 0,ENABLE_ROLE_SELECT_EDGE:!1,CLIENT_ROLE_OPTIONS:void 0,COMPATIBLE_SDP_EXTENSION:["gdpr_forbidden"],LIMIT_BITRATE:void 0,EXPERIMENTS:{},USE_PUB_RTX:!0,USE_SUB_RTX:!0,ENABLE_DATASTREAM_2:!1,USE_XR:!0,ENABLE_PREALLOC_PC:!1,ENABLE_PRE_SUB:!1,ENABLE_SVC:!1,ENABLE_PRE_RENDER:!1,FORCE_DISABLE_AUTO_SUB:!1,ENABLE_PRE_SUB_WITH_PRE_PC:!1,PRE_USE_LOCAL_CODECS:!0},{INSTALL_ID:""}),{},{K_MIN_RENDER_DELAY:66,USE_STANDARD_BITRATE_DEFAULT:!1,VIDEO_NEW_BITRATE_RATIO:void 0,VIDEO_STANDARD_BITRATE_VERSION:2,BASELINE_MORE_H264_BITRATE_RATIO:1.1});function nn(e,t,n){var r,i,s;Re(r=Object.keys(wn)).call(r,e)&&(!n&&Re(i=Object.keys(Ra)).call(i,e)||(wn[e]=t,e!=="ENABLE_VIDEO_SEI"&&e!=="ENABLE_AUDIO_TOPN"&&e!=="ENABLE_AUDIO_METADATA"&&e!=="ENABLE_AUDIO_PTS"||t!==!0||(wn.ENABLE_ENCODED_TRANSFORM=!0),e==="USE_NEW_NETWORK_CONFIG"&&t&&(s=!!t,wn.USE_NEW_NETWORK_CONFIG=s,s&&(wn.WEBCS_DOMAIN=["webrtc2-2.ap.sd-rtn.com"],wn.WEBCS_DOMAIN_BACKUP_LIST=["webrtc2-4.ap.sd-rtn.com"],wn.CDS_AP=["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],wn.ACCOUNT_REGISTER=["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],wn.EVENT_REPORT_DOMAIN="web-2.statscollector.sd-rtn.com",wn.EVENT_REPORT_BACKUP_DOMAIN="statscollector-1.agora.io",wn.GATEWAY_DOMAINS=["edge.sd-rtn.com"])),e==="ENABLE_PRE_SUB"&&t&&(wn.ENABLE_INSTANT_VIDEO=!0,wn.ENABLE_PREALLOC_PC=!0),e==="ENABLE_SVC"&&t&&(wn.ENABLE_AUT_CC=!0),e==="NEW_FORCE_TURN"&&t&&(wn.NEW_TURN_MODE||(wn.NEW_TURN_MODE=4))))}function F(e){return wn[e]}ob||(wn.WEBCS_DOMAIN=["ap-web-1-oversea.agora.io","ap-web-1-north-america.agora.io"],wn.WEBCS_DOMAIN_BACKUP_LIST=["ap-web-2-oversea.agora.io","ap-web-2-north-america.agora.io"],wn.PROXY_CS=["proxy-ap-web-oversea.agora.io","proxy-ap-web-america.agora.io"],wn.CDS_AP=["cds-ap-web-oversea.agora.io","cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],wn.ACCOUNT_REGISTER=["sua-ap-web-oversea.agora.io","sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],wn.UAP_AP=["uap-ap-web-oversea.agora.io","uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],wn.LOG_UPLOAD_SERVER="logservice-oversea.agora.io",wn.EVENT_REPORT_DOMAIN="statscollector-1-oversea.agora.io",wn.EVENT_REPORT_BACKUP_DOMAIN="statscollector-2-oversea.agora.io",wn.PROXY_SERVER_TYPE3="webrtc-cloud-proxy.agora.io",wn.AREAS=["NORTH_AMERICA","OVERSEA"]);let iL=(function(e){return e[e.REALTIME=1]="REALTIME",e})({});const Ra={};var dt=(function(e){return e.SET_SESSION_ID="SET_SESSION_ID",e.SET_P2P_ID="SET_P2P_id",e.SET_DC_ID="SET_DC_id",e.SET_UID="SET_UID",e.SET_INT_UID="SET_INT_UID",e.SET_PUB_ID="SET_PUB_ID",e.SET_CLOUD_PROXY_SERVER_MODE="SET_CLOUD_PROXY_SERVER_MODE",e.KEY_METRIC_CLIENT_CREATED="KEY_METRIC_CLIENT_CREATED",e.KEY_METRIC_JOIN_START="KEY_METRIC_JOIN_START",e.KEY_METRIC_PRELOAD_START="KEY_METRIC_PRELOAD_START",e.KEY_METRIC_PRELOAD_END="KEY_METRIC_PRELOAD_END",e.KEY_METRIC_JOIN_END="KEY_METRIC_JOIN_END",e.KEY_METRIC_REQUEST_AP_START="KEY_METRIC_REQUEST_AP_START",e.KEY_METRIC_REQUEST_AP_END="KEY_METRIC_REQUEST_AP_END",e.KEY_METRIC_REQUEST_SUA_END="KEY_METRIC_REQUEST_SUA_END",e.KEY_METRIC_BEFORE_CONNECT="KEY_METRIC_BEFORE_CONNECT",e.KEY_METRIC_PEER_RECEIVER="KEY_METRIC_PEER_RECEIVER",e.KEY_METRIC_SIGNAL_CONNECTED="KEY_METRIC_SIGNAL_CONNECTED",e.KEY_METRIC_JOIN_REQ="KEY_METRIC_JOIN_REQ",e.KEY_METRIC_JOIN_REP="KEY_METRIC_JOIN_REP",e.KEY_METRIC_JOIN_GATEWAY_START="KEY_METRIC_JOIN_GATEWAY_START",e.KEY_METRIC_JOIN_GATEWAY_END="KEY_METRIC_JOIN_GATEWAY_END",e.KEY_METRIC_PEER_CONNECTION_START="KEY_METRIC_PEER_CONNECTION_START",e.KEY_METRIC_PEER_CONNECTION_END="KEY_METRIC_PEER_CONNECTION_END",e.KEY_METRIC_FIRST_VIDEO_FRAME_DECODED="KEY_METRIC_FIRST_VIDEO_FRAME_DECODED",e.KEY_METRIC_DESCRIPTION_START="KEY_METRIC_DESCRIPTION_START",e.KEY_METRIC_ICE_CONNECTION_END="KEY_METRIC_ICE_CONNECTION_END",e.KEY_METRIC_SIGNAL_CHANNEL_OPEN="KEY_METRIC_SIGNAL_CHANNEL_OPEN",e.KEY_METRIC_PUBLISH="KEY_METRIC_PUBLISH",e.KEY_METRIC_SUBSCRIBE="KEY_METRIC_SUBSCRIBE",e.RECORD_JOIN_CHANNEL_SERVICE="RECORD_JOIN_CHANNEL_SERVICE",e.RESET_JOIN_CHANNEL_SERVICE_RECORDS="RESET_JOIN_CHANNEL_SERVICE_RECORDS",e.RESET_KEY_METRICS="RESET_KEY_METRICS",e.RESET_FIRST_VIDEO_FRAME_DECODED="RESET_FIRST_VIDEO_FRAME_DECODED",e.SET_USE_P2P="SET_USE_P2P",e.SET_TRANSPORT_TYPE="SET_TRANSPORT_TYPE",e})(dt||{});let WE=(function(e){return e.h264="h264",e.h265="h265",e.vp8="vp8",e.vp9="vp9",e.av1="av1",e})({});(function(e){e.opus="opus",e.pcma="pcma",e.pcmu="pcmu",e.g722="g722"})({});const sL=128,Yz=96,oL=1e3,If=10;let qz=0;var aL=(()=>{var e={8:(r,i,s)=>{s.r(i),s.d(i,{Parser:()=>me,Printer:()=>Xt,parse:()=>we,print:()=>Me});const o=`
`,c="".concat("\r").concat(o),l=" ";let h;function p(_e){return _e>="0"&&_e<="9"}function E(_e){return _e>="!"&&_e<="~"}function g(_e){return E(_e)||_e>=""&&_e<=""}function v(_e){return _e==="!"||_e>="#"&&_e<="'"||_e>="*"&&_e<="+"||_e>="-"&&_e<="."||_e>="0"&&_e<="9"||_e>="A"&&_e<="Z"||_e>="^"&&_e<="~"}function O(_e){return _e>="1"&&_e<="9"}function I(_e){return _e>="A"&&_e<="Z"||_e>="a"&&_e<="z"}function N(_e){return _e==="d"||_e==="h"||_e==="m"||_e==="s"}function M(_e){return _e>""&&_e<"	"||_e>"\v"&&_e<"\f"||_e>""&&_e<""}function x(_e){return I(_e)||p(_e)||_e==="+"||_e==="/"}function B(_e){return p(_e)||I(_e)||_e==="+"||_e==="/"||_e==="-"||_e==="_"}function Z(_e){return I(_e)||p(_e)||_e==="+"||_e==="/"}function Q(_e,w){var H=Object.keys(_e);if(Object.getOwnPropertySymbols){var J=Object.getOwnPropertySymbols(_e);w&&(J=J.filter((function(Te){return Object.getOwnPropertyDescriptor(_e,Te).enumerable}))),H.push.apply(H,J)}return H}function z(_e){for(var w=1;w<arguments.length;w++){var H=arguments[w]!=null?arguments[w]:{};w%2?Q(Object(H),!0).forEach((function(J){te(_e,J,H[J])})):Object.getOwnPropertyDescriptors?Object.defineProperties(_e,Object.getOwnPropertyDescriptors(H)):Q(Object(H)).forEach((function(J){Object.defineProperty(_e,J,Object.getOwnPropertyDescriptor(H,J))}))}return _e}function te(_e,w,H){return w in _e?Object.defineProperty(_e,w,{value:H,enumerable:!0,configurable:!0,writable:!0}):_e[w]=H,_e}(function(_e){_e.VERSION="v",_e.ORIGIN="o",_e.SESSION_NAME="s",_e.INFORMATION="i",_e.URI="u",_e.EMAIL="e",_e.PHONE="p",_e.CONNECTION="c",_e.BANDWIDTH="b",_e.TIME="t",_e.REPEAT="r",_e.ZONE_ADJUSTMENTS="z",_e.KEY="k",_e.ATTRIBUTE="a",_e.MEDIA="m"})(h||(h={}));class de{consumeText(w,H){let J=H;for(;J<w.length;){const Te=w[J];if(Te==="\0"||Te==="\r"||Te===o)break;J+=1}if(J-H==0)throw new Error("Invalid text, at ".concat(w));return J}consumeUnicastAddress(w,H,J){return this.consumeTill(w,H,l)}consumeOneOrMore(w,H,J){let Te=H;for(;J(w[Te]);)Te++;if(Te-H==0)throw new Error("Invalid rule at ".concat(H,"."));return Te}consumeSpace(w,H){if(w[H]===l)return H+1;throw new Error("Invalid space at ".concat(H,"."))}consumeIP4Address(w,H){let J=H;for(let Te=0;Te<4;Te++)if(J=this.consumeDecimalUChar(w,J),Te!==3){if(w[J]!==".")throw new Error("Invalid IP4 address.");J++}return J}consumeDecimalUChar(w,H){let J=H;for(let mt=0;mt<3&&p(w[J]);mt++,J++);if(J-H==0)throw new Error("Invalid decimal uchar.");const Te=parseInt(w.slice(H,J));if(Te>=0&&Te<=255)return J;throw new Error("Invalid decimal uchar")}consumeIP6Address(w,H){let J=this.consumeHexpart(w,H);return w[J]===":"&&(J+=1,J=this.consumeIP4Address(w,J)),J}consumeHexpart(w,H){let J=H;if(w[J]===":"&&w[J+1]===":"){J+=2;try{J=this.consumeHexseq(w,J)}catch{}return J}if(J=this.consumeHexseq(w,J),w[J]===":"&&w[J+1]===":"){J+=2;try{J=this.consumeHexseq(w,J)}catch{}return J}return J}consumeHexseq(w,H){let J=H;for(;J=this.consumeHex4(w,J),w[J]===":"&&w[J+1]!==":";)J+=1;return J}consumeHex4(w,H){let J=0;for(;J<4;J++)if(!((Te=w[H+J])>="0"&&Te<="9"||Te>="a"&&Te<="f"||Te>="A"&&Te<="F")){if(J===0)throw new Error("Invalid hex 4");break}var Te;return H+J}consumeFQDN(w,H){let J=H;for(;p(w[J])||I(w[J])||w[J]==="-"||w[J]===".";)J+=1;if(J-H<4)throw new Error("Invalid FQDN");return J}consumeExtnAddr(w,H){return this.consumeOneOrMore(w,H,g)}consumeMulticastAddress(w,H,J){switch(J){case"IP4":case"ip4":return this.consumeIP4MulticastAddress(w,H);case"IP6":case"ip6":return this.consumeIP6MulticastAddress(w,H);default:try{return this.consumeFQDN(w,H)}catch{return this.consumeExtnAddr(w,H)}}}consumeIP6MulticastAddress(w,H){const J=this.consumeHexpart(w,H);return w[J]==="/"?this.consumeInteger(w,J+1):J}consumeIP4MulticastAddress(w,H){let J=H+3;const Te=w.slice(H,J),mt=parseInt(Te);if(mt<224||mt>239)throw new Error("Invalid IP4 multicast address, IPv4 multicast addresses may be in the range 224.0.0.0 to 239.255.255.255.");for(let fn=0;fn<3;fn++){if(w[J]!==".")throw new Error("Invalid IP4 multicast address.");J+=1,J=this.consumeDecimalUChar(w,J)}return w[J]==="/"&&(J+=1),J=this.consumeTTL(w,J),w[J]==="/"&&(J=this.consumeInteger(w,J)),J}consumeInteger(w,H){if(!O(w[H]))throw new Error("Invalid integer.");for(H+=1;p(w[H]);)H+=1;return H}consumeTTL(w,H){if(w[H]==="0")return H+1;if(!O(w[H]))throw new Error("Invalid TTL.");H+=1;for(let J=0;J<2&&p(w[H]);J++)H+=1;return H}consumeToken(w,H){return this.consumeOneOrMore(w,H,v)}consumeTime(w,H){let J=H;if(w[J]==="0")return J+1;for(O(w[J])&&(J+=1);p(w[J]);)J++;if(J-H<10)throw new Error("Invalid time");return J}consumeAddress(w,H){return this.consumeTill(w,H,l)}consumeTypedTime(w,H){let J=H;return J=this.consumeOneOrMore(w,J,p),N(w[J])?J+1:J}consumeRepeatInterval(w,H){if(!O(w[H]))throw new Error("Invalid repeat interval");for(H+=1;p(w[H]);)H+=1;return N(w[H])&&(H+=1),H}consumePort(w,H){return this.consumeOneOrMore(w,H,p)}consume(w,H,J){for(let Te=0;Te<J.length;Te++){if(H+Te>=w.length)throw new Error("consume exceeding value length");if(w[H+Te]!==J[Te])throw new Error("consume ".concat(J," failed at ").concat(Te))}return H+J.length}consumeTill(w,H,J){let Te=H;for(;Te<w.length&&(typeof J!="string"||w[Te]!==J)&&(typeof J!="function"||!J(w[Te]));)Te++;return Te}}class me extends de{constructor(){super(),te(this,"records",[]),te(this,"currentLine",0)}parse(w){const H=this.probeEOL(w);this.records=w.split(H).filter((wl=>!!pi(wl).call(wl))).map(this.parseLine),this.currentLine=0;const J=this.parseVersion(),Te=this.parseOrigin(),mt=this.parseSessionName(),fn=this.parseInformation(),lr=this.parseUri(),uo=this.parseEmail(),Qo=this.parsePhone(),bg=this.parseConnection(),Uh=this.parseBandWidth(),sm=this.parseTimeFields(),qT=this.parseKey(),XT=this.parseSessionAttribute(),ho=this.parseMediaDescription();if(this.currentLine!==this.records.length)throw new Error("parsing failed, non exhaustive sdp lines.");return{version:J,origin:Te,sessionName:mt,information:fn,uri:lr,emails:uo,phones:Qo,connection:bg,bandwidths:Uh,timeFields:sm,key:qT,attributes:XT,mediaDescriptions:ho}}getCurrentRecord(){const w=this.records[this.currentLine];if(!w)throw new Error("Record doesn't exit.");return w}probeEOL(w){for(let H=0;H<w.length;H++)if(w[H]===o)return w[H-1]==="\r"?c:o;throw new Error("Invalid newline character.")}parseLine(w,H){if(w.length<2)throw new Error("Invalid sdp line, sdp line should be of form <type>=<value>.");const J=w[0];if(w[1]!=="=")throw new Error('Invalid sdp line, <type> should be a single character followed by an "=" sign.');return{type:J,value:w.slice(2),line:H,cur:0}}parseSessionAttribute(){const w=new St;for(;this.currentLine<this.records.length;){const H=this.getCurrentRecord();if(H.type!==h.ATTRIBUTE)break;const J={attField:this.extractOneOrMore(H,(Te=>v(Te)&&Te!==":")),_cur:0};H.value[H.cur]===":"&&(H.cur+=1,J.attValue=this.extractOneOrMore(H,M)),w.parse(J),this.currentLine++}return w.digest()}parseMediaAttributes(w){const H=new wt(w);for(;this.currentLine<this.records.length;){const J=this.getCurrentRecord();if(J.type!==h.ATTRIBUTE)break;const Te={attField:this.extractOneOrMore(J,(mt=>v(mt)&&mt!==":")),_cur:0};J.value[J.cur]===":"&&(J.cur+=1,Te.attValue=this.extractOneOrMore(J,M)),H.parse(Te),this.currentLine++}return H.digest()}parseKey(){const w=this.getCurrentRecord();if(w.type===h.KEY){if(w.value==="prompt"||w.value==="clear:"||w.value==="base64:"||w.value==="uri:")return w.value;throw this.currentLine++,new Error("Invalid key.")}}parseZone(){const w=this.getCurrentRecord();if(w.type===h.ZONE_ADJUSTMENTS){const H=[];for(;;)try{const J=this.extract(w,this.consumeTime);this.consumeSpaceForRecord(w);let Te=!1;w.value[w.cur]==="-"&&(Te=!0,w.cur+=1);const mt=this.extract(w,this.consumeTypedTime);H.push({time:J,typedTime:mt,back:Te})}catch{break}if(H.length===0)throw new Error("Invalid zone adjustments");return this.currentLine++,H}return[]}parseRepeat(){const w=[];for(;;){const H=this.getCurrentRecord();if(H.type!==h.REPEAT)break;{const J=this.extract(H,this.consumeRepeatInterval),Te=this.parseTypedTime(H);w.push({repeatInterval:J,typedTimes:Te}),this.currentLine++}}return w}parseTypedTime(w){const H=[];for(;;)try{this.consumeSpaceForRecord(w),H.push(this.extract(w,this.consumeTypedTime))}catch{break}if(H.length===0)throw new Error("Invalid typed time.");return H}parseTime(){const w=this.getCurrentRecord(),H=this.extract(w,this.consumeTime);this.consumeSpaceForRecord(w);const J=this.extract(w,this.consumeTime);return this.currentLine++,{startTime:H,stopTime:J}}parseBandWidth(){const w=[];for(;this.currentLine<this.records.length;){const H=this.getCurrentRecord();if(H.type!==h.BANDWIDTH)break;{const J=this.extractOneOrMore(H,v);if(H.value[H.cur]!==":")throw new Error("Invalid bandwidth field.");H.cur++;const Te=this.extractOneOrMore(H,p);w.push({bwtype:J,bandwidth:Te}),this.currentLine++}}return w}parseVersion(){const w=this.getCurrentRecord();if(w.type!==h.VERSION)throw new Error("first sdp record must be version");const H=w.value.slice(0,this.consumeOneOrMore(w.value,0,p));if(H.length!==w.value.length)throw new Error('invalid proto version, "v='.concat(w.value,'"'));return this.currentLine++,H}parseOrigin(){const w=this.getCurrentRecord();if(w.type!==h.ORIGIN)throw new Error("second line of sdp must be origin");const H=this.extractOneOrMore(w,g);this.consumeSpaceForRecord(w);const J=this.extractOneOrMore(w,p);this.consumeSpaceForRecord(w);const Te=this.extractOneOrMore(w,p);this.consumeSpaceForRecord(w);const mt=this.extractOneOrMore(w,v);this.consumeSpaceForRecord(w);const fn=this.extractOneOrMore(w,v);this.consumeSpaceForRecord(w);const lr=this.extract(w,this.consumeUnicastAddress);return this.currentLine++,{username:H,sessId:J,sessVersion:Te,nettype:mt,addrtype:fn,unicastAddress:lr}}parseSessionName(){const w=this.getCurrentRecord();if(w.type===h.SESSION_NAME){const H=this.extract(w,this.consumeText);return this.currentLine++,H}}parseInformation(){const w=this.getCurrentRecord();if(w.type!==h.INFORMATION)return;const H=this.extract(w,this.consumeText);return this.currentLine++,H}parseUri(){const w=this.getCurrentRecord();if(w.type===h.URI)return this.currentLine++,w.value}parseEmail(){const w=[];for(;;){const H=this.getCurrentRecord();if(H.type!==h.EMAIL)break;w.push(H.value),this.currentLine++}return w}parsePhone(){const w=[];for(;;){const H=this.getCurrentRecord();if(H.type!==h.PHONE)break;w.push(H.value),this.currentLine++}return w}parseConnection(){const w=this.getCurrentRecord();if(w.type===h.CONNECTION){const H=this.extractOneOrMore(w,v);this.consumeSpaceForRecord(w);const J=this.extractOneOrMore(w,v);this.consumeSpaceForRecord(w);const Te=this.extract(w,this.consumeAddress);return this.currentLine++,{nettype:H,addrtype:J,address:Te}}}parseMedia(){const w=this.getCurrentRecord(),H=this.extract(w,this.consumeToken);this.consumeSpaceForRecord(w);let J=this.extract(w,this.consumePort);w.value[w.cur]==="/"&&(w.cur+=1,J+=this.extract(w,this.consumeInteger)),this.consumeSpaceForRecord(w);const Te=[];for(Te.push(this.extract(w,this.consumeToken));w.value[w.cur]==="/";)w.cur+=1,Te.push(this.extract(w,this.consumeToken));if(Te.length===0)throw new Error("Invalid proto");const mt=this.parseFmt(w);return this.currentLine++,{mediaType:H,port:J,protos:Te,fmts:mt}}parseTimeFields(){const w=[];for(;this.getCurrentRecord().type===h.TIME;){const H=this.parseTime(),J=this.parseRepeat(),Te=this.parseZone();w.push({time:H,repeats:J,zones:Te})}return w}parseMediaDescription(){const w=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===h.MEDIA;){const H=this.parseMedia(),J=this.parseInformation(),Te=this.parseConnections(),mt=this.parseBandWidth(),fn=this.parseKey(),lr=this.parseMediaAttributes(H);w.push({media:H,information:J,connections:Te,bandwidths:mt,key:fn,attributes:lr})}return w}parseConnections(){const w=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===h.CONNECTION;)w.push(this.parseConnection());return w}parseFmt(w){const H=[];for(;;)try{this.consumeSpaceForRecord(w),H.push(this.extract(w,this.consumeToken))}catch{break}if(H.length===0)throw new Error("Invalid fmts");return H}extract(w,H){for(var J=arguments.length,Te=new Array(J>2?J-2:0),mt=2;mt<J;mt++)Te[mt-2]=arguments[mt];const fn=H.call(this,w.value,w.cur,...Te),lr=w.value.slice(w.cur,fn);return w.cur=fn,lr}extractOneOrMore(w,H){const J=this.consumeOneOrMore(w.value,w.cur,H),Te=w.value.slice(w.cur,J);return w.cur=J,Te}consumeSpaceForRecord(w){if(w.value[w.cur]!==l)throw new Error("Invalid space at ".concat(w.cur,"."));w.cur+=1}}class ve extends de{constructor(){super(...arguments),te(this,"attributes",void 0),te(this,"digested",!1)}extractOneOrMore(w,H,J){const Te=this.consumeOneOrMore(w.attValue,w._cur,H),mt=w.attValue.slice(w._cur,Te),[fn,lr]=J||[];if(typeof fn=="number"&&mt.length<fn)throw new Error("error in length, should be more or equal than ".concat(fn," characters."));if(typeof lr=="number"&&mt.length>lr)throw new Error("error in length, should be less or equal than ".concat(lr," characters."));return w._cur=Te,mt}consumeAttributeSpace(w){if(w.attValue[w._cur]!==l)throw new Error("Invalid space at ".concat(w._cur,"."));w._cur+=1}extract(w,H){if(!w.attValue)throw new Error("Nothing to extract from attValue.");for(var J=arguments.length,Te=new Array(J>2?J-2:0),mt=2;mt<J;mt++)Te[mt-2]=arguments[mt];const fn=H.call(this,w.attValue,w._cur,...Te),lr=w.attValue.slice(w._cur,fn);return w._cur=fn,lr}atEnd(w){if(!w.attValue)throw new Error;return w._cur>=w.attValue.length}peekChar(w){if(!w.attValue)throw new Error;return w.attValue[w._cur]}peek(w,H){if(!w.attValue)throw new Error;for(let J=0;J<H.length;J++)if(H[J]!==w.attValue[w._cur+J])return!1;return!0}parseIceUfrag(w){if(this.attributes.iceUfrag)throw new Error("Invalid ice-ufrag, should be only a single line if 'a=ice-ufrag'");this.attributes.iceUfrag=this.extractOneOrMore(w,x,[4,256])}parseIcePwd(w){if(this.attributes.icePwd)throw new Error("Invalid ice-pwd, should be only a single line if 'a=ice-pwd'");this.attributes.icePwd=this.extractOneOrMore(w,x,[22,256])}parseIceOptions(w){if(this.attributes.iceOptions)throw new Error("Invalid ice-options, should be only one 'ice-options' line");const H=[];for(;!this.atEnd(w);){H.push(this.extractOneOrMore(w,x));try{this.consumeAttributeSpace(w)}catch(J){if(this.atEnd(w))break;throw J}}this.attributes.iceOptions=H}parseFingerprint(w){const H=this.extract(w,this.consumeToken);this.consumeAttributeSpace(w);const J=this.extract(w,this.consumeTill);this.attributes.fingerprints.push({hashFunction:H,fingerprint:J})}parseExtmap(w){const H=this.extractOneOrMore(w,p);let J;this.peekChar(w)==="/"&&(this.extract(w,this.consume,"/"),J=this.extract(w,this.consumeToken)),this.consumeAttributeSpace(w);const Te=this.extract(w,this.consumeTill,l),mt=z(z({entry:parseInt(H,10)},J&&{direction:J}),{},{extensionName:Te});this.peekChar(w)===l&&(this.consumeAttributeSpace(w),mt.extensionAttributes=this.extract(w,this.consumeTill)),this.attributes.extmaps.push(mt)}parseSetup(w){if(this.attributes.setup)throw new Error("must only be one single 'a=setup' line.");const H=this.extract(w,this.consumeTill);if(H!=="active"&&H!=="passive"&&H!=="actpass"&&H!=="holdconn")throw new Error("role must be one of 'active', 'passive', 'actpass', 'holdconn'.");this.attributes.setup=H}}class St extends ve{constructor(){super(...arguments),te(this,"attributes",{unrecognized:[],groups:[],extmaps:[],fingerprints:[],identities:[]})}parse(w){if(this.digested)throw new Error("already digested");try{switch(w.attField){case"group":this.parseGroup(w);break;case"ice-lite":this.parseIceLite();break;case"ice-ufrag":this.parseIceUfrag(w);break;case"ice-pwd":this.parseIcePwd(w);break;case"ice-options":this.parseIceOptions(w);break;case"fingerprint":this.parseFingerprint(w);break;case"setup":this.parseSetup(w);break;case"tls-id":this.parseTlsId(w);break;case"identity":this.parseIdentity(w);break;case"extmap":this.parseExtmap(w);break;case"msid-semantic":this.parseMsidSemantic(w);break;default:w.ignored=!0,this.attributes.unrecognized.push(w)}}catch(H){throw console.error("parsing session attribute ".concat(w.attField,' error, "a=').concat(w.attField,":").concat(w.attValue,'"')),H}if(!w.ignored&&w.attValue&&!this.atEnd(w))throw new Error("attribute parsing error")}digest(){return this.digested=!0,this.attributes}parseGroup(w){const H=this.extract(w,this.consumeToken),J=[];for(;!this.atEnd(w)&&this.peekChar(w)===l;)this.consumeAttributeSpace(w),J.push(this.extract(w,this.consumeToken));this.attributes.groups.push({semantic:H,identificationTag:J})}parseIceLite(){if(this.attributes.iceLite)throw new Error("Invalid ice-lite, should be only a single line of 'a=ice-lite'");this.attributes.iceLite=!0}parseTlsId(w){if(this.attributes.tlsId)throw new Error("must be only one tld-id line");this.attributes.tlsId=this.extractOneOrMore(w,B)}parseIdentity(w){const H=this.extractOneOrMore(w,Z),J=[];for(;!this.atEnd(w)&&this.peekChar(w)===l;){this.consumeAttributeSpace(w);const Te=this.extract(w,this.consumeToken);this.extract(w,this.consume,"=");const mt=this.extractOneOrMore(w,(fn=>fn!==l&&M(fn)));J.push({name:Te,value:mt})}this.attributes.identities.push({assertionValue:H,extensions:J})}parseMsidSemantic(w){this.peekChar(w)===l&&this.consumeAttributeSpace(w);const H={semantic:this.extract(w,this.consumeToken),identifierList:[]};for(;;){try{this.consumeAttributeSpace(w)}catch{break}if(this.peekChar(w)==="*"){this.extract(w,this.consume,"*"),H.applyForAll=!0;break}{const J=this.extract(w,this.consumeTill,l);H.identifierList.push(J)}}this.attributes.msidSemantic=H}}class wt extends ve{constructor(w){super(),te(this,"attributes",void 0),w.protos.indexOf("RTP")!==-1||w.protos.indexOf("rtp"),this.attributes={unrecognized:[],candidates:[],extmaps:[],fingerprints:[],imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[]}}parse(w){if(this.digested)throw new Error("already digested");try{switch(w.attField){case"extmap":this.parseExtmap(w);break;case"setup":this.parseSetup(w);break;case"ice-ufrag":this.parseIceUfrag(w);break;case"ice-pwd":this.parseIcePwd(w);break;case"ice-options":this.parseIceOptions(w);break;case"candidate":this.parseCandidate(w);break;case"remote-candidate":this.parseRemoteCandidate(w);break;case"end-of-candidates":this.parseEndOfCandidates();break;case"fingerprint":this.parseFingerprint(w);break;case"rtpmap":this.parseRtpmap(w);break;case"ptime":this.parsePtime(w);break;case"maxptime":this.parseMaxPtime(w);break;case"sendrecv":case"recvonly":case"sendonly":case"inactive":this.parseDirection(w);break;case"ssrc":this.parseSSRC(w);break;case"fmtp":this.parseFmtp(w);break;case"rtcp-fb":this.parseRtcpFb(w);break;case"rtcp-mux":this.parseRTCPMux();break;case"rtcp-mux-only":this.parseRTCPMuxOnly();break;case"rtcp-rsize":this.parseRTCPRsize();break;case"rtcp":this.parseRTCP(w);break;case"mid":this.parseMid(w);break;case"msid":this.parseMsid(w);break;case"imageattr":this.parseImageAttr(w);break;case"rid":this.parseRid(w);break;case"simulcast":this.parseSimulcast(w);break;case"sctp-port":this.parseSctpPort(w);break;case"max-message-size":this.parseMaxMessageSize(w);break;case"ssrc-group":this.parseSSRCGroup(w);break;default:w.ignored=!0,this.attributes.unrecognized.push(w)}}catch(H){throw console.error("parsing media attribute ".concat(w.attField,' error, "a=').concat(w.attField,":").concat(w.attValue,'"')),H}if(!w.ignored&&w.attValue&&!this.atEnd(w))throw new Error("attribute parsing error")}parseCandidate(w){const H=this.extractOneOrMore(w,x,[1,32]);this.consumeAttributeSpace(w);const J=this.extractOneOrMore(w,p,[1,5]);this.consumeAttributeSpace(w);const Te=this.extract(w,this.consumeToken);this.consumeAttributeSpace(w);const mt=this.extractOneOrMore(w,p,[1,10]);this.consumeAttributeSpace(w);const fn=this.extract(w,this.consumeAddress);this.consumeAttributeSpace(w);const lr=this.extract(w,this.consumePort);this.consumeAttributeSpace(w),this.extract(w,this.consume,"typ"),this.consumeAttributeSpace(w);const uo={foundation:H,componentId:J,transport:Te,priority:mt,connectionAddress:fn,port:lr,type:this.extract(w,this.consumeToken),extension:{}};for(this.peek(w," raddr")&&(this.extract(w,this.consume," raddr"),this.consumeAttributeSpace(w),uo.relAddr=this.extract(w,this.consumeAddress)),this.peek(w," rport")&&(this.extract(w,this.consume," rport"),this.consumeAttributeSpace(w),uo.relPort=this.extract(w,this.consumePort));this.peekChar(w)===l;){this.consumeAttributeSpace(w);const Qo=this.extract(w,this.consumeToken);this.consumeAttributeSpace(w),uo.extension[Qo]=this.extractOneOrMore(w,E)}this.attributes.candidates.push(uo)}parseRemoteCandidate(w){const H=[];for(;;){const J=this.extractOneOrMore(w,p,[1,5]);this.consumeAttributeSpace(w);const Te=this.extract(w,this.consumeAddress);this.consumeAttributeSpace(w);const mt=this.extract(w,this.consumePort);H.push({componentId:J,connectionAddress:Te,port:mt});try{this.consumeAttributeSpace(w)}catch{break}}this.attributes.remoteCandidatesList.push(H)}parseEndOfCandidates(){if(this.attributes.endOfCandidates)throw new Error("must be only one line of end-of-candidates");this.attributes.endOfCandidates=!0}parseRtpmap(w){const H=this.extract(w,this.consumeToken);this.consumeAttributeSpace(w);const J=this.extract(w,this.consumeTill,"/");this.extract(w,this.consume,"/");const Te={encodingName:J,clockRate:this.extractOneOrMore(w,p)};this.atEnd(w)||this.peekChar(w)!=="/"||(this.extract(w,this.consume,"/"),Te.encodingParameters=parseInt(this.extract(w,this.consumeTill),10));const mt=this.attributes.payloads.find((fn=>fn.payloadType===parseInt(H,10)));mt?mt.rtpMap=Te:this.attributes.payloads.push({payloadType:parseInt(H,10),rtpMap:Te,rtcpFeedbacks:[]})}parsePtime(w){if(this.attributes.ptime)throw new Error("must be only one line of ptime");this.attributes.ptime=this.extract(w,this.consumeTill)}parseMaxPtime(w){if(this.attributes.maxPtime)throw new Error("must be only one line of ptime");this.attributes.maxPtime=this.extract(w,this.consumeTill)}parseDirection(w){if(this.attributes.direction)throw new Error("must be only one line of direction info");this.attributes.direction=w.attField}parseSSRC(w){const H=this.extractOneOrMore(w,p);this.consumeAttributeSpace(w);const J=this.extract(w,this.consumeTill,":");let Te;this.peekChar(w)===":"&&(this.extract(w,this.consume,":"),Te=this.extract(w,this.consumeTill));const mt=this.attributes.ssrcs.find((fn=>fn.ssrcId===parseInt(H,10)));mt?mt.attributes[J]=Te:this.attributes.ssrcs.push({ssrcId:parseInt(H,10),attributes:{[J]:Te}})}parseFmtp(w){const H=this.extract(w,this.consumeTill,l);this.consumeAttributeSpace(w);const J=this.extract(w,this.consumeTill),Te={};J.split(";").forEach((fn=>{let[lr,uo]=fn.split("=");lr=pi(lr).call(lr);const Qo=typeof uo=="string"?pi(uo).call(uo):null;typeof lr=="string"&&lr.length>0&&(Te[lr]=Qo)}));const mt=this.attributes.payloads.find((fn=>fn.payloadType===parseInt(H,10)));mt?mt.fmtp={parameters:Te}:this.attributes.payloads.push({payloadType:parseInt(H,10),rtcpFeedbacks:[],fmtp:{parameters:Te}})}parseFmtParameters(w){const H={},J=this.extract(w,this.consumeTill,"=");w._cur++;const Te=this.extract(w,this.consumeTill,";");for(H[J]=Te;w.attValue[w._cur]===";";){const mt=this.extract(w,this.consumeTill,"=");w._cur++;const fn=this.extract(w,this.consumeTill,";");H[mt]=fn}return H}parseRtcpFb(w){let H="";H=this.peekChar(w)==="*"?this.extract(w,this.consume,"*"):this.extract(w,this.consumeTill,l),this.consumeAttributeSpace(w);const J=this.extract(w,this.consumeTill,l);let Te;if(J==="trr-int")Te={type:J,interval:this.extract(w,this.consumeTill)};else{const mt={type:J};this.peekChar(w)===l&&(this.consumeAttributeSpace(w),mt.parameter=this.extract(w,this.consumeToken),this.peekChar(w)===l&&(mt.additional=this.extract(w,this.consumeTill))),Te=mt}if(H==="*")this.attributes.rtcpFeedbackWildcards.push(Te);else{const mt=this.attributes.payloads.find((fn=>fn.payloadType===parseInt(H,10)));mt?mt.rtcpFeedbacks.push(Te):this.attributes.payloads.push({payloadType:parseInt(H,10),rtcpFeedbacks:[Te]})}}parseRTCPMux(){if(this.attributes.rtcpMux)throw new Error("must be single line of rtcp-mux");this.attributes.rtcpMux=!0}parseRTCPMuxOnly(){if(this.attributes.rtcpMuxOnly)throw new Error("must be single line of rtcp-only");this.attributes.rtcpMuxOnly=!0}parseRTCPRsize(){if(this.attributes.rtcpRsize)throw new Error("must be single line of rtcp-rsize");this.attributes.rtcpRsize=!0}parseRTCP(w){if(this.attributes.rtcp)throw new Error("must be single line of rtcp");const H={port:this.extract(w,this.consumePort)};this.peekChar(w)===l&&(this.consumeAttributeSpace(w),H.netType=this.extractOneOrMore(w,v),this.consumeAttributeSpace(w),H.addressType=this.extractOneOrMore(w,v),this.consumeAttributeSpace(w),H.address=this.extract(w,this.consumeAddress)),this.attributes.rtcp=H}parseMsid(w){const H={id:this.extractOneOrMore(w,v,[1,64])};this.peekChar(w)===l&&(this.consumeAttributeSpace(w),H.appdata=this.extractOneOrMore(w,v,[1,64])),this.attributes.msids.push(H)}parseImageAttr(w){this.attributes.imageattr.push(w.attValue)}parseRid(w){const H=this.extractOneOrMore(w,(Te=>I(Te)||p(Te)||Te==="_"||Te==="-"));this.consumeAttributeSpace(w);const J={id:H,direction:this.extract(w,this.consumeToken),params:[]};if(this.peekChar(w)===l){if(this.consumeAttributeSpace(w),this.peek(w,"pt=")){this.extract(w,this.consume,"pt=");const Te=[];for(;;){const mt=this.extract(w,this.consumeToken);Te.push(mt);try{this.extract(w,this.consume,",")}catch{break}}J.payloads=Te,this.peekChar(w)===l&&this.extract(w,this.consume,l)}for(;;){const Te=this.extract(w,this.consumeToken);switch(Te){case"depend":{const mt={type:Te,rids:this.extract(w,this.consume,"=").split(",")};J.params.push(mt);break}default:{const mt={type:Te};this.peekChar(w)==="="&&(this.extract(w,this.consume,"="),mt.val=this.extract(w,this.consumeTill,";")),J.params.push(mt)}}try{this.extract(w,this.consume,";")}catch{break}}}this.attributes.rids.push(J)}parseSimulcast(w){if(this.attributes.simulcast)throw new Error("must be single line of simulcast");this.attributes.simulcast=w.attValue,this.extract(w,this.consumeTill)}parseSctpPort(w){this.attributes.sctpPort=this.extractOneOrMore(w,p,[1,5])}parseMaxMessageSize(w){this.attributes.maxMessageSize=this.extractOneOrMore(w,p,[1,void 0])}digest(){return this.digested=!0,this.attributes}parseMid(w){this.attributes.mid=this.extract(w,this.consumeToken)}parseSSRCGroup(w){const H=this.extract(w,this.consumeToken),J=[];for(;;)try{this.consumeAttributeSpace(w);const Te=this.extract(w,this.consumeInteger);J.push(parseInt(Te,10))}catch{break}this.attributes.ssrcGroups.push({semantic:H,ssrcIds:J})}}function ot(_e,w,H){return w in _e?Object.defineProperty(_e,w,{value:H,enumerable:!0,configurable:!0,writable:!0}):_e[w]=H,_e}class Xt{constructor(){ot(this,"eol",c)}print(w,H){let J="";return H&&(this.eol=H),J+=this.printVersion(w.version),J+=this.printOrigin(w.origin),J+=this.printSessionName(w.sessionName),J+=this.printInformation(w.information),J+=this.printUri(w.uri),J+=this.printEmail(w.emails),J+=this.printPhone(w.phones),J+=this.printConnection(w.connection),J+=this.printBandwidth(w.bandwidths),J+=this.printTimeFields(w.timeFields),J+=this.printKey(w.key),J+=this.printSessionAttributes(w.attributes),J+=this.printMediaDescription(w.mediaDescriptions),J}printVersion(w){return"v=".concat(w).concat(this.eol)}printOrigin(w){return"o=".concat(w.username," ").concat(w.sessId," ").concat(w.sessVersion," ").concat(w.nettype," ").concat(w.addrtype," ").concat(w.unicastAddress).concat(this.eol)}printSessionName(w){return w?"s=".concat(w).concat(this.eol):""}printInformation(w){return w?"i=".concat(w).concat(this.eol):""}printUri(w){return w?"u=".concat(w).concat(this.eol):""}printEmail(w){let H="";for(const J of w)H+="e=".concat(J).concat(this.eol);return H}printPhone(w){let H="";for(const J of w)H+="e=".concat(J).concat(this.eol);return H}printConnection(w){return w?"c=".concat(w.nettype," ").concat(w.addrtype," ").concat(w.address).concat(this.eol):""}printBandwidth(w){let H="";for(const J of w)H+="b=".concat(J.bwtype,":").concat(J.bandwidth).concat(this.eol);return H}printTimeFields(w){let H="";for(const J of w){H+="t=".concat(J.time.startTime," ").concat(J.time.startTime).concat(this.eol);for(const Te of J.repeats)H+="r=".concat(Te.repeatInterval," ").concat(Te.typedTimes.join(" ")).concat(this.eol);J.zoneAdjustments&&(H+="z=",H+="z=".concat(J.zoneAdjustments.map((Te=>"".concat(Te.time," ").concat(Te.back?"-":""," ").concat(Te.typedTime))).join(" ")).concat(this.eol),H+=this.eol)}return H}printKey(w){return w?"k=".concat(w).concat(this.eol):""}printAttributes(w){let H="";for(const J of w)H+="a=".concat(J.attField).concat(J.attValue?":".concat(J.attValue):"").concat(this.eol);return H}printMediaDescription(w){let H="";for(const J of w)H+=this.printMedia(J.media),H+=this.printInformation(J.information),H+=this.printConnections(J.connections),H+=this.printBandwidth(J.bandwidths),H+=this.printKey(J.key),H+=this.printMediaAttributes(J);return H}printConnections(w){let H="";for(const J of w)H+=this.printConnection(J);return H}printMedia(w){return"m=".concat(w.mediaType," ").concat(w.port," ").concat(w.protos.join("/")," ").concat(w.fmts.join(" ")).concat(this.eol)}printSessionAttributes(w){return new Zr(this.eol).print(w)}printMediaAttributes(w){return new fe(this.eol).print(w)}}class zt{constructor(w){ot(this,"eol",void 0),this.eol=w}printIceUfrag(w){return w===void 0?"":"a=ice-ufrag:".concat(w).concat(this.eol)}printIcePwd(w){return w===void 0?"":"a=ice-pwd:".concat(w).concat(this.eol)}printIceOptions(w){return w===void 0?"":"a=ice-options:".concat(w.join(l)).concat(this.eol)}printFingerprints(w){return w.length>0?w.map((H=>"a=fingerprint:".concat(H.hashFunction).concat(l).concat(H.fingerprint))).join(this.eol)+this.eol:""}printExtmap(w){return w.map((H=>"a=extmap:".concat(H.entry).concat(H.direction?"/".concat(H.direction):"").concat(l).concat(H.extensionName).concat(H.extensionAttributes?"".concat(l).concat(H.extensionAttributes):"").concat(this.eol))).join("")}printSetup(w){return w===void 0?"":"a=setup:".concat(w).concat(this.eol)}printUnrecognized(w){return w.map((H=>"a=".concat(H.attField).concat(H.attValue?":".concat(H.attValue):"").concat(this.eol))).join("")}}class Zr extends zt{print(w){let H="";return H+=this.printGroups(w.groups),H+=this.printMsidSemantic(w.msidSemantic),H+=this.printIceLite(w.iceLite),H+=this.printIceUfrag(w.iceUfrag),H+=this.printIcePwd(w.icePwd),H+=this.printIceOptions(w.iceOptions),H+=this.printFingerprints(w.fingerprints),H+=this.printSetup(w.setup),H+=this.printTlsId(w.tlsId),H+=this.printIdentity(w.identities),H+=this.printExtmap(w.extmaps),H+=this.printUnrecognized(w.unrecognized),H}printGroups(w){let H="";return w.length>0&&(H+=w.map((J=>"a=group:".concat(J.semantic).concat(J.identificationTag.map((Te=>"".concat(l).concat(Te))).join("")).concat(this.eol))).join("")),H}printIceLite(w){return w===void 0?"":"a=ice-lite"+this.eol}printTlsId(w){return w?"a=tls-id:".concat(w).concat(this.eol):""}printIdentity(w){return w.length===0?"":w.map((H=>"a=identity:".concat(H.assertionValue).concat(H.extensions.map((J=>"".concat(l).concat(J.name).concat(J.value?"=".concat(J.value):"")))))).join(this.eol)+this.eol}printMsidSemantic(w){if(!w)return"";let H="a=msid-semantic:".concat(w.semantic);return w.applyForAll?H+="".concat(l,"*"):w.identifierList.length>0&&(H+=w.identifierList.map((J=>"".concat(l).concat(J)))),H+this.eol}}class fe extends zt{print(w){const H=w.attributes;let J="";return J+=this.printRTCP(H.rtcp),J+=this.printIceUfrag(H.iceUfrag),J+=this.printIcePwd(H.icePwd),J+=this.printIceOptions(H.iceOptions),J+=this.printCandidates(H.candidates),J+=this.printRemoteCandidatesList(H.remoteCandidatesList),J+=this.printEndOfCandidates(H.endOfCandidates),J+=this.printFingerprints(H.fingerprints),J+=this.printSetup(H.setup),J+=this.printMid(H.mid),J+=this.printExtmap(H.extmaps),J+=this.printRTPRelated(H),J+=this.printPtime(H.ptime),J+=this.printMaxPtime(H.maxPtime),J+=this.printDirection(H.direction),J+=this.printSSRCGroups(H.ssrcGroups),J+=this.printSSRC(H.ssrcs),J+=this.printRTCPMux(H.rtcpMux),J+=this.printRTCPMuxOnly(H.rtcpMuxOnly),J+=this.printRTCPRsize(H.rtcpRsize),J+=this.printMSId(H.msids),J+=this.printImageattr(H.imageattr),J+=this.printRid(H.rids),J+=this.printSimulcast(H.simulcast),J+=this.printSCTPPort(H.sctpPort),J+=this.printMaxMessageSize(H.maxMessageSize),J+=this.printUnrecognized(H.unrecognized),J}printCandidates(w){return w.map((H=>"a=candidate:".concat(H.foundation).concat(l).concat(H.componentId).concat(l).concat(H.transport).concat(l).concat(H.priority).concat(l).concat(H.connectionAddress).concat(l).concat(H.port).concat(l,"typ").concat(l).concat(H.type).concat(H.relAddr?"".concat(l,"raddr").concat(l).concat(H.relAddr):"").concat(H.relPort?"".concat(l,"rport").concat(l).concat(H.relPort):"").concat(Object.keys(H.extension).map((J=>"".concat(l).concat(J).concat(l).concat(H.extension[J]))).join("")).concat(this.eol))).join("")}printRemoteCandidatesList(w){return w.map((H=>"a=remote-candidates:".concat(H.join(l)).concat(this.eol))).join("")}printEndOfCandidates(w){return w===void 0?"":"a=end-of-candidates"+this.eol}printRTPRelated(w){if(!w.payloads)return"";const H=w.payloads;let J="";J+=w.rtcpFeedbackWildcards.map((Te=>this.printRTCPFeedback("*",Te))).join("");for(const Te of H)J+=this.printRtpMap(Te.payloadType,Te.rtpMap),J+=this.printFmtp(Te.payloadType,Te.fmtp),J+=Te.rtcpFeedbacks.map((mt=>this.printRTCPFeedback(Te.payloadType,mt))).join("");return J}printFmtp(w,H){if(!H)return"";const J=Object.keys(H.parameters);return J.length===1&&H.parameters[J[0]]===null?"a=fmtp:".concat(w).concat(l).concat(J[0]).concat(this.eol):"a=fmtp:".concat(w).concat(l).concat(Object.keys(H.parameters).map((Te=>"".concat(Te,"=").concat(H.parameters[Te]))).join(";")).concat(this.eol)}printRtpMap(w,H){return H?"a=rtpmap:".concat(w).concat(l).concat(H.encodingName,"/").concat(H.clockRate).concat(H.encodingParameters?"/".concat(H.encodingParameters):"").concat(this.eol):""}printRTCPFeedback(w,H){let J="a=rtcp-fb:".concat(w).concat(l),Te=H;return Te.type==="trr-int"?J+="ttr-int".concat(l).concat(Te.interval):(J+="".concat(Te.type),Te.parameter&&(J+="".concat(l).concat(Te.parameter),Te.additional&&(J+="".concat(l).concat(Te.additional)))),J+this.eol}printPtime(w){return w===void 0?"":"a=ptime:".concat(w).concat(this.eol)}printMaxPtime(w){return w===void 0?"":"a=maxptime:".concat(w).concat(this.eol)}printDirection(w){return w===void 0?"":"a=".concat(w).concat(this.eol)}printSSRC(w){return w.map((H=>Object.keys(H.attributes).map((J=>"a=ssrc:".concat(H.ssrcId.toString(10)).concat(l).concat(J).concat(H.attributes[J]?":".concat(H.attributes[J]):"").concat(this.eol))).join(""))).join("")}printRTCPMux(w){return w===void 0?"":"a=rtcp-mux".concat(this.eol)}printRTCPMuxOnly(w){return w===void 0?"":"a=rtcp-mux-only".concat(this.eol)}printRTCPRsize(w){return w===void 0?"":"a=rtcp-rsize".concat(this.eol)}printRTCP(w){if(w===void 0)return"";let H="a=rtcp:".concat(w.port);return w.netType&&(H+="".concat(l).concat(w.netType)),w.addressType&&(H+="".concat(l).concat(w.addressType)),w.address&&(H+="".concat(l).concat(w.address)),H+this.eol}printMSId(w){return w.map((H=>"a=msid:".concat(H.id).concat(H.appdata?"".concat(l).concat(H.appdata):"").concat(this.eol))).join("")}printImageattr(w){return w.map((H=>"a=imageattr:".concat(H).concat(this.eol))).join("")}printRid(w){return w.map((H=>{let J="a=rid:".concat(H.id).concat(l).concat(H.direction);return H.payloads&&(J+="".concat(l,"pt=").concat(H.payloads.join(","))),H.params.length>0&&(J+="".concat(l).concat(H.params.map((Te=>Te.type==="depend"?"depend=".concat(Te.rids.join(",")):"".concat(Te.type,"=").concat(Te.val))).join(";"))),J+this.eol})).join("")}printSimulcast(w){return w===void 0?"":"a=simulcast:".concat(w).concat(this.eol)}printSCTPPort(w){return w===void 0?"":"a=sctp-port:".concat(w).concat(this.eol)}printMaxMessageSize(w){return w===void 0?"":"a=max-message-size:".concat(w).concat(this.eol)}printMid(w){return w===void 0?"":"a=mid:".concat(w).concat(this.eol)}printSSRCGroups(w){return w.map((H=>"a=ssrc-group:".concat(H.semantic).concat(H.ssrcIds.map((J=>"".concat(l).concat(J.toString(10)))).join("")).concat(this.eol))).join("")}}function we(_e){return new me().parse(_e)}function Me(_e,w){return new Xt().print(_e,w)}}},t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={exports:{}};return e[r](i,i.exports,n),i.exports}return n.d=(r,i)=>{for(var s in i)n.o(i,s)&&!n.o(r,s)&&Object.defineProperty(r,s,{enumerable:!0,get:i[s]})},n.o=(r,i)=>Object.prototype.hasOwnProperty.call(r,i),n.r=r=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(r,"__esModule",{value:!0})},n(8)})();function Zi(e){return aL.parse(e)}function Id(e,t){return aL.print(e,t)}var Xz=as("Array","keys"),Jz=$o,Qz=Tr,Zz=ee,$z=Xz,db=Array.prototype,eY={DOMTokenList:!0,NodeList:!0},tY=function(e){var t=e.keys;return e===db||Zz(db,e)&&t===db.keys||Qz(eY,Jz(e))?$z:t},$i=C(tY);function Un(e,t,n){return(t=(function(r){var i=(function(s,o){if(typeof s!="object"||!s)return s;var c=s[Symbol.toPrimitive];if(c!==void 0){var l=c.call(s,"string");if(typeof l!="object")return l;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(s)})(r);return typeof i=="symbol"?i:i+""})(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function cL(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable}))),n.push.apply(n,r)}return n}function vt(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?cL(Object(n),!0).forEach((function(r){Un(e,r,n[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):cL(Object(n)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))}))}return e}const lL=new class extends Pn{constructor(){super(...arguments),Un(this,"currentUploadLogID",0)}reportLogUploadError(e){const{errorRange:t}=e;t[t.length-1]&&t[t.length-1]>this.currentUploadLogID&&(this.currentUploadLogID=t[t.length-1],this.emit("REPORT_LOG_UPLOAD",e))}};class nY{constructor(t){Un(this,"logger",void 0),Un(this,"prefixLists",[]),this.logger=t}debug(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];this.logger.debug(...this.prefixLists,...n)}info(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];this.logger.info(...this.prefixLists,...n)}warning(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];this.logger.warning(...this.prefixLists,...n)}error(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];this.logger.error(...this.prefixLists,...n)}prefix(t){return this.prefixLists.push(t),this}popPrefix(){return this.prefixLists.pop(),this}}function ub(){const e=new Date;return e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}function dL(){const e=new Date,t=/((\d+:){2}\d+)/.exec(new Date().toUTCString());return t?t?.[0]+":"+e.getUTCMilliseconds():e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}const no={DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4},xS=Date.now(),GE=e=>{for(const t in no)if(Object.prototype.hasOwnProperty.call(no,t)&&no[t]===e)return t;return"DEFAULT"},R=new class{constructor(){Un(this,"proxyServerURL",void 0),Un(this,"logLevel",no.DEBUG),Un(this,"uploadState","collecting"),Un(this,"uploadLogWaitingList",[]),Un(this,"uploadLogUploadingList",[]),Un(this,"uploadErrorCount",0),Un(this,"currentLogID",0),Un(this,"url",void 0),Un(this,"extLog",((e,t)=>{this.appendLogToWaitingList(e,...t)}))}debug(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const r=[no.DEBUG].concat(t);this.log.apply(this,r)}info(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const r=[no.INFO].concat(t);this.log.apply(this,r)}warning(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const r=[no.WARNING].concat(t);this.log.apply(this,r)}warn(){this.warning(...arguments)}error(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const r=[no.ERROR].concat(t);this.log.apply(this,r)}upload(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const r=[no.DEBUG].concat(t);this.uploadLog.apply(this,r)}setLogLevel(e){e=Math.min(Math.max(0,e),4),this.logLevel=e}enableLogUpload(){nn("UPLOAD_LOG",!0)}disableLogUpload(){nn("UPLOAD_LOG",!1),this.uploadLogUploadingList=[],this.uploadLogWaitingList=[]}setProxyServer(e){this.proxyServerURL=e}prefix(e){return new nY(this).prefix(e)}log(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if(Date.now()-xS<100)return void setTimeout((()=>{this.log(...t)}),Date.now()-xS);const r=Math.max(0,Math.min(4,t[0]));if(t[0]=ub()+" Agora-SDK [".concat(GE(r),"]:"),this.appendLogToWaitingList(r,...t),r<this.logLevel)return;const i=ub()+" %cAgora-SDK [".concat(GE(r),"]:");let s=[];if(!F("USE_NEW_LOG"))switch(r){case no.DEBUG:s=[i,"color: #64B5F6;"].concat(t.slice(1)),console.log.apply(console,s);break;case no.INFO:s=[i,"color: #1E88E5; font-weight: bold;"].concat(t.slice(1)),console.log.apply(console,s);break;case no.WARNING:s=[i,"color: #FB8C00; font-weight: bold;"].concat(t.slice(1)),console.warn.apply(console,s);break;case no.ERROR:s=[i,"color: #B00020; font-weight: bold;"].concat(t.slice(1)),console.error.apply(console,s)}}uploadLog(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if(Date.now()-xS<100)return void setTimeout((()=>{this.uploadLog(...t)}),Date.now()-xS);const r=Math.max(0,Math.min(4,t[0]));t[0]=ub()+" Agora-SDK [".concat(GE(r),"]:"),this.appendLogToWaitingList(r,...t)}appendLogToWaitingList(e){if(!F("UPLOAD_LOG"))return;for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];Array.isArray(n[0])?n[0][0]=dL()+" Agora-SDK [".concat(GE(e),"]:"):n[0]=dL()+" Agora-SDK [".concat(GE(e),"]:");let i="";n.forEach((s=>{typeof s=="object"&&(s=JSON.stringify(s)),i+="".concat(s," ")})),this.uploadLogWaitingList.push({payload_str:i,log_level:e,log_item_id:this.currentLogID++}),this.uploadState==="uploading"&&this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}startUpload(){this.uploadState="uploading",this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}async uploadLogs(){const e=this.uploadLogUploadingList,t={sdk_version:to,process_id:F("PROCESS_ID"),payload:JSON.stringify(e)};return Ta((async()=>{const n=await Mi.post(this.url||(this.proxyServerURL?"https://".concat(this.proxyServerURL,"/ls/?h=").concat(F("LOG_UPLOAD_SERVER"),"&p=443&d=upload/v1"):"https://".concat(F("LOG_UPLOAD_SERVER"),"/upload/v1")),t,{responseType:"text"});if(n.data!=="OK"){const r=new Error("unexpected upload log response");throw r.response=n,r}}),(()=>(this.uploadLogUploadingList=[],!1)),(n=>{const r={status:-1,message:n.message,errorRange:e.map((i=>i.log_item_id))};return n.response?(r.status=n.response.status,r.data=n.response.data,r.headers=n.response.headers):n.request&&(r.status=n.request.status),lL.reportLogUploadError(r),!0}),{timeout:F("UPLOAD_LOG_REQUEST_RETRY_INTERVAL"),maxRetryTimeout:F("UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL")})}uploadLogInterval(){this.uploadLogUploadingList.length===0&&this.uploadLogWaitingList.length===0||(this.uploadLogUploadingList.length===0&&(this.uploadLogUploadingList=this.uploadLogWaitingList.splice(0,F("UPLOAD_LOG_LENGTH_EACH_TIME"))),this.uploadLogs().then((()=>{this.uploadErrorCount=0,this.uploadLogWaitingList.length>0&&window.setTimeout((()=>this.uploadLogInterval()),F("UPLOAD_LOG_INTERVAL"))})).catch((e=>{this.uploadErrorCount+=1,this.uploadErrorCount<2?window.setTimeout((()=>this.uploadLogInterval()),F("UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1")):window.setTimeout((()=>this.uploadLogInterval()),F("UPLOAD_LOG_RETRY_INTERVAL_V1"))})))}};var uL;function rY(e){return Pr(e.reportId,"params.reportId",0,100,!1),Pr(e.category,"params.category",0,100,!1),Pr(e.event,"params.event",0,100,!1),Pr(e.label,"params.label",0,100,!1),on(e.value,"params.value",Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,!1),!0}(uL={}).FREE="free",uL.UPLOADING="uploading",(function(e){e[e.MISC=0]="MISC",e[e.INTERNAL_EVENT=1]="INTERNAL_EVENT",e[e.PUBLIC_EVENT=2]="PUBLIC_EVENT",e[e.WEB_EVENT=3]="WEB_EVENT",e[e.INTERNAL_API=4]="INTERNAL_API",e[e.WEB_API=5]="WEB_API",e[e.PUBLIC_API=6]="PUBLIC_API"})({});const iY={sid:"",lts:0,success:null,cname:null,uid:null,peer:null,cid:null,elapse:null,extend:null,vid:0};let pr=(function(e){return e.PUBLISH="publish",e.SUBSCRIBE="subscribe",e.WS_COMPRESSOR_INIT="ws_compressor_init",e.SESSION_INIT="session_init",e.JOIN_CHOOSE_SERVER="join_choose_server",e.REQ_USER_ACCOUNT="req_user_account",e.JOIN_GATEWAY="join_gateway",e.REJOIN_GATEWAY="rejoin_gateway",e.STREAM_SWITCH="stream_switch",e.REQUEST_PROXY_WORKER_MANAGER="request_proxy_worker_manager",e.REQUEST_PROXY_APPCENTER="request_proxy_appcenter",e.FIRST_VIDEO_RECEIVED="first_video_received",e.FIRST_AUDIO_RECEIVED="first_audio_received",e.FIRST_VIDEO_DECODE="first_video_decode",e.FIRST_AUDIO_DECODE="first_audio_decode",e.XLA_PEER_FIRST_VIDEO_FRAME="xla_peer_first_video_frame",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_UPDATE_STREAM="on_update_stream",e.ON_REMOVE_STREAM="on_remove_stream",e.USER_ANALYTICS="req_user_analytics",e.PC_STATS="pc_stats",e.UPDATE_REMOTE_RTPCAPABILITIES="update_remote_rtpCapabilities",e.AB_TEST="ab_test",e})({}),bn=(function(e){return e.SESSION="io.agora.pb.Wrtc.Session",e.JOIN_CHOOSE_SERVER="io.agora.pb.Wrtc.JoinChooseServer",e.REQ_USER_ACCOUNT="io.agora.pb.Wrtc.ReqUserAccount",e.JOIN_GATEWAY="io.agora.pb.Wrtc.JoinGateway",e.RE_JOIN_GATEWAY="io.agora.pb.Wrtc.ReJoinGateway",e.PUBLISH="io.agora.pb.Wrtc.Publish",e.SUBSCRIBE="io.agora.pb.Wrtc.Subscribe",e.WS_COMPRESSOR_INIT="io.agora.pb.Wrtc.WsCompressorInit",e.STREAM_SWITCH="io.agora.pb.Wrtc.StreamSwitch",e.AUDIO_SENDING_STOPPED="io.agora.pb.Wrtc.AudioSendingStopped",e.VIDEO_SENDING_STOPPED="io.agora.pb.Wrtc.VideoSendingStopped",e.REQUEST_PROXY_APPCENTER="io.agora.pb.Wrtc.RequestProxyAppCenter",e.REQUEST_PROXY_WORKER_MANAGER="io.agora.pb.Wrtc.RequestProxyWorkerManager",e.API_INVOKE="io.agora.pb.Wrtc.ApiInvoke",e.FIRST_VIDEO_RECEIVED="io.agora.pb.Wrtc.FirstVideoReceived",e.FIRST_AUDIO_RECEIVED="io.agora.pb.Wrtc.FirstAudioReceived",e.FIRST_VIDEO_DECODE="io.agora.pb.Wrtc.FirstVideoDecode",e.FIRST_AUDIO_DECODE="io.agora.pb.Wrtc.FirstAudioDecode",e.XLA_PEER_FIRST_VIDEO_FRAME="io.agora.pb.Wrtc.XLAPeerFirstVideoFrame",e.ON_ADD_AUDIO_STREAM="io.agora.pb.Wrtc.OnAddAudioStream",e.ON_ADD_VIDEO_STREAM="io.agora.pb.Wrtc.OnAddVideoStream",e.ON_UPDATE_STREAM="io.agora.pb.Wrtc.OnUpdateStream",e.ON_REMOVE_STREAM="io.agora.pb.Wrtc.OnRemoveStream",e.JOIN_CHANNEL_TIMEOUT="io.agora.pb.Wrtc.JoinChannelTimeout",e.PEER_PUBLISH_STATUS="io.agora.pb.Wrtc.PeerPublishStatus",e.WORKER_EVENT="io.agora.pb.Wrtc.WorkerEvent",e.AP_WORKER_EVENT="io.agora.pb.Wrtc.APWorkerEvent",e.JOIN_WEB_PROXY_AP="io.agora.pb.Wrtc.JoinWebProxyAP",e.WEBSOCKET_QUIT="io.agora.pb.Wrtc.WebSocketQuit",e.USER_ANALYTICS="io.agora.pb.Wrtc.UserAnalytics",e.AUTOPLAY_FAILED="io.agora.pb.Wrtc.AutoplayFailed",e.PC_STATS="io.agora.pb.Wrtc.PCStats",e.UPDATE_REMOTE_RTPCAPABILITIES="io.agora.pb.Wrtc.UpdateRemoteRTPCapabilities",e.AB_TEST="io.agora.pb.Wrtc.ABTest",e})({});(function(e){e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT"})({});let sY=(function(e){return e[e.SESSION=26]="SESSION",e[e.JOIN_CHOOSE_SERVER=27]="JOIN_CHOOSE_SERVER",e[e.REQ_USER_ACCOUNT=196]="REQ_USER_ACCOUNT",e[e.JOIN_GATEWAY=28]="JOIN_GATEWAY",e[e.PUBLISH=30]="PUBLISH",e[e.SUBSCRIBE=29]="SUBSCRIBE",e[e.WS_COMPRESSOR_INIT=9430]="WS_COMPRESSOR_INIT",e[e.STREAM_SWITCH=32]="STREAM_SWITCH",e[e.AUDIO_SENDING_STOPPED=33]="AUDIO_SENDING_STOPPED",e[e.VIDEO_SENDING_STOPPED=34]="VIDEO_SENDING_STOPPED",e[e.REQUEST_PROXY_APPCENTER=35]="REQUEST_PROXY_APPCENTER",e[e.REQUEST_PROXY_WORKER_MANAGER=36]="REQUEST_PROXY_WORKER_MANAGER",e[e.API_INVOKE=41]="API_INVOKE",e[e.FIRST_VIDEO_RECEIVED=348]="FIRST_VIDEO_RECEIVED",e[e.FIRST_AUDIO_RECEIVED=349]="FIRST_AUDIO_RECEIVED",e[e.FIRST_VIDEO_DECODE=350]="FIRST_VIDEO_DECODE",e[e.FIRST_AUDIO_DECODE=351]="FIRST_AUDIO_DECODE",e[e.ON_ADD_AUDIO_STREAM=352]="ON_ADD_AUDIO_STREAM",e[e.ON_ADD_VIDEO_STREAM=353]="ON_ADD_VIDEO_STREAM",e[e.ON_UPDATE_STREAM=356]="ON_UPDATE_STREAM",e[e.ON_REMOVE_STREAM=355]="ON_REMOVE_STREAM",e[e.JOIN_CHANNEL_TIMEOUT=407]="JOIN_CHANNEL_TIMEOUT",e[e.PEER_PUBLISH_STATUS=408]="PEER_PUBLISH_STATUS",e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT",e[e.JOIN_WEB_PROXY_AP=700]="JOIN_WEB_PROXY_AP",e[e.WEBSOCKET_QUIT=671]="WEBSOCKET_QUIT",e[e.USER_ANALYTICS=1e4]="USER_ANALYTICS",e[e.AUTOPLAY_FAILED=9178]="AUTOPLAY_FAILED",e})({});function et(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return function(t,n,r){const i=r.value;if(typeof i=="function"){const s=e.className||t.__className__||(t.constructor.name==="AgoraRTCClient"?"Client":t.constructor.name);r.value=function(){for(var o,c=arguments.length,l=new Array(c),h=0;h<c;h++)l[h]=arguments[h];let p=l;if(e.argsMap)try{p=e.argsMap(this,...l)}catch(g){R.warning(g),p=[]}try{JSON.stringify(p)}catch{R.warning("arguments for method ".concat(s,".").concat(String(n)," not serializable for apiInvoke.")),p=[]}const E=(e.report||We).reportApiInvoke(this._sessionId||null,{id:this._clientId||((o=this.store)===null||o===void 0?void 0:o.clientId)||this._ID,name:"".concat(s,".").concat(String(n)),options:p,tag:In.TRACER,reportResult:e.reportResult},e.throttleTime);try{const g=i.apply(this,l);return g instanceof Pe?g.then((v=>(E.onSuccess(e.reportResult&&v),v))).catch((v=>{throw E.onError(v),v})):(E.onSuccess(e.reportResult&&g),g)}catch(g){throw E.onError(g),g}}}return r}}const We=new class{constructor(){Un(this,"baseInfoMap",new Map),Un(this,"proxyServer",void 0),Un(this,"eventUploadTimer",void 0),Un(this,"setSessionIdTimer",void 0),Un(this,"url",void 0),Un(this,"sids",new Set),Un(this,"backupUrl",void 0),Un(this,"_appId",void 0),Un(this,"_aid",0),Un(this,"keyEventUploadPendingItems",[]),Un(this,"normalEventUploadPendingItems",[]),Un(this,"apiInvokeUploadPendingItems",[]),Un(this,"apiInvokeCount",0),Un(this,"apiInvokeLoggedCount",0),Un(this,"ltsList",[]),Un(this,"lastSendNormalEventTime",Date.now()),Un(this,"customReportCounterTimer",void 0),Un(this,"customReportCount",0),Un(this,"extApiInvoke",(async e=>{for(const t of e){const n=vt(vt({},t),{},{sid:null,invokeId:++this.apiInvokeCount,tag:In.TRACER});this.sendApiInvoke(n)}})),this.eventUploadTimer=window.setInterval(this.doSend.bind(this),F("EVENT_REPORT_SEND_INTERVAL")),this.setSessionIdTimer=window.setInterval(this.appendSessionId.bind(this),F("EVENT_REPORT_SEND_INTERVAL"))}getBaseInfoBySessionId(e){return this.baseInfoMap.get(e)}setAppId(e){this._appId=e,this._aid=parseInt(e.replace(/[a-fA-F0-9]{8}/g,(t=>{let[n,r]=t;return n+r})),16)||0}reportApiInvoke(e,t,n){t.timeout=t.timeout||6e4,t.reportResult=t.reportResult===void 0||t.reportResult;const r=Date.now();this.apiInvokeCount+=1;const i=this.apiInvokeCount,s=!!F("SHOW_REPORT_INVOKER_LOG"),o=!!F("SHOW_REPORT_USER_INVOKER_LOG"),c=s||o&&t.id;c&&(this.apiInvokeLoggedCount+=1);const l=this.apiInvokeLoggedCount;function h(v,O){if(c){let I="[apiInvoke-".concat(l,"]");if(t.id&&(I+="[".concat(t.id,"]")),t.name&&(I+="[".concat(t.name,"]"),t.name===Bn.JOIN))return R.info("".concat(I," ").concat(v));R.info("".concat(I," ").concat(v),v==="start"?t.options:O||"")}}const p=()=>({tag:t.tag,invokeId:i,sid:e,name:t.name,apiInvokeTime:r,options:t.options,states:t.states||null});h("start");let E=!1;Dr(t.timeout).then((()=>{E||(this.sendApiInvoke(vt(vt({},p()),{},{error:U.API_INVOKE_TIMEOUT,success:!1})),h("timeout"))}));const g=new ce(U.UNEXPECTED_ERROR,"".concat(t.name,": this api invoke is end"));return{onSuccess:v=>{const O=()=>{if(E)throw g;return E=!0,this.sendApiInvoke(vt(vt({},p()),{},{success:!0},t.reportResult&&{result:v})),h("onSuccess"),v};return n?H1(O,t.name+"Success",n,(()=>E=!0)):O()},onError:v=>{const O=()=>{if(E)throw v;E=!0,this.sendApiInvoke(vt(vt({},p()),{},{success:!1,error:v})),h("onFailure",v.toString())};return n?H1(O,t.name+"Error",n,(()=>E=!0)):O()}}}sessionInit(e,t){if(this.baseInfoMap.has(e))return;const n=Date.now(),r=this.createBaseInfo(e,n);r.cname=t.cname;const i=Object.assign({},{willUploadConsoleLog:F("UPLOAD_LOG"),maxTouchPoints:navigator.maxTouchPoints,areaVersion:ob?"global":"oversea",areas:F("AREAS")&&F("AREAS").join(",")},t.extend),{stringUid:s,channelProfile:o,channelMode:c,isABTestSuccess:l,lsid:h,clientRole:p}=t,E=Date.now(),g=vt(vt({},r),{},{eventType:pr.SESSION_INIT,appid:t.appid,browser:navigator.userAgent,buildFormat:t.buildFormat,build:cb,lts:E,elapse:E-n,extend:JSON.stringify(i),mode:t.mode,process:F("PROCESS_ID"),appType:F("APP_TYPE"),success:!0,version:to,stringUid:s,channelProfile:o,channelMode:c,isABTestSuccess:l,lsid:h,clientType:Re(v=window.navigator.userAgent).call(v,"AgoraWebView")?42:20,clientRole:p,serviceId:F("PROCESS_ID"),extensionID:F("PLUGIN_INFO").join(",")||""});var v;this.send({type:bn.SESSION,data:g},!0)}joinChooseServer(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),s=vt(vt({},r),{},{role:t.role,eventType:pr.JOIN_CHOOSE_SERVER,lts:i,eventElapse:t.elapse||i-t.lts,chooseServerAddr:t.csAddr,errorCode:t.ec,elapse:i-n.startTime,success:t.succ,chooseServerAddrList:JSON.stringify(t.serverList),uid:t.uid?parseInt(t.uid):null,cid:t.cid?parseInt(t.cid):null,chooseServerIp:t.csIp||"",opid:t.opid,unilbsServerIds:t.unilbsServerIds,extend:t.extend||void 0,isHttp3:t.isHttp3,corssRegionTagReq:t.corssRegionTagReq||void 0,corssRegionTagRes:t.corssRegionTagRes||void 0,resourceTimingInfo:t.resourceTimingInfo||void 0});this.send({type:bn.JOIN_CHOOSE_SERVER,data:s},!0)}reqUserAccount(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),s=vt(vt({},r),{},{eventType:pr.REQ_USER_ACCOUNT,lts:i,success:t.success,serverAddress:t.serverAddr,stringUid:t.stringUid,uid:t.uid,errorCode:t.errorCode,elapse:t.elapse||i-n.startTime,eventElapse:i-t.lts,extend:JSON.stringify(t.extend)});this.send({type:bn.REQ_USER_ACCOUNT,data:s},!0)}joinGateway(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info;t.vid&&(r.vid=t.vid),r.uid=t.uid,r.cid=t.cid;const i=Date.now(),{firstSuccess:s,addr:o,isProxy:c}=t,l=i-n.startTime,h=vt(vt({},r),{},{eventType:pr.JOIN_GATEWAY,lts:i,gatewayAddr:t.addr,success:t.succ,errorCode:t.ec,errorMsg:t.errorMsg||"",elapse:l,eventElapse:i-t.lts,firstSuccess:s,signalChannel:t.signalChannel,preload:t.preload?1:0,installId:sb(),isABTestSuccess:t.isABTestSuccess?1:0}),p=h.success?1:0;if(t.succ&&(n.lastJoinSuccessTime=i),s)this.send({type:bn.JOIN_GATEWAY,data:h},!0);else{let E;if(o)if(c){const v=o.match(/h=(\d{1,3}-){3}\d{1,3}/g),O=o.match(/p=[0-9]{1,6}/g);E={isSuccess:p,gatewayIp:v&&v.length?v[0].split("=")[1].replace(/-/g,"."):"",port:O&&O.length?O[0].split("=")[1]:"",isProxy:c?1:0}}else{const v=o.match(/wss:\/\/(\d{1,3}-){3}\d{1,3}/g),O=o.match(/(:|p=)[0-9]{1,6}/g);E={isSuccess:p,gatewayIp:v&&v.length?v[0].split("//")[1].replace(/-/g,"."):"",port:O&&O.length?O[0].split(/:|p=/g)[1]:"",isProxy:c?1:0}}else E={isSuccess:p,gatewayIp:"",port:"",isProxy:c?1:0};delete h.success,delete h.eventType,delete h.firstSuccess,h.vid=Number(h.vid);const g=Object.assign({},h,E,{eventType:pr.REJOIN_GATEWAY});this.send({type:bn.RE_JOIN_GATEWAY,data:g},!0)}}joinChannelTimeout(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=Date.now(),i=vt(vt({},n.info),{},{lts:r,timeout:t,elapse:r-n.startTime});this.send({type:bn.JOIN_CHANNEL_TIMEOUT,data:i},!0)}publish(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),s=vt(vt({},r),{},{eventType:pr.PUBLISH,lts:i,eventElapse:t.eventElapse,elapse:i-n.startTime,success:t.succ,errorCode:t.ec,videoName:t.videoName,audioName:t.audioName,screenName:t.screenName,screenshare:t.screenshare,audio:t.audio,video:t.video,p2pid:t.p2pid,publishRequestid:t.publishRequestid});this.send({type:bn.PUBLISH,data:s},!0)}subscribe(e,t,n){const r=this.baseInfoMap.get(e);if(!r)return;const i=r.info,s=Date.now(),o=vt(vt({},i),{},{eventType:pr.SUBSCRIBE,lts:s,eventElapse:t.eventElapse,elapse:s-r.startTime,success:t.succ,errorCode:t.ec,video:t.video,audio:t.audio,subscribeRequestid:t.subscribeRequestid,p2pid:t.p2pid,preSsrc:t.preSsrc?1:0},n&&{extend:JSON.stringify({isMassSubscribe:!0})});typeof t.peerid=="string"?o.peerSuid=t.peerid:o.peer=t.peerid,this.send({type:bn.SUBSCRIBE,data:o},!0)}wsCompressorInit(e){var t;const n=[...$i(t=this.baseInfoMap).call(t)],r=n.length?n[0]:"UnableToGetSid",i=this.baseInfoMap.get(r);if(!i)return;const s=i.info,o=Date.now(),c=vt(vt({},s),{},{eventType:pr.WS_COMPRESSOR_INIT,lts:o,eventElapse:e.eventElapse,elapse:o-i.startTime,status:e.status?1:2});this.send({type:bn.WS_COMPRESSOR_INIT,data:c},!0)}firstXLAPeerFirstVideoFrame(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),s=t.peerPubStatusMs-(n.lastJoinSuccessTime||i),o=vt(vt({},r),{},{elapse:i-n.startTime,eventType:pr.XLA_PEER_FIRST_VIDEO_FRAME,lts:i,peer:t.peer,width:t.width,height:t.height,ssrc:t.ssrc,p2pid:t.p2pid,peerPublishDuration:t.peerPublishDuration,joinChannelSuccessElapse:s,peerPubStatusMs:t.peerPubStatusMs-t.joinChannelStart,availablePublish:t.peerPublishDuration>s?1:0,preloadStart:Math.max(t.preloadStart-t.joinChannelStart,0),preloadEnd:Math.max(t.preloadEnd-t.joinChannelStart,0),encrypt:Math.max(t.apStart-t.joinChannelStart,0),ap:Math.max(t.apEnd-t.joinChannelStart,0),sua:Math.max(t.suaEnd-t.joinChannelStart,0),beforeConnect:Math.max(t.beforeConnect-t.joinChannelStart,0),peerRecevier:Math.max(t.peerReceiver-t.joinChannelStart,0),ice:Math.max(t.ice-t.joinChannelStart,0),pc:Math.max(t.pc-t.joinChannelStart,0),signalConnected:Math.max(t.signalConnected-t.joinChannelStart,0),joinReq:Math.max(t.joinReq-t.joinChannelStart,0),joinRes:Math.max(t.joinRes-t.joinChannelStart,0),userJoinNotify:Math.max(t.userJoinNotify-t.joinChannelStart,0),videoSsrcNotify:Math.max(t.videoAddNotify-t.joinChannelStart,0),subscribeDelayMs:Math.max(t.subscribeStart-t.videoAddNotify,0),subscribeStart:Math.max(t.subscribeStart-t.joinChannelStart,0),subscribeEnd:Math.max(t.subscribeEnd-t.joinChannelStart,0),firstReceived:Math.max(t.firstReceived-t.joinChannelStart,0),firstDecoded:Math.max(t.firstDecoded-t.joinChannelStart,0),firstPreRender:Math.max(t.firstPreRender-t.joinChannelStart,0),firstRender:Math.max(t.firstRender-t.joinChannelStart,0),playDelayMs:Math.max(t.playStart-t.subscribeEnd,0),playStart:Math.max(t.playStart-t.joinChannelStart,0),playEnd:Math.max(t.playEnd-t.joinChannelStart,0),isPreSub:t.isPreSub?1:0,isPrePc:t.isPrePc?1:0,isPreInstantVideo:t.isPreInstantVideo?1:0});this.send({type:bn.XLA_PEER_FIRST_VIDEO_FRAME,data:o},!0)}firstRemoteVideoDecode(e,t,n,r){const i=this.baseInfoMap.get(e);if(!i)return;const s=i.info,o=Date.now(),c=vt(vt(vt({},s),r),{},{elapse:o-i.startTime,eventType:t,lts:o,firstDecodeFrame:Math.max((r.firstFrame||o)-i.startTime,0),apEnd:Math.max(r.apEnd-i.startTime,0),apStart:Math.max(r.apStart-i.startTime,0),joinGwEnd:Math.max(r.joinGwEnd-i.startTime,0),joinGwStart:Math.max(r.joinGwStart-i.startTime,0),pcEnd:Math.max(r.pcEnd-i.startTime,0),pcStart:Math.max(r.pcStart-i.startTime,0),subscriberEnd:Math.max(r.subscriberEnd-i.startTime,0),subscriberStart:Math.max(r.subscriberStart-i.startTime,0),videoAddNotify:Math.max(r.videoAddNotify-i.startTime,0)});this.send({type:n,data:c},!0)}firstRemoteFrame(e,t,n,r){const i=this.baseInfoMap.get(e);if(!i)return;const s=i.info,o=Date.now(),c=vt(vt(vt({},s),r),{},{elapse:o-i.startTime,eventType:t,lts:o});this.send({type:n,data:c},!0)}abTest(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),s=vt(vt(vt({},r),t),{},{vid:r.vid===void 0?0:Number(r.vid),elapse:i-n.startTime,eventType:pr.AB_TEST,lts:i});this.send({type:bn.AB_TEST,data:s},!0)}pcStats(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),s=vt(vt(vt({},r),t),{},{vid:r.vid===void 0?0:Number(r.vid),elapse:i-n.startTime,eventType:pr.PC_STATS,lts:i,preallocation:t.preallocation?1:0});this.send({type:bn.PC_STATS,data:s},!0)}updateRemoteRTPCapabilities(e,t){if(e){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),s=vt(vt(vt({},r),t),{},{vid:r.vid===void 0?0:Number(r.vid),eventType:pr.UPDATE_REMOTE_RTPCAPABILITIES,lts:i});this.send({type:bn.UPDATE_REMOTE_RTPCAPABILITIES,data:s},!0)}}onGatewayStream(e,t,n,r){const i=this.baseInfoMap.get(e);if(!i)return;const s=i.info,o=Date.now(),c=vt(vt(vt({},s),r),{},{eventType:t,lts:o});this.send({type:n,data:c},!0)}streamSwitch(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),s=vt(vt({},r),{},{eventType:pr.STREAM_SWITCH,lts:i,isDual:t.isdual,elapse:i-n.startTime,success:t.succ});this.send({type:bn.STREAM_SWITCH,data:s},!0)}requestProxyAppCenter(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),s=vt(vt({},r),{},{eventType:pr.REQUEST_PROXY_APPCENTER,lts:i,eventElapse:i-t.lts,elapse:i-n.startTime,APAddr:t.APAddr,workerManagerList:t.workerManagerList,response:t.response,errorCode:t.ec,success:t.succ});this.send({type:bn.REQUEST_PROXY_APPCENTER,data:s},!0)}requestProxyWorkerManager(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),s=vt(vt({},r),{},{eventType:pr.REQUEST_PROXY_WORKER_MANAGER,lts:i,eventElapse:i-t.lts,elapse:i-n.startTime,workerManagerAddr:t.workerManagerAddr,response:t.response,errorCode:t.ec,success:t.succ});this.send({type:bn.REQUEST_PROXY_WORKER_MANAGER,data:s},!0)}setProxyServer(e){this.proxyServer=e,e?R.debug("reportProxyServerurl: ".concat(e)):R.debug("disable reportProxyServerurl: ".concat(e))}peerPublishStatus(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),s=vt(vt({},r),{},{subscribeElapse:t.subscribeElapse,peer:t.peer,peerPublishDuration:Math.max(t.audioPublishDuration,t.videoPublishDuration),audiotag:t.audioPublishDuration>0?1:-1,videotag:t.videoPublishDuration>0?1:-1,lts:i,elapse:i-n.startTime,joinChannelSuccessElapse:i-(n.lastJoinSuccessTime||i),peerPublishDurationVideo:t.videoPublishDuration,peerPublishDurationAudio:t.audioPublishDuration});this.send({type:bn.PEER_PUBLISH_STATUS,data:s},!0)}workerEvent(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now();(function(s,o,c){const l=s[o];if(!l||typeof l!="string")return[s];s[o]="";const h=Sc(JSON.stringify(s));let p=0;const E=[];let g=0;for(let v=0;v<l.length;v++)g+=l.charCodeAt(v)<=127?1:3,g<=c-h||(E[E.length]=ye(ye({},s),{},{[o]:l.substring(p,v)}),p=v,g=l.charCodeAt(v)<=127?1:3);return p!==l.length-1&&(E[E.length]=ye(ye({},s),{},{[o]:l.substring(p)})),E})(vt(vt(vt({},r),t),{},{elapse:i-n.startTime,lts:i,productType:"WebRTC"}),"payload",1300).forEach((s=>this.send({type:bn.WORKER_EVENT,data:s},!0)))}apworkerEvent(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),s=vt(vt(vt({},r),t),{},{elapse:i-n.startTime,lts:i});this.send({type:bn.AP_WORKER_EVENT,data:s},!0)}joinWebProxyAP(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),s=vt(vt(vt({},r),t),{},{elapse:i-n.startTime,lts:i,extend:t.extend||void 0});this.send({type:bn.JOIN_WEB_PROXY_AP,data:s},!0)}WebSocketQuit(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),s=vt(vt(vt({},r),t),{},{elapse:i-n.startTime,lts:i});this.send({type:bn.WEBSOCKET_QUIT,data:s},!0)}async sendCustomReportMessage(e,t){if(this.customReportCount+=t.length,this.customReportCount>F("CUSTOM_REPORT_LIMIT"))throw new ce(U.CUSTOM_REPORT_FREQUENCY_TOO_HIGH);this.customReportCounterTimer||(this.customReportCounterTimer=window.setInterval((()=>{this.customReportCount=0}),5e3));const n=Date.now(),r=t.map((i=>({type:bn.USER_ANALYTICS,data:vt(vt({sid:e},i),{},{lts:n})})));try{F("NEW_REPORT_SERVER")?await this.postDataToStatsCollector2(r):await this.postDataToStatsCollector(r)}catch(i){throw R.error("send custom report message failed",i.toString()),new ce(U.CUSTOM_REPORT_SEND_FAILED,i.message)}}sendApiInvoke(e){const t=F("NOT_REPORT_EVENT");if(e.tag&&Re(t)&&Re(t).call(t,e.tag))return!1;if(e.sid===null)return this.apiInvokeUploadPendingItems.push(e),!1;const n=this.baseInfoMap.get(e.sid);if(!n)return this.apiInvokeUploadPendingItems.push(e),!1;const{cname:r,uid:i,cid:s}=n.info;let o;if(e.lts=e.lts||Date.now(),e.error)if(e.error instanceof ce){const{code:l,message:h}=e.error;o=l||h||e.error.toString()}else o=e.error.toString();const c={invokeId:e.invokeId,sid:e.sid,cname:r,cid:s,uid:i,lts:e.lts,success:e.success,elapse:e.lts-n.startTime,execElapse:e.lts-e.apiInvokeTime,apiName:e.name,options:e.options?JSON.stringify(e.options):void 0,execStates:e.states?JSON.stringify(e.states):void 0,execResult:e.result?JSON.stringify(e.result):void 0,errorCode:e.error?o:void 0,errorMsg:e.error?JSON.stringify(e.error):void 0};return this.send({type:bn.API_INVOKE,data:c},!1),!0}addSid(e){this.sids.add(e)}removeSid(e){this.sids.delete(e)}appendSessionId(){const e=this.apiInvokeUploadPendingItems;if(e.length===0)return;const t=Array.from(this.sids).find((n=>n!==null));t&&e.forEach((n=>{n&&(n.sid=t,this.sendApiInvoke(Object.assign({},n)))})),e.length=0}send(e,t){if(t)return this.keyEventUploadPendingItems.push(e),void this.sendItems(this.keyEventUploadPendingItems,!0);this.normalEventUploadPendingItems.push(e),this.normalEventUploadPendingItems.length>F("NORMAL_EVENT_QUEUE_CAPACITY")&&this.normalEventUploadPendingItems.splice(0,1),this.normalEventUploadPendingItems.length>=10&&this.sendItems(this.normalEventUploadPendingItems,!1)}doSend(){this.keyEventUploadPendingItems.length>0&&this.sendItems(this.keyEventUploadPendingItems,!0),this.normalEventUploadPendingItems.length>0&&Date.now()-this.lastSendNormalEventTime>=5e3&&this.sendItems(this.normalEventUploadPendingItems,!1)}sendItems(e,t){const n=[],r=[];for(;e.length;){const s=e.shift();n.length<20?n.push(s):r.push(s)}e.push(...r);for(const s of[...n]){var i;this.ltsList.indexOf(s.data.lts)!==-1?(s.data.lts=this.ltsList[this.ltsList.length-1]+1,this.ltsList.push(s.data.lts)):(this.ltsList.push(s.data.lts),sh(i=this.ltsList).call(i,((o,c)=>o-c)))}return t||(this.lastSendNormalEventTime=Date.now()),F("ENABLE_EVENT_REPORT")&&n.length&&(F("NEW_REPORT_SERVER")?this.postDataToStatsCollector2(n):this.postDataToStatsCollector(n)).catch((s=>o=>{F("EVENT_REPORT_RETRY")&&(t?this.keyEventUploadPendingItems=this.keyEventUploadPendingItems.concat(s):(this.normalEventUploadPendingItems=this.normalEventUploadPendingItems.concat(s),this.normalEventUploadPendingItems.length>F("NORMAL_EVENT_QUEUE_CAPACITY")&&(this.normalEventUploadPendingItems.splice(0,this.normalEventUploadPendingItems.length-F("NORMAL_EVENT_QUEUE_CAPACITY")),R.warning("report: drop normal events"))))})(n)),e}async postDataToStatsCollector2(e){Qn.networkState===_s.OFFLINE&&await Pe.race([Qn.onlineWaiter,Dr(2*rr.maxRetryTimeout)]);const t=i=>{let s=new Uint8Array;return i.forEach((o=>{const c=Y0(JSON.stringify(o.data)),l=new ArrayBuffer(5),h=(E=>{let g=0;return Object.entries(bn).forEach((v=>{let[O,I]=v;I===E.type&&(g=sY[O])})),g})(o),p=new DataView(l);p.setUint16(0,c.byteLength,!0),p.setUint8(2,255&h),p.setUint8(3,h>>>8&255),p.setUint8(4,h>>>16&255),s=x1(s,new Uint8Array(l)),s=x1(s,c)})),s},n="event";let r=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(F("NEW_REPORT_SERVER_DOMAINS")[0],"&p=443&d=").concat(n):"https://".concat(F("NEW_REPORT_SERVER_DOMAINS")[0],"/").concat(n);for(let i=0;i<2;i+=1){i===1&&(r=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(F("NEW_REPORT_SERVER_DOMAINS")[1],"&p=443&d=").concat(n):"https://".concat(F("NEW_REPORT_SERVER_DOMAINS")[1],"/").concat(n));try{await eb(r,{timeout:1e4,data:t(e),headers:vt(vt({biz:"webrtc",sendts:Math.round(Date.now()/1e3),debug:"false"},this._appId&&{appid:this._appId}),{},{"Content-Type":"application/octet-stream"})},!0)}catch(s){if(i===1)throw s;continue}return}}async postDataToStatsCollector(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const n=(c=>{const l=c&&c.data.sid&&this.baseInfoMap.get(c.data.sid);return l&&l.info.vid&&+l.info.vid||0})(e[0]),r=n?void 0:this._aid,i={msgType:"EventMessages",sentTs:Math.round(Date.now()/1e3),payloads:e.map((c=>JSON.stringify(c))),vid:n,aid:r};Qn.networkState===_s.OFFLINE&&await Pe.race([Qn.onlineWaiter,Dr(2*rr.maxRetryTimeout)]);const s=t?"/events/proto-raws":"/events/messages";let o=this.url||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(F("EVENT_REPORT_DOMAIN"),"&p=").concat(F("STATS_COLLECTOR_PORT"),"&d=").concat(s):"https://".concat(F("EVENT_REPORT_DOMAIN"),":").concat(F("STATS_COLLECTOR_PORT")).concat(s));for(let c=0;c<2;c+=1){c===1&&(o=this.backupUrl||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(F("EVENT_REPORT_BACKUP_DOMAIN"),"&p=").concat(F("STATS_COLLECTOR_PORT"),"&d=").concat(s):"https://".concat(F("EVENT_REPORT_BACKUP_DOMAIN"),":").concat(F("STATS_COLLECTOR_PORT")).concat(s)));try{t?await Hz(o,{timeout:1e4,data:i}):await eb(o,{timeout:1e4,data:i})}catch(l){if(c===1)throw l;continue}return}}createBaseInfo(e,t){const n=Object.assign({},iY);return n.sid=e,this.baseInfoMap.set(e,{info:n,startTime:t}),n}reportResourceTiming(e,t){const n=performance.getEntriesByName(e),r=n[n.length-1];r&&this.reportApiInvoke(t,{name:"Client.resourceTiming",options:r,tag:In.TRACER}).onSuccess()}};lL.on("REPORT_LOG_UPLOAD",(e=>{e.networkState=Qn.networkState,We.reportApiInvoke(null,{name:"logUploadError",options:e,tag:In.TRACER}).onSuccess("logUploadError")}));class se extends ce{constructor(t){super(t,arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",arguments.length>2?arguments[2]:void 0),Un(this,"name","AgoraRTCException")}print(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error";return super.print(t,R)}throw(){super.throw(R)}}const kr={getDisplayMedia:!1,getStreamFromExtension:!1,supportUnifiedPlan:!1,supportMinBitrate:!1,supportSetRtpSenderParameters:!1,supportDualStream:!0,webAudioMediaStreamDest:!1,supportReplaceTrack:!1,supportWebGL:!1,webAudioWithAEC:!1,supportRequestFrame:!1,supportShareAudio:!1,supportDualStreamEncoding:!1,supportDataChannel:!1,supportPCSetConfiguration:!1,supportWebRTCEncodedTransform:!1,supportWebRTCInsertableStream:!1,supportRequestVideoFrameCallback:!1,supportWebCrypto:!1};function Ft(){return kr}function hL(){return"setSinkId"in HTMLAudioElement.prototype&&(!F("RESTRICTION_SET_PLAYBACK_DEVICE")||(fl()||R1())&&!H0())}function MS(){return!kr.supportUnifiedPlan||F("CHROME_FORCE_PLAN_B")&&ml()}function hb(e){return!(xn()||C1(87)||MS()||!F("ENABLE_PRE_SUB")&&(e==null||!e.autoSubscribe||F("FORCE_DISABLE_AUTO_SUB")))}function pL(e){return!!F("ENABLE_INSTANT_VIDEO")||!(e==null||!e.autoSubscribe||F("FORCE_DISABLE_AUTO_SUB"))}let Lr=(function(e){return e.IOS_15_16_INTERRUPTION_START="ios15_16-interruption-start",e.IOS_15_16_INTERRUPTION_END="ios15_16-interruption-end",e.IOS_INTERRUPTION_START="ios-interruption-start",e.IOS_INTERRUPTION_END="ios-interruption-end",e.STATE_CHANGE="state-change",e})({});function Af(e,t,n){return{sampleRate:e,stereo:t,bitrate:n}}function Bt(e,t,n,r,i){return{width:e,height:t,frameRate:n,bitrateMin:r,bitrateMax:i}}function Fo(e,t,n,r,i){return{width:{max:e},height:{max:t},frameRate:n,bitrateMin:r,bitrateMax:i}}function pb(e,t){return{numSpatialLayers:e,numTemporalLayers:t}}const oY={"90p":Bt(160,90),"90p_1":Bt(160,90),"120p":Bt(160,120,15,30,65),"120p_1":Bt(160,120,15,30,65),"120p_3":Bt(120,120,15,30,50),"120p_4":Bt(212,120),"180p":Bt(320,180,15,30,140),"180p_1":Bt(320,180,15,30,140),"180p_3":Bt(180,180,15,30,100),"180p_4":Bt(240,180,15,30,120),"240p":Bt(320,240,15,40,200),"240p_1":Bt(320,240,15,40,200),"240p_3":Bt(240,240,15,40,140),"240p_4":Bt(424,240,15,40,220),"360p":Bt(640,360,15,80,400),"360p_1":Bt(640,360,15,80,400),"360p_3":Bt(360,360,15,80,260),"360p_4":Bt(640,360,30,80,600),"360p_6":Bt(360,360,30,80,400),"360p_7":Bt(480,360,15,80,320),"360p_8":Bt(480,360,30,80,490),"360p_9":Bt(640,360,15,80,800),"360p_10":Bt(640,360,24,80,800),"360p_11":Bt(640,360,24,80,1e3),"480p":Bt(640,480,15,100,500),"480p_1":Bt(640,480,15,100,500),"480p_2":Bt(640,480,30,100,1e3),"480p_3":Bt(480,480,15,100,400),"480p_4":Bt(640,480,30,100,750),"480p_6":Bt(480,480,30,100,600),"480p_8":Bt(848,480,15,100,610),"480p_9":Bt(848,480,30,100,930),"480p_10":Bt(640,480,10,100,400),"720p":Bt(1280,720,15,120,1130),"720p_auto":Bt(1280,720,30,900,3e3),"720p_1":Bt(1280,720,15,120,1130),"720p_2":Bt(1280,720,30,120,2e3),"720p_3":Bt(1280,720,30,120,1710),"720p_5":Bt(960,720,15,120,910),"720p_6":Bt(960,720,30,120,1380),"1080p":Bt(1920,1080,15,120,2080),"1080p_1":Bt(1920,1080,15,120,2080),"1080p_2":Bt(1920,1080,30,120,3e3),"1080p_3":Bt(1920,1080,30,120,3150),"1080p_5":Bt(1920,1080,60,120,4780),"1440p":Bt(2560,1440,30,120,4850),"1440p_1":Bt(2560,1440,30,120,4850),"1440p_2":Bt(2560,1440,60,120,7350),"4k":Bt(3840,2160,30,120,8910),"4k_1":Bt(3840,2160,30,120,8910),"4k_3":Bt(3840,2160,60,120,13500)},aY={"480p":Fo(640,480,5),"480p_1":Fo(640,480,5),"480p_2":Fo(640,480,30),"480p_3":Fo(640,480,15),"720p":Fo(1280,720,5),"720p_auto":Bt(1280,720,30,900,3e3),"720p_1":Fo(1280,720,5),"720p_2":Fo(1280,720,30),"720p_3":Fo(1280,720,15),"1080p":Fo(1920,1080,5),"1080p_1":Fo(1920,1080,5),"1080p_2":Fo(1920,1080,30),"1080p_3":Fo(1920,1080,15)},cY={"1SL1TL":pb(1,1),"3SL3TL":pb(3,3),"2SL3TL":pb(2,3)};function Bo(e){return e||(e="480p_1"),typeof e=="string"?Object.assign({},oY[e]):e}function fb(e){return typeof e=="string"?Object.assign({},aY[e]):e}function US(e){return typeof e=="string"?Object.assign({},cY[e]):e}const lY={speech_low_quality:Af(16e3,!1),speech_standard:Af(32e3,!1,18),music_standard:Af(48e3,!1),standard_stereo:Af(48e3,!0,56),high_quality:Af(48e3,!1,128),high_quality_stereo:Af(48e3,!0,192)};function VS(e){return typeof e=="string"?Object.assign({},lY[e]):e}const Nf=[];function fL(e){return hr(e,"mediaSource",["screen","window","application"]),!0}let Ve=(function(e){return e.NEED_RENEGOTIATE="@need_renegotiate",e.NEED_REPLACE_TRACK="@need_replace_track",e.NEED_REPLACE_MIXING_TRACK="@need_replace_mixing_track",e.NEED_CLOSE="@need_close",e.NEED_ENABLE_TRACK="@need_enable_track",e.NEED_DISABLE_TRACK="@need_disable_track",e.NEED_SESSION_ID="@need_sid",e.SET_OPTIMIZATION_MODE="@set_optimization_mode",e.GET_STATS="@get_stats",e.GET_RTC_STATS="@get_rtc_stats",e.GET_LOW_VIDEO_TRACK="@get_low_video_track",e.NEED_RESET_REMOTE_SDP="@need_reset_remote_sdp",e.NEED_UPDATE_VIDEO_ENCODER="@need_update_video_encoder",e.NEED_UPDATE_VIDEO_SEND_PARAMETERS="@need_update_video_send_parameters",e.NEED_MUTE_TRACK="@need_mute_track",e.NEED_UNMUTE_TRACK="@need_unmute_track",e})({}),an=(function(e){return e.SCREEN_TRACK="screen_track",e.CUSTOM_TRACK="custome_track",e.LOW_STREAM="low_stream",e.SCREEN_LOW_TRACK="screen_low_track",e})({}),Of=(function(e){return e[e.HIGH_STREAM=0]="HIGH_STREAM",e[e.LOW_STREAM=1]="LOW_STREAM",e})({}),dY=(function(e){return e[e.HIGH_STREAM=0]="HIGH_STREAM",e[e.LOW_STREAM=1]="LOW_STREAM",e[e.HIGH_STREAM_LAYER1=4]="HIGH_STREAM_LAYER1",e[e.HIGH_STREAM_LAYER2=5]="HIGH_STREAM_LAYER2",e[e.HIGH_STREAM_LAYER3=6]="HIGH_STREAM_LAYER3",e[e.HIGH_STREAM_LAYER4=7]="HIGH_STREAM_LAYER4",e[e.HIGH_STREAM_LAYER5=8]="HIGH_STREAM_LAYER5",e[e.HIGH_STREAM_LAYER6=9]="HIGH_STREAM_LAYER6",e})({}),uY=(function(e){return e[e.DISABLE=0]="DISABLE",e[e.LOW_STREAM=1]="LOW_STREAM",e[e.AUDIO_ONLY=2]="AUDIO_ONLY",e[e.HIGH_STREAM_LAYER1=3]="HIGH_STREAM_LAYER1",e[e.HIGH_STREAM_LAYER2=4]="HIGH_STREAM_LAYER2",e[e.HIGH_STREAM_LAYER3=5]="HIGH_STREAM_LAYER3",e[e.HIGH_STREAM_LAYER4=6]="HIGH_STREAM_LAYER4",e[e.HIGH_STREAM_LAYER5=7]="HIGH_STREAM_LAYER5",e[e.HIGH_STREAM_LAYER6=8]="HIGH_STREAM_LAYER6",e})({}),gh=(function(e){return e.TRANSCEIVER_UPDATED="transceiver-updated",e.SEI_TO_SEND="sei-to-send",e.SEI_RECEIVED="sei-received",e.TRACK_UPDATED="track-updated",e})({}),Pf=(function(e){return e.SOURCE_STATE_CHANGE="source-state-change",e.TRACK_ENDED="track-ended",e.BEAUTY_EFFECT_OVERLOAD="beauty-effect-overload",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",e.CLOSED="closed",e})({}),ro=(function(e){return e.FIRST_FRAME_DECODED="first-frame-decoded",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",e.VIDEO_STATE_CHANGED="video-state-changed",e.PLAY_START="play-start",e.PLAY_END="play-end",e.FIRST_FRAME_RENDER="first-frame-render",e})({}),Df=(function(e){return e.AUDIO="audio",e.VIDEO="video",e.DATA="data",e})({}),Ns=(function(e){return e.AUDIO_SOURCE_STATE_CHANGE="audio_source_state_change",e.RECEIVE_TRACK_BUFFER="receive_track_buffer",e.ON_AUDIO_BUFFER="on_audio_buffer",e.UPDATE_SOURCE="update_source",e})({});(function(e){e.UPDATE_TRACK_SOURCE="update-track-source"})({});const mb={sendVolumeLevel:0,sendBitrate:0,sendBytes:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,currentPacketLossRate:0},_b={sendBytes:0,sendBitrate:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,sendResolutionHeight:0,sendResolutionWidth:0,captureResolutionHeight:0,captureResolutionWidth:0,targetSendBitrate:0,totalDuration:0,totalFreezeTime:0,currentPacketLossRate:0},mL={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveLevel:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receivePacketsDiscarded:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},hY={uplinkNetworkQuality:0,downlinkNetworkQuality:0},_L={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receiveResolutionHeight:0,receiveResolutionWidth:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1};let wi=(function(e){return e.ON_TRACK="on_track",e.ON_NODE="on_node",e})({}),Os=(function(e){return e.REQUEST_UPDATE_CONSTRAINTS="request_update_constraints",e.REQUEST_CONSTRAINTS="request_constraints",e})({}),HE=(function(e){return e.IDLE="IDLE",e.INITING="INITING",e.INITEND="INITEND",e})({}),vh=(function(e){return e.STATE_CHANGE="state_change",e.RECORDING_DEVICE_CHANGED="recordingDeviceChanged",e.PLAYOUT_DEVICE_CHANGED="playoutDeviceChanged",e.CAMERA_DEVICE_CHANGED="cameraDeviceChanged",e})({}),qr=(function(e){return e.NONE="none",e.INIT="init",e.CANPLAY="canplay",e.PLAYING="playing",e.PAUSED="paused",e.SUSPEND="suspend",e.STALLED="stalled",e.WAITING="waiting",e.ERROR="error",e.DESTROYED="destroyed",e.ABORT="abort",e.ENDED="ended",e.EMPTIED="emptied",e.LOADEDDATA="loadeddata",e})({}),Rc=(function(e){return e[e.VideoStateStopped=0]="VideoStateStopped",e[e.VideoStateStarting=1]="VideoStateStarting",e[e.VideoStateDecoding=2]="VideoStateDecoding",e[e.VideoStateFrozen=3]="VideoStateFrozen",e})({});const Eb={uninit:100,none:110,init:120,loadeddata:130,canplay:200,playing:210,paused:220,suspend:300,stalled:310,waiting:320,error:330,destroyed:340,abort:350,ended:360,emptied:370};let jS=(function(e){return e.OPEN="open",e.MESSAGE="message",e.CLOSE="close",e.CLOSING="closing",e.ERROR="error",e})({});function Lt(e,t,n,r,i){var s,o,c={};return Object.keys(r).forEach((function(l){c[l]=r[l]})),c.enumerable=!!c.enumerable,c.configurable=!!c.configurable,("value"in c||c.initializer)&&(c.writable=!0),c=zi(s=Iu(o=n.slice()).call(o)).call(s,(function(l,h){return h(e,t,l)||l}),c),i&&c.initializer!==void 0&&(c.value=c.initializer?c.initializer.call(i):void 0,c.initializer=void 0),c.initializer===void 0?(Object.defineProperty(e,t,c),null):c}function ne(e,t,n){return(t=(function(r){var i=(function(s,o){if(typeof s!="object"||!s)return s;var c=s[Symbol.toPrimitive];if(c!==void 0){var l=c.call(s,"string");if(typeof l!="object")return l;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(s)})(r);return typeof i=="symbol"?i:i+""})(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function EL(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable}))),n.push.apply(n,r)}return n}function mn(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?EL(Object(n),!0).forEach((function(r){ne(e,r,n[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):EL(Object(n)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))}))}return e}class gL extends Pn{set _mediaStreamTrack(t){t!==this.mediaStreamTrack&&(this.safeEmit(gh.TRACK_UPDATED,t),this.mediaStreamTrack=t)}get _mediaStreamTrack(){return this.mediaStreamTrack}constructor(t,n){super(),ne(this,"trackMediaType",void 0),ne(this,"_ID",void 0),ne(this,"_rtpTransceiver",void 0),ne(this,"_lowRtpTransceiver",void 0),ne(this,"_hints",[]),ne(this,"_isClosed",!1),ne(this,"_originMediaStreamTrack",void 0),ne(this,"mediaStreamTrack",void 0),ne(this,"_external",{}),this._ID=n||ln(8,"track-"),this._originMediaStreamTrack=t,this.mediaStreamTrack=t,(function(r){Re(Nf).call(Nf,r)||Nf.push(r)})(this)}toString(){return this._ID}getTrackId(){return this._ID}getMediaStreamTrack(t){return t||wd((()=>{var n;We.reportApiInvoke(null,{name:Bn.GET_MEDIA_STREAM_TRACK,options:[],tag:In.TRACER}).onSuccess(((n=this._mediaStreamTrack)===null||n===void 0?void 0:n.label)||"")}),this.mediaStreamTrack.id||this.getTrackId()),this._mediaStreamTrack}getRTCRtpTransceiver(t){return t===Of.LOW_STREAM?this._lowRtpTransceiver:this._rtpTransceiver}getMediaStreamTrackSettings(){return this.getMediaStreamTrack(!0).getSettings()}close(){this._isClosed=!0,this._lowRtpTransceiver=void 0,this._rtpTransceiver=void 0,(function(t){const n=Nf.indexOf(t);n!==-1&&Nf.splice(n,1)})(this),this.emit(Pf.CLOSED),this.removeAllListeners(gh.SEI_RECEIVED)}_updateRtpTransceiver(t,n){if(n===Of.LOW_STREAM){if(this._lowRtpTransceiver===t)return;this._lowRtpTransceiver=t}else{if(this._rtpTransceiver===t)return;this._rtpTransceiver=t}this.emit(gh.TRANSCEIVER_UPDATED,t,n)}}class kf extends gL{get isExternalTrack(){return this._isExternalTrack}get muted(){return this._muted}get enabled(){return this._enabled}get processorContext(){return this._processorContext}constructor(t,n){super(t,n),ne(this,"_enabled",!0),ne(this,"_muted",!1),ne(this,"_isExternalTrack",!1),ne(this,"_isClosed",!1),ne(this,"_enabledMutex",void 0),ne(this,"processor",void 0),ne(this,"_processorContext",void 0),ne(this,"_handleTrackEnded",(()=>{this.onTrackEnded()})),this._enabledMutex=new Yr("".concat(this.getTrackId())),t.addEventListener("ended",this._handleTrackEnded)}getTrackLabel(){var t,n;return(t=(n=this._originMediaStreamTrack)===null||n===void 0?void 0:n.label)!==null&&t!==void 0?t:""}close(){this._isClosed||(this.stop(),this._originMediaStreamTrack.stop(),this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack.stop(),this._mediaStreamTrack=null),this._originMediaStreamTrack=null,this._enabledMutex=null,R.debug("[".concat(this.getTrackId(),"] close")),this.emit(Ve.NEED_CLOSE),super.close())}async _updateOriginMediaStreamTrack(t,n){let r=arguments.length>2&&arguments[2]!==void 0&&arguments[2];this._isExternalTrack=r,t!==this._originMediaStreamTrack&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),n&&this._originMediaStreamTrack.stop()),t.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=t,this._muted&&(this._originMediaStreamTrack.enabled=!1),this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await cn(this,Ve.NEED_REPLACE_TRACK,this),this.processor&&this._processorContext&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this._processorContext}))}_getDefaultPlayerConfig(){return{}}onTrackEnded(){R.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(Pf.TRACK_ENDED)}stateCheck(t,n){if(R.debug("check track state, [muted: ".concat(this._muted,", enabled: ").concat(this._enabled,"] to [").concat(t,": ").concat(n,"]")),Sa(n,t),this._enabled&&this._muted&&t==="enabled"&&n===!1)throw new ce(U.TRACK_STATE_UNREACHABLE,"cannot set enabled while the track is muted").print("error",R);if(!this._enabled&&!this._muted&&t==="muted"&&n===!0)throw new ce(U.TRACK_STATE_UNREACHABLE,"cannot set muted while the track is disabled").print("error",R)}getProcessorStats(){return this._processorContext&&this._processorContext.gatherStats()||[]}getProcessorUsage(){return this._processorContext?this._processorContext.gatherUsage():Pe.resolve([])}}const vL=window.AudioContext||window.webkitAudioContext;let Ps=null;const rn=new class extends Pn{constructor(){super(...arguments),ne(this,"prevState",void 0),ne(this,"curState",void 0),ne(this,"currentTime",void 0),ne(this,"currentTimeStuckAt",void 0),ne(this,"interruptDetectorTrack",void 0),ne(this,"onLocalAudioTrackMute",(()=>{R.info("ios15-interruption-start"),this.emit(Lr.IOS_15_16_INTERRUPTION_START)})),ne(this,"onLocalAudioTrackUnmute",(async()=>{R.info("ios15-interruption-end"),this.curState!=="running"||this.duringInterruption?R.info("ios15-interruption-end-canceled"):(Ps&&await Ps.suspend(),this.emit(Lr.IOS_15_16_INTERRUPTION_END))}))}get duringInterruption(){return this.prevState==="running"&&this.curState==="interrupted"}bindInterruptDetectorTrack(e){R.debug("webaudio bindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack||(this.interruptDetectorTrack=e,this.interruptDetectorTrack._mediaStreamTrack.onmute=this.onLocalAudioTrackMute,this.interruptDetectorTrack._mediaStreamTrack.onunmute=this.onLocalAudioTrackUnmute)}unbindInterruptDetectorTrack(e){R.debug("webaudio unbindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack&&this.interruptDetectorTrack===e&&(this.interruptDetectorTrack._mediaStreamTrack&&(this.interruptDetectorTrack._mediaStreamTrack.onmute=null,this.interruptDetectorTrack._mediaStreamTrack.onunmute=null),this.interruptDetectorTrack=void 0)}};function Lf(){if(!Ps){if((function(){if(!vL)return void R.error("your browser is not support web audio");R.info("create audio context");const e=mn({},F("WEBAUDIO_INIT_OPTIONS"));R.debug("audio context init option:",JSON.stringify(e)),Ps=new vL(e),rn.curState=Ps.state,Ps.onstatechange=()=>{rn.prevState=rn.curState,rn.curState=Ps?Ps.state:void 0;const{prevState:t,curState:n}=rn,r=n==="running",i=n==="interrupted",s=t==="running",o=t==="suspended",c=t==="interrupted",l=xt().osVersion;(ni()||Vo())&&s&&i&&(R.info("ios".concat(l,"-interruption-start")),rn.emit(Lr.IOS_INTERRUPTION_START)),(ni()||Vo())&&(o||c)&&r&&(R.info("ios".concat(l,"-interruption-end")),rn.emit(Lr.IOS_INTERRUPTION_END)),t!==n&&rn.emit(Lr.STATE_CHANGE,n,t)},setInterval((()=>{var t;const n=(t=Ps)===null||t===void 0?void 0:t.currentTime;rn.currentTime!==n?(rn.currentTimeStuckAt&&(R.debug("AudioContext current time resume at ".concat(n)),rn.currentTimeStuckAt=void 0),rn.currentTime=n):(n!==rn.currentTimeStuckAt&&(We.reportApiInvoke(null,{name:"WEB_AUDIO_CURRENT_TIME_STUCK",options:{currentTime:n},tag:In.TRACER}).onSuccess(),R.warning("AudioContext current time stuck at ".concat(n))),rn.currentTimeStuckAt=n)}),5e3),(async function(t){const n=["click","contextmenu","auxclick","dblclick","mousedown","mouseup","touchend","keydown","keyup"];let r,i=!1,s=!1,o=!1;function c(I){t.state==="running"?l(!1):ni()||Vo()?t.state==="suspended"&&(l(!0),I&&t.resume().then(h,h)):t.state!=="closed"&&(l(!0),I&&t.resume().then(h,h))}function l(I){if(i!==I){i=I;for(let N=0,M=n;N<M.length;N+=1){const x=M[N];I?window.addEventListener(x,p,{capture:!0,passive:!0}):window.removeEventListener(x,p,{capture:!0,passive:!0})}}}function h(){c(!1)}function p(){c(!0)}function E(I){if(!o)if(r.paused)if(I){let N;g(!1),o=!0;try{N=r.play(),N?N.then(v,v):(r.addEventListener("playing",v),r.addEventListener("abort",v),r.addEventListener("error",v))}catch{v()}}else g(!0);else g(!1)}function g(I){if(s!==I){s=I;for(let N=0,M=n;N<M.length;N++){const x=M[N];I?window.addEventListener(x,O,{capture:!0,passive:!0}):window.removeEventListener(x,O,{capture:!0,passive:!0})}}}function v(){r.removeEventListener("playing",v),r.removeEventListener("abort",v),r.removeEventListener("error",v),o=!1,E(!1)}function O(){E(!0)}if(ni()){const I=t.createMediaStreamDestination(),N=document.createElement("div");N.innerHTML="<audio x-webkit-airplay='deny'></audio>",r=N.children.item(0),r.controls=!1,r.disableRemotePlayback=!0,r.preload="auto",r.srcObject=I.stream,E(!0)}rn.on(Lr.STATE_CHANGE,(function(){c(!0)})),c(!1)})(Ps)})(),!Ps)throw new ce(U.NOT_SUPPORTED,"can not create audio context");return Ps}return Ps}function yh(e){if((function(){if(gb!==null)return gb;const r=Lf(),i=r.createBufferSource(),s=r.createGain(),o=r.createGain();i.connect(s),i.connect(o),i.disconnect(s);let c=!1;try{i.disconnect(s)}catch{c=!0}return i.disconnect(),gb=c,c})())return;const t=e.connect,n=e.disconnect;e.connect=(r,i,s)=>{var o;return e._inputNodes||(e._inputNodes=[]),Re(o=e._inputNodes).call(o,r)||(r instanceof AudioNode?(e._inputNodes.push(r),t.call(e,r,i,s)):t.call(e,r,i)),e},e.disconnect=(r,i,s)=>{n.call(e),r?AS(e._inputNodes,r):e._inputNodes=[];for(const o of e._inputNodes)t.call(e,o)}}let gb=null;function vb(e,t){let n=!1;const r=1/t;if(F("DISABLE_WEBAUDIO")){const i=window.setInterval((()=>{n?window.clearInterval(i):e(performance.now()/1e3)}),1e3*r)}else{const i=Lf();let s=i.createGain();s.gain.value=0,s.connect(i.destination);const o=()=>{if(n)return void(s=null);const c=i.createOscillator();c.onended=o,c.connect(s),c.start(0),c.stop(i.currentTime+r),e(i.currentTime)};o()}return()=>{n=!0}}class yL{constructor(){ne(this,"context",void 0),ne(this,"analyserNode",void 0),ne(this,"sourceNode",void 0),this.context=Lf(),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4}updateSource(t){if(t!==this.sourceNode){if(this.sourceNode)try{this.sourceNode.disconnect(this.analyserNode)}catch{}this.sourceNode=t,t?.connect(this.analyserNode)}}getVolumeLevel(){if(!this.sourceNode||(!this.context||ni()||Vo()||this.context.state!=="running"&&this.context.resume(),!this.analyserNode))return 0;const t=new Float32Array(this.analyserNode.fftSize);if(this.analyserNode.getFloatTimeDomainData)this.analyserNode.getFloatTimeDomainData(t);else{const r=new Uint8Array(this.analyserNode.fftSize);this.analyserNode.getByteTimeDomainData(r);for(let i=0;i<t.length;++i)t[i]=r[i]/128-1}const n=zi(t).call(t,((r,i)=>r+i*i),0)/t.length;return Math.max(10*Math.log10(n)+100,0)/100}getAnalyserNode(){return this.analyserNode}rebuildAnalyser(){try{var t,n;(t=this.sourceNode)===null||t===void 0||t.disconnect(this.analyserNode),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4,(n=this.sourceNode)===null||n===void 0||n.connect(this.analyserNode)}catch{R.warning("rebuild analyser node failed.")}}destroy(){this.updateSource(void 0)}}class SL extends Pn{get processSourceNode(){return this.sourceNode}set processedNode(t){var n;if(!this.isDestroyed&&this._processedNode!==t){try{var r;(r=this.sourceNode)===null||r===void 0||r.disconnect(this.outputNode)}catch{}(n=this._processedNode)===null||n===void 0||n.disconnect(),this._processedNode=t,this.connect()}}get processedNode(){return this._processedNode}constructor(){super(),ne(this,"outputNode",void 0),ne(this,"outputTrack",void 0),ne(this,"isPlayed",!1),ne(this,"sourceNode",void 0),ne(this,"context",void 0),ne(this,"audioBufferNode",void 0),ne(this,"destNode",void 0),ne(this,"audioOutputLevel",0),ne(this,"volumeLevelAnalyser",void 0),ne(this,"_processedNode",void 0),ne(this,"playNode",void 0),ne(this,"isDestroyed",!1),ne(this,"onNoAudioInput",void 0),ne(this,"isNoAudioInput",!1),ne(this,"_noAudioInputCount",0),this.context=Lf(),this.playNode=this.context.destination,this.outputNode=this.context.createGain(),yh(this.outputNode),this.volumeLevelAnalyser=new yL}startGetAudioBuffer(t){this.audioBufferNode||(this.audioBufferNode=this.context.createScriptProcessor(t),this.outputNode.connect(this.audioBufferNode),this.audioBufferNode.connect(this.context.destination),this.audioBufferNode.onaudioprocess=n=>{this.emit(Ns.ON_AUDIO_BUFFER,(function(r){for(let i=0;i<r.outputBuffer.numberOfChannels;i+=1){const s=r.outputBuffer.getChannelData(i);for(let o=0;o<s.length;o+=1)s[o]=0}return r.inputBuffer})(n))})}stopGetAudioBuffer(){this.audioBufferNode&&(this.audioBufferNode.onaudioprocess=null,this.outputNode.disconnect(this.audioBufferNode),this.audioBufferNode=void 0)}createOutputTrack(){if(!Ft().webAudioMediaStreamDest)throw new ce(U.NOT_SUPPORTED,"your browser is not support audio processor");return this.destNode&&this.outputTrack||(this.destNode=this.context.createMediaStreamDestination(),this.outputNode.connect(this.destNode),this.outputTrack=this.destNode.stream.getAudioTracks()[0]),this.outputTrack}play(t){this.context.state!=="running"&&NS((()=>{rn.emit("autoplay-failed")})),this.isPlayed=!0,this.playNode=t||this.context.destination,this.outputNode.connect(this.playNode)}stop(){if(this.isPlayed)try{this.outputNode.disconnect(this.playNode)}catch{}this.isPlayed=!1}getAccurateVolumeLevel(){return this.volumeLevelAnalyser.getVolumeLevel()}async checkHasAudioInput(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;if(t>5)return this.isNoAudioInput=!0,this.onNoAudioInput&&this.onNoAudioInput(),!1;ni()||Vo()?this.context.state==="suspended"&&this.context.resume():this.context.state!=="running"&&this.context.resume();const n=this.volumeLevelAnalyser.getAnalyserNode();let r;n.getFloatTimeDomainData?(r=new Float32Array(n.fftSize),n.getFloatTimeDomainData(r)):(r=new Uint8Array(n.fftSize),n.getByteTimeDomainData(r));let i=!1;for(let s=0;s<r.length;s++)r[s]!==0&&(i=!0);return i?(this.isNoAudioInput=!1,!0):(await Dr(200),await this.checkHasAudioInput(t?t+1:1)&&i)}getAudioVolume(){return this.outputNode.gain.value}setVolume(t){this.outputNode.gain.setValueAtTime(t,this.context.currentTime)}destroy(){this.disconnect(),this.stop(),this.isDestroyed=!0,this.onNoAudioInput=void 0}disconnect(){var t,n;(t=this.processedNode)===null||t===void 0||t.disconnect(),(n=this.sourceNode)===null||n===void 0||n.disconnect(),this.outputNode&&this.outputNode.disconnect()}connect(){var t;this.processedNode?(t=this.processedNode)===null||t===void 0||t.connect(this.outputNode):this.sourceNode&&this.sourceNode.connect(this.outputNode),this.volumeLevelAnalyser.updateSource(this.outputNode)}}class TL extends SL{get isFreeze(){return!1}constructor(t,n,r){var i;if(super(),ne(this,"sourceNode",void 0),ne(this,"track",void 0),ne(this,"clonedTrack",void 0),ne(this,"audioElement",void 0),ne(this,"isCurrentTrackCloned",!1),ne(this,"isRemoteTrack",!1),ne(this,"originVolumeLevelAnalyser",void 0),ne(this,"rebuildWebAudio",(async()=>{if(R.debug("ready to rebuild web audio, state:",this.context.state),this.isNoAudioInput&&await this.checkHasAudioInput(),!this.isNoAudioInput||this.isDestroyed)return document.body.removeEventListener("click",this.rebuildWebAudio,!0),void R.debug("rebuild web audio success, current volume status",this.getAccurateVolumeLevel());this.context.resume().then((()=>R.info("resume success"))),R.debug("rebuild web audio because of ios 12 bugs"),this.disconnect();const c=this.track;this.track=this.track.clone(),this.isCurrentTrackCloned?c.stop():this.isCurrentTrackCloned=!0;const l=new MediaStream([this.track]);this.sourceNode=this.context.createMediaStreamSource(l),yh(this.sourceNode),this.volumeLevelAnalyser.rebuildAnalyser();const h=this.outputNode.gain.value;this.outputNode=this.context.createGain(),this.outputNode.gain.setValueAtTime(h,this.context.currentTime),yh(this.outputNode),this.emit(Ns.UPDATE_SOURCE),this.connect(),this.audioElement.srcObject=l,this.isPlayed&&this.play(this.playNode),this.checkHasAudioInput()})),t.kind!=="audio")throw new ce(U.UNEXPECTED_ERROR);this.track=t;const s=new MediaStream([this.track]);if(this.isRemoteTrack=!!n,this.sourceNode=this.context.createMediaStreamSource(s),yh(this.sourceNode),r){const c=r.clone();c.enabled=!0,this.clonedTrack=c,R.debug("create an unmuted track ".concat(c.id," from the original track ").concat(r.id," to get the volume"));const l=this.context.createMediaStreamSource(new MediaStream([c]));yh(l),this.originVolumeLevelAnalyser=new yL,this.originVolumeLevelAnalyser.updateSource(l)}this.connect(),this.audioElement=document.createElement("audio"),this.audioElement.srcObject=s;const o=xt();n&&o.os===Er.IOS&&Number((i=o.osVersion)===null||i===void 0?void 0:i.split(".")[0])<15&&(rn.on(Lr.STATE_CHANGE,(()=>{this.context.state==="suspended"?document.body.addEventListener("click",this.rebuildWebAudio,!0):this.context.state==="running"&&this.rebuildWebAudio()})),this.checkHasAudioInput().then((c=>{c||document.body.addEventListener("click",this.rebuildWebAudio,!0)})))}updateTrack(t){this.sourceNode.disconnect(),this.track=t,this.isCurrentTrackCloned=!1;const n=new MediaStream([t]);this.sourceNode=this.context.createMediaStreamSource(n),yh(this.sourceNode),this.processedNode||this.sourceNode.connect(this.outputNode),this.emit(Ns.UPDATE_SOURCE),this.audioElement.srcObject=n}destroy(){var t;this.audioElement.srcObject=null,this.audioElement.remove(),rn.off("state-change",this.rebuildWebAudio),(t=this.originVolumeLevelAnalyser)===null||t===void 0||t.destroy(),this.clonedTrack=void 0,super.destroy()}createMediaStreamSourceNode(t){return this.context.createMediaStreamSource(new MediaStream([t]))}updateOriginTrack(t){const n=t.clone();n.enabled=!0,this.clonedTrack&&(this.clonedTrack.stop(),this.clonedTrack=n),R.debug("create an unmuted track ".concat(n.id," from the original track ").concat(t.id," to get the volume"));const r=this.context.createMediaStreamSource(new MediaStream([n]));yh(r),this.originVolumeLevelAnalyser&&this.originVolumeLevelAnalyser.updateSource(r)}getOriginVolumeLevel(){return this.originVolumeLevelAnalyser?this.originVolumeLevelAnalyser.getVolumeLevel():this.getAccurateVolumeLevel()}}async function RL(e,t,n){const r=(s,o)=>s?typeof s!="number"?s.max||s.exact||s.ideal||s.min||o:s:o,i={audio:!!n&&{mandatory:{chromeMediaSource:"desktop"}},video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:e,maxHeight:r(t.height,1080),maxWidth:r(t.width,1920)}}};return t.frameRate&&typeof t.frameRate!="number"?(i.video.mandatory.maxFrameRate=t.frameRate.max,i.video.mandatory.minFrameRate=t.frameRate.min):typeof t.frameRate=="number"&&(i.video.mandatory.maxFrameRate=t.frameRate),await navigator.mediaDevices.getUserMedia(i)}async function pY(e,t){const n=await CL(e.mediaSource),{sourceId:r,audio:i}=await(function(s){let o=arguments.length>1&&arguments[1]!==void 0&&arguments[1];return new Pe(((c,l)=>{const h=document.createElement("div");h.innerText="share screen",h.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;");const p=document.createElement("div");p.setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;");const E=document.createElement("div");E.innerText="Agora Web Screensharing wants to share the contents of your screen with webdemo.agorabeckon.com. Choose what you'd like to share.",E.setAttribute("style","height: 12%;");const g=document.createElement("div");g.setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;");const v=document.createElement("div");v.setAttribute("style","display: flex; justify-content: space-between; padding: 16px 0;");const O=document.createElement("button");O.innerHTML="cancel",O.setAttribute("style","width: 85px;"),O.onclick=()=>{document.body.removeChild(M);const x=new Error("NotAllowedError");x.name="NotAllowedError",l(x)};let I=o;const N=document.createElement("div");if(o){const x=document.createElement("input");x.setAttribute("type","checkbox");const B=document.createElement("span");x.setAttribute("style","margin-right: 6px;"),B.innerText="Share audio",x.checked=I,x.onchange=()=>{I=x.checked},N.appendChild(x),N.appendChild(B)}v.appendChild(N),v.appendChild(O),p.appendChild(E),p.appendChild(g),p.appendChild(v);const M=document.createElement("div");M.setAttribute("style","position: fixed; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),M.appendChild(h),M.appendChild(p),document.body.appendChild(M),s.map((x=>{if(x.id){const B=document.createElement("div");B.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;");let Z=x.thumbnail;try{const{width:Q}=Z.getSize();Q>1920&&(Z=Z.resize({width:1920}))}catch(Q){throw Q&&Q.message.startsWith("Illegal invocation")&&console.error("Operate thumbnail error, please try to set contextIsolation: false. (https://github.com/electron/electron/issues/34953)"),Q}B.innerHTML='<div style="height: 120px; display: table-cell; vertical-align: middle;"><img style="width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);" src='+Z.toDataURL()+' /></div><span style="	height: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+x.name.replace(/[\u00A0-\u9999<>\&]/g,(function(Q){return"&#"+Q.charCodeAt(0)+";"}))+"</span>",B.onclick=()=>{document.body.removeChild(M),c({sourceId:x.id,audio:I})},g.appendChild(B)}}))}))})(n,t);return await RL(r,e,i)}async function CL(e){let t=["window","screen"];e!=="application"&&e!=="window"||(t=["window"]),e==="screen"&&(t=["screen"]);const n=M1();if(!n)throw console.error("failed to fetch electron, please mount it to window"),new ce(U.ELECTRON_IS_NULL);let r=null;try{var i;r=((i=n.desktopCapturer)===null||i===void 0?void 0:i.getSources({types:t}))||n.ipcRenderer.invoke("DESKTOP_CAPTURER_GET_SOURCES",{types:t})}catch{r=null}r&&r.then||(r=new Pe(((s,o)=>{n.desktopCapturer.getSources({types:t},((c,l)=>{c?o(c):s(l)}))})));try{return await r}catch(s){throw new ce(U.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR,s.toString())}}const yb=new Yr("safari");let wL=!1,bL=!1;async function Ds(e,t){let n=0,r=null;for(;n<2;)try{r=await fY(e,t,n>0);break}catch(i){if(i instanceof ce)throw R.error("[".concat(t,"] ").concat(i.toString())),i;const s=FS(i.name||i.code||i,i.message);if(s.code===U.MEDIA_OPTION_INVALID){R.debug("[".concat(t,"] detect media option invalid, retry")),n+=1,await Dr(500);continue}throw R.error("[".concat(t,"] ").concat(s.toString())),s}if(!r)throw new ce(U.UNEXPECTED_ERROR,"can not find stream after getUserMedia");return r}async function fY(e,t,n){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new ce(U.NOT_SUPPORTED,"can not find getUserMedia");n&&(e.video&&(delete e.video.width,delete e.video.height),e.screen&&(delete e.screen.width,delete e.screen.height));const r=Ft(),i=new MediaStream;if(e.audioSource&&i.addTrack(e.audioSource),e.videoSource&&i.addTrack(e.videoSource),!e.audio&&!e.video&&!e.screen)return R.debug("Using Video Source/ Audio Source"),i;if(e.screen)if(M1())e.screen.sourceId?xf(i,await RL(e.screen.sourceId,e.screen,!!e.screenAudio)):xf(i,await pY(e.screen,!!e.screenAudio));else if(fl()&&e.screen.extensionId&&e.screen.mandatory){if(!r.getStreamFromExtension)throw new ce(U.NOT_SUPPORTED,"This browser does not support screen sharing");R.debug("[".concat(t,'] Screen access on chrome stable, looking for extension"'));const g=await(o=e.screen.extensionId,c=t,new Pe(((v,O)=>{try{chrome.runtime.sendMessage(o,{getStream:!0},(I=>{if(!I||!I.streamId)return R.error("[".concat(c,"] No response from Chrome Plugin. Plugin not installed properly"),I),void O(new ce(U.CHROME_PLUGIN_NO_RESPONSE,"No response from Chrome Plugin. Plugin not installed properly"));v(I.streamId)}))}catch(I){R.error("[".concat(c,"] AgoraRTC screensharing plugin is not accessible(").concat(o,")"),I.toString()),O(new ce(U.CHROME_PLUGIN_NOT_INSTALL))}})));e.screen.mandatory.chromeMediaSourceId=g,xf(i,await navigator.mediaDevices.getUserMedia({video:{mandatory:e.screen.mandatory}}))}else if(r.getDisplayMedia){var s;e.screen.mediaSource&&fL(e.screen.mediaSource);const g={width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate,displaySurface:(s=e.screen.displaySurface)!==null&&s!==void 0?s:e.screen.mediaSource==="screen"?"monitor":e.screen.mediaSource},{selfBrowserSurface:v,surfaceSwitching:O,systemAudio:I,preferCurrentTab:N}=e.screen,M={selfBrowserSurface:v,surfaceSwitching:O,systemAudio:I,preferCurrentTab:N};!v&&delete M.selfBrowserSurface,!O&&delete M.surfaceSwitching,!I&&delete M.systemAudio,!N&&delete M.preferCurrentTab,R.debug("[".concat(t,"] getDisplayMedia:"),JSON.stringify({video:g,audio:e.screenAudio,controls:M})),xf(i,await navigator.mediaDevices.getDisplayMedia(mn({video:g,audio:e.screenAudio},M)))}else{if(!xn())throw R.error("[".concat(t,"] This browser does not support screenSharing")),new ce(U.NOT_SUPPORTED,"This browser does not support screen sharing");{e.screen.mediaSource&&fL(e.screen.mediaSource);const g={video:{mediaSource:e.screen.mediaSource,width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate}};R.debug("[".concat(t,"] getUserMedia: ").concat(JSON.stringify(g))),xf(i,await navigator.mediaDevices.getUserMedia(g))}}var o,c;if(!e.video&&!e.audio)return i;let l={video:e.video,audio:e.audio},h=F("MEDIA_DEVICE_CONSTRAINTS");if(h)try{typeof h=="string"&&(h=JSON.parse(h)),l=J0(l,h)}catch{}R.debug("[".concat(t,"] GetUserMedia"),JSON.stringify(l)),xt();let p,E=null;(Vr()||ni()||bS())&&(E=await yb.lock());try{p=await navigator.mediaDevices.getUserMedia(l)}catch(g){throw E&&E(),g}return l.audio&&(wL=!0),l.video&&(bL=!0),xf(i,p),E&&E(),i}function FS(e,t){switch(e){case"Starting video failed":case"OverconstrainedError":case"TrackStartError":return new ce(U.MEDIA_OPTION_INVALID,"".concat(e,": ").concat(t));case"NotFoundError":case"DevicesNotFoundError":return new ce(U.DEVICE_NOT_FOUND,"".concat(e,": ").concat(t));case"NotSupportedError":return new ce(U.NOT_SUPPORTED,"".concat(e,": ").concat(t));case"NotReadableError":return new ce(U.NOT_READABLE,"".concat(e,": ").concat(t));case"InvalidStateError":case"NotAllowedError":case"PERMISSION_DENIED":case"PermissionDeniedError":return new ce(U.PERMISSION_DENIED,"".concat(e,": ").concat(t));case"ConstraintNotSatisfiedError":return new ce(U.CONSTRAINT_NOT_SATISFIED,"".concat(e,": ").concat(t));default:return R.error("getUserMedia unexpected error",e),new ce(U.UNEXPECTED_ERROR,"".concat(e,": ").concat(t))}}function xf(e,t){const n=e.getVideoTracks()[0],r=e.getAudioTracks()[0],i=t.getVideoTracks()[0],s=t.getAudioTracks()[0];s&&(r&&e.removeTrack(r),e.addTrack(s)),i&&(n&&e.removeTrack(n),e.addTrack(i))}const ks=new class extends Pn{get state(){return this._state}set state(e){e!==this._state&&(this.emit(vh.STATE_CHANGE,e),this._state=e)}constructor(){super(),ne(this,"_state",HE.IDLE),ne(this,"isAccessMicrophonePermission",!1),ne(this,"isAccessCameraPermission",!1),ne(this,"lastAccessMicrophonePermission",!1),ne(this,"lastAccessCameraPermission",!1),ne(this,"checkdeviceMatched",!1),ne(this,"deviceInfoMap",new Map),this.init().then((()=>{navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",this.updateDevicesInfo.bind(this)),window.setInterval((()=>{(F("ENUMERATE_DEVICES_INTERVAL")||(IS()||wS()===Er.HARMONY_OS)&&ml())&&this.updateDevicesInfo()}),F("ENUMERATE_DEVICES_INTERVAL_TIME"))})).catch((e=>R.error(e.toString())))}async enumerateDevices(e,t){let n=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return new ce(U.NOT_SUPPORTED,"enumerateDevices() not supported.").throw();const r=await navigator.mediaDevices.enumerateDevices(),i=this.checkMediaDeviceInfoIsOk(r);let s=!this.isAccessMicrophonePermission&&e,o=!this.isAccessCameraPermission&&t;i.audio&&(s=!1),i.video&&(o=!1);let c=null,l=null,h=null;if(!n&&(s||o)){if(yb.isLocked&&(R.debug("[device manager] wait GUM lock"),(await yb.lock())(),R.debug("[device manager] GUM unlock")),wL&&(s=!1,this.isAccessMicrophonePermission=!0),bL&&(o=!1,this.isAccessCameraPermission=!0),R.debug("[device manager] check media device permissions",e,t,s,o),s&&o){try{h=await navigator.mediaDevices.getUserMedia({audio:!0,video:!0})}catch(p){const E=FS(p.name||p.code||p,p.message);if(E.code===U.PERMISSION_DENIED)throw E;R.warning("getUserMedia failed in getDevices",E)}this.isAccessCameraPermission=!0,this.isAccessMicrophonePermission=!0}else if(s){try{c=await navigator.mediaDevices.getUserMedia({audio:e})}catch(p){const E=FS(p.name||p.code||p,p.message);if(E.code===U.PERMISSION_DENIED)throw E;R.warning("getUserMedia failed in getDevices",E)}this.isAccessMicrophonePermission=!0}else if(o){try{l=await navigator.mediaDevices.getUserMedia({video:t})}catch(p){const E=FS(p.name||p.code||p,p.message);if(E.code===U.PERMISSION_DENIED)throw E;R.warning("getUserMedia failed in getDevices",E)}this.isAccessCameraPermission=!0}R.debug("[device manager] mic permission",e,"cam permission",t)}try{const p=await navigator.mediaDevices.enumerateDevices();return c&&c.getTracks().forEach((E=>E.stop())),l&&l.getTracks().forEach((E=>E.stop())),h&&h.getTracks().forEach((E=>E.stop())),c=null,l=null,h=null,p}catch(p){return c&&c.getTracks().forEach((E=>E.stop())),l&&l.getTracks().forEach((E=>E.stop())),h&&h.getTracks().forEach((E=>E.stop())),c=null,l=null,h=null,new ce(U.ENUMERATE_DEVICES_FAILED,p.toString()).throw()}}async getRecordingDevices(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,e)).filter((t=>t.kind==="audioinput"))}async getCamerasDevices(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!1,!0,e)).filter((t=>t.kind==="videoinput"))}async getSpeakers(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,e)).filter((t=>t.kind==="audiooutput"))}searchDeviceIdByName(e){let t=null;return this.deviceInfoMap.forEach((n=>{n.device.label===e&&(t=n.device.deviceId)})),t}async getDeviceById(e){const t=(await this.enumerateDevices(!0,!0,!0)).find((n=>n.deviceId===e));if(!t)throw new ce(U.DEVICE_NOT_FOUND,"deviceId: ".concat(e));return t}async init(){this.state=HE.INITING;try{await this.updateDevicesInfo(),this.state=HE.INITEND}catch(e){throw R.warning("Device Detection functionality cannot start properly.",e.toString()),this.state=HE.IDLE,(typeof isSecureContext=="boolean"?isSecureContext:location.protocol==="https:"||location.protocol==="file:"||location.hostname==="localhost"||location.hostname==="127.0.0.1"||location.hostname==="::1")||new ce(U.WEB_SECURITY_RESTRICT,"Your context is limited by web security, please try using https protocol or localhost.").throw(),e}}async updateDevicesInfo(){const e=await this.enumerateDevices(!0,!0,!0),t=Date.now(),n=[];if(e[0]&&e[0].label&&this.checkdeviceMatched===!1){this.checkdeviceMatched=!0;const i=e.find((o=>o.kind==="audioinput"&&o.deviceId==="default")),s=e.find((o=>o.kind==="audiooutput"&&o.deviceId==="default"));i&&s?s.groupId===i.groupId?R.debug("[device-check] default input ".concat(i.label," and output ").concat(s.label," is the same group")):R.debug("[device-check] default input ".concat(i.label," and output ").concat(s.label," is not the same group")):R.debug("[device-check] default input or output not found")}const r=this.checkMediaDeviceInfoIsOk(e);if(e.forEach((i=>{if(!i.deviceId)return;const s=this.deviceInfoMap.get("".concat(i.kind,"_").concat(i.deviceId));if((s?s.state:"INACTIVE")!=="ACTIVE"){const o={initAt:t,updateAt:t,device:i,state:"ACTIVE"};this.deviceInfoMap.set("".concat(i.kind,"_").concat(i.deviceId),o),n.push(o)}s&&(s.updateAt=t)})),this.deviceInfoMap.forEach(((i,s)=>{i.state==="ACTIVE"&&i.updateAt!==t&&(i.state="INACTIVE",n.push(i))})),this.state!==HE.INITEND)return r.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),void(r.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0));n.forEach((i=>{switch(i.device.kind){case"audioinput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(vh.RECORDING_DEVICE_CHANGED,i);break;case"videoinput":this.lastAccessCameraPermission&&this.isAccessCameraPermission&&this.emit(vh.CAMERA_DEVICE_CHANGED,i);break;case"audiooutput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(vh.PLAYOUT_DEVICE_CHANGED,i)}})),r.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),r.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0)}checkMediaDeviceInfoIsOk(e){const t=e.filter((i=>i.kind==="audioinput")),n=e.filter((i=>i.kind==="videoinput")),r={audio:!1,video:!1};for(const i of t)if(i.label&&i.deviceId){r.audio=!0;break}for(const i of n)if(i.label&&i.deviceId){r.video=!0;break}return r}};let Sb=!1;const Ls=new class extends Pn{constructor(){super(...arguments),ne(this,"onAutoplayFailed",void 0),ne(this,"onAudioAutoplayFailed",void 0)}};function IL(){if(xt(),!Sb){const e=t=>{t.preventDefault(),Sb=!1,LE()?document.body.removeEventListener("click",e,!0):(document.body.removeEventListener("touchstart",e,!0),document.body.removeEventListener("mousedown",e,!0))};Sb=!0,LE()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0)),R.info("detect media autoplay failed, document: https://docs.agora.io/cn/Voice/autoplay_policy_web_ng?platform=Web"),Ls.onAutoplayFailed?Ls.onAutoplayFailed():Ls.onAudioAutoplayFailed?R.warning(`AgoraRTC.onAudioAutoplayFailed has been deprecated in favor of AgoraRTC.onAutoplayFailed.

  Please refer to the Agora document to migrate the newer API, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`):R.warning(`We have detected a media autoplay failed event, and found out that you haven't implemented AgoraRTC.onAutoplayFailed callback yet.

  It will cause audio/video element not playing automatically on some browsers without user interaction, possibly hurting user experiences.

  Please refer to the Agora document to properly handle autoplay failed event, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`),Ls.emit("autoplay-failed")}}function AL(e,t,n,r){if(!e)return;const i=We.getBaseInfoBySessionId(e);if(!i)return;const s=i.info,o=Date.now(),c=mn(mn({},s),{},{vid:s.vid===void 0?0:Number(s.vid),lts:o,elapse:o-i.startTime,cbRegistered:Ls.onAutoplayFailed||Ls.onAudioAutoplayFailed?1:-1,errorMsg:n,mediaType:t,trackId:r,extend:void 0});We.send({type:bn.AUTOPLAY_FAILED,data:c},!0)}const mY=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","error"],Ui=new class{constructor(){ne(this,"onAutoplayFailed",void 0),ne(this,"elementMap",new Map),ne(this,"elementStateMap",new Map),ne(this,"elementsNeedToResume",[]),ne(this,"sinkIdMap",new Map),ne(this,"autoResumeAfterInterruption",(e=>{Array.from(this.elementMap.entries()).forEach((t=>{let[n,r]=t;const i=this.elementStateMap.get(n),s=r.srcObject.getAudioTracks()[0],o=s&&s.readyState;if(R.debug("resume after interrupted, ele: ".concat(i," audio: ").concat(o," ").concat(e)),o==="live"){if(e)return r.pause(),void r.play();if(rn.curState==="running")return Sf()?(r.pause(),void r.play()):void(i&&i==="paused"&&r.play())}}))})),ne(this,"autoResumeAfterInterruptionOnIOS15_16",(()=>{Array.from(this.elementMap.entries()).forEach((e=>{let[t,n]=e;const r=n.srcObject.getAudioTracks()[0];r&&r.readyState==="live"&&(R.debug("auto resume after interruption inside autoResumeAfterInterruptionOnIOS15"),n.pause(),n.play())}))})),this.autoResumeAudioElement(),rn.on(Lr.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),rn.on(Lr.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),rn.on(Lr.STATE_CHANGE,(()=>{ni()&&rn.prevState==="suspended"&&rn.curState==="running"&&this.autoResumeAfterInterruption()}))}async setSinkID(e,t){const n=this.elementMap.get(e);if(this.sinkIdMap.set(e,t),n)try{await n.setSinkId(t)}catch(r){throw new ce(U.PERMISSION_DENIED,"can not set sink id: "+r.toString())}}play(e,t,n,r){if(this.elementMap.has(t))return;const i=document.createElement("audio");i.autoplay=!0,i.srcObject=new MediaStream([e]),this.bindAudioElementEvents(t,i),this.elementMap.set(t,i),this.elementStateMap.set(t,qr.INIT),this.setVolume(t,n);const s=this.sinkIdMap.get(t);if(s)try{i.setSinkId(s).catch((c=>{R.warning("[".concat(t,"] set sink id failed"),c.toString())}))}catch(c){R.warning("[".concat(t,"] set sink id failed"),c.toString())}const o=i.play();o&&o.then&&o.catch((c=>{r&&AL(r,"audio",c.message,t),R.warning("audio element play warning",c.toString()),this.elementMap.has(t)&&c.name==="NotAllowedError"&&(R.warning("detected audio element autoplay failed"),this.elementsNeedToResume.push(i),NS((()=>{this.onAutoplayFailed&&this.onAutoplayFailed(),IL()})))}))}updateTrack(e,t){const n=this.elementMap.get(e);n&&(n.srcObject=new MediaStream([t]))}isPlaying(e){return this.elementMap.has(e)&&this.elementStateMap.get(e)==="playing"}setVolume(e,t){const n=this.elementMap.get(e);n&&(t=Math.max(0,Math.min(100,t)),n.volume=t/100)}stop(e){const t=this.elementMap.get(e);if(this.sinkIdMap.delete(e),!t)return;const n=this.elementsNeedToResume.indexOf(t);this.elementsNeedToResume.splice(n,1),t.srcObject=null,t.remove(),this.elementMap.delete(e),this.elementStateMap.delete(e)}bindAudioElementEvents(e,t){mY.forEach((n=>{t.addEventListener(n,(r=>{const i=this.elementStateMap.get(e),s=r.type==="pause"?"paused":r.type;if(R.debug("[".concat(e,"] audio-element-status change ").concat(i," => ").concat(s)),r.type==="error"){const o=t?.error;o&&R.error("[".concat(e,"] media error, code: ").concat(o.code,", message: ").concat(o.message))}this.elementStateMap.set(e,s)}))}))}getPlayerState(e){return this.elementStateMap.get(e)||"uninit"}autoResumeAudioElement(){const e=()=>{this.elementsNeedToResume.forEach((t=>{t.play().then((n=>{R.debug("Auto resume audio element success")})).catch((n=>{R.warning("Auto resume audio element failed!",n)}))})),this.elementsNeedToResume=[]};new Pe((t=>{document.body?t():window.addEventListener("load",(()=>t()))})).then((()=>{LE()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0))}))}};function jn(){return function(e,t,n){const r=n.value;return typeof r=="function"&&(n.value=function(){this._isClosed&&new ce(U.INVALID_OPERATION,"[".concat(this.getTrackId(),"] cannot operate a closed track")).print("warning",R);for(var i=arguments.length,s=new Array(i),o=0;o<i;o++)s[o]=arguments[o];const c=r.apply(this,s);return c instanceof Pe?new Pe(((l,h)=>{c.then(l).catch(h)})):c}),n}}class NL extends Pn{constructor(t){super(),ne(this,"name","VideoProcessorDestination"),ne(this,"ID","0"),ne(this,"_source",void 0),ne(this,"videoContext",void 0),ne(this,"inputTrack",void 0),this.videoContext=t}get kind(){return"video"}get enabled(){return!0}pipe(){throw new ce(U.NOT_SUPPORTED,"VideoProcessor cannot pipe to any other Processor")}unpipe(){throw new ce(U.NOT_SUPPORTED,"VideoProcessor cannot unpipe to any other Processor")}enable(){}disable(){}updateInput(t){if(t.context!==this.videoContext)throw new Error(`ProcessorContext passed to VideoTrack.processorDestination doesn't match it's belonging VideoTrack's context.
Probably you are making pipeline like this:
videoTrack1.pipe(processor).pipe(videoTrack2.processorDestination).`);t.track&&t.track!==this.inputTrack&&(this.videoContext.chained=!0,this.inputTrack=t.track,this.emit(wi.ON_TRACK,t.track))}reset(){this.inputTrack=void 0,this.videoContext.chained=!1,this.emit(wi.ON_TRACK,void 0)}}class OL extends Pn{set chained(t){this._chained=t}get chained(){return this._chained}constructor(t,n){super(),ne(this,"constraintsMap",new Map),ne(this,"statsRegistry",[]),ne(this,"usageRegistry",[]),ne(this,"trackId",void 0),ne(this,"direction",void 0),ne(this,"_chained",!1),this.trackId=t,this.direction=n}async getConstraints(){return await Fr(this,Os.REQUEST_CONSTRAINTS)}async requestApplyConstraints(t,n){var r;return R.info("processor ".concat(n.name," requestApplyConstraints for ").concat(this.trackId)),t&&this.constraintsMap.set(n,t),cn(this,Os.REQUEST_UPDATE_CONSTRAINTS,Array.from(ps(r=this.constraintsMap).call(r)))}async requestRevertConstraints(t){var n;if(this.constraintsMap.has(t))return R.info("processor ".concat(t.name," requestRevertConstraints for ").concat(this.trackId)),this.constraintsMap.delete(t),cn(this,Os.REQUEST_UPDATE_CONSTRAINTS,Array.from(ps(n=this.constraintsMap).call(n)))}registerStats(t,n,r){this.statsRegistry.find((i=>i.processorID===t.ID&&i.processorName===t.name&&i.type===n))||this.statsRegistry.push({processorName:t.name,processorID:t.ID,type:n,cb:r})}unregisterStats(t,n){const r=this.statsRegistry.findIndex((i=>i.processorID===t.ID&&i.processorName===t.name&&i.type===n));r!==-1&&this.statsRegistry.splice(r,1)}gatherStats(){const t=[];for(const{processorID:n,processorName:r,type:i,cb:s}of this.statsRegistry)try{const o=s();t.push({processorID:n,processorName:r,type:i,stats:o})}catch(o){R.error(new ce(U.UNEXPECTED_ERROR,o.message))}return t}registerUsage(t,n){this.usageRegistry.find((r=>r.processorID===t.ID&&r.processorName===t.name))||this.usageRegistry.push({processorID:t.ID,processorName:t.name,cb:n})}unregisterUsage(t){const n=this.usageRegistry.findIndex((r=>r.processorID===t.ID&&r.processorName===t.name));n!==-1&&this.usageRegistry.splice(n,1)}async gatherUsage(){const t=[];if(!this.chained)return[];for(const{cb:n}of this.usageRegistry)try{let r=n();r instanceof Pe&&(r=await r),t.push(mn(mn({},r),{},{direction:this.direction}))}catch(r){R.error("gather extension usage error",r)}return t}getDirection(){return this.direction}}class PL extends Pn{constructor(t){super(),ne(this,"name","AudioProcessorDestination"),ne(this,"ID","0"),ne(this,"inputTrack",void 0),ne(this,"inputNode",void 0),ne(this,"audioProcessorContext",void 0),ne(this,"_source",void 0),this.audioProcessorContext=t}get kind(){return"audio"}get enabled(){return!0}pipe(){throw new ce(U.NOT_SUPPORTED,"AudioProcessorDestination cannot pipe to any other Processor")}unpipe(){throw new ce(U.NOT_SUPPORTED,"AudioProcessor cannot unpipe to any other Processor")}enable(){}disable(){}reset(){this.inputTrack=void 0,this.inputNode=void 0,this.audioProcessorContext.chained=!1,this.emit(wi.ON_TRACK,void 0),this.emit(wi.ON_NODE,void 0)}updateInput(t){if(t.context!==this.audioProcessorContext)throw new Error(`ProcessorContext passed to AudioTrack.processorDestination doesn't match it's belonging AudioTrack's context.
        Probably you are making pipeline like this: audioTrack1.pipe(processor).pipe(audioTrack2.processorDestination).`);t.track&&this.inputTrack!==t.track&&(this.audioProcessorContext.chained=!0,this.inputTrack=t.track,this.emit(wi.ON_TRACK,this.inputTrack)),t.node&&this.inputNode!==t.node&&(this.audioProcessorContext.chained=!0,this.inputNode=t.node,this.emit(wi.ON_NODE,this.inputNode))}}class DL extends Pn{set chained(t){this._chained=t}get chained(){return this._chained}constructor(t,n,r){super(),ne(this,"constraintsMap",new Map),ne(this,"statsRegistry",[]),ne(this,"audioContext",void 0),ne(this,"trackId",void 0),ne(this,"direction",void 0),ne(this,"usageRegistry",[]),ne(this,"_chained",!1),this.audioContext=t,this.trackId=n,this.direction=r}async getConstraints(){return Fr(this,Os.REQUEST_CONSTRAINTS)}getAudioContext(){return this.audioContext}async requestApplyConstraints(t,n){var r;return R.info("processor ".concat(n.name," requestApplyConstraints for ").concat(this.trackId)),t&&this.constraintsMap.set(n,t),cn(this,Os.REQUEST_UPDATE_CONSTRAINTS,Array.from(ps(r=this.constraintsMap).call(r)))}async requestRevertConstraints(t){var n;if(this.constraintsMap.has(t))return this.constraintsMap.delete(t),cn(this,Os.REQUEST_UPDATE_CONSTRAINTS,Array.from(ps(n=this.constraintsMap).call(n)))}registerStats(t,n,r){this.statsRegistry.find((i=>i.processorID===t.ID&&i.processorName===t.name&&i.type===n))||this.statsRegistry.push({processorName:t.name,processorID:t.ID,type:n,cb:r})}unregisterStats(t,n){const r=this.statsRegistry.findIndex((i=>i.processorID===t.ID&&i.processorName===t.name&&i.type===n));r!==-1&&this.statsRegistry.splice(r,1)}gatherStats(){const t=[];for(const{processorID:n,processorName:r,type:i,cb:s}of this.statsRegistry)try{const o=s();t.push({processorID:n,processorName:r,type:i,stats:o})}catch(o){R.error(new ce(U.UNEXPECTED_ERROR,o.message))}return t}registerUsage(t,n){this.usageRegistry.find((r=>r.processorID===t.ID&&r.processorName===t.name))||this.usageRegistry.push({processorID:t.ID,processorName:t.name,cb:n})}unregisterUsage(t){const n=this.usageRegistry.findIndex((r=>r.processorID===t.ID&&r.processorName===t.name));n!==-1&&this.usageRegistry.splice(n,1)}async gatherUsage(){const t=[];if(!this.chained)return[];for(const{cb:n}of this.usageRegistry)try{let r=n();r instanceof Pe&&(r=await r),t.push(mn(mn({},r),{},{direction:this.direction}))}catch(r){R.error("gather extension usage error",r)}return t}getDirection(){return this.direction}}class Tb extends Pn{get isPlayed(){return!0}get isFreeze(){return!1}constructor(){super(),ne(this,"context",void 0),ne(this,"processSourceNode",void 0),ne(this,"outputTrack",void 0),ne(this,"processedNode",void 0),ne(this,"clonedTrack",void 0),ne(this,"outputNode",void 0),this.outputNode=new _Y}setVolume(){}createOutputTrack(){throw new ce(U.NOT_SUPPORTED,"can not create output MediaStreamTrack when WebAudio disabled")}getOriginVolumeLevel(){return 0}getAccurateVolumeLevel(){return 0}stopGetAudioBuffer(){}startGetAudioBuffer(){}play(){}stop(){}destroy(){}updateTrack(){}updateOriginTrack(){}createMediaStreamSourceNode(){}}class _Y{disconnect(){}connect(){}}function kL(e){return new Pe(((t,n)=>{let r=!1;const i=document.createElement("video");i.setAttribute("autoplay",""),i.setAttribute("muted",""),i.muted=!0,i.autoplay=!0,i.setAttribute("playsinline",""),i.setAttribute("style","position: fixed; top: 0; left: 0; width: 1px; height: 1px"),document.body.appendChild(i);const s=ni()?"canplay":"playing";i.addEventListener(s,(()=>{const o=i.videoWidth,c=i.videoHeight;!o&&xn()||(r=!0,i.srcObject=null,i.remove(),t([o,c]))})),i.srcObject=new MediaStream([e]),i.play().catch(OS),setTimeout((()=>{r||(i.srcObject=null,i.remove(),t([i.videoWidth,i.videoHeight]))}),4e3)}))}function BS(e){const t={};e.facingMode&&(t.facingMode=e.facingMode),e.cameraId&&(t.deviceId={exact:e.cameraId});const n=Bo(e.encoderConfig);return n.width!=null&&(t.width=n.width),n.height!=null&&(t.height=n.height),!P1()&&n.frameRate&&(t.frameRate=n.frameRate),R1()&&typeof t.frameRate=="object"&&(t.frameRate.max=60),xn()&&(t.frameRate={ideal:30,max:30}),t}function LL(e){const t={};return P1()||(e.AGC!==void 0&&(t.autoGainControl=e.AGC),e.AEC!==void 0&&(t.echoCancellation=e.AEC),e.ANS!==void 0&&(t.noiseSuppression=e.ANS,fl()&&e.ANS&&(t.googHighpassFilter=e.ANS))),t}function xL(e){const t=LL(e);if(e.encoderConfig){const n=VS(e.encoderConfig);t.channelCount=n.stereo?2:1,t.sampleRate=n.sampleRate,t.sampleSize=n.sampleSize}return e.microphoneId&&(t.deviceId={exact:e.microphoneId}),IS()&&(t.sampleRate=void 0),t}const EY=e=>{const t=e._encoderConfig;if(!t)return;const{frameRate:n,width:r,height:i}=e.getMediaStreamTrackSettings();let{frameRate:s=n,width:o=r,height:c=i}=t;if(!s||!o||!c)return;o=Cf(o),c=Cf(c),s=Cf(s);const{max:l,min:h}=(function(v,O,I){const N=200*Math.pow(I/15,.6)*Math.pow(v*O/640/360,.75);return{min:Math.floor(N),max:Math.floor(4*N)}})(o,c,s),{bitrateMax:p,bitrateMin:E}=t||{};p||R.debug("calculate bitrate: [w: ".concat(o,", h: ").concat(c,", fps: ").concat(s,"] => [brMax: ").concat(p,", brMin: ").concat(E,"]"));const{maxFramerate:g}=F("ENCODER_CONFIG_LIMIT");return g&&typeof g=="number"&&(s=Math.min(s,g)),{frameRate:s,bitrateMax:p||l,bitrateMin:E||h,scaleResolutionDownBy:1,scale:0}},ML=async(e,t,n)=>await(async(r,i,s)=>{const o=(function(h){const p=[];for(let E=0;E<h.length;E+=2)p.push(parseInt(h.slice(E,E+2),16));return Uint8Array.from(p)})(Y1(""+i+s)).slice(0,16),c=o.slice(0,12),l=await window.crypto.subtle.importKey("raw",o,"AES-GCM",!0,["encrypt"]);return new Uint8Array(await window.crypto.subtle.encrypt({name:"AES-GCM",iv:c},l,r))})(e.buffer,t,n),Rb=e=>{const t=document.createElement("canvas");return t.width=2,t.height=2,new Pe(((n,r)=>{t.toBlob((async i=>{if(t.remove(),i){const s=await UL(i);n({buffer:s,width:t.width,height:t.height})}else r(new ce(U.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))}),e,1)}))},UL=async e=>{const t=await e.arrayBuffer();return new Uint8Array(t)};var VL,jL,FL,BL,WL,GL,HL,KL,zL,YL,qL,XL,JL,QL,ZL,$L,ex,tx,Dn,nx,rx,ix,sx,ox,ax,Cc,cx,lx,dx,ux,hx,px,fx,mx,_x,Ex,gx,vx,yx,Wr;let Fn=(VL=et({argsMap:(e,t)=>[e.getTrackId(),t],throttleTime:300}),jL=et({argsMap:(e,t)=>[e.getTrackId(),t]}),FL=jn(),BL=wf("LocalAudioTrack","_enabledMutex"),WL=et({argsMap:(e,t)=>[e.getTrackId(),t]}),GL=jn(),HL=wf("LocalAudioTrack","_enabledMutex"),KL=et({argsMap:(e,t)=>[e.getTrackId(),t]}),zL=jn(),YL=jn(),qL=jn(),XL=et({argsMap:e=>[e.getTrackId()]}),JL=jn(),QL=et({argsMap:e=>[e.getTrackId()]}),ZL=jn(),$L=et({argsMap:e=>[e.getTrackId()]}),ex=et({argsMap:(e,t)=>[e.getTrackId(),t.name]}),tx=et({argsMap:e=>[e.getTrackId()]}),Lt((Dn=class extends kf{get _source(){return this.initWebAudio()}set _source(e){this._trackSource=e}get processorContext(){return this._processorContext||(this._processorContext=this.initProcessor().processorContext),this._processorContext}get processorDestination(){return this._processorDestination||(this._processorDestination=this.initProcessor().processorDestination),this._processorDestination}get isPlaying(){return this._useAudioElement?Ui.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"LocalAudioTrack"}constructor(e,t,n,r){super(e,n),ne(this,"trackMediaType",Df.AUDIO),ne(this,"_encoderConfig",void 0),ne(this,"_trackSource",void 0),ne(this,"metadata",[]),ne(this,"_enabled",!0),ne(this,"_volume",100),ne(this,"_useAudioElement",!0),ne(this,"_bypassWebAudio",!1),ne(this,"processor",void 0),ne(this,"_processorContext",void 0),ne(this,"_processorDestination",void 0),ne(this,"_getOriginVolumeLevel",void 0),this._encoderConfig=t,this._getOriginVolumeLevel=!!r,this._trackSource=new Tb,F("DISABLE_WEBAUDIO")&&(this._bypassWebAudio=!0),F("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1),Vr()&&!Ps?setTimeout((()=>this.initWebAudio())):this.initWebAudio()}setVolume(e){on(e,"volume",0,1e3),this._volume=e,this._source.setVolume(e/100),this._useAudioElement&&Ui.setVolume(this.getTrackId(),e);try{if(this._bypassWebAudio)return void R.debug("[".concat(this.getTrackId(),"] setVolume returned because no pass through WebAudio."));const t=this._source.createOutputTrack();this._mediaStreamTrack!==t&&(this._mediaStreamTrack=t,cn(this,Ve.NEED_REPLACE_TRACK,this).then((()=>{R.debug("[".concat(this.getTrackId(),"] replace web audio track success"))})).catch((n=>{R.warning("[".concat(this.getTrackId(),"] replace web audio track failed"),n)})))}catch{}}getVolumeLevel(){return this._muted&&this.enabled&&this._getOriginVolumeLevel?this._source.getOriginVolumeLevel():this._source.getAccurateVolumeLevel()}async setPlaybackDevice(e){if(!this._useAudioElement||!hL())throw new ce(U.NOT_SUPPORTED,"your browser does not support setting the audio output device");await Ui.setSinkID(this.getTrackId(),e)}async setEnabled(e,t,n){return this._setEnabled(e,t,n)}async _setEnabled(e,t,n){if(!n){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(R.info("[".concat(this.getTrackId(),"] start setEnabled"),e),e){this._originMediaStreamTrack.enabled=!0;try{n||(this._enabled=!0),await cn(this,Ve.NEED_ENABLE_TRACK,this),R.info("[".concat(this.getTrackId(),"] setEnabled to ").concat(e," success"))}catch(r){throw n||(this._enabled=!1),R.error("[".concat(this.getTrackId(),"] setEnabled to true error"),r.toString()),r}}else{this._originMediaStreamTrack.enabled=!1,n||(this._enabled=!1);try{await cn(this,Ve.NEED_DISABLE_TRACK,this)}catch(r){throw n||(this._enabled=!0),R.error("[".concat(this.getTrackId(),"] setEnabled to false error"),r.toString()),r}}}async setMuted(e){e!==this._muted&&(this.stateCheck("muted",e),this._muted=e,this._originMediaStreamTrack.enabled=!e,R.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(e)),e?await cn(this,Ve.NEED_MUTE_TRACK,this):await cn(this,Ve.NEED_UNMUTE_TRACK,this))}getStats(){return wd((()=>{R.warning("[deprecated] LocalAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalAudioStats instead")}),"localAudioTrackGetStatsWarning"),Is(this,Ve.GET_STATS)||mn({},mb)}setAudioFrameCallback(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!e)return this._source.removeAllListeners(Ns.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(t),this._source.removeAllListeners(Ns.ON_AUDIO_BUFFER),this._source.on(Ns.ON_AUDIO_BUFFER,(n=>e(n)))}play(){R.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?(R.debug("[".concat(this.getTrackId(),"] start audio playback in element")),Ui.play(this._mediaStreamTrack,this.getTrackId(),this._volume)):this._source.play()}stop(){R.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?Ui.stop(this.getTrackId()):this._source.stop()}close(){super.close(),this._processorDestination&&this.unbindProcessorDestinationEvents(this._processorDestination),this._processorContext&&this.unbindProcessorContextEvents(this._processorContext),this.unpipe(),this._processorDestination&&this._processorDestination._source&&this._processorDestination._source.unpipe(),this._source.destroy()}_updatePlayerSource(){let e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];R.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&Ui.updateTrack(this.getTrackId(),this._mediaStreamTrack)}async _updateOriginMediaStreamTrack(e,t){this._originMediaStreamTrack!==e&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),t&&this._originMediaStreamTrack.stop()),e.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=e,this._muted&&(this._originMediaStreamTrack.enabled=!1),this.processor&&this._processorContext&&this.processor.updateInput({track:e,context:this._processorContext}),this._mediaStreamTrack!==this._source.outputTrack?(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await cn(this,Ve.NEED_REPLACE_TRACK,this)):this._source.updateTrack(this._originMediaStreamTrack),this._getOriginVolumeLevel&&this._source.updateOriginTrack(e))}renewMediaStreamTrack(e){return Pe.resolve(void 0)}pipe(e){if(this._bypassWebAudio)throw new ce(U.INVALID_OPERATION,"Can not process AudioTrack when bypassWebAudio set to true.");if(this.processor===e)return e;if(e._source)throw new ce(U.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(!this.processor)return;const t=this.processor;(e=this._source.processSourceNode)===null||e===void 0||e.disconnect(),this.processor._source=!1,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(e){e.on(wi.ON_TRACK,(async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(t),await cn(this,Ve.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await cn(this,Ve.NEED_REPLACE_TRACK,this))})),e.on(wi.ON_NODE,(t=>{this._source.processedNode=t}))}unbindProcessorDestinationEvents(e){e.removeAllListeners(wi.ON_TRACK),e.removeAllListeners(wi.ON_NODE)}bindProcessorContextEvents(e){e.on(Os.REQUEST_CONSTRAINTS,(async t=>{t(this._originMediaStreamTrack.getSettings())}))}unbindProcessorContextEvents(e){e.removeAllListeners(Os.REQUEST_CONSTRAINTS)}initWebAudio(){return this._trackSource instanceof Tb&&(this._trackSource=new TL(this._mediaStreamTrack,!1,this._getOriginVolumeLevel?this._mediaStreamTrack:void 0)),this._trackSource}initProcessor(){const e=new DL(this._source.context,this.getTrackId(),"local"),t=new PL(e);return this._processorContext=e,this._processorDestination=t,this.bindProcessorContextEvents(e),this.bindProcessorDestinationEvents(t),this._source.on(Ns.UPDATE_SOURCE,(()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:e})})),this._useAudioElement&&(this._useAudioElement=!1,this.isPlaying&&(Ui.stop(this.getTrackId()),this._source.play()),cn(this,Ve.NEED_REPLACE_MIXING_TRACK,this).then((()=>{R.debug("[".concat(this.getTrackId(),"] replace from origin track to web audio track success"))})).catch((n=>{R.warning("[".concat(this.getTrackId(),"] replace from origin track to web audio track failed"),n)}))),{processorContext:e,processorDestination:t}}}).prototype,"setVolume",[VL],Object.getOwnPropertyDescriptor(Dn.prototype,"setVolume"),Dn.prototype),Lt(Dn.prototype,"setPlaybackDevice",[jL,FL],Object.getOwnPropertyDescriptor(Dn.prototype,"setPlaybackDevice"),Dn.prototype),Lt(Dn.prototype,"setEnabled",[BL,WL,GL],Object.getOwnPropertyDescriptor(Dn.prototype,"setEnabled"),Dn.prototype),Lt(Dn.prototype,"setMuted",[HL,KL,zL],Object.getOwnPropertyDescriptor(Dn.prototype,"setMuted"),Dn.prototype),Lt(Dn.prototype,"getStats",[YL],Object.getOwnPropertyDescriptor(Dn.prototype,"getStats"),Dn.prototype),Lt(Dn.prototype,"setAudioFrameCallback",[qL],Object.getOwnPropertyDescriptor(Dn.prototype,"setAudioFrameCallback"),Dn.prototype),Lt(Dn.prototype,"play",[XL,JL],Object.getOwnPropertyDescriptor(Dn.prototype,"play"),Dn.prototype),Lt(Dn.prototype,"stop",[QL,ZL],Object.getOwnPropertyDescriptor(Dn.prototype,"stop"),Dn.prototype),Lt(Dn.prototype,"close",[$L],Object.getOwnPropertyDescriptor(Dn.prototype,"close"),Dn.prototype),Lt(Dn.prototype,"pipe",[ex],Object.getOwnPropertyDescriptor(Dn.prototype,"pipe"),Dn.prototype),Lt(Dn.prototype,"unpipe",[tx],Object.getOwnPropertyDescriptor(Dn.prototype,"unpipe"),Dn.prototype),Dn),KE=(nx=et({argsMap:(e,t)=>[e.getTrackId(),t]}),rx=jn(),ix=wf("MicrophoneAudioTrack","_enabledMutex"),sx=et({argsMap:(e,t,n)=>[e.getTrackId(),t,n]}),ox=jn(),ax=et({argsMap:e=>[e.getTrackId()]}),Lt((Cc=class extends Fn{get __className__(){return"MicrophoneAudioTrack"}constructor(e,t,n,r){super(e,t.encoderConfig?VS(t.encoderConfig):{},r,F("GET_VOLUME_OF_MUTED_AUDIO_TRACK")),ne(this,"_config",void 0),ne(this,"_deviceName","default"),ne(this,"_constraints",void 0),ne(this,"_originalConstraints",void 0),ne(this,"_enabled",!0),this._config=t,this._constraints=n,this._originalConstraints=n,this._deviceName=e.label,typeof t.bypassWebAudio=="boolean"&&(this._bypassWebAudio=t.bypassWebAudio),(Sf()||G0())&&rn.bindInterruptDetectorTrack(this)}async setDevice(e){if(R.info("[".concat(this.getTrackId(),"] start set device to ").concat(e)),this._enabled)try{const t=await ks.getDeviceById(e),n={};n.audio=mn({},this._constraints),n.audio.deviceId={exact:e},this._originMediaStreamTrack.stop();let r=null;try{r=await Ds(n,this.getTrackId())}catch(i){throw R.error("[".concat(this.getTrackId(),"] setDevice failed"),i.toString()),r=await Ds({audio:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(r.getAudioTracks()[0],!1),i}await this._updateOriginMediaStreamTrack(r.getAudioTracks()[0],!1),this._deviceName=t.label,this._config.microphoneId=e,this._constraints.deviceId={exact:e}}catch(t){throw R.error("[".concat(this.getTrackId(),"] setDevice error"),t.toString()),t}else try{const t=await ks.getDeviceById(e);this._deviceName=t.label,this._config.microphoneId=e,this._constraints.deviceId={exact:e}}catch(t){throw R.error("[".concat(this.getTrackId(),"] setDevice error"),t.toString()),t}R.info("[".concat(this.getTrackId(),"] set device to ").concat(e," success"))}async setEnabled(e,t,n){if(t)return R.debug("[".concat(this.getTrackId(),"] setEnabled false (do not close microphone)")),await super._setEnabled(e);if(!n){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(R.info("[".concat(this.getTrackId(),"] start setEnabled"),e),F("AUTO_RESET_AUDIO_ROUTE")&&(ni()||Vo())){const o=navigator.audioSession;o&&(e||(o.type="playback"),o.type="auto")}if(!e){var r;this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop(),(r=this._source.clonedTrack)===null||r===void 0||r.stop(),n||(this._enabled=!1);try{await cn(this,Ve.NEED_DISABLE_TRACK,this)}catch(o){throw R.error("[".concat(this.getTrackId(),"] setEnabled false failed"),o.toString()),o}return}const i=mn({},this._constraints),s=ks.searchDeviceIdByName(this._deviceName);s&&!i.deviceId&&(i.deviceId=s);try{n||(this._enabled=!0);const o=await Ds({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(o.getAudioTracks()[0],!1),await cn(this,Ve.NEED_ENABLE_TRACK,this)}catch(o){throw n||(this._enabled=!1),R.error("[".concat(this.getTrackId(),"] setEnabled true failed"),o.toString()),o}R.info("[".concat(this.getTrackId(),"] setEnabled success"))}close(){super.close(),(Sf()||G0())&&rn.unbindInterruptDetectorTrack(this)}onTrackEnded(){if((ni()||Vo())&&this._enabled&&!this._isClosed&&rn.duringInterruption){const e=async()=>{rn.off(Lr.IOS_INTERRUPTION_END,e),this._enabled&&!this._isClosed&&(R.debug("[".concat(this.getTrackId(),"] try capture microphone media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};rn.on(Lr.IOS_INTERRUPTION_END,e)}else R.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(Pf.TRACK_ENDED)}async renewMediaStreamTrack(e){const t=e||this._constraints,n=ks.searchDeviceIdByName(this._deviceName);if(n&&!t.deviceId&&(t.deviceId=n),this._constraints=t,this._enabled){this._originMediaStreamTrack.stop();const r=await Ds({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(r.getAudioTracks()[0],!0)}}bindProcessorContextEvents(e){super.bindProcessorContextEvents(e),e.on(Os.REQUEST_UPDATE_CONSTRAINTS,(async(t,n,r)=>{try{const i=Object.assign({},this._originalConstraints,...t);await this.renewMediaStreamTrack(i),n()}catch(i){r(i)}}))}unbindProcessorContextEvents(e){super.unbindProcessorContextEvents(e),e.removeAllListeners(Os.REQUEST_UPDATE_CONSTRAINTS)}}).prototype,"setDevice",[nx,rx],Object.getOwnPropertyDescriptor(Cc.prototype,"setDevice"),Cc.prototype),Lt(Cc.prototype,"setEnabled",[ix,sx,ox],Object.getOwnPropertyDescriptor(Cc.prototype,"setEnabled"),Cc.prototype),Lt(Cc.prototype,"close",[ax],Object.getOwnPropertyDescriptor(Cc.prototype,"close"),Cc.prototype),Cc),gY=(cx=et({argsMap:(e,t)=>[e.getTrackId(),t,e.duration]}),lx=jn(),dx=et({argsMap:e=>[e.getTrackId()]}),ux=jn(),hx=et({argsMap:e=>[e.getTrackId()]}),px=jn(),fx=et({argsMap:e=>[e.getTrackId()]}),mx=jn(),_x=et({argsMap:e=>[e.getTrackId()]}),Ex=jn(),gx=et({argsMap:e=>[e.getTrackId()]}),vx=et({argsMap:e=>[e.getTrackId()]}),yx=jn(),Lt((Wr=class extends Fn{get __className__(){return"BufferSourceAudioTrack"}constructor(e,t,n,r){super(t.createOutputTrack(),n,r),ne(this,"source",void 0),ne(this,"_bufferSource",void 0),this._useAudioElement=!1,this.source=e,this._bufferSource=t,this._bufferSource.on(Ns.AUDIO_SOURCE_STATE_CHANGE,(i=>{this.safeEmit(Pf.SOURCE_STATE_CHANGE,i)}));try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}}get currentState(){return this._bufferSource.currentState}get duration(){return this._bufferSource.duration}get playbackSpeed(){return this._bufferSource.playbackSpeed}getCurrentTime(){return this._bufferSource.currentTime}startProcessAudioBuffer(e){e&&this._bufferSource.updateOptions(e),this._bufferSource.startProcessAudioBuffer()}pauseProcessAudioBuffer(){this._bufferSource.pauseProcessAudioBuffer()}seekAudioBuffer(e){this._bufferSource.seekAudioBuffer(e)}resumeProcessAudioBuffer(){this._bufferSource.resumeProcessAudioBuffer()}stopProcessAudioBuffer(){this._bufferSource.stopProcessAudioBuffer()}close(){this.source=null,this._bufferSource.destroy(),super.close()}setAudioBufferPlaybackSpeed(e){on(e,"speed",0),this._bufferSource.setAudioBufferPlaybackSpeed(e)}}).prototype,"startProcessAudioBuffer",[cx,lx],Object.getOwnPropertyDescriptor(Wr.prototype,"startProcessAudioBuffer"),Wr.prototype),Lt(Wr.prototype,"pauseProcessAudioBuffer",[dx,ux],Object.getOwnPropertyDescriptor(Wr.prototype,"pauseProcessAudioBuffer"),Wr.prototype),Lt(Wr.prototype,"seekAudioBuffer",[hx,px],Object.getOwnPropertyDescriptor(Wr.prototype,"seekAudioBuffer"),Wr.prototype),Lt(Wr.prototype,"resumeProcessAudioBuffer",[fx,mx],Object.getOwnPropertyDescriptor(Wr.prototype,"resumeProcessAudioBuffer"),Wr.prototype),Lt(Wr.prototype,"stopProcessAudioBuffer",[_x,Ex],Object.getOwnPropertyDescriptor(Wr.prototype,"stopProcessAudioBuffer"),Wr.prototype),Lt(Wr.prototype,"close",[gx],Object.getOwnPropertyDescriptor(Wr.prototype,"close"),Wr.prototype),Lt(Wr.prototype,"setAudioBufferPlaybackSpeed",[vx,yx],Object.getOwnPropertyDescriptor(Wr.prototype,"setAudioBufferPlaybackSpeed"),Wr.prototype),Wr);class ar extends Fn{get __className__(){return"MixingAudioTrack"}get isActive(){for(const t of this.trackList)if(t._enabled&&!t._isClosed&&!t.muted)return!0;return!1}constructor(){const t=Lf().createMediaStreamDestination();super(t.stream.getAudioTracks()[0],void 0,ln(8,"track-mix-")),ne(this,"trackList",void 0),ne(this,"destNode",void 0),this._useAudioElement=!1;try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}this.destNode=t,this.trackList=[]}hasAudioTrack(t){return this.trackList.indexOf(t)!==-1}addAudioTrack(t){this.trackList.indexOf(t)===-1?(R.debug("add ".concat(t.getTrackId()," to mixing track")),t._source.outputNode.connect(this.destNode),this.trackList.push(t),this.updateEncoderConfig()):R.debug("track ".concat(t.getTrackId()," is already added"))}removeAudioTrack(t){if(this.trackList.indexOf(t)!==-1){R.debug("remove ".concat(t.getTrackId()," from mixing track"));try{t._source.outputNode.disconnect(this.destNode)}catch{}AS(this.trackList,t),this.updateEncoderConfig()}}updateEncoderConfig(){const t={};this.trackList.forEach((n=>{n._encoderConfig&&((n._encoderConfig.bitrate||0)>(t.bitrate||0)&&(t.bitrate=n._encoderConfig.bitrate),(n._encoderConfig.sampleRate||0)>(t.sampleRate||0)&&(t.sampleRate=n._encoderConfig.sampleRate),(n._encoderConfig.sampleSize||0)>(t.sampleSize||0)&&(t.sampleSize=n._encoderConfig.sampleSize),n._encoderConfig.stereo&&(t.stereo=!0))})),this._encoderConfig=t}_updateRtpTransceiver(t){this._rtpTransceiver!==t&&(this._rtpTransceiver=t,this.trackList.forEach((n=>{n instanceof ar?n.emit(gh.TRANSCEIVER_UPDATED,t):n._updateRtpTransceiver(t)})))}}class vY extends SL{set currentState(t){t!==this._currentState&&(this._currentState=t,this.safeEmit(Ns.AUDIO_SOURCE_STATE_CHANGE,this._currentState))}get currentState(){return this._currentState}constructor(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),ne(this,"audioBuffer",void 0),ne(this,"sourceNode",void 0),ne(this,"startPlayTime",0),ne(this,"startPlayOffset",0),ne(this,"pausePlayTime",0),ne(this,"options",void 0),ne(this,"currentLoopCount",0),ne(this,"currentPlaybackSpeed",100),ne(this,"_currentState","stopped"),this.audioBuffer=t,this.options=n,this.startPlayOffset=this.options.startPlayTime||0}createWebAudioDiagram(){return this.context.createGain()}get duration(){return this.audioBuffer?this.audioBuffer.duration:0}get playbackSpeed(){return this.currentPlaybackSpeed}get currentTime(){return this.audioBuffer?this.currentState==="stopped"?0:this.currentState==="paused"?this.pausePlayTime:((this.context.currentTime-this.startPlayTime)*(this.playbackSpeed/100)+this.startPlayOffset)%this.audioBuffer.duration:0}updateOptions(t){this.currentState==="stopped"?(this.options=t,this.startPlayOffset=this.options.startPlayTime||0):R.warning("can not set audio source options")}startProcessAudioBuffer(){this.sourceNode&&this.stopProcessAudioBuffer(),this.sourceNode=this.createSourceNode(),this.startSourceNode(),this.currentState="playing"}pauseProcessAudioBuffer(){this.sourceNode&&this.currentState==="playing"&&(this.pausePlayTime=this.currentTime,this.sourceNode.onended=null,this.sourceNode.stop(),this.sourceNode.buffer=null,this.sourceNode=this.createSourceNode(),this.currentState="paused")}seekAudioBuffer(t){this.sourceNode&&(this.sourceNode.onended=null,this.currentState==="playing"&&this.sourceNode.stop(),this.sourceNode=this.createSourceNode(),this.currentState==="playing"?(this.startPlayOffset=t,this.startSourceNode()):this.currentState==="paused"&&(this.pausePlayTime=t))}resumeProcessAudioBuffer(){this.currentState==="paused"&&this.sourceNode&&(this.startPlayOffset=this.pausePlayTime,this.pausePlayTime=0,this.startSourceNode(),this.currentState="playing")}stopProcessAudioBuffer(){if(this.sourceNode){this.sourceNode.onended=null;try{this.sourceNode.stop()}catch{}this.reset()}}destroy(){this.audioBuffer=null,super.destroy()}setAudioBufferPlaybackSpeed(t){this.sourceNode&&(this.currentState==="playing"&&(this.startPlayOffset=this.currentTime,this.startPlayTime=this.context.currentTime),this.sourceNode.playbackRate.value=t/100),this.currentPlaybackSpeed=t}startSourceNode(){this.sourceNode&&this.sourceNode.buffer&&(this.sourceNode.start(0,this.startPlayOffset),this.startPlayTime=this.context.currentTime,this.sourceNode.onended=this.handleSourceNodeEnded.bind(this))}createSourceNode(){const t=this.context.createBufferSource();return t.buffer=this.audioBuffer,t.loop=!!this.options.loop,t.connect(this.outputNode),t.playbackRate.value=this.currentPlaybackSpeed/100,t}handleSourceNodeEnded(){if(this.currentLoopCount+=1,this.options.cycle&&this.options.cycle>this.currentLoopCount)return this.startPlayOffset=0,this.sourceNode=void 0,void this.startProcessAudioBuffer();this.reset()}reset(){this.startPlayOffset=this.options.startPlayTime||0,this.currentState="stopped",this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=void 0),this.currentLoopCount=0}}const Sx=new Map;function Tx(e,t){if(e.length===0||t.length===0)return 1/0;const n=Q0(e),r=Q0(t);return Math.floor(r/n)}class Cb{get rendFrameRate(){const t=Math.max(1,Tx(this._render_interframe_delays_sizes,this._render_interframe_delays));return Math.floor(1e3/t)}get videoElementStatus(){return this._isInPage?this._videoElementStatus:qr.DESTROYED}set videoElementStatus(t){t!==this._videoElementStatus&&(R.debug("[".concat(this.trackId,"] video-element-status change ").concat(this._videoElementStatus," => ").concat(t)),this._videoElementStatus=t)}get videoState(){return this._videoState}set videoState(t){var n;t!==this._videoState&&(this._videoState=t,(n=this.onVideoStateChanged)===null||n===void 0||n.call(this,this.videoState))}constructor(t){ne(this,"trackId",void 0),ne(this,"config",void 0),ne(this,"onFirstVideoFrameDecoded",void 0),ne(this,"onFirstVideoFrameRender",void 0),ne(this,"onVideoStateChanged",void 0),ne(this,"freezeTimeCounterList",[]),ne(this,"renderFreezeAccTime",0),ne(this,"renderFreezeAccTime2",0),ne(this,"isKeepLastFrame",!1),ne(this,"isDestroyed",!1),ne(this,"timeUpdatedCount",0),ne(this,"freezeTime",0),ne(this,"playbackTime",0),ne(this,"lastTimeUpdatedTime",0),ne(this,"autoplayFailed",!1),ne(this,"videoTrack",void 0),ne(this,"videoElement",void 0),ne(this,"cacheVideoElement",void 0),ne(this,"internal",!1),ne(this,"_render_interframe_delays",[]),ne(this,"_render_interframe_delays_sizes",[]),ne(this,"_videoState",Rc.VideoStateStopped),ne(this,"videoElementCheckInterval",void 0),ne(this,"videoElementFreezeTimeout",void 0),ne(this,"_videoElementStatus",qr.NONE),ne(this,"_isInPage",!0),ne(this,"isGettingVideoDimensions",!1),ne(this,"startGetVideoDimensions",(()=>{const n=()=>{if(this.isGettingVideoDimensions=!0,this.videoElement.videoWidth*this.videoElement.videoHeight>4)return R.debug("[".concat(this.trackId,"] current video dimensions:"),this.videoElement.videoWidth,this.videoElement.videoHeight),void(this.isGettingVideoDimensions=!1);setTimeout(n,500)};!this.isGettingVideoDimensions&&n()})),ne(this,"autoResumeAfterInterruption",(()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&rn.curState==="running"&&(R.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(S1())),N1()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))})),ne(this,"handleVideoEvents",(n=>{switch(n.type){case"play":case"playing":n.type==="play"&&R.debug("[".concat(this.trackId,"] video element status: play")),this.startGetVideoDimensions(),this.videoElementStatus=qr.PLAYING;break;case"loadeddata":if(this.videoState=Rc.VideoStateStarting,this.onFirstVideoFrameRender&&this.onFirstVideoFrameRender(),this.onFirstVideoFrameDecoded&&this.onFirstVideoFrameDecoded(),this.cacheVideoElement){try{this.cacheVideoElement.srcObject=null,this.cacheVideoElement.remove()}catch{}this.cacheVideoElement=void 0}break;case"canplay":this.videoElementStatus=qr.CANPLAY;break;case"stalled":this.videoElementStatus=qr.STALLED;break;case"suspend":this.videoElementStatus=qr.SUSPEND;break;case"pause":this.videoElementStatus=qr.PAUSED,ni()||Vo()||Vr()&&this.autoplayFailed||!this.videoTrack||this.videoTrack.readyState!=="live"||(R.debug("[track-".concat(this.trackId,"] video element paused, auto resume")),this.videoElement.play());break;case"waiting":this.videoElementStatus=qr.WAITING;break;case"abort":this.videoElementStatus=qr.ABORT;break;case"ended":this.videoElementStatus=qr.ENDED;break;case"emptied":this.videoElementStatus=qr.EMPTIED;break;case"error":{const r=this.videoElement.error;r&&(this.videoElementStatus=qr.ERROR,R.error("[".concat(this.trackId,"] media error: ").concat(r.message," (").concat(r.code,")")));break}case"timeupdate":{const r=performance.now();if(this.timeUpdatedCount+=1,this.timeUpdatedCount<10)return void(this.lastTimeUpdatedTime=r);const i=r-this.lastTimeUpdatedTime,s=this.lastTimeUpdatedTime;if(this.lastTimeUpdatedTime=r,wc.lastVisibleTime<wc.lastHiddenTime||s<wc.lastHiddenTime||s<wc.lastVisibleTime||this.isSkipCalcRenderFreezeTime())return;for(i>F("VIDEO_FREEZE_DURATION")&&(this.freezeTime+=i),this.playbackTime+=i;this.playbackTime>=6e3;){this.playbackTime-=6e3;const o=Math.min(6e3,this.freezeTime);this.freezeTimeCounterList.push(o),this.freezeTime=Math.max(0,this.freezeTime-6e3)}break}}})),ne(this,"autoResumeAfterInterruptionOnIOS15_16",(()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&(R.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(S1())),N1()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))})),this.trackId=t.trackId,this.config=t,t.element instanceof HTMLVideoElement?this.videoElement=t.element:this.videoElement=document.createElement("video"),rn.on(Lr.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),rn.on(Lr.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16)}getVideoElement(){return this.videoElement}getContainerElement(){var t;return(t=this.videoElement.parentElement)!==null&&t!==void 0?t:void 0}updateConfig(t){this.config=t,this.trackId=t.trackId,t.element!==this.videoElement&&(this.destroy(),this.videoElement=t.element),this.videoTrack&&this.initVideoElement()}updateVideoTrack(t){this.videoTrack!==t&&(this.videoTrack=t,this.initVideoElement())}play(t){const n=this.videoElement.play();n&&n.catch&&n.catch((i=>{t&&AL(t,"video",i.message,this.trackId),i.name==="NotAllowedError"?(R.warning("detected video element autoplay failed",i),this.autoplayFailed=!0,this.handleAutoPlayFailed()):R.warning("[".concat(this.trackId,"] play warning: "),i)}));const r=xt();if((r.name==="Safari"&&Number(r.version)===15||Sf())&&n&&n.then){const i=()=>{this.config.mirror&&(this.videoElement.style.transform="rotateY(180deg)")};n.then(i).catch(i)}}getCurrentFrame(){const t=document.createElement("canvas");t.width=this.videoElement.videoWidth,t.height=this.videoElement.videoHeight;const n=t.getContext("2d");if(!n)return R.error("create canvas context failed!"),new ImageData(2,2);n.drawImage(this.videoElement,0,0,t.width,t.height);const r=n.getImageData(0,0,t.width,t.height);return t.remove(),r}async getCurrentFrameToUint8Array(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const r=document.createElement("canvas");r.width=this.videoElement.videoWidth,r.height=this.videoElement.videoHeight;const i=r.getContext("2d");return i?(i.drawImage(this.videoElement,0,0,r.width,r.height),new Pe(((s,o)=>{r.toBlob((async c=>{if(r.remove(),c){const l=await UL(c);s({buffer:l,width:r.width,height:r.height})}else o(new ce(U.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))}),t,n<0?.1:n>1?1:n)}))):await Rb(t)}destroy(){this.isDestroyed=!0,rn.off(Lr.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),rn.off(Lr.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),this.videoElement.srcObject=null,this.resetVideoElement(),this.freezeTimeCounterList=[],this.videoState=Rc.VideoStateStopped}initVideoElement(){if(this.videoElementStatus=qr.INIT,!this.videoElementCheckInterval&&(Rx.forEach((s=>{this.videoElement.addEventListener(s,this.handleVideoEvents)})),this.videoElementCheckInterval=window.setInterval((()=>{this._isInPage=(function(s){return s!==document.body&&document.body.contains(s)})(this.videoElement)}),1e3),F("ENABLE_VIDEO_FRAME_CALLBACK"))){var t,n;let s;const o=()=>{document.visibilityState==="visible"&&(document.removeEventListener("visibilitychange",o),this.videoElementFreezeTimeout=window.setTimeout(c,F("VIDEO_FREEZE_DURATION")))},c=()=>{this.videoElementFreezeTimeout=void 0,this.videoState===Rc.VideoStateDecoding&&(document.visibilityState==="visible"?this.videoState=Rc.VideoStateFrozen:document.addEventListener("visibilitychange",o))},l=(h,p)=>{if(this.videoElementStatus===qr.PLAYING){if(s){const v=p.presentationTime-s.presentationTime,O=p.presentedFrames-s.presentedFrames;this._render_interframe_delays_sizes.push(O),this._render_interframe_delays.push(v);const I=Q0(this._render_interframe_delays_sizes),N=I-this._render_interframe_delays_sizes[0];if(I>30&&N>5&&(this._render_interframe_delays_sizes.shift(),this._render_interframe_delays.shift()),this.videoState===Rc.VideoStateStarting&&(this.videoState=Rc.VideoStateDecoding),this.videoState===Rc.VideoStateDecoding&&this.onVideoStateChanged&&(this.videoElementFreezeTimeout&&window.clearTimeout(this.videoElementFreezeTimeout),this.videoElementFreezeTimeout=window.setTimeout(c,F("VIDEO_FREEZE_DURATION"))),v<F("VIDEO_FREEZE_DURATION")&&this.videoState===Rc.VideoStateFrozen&&(this.videoState=Rc.VideoStateDecoding),v>F("VIDEO_FREEZE_DURATION")&&wc.lastVisibleTime>=wc.lastHiddenTime&&s.timestamp>wc.lastVisibleTime&&s.timestamp>wc.lastHiddenTime){const M=Math.min(66,Tx(this._render_interframe_delays_sizes,this._render_interframe_delays)),x=Math.max(0,v-(O-1)*M);this.renderFreezeAccTime2+=x>M?x:0,this.renderFreezeAccTime+=v}}s=mn(mn({},p),{},{timestamp:h})}else this.isSkipCalcRenderFreezeTime()&&(s=mn(mn({},p),{},{timestamp:h}));var E,g;F("ENABLE_VIDEO_FRAME_CALLBACK")&&((E=(g=this.videoElement).requestVideoFrameCallback)===null||E===void 0||E.call(g,l))};(t=(n=this.videoElement).requestVideoFrameCallback)===null||t===void 0||t.call(n,l)}this.videoElement.controls=!1,this.videoElement.setAttribute("playsinline",""),IS()&&!F("HIDE_NO_POSTER")&&(this.videoElement.poster="noposter");const r=xt();r.name==="Safari"&&Number(r.version)===15||Sf()||!this.config.mirror||(this.videoElement.style.transform="rotateY(180deg)"),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",this.videoElement.setAttribute("muted",""),this.videoElement.muted=!0,this.videoElement.srcObject&&this.videoElement.srcObject instanceof MediaStream?this.videoElement.srcObject.getVideoTracks()[0]!==this.videoTrack&&(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,xn()&&this.videoElement.load()):(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,xn()&&this.videoElement.load());const i=this.videoElement.play();i!==void 0&&i.catch((s=>{R.debug("[".concat(this.trackId,"] playback interrupted"),s.toString())}))}resetVideoElement(){Rx.forEach((t=>{this.videoElement&&this.videoElement.removeEventListener(t,this.handleVideoEvents)})),this.videoElementCheckInterval&&(window.clearInterval(this.videoElementCheckInterval),this.videoElementCheckInterval=void 0),this.videoElementStatus=qr.NONE}isSkipCalcRenderFreezeTime(){return this.videoElementStatus===qr.DESTROYED||this.internal}handleAutoPlayFailed(){const t=n=>{n.preventDefault(),this.videoElement.play().then((()=>{R.debug("[".concat(this.trackId,"] Video element for trackId:").concat(this.trackId," autoplay resumed."))})).catch((r=>{R.error(r)})),this.autoplayFailed=!1,LE()?document.body.removeEventListener("click",t,!0):(document.body.removeEventListener("touchstart",t,!0),document.body.removeEventListener("mousedown",t,!0))};LE()?document.body.addEventListener("click",t,!0):(document.body.addEventListener("touchstart",t,!0),document.body.addEventListener("mousedown",t,!0)),IL()}}const Rx=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","timeupdate","error"];class wb extends Cb{constructor(t){let n=arguments.length>1&&arguments[1]!==void 0&&arguments[1];super(t),ne(this,"container",void 0),ne(this,"slot",void 0),this.slot=t.element,this.internal=n,this.updateConfig(t)}updateConfig(t){this.config=t,this.trackId=t.trackId;const n=t.element;var r;!this.internal||this.slot?(n!==this.slot&&(this.destroy(),this.slot=n),this.createElements()):(this.slot=n,n&&this.container?(this.internal=!1,this.container.id="agora-video-player-".concat(this.trackId),this.videoElement.id="video_".concat(this.trackId),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",(r=this.slot)===null||r===void 0||r.appendChild(this.container)):this.createElements())}updateVideoTrack(t){this.videoTrack!==t&&(this.videoTrack=t,this.createElements())}play(t){var n;(n=this.container)!==null&&n!==void 0&&n.contains(this.videoElement)&&super.play(t)}getCurrentFrame(){var t;return(t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)?super.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameToUint8Array(t){var n;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return(n=this.container)!==null&&n!==void 0&&n.contains(this.videoElement)?await super.getCurrentFrameToUint8Array(t,r):await Rb(t)}destroy(){if(super.destroy(),this.videoElement.remove(),this.videoElement=document.createElement("video"),this.container){try{var t;this.container.remove(),(t=this.slot)===null||t===void 0||t.removeChild(this.container)}catch{}this.container=void 0}}createElements(){var t;this.container||(this.container=document.createElement("div")),this.container.id="agora-video-player-".concat(this.trackId),this.container.style.width="100%",this.container.style.height="100%",this.container.style.position="relative",this.container.style.overflow="hidden",this.videoTrack?(this.container.style.backgroundColor="black",F("KEEP_LAST_FRAME")&&this.isKeepLastFrame&&this.videoElement.paused&&this.resetVideoElement(),this.mountedVideoElement()):this.unmountedVideoElement(),(t=this.slot)===null||t===void 0||t.appendChild(this.container)}mountedVideoElement(){var t;!this.container||(t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)||this.container.appendChild(this.videoElement),super.initVideoElement(),this.videoElement.id="video_".concat(this.trackId),this.videoElement.className="agora_video_player",this.videoElement.style.width="100%",this.videoElement.style.height="100%",this.videoElement.style.position="absolute",this.videoElement.style.left="0",this.videoElement.style.top="0"}unmountedVideoElement(){var t;if((t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)){super.resetVideoElement();try{this.container&&this.container.removeChild(this.videoElement)}catch{}this.videoElement=document.createElement("video")}}resetVideoElement(){var t;(t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)&&(super.resetVideoElement(),this.cacheVideoElement=this.videoElement,this.videoElement=document.createElement("video"))}getContainerElement(){return this.container}}var Cx,wx,bx,Ix,Ax,Nx,Ox,Px,Dx,kx,Lx,xx,Mx,Ux,Vx,jx,Fx,Bx,Wx,Gx,Hx,Kx,zx,Yx,qx,Xx,Jx,Qx,bt,Zx,$x,eM,tM,nM,rM,iM,sM,xs;let vn=(Cx=et({argsMap:(e,t,n)=>[e.getTrackId(),typeof t=="string"?t:t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",n]}),wx=jn(),bx=et({argsMap:e=>[e.getTrackId()]}),Ix=wf("LocalVideoTrack","_enabledMutex"),Ax=et({argsMap:(e,t)=>[e.getTrackId(),t]}),Nx=jn(),Ox=wf("LocalVideoTrack","_enabledMutex"),Px=et({argsMap:(e,t)=>[e.getTrackId(),t]}),Dx=jn(),kx=et({argsMap:(e,t)=>[e.getTrackId(),t,e._saveEncodeBitrateRatio]}),Lx=jn(),xx=et({argsMap:(e,t)=>[e.getTrackId(),t]}),Mx=jn(),Ux=jn(),Vx=et({argsMap:(e,t,n)=>[e.getTrackId(),t,n]}),jx=jn(),Fx=jn(),Bx=jn(),Wx=et({argsMap:e=>[e.getTrackId()]}),Gx=jn(),Hx=jn(),Kx=jn(),zx=jn(),Yx=jn(),qx=et({argsMap:(e,t)=>[e.getTrackId(),t.name]}),Xx=et({argsMap:e=>[e.getTrackId()]}),Jx=et({argsMap:e=>[e.getTrackId()]}),Qx=et({argsMap:(e,t,n)=>[e.getTrackId(),t.label,n]}),bt=class f5 extends kf{get videoHeight(){if(Vr()){const{height:t}=this._mediaStreamTrack.getSettings();return this._videoHeight=t,this._videoHeight}return this._videoHeight}get videoWidth(){if(Vr()){const{width:t}=this._mediaStreamTrack.getSettings();return this._videoWidth=t,this._videoWidth}return this._videoWidth}get isPlaying(){return!(!this._player||this._player.videoElementStatus!==qr.PLAYING)}get processorDestination(){return this._processorDestination}get processorContext(){return this._processorContext}set processorContext(t){this._processorContext=t}get __className__(){return"LocalVideoTrack"}constructor(t,n,r,i,s,o){if(super(t,s),ne(this,"trackMediaType",Df.VIDEO),ne(this,"_player",void 0),ne(this,"isUseScaleResolutionDownBy",!1),ne(this,"_videoVisibleTimer",null),ne(this,"_previousVideoVisibleStatus",void 0),ne(this,"_clearPreviousVideoVisibleStatus",(()=>this._previousVideoVisibleStatus=void 0)),ne(this,"_encoderConfig",void 0),ne(this,"_scalabilityMode",{numSpatialLayers:1,numTemporalLayers:1}),ne(this,"_optimizationMode",void 0),ne(this,"_saveEncodeBitrateRatio",1),ne(this,"_videoHeight",void 0),ne(this,"_videoWidth",void 0),ne(this,"_forceBitrateLimit",void 0),ne(this,"_enabled",!0),ne(this,"_processorDestination",void 0),ne(this,"_processorContext",void 0),Vr()){const{width:c,height:l}=t.getSettings();this._videoWidth=c,this._videoHeight=l}else this.updateMediaStreamTrackResolution();if(this._scalabilityMode=r,this._optimizationMode=i,this._hints=o||[],n&&this._hints.indexOf(an.CUSTOM_TRACK)!==-1?this._encoderConfig=An(n):this._encoderConfig=n,this._hints.indexOf(an.SCREEN_TRACK)===-1)this.updateBitrateFromProfile();else if(V0(Gt.CHROME,115)&&wS().indexOf("Windows")!==-1){const c=(function(l,h){if("VideoFrame"in window&&"TransformStream"in window&&Ft().supportWebRTCInsertableStream){const p=new MediaStreamTrackProcessor(l),E=new MediaStreamTrackGenerator({kind:"video"});let g,v,O=Date.now();const I=()=>{N&&(clearInterval(N),N=void 0),g&&(g.close(),g=void 0),l.stop(),v=void 0,E.removeEventListener("ended",I)};let N=window.setInterval((()=>{if(v&&g&&Date.now()-O>1e3)try{E.readyState==="live"?v.enqueue(g.clone()):I()}catch{I()}}),1e3);const M=new TransformStream({transform:(x,B)=>{E.readyState==="live"?(v=B,O=Date.now(),g===void 0?(g=x,B.enqueue(x.clone())):(B.enqueue(g),g=x)):x.close()}});return E.addEventListener("ended",I),p.readable.pipeThrough(M).pipeTo(E.writable),E}})(t);c&&(R.info("local screen video track begin to inject frame"),this._mediaStreamTrack=c)}n&&this._hints.indexOf(an.CUSTOM_TRACK)!==-1&&this.setEncoderConfiguration(n),this._processorContext=new OL(this.getTrackId(),"local"),this._processorDestination=new NL(this.processorContext),this.bindProcessorDestinationEvents()}play(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof t=="string"){const i=document.getElementById(t);i?t=i:(R.warning("[".concat(this.getTrackId(),'] can not find "#').concat(t,'" element, use document.body')),t=document.body)}R.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(n));const r=mn(mn(mn({},this._getDefaultPlayerConfig()),n),{},{trackId:this.getTrackId(),element:t});this._player?this._player.updateConfig(r):(t instanceof HTMLVideoElement?this._player=new Cb(r):this._player=new wb(r),this._player.updateVideoTrack(this._mediaStreamTrack)),this._player.play(),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval((()=>{try{const i=this.getVideoElementVisibleStatus();this.safeEmit(Pf.VIDEO_ELEMENT_VISIBLE_STATUS,i)}catch{}}),F("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,R.debug("[".concat(this.getTrackId(),"] stop video playback")))}async setEnabled(t,n){if(!n){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(R.info("[".concat(this.getTrackId(),"] start setEnabled"),t),!t){this._originMediaStreamTrack.enabled=!1;try{await cn(this,Ve.NEED_DISABLE_TRACK,this)}catch(r){throw R.error("[".concat(this.getTrackId(),"] setEnabled to false error"),r.toString()),r}return n||(this._enabled=!1),void R.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}this._originMediaStreamTrack.enabled=!0;try{await cn(this,Ve.NEED_ENABLE_TRACK,this)}catch(r){throw R.error("[".concat(this.getTrackId(),"] setEnabled to true error"),r.toString()),r}R.info("[".concat(this.getTrackId(),"] setEnabled to true success")),n||(this._enabled=!0)}async setMuted(t){t!==this._muted&&(this.stateCheck("muted",t),this._muted=t,this._originMediaStreamTrack.enabled=!t,R.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(t)),t?await cn(this,Ve.NEED_MUTE_TRACK,this):await cn(this,Ve.NEED_UNMUTE_TRACK,this))}async setSaveEncodeBitrateRatio(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this._saveEncodeBitrateRatio;if(this._saveEncodeBitrateRatio!==1&&this._encoderConfig&&this._encoderConfig.bitrateMax&&this._encoderConfig.bitrateMin){this._encoderConfig.bitrateMin=Math.floor(this._encoderConfig.bitrateMin*t),this._encoderConfig.bitrateMax=Math.floor(this._encoderConfig.bitrateMax*t),R.debug("[".concat(this.getTrackId(),"] set save encode bitrate ratio, ").concat(t)),this._saveEncodeBitrateRatio=1;try{await cn(this,Ve.NEED_UPDATE_VIDEO_ENCODER,this)}catch(n){return n.throw(R)}}}async setEncoderConfiguration(t,n){if(!this._enabled)throw new ce(U.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");if(t=Bo(t),F("USE_STANDARD_BITRATE_DEFAULT")&&(delete t.bitrateMax,delete t.bitrateMin),this._forceBitrateLimit&&(t.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:t.bitrateMax,t.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:t.bitrateMin),t.width||t.height||t.frameRate){const r=BS({encoderConfig:t});(Vr()||ni()||Vo())&&(r.deviceId=void 0),R.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(t),JSON.stringify(r));try{await this._originMediaStreamTrack.applyConstraints(r),this.updateMediaStreamTrackResolution()}catch(i){const s=new ce(U.UNEXPECTED_ERROR,i.toString());throw R.error("[".concat(this.getTrackId(),"] applyConstraints error"),s.toString()),s}}this._encoderConfig=t,this._hints.indexOf(an.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await cn(this,Ve.NEED_UPDATE_VIDEO_ENCODER,this)}catch(r){return r.throw(R)}}getStats(){return wd((()=>{R.warning("[deprecated] LocalVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalVideoStats instead")}),"localVideoTrackGetStatsWarning"),Is(this,Ve.GET_STATS)||mn({},_b)}async setBeautyEffect(t){R.error("LocalVideoTrack.setBeautyEffect was deprecated, please migrate to agora-extension-beauty-effect")}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameImage(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return this._player?this._player.getCurrentFrameToUint8Array(t,n):await Rb(t)}async findClosestProfile(){const{width:t,height:n,frameRate:r}=this.getMediaStreamTrackSettings(),{width:i,height:s,frameRate:o}=this._encoderConfig||{},c=Cf(this._videoWidth||t||i||0),l=Cf(this._videoHeight||n||s||0),h=(function(p,E,g){if(!Array.isArray(F("VIDEO_ENCODER_CONFIG_LIST"))||F("VIDEO_ENCODER_CONFIG_LIST").length===0)return!1;const v=Math.min(p,E);return!(v>=480)&&mn(mn({},F("VIDEO_ENCODER_CONFIG_LIST").find((O=>O.height>v))),{},{frameRate:g})})(c,l,Cf(r||o||15));if(h)return R.debug("[".concat(this.getTrackId(),"] find closest profile, ").concat(c,"x").concat(l," => ").concat(JSON.stringify(h))),this.setEncoderConfiguration(h)}async setBitrateLimit(t){R.debug("[".concat(this.getTrackId(),"] set bitrate limit, ").concat(JSON.stringify(t))),t&&(this._forceBitrateLimit=t,this._encoderConfig&&(this._encoderConfig.bitrateMax?this._encoderConfig.bitrateMax=this._encoderConfig.bitrateMax<t.max_bitrate?this._encoderConfig.bitrateMax:t.max_bitrate:this._encoderConfig.bitrateMax=t.max_bitrate,this._encoderConfig.bitrateMin,this._encoderConfig.bitrateMin=t.min_bitrate))}async setOptimizationMode(t){if(t!=="motion"&&t!=="detail"&&t!=="balanced")return void R.error(U.INVALID_PARAMS,"optimization mode must be motion, detail or balanced");const n=this._optimizationMode;try{this._optimizationMode=t,await cn(this,Ve.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this)}catch(r){throw this._optimizationMode=n,R.error("[".concat(this.getTrackId(),"] set optimization mode failed"),r.toString()),r}R.info("[".concat(this.getTrackId(),"] set optimization mode success (").concat(t,")"))}setScalabiltyMode(t){if(t.numSpatialLayers===1&&t.numTemporalLayers!==1)return R.error(U.INVALID_PARAMS,"scalability mode currently not supported, no SVC."),void(this._scalabilityMode={numSpatialLayers:1,numTemporalLayers:1});this._scalabilityMode=t,R.info("[".concat(this.getTrackId(),"] set scalability mode success (").concat(t,")"))}updateMediaStreamTrackResolution(){kL(this._originMediaStreamTrack).then((t=>{let[n,r]=t;this._videoHeight=r,this._videoWidth=n})).catch(OS)}_updatePlayerSource(){this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}_getDefaultPlayerConfig(){return{fit:"contain"}}async setSenderConfiguration(t){if(!this._enabled)throw new ce(U.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");R.debug("[".concat(this.getTrackId(),"] setSenderConfiguration applyConstraints"),JSON.stringify(t)),t=Bo(t),this._forceBitrateLimit&&(t.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:t.bitrateMax,t.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:t.bitrateMin),this._encoderConfig=t,this._hints.indexOf(an.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await cn(this,Ve.NEED_UPDATE_VIDEO_ENCODER,this)}catch(n){return n.throw(R)}}updateBitrateFromProfile(){if(!this._encoderConfig)return;const{width:t,height:n,frameRate:r}=this.getMediaStreamTrackSettings();if(!t||!n||!r)return;const{bitrateMax:i,bitrateMin:s}=this._encoderConfig;if(s==null||i==null){const{max:o,min:c}=(function(l,h,p,E,g){const v=F("BITRATE_ADAPTER_TYPE");if(v==="DEFAULT_BITRATE")return{min:E,max:g};if(g===void 0){const O=Math.floor(200*Math.pow(p/15,.6)*Math.pow(l*h/640/360,.75));g=v==="STANDARD_BITRATE"?4*O:2*O,E=E??O}else E=E??Math.floor(g/10);return{min:E,max:g}})(t,n,r,s,i);if(this._encoderConfig.bitrateMin=c,this._encoderConfig.bitrateMax=o,F("VIDEO_STANDARD_BITRATE_VERSION")&&s==null&&i==null){const[l,h]=(function(p,E,g){const v=4*Math.floor(2e5*Math.pow(g/15,.6)*Math.pow(p*E/230400,.75)),O=p*E,I=new Map([[19200,.9],[230400,.85],[518400,.75],[921600,.7],[2073600,.6],[3686400,.5]]),N=new Map([[230400,.95],[518400,.9],[921600,.85],[2073600,.8]]);let M=ps(I).call(I).next().value,x=1;if(I.has(O))M=I.get(O);else{var B;const ve=sh(B=Array.from(I.entries())).call(B,((wt,ot)=>{let[Xt]=wt,[zt]=ot;return Xt-zt})),St=ve.find((wt=>{let[ot]=wt;return ot>O}));if(St){const wt=ve.indexOf(St);if(wt>0){const ot=ve[wt-1],Xt=(O-ot[0])/(St[0]-ot[0]);M=ot[1]+Xt*(St[1]-ot[1])}else M=St[1]}else M=ve[ve.length-1][1]}if(N.has(O))x=N.get(O);else{var Z;const ve=sh(Z=Array.from(N.entries())).call(Z,((wt,ot)=>{let[Xt]=wt,[zt]=ot;return Xt-zt})),St=ve.find((wt=>{let[ot]=wt;return ot>O}));if(St){const wt=ve.indexOf(St);if(wt>0){const ot=ve[wt-1],Xt=(O-ot[0])/(St[0]-ot[0]);x=ot[1]+Xt*(St[1]-ot[1])}else x=St[1]}else x=ve[ve.length-1][1]}const Q=F("VIDEO_NEW_BITRATE_RATIO");Q&&Q>0&&(M=Q/100);const z=Math.floor(v*M),te=Math.floor(65e4*Math.pow(p*E/230400,.5)*Math.pow(g/15,.69));let de=z;const me=F("VIDEO_STANDARD_BITRATE_VERSION");return me&&me>0&&(me===1?de=v:me===2?de=z:me===3&&(de=te)),[Math.floor(de/1e3),x]})(t,n,r);this._encoderConfig.bitrateMax=l,this._encoderConfig.bitrateMin=c?Math.min(c,l):l,this._saveEncodeBitrateRatio=h,R.debug("[".concat(this.getTrackId(),"] update new bitrate from profile, [w: ").concat(t,", h: ").concat(n,", fps: ").concat(r,"] => [brMax: ").concat(this._encoderConfig.bitrateMax,", brMin: ").concat(this._encoderConfig.bitrateMin,", save_bitrate_ratio: ").concat(this._saveEncodeBitrateRatio,"]"))}else R.debug("[".concat(this.getTrackId(),"] update bitrate from profile, [w: ").concat(t,", h: ").concat(n,", fps: ").concat(r,"] => [brMax: ").concat(o,", brMin: ").concat(c,"]")),this._saveEncodeBitrateRatio=1}}getVideoElementVisibleStatus(){try{var t,n;const r=this==null||(t=this._player)===null||t===void 0?void 0:t.getContainerElement(),i={track:this,element:this==null||(n=this._player)===null||n===void 0?void 0:n.getVideoElement(),slot:r?.parentElement},{element:s,slot:o}=i;if(this.isPlaying&&s instanceof HTMLVideoElement&&o instanceof HTMLElement){const c=L1.checkOneElementVisible(s),l=Object.assign({},c);if(l.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=l.visible;const h=We.reportApiInvoke(null,{tag:In.TRACER,name:Bn.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});l.visible?h.onSuccess("Video is visible"):h.onSuccess("Invisible because of ".concat(l.reason))}return l}return}catch(r){throw new ce(U.GET_VIDEO_ELEMENT_VISIBLE_ERROR,r.message)}}async renewMediaStreamTrack(t){}pipe(t){if(this.processor===t)return t;if(t._source)throw new ce(U.INVALID_OPERATION,"Processor ".concat(t.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=t,this.processor._source=this,t.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),t}unpipe(){if(!this.processor)return;const t=this.processor;this.processor._source=void 0,this.processor=void 0,t.reset()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe()}clone(t){let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],r=this._encoderConfig;t&&(r=mn(mn({},r),Bo(t))),r=fh(r);const i=ln(8,"track-video-cloned-"),s=new f5(n?this._mediaStreamTrack.clone():this._mediaStreamTrack,r,fh(this._scalabilityMode),this._optimizationMode,i,fh(this._hints));return t&&r&&s.setEncoderConfiguration(r),R.debug("clone video track from ".concat(this.getTrackId()," to ").concat(i,", clone ").concat(n)),s}async replaceTrack(t,n){if(!(t instanceof MediaStreamTrack))throw new ce(U.INVALID_PARAMS,"track should be an instance of MediaStreamTrack");if(t.kind!=="video")throw new ce(U.INVALID_PARAMS,"track should be a video MediaStreamTrack");await this._updateOriginMediaStreamTrack(t,n,!0),this.updateMediaStreamTrackResolution()}sendSeiData(t){if(wd((()=>{We.reportApiInvoke(null,{name:Bn.LOCAL_VIDEO_SEND_SEI_DATA,options:[],tag:In.TRACER}).onSuccess("")}),this._mediaStreamTrack.id||this.getTrackId()),!F("ENABLE_VIDEO_SEI")||!F("ENABLE_ENCODED_TRANSFORM"))return void R.warning('To send/receive SEI, please call AgoraRTC.setParameter("ENABLE_VIDEO_SEI", true) before instantiate IAgoraRtcClient');if(t instanceof Uint8Array==0)return new ce(U.INVALID_PARAMS,"Invalid argument type, ILocalVideoTrack.sendSeiData() only accept Uint8Array argument.").throw();const n=this.getRTCRtpTransceiver();if(!n)return void R.warning("Video track is not published, SEI can not be send");const r=n.sender.getParameters();if(r.codecs.length===0)return;const i=r.codecs[0].mimeType.toLocaleLowerCase();i==="video/h264"||i==="video/h265"?this.safeEmit("sei-to-send",t):R.warning("SEI is not supported by ".concat(i))}bindProcessorDestinationEvents(){this.processorDestination.on(wi.ON_TRACK,(async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource(),await cn(this,Ve.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await cn(this,Ve.NEED_REPLACE_TRACK,this))}))}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(wi.ON_TRACK)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners(Os.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(Os.REQUEST_CONSTRAINTS)}},Lt(bt.prototype,"play",[Cx,wx],Object.getOwnPropertyDescriptor(bt.prototype,"play"),bt.prototype),Lt(bt.prototype,"stop",[bx],Object.getOwnPropertyDescriptor(bt.prototype,"stop"),bt.prototype),Lt(bt.prototype,"setEnabled",[Ix,Ax,Nx],Object.getOwnPropertyDescriptor(bt.prototype,"setEnabled"),bt.prototype),Lt(bt.prototype,"setMuted",[Ox,Px,Dx],Object.getOwnPropertyDescriptor(bt.prototype,"setMuted"),bt.prototype),Lt(bt.prototype,"setSaveEncodeBitrateRatio",[kx,Lx],Object.getOwnPropertyDescriptor(bt.prototype,"setSaveEncodeBitrateRatio"),bt.prototype),Lt(bt.prototype,"setEncoderConfiguration",[xx,Mx],Object.getOwnPropertyDescriptor(bt.prototype,"setEncoderConfiguration"),bt.prototype),Lt(bt.prototype,"getStats",[Ux],Object.getOwnPropertyDescriptor(bt.prototype,"getStats"),bt.prototype),Lt(bt.prototype,"setBeautyEffect",[Vx,jx],Object.getOwnPropertyDescriptor(bt.prototype,"setBeautyEffect"),bt.prototype),Lt(bt.prototype,"getCurrentFrameData",[Fx],Object.getOwnPropertyDescriptor(bt.prototype,"getCurrentFrameData"),bt.prototype),Lt(bt.prototype,"getCurrentFrameImage",[Bx],Object.getOwnPropertyDescriptor(bt.prototype,"getCurrentFrameImage"),bt.prototype),Lt(bt.prototype,"findClosestProfile",[Wx,Gx],Object.getOwnPropertyDescriptor(bt.prototype,"findClosestProfile"),bt.prototype),Lt(bt.prototype,"setBitrateLimit",[Hx],Object.getOwnPropertyDescriptor(bt.prototype,"setBitrateLimit"),bt.prototype),Lt(bt.prototype,"setOptimizationMode",[Kx],Object.getOwnPropertyDescriptor(bt.prototype,"setOptimizationMode"),bt.prototype),Lt(bt.prototype,"setScalabiltyMode",[zx],Object.getOwnPropertyDescriptor(bt.prototype,"setScalabiltyMode"),bt.prototype),Lt(bt.prototype,"updateMediaStreamTrackResolution",[Yx],Object.getOwnPropertyDescriptor(bt.prototype,"updateMediaStreamTrackResolution"),bt.prototype),Lt(bt.prototype,"pipe",[qx],Object.getOwnPropertyDescriptor(bt.prototype,"pipe"),bt.prototype),Lt(bt.prototype,"unpipe",[Xx],Object.getOwnPropertyDescriptor(bt.prototype,"unpipe"),bt.prototype),Lt(bt.prototype,"close",[Jx],Object.getOwnPropertyDescriptor(bt.prototype,"close"),bt.prototype),Lt(bt.prototype,"replaceTrack",[Qx],Object.getOwnPropertyDescriptor(bt.prototype,"replaceTrack"),bt.prototype),bt),WS=(Zx=et({argsMap:(e,t)=>[e.getTrackId(),t]}),$x=jn(),eM=wf("CameraVideoTrack","_enabledMutex"),tM=et({argsMap:(e,t)=>[e.getTrackId(),t]}),nM=jn(),rM=et({argsMap:(e,t)=>[e.getTrackId(),t]}),iM=jn(),sM=et({argsMap:e=>[e.getTrackId()]}),xs=class m5 extends vn{get __className__(){return"CameraVideoTrack"}constructor(t,n,r,i,s,o){super(t,Bo(n.encoderConfig),i,s,o),ne(this,"_config",void 0),ne(this,"_originalConstraints",void 0),ne(this,"_constraints",void 0),ne(this,"_enabled",!0),ne(this,"_deviceName","default"),ne(this,"tryResumeVideoForIOS15_16WeChat",(async()=>{(Sf()||G0())&&!(function(){const c=xt();if(c.os!==Er.IOS||!c.osVersion)return!1;const l=c.osVersion.split(".");return Number(l[0])===15&&Number(l[1])>=2})()&&O1()&&this._enabled&&!this._isClosed&&(R.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS 15 device on WeChat.")),await this.renewMediaStreamTrack())})),this._config=n,this._originalConstraints=r,this._constraints=r,this._deviceName=t.label,this._encoderConfig=Bo(this._config.encoderConfig),rn.on(Lr.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),rn.on(Lr.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),this.bindProcessorContextEvents()}async setDevice(t){return typeof t=="string"?this._setDeviceById(t):t.deviceId?this._setDeviceById(t.deviceId):t.facingMode?this._setDeviceByFacingModel(t.facingMode):void 0}async _setDeviceById(t){if(R.info("[".concat(this.getTrackId(),"] set device to ").concat(t)),this._enabled)try{const n=await ks.getDeviceById(t),r={};r.video=mn({},this._constraints),r.video.deviceId={exact:t},r.video.facingMode=void 0,this._originMediaStreamTrack.stop();let i=null;try{i=await Ds(r,this.getTrackId())}catch(s){throw R.error("[".concat(this.getTrackId(),"] setDevice failed"),s.toString()),i=await Ds({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!1),s}await this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution(),this._deviceName=n.label,this._config.cameraId=t,this._constraints.deviceId={exact:t}}catch(n){throw R.error("[".concat(this.getTrackId(),"] setDevice error"),n.toString()),n}else try{const n=await ks.getDeviceById(t);this._deviceName=n.label,this._config.cameraId=t,this._constraints.deviceId={exact:t}}catch(n){throw R.error("[".concat(this.getTrackId(),"] setDevice error"),n.toString()),n}R.info("[".concat(this.getTrackId(),"] setDevice success"))}async _setDeviceByFacingModel(t){R.info("[".concat(this.getTrackId(),"] set facingMode ").concat(t));const n={video:mn(mn({},this._constraints),{},{deviceId:void 0,facingMode:{exact:t}})};if(this._enabled){this._originMediaStreamTrack.stop();let r=null;try{r=await Ds(n,this.getTrackId())}catch(i){throw R.error("[".concat(this.getTrackId(),"] setDeviceByFacingModel failed"),i.toString()),r=await Ds({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(r.getVideoTracks()[0],!1),i}await this._updateOriginMediaStreamTrack(r.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution()}this._deviceName="",this._config.facingMode=t,this._config.cameraId=void 0,this._constraints=mn({},n.video),R.info("[".concat(this.getTrackId(),"] setDeviceByFacingModel success"))}async setEnabled(t,n){if(!n){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(R.info("[".concat(this.getTrackId(),"] start setEnabled"),t),t){try{if(this.isExternalTrack)this._originMediaStreamTrack.enabled=!0;else{const r=await Ds({video:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(r.getVideoTracks()[0],!1)}await cn(this,Ve.NEED_ENABLE_TRACK,this)}catch(r){throw R.error("[".concat(this.getTrackId(),"] setEnabled true error"),r.toString()),r}this.updateMediaStreamTrackResolution(),R.info("[".concat(this.getTrackId(),"] setEnabled to true success")),n||(this._enabled=!0)}else{this.isExternalTrack?this._originMediaStreamTrack.enabled=!1:(this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop()),n||(this._enabled=!1);try{await cn(this,Ve.NEED_DISABLE_TRACK,this)}catch(r){throw R.error("[".concat(this.getTrackId(),"] setEnabled to false error"),r.toString()),r}R.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}}async setEncoderConfiguration(t,n){if(!this._enabled)throw new ce(U.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");t=Bo(t),F("USE_STANDARD_BITRATE_DEFAULT")&&(delete t.bitrateMax,delete t.bitrateMin),this._forceBitrateLimit&&(t.bitrateMax=this._forceBitrateLimit.max_bitrate||t.bitrateMax,t.bitrateMin=this._forceBitrateLimit.min_bitrate||t.bitrateMin);const r=An(this._config);r.encoderConfig=t;const i=BS(r);(Vr()||ni()||Vo())&&(i.deviceId=void 0),R.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(t),JSON.stringify(i));try{await this._originMediaStreamTrack.applyConstraints(i),this.updateMediaStreamTrackResolution()}catch(s){const o=new ce(U.UNEXPECTED_ERROR,s.toString());throw R.error("[".concat(this.getTrackId(),"] applyConstraints error"),o.toString()),o}this._config=r,this._constraints=i,this._originalConstraints=i,this._encoderConfig=t,this._hints.indexOf(an.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await cn(this,Ve.NEED_UPDATE_VIDEO_ENCODER,this)}catch(s){return s.throw(R)}}_getDefaultPlayerConfig(){return{mirror:!0,fit:"cover"}}onTrackEnded(){if((ni()||Vo())&&this._enabled&&!this._isClosed&&rn.duringInterruption){const t=async()=>{rn.off(Lr.IOS_INTERRUPTION_END,t),this._enabled&&!this._isClosed&&(R.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};rn.on(Lr.IOS_INTERRUPTION_END,t)}else R.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(Pf.TRACK_ENDED)}async renewMediaStreamTrack(t){const n=t||this._constraints,r=ks.searchDeviceIdByName(this._deviceName);if(r&&!n.deviceId&&(n.deviceId={exact:r}),this._enabled){const i=await Ds({video:n},this.getTrackId());this._constraints=n,await this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!0),this.updateMediaStreamTrackResolution()}}close(){super.close(),rn.off(Lr.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),rn.off(Lr.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat)}clone(t){let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],r=this._encoderConfig;t&&(r=mn(mn({},r),Bo(t))),r=fh(r);const i=ln(8,"track-cam-cloned-"),s=new m5(n?this._mediaStreamTrack.clone():this._mediaStreamTrack,fh(mn(mn({},this._config),{},{encoderConfig:r})),fh(this._constraints),fh(this._scalabilityMode),this._optimizationMode,i);return t&&r&&s.setEncoderConfiguration(r),R.debug("clone track from ".concat(this.getTrackId()," to ").concat(i,", clone ").concat(n)),s}bindProcessorContextEvents(){this.processorContext.on(Os.REQUEST_UPDATE_CONSTRAINTS,(async(t,n,r)=>{try{const i=Object.assign({},this._originalConstraints,...t);await this.renewMediaStreamTrack(i),n()}catch(i){r(i)}})),this.processorContext.on(Os.REQUEST_CONSTRAINTS,(async t=>{t(this._originMediaStreamTrack.getSettings())}))}},Lt(xs.prototype,"setDevice",[Zx,$x],Object.getOwnPropertyDescriptor(xs.prototype,"setDevice"),xs.prototype),Lt(xs.prototype,"setEnabled",[eM,tM,nM],Object.getOwnPropertyDescriptor(xs.prototype,"setEnabled"),xs.prototype),Lt(xs.prototype,"setEncoderConfiguration",[rM,iM],Object.getOwnPropertyDescriptor(xs.prototype,"setEncoderConfiguration"),xs.prototype),Lt(xs.prototype,"close",[sM],Object.getOwnPropertyDescriptor(xs.prototype,"close"),xs.prototype),xs);function bb(e,t,n,r){n.optimizationMode&&(r&&r.width&&r.height?(n.encoderConfig=mn(mn({},r),{},{bitrateMin:r.bitrateMin,bitrateMax:r.bitrateMax}),n.optimizationMode!=="motion"&&n.optimizationMode!=="detail"||(t.contentHint=n.optimizationMode,t.contentHint===n.optimizationMode?R.debug("[".concat(e,"] set content hint to"),n.optimizationMode):R.debug("[".concat(e,"] set content hint failed")))):R.warning("[".concat(e,"] can not apply optimization mode bitrate config, no encoderConfig")))}var oM,aM,cM,lM,io,dM,uM,hM,pM,fM,mM,fi;class _M extends gL{getUserId(){return this._userId}constructor(t,n,r,i){super(t,"track-".concat(t.kind,"-").concat(n,"-").concat(i.clientId,"_").concat(ln(5,""))),ne(this,"_userId",void 0),ne(this,"_uintId",void 0),ne(this,"_isDestroyed",!1),ne(this,"store",void 0),ne(this,"processor",void 0),ne(this,"processorContext",void 0),this._userId=n,this._uintId=r,this.store=i}_updateOriginMediaStreamTrack(t){this._originMediaStreamTrack=t,this._mediaStreamTrack=t,this._updatePlayerSource(),this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext})}_destroy(){this._isDestroyed=!0,R.info("[".concat(this.getTrackId(),"] is destroyed")),this.stop(),super.close()}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}}let Mf=(oM=et({argsMap:(e,t,n)=>[e.getTrackId(),typeof t=="string"?t:t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",n]}),aM=et({argsMap:e=>[e.getTrackId()]}),cM=et({argsMap:(e,t)=>[e.getTrackId(),t.name]}),lM=et({argsMap:e=>[e.getTrackId()]}),Lt((io=class extends _M{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==qr.PLAYING)}get __className__(){return"RemoteVideoTrack"}constructor(e,t,n,r,i){super(e,t,n,r),ne(this,"_videoVisibleTimer",null),ne(this,"_previousVideoVisibleStatus",void 0),ne(this,"_clearPreviousVideoVisibleStatus",(()=>this._previousVideoVisibleStatus=void 0)),ne(this,"trackMediaType",Df.VIDEO),ne(this,"_videoWidth",void 0),ne(this,"_videoHeight",void 0),ne(this,"_player",void 0),ne(this,"_prePlayer",void 0),ne(this,"processorDestination",void 0),ne(this,"processorContext",void 0),this._prePlayer=i,this.updateMediaStreamTrackResolution(),this.processorContext=new OL(this.getTrackId(),"remote"),this.processorDestination=new NL(this.processorContext),this.bindProcessorDestinationEvents()}getStats(){return wd((()=>{R.warning("[deprecated] RemoteVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteVideoStats instead")}),"remoteVideoTrackGetStatsWarning"),Is(this,Ve.GET_STATS)||mn({},_L)}play(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(this.safeEmit(ro.PLAY_START),typeof e=="string"){const r=document.getElementById(e);r?e=r:(R.warning("[".concat(this.getTrackId(),'] can not find "#').concat(e,'" element, use document.body')),e=document.body)}R.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(e instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(t));const n=mn(mn({fit:"cover"},t),{},{trackId:this.getTrackId(),element:e});if(this._player)this._player.updateConfig(n);else{let r=!1,i=!1;e instanceof HTMLVideoElement?(this._player=new Cb(n),this._prePlayer&&(this._prePlayer.destroy(),this._prePlayer=void 0,i=!0)):this._prePlayer&&!this._prePlayer.isDestroyed?(this._player=this._prePlayer,this._prePlayer=void 0,r=this._player.videoState>0,this._player.updateConfig(n)):this._player=new wb(n),this._player.updateVideoTrack(this._mediaStreamTrack),this._player.onFirstVideoFrameDecoded=()=>{this.store.subscribe(this.getUserId(),"video",void 0,void 0,Date.now()),this.safeEmit(ro.FIRST_FRAME_DECODED),i&&this.safeEmit(ro.FIRST_FRAME_RENDER)},this._player.onVideoStateChanged=s=>{this.safeEmit(ro.VIDEO_STATE_CHANGED,s)},r&&(this._player.onFirstVideoFrameDecoded(),this._player.onVideoStateChanged(this._player.videoState))}this._player.play(this.store.sessionId||void 0),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval((()=>{try{const r=this.getVideoElementVisibleStatus();this.safeEmit(ro.VIDEO_ELEMENT_VISIBLE_STATUS,r)}catch{}}),F("CHECK_VIDEO_VISIBLE_INTERVAL")),this.safeEmit(ro.PLAY_END)}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,R.debug("[".concat(this.getTrackId(),"] stop video playback")))}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}updateMediaStreamTrackResolution(){kL(this._originMediaStreamTrack).then((e=>{let[t,n]=e;this._videoHeight=n,this._videoWidth=t})).catch(OS)}_updatePlayerSource(){R.debug("[".concat(this.getTrackId(),"] update player source track")),this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}getVideoElementVisibleStatus(){try{var e,t;const n=this==null||(e=this._player)===null||e===void 0?void 0:e.getContainerElement(),r={track:this,element:this==null||(t=this._player)===null||t===void 0?void 0:t.getVideoElement(),slot:n?.parentElement},{element:i,slot:s}=r;if(this.isPlaying&&i instanceof HTMLVideoElement&&s instanceof HTMLElement){const o=L1.checkOneElementVisible(i),c=Object.assign({},o);if(c.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=c.visible;const l=We.reportApiInvoke(null,{tag:In.TRACER,name:Bn.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});c.visible?l.onSuccess("Video is visible"):l.onSuccess("Invisible because of ".concat(c.reason))}return c}return}catch(n){throw new ce(U.GET_VIDEO_ELEMENT_VISIBLE_ERROR,n.message)}}pipe(e){if(this.processor===e)return e;if(e._source)throw new ce(U.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),e}unpipe(){if(!this.processor)return;const e=this.processor;this.processor._source=void 0,this.processor=void 0,e.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(wi.ON_TRACK,(async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource()):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())}))}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(wi.ON_TRACK)}_destroy(){this._prePlayer&&(this._prePlayer.destroy(),this._prePlayer=void 0),super._destroy(),this.unbindProcessorDestinationEvents()}_onSei(e){this.emit(gh.SEI_RECEIVED,e)}}).prototype,"play",[oM],Object.getOwnPropertyDescriptor(io.prototype,"play"),io.prototype),Lt(io.prototype,"stop",[aM],Object.getOwnPropertyDescriptor(io.prototype,"stop"),io.prototype),Lt(io.prototype,"pipe",[cM],Object.getOwnPropertyDescriptor(io.prototype,"pipe"),io.prototype),Lt(io.prototype,"unpipe",[lM],Object.getOwnPropertyDescriptor(io.prototype,"unpipe"),io.prototype),io),Uf=(dM=et({argsMap:(e,t)=>[e.getTrackId(),t],throttleTime:300}),uM=et({argsMap:(e,t)=>[e.getTrackId(),t]}),hM=et({argsMap:e=>[e.getTrackId()]}),pM=et({argsMap:e=>[e.getTrackId()]}),fM=et({argsMap:(e,t)=>[e.getTrackId(),t.name]}),mM=et({argsMap:e=>[e.getTrackId()]}),Lt((fi=class extends _M{get isPlaying(){return this._useAudioElement?Ui.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"RemoteAudioTrack"}constructor(e,t,n,r){super(e,t,n,r),ne(this,"trackMediaType",Df.AUDIO),ne(this,"_source",void 0),ne(this,"_useAudioElement",!0),ne(this,"_volume",100),ne(this,"processorContext",void 0),ne(this,"processorDestination",void 0),ne(this,"_played",!1),ne(this,"_bypassWebAudio",!1),F("DISABLE_WEBAUDIO")?(this._source=new Tb,this._bypassWebAudio=!0,this._useAudioElement=!0):(this._source=new TL(e,!0),F("REMOTE_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1)),this._source.once(Ns.RECEIVE_TRACK_BUFFER,(()=>{this.safeEmit(ro.FIRST_FRAME_DECODED)})),this.processorContext=new DL(this._source.context,this.getTrackId(),"remote"),this.processorDestination=new PL(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on(Ns.UPDATE_SOURCE,(()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})}))}setAudioFrameCallback(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!e)return this._source.removeAllListeners(Ns.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(t),this._source.removeAllListeners(Ns.ON_AUDIO_BUFFER),this._source.on(Ns.ON_AUDIO_BUFFER,(n=>e(n)))}setVolume(e){this._volume=e,this._useAudioElement?Ui.setVolume(this.getTrackId(),e):this._source.setVolume(e/100)}async setPlaybackDevice(e){if(!this._useAudioElement||!hL())throw new ce(U.NOT_SUPPORTED,"your browser does not support setting the audio output device");await Ui.setSinkID(this.getTrackId(),e)}getVolumeLevel(){return this._source.getAccurateVolumeLevel()}getStats(){return wd((()=>{R.warning("[deprecated] RemoteAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteAudioStats instead")}),"remoteAudioTrackGetStatsWarning"),Is(this,Ve.GET_STATS)||mn({},mL)}play(){R.debug("[".concat(this.getTrackId(),"] start audio playback")),this._played=!0,this._useAudioElement?(R.debug("[".concat(this.getTrackId(),"] use audio element to play")),Ui.play(this._mediaStreamTrack,this.getTrackId(),this._volume,this.store.sessionId||void 0)):this._source.play()}stop(){R.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._played=!1,this._useAudioElement?Ui.stop(this.getTrackId()):this._source.stop()}_destroy(){super._destroy(),this._played=!1,this.unbindProcessorDestinationEvents(),this._source.destroy()}_isFreeze(){return this._source.isFreeze}_updatePlayerSource(){let e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];R.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&Ui.updateTrack(this.getTrackId(),this._mediaStreamTrack)}pipe(e){if(this._bypassWebAudio)throw new ce(U.NOT_SUPPORTED,"can not pipe extension when WebAudio disabled");if(this.processor===e)return e;if(e._source)throw new ce(U.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(this._bypassWebAudio)throw new ce(U.NOT_SUPPORTED,"can not unpipe extension when WebAudio disabled");if(!this.processor)return;const t=this.processor;(e=this._source.processSourceNode)===null||e===void 0||e.disconnect(),this.processor._source=!1,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(wi.ON_TRACK,(async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(e)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())})),this.processorDestination.on(wi.ON_NODE,(e=>{this._source.processedNode=e;const t=!e;this._useAudioElement!==t&&(this._played?(this.stop(),this._useAudioElement=t,this.play()):this._useAudioElement=t)}))}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(wi.ON_TRACK),this.processorDestination.removeAllListeners(wi.ON_NODE)}}).prototype,"setVolume",[dM],Object.getOwnPropertyDescriptor(fi.prototype,"setVolume"),fi.prototype),Lt(fi.prototype,"setPlaybackDevice",[uM],Object.getOwnPropertyDescriptor(fi.prototype,"setPlaybackDevice"),fi.prototype),Lt(fi.prototype,"play",[hM],Object.getOwnPropertyDescriptor(fi.prototype,"play"),fi.prototype),Lt(fi.prototype,"stop",[pM],Object.getOwnPropertyDescriptor(fi.prototype,"stop"),fi.prototype),Lt(fi.prototype,"pipe",[fM],Object.getOwnPropertyDescriptor(fi.prototype,"pipe"),fi.prototype),Lt(fi.prototype,"unpipe",[mM],Object.getOwnPropertyDescriptor(fi.prototype,"unpipe"),fi.prototype),fi);const wc=new class extends Pn{get visibility(){return document.visibilityState}get lastHiddenTime(){return this._lastHiddenTime}get lastVisibleTime(){return this._lastVisibleTime}constructor(){super(),ne(this,"_lastHiddenTime",0),ne(this,"_lastVisibleTime",0),document.addEventListener("visibilitychange",(()=>{document.visibilityState==="hidden"?this._lastHiddenTime=performance.now():this._lastVisibleTime=performance.now(),R.debug("current web page is ".concat(document.visibilityState)),this.emit("VISIBILITY_CHANGE",document.visibilityState)}))}};class EM extends Pn{constructor(t,n){super(),ne(this,"trackMediaType",Df.DATA),ne(this,"_version",1),ne(this,"_type",3),ne(this,"_config",void 0),ne(this,"_originDataChannel",void 0),ne(this,"_dataStreamPacketHeader",new ArrayBuffer(4)),ne(this,"_dataStreamPacketHandler",{serialize:r=>r,deserialize:r=>r}),ne(this,"_datachannelEventMap",new Map),this._config=t,n&&(this._originDataChannel=n,this._bandDataChannelEvents(n)),this._initPacketHeader()}useDataStream(t){this._dataStreamPacketHandler=t}get id(){return this._config.id}get ordered(){return this._config.ordered}get maxRetransmits(){return F("DATASTREAM_MAX_RETRANSMITS")}get metadata(){return this._config.metadata}get readyState(){var t,n;return(t=(n=this._originDataChannel)===null||n===void 0?void 0:n.readyState)!==null&&t!==void 0?t:"connecting"}get _originDataChannelId(){var t,n;return(t=(n=this._originDataChannel)===null||n===void 0?void 0:n.id)!==null&&t!==void 0?t:null}getChannelId(){return this.id}getConfig(){return this._config}_close(){this._originDataChannel&&(this._unbindDataChannelEvents(this._originDataChannel),this._originDataChannel=void 0)}async _waitTillOpen(){return new Pe(((t,n)=>{if(this._originDataChannel){this._originDataChannel.readyState==="open"&&t();const r=setTimeout((()=>{var i;n(new ce(U.DATACHANNEL_CONNECTION_TIMEOUT,"Cannot create datachannel, id: ".concat((i=this._originDataChannel)===null||i===void 0?void 0:i.id)))}),1e4);this._originDataChannel.onopen=()=>{clearTimeout(r),this._originDataChannel&&this._bandDataChannelEvents(this._originDataChannel),t()},this._originDataChannel.onerror=()=>{throw clearTimeout(r),new ce(U.DATACHANNEL_CONNECTION_TIMEOUT)}}else n(new ce(U.DATACHANNEL_CONNECTION_TIMEOUT,"cannot find dataChannel"))}))}_updateOriginDataChannel(t){this._originDataChannel=t,this._bandDataChannelEvents(t)}_initPacketHeader(){const t=new DataView(this._dataStreamPacketHeader);t.setUint16(0,this._version),t.setUint8(2,this._type),t.setUint8(3,this._config.id)}_bandDataChannelEvents(t){this._unbindDataChannelEvents(t),[jS.OPEN,jS.CLOSE,jS.ERROR].forEach((n=>{const r=()=>{this.emit(n)};this._datachannelEventMap.set(n,r),t.addEventListener(n,r)}))}_unbindDataChannelEvents(t){Array.from(this._datachannelEventMap.entries()).forEach((n=>{let[r,i]=n;t.removeEventListener(r,i)})),this._datachannelEventMap.clear()}}class yY extends EM{constructor(t){super(t),ne(this,"_messageListener",void 0),this._messageListener=n=>{if(n.data.byteLength<this._dataStreamPacketHeader.byteLength)throw Error("invalid byteLength: the byte length must exceed "+this._dataStreamPacketHeader.byteLength);const r=n.data.slice(0,this._dataStreamPacketHeader.byteLength),i=new DataView(r).getUint8(3);if(i!==this.id)return void(F("SHOW_DATASTREAM2_LOG")&&R.debug("invalid datachannel id: ".concat(i," !== ").concat(this.id)));let s=n.data.slice(this._dataStreamPacketHeader.byteLength);s=this._dataStreamPacketHandler.deserialize(s),this.emit(jS.MESSAGE,s)}}_updateOriginDataChannel(t){super._updateOriginDataChannel(t),this._bandRemoteDataChannelEvents()}_close(){this._originDataChannel&&(this._originDataChannel.removeEventListener("message",this._messageListener),super._close())}_bandRemoteDataChannelEvents(){this._originDataChannel&&this._originDataChannel.addEventListener("message",this._messageListener)}}class SY extends EM{send(t){if(this._originDataChannel){let n=t;n=this._dataStreamPacketHandler.serialize(t);const r=new Uint8Array(this._dataStreamPacketHeader.byteLength+n.byteLength);r.set(new Uint8Array(this._dataStreamPacketHeader),0),r.set(new Uint8Array(n),this._dataStreamPacketHeader.byteLength),this._originDataChannel.send(r.buffer)}}}function GS(){const e=new Blob([atob("Y29uc3QgdD0idmlkZW8vaDI2NCIsZT0idmlkZW8vaDI2NSI7ZnVuY3Rpb24gbih0LGUsbil7bGV0IGE9bmV3IFVpbnQ4QXJyYXkodCxlLG4pLHI9W10sbz0wO2Zvcig7ci5sZW5ndGg8bjspbyszPG4mJjA9PT1hW29dJiYwPT09YVtvKzFdJiYzPT09YVtvKzJdJiYoMD09PWFbbyszXXx8MT09PWFbbyszXXx8Mj09PWFbbyszXXx8Mz09PWFbbyszXSk/KHIucHVzaChhW29dLGFbbysxXSxhW28rM10pLG8rPTQpOihyLnB1c2goYVtvXSksbysrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkocil9ZnVuY3Rpb24gYShhLHIpe3N3aXRjaChyKXtjYXNlIHQ6cmV0dXJuIGZ1bmN0aW9uKHQpe2NvbnN0IGU9bmV3IERhdGFWaWV3KHQuZGF0YSk7bGV0IGE9MDtmb3IoO2ErNDx0LmRhdGEuYnl0ZUxlbmd0aDspe2lmKDA9PT1lLmdldFVpbnQ4KGErMCkmJjA9PT1lLmdldFVpbnQ4KGErMSkmJjA9PT1lLmdldFVpbnQ4KGErMikmJjE9PT1lLmdldFVpbnQ4KGErMykmJjY9PT1lLmdldFVpbnQ4KGErNCkpe2xldCByPWErNixvPTAsaT0wO2Zvcig7MjU1PT09KGk9ZS5nZXRVaW50OChyKyspKTspbys9MjU1O28rPWk7Y29uc3Qgcz1uKHQuZGF0YSxyLG8pO3JldHVybiBuZXcgVWludDhBcnJheShzKX1hKyt9cmV0dXJuIG51bGx9KGEpO2Nhc2UgZTpyZXR1cm4gZnVuY3Rpb24odCl7Y29uc3QgZT1uZXcgRGF0YVZpZXcodC5kYXRhKTtsZXQgYT0wO2Zvcig7YSs1PHQuZGF0YS5ieXRlTGVuZ3RoOyl7aWYoMD09PWUuZ2V0VWludDgoYSswKSYmMD09PWUuZ2V0VWludDgoYSsxKSYmMD09PWUuZ2V0VWludDgoYSsyKSYmMT09PWUuZ2V0VWludDgoYSszKSYmNzg9PT1lLmdldFVpbnQ4KGErNCkmJjE9PT1lLmdldFVpbnQ4KGErNSkmJjEwMT09PWUuZ2V0VWludDgoYSs2KSl7bGV0IHI9YSs3LG89MCxpPTA7Zm9yKDsyNTU9PT0oaT1lLmdldFVpbnQ4KHIrKykpOylvKz0yNTU7bys9aTtjb25zdCBzPW4odC5kYXRhLHIsbyk7cmV0dXJuIG5ldyBVaW50OEFycmF5KHMpfWErK31yZXR1cm4gbnVsbH0oYSk7ZGVmYXVsdDpyZXR1cm4gbnVsbH19ZnVuY3Rpb24gcih0KXtjb25zdCBlPXQubGVuZ3RoO2xldCBuPVtdLGE9MDtmb3IoO2E8ZTspYSsyPGUmJjA9PT10W2FdJiYwPT09dFthKzFdJiYoMD09PXRbYSsyXXx8MT09PXRbYSsyXXx8Mj09PXRbYSsyXXx8Mz09PXRbYSsyXSk/KG4ucHVzaCh0W2FdLHRbYSsxXSwzLHRbYSsyXSksYSs9Myk6KG4ucHVzaCh0W2FdKSxhKyspO3JldHVybiBuZXcgVWludDhBcnJheShuKX1mdW5jdGlvbiBvKG4sYSxvKXtzd2l0Y2gobyl7Y2FzZSB0OnJldHVybiBmdW5jdGlvbih0LGUpe2NvbnN0IG49cihlKSxhPW4ubGVuZ3RoLG89TWF0aC5mbG9vcihhLzI1NSksaT1hJTI1NSxzPW5ldyBVaW50OEFycmF5KDYrbysxK2ErdC5ieXRlTGVuZ3RoKTtzWzBdPTAsc1sxXT0wLHNbMl09MCxzWzNdPTEsc1s0XT02LHNbNV09MTAxO2xldCBmPTA7Zm9yKDtmPG87KXNbNitmXT0yNTUsZisrO3JldHVybiBzWzYrZl09aSxmKysscy5zZXQobiw2K2YpLHMuc2V0KG5ldyBVaW50OEFycmF5KHQpLDYrZithKSxzLmJ1ZmZlcn0obixhKTtjYXNlIGU6cmV0dXJuIGZ1bmN0aW9uKHQsZSl7Y29uc3Qgbj1yKGUpLGE9bi5sZW5ndGgsbz1NYXRoLmZsb29yKGEvMjU1KSxpPWElMjU1LHM9bmV3IFVpbnQ4QXJyYXkoNytvKzErYSsxK3QuYnl0ZUxlbmd0aCk7c1swXT0wLHNbMV09MCxzWzJdPTAsc1szXT0xLHNbNF09Nzgsc1s1XT0xLHNbNl09MTAxO2xldCBmPTA7Zm9yKDtmPG87KXNbNytmXT0yNTUsZisrO3JldHVybiBzWzcrZl09aSxmKysscy5zZXQobiw3K2YpLGYrPWEsc1s3K2ZdPTEyOCxmKysscy5zZXQobmV3IFVpbnQ4QXJyYXkodCksNytmKSxzLmJ1ZmZlcn0obixhKTtkZWZhdWx0OnJldHVybiBudWxsfX1mdW5jdGlvbiBpKG4pe2lmKG4ubGVuZ3RoPDUpcmV0dXJuIiI7bGV0IGE9LTE7Zm9yKGxldCB0PTA7dDxuLmxlbmd0aC0zO3QrKyl7aWYoMD09PW5bdF0mJjA9PT1uW3QrMV0mJjE9PT1uW3QrMl0pe2E9dDticmVha31pZih0PG4ubGVuZ3RoLTQmJjA9PT1uW3RdJiYwPT09blt0KzFdJiYwPT09blt0KzJdJiYxPT09blt0KzNdKXthPXQ7YnJlYWt9fWlmKC0xPT09YSlyZXR1cm4iIjtjb25zdCByPWErKDA9PT1uW2ErMl0/NDozKTtpZihyPj1uLmxlbmd0aClyZXR1cm4iIjtjb25zdCBvPW5bcl07aWYoMTI4Jm8pcmV0dXJuIiI7aWYoKG8+PjEmNjMpPj0zMilyZXR1cm4gZTtpZihyKzE8bi5sZW5ndGgpe2lmKDA9PSgyNDgmbltyKzFdKSlyZXR1cm4gZX1yZXR1cm4oMzEmbyk8PTMxP3Q6IiJ9Y29uc3Qgcz03MSxmPTEsbD0yLHU9MSxnPTI7dmFyIGM7ZnVuY3Rpb24gZCh0LGU9ITEpe2NvbnN0IG49dC5nZXRVaW50OCgwKTtpZihuIT09cylyZXR1cm47Y29uc3QgYT10LmdldFVpbnQxNigxKSxyPWYrbCthLG89bmV3IFVpbnQ4QXJyYXkodC5ieXRlTGVuZ3RoLXIpO28uc2V0KG5ldyBVaW50OEFycmF5KHQuYnVmZmVyLHIsdC5ieXRlTGVuZ3RoLXIpKTtjb25zdCBpPXttOm4sdGx2TGVuOmEsdGx2OltdLGZyYW1lOm99O2xldCBkPWYrbDtmb3IoO2Q8cjspe2NvbnN0IG49dC5nZXRVaW50OChkKSxhPXQuZ2V0VWludDE2KGQrdSkscj11K2c7aWYobj09PWMuQVVESU9fTEVWRUwpe2xldCBvPXQuZ2V0VWludDgoZCtyKTtmb3IobGV0IGU9MTtlPGE7ZSsrKW89bzw8OHx0LmdldFVpbnQ4KGQrcitlKTtpLnRsdi5wdXNoKHt0YWc6bixsZW5ndGg6YSx2YWx1ZTplPzEyN15vPj4xOjEyNyZvfSl9ZWxzZSBpZihuPT09Yy5NRVRBREFUQXx8bj09PWMuQVVESU9fNjRfQklUX1BUUyl7Y29uc3QgZT1uZXcgVWludDhBcnJheShhKTtmb3IobGV0IG49MDtuPGE7bisrKWVbbl09dC5nZXRVaW50OChkK3Irbik7aS50bHYucHVzaCh7dGFnOm4sbGVuZ3RoOmEsdmFsdWU6ZX0pfWQrPXIrYX1yZXR1cm4gaX0hZnVuY3Rpb24odCl7dFt0LkFVRElPX0xFVkVMPTFdPSJBVURJT19MRVZFTCIsdFt0Lk1FVEFEQVRBPTJdPSJNRVRBREFUQSIsdFt0LkFVRElPXzY0X0JJVF9QVFM9M109IkFVRElPXzY0X0JJVF9QVFMifShjfHwoYz17fSkpLHNlbGYub25ydGN0cmFuc2Zvcm09dD0+e2NvbnN0IGU9dC50cmFuc2Zvcm1lcjtsZXQgbj1bXSxyPVtdO2Uub3B0aW9ucy5wb3J0Lm9ubWVzc2FnZT10PT57dC5kYXRhLnNlaSYmbi5wdXNoKHQuZGF0YS5zZWkpLHQuZGF0YS5tZXRhZGF0YSYmci5wdXNoKHQuZGF0YS5tZXRhZGF0YSl9LHNlbGYucG9zdE1lc3NhZ2UoInN0YXJ0ZWQiKTtjb25zdCBoPWUucmVhZGFibGUuZ2V0UmVhZGVyKCksVT1lLndyaXRhYmxlLmdldFdyaXRlcigpOyJzZWktcngiPT09ZS5vcHRpb25zLm5hbWU/ZnVuY3Rpb24gdChlKXtoLnJlYWQoKS50aGVuKChuPT57aWYoIW4uZG9uZSl7aWYobi52YWx1ZSBpbnN0YW5jZW9mIFJUQ0VuY29kZWRWaWRlb0ZyYW1lKXtjb25zdCB0PWkobmV3IFVpbnQ4QXJyYXkobi52YWx1ZS5kYXRhKSkscj1hKG4udmFsdWUsdCk7ciYmZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3NlaTpyfSl9VS53cml0ZShuLnZhbHVlKSxlLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSx0KGUpfX0pKX0oZSk6InNlaS10eCI9PT1lLm9wdGlvbnMubmFtZT9mdW5jdGlvbiB0KGUpe2gucmVhZCgpLnRoZW4oKGE9PntpZighYS5kb25lKXtpZihhLnZhbHVlIGluc3RhbmNlb2YgUlRDRW5jb2RlZFZpZGVvRnJhbWUpe2NvbnN0IHQ9aShuZXcgVWludDhBcnJheShhLnZhbHVlLmRhdGEpKSxlPW4uc2hpZnQoKTtpZihlKXtjb25zdCBuPW8oYS52YWx1ZS5kYXRhLGUsdCk7biYmKGEudmFsdWUuZGF0YT1uKX19VS53cml0ZShhLnZhbHVlKSxlLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSx0KGUpfX0pKX0oZSk6ImF1ZGlvLW1ldGFkYXRhLXJ4Ij09PWUub3B0aW9ucy5uYW1lP2Z1bmN0aW9uIHQoZSl7aC5yZWFkKCkudGhlbigobj0+e2lmKCFuLmRvbmUpe2lmKG4udmFsdWUgaW5zdGFuY2VvZiBSVENFbmNvZGVkQXVkaW9GcmFtZSl7Y29uc3QgdD1uZXcgRGF0YVZpZXcobi52YWx1ZS5kYXRhKSxhPXQuZ2V0VWludDgoMCk7bGV0IHI7aWYoMCE9KDEyOCZhKSYmNzEhPT1hKXtsZXQgZT1mdW5jdGlvbih0KXtpZih0LmJ5dGVMZW5ndGg8PTApcmV0dXJuW107Y29uc3QgZT1bXTtsZXQgbj0wO2Zvcig7bjx0LmJ5dGVMZW5ndGg7KXtjb25zdCBhPSgxMjgmdC5nZXRVaW50OChuKSk+Pjcscj0xMjcmdC5nZXRVaW50OChuKTtpZighKGEmJm4rNDw9dC5ieXRlTGVuZ3RoKSl7bisrO2JyZWFrfXtjb25zdCBhPXQuZ2V0VWludDMyKG4sITEpLG89KDE2Nzc2MTkyJmEpPj4xMCxpPTEwMjMmYTtlLnB1c2goe3B0OnIsdHNfb2Zmc2V0Om8sbGVuZ3RoOmksZGF0YTpuZXcgVWludDhBcnJheX0pLG4rPTR9fWxldCBhPXQuYnl0ZUxlbmd0aC1uO2Zvcihjb25zdCByIG9mIGUpe2lmKHIubGVuZ3RoPmEpcmV0dXJuIGNvbnNvbGUud2FybigiQnJva2VuIHJlZCBwYXlsb2FkIiksW107ci5sZW5ndGg+MCYmKHIuZGF0YT1uZXcgVWludDhBcnJheSh0LmJ1ZmZlcix0LmJ5dGVPZmZzZXQrbixyLmxlbmd0aCksbis9ci5sZW5ndGgsYS09ci5sZW5ndGgpfWlmKGE+MCl7Y29uc3Qgcj17cHQ6ZS5sZW5ndGg+MD9lW2UubGVuZ3RoLTFdLnB0OjAsdHNfb2Zmc2V0OjAsbGVuZ3RoOmEsZGF0YTpuZXcgVWludDhBcnJheSh0LmJ1ZmZlcix0LmJ5dGVPZmZzZXQrbixhKX07ZS5wdXNoKHIpfXJldHVybiBlfSh0KTtpZihlLmxlbmd0aD4wKXtjb25zdCB0PWZ1bmN0aW9uKHQpe2xldCBlPTA7Zm9yKGxldCBuPTA7bjx0Lmxlbmd0aDtuKyspZSs9bjx0Lmxlbmd0aC0xPzQ6MSxlKz10W25dLmxlbmd0aDtjb25zdCBuPW5ldyBVaW50OEFycmF5KGUpO2xldCBhPTA7Zm9yKGxldCBlPTA7ZTx0Lmxlbmd0aDtlKyspaWYoZTx0Lmxlbmd0aC0xKXtjb25zdCByPSgyMTQ3NDgzNjQ4fCgxMjcmdFtlXS5wdCk8PDI0fCgyNjIxNDMmdFtlXS50c19vZmZzZXQpPDwxMHwxMDIzJnRbZV0ubGVuZ3RoKT4+PjA7blthKytdPXI+PjI0JjI1NSxuW2ErK109cj4+MTYmMjU1LG5bYSsrXT1yPj44JjI1NSxuW2ErK109MjU1JnJ9ZWxzZSBuW2ErK109MTI3JnRbZV0ucHQ7Zm9yKGNvbnN0IGUgb2YgdCluLnNldChlLmRhdGEsYSksYSs9ZS5sZW5ndGg7cmV0dXJuIG59KGUubWFwKCh0PT57bGV0IGU9bmV3IFVpbnQ4QXJyYXkodC5sZW5ndGgpO2Uuc2V0KHQuZGF0YSk7Y29uc3Qgbj1kKG5ldyBEYXRhVmlldyhlLmJ1ZmZlcikpO3JldHVybiBuPy5mcmFtZSYmKHQuZGF0YT1uPy5mcmFtZSkscj1uLHR9KSkpO24udmFsdWUuZGF0YT10LmJ1ZmZlcn19ZWxzZSByPWQodCksciYmKG4udmFsdWUuZGF0YT1yLmZyYW1lLmJ1ZmZlcik7aWYocil7bGV0IHQ9ci50bHYuZmluZCgodD0+dC50YWc9PT1jLk1FVEFEQVRBKSk7aWYodCYmdC52YWx1ZSBpbnN0YW5jZW9mIFVpbnQ4QXJyYXkmJmUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHttZXRhZGF0YTp0LnZhbHVlfSksdD1yLnRsdi5maW5kKCh0PT50LnRhZz09PWMuQVVESU9fNjRfQklUX1BUUykpLHQmJnQudmFsdWUgaW5zdGFuY2VvZiBVaW50OEFycmF5JiY4PT10LnZhbHVlLmxlbmd0aCl7Y29uc3Qgbj1uZXcgRGF0YVZpZXcodC52YWx1ZS5idWZmZXIpLmdldEJpZ1VpbnQ2NCgwLCEwKTt0JiZ0LnZhbHVlIGluc3RhbmNlb2YgVWludDhBcnJheSYmZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3B0czpufSl9fX1VLndyaXRlKG4udmFsdWUpLGUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHt0cmFuc2Zvcm1lZDohMH0pLHQoZSl9fSkpfShlKToiYXVkaW8tbWV0YWRhdGEtdHgiPT09ZS5vcHRpb25zLm5hbWUmJmZ1bmN0aW9uIHQoZSl7aC5yZWFkKCkudGhlbigobj0+e2lmKCFuLmRvbmUpe2lmKGUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHtnZXRNZXRhZGF0YTohMH0pLG4udmFsdWUgaW5zdGFuY2VvZiBSVENFbmNvZGVkQXVkaW9GcmFtZSl7Y29uc3QgdD1yLnNoaWZ0KCk7dCYmKG4udmFsdWUuZGF0YT1mdW5jdGlvbih0LGUsbil7Y29uc3QgYT1uLmJ5dGVMZW5ndGgscj1hK3UrZyxvPWYrbCtyLGk9bmV3IEFycmF5QnVmZmVyKHQuYnl0ZUxlbmd0aCtvKSxjPW5ldyBEYXRhVmlldyhpKTtjLnNldFVpbnQ4KDAscyksYy5zZXRVaW50MTYoMSxyKSxjLnNldFVpbnQ4KDMsZSksYy5zZXRVaW50MTYoNCxhKTtmb3IobGV0IHQ9MDt0PGE7dCsrKWMuc2V0VWludDgoNit0LG5bdF0pO2NvbnN0IGQ9bmV3IFVpbnQ4QXJyYXkoYy5idWZmZXIpO3JldHVybiBkLnNldChuZXcgVWludDhBcnJheSh0KSxvKSxkLmJ1ZmZlcn0obi52YWx1ZS5kYXRhLGMuQVVESU9fNjRfQklUX1BUUyx0KSl9VS53cml0ZShuLnZhbHVlKSxlLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSx0KGUpfX0pKX0oZSl9LHNlbGYucG9zdE1lc3NhZ2UoInJlZ2lzdGVyZWQiKTsK")],{type:"text/javascript"});return setTimeout((()=>Wy.revokeObjectURL(e)),0),new Worker(Wy.createObjectURL(e))}const gM=71,Ib=1,Ab=2,Nb=1,vM=2;var Ad=(function(e){return e[e.AUDIO_LEVEL=1]="AUDIO_LEVEL",e[e.METADATA=2]="METADATA",e[e.AUDIO_64_BIT_PTS=3]="AUDIO_64_BIT_PTS",e})(Ad||{});function Ob(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const n=e.getUint8(0);if(n!==gM)return;const r=e.getUint16(1),i=Ib+Ab+r,s=new Uint8Array(e.byteLength-i);s.set(new Uint8Array(e.buffer,i,e.byteLength-i));const o={m:n,tlvLen:r,tlv:[],frame:s};let c=Ib+Ab;for(;c<i;){const l=e.getUint8(c),h=e.getUint16(c+Nb),p=Nb+vM;if(l===Ad.AUDIO_LEVEL){let E=e.getUint8(c+p);for(let g=1;g<h;g++)E=E<<8|e.getUint8(c+p+g);o.tlv.push({tag:l,length:h,value:t?127^E>>1:127&E})}else if(l===Ad.METADATA||l===Ad.AUDIO_64_BIT_PTS){const E=new Uint8Array(h);for(let g=0;g<h;g++)E[g]=e.getUint8(c+p+g);o.tlv.push({tag:l,length:h,value:E})}c+=p+h}return o}const HS=new Map,KS=127,Sh=1e-10,Pb=139/13,zS=new Map;function Db(e,t,n){const r="".concat(e,"-").concat(t,"-").concat(n);let i=0;return zS.has(r)?i=zS.get(r):(i=Math.log((function(o,c){const l=o-c;c<l&&(c=l);let h=1;for(let p=o,E=1;p>c;p--,E++)h=h*p/E;return h})(t,e))+e*Math.log(.5)+(t-e)*Math.log(1-.5)-Math.log(n)+n*e,zS.set(r,i)),i<Sh&&(i=Sh),i}function yM(e,t,n){const r=t.length,i=e.length/r;let s=!1;for(let o=0,c=0;o<r;o++){let l=0;for(let h=c+i;c<h;c++)e[c]>n&&l++;t[o]!==l&&(t[o]=l,s=!0)}return s}window.cache=zS;let TY=0;class SM{constructor(t){ne(this,"id",void 0),ne(this,"immediates",[]),ne(this,"lastNonSilence",-1),ne(this,"immediateSpeechActivityScore",Sh),ne(this,"lastLevelChangedTime",Date.now()),ne(this,"levels",[]),ne(this,"longs",[]),ne(this,"longSpeechActivityScore",Sh),ne(this,"mediums",[]),ne(this,"mediumSpeechActivityScore",Sh),ne(this,"minLevel",0),ne(this,"nextMinLevel",0),ne(this,"nextMinLevelWindowLength",0),ne(this,"energyScore",0),this.id=t||"".concat(TY++),this.immediates.length=50,this.mediums.length=10,this.longs.length=1,this.levels.length=this.immediates.length}computeImmediates(){const t=this.immediates,n=this.levels,r=this.minLevel+Pb;let i=!1;for(let s=0;s<t.length;++s){let o=n[s];o<r&&(o=0);const c=Math.floor(o/Pb);t[s]!==c&&(t[s]=c,i=!0)}return i}computeLongs(){return yM(this.mediums,this.longs,4)}computeMediums(){return yM(this.immediates,this.mediums,7)}evaluateImmediateSpeechActivityScore(){this.immediateSpeechActivityScore=Db(this.immediates[0],13,.78)}evaluateLongSpeechActivityScore(t){this.longSpeechActivityScore=Db(this.longs[0],10,47),this.longSpeechActivityScore>Sh&&(this.lastNonSilence=t)}evaluateMediumSpeechActivityScore(){this.mediumSpeechActivityScore=Db(this.mediums[0],5,24)}evaluateSpeechActivityScores(t){this.computeImmediates()&&(this.evaluateImmediateSpeechActivityScore(),this.computeMediums()&&(this.evaluateMediumSpeechActivityScore(),this.computeLongs()&&this.evaluateLongSpeechActivityScore(t)))}getLastLevelChangedTime(){return this.lastLevelChangedTime}getLevels(){var t;return"[".concat(Iu(t=[...this.levels]).call(t).join(),"]")}getSpeechActivityScore(t){switch(t){case 0:return this.immediateSpeechActivityScore;case 1:return this.mediumSpeechActivityScore;case 2:return this.longSpeechActivityScore;default:throw new Error("interval "+t)}}levelChanged(t,n){if(this.lastLevelChangedTime<=n){this.lastLevelChangedTime=n;let r=t;return t<0&&(r=0),t>KS&&(r=KS),this.levels.unshift(r),this.levels.length>this.immediates.length&&this.levels.pop(),this.updateMinLevel(r),r>=this.minLevel+Pb?r:r/2}return-1}levelTimedOut(){this.levelChanged(0,this.lastLevelChangedTime)}updateMinLevel(t){if(t!==0){if(this.minLevel===0||this.minLevel>t)return this.minLevel=t,this.nextMinLevel=0,void(this.nextMinLevelWindowLength=0);if(this.nextMinLevel===0)return this.nextMinLevel=t,void(this.nextMinLevelWindowLength=1);if(this.nextMinLevel>t&&(this.nextMinLevel=t),this.nextMinLevelWindowLength++,this.nextMinLevelWindowLength>=750){let n=Math.sqrt(this.minLevel*this.nextMinLevel);n<0?n=0:n>KS&&(n=KS),this.minLevel=n,this.nextMinLevel=0,this.nextMinLevelWindowLength=0}}}}class RY{constructor(t){ne(this,"algorithm",void 0),this.algorithm=t}execute(){let t=!this.algorithm;if(!t)try{const n=this.algorithm.runInDecisionMaker(this);n<=0?t=!0:setTimeout(this.execute.bind(this),n)}catch{t=!0}t&&this.algorithm&&this.algorithm.decisionMakerExited(this)}}class kb{constructor(t,n,r){ne(this,"isDominant",void 0),ne(this,"energyRanking",void 0),ne(this,"energyScore",void 0),this.isDominant=t,this.energyRanking=n,this.energyScore=r}}class CY extends Pn{constructor(t){super(),ne(this,"dominantId",null),ne(this,"lastDecisionTime",0),ne(this,"lastLevelChangedTime",0),ne(this,"lastLevelIdleTime",0),ne(this,"relativeSpeechActivities",[]),ne(this,"speakers",new Map),ne(this,"enableSilence",!1),ne(this,"timeoutToSilenceInterval",0),ne(this,"decisionMaker",null),ne(this,"loudest",[]),ne(this,"numLoudestToTrack",3),ne(this,"energyExpireTimeMs",250),ne(this,"energyAlphaPct",50),this.timeoutToSilenceInterval=t,this.enableSilence=t>0,this.relativeSpeechActivities.length=3}setLoudestConfig(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:3,n=arguments.length>1?arguments[1]:void 0,r=arguments.length>2?arguments[2]:void 0;this.numLoudestToTrack=t,n!=null&&(this.energyExpireTimeMs=n),r!=null&&(this.energyAlphaPct=r),this.loudest.length>t&&this.loudest.splice(t)}getDominantSpeaker(){return this.dominantId}isAmongLoudest(t){return this.loudest.some((n=>n.id===t))}levelChanged(t,n){const r=Date.now(),i=this.getOrCreateSpeaker(t);this.lastLevelChangedTime<r&&(this.lastLevelChangedTime=r,this.maybeStartDecisionMaker());const s=i.levelChanged(n,r);return this.updateLoudestList(i,s,r)}runInDecisionMaker(t){return this.decisionMaker!==t||this.lastDecisionTime>0&&this.lastDecisionTime-this.lastLevelChangedTime>=15e3?-1:this._runInDecisionMaker()}decisionMakerExited(t){this.decisionMaker===t&&(this.decisionMaker=null)}destroy(){this.decisionMaker=null,this.loudest.length=0,this.speakers.clear(),this.removeAllListeners()}addSpeakers(t){t.forEach((n=>{this.speakers.has(n.id)||this.speakers.set(n.id,n)}))}removeSpeakers(t){t.forEach((n=>{this.speakers.delete(n.id)}))}getOrCreateSpeaker(t){let n=this.speakers.get(t);return n||(n=new SM(t),this.speakers.set(t,n),this.maybeStartDecisionMaker()),n}updateLoudestList(t,n,r){const i=t.id===this.dominantId;if(n<0){let l=0;for(;l<this.loudest.length&&this.loudest[l]!==t;)++l;return new kb(i,l,t.energyScore)}if(t.energyScore=Math.floor((this.energyAlphaPct*n+(100-this.energyAlphaPct)*t.energyScore+50)/100),this.numLoudestToTrack===0)return new kb(i,0,t.energyScore);const s=r-this.energyExpireTimeMs;let o=0;for(;o<this.loudest.length;){const l=this.loudest[o];if(l.getLastLevelChangedTime()<s&&this.loudest.length>=this.numLoudestToTrack)this.loudest.splice(o,1);else if(l.id!==t.id)++o;else if(this.loudest.splice(o,1),this.loudest.length<this.numLoudestToTrack)break}let c=0;for(;c<this.loudest.length&&!(this.loudest[c].energyScore<t.energyScore);)++c;return c<this.numLoudestToTrack&&(this.loudest.splice(c,0,t),this.loudest.length>this.numLoudestToTrack&&this.loudest.splice(this.numLoudestToTrack,1)),new kb(i,c,t.energyScore)}maybeStartDecisionMaker(){!this.decisionMaker&&this.speakers.size>0&&(this.decisionMaker=new RY(this),this.decisionMaker.execute())}makeDecision(t){let n=null,r=null;const i=this.speakers.size;let s=null;if(i===0)s=null;else if(i===1){var o;const c=ps(o=this.speakers).call(o).next().value;this.enableSilence&&c&&(s=c.id,c.evaluateSpeechActivityScores(t),t-c.lastNonSilence>this.timeoutToSilenceInterval&&(s=null))}else{let c=this.dominantId==null?null:this.speakers.get(this.dominantId);if(c==null){const p=this.speakers.entries().next();p.value&&(s=p.value[0],c=p.value[1])}else s=c.id;c?.evaluateSpeechActivityScores(t);const l=this.relativeSpeechActivities;let h=2;for(const p of this.speakers.entries()){const[E,g]=p;if(g===c)continue;g.evaluateSpeechActivityScores(t);for(let N=0;N<l.length;++N){const M=c==null?Sh:c.getSpeechActivityScore(N);l[N]=Math.log(g.getSpeechActivityScore(N)/M)}const v=l[0],O=l[1],I=l[2];v>3&&O>2&&I>0&&O>h&&(h=O,s=E)}this.enableSilence&&c!=null&&s===c.id&&t-c.lastNonSilence>this.timeoutToSilenceInterval&&(s=null)}s==null&&!this.enableSilence||s===this.dominantId||(n=this.dominantId,this.dominantId=s,r=this.dominantId),r==null&&!this.enableSilence||r===n||this.emit("ActiveSpeakerChanged",r)}_runInDecisionMaker(){const t=Date.now(),n=300-(t-this.lastLevelIdleTime);let r=0;n<=0?(this.lastLevelIdleTime!==0&&this.timeoutIdleLevels(t),this.lastLevelIdleTime=t):r=n;let i=300-(t-this.lastDecisionTime);return i<=0&&(this.lastDecisionTime=t,this.makeDecision(t),i=300-(Date.now()-t)),i>0&&r>i&&(r=i),r}timeoutIdleLevels(t){const n=[];for(const i of ps(r=this.speakers).call(r)){var r;const s=t-i.getLastLevelChangedTime();36e5<s&&(this.dominantId==null||i.id!==this.dominantId)?n.push(i.id):300<s&&i.levelTimedOut()}n.forEach((i=>this.speakers.delete(i)))}}const Vf=new Map;let Ca=null,YS=null;const TM=3;let Th=[];const wa=new Map,qS=new Map;class wY{get samples(){return this.actives+this.inactives}get activeRate(){return this.actives/this.samples}constructor(t,n){ne(this,"id",void 0),ne(this,"track",void 0),ne(this,"score",0),ne(this,"active",!0),ne(this,"muted",!1),ne(this,"timer",0),ne(this,"actives",0),ne(this,"inactives",0),this.id=t,this.track=n,this.setActive(wa.size<3)}autoCheckActive(){this.autoSetActive(),this.autoAdjustActive(),this.resetTimer(),this.actives=0,this.inactives=0}autoSetActive(){const t=this.active;this.active=this.activeRate>=.8;const{actives:n,inactives:r}=(function(){const i=[],s=[];return Array.from(ps(wa).call(wa)).forEach((o=>{o.active?i.push(o):s.push(o)})),{actives:i,inactives:s}})();if(n.length>3){let i;n.forEach((s=>{(!i||i.score>s.score)&&(i=s)})),i&&i.setActive(!1)}if(n.length<3&&r.length>0){let i;r.forEach((s=>{(!i||i.score<s.score)&&s.id!==this.id&&(i=s)})),i&&t&&!this.active&&(i.samples>40&&i.activeRate-this.activeRate>.4?i.setActive(!0):this.active=!0)}this.setMuted(!this.active)}setActive(t){this.active=t,this.resetTimer(),this.setMuted(!t)}autoAdjustActive(){this.active?this.autoSwitchToInactive():this.autoSwitchToActive()}autoSwitchToActive(){const t=(function(n){let r;return Array.from(ps(wa).call(wa)).forEach((i=>{!i.active||i.id===n||i.samples<40||(!r||i.score<r.score)&&(r=i)})),r})(this.id);t&&this.activeRate-t.activeRate>.4&&(t.setActive(!1),this.setActive(!0))}autoSwitchToInactive(){const t=(function(n){let r;return Array.from(ps(wa).call(wa)).forEach((i=>{i.active||i.id===n||i.samples<40||(!r||i.score>r.score)&&(r=i)})),r})(this.id);t&&t.activeRate-this.activeRate>.4&&(t.setActive(!0),this.setActive(!1))}addSample(t){t?this.actives+=1:this.inactives+=1,this.samples>66.66666666666667&&this.autoCheckActive()}setMuted(t){this.track&&(this.track.enabled=!t,this.muted=t)}resetTimer(){this.clearTimer(),this.timer=window.setTimeout((()=>{if(this.samples!==0)return this.samples<50?this.resetTimer():void this.autoCheckActive()}),1e3)}clearTimer(){this.timer&&(clearTimeout(this.timer),this.timer=0)}}let XS;function RM(e){const t=wa.get(e);t&&(wa.delete(e),t.clearTimer())}const JS=new Map,bY=new Map,Lb="video/h264",xb="video/h265";function CM(e,t,n){let r=new Uint8Array(e,t,n),i=[],s=0;for(;i.length<n;)s+3<n&&r[s]===0&&r[s+1]===0&&r[s+2]===3&&(r[s+3]===0||r[s+3]===1||r[s+3]===2||r[s+3]===3)?(i.push(r[s],r[s+1],r[s+3]),s+=4):(i.push(r[s]),s++);return new Uint8Array(i)}function wM(e){const t=e.length;let n=[],r=0;for(;r<t;)r+2<t&&e[r]===0&&e[r+1]===0&&(e[r+2]===0||e[r+2]===1||e[r+2]===2||e[r+2]===3)?(n.push(e[r],e[r+1],3,e[r+2]),r+=3):(n.push(e[r]),r++);return new Uint8Array(n)}function bM(e){if(e.length<5)return"";let t=-1;for(let i=0;i<e.length-3;i++){if(e[i]===0&&e[i+1]===0&&e[i+2]===1){t=i;break}if(i<e.length-4&&e[i]===0&&e[i+1]===0&&e[i+2]===0&&e[i+3]===1){t=i;break}}if(t===-1)return"";const n=t+(e[t+2]===0?4:3);if(n>=e.length)return"";const r=e[n];return 128&r?"":(r>>1&63)>=32||n+1<e.length&&(248&e[n+1])==0?xb:(31&r)<=31?Lb:""}const QS=new Map,zE=new Map;(function(){const e=xt();kr.getDisplayMedia=!(!navigator.mediaDevices||!navigator.mediaDevices.getDisplayMedia),kr.getStreamFromExtension=e.name===Gt.CHROME&&Number(e.version)>34,kr.supportUnifiedPlan=(function(){if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;const t=new RTCPeerConnection;let n=!1;try{t.addTransceiver("audio"),n=!0}catch{}return t.close(),n})(),kr.supportMinBitrate=e.name===Gt.CHROME||e.name===Gt.EDGE,kr.supportSetRtpSenderParameters=(function(){const t=xt();return!!(window.RTCRtpSender&&window.RTCRtpSender.prototype.setParameters&&window.RTCRtpSender.prototype.getParameters)&&(!!ml()||!(!Vr()&&!bS())||t.name===Gt.FIREFOX&&Number(t.version)>=64)})(),e.name===Gt.SAFARI&&(Number(e.version)>=14?kr.supportDualStream=!0:kr.supportDualStream=!1),kr.webAudioMediaStreamDest=(function(){const t=xt();return!(t.name===Gt.SAFARI&&Number(t.version)<12)})(),kr.supportReplaceTrack=!!window.RTCRtpSender&&typeof RTCRtpSender.prototype.replaceTrack=="function",kr.supportWebGL=typeof WebGLRenderingContext<"u",kr.supportRequestFrame=!!window.CanvasCaptureMediaStreamTrack,ml()||(kr.webAudioWithAEC=!0),kr.supportShareAudio=(function(){const t=xt();return(t.os===Er.WIN_10||t.os===Er.WIN_81||t.os===Er.WIN_7||t.os===Er.LINUX||t.os===Er.MAC_OS||t.os===Er.CHROMIUM_OS)&&t.name===Gt.CHROME&&Number(t.version)>=74})(),kr.supportDataChannel=!!(yf(76)||F0(68)||w1(14)),kr.supportPCSetConfiguration=(function(){const t=window.RTCPeerConnection;return!xn()&&!!t&&t.prototype.setConfiguration instanceof Function})(),kr.supportWebRTCEncodedTransform=yf(87)||T1()||F0(117),kr.supportWebRTCInsertableStream=(function(){const t=xt();return(t.name===Gt.CHROME||t.name===Gt.EDGE)&&Number(t.version)>=94&&"MediaStreamTrackGenerator"in window&&"MediaStreamTrackProcessor"in window})(),kr.supportRequestVideoFrameCallback="requestVideoFrameCallback"in HTMLVideoElement.prototype,kr.supportWebCrypto=typeof window<"u"&&window.crypto!==void 0&&window.crypto.subtle!==void 0,NS((()=>{kr.supportDualStreamEncoding=(function(){const t=xt();return!!F("DISABLE_WEBAUDIO")||t.name==="Safari"&&Number(t.version)>=14||!!(t.name==="Chrome"&&/Windows/i.test(t.os||"")&&Number(t.version)>=100&&F("CHROME_DUAL_STREAM_USE_ENCODING"))})(),R.debug("browser ua: ",navigator.userAgent),R.info("browser info: ",e),R.info("browser compatibility: ",kr)}))})();const IY=["CHINA","GLOBAL"],IM=[[0,1,2,3,4,5,5],[0,2,2,3,4,5,5],[0,3,3,3,4,5,5],[0,4,4,4,4,5,5],[0,5,5,5,5,5,5]],Rh=[],jf=[];function Ch(e,t){return!!t&&Rh.some((n=>n.uid===e&&n.channelName===t))}function Mb(){return jf.length>0}var AY=BD.forEach,AM=Su("forEach")?[].forEach:function(e){return AY(this,e,arguments.length>1?arguments[1]:void 0)};Jt({target:"Array",proto:!0,forced:[].forEach!==AM},{forEach:AM});var NY=as("Array","forEach"),OY=$o,PY=Tr,DY=ee,kY=NY,Ub=Array.prototype,LY={DOMTokenList:!0,NodeList:!0},xY=function(e){var t=e.forEach;return e===Ub||DY(Ub,e)&&t===Ub.forEach||PY(LY,OY(e))?kY:t},MY=C(xY),UY=So,NM=ki;Jt({target:"Object",stat:!0,forced:A((function(){NM(1)}))},{keys:function(e){return NM(UY(e))}});var VY=C(ai.Object.keys),jY=C(tr),FY=C(bu),BY=Jt,OM=ea,WY=Ur,GY=Sr,PM=Gm,HY=Qa,KY=Ei,zY=Sw,YY=kn,qY=Nr,XY=PD("slice"),JY=YY("species"),Vb=Array,QY=Math.max;BY({target:"Array",proto:!0,forced:!XY},{slice:function(e,t){var n,r,i,s=KY(this),o=HY(s),c=PM(e,o),l=PM(t===void 0?o:t,o);if(OM(s)&&(n=s.constructor,(WY(n)&&(n===Vb||OM(n.prototype))||GY(n)&&(n=n[JY])===null)&&(n=void 0),n===Vb||n===void 0))return qY(s,c,l);for(r=new(n===void 0?Vb:n)(QY(l-c,0)),i=0;c<l;c++,i++)c in s&&zY(r,i,s[c]);return r.length=i,r}});var ZY=as("Array","slice"),$Y=ee,e9=ZY,jb=Array.prototype,t9=function(e){var t=e.slice;return e===jb||$Y(jb,e)&&t===jb.slice?e9:t},n9=C(t9);function Be(e,t,n,r,i){var s,o,c,l={};return MY(s=VY(r)).call(s,(function(h){l[h]=r[h]})),l.enumerable=!!l.enumerable,l.configurable=!!l.configurable,("value"in l||l.initializer)&&(l.writable=!0),l=jY(o=FY(c=n9(n).call(n)).call(c)).call(o,(function(h,p){return p(e,t,h)||h}),l),i&&l.initializer!==void 0&&(l.value=l.initializer?l.initializer.call(i):void 0,l.initializer=void 0),l.initializer===void 0?(ID(e,t,l),null):l}let ZS=(function(e){return e[e.ACCESS_POINT=101]="ACCESS_POINT",e[e.UNILBS=201]="UNILBS",e[e.STRING_UID_ALLOCATOR=901]="STRING_UID_ALLOCATOR",e})({}),Fb=(function(e){return e[e.IIIEGAL_APPID=1]="IIIEGAL_APPID",e[e.IIIEGAL_UID=2]="IIIEGAL_UID",e[e.INTERNAL_ERROR=3]="INTERNAL_ERROR",e})({}),Wo=(function(e){return e[e.INVALID_VENDOR_KEY=5]="INVALID_VENDOR_KEY",e[e.INVALID_CHANNEL_NAME=7]="INVALID_CHANNEL_NAME",e[e.INTERNAL_ERROR=8]="INTERNAL_ERROR",e[e.NO_AUTHORIZED=9]="NO_AUTHORIZED",e[e.DYNAMIC_KEY_TIMEOUT=10]="DYNAMIC_KEY_TIMEOUT",e[e.NO_ACTIVE_STATUS=11]="NO_ACTIVE_STATUS",e[e.DYNAMIC_KEY_EXPIRED=13]="DYNAMIC_KEY_EXPIRED",e[e.STATIC_USE_DYNAMIC_KEY=14]="STATIC_USE_DYNAMIC_KEY",e[e.DYNAMIC_USE_STATIC_KEY=15]="DYNAMIC_USE_STATIC_KEY",e[e.USER_OVERLOAD=16]="USER_OVERLOAD",e[e.FORBIDDEN_REGION=18]="FORBIDDEN_REGION",e[e.CANNOT_MEET_AREA_DEMAND=19]="CANNOT_MEET_AREA_DEMAND",e})({}),bi=(function(e){return e[e.NO_FLAG_SET=100]="NO_FLAG_SET",e[e.FLAG_SET_BUT_EMPTY=101]="FLAG_SET_BUT_EMPTY",e[e.INVALID_FALG_SET=102]="INVALID_FALG_SET",e[e.FLAG_SET_BUT_NO_RE=103]="FLAG_SET_BUT_NO_RE",e[e.INVALID_SERVICE_ID=104]="INVALID_SERVICE_ID",e[e.NO_SERVICE_AVAILABLE=200]="NO_SERVICE_AVAILABLE",e[e.NO_SERVICE_AVAILABLE_P2P=201]="NO_SERVICE_AVAILABLE_P2P",e[e.NO_SERVICE_AVAILABLE_VOICE=202]="NO_SERVICE_AVAILABLE_VOICE",e[e.NO_SERVICE_AVAILABLE_WEBRTC=203]="NO_SERVICE_AVAILABLE_WEBRTC",e[e.NO_SERVICE_AVAILABLE_CDS=204]="NO_SERVICE_AVAILABLE_CDS",e[e.NO_SERVICE_AVAILABLE_CDN=205]="NO_SERVICE_AVAILABLE_CDN",e[e.NO_SERVICE_AVAILABLE_TDS=206]="NO_SERVICE_AVAILABLE_TDS",e[e.NO_SERVICE_AVAILABLE_REPORT=207]="NO_SERVICE_AVAILABLE_REPORT",e[e.NO_SERVICE_AVAILABLE_APP_CENTER=208]="NO_SERVICE_AVAILABLE_APP_CENTER",e[e.NO_SERVICE_AVAILABLE_ENV0=209]="NO_SERVICE_AVAILABLE_ENV0",e[e.NO_SERVICE_AVAILABLE_VOET=210]="NO_SERVICE_AVAILABLE_VOET",e[e.NO_SERVICE_AVAILABLE_STRING_UID=211]="NO_SERVICE_AVAILABLE_STRING_UID",e[e.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS=212]="NO_SERVICE_AVAILABLE_WEBRTC_UNILBS",e[e.NO_SERVICE_AVAILABLE_UNILBS_FLV=213]="NO_SERVICE_AVAILABLE_UNILBS_FLV",e})({}),Ze=(function(e){return e[e.K_TIMESTAMP_EXPIRED=2]="K_TIMESTAMP_EXPIRED",e[e.K_CHANNEL_PERMISSION_INVALID=3]="K_CHANNEL_PERMISSION_INVALID",e[e.K_CERTIFICATE_INVALID=4]="K_CERTIFICATE_INVALID",e[e.K_CHANNEL_NAME_EMPTY=5]="K_CHANNEL_NAME_EMPTY",e[e.K_CHANNEL_NOT_FOUND=6]="K_CHANNEL_NOT_FOUND",e[e.K_TICKET_INVALID=7]="K_TICKET_INVALID",e[e.K_CHANNEL_CONFLICTED=8]="K_CHANNEL_CONFLICTED",e[e.K_SERVICE_NOT_READY=9]="K_SERVICE_NOT_READY",e[e.K_SERVICE_TOO_HEAVY=10]="K_SERVICE_TOO_HEAVY",e[e.K_UID_BANNED=14]="K_UID_BANNED",e[e.K_IP_BANNED=15]="K_IP_BANNED",e[e.K_CHANNEL_BANNED=16]="K_CHANNEL_BANNED",e[e.DATASTREAM2_NOT_AVAILABLE=27]="DATASTREAM2_NOT_AVAILABLE",e[e.K_AUTO_REBALANCE=28]="K_AUTO_REBALANCE",e[e.WARN_NO_AVAILABLE_CHANNEL=103]="WARN_NO_AVAILABLE_CHANNEL",e[e.WARN_LOOKUP_CHANNEL_TIMEOUT=104]="WARN_LOOKUP_CHANNEL_TIMEOUT",e[e.WARN_LOOKUP_CHANNEL_REJECTED=105]="WARN_LOOKUP_CHANNEL_REJECTED",e[e.WARN_OPEN_CHANNEL_TIMEOUT=106]="WARN_OPEN_CHANNEL_TIMEOUT",e[e.WARN_OPEN_CHANNEL_REJECTED=107]="WARN_OPEN_CHANNEL_REJECTED",e[e.WARN_REQUEST_DEFERRED=108]="WARN_REQUEST_DEFERRED",e[e.ERR_DYNAMIC_KEY_TIMEOUT=109]="ERR_DYNAMIC_KEY_TIMEOUT",e[e.ERR_NO_AUTHORIZED=110]="ERR_NO_AUTHORIZED",e[e.ERR_VOM_SERVICE_UNAVAILABLE=111]="ERR_VOM_SERVICE_UNAVAILABLE",e[e.ERR_NO_CHANNEL_AVAILABLE_CODE=112]="ERR_NO_CHANNEL_AVAILABLE_CODE",e[e.ERR_MASTER_VOCS_UNAVAILABLE=114]="ERR_MASTER_VOCS_UNAVAILABLE",e[e.ERR_INTERNAL_ERROR=115]="ERR_INTERNAL_ERROR",e[e.ERR_NO_ACTIVE_STATUS=116]="ERR_NO_ACTIVE_STATUS",e[e.ERR_INVALID_UID=117]="ERR_INVALID_UID",e[e.ERR_DYNAMIC_KEY_EXPIRED=118]="ERR_DYNAMIC_KEY_EXPIRED",e[e.ERR_STATIC_USE_DYANMIC_KE=119]="ERR_STATIC_USE_DYANMIC_KE",e[e.ERR_DYNAMIC_USE_STATIC_KE=120]="ERR_DYNAMIC_USE_STATIC_KE",e[e.ERR_NO_VOCS_AVAILABLE=2e3]="ERR_NO_VOCS_AVAILABLE",e[e.ERR_NO_VOS_AVAILABLE=2001]="ERR_NO_VOS_AVAILABLE",e[e.ERR_JOIN_CHANNEL_TIMEOUT=2002]="ERR_JOIN_CHANNEL_TIMEOUT",e[e.ERR_REPEAT_JOIN_CHANNEL=2003]="ERR_REPEAT_JOIN_CHANNEL",e[e.ERR_JOIN_BY_MULTI_IP=2004]="ERR_JOIN_BY_MULTI_IP",e[e.ERR_NOT_JOINED=2011]="ERR_NOT_JOINED",e[e.ERR_REPEAT_JOIN_REQUEST=2012]="ERR_REPEAT_JOIN_REQUEST",e[e.ERR_INVALID_VENDOR_KEY=2013]="ERR_INVALID_VENDOR_KEY",e[e.ERR_INVALID_CHANNEL_NAME=2014]="ERR_INVALID_CHANNEL_NAME",e[e.ERR_INVALID_STRINGUID=2015]="ERR_INVALID_STRINGUID",e[e.ERR_TOO_MANY_USERS=2016]="ERR_TOO_MANY_USERS",e[e.ERR_SET_CLIENT_ROLE_TIMEOUT=2017]="ERR_SET_CLIENT_ROLE_TIMEOUT",e[e.ERR_SET_CLIENT_ROLE_NO_PERMISSION=2018]="ERR_SET_CLIENT_ROLE_NO_PERMISSION",e[e.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE=2019]="ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",e[e.ERR_PUBLISH_REQUEST_INVALID=2020]="ERR_PUBLISH_REQUEST_INVALID",e[e.ERR_SUBSCRIBE_REQUEST_INVALID=2021]="ERR_SUBSCRIBE_REQUEST_INVALID",e[e.ERR_NOT_SUPPORTED_MESSAGE=2022]="ERR_NOT_SUPPORTED_MESSAGE",e[e.ERR_ILLEAGAL_PLUGIN=2023]="ERR_ILLEAGAL_PLUGIN",e[e.ERR_REJOIN_TOKEN_INVALID=2024]="ERR_REJOIN_TOKEN_INVALID",e[e.ERR_REJOIN_USER_NOT_JOINED=2025]="ERR_REJOIN_USER_NOT_JOINED",e[e.ERR_INVALID_OPTIONAL_INFO=2027]="ERR_INVALID_OPTIONAL_INFO",e[e.ILLEGAL_AES_PASSWORD=2028]="ILLEGAL_AES_PASSWORD",e[e.ILLEGAL_CLIENT_ROLE_LEVEL=2029]="ILLEGAL_CLIENT_ROLE_LEVEL",e[e.ERR_TOO_MANY_BROADCASTERS=2031]="ERR_TOO_MANY_BROADCASTERS",e[e.ERR_TOO_MANY_SUBSCRIBERS=2032]="ERR_TOO_MANY_SUBSCRIBERS",e[e.ERR_LICENSE_MISSING=32769]="ERR_LICENSE_MISSING",e[e.ERR_LICENSE_EXPIRED=32771]="ERR_LICENSE_EXPIRED",e[e.ERR_LICENSE_MINUTES_EXCEEDED=32773]="ERR_LICENSE_MINUTES_EXCEEDED",e[e.ERR_LICENSE_PERIOD_INVALID=32774]="ERR_LICENSE_PERIOD_INVALID",e[e.ERR_LICENSE_MULTIPLE_SDK_SERVICE=32778]="ERR_LICENSE_MULTIPLE_SDK_SERVICE",e[e.ERR_LICENSE_ILLEGAL=32783]="ERR_LICENSE_ILLEGAL",e[e.ERR_TEST_RECOVER=9e3]="ERR_TEST_RECOVER",e[e.ERR_TEST_TRYNEXT=9001]="ERR_TEST_TRYNEXT",e[e.ERR_TEST_RETRY=9002]="ERR_TEST_RETRY",e})({}),_n=(function(e){return e.CONNECTING="connecting",e.CONNECTED="connected",e.RECONNECTING="reconnecting",e.CLOSED="closed",e})({}),at=(function(e){return e.WS_CONNECTED="ws_connected",e.WS_RECONNECTING="ws_reconnecting",e.WS_CLOSED="ws_closed",e.WS_RECONNECT_CREATE_CONNECTION="ws_reconnect_create_connection",e.ON_BINARY_DATA="on_binary_data",e.REQUEST_RECOVER="request_recover",e.REQUEST_JOIN_INFO="request_join_info",e.REQUEST_REJOIN_INFO="req_rejoin_info",e.IS_P2P_DISCONNECTED="is_p2p_dis",e.DISCONNECT_P2P="dis_p2p",e.ABORT_P2P_EXECUTION="abort_p2p_execution",e.NEED_RENEW_SESSION="need-sid",e.REPORT_JOIN_GATEWAY="report_join_gateway",e.REQUEST_TIMEOUT="request_timeout",e.REQUEST_SUCCESS="request_success",e.JOIN_RESPONSE="join_response",e.PRE_CONNECT_PC="pre_connect_pc",e.P2P_CONNECTION="p2p_connection",e.P2P_REMOTE_CANDIDATE_UPDATE="p2p_remote_candidate_update",e.P2P_SUBSCRIBE="p2p_subscribe",e.P2P_UNSUBSCRIBE="p2p_unsubscribe",e.P2P_EXCHANGE_SDP="p2p_exchange_sdp",e.P2P_ON_ADD_VIDEO_STREAM="p2p_on_add_video_stream",e.P2P_ON_ADD_AUDIO_STREAM="p2p_on_add_audio_stream",e.RECOVER_NOTIFICATION="recover_notification",e})({}),st=(function(e){return e.PING="ping",e.PING_BACK="ping_back",e.JOIN="join_v3",e.REJOIN="rejoin_v3",e.LEAVE="leave",e.SET_CLIENT_ROLE="set_client_role",e.PUBLISH="publish",e.PUBLISH_DATASTREAM="publish_datastream",e.UNPUBLISH="unpublish",e.UNPUBLISH_DATASTREAM="unpublish_datastream",e.SUBSCRIBE="subscribe",e.PRE_SUBSCRIBE="pre_subscribe",e.SUBSCRIBE_DATASTREAM="subscribe_datastream",e.SUBSCRIBE_STREAMS="subscribe_streams",e.UNSUBSCRIBE="unsubscribe",e.UNSUBSCRIBE_DATASTREAM="unsubscribe_datastream",e.UNSUBSCRIBE_STREAMS="unsubscribe_streams",e.SUBSCRIBE_CHANGE="subscribe_change",e.TRAFFIC_STATS="traffic_stats",e.RENEW_TOKEN="renew_token",e.SWITCH_VIDEO_STREAM="switch_video_stream",e.DEFAULT_VIDEO_STREAM="default_video_stream",e.SET_FALLBACK_OPTION="set_fallback_option",e.GATEWAY_INFO="gateway_info",e.CONTROL="control",e.SEND_METADATA="send_metadata",e.DATA_STREAM="data_stream",e.PICK_SVC_LAYER="pick_svc_layer",e.RESTART_ICE="restart_ice",e.CONNECT_PC="connect_pc",e.SET_VIDEO_PROFILE="set_video_profile",e.SET_PARAMETER="set_parameter",e.SET_RTM2_FLAG="set_rtm2_flag",e.DOWNGRADE_CODEC="downgrade_codec",e})({}),YE=(function(e){return e.WRTC_STATS="wrtc_stats",e.WS_INFLATE_DATA_LENGTH="ws_inflate_data_length",e.DENOISER_STATS="denoiser_stats",e.EXTENSION_USAGE_STATS="extension_usage_stats",e})({}),Pt=(function(e){return e.ON_USER_ONLINE="on_user_online",e.ON_USER_OFFLINE="on_user_offline",e.ON_STREAM_FALLBACK_UPDATE="on_stream_fallback_update",e.ON_PUBLISH_STREAM="on_publish_stream",e.ON_UPLINK_STATS="on_uplink_stats",e.ON_P2P_LOST="on_p2p_lost",e.ON_REMOVE_STREAM="on_remove_stream",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="on_token_privilege_will_expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="on_token_privilege_did_expire",e.ON_USER_BANNED="on_user_banned",e.ON_USER_LICENSE_BANNED="on_user_license_banned",e.ON_NOTIFICATION="on_notification",e.ON_CRYPT_ERROR="on_crypt_error",e.MUTE_AUDIO="mute_audio",e.MUTE_VIDEO="mute_video",e.UNMUTE_AUDIO="unmute_audio",e.UNMUTE_VIDEO="unmute_video",e.ON_P2P_OK="on_p2p_ok",e.RECEIVE_METADATA="receive_metadata",e.ON_DATA_STREAM="on_data_stream",e.ON_RTP_CAPABILITY_CHANGE="on_rtp_capability_change",e.ON_REMOTE_DATASTREAM_UPDATE="on_remote_datastream_update",e.ON_REMOTE_FULL_DATASTREAM_INFO="on_remote_full_datastream_info",e.ENABLE_LOCAL_VIDEO="enable_local_video",e.DISABLE_LOCAL_VIDEO="disable_local_video",e.ENABLE_LOCAL_AUDIO="enable_local_audio",e.DISABLE_LOCAL_AUDIO="disable_local_audio",e.ON_PUBLISHED_USER_LIST="on_published_user_list",e})({}),Ii=(function(e){return e.SEND_ONLY="SEND_ONLY",e.RECEIVE_ONLY="RECEIVE_ONLY",e})({}),gt=(function(e){return e.CONNECTED="websocket:connected",e.RECONNECTING="websocket:reconnecting",e.WILL_RECONNECT="websocket:will_reconnect",e.CLOSED="websocket:closed",e.FAILED="websocket:failed",e.ON_MESSAGE="websocket:on_message",e.REQUEST_NEW_URLS="websocket:request_new_urls",e.RECONNECT_CREATE_CONNECTION="websocket:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="websocket:on_token_privilege_did_expire",e})({});function $S(e){if(typeof e!="string"||!/^[a-zA-Z0-9 \!\#\$\%\&\(\)\+\-\:\;\<\=\.\>\?\@\[\]\^\_\{\}\|\~\,]{1,64}$/.test(e))throw R.error("Invalid Channel Name ".concat(e)),new se(U.INVALID_PARAMS,"The length must be within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,")}function eT(e){if(t=e,!(typeof t=="number"&&Math.floor(t)===t&&0<=t&&t<=4294967295||k1(e,1,255)))throw new se(U.INVALID_PARAMS,"[String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]");var t;typeof e=="string"&&R.warn("You input a string as the user ID, to ensure better end-user experience, Agora highly suggests not using a string as the user ID.")}let El=(function(e){return e.TRANSCODE="mix_streaming",e.RAW="raw_streaming",e})({});const r9={alpha:1,height:640,width:360,x:0,y:0,zOrder:0,audioChannel:0},Bb={x:0,y:0,width:160,height:160,zOrder:255,alpha:1};function Wb(e,t){Pr(e.url,"".concat(t,".url"),1,1e3,!1),Mn(e.x)||on(e.x,"".concat(t,".x"),0,1e4),Mn(e.y)||on(e.y,"".concat(t,".y"),0,1e4),Mn(e.width)||on(e.width,"".concat(t,".width"),0,1e4),Mn(e.height)||on(e.height,"".concat(t,".height"),0,1e4),Mn(e.zOrder)||on(e.zOrder,"".concat(t,".zOrder"),0,255),Mn(e.alpha)||on(e.alpha,"".concat(t,".alpha"),0,1,!1)}const i9={audioBitrate:48,audioChannels:1,audioSampleRate:48e3,backgroundColor:0,height:360,lowLatency:!1,videoBitrate:400,videoCodecProfile:100,videoCodecType:1,videoFrameRate:15,videoGop:30,width:640,images:[],userConfigs:[],userConfigExtraInfo:""};let Nd=(function(e){return e.WARNING="@live_uap-warning",e.ERROR="@line_uap-error",e.PUBLISH_STREAM_STATUS="@live_uap-publish-status",e.WORKER_STATUS="@live_uap-worker-status",e.REQUEST_NEW_ADDRESS="@live_uap-request-address",e})({}),Gb=(function(e){return e.REQUEST_WORKER_MANAGER_LIST="@live_req_worker_manager",e})({}),cr=(function(e){return e[e.LIVE_STREAM_RESPONSE_SUCCEED=200]="LIVE_STREAM_RESPONSE_SUCCEED",e[e.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM=454]="LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM",e[e.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR=450]="LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_BAD_STREAM=451]="LIVE_STREAM_RESPONSE_BAD_STREAM",e[e.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR=400]="LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST=404]="LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST",e[e.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED=456]="LIVE_STREAM_RESPONSE_NOT_AUTHORIZED",e[e.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE=457]="LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE",e[e.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN=429]="LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN",e[e.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH=452]="LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH",e[e.LIVE_STREAM_RESPONSE_NOT_SUPPORTED=453]="LIVE_STREAM_RESPONSE_NOT_SUPPORTED",e[e.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM=455]="LIVE_STREAM_RESPONSE_MAX_STREAM_NUM",e[e.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR=500]="LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR",e[e.LIVE_STREAM_RESPONSE_WORKER_LOST=501]="LIVE_STREAM_RESPONSE_WORKER_LOST",e[e.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT=502]="LIVE_STREAM_RESPONSE_RESOURCE_LIMIT",e[e.LIVE_STREAM_RESPONSE_WORKER_QUIT=503]="LIVE_STREAM_RESPONSE_WORKER_QUIT",e[e.ERROR_FAIL_SEND_MESSAGE=504]="ERROR_FAIL_SEND_MESSAGE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE=30]="PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT=31]="PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH=32]="PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH",e[e.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN=33]="PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN",e})({});function DM(e){if(!e.channelName)throw new se(U.INVALID_PARAMS,"invalid channelName in info");if(typeof e.uid!="number")throw new se(U.INVALID_PARAMS,"invalid uid in info, uid must be a number");return e.token&&Pr(e.token,"info.token",1,2047),eT(e.uid),$S(e.channelName),!0}let Ai=(function(e){return e[e.SetSdkProfile=0]="SetSdkProfile",e[e.SetSourceChannel=1]="SetSourceChannel",e[e.SetSourceUserId=2]="SetSourceUserId",e[e.SetDestChannel=3]="SetDestChannel",e[e.StartPacketTransfer=4]="StartPacketTransfer",e[e.StopPacketTransfer=5]="StopPacketTransfer",e[e.UpdateDestChannel=6]="UpdateDestChannel",e[e.Reconnect=7]="Reconnect",e[e.SetVideoProfile=8]="SetVideoProfile",e})({}),gl=(function(e){return e.NETWORK_DISCONNECTED="NETWORK_DISCONNECTED",e.NETWORK_CONNECTED="NETWORK_CONNECTED",e.PACKET_JOINED_SRC_CHANNEL="PACKET_JOINED_SRC_CHANNEL",e.PACKET_JOINED_DEST_CHANNEL="PACKET_JOINED_DEST_CHANNEL",e.PACKET_SENT_TO_DEST_CHANNEL="PACKET_SENT_TO_DEST_CHANNEL",e.PACKET_RECEIVED_VIDEO_FROM_SRC="PACKET_RECEIVED_VIDEO_FROM_SRC",e.PACKET_RECEIVED_AUDIO_FROM_SRC="PACKET_RECEIVED_AUDIO_FROM_SRC",e.PACKET_UPDATE_DEST_CHANNEL="PACKET_UPDATE_DEST_CHANNEL",e.PACKET_UPDATE_DEST_CHANNEL_REFUSED="PACKET_UPDATE_DEST_CHANNEL_REFUSED",e.PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE="PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE",e})({}),es=(function(e){return e.RELAY_STATE_IDLE="RELAY_STATE_IDLE",e.RELAY_STATE_CONNECTING="RELAY_STATE_CONNECTING",e.RELAY_STATE_RUNNING="RELAY_STATE_RUNNING",e.RELAY_STATE_FAILURE="RELAY_STATE_FAILURE",e})({}),Ff=(function(e){return e.RELAY_OK="RELAY_OK",e.SERVER_CONNECTION_LOST="SERVER_CONNECTION_LOST",e.SRC_TOKEN_EXPIRED="SRC_TOKEN_EXPIRED",e.DEST_TOKEN_EXPIRED="DEST_TOKEN_EXPIRED",e})({}),en=(function(e){return e.High="high",e.Low="low",e.Audio="audio",e.Screen="screen",e.ScreenLow="screen_low",e})({}),Cr=(function(e){return e.DISCONNECT="disconnect",e.CONNECTION_STATE_CHANGE="connection-state-change",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGE="stream-type-change",e.IS_P2P_DISCONNECTED="is-p2p-dis",e.DISCONNECT_P2P="dis-p2p",e.REQUEST_NEW_GATEWAY_LIST="req-gate-url",e.NEED_RENEW_SESSION="need-sid",e.REQUEST_P2P_CONNECTION_PARAMS="request-p2p-connection-params",e.JOIN_RESPONSE="join-response",e.RESET_CONNECTION_EVENTS="reset-connection-events",e.PRE_CONNECT_PC="pre-connect_pc",e.UPDATE_GATEWAY_CONFIG="update-gateway-config",e})({}),tT=(function(e){return e.P2P_DISCONNECTED="P2P_DISCONNECTED",e.A_ROUND_WS_FAILED="A_ROUND_WS_FAILED",e.TIMEOUT="TIMEOUT",e.UNKNOWN_REASON="UNKNOWN_REASON",e})({}),gr=(function(e){return e[e.Nothing=0]="Nothing",e[e.Audio=1]="Audio",e[e.LwoVideo=2]="LwoVideo",e[e.Video=4]="Video",e[e.Data=8]="Data",e[e.DataStream0=256]="DataStream0",e[e.DataStream1=512]="DataStream1",e[e.DataStream2=1024]="DataStream2",e[e.DataStream3=2048]="DataStream3",e[e.DataStream4=4096]="DataStream4",e[e.DataStream5=8192]="DataStream5",e[e.DataStream6=16384]="DataStream6",e[e.DataStream7=32768]="DataStream7",e})({}),qt=(function(e){return e.CHINA="CHINA",e.ASIA="ASIA",e.NORTH_AMERICA="NORTH_AMERICA",e.EUROPE="EUROPE",e.JAPAN="JAPAN",e.INDIA="INDIA",e.KOREA="KOREA",e.HKMC="HKMC",e.US="US",e.OCEANIA="OCEANIA",e.SOUTH_AMERICA="SOUTH_AMERICA",e.AFRICA="AFRICA",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="EXTENSIONS",e})({});const kM=[qt.AFRICA,qt.ASIA,qt.CHINA,qt.EUROPE,qt.GLOBAL,qt.INDIA,qt.JAPAN,qt.NORTH_AMERICA,qt.OCEANIA,qt.OVERSEA,qt.SOUTH_AMERICA];let Xr=(function(e){return e.CHINA="CN",e.ASIA="AS",e.NORTH_AMERICA="NA",e.EUROPE="EU",e.JAPAN="JP",e.INDIA="IN",e.KOREA="KR",e.HKMC="HK",e.US="US",e.OCEANIA="OC",e.SOUTH_AMERICA="SA",e.AFRICA="AF",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="GLOBAL",e})({});const nT={CHINA:{},ASIA:{CODE:Xr.ASIA,WEBCS_DOMAIN:["ap-web-1-asia.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-asia.agora.io"],PROXY_CS:["proxy-ap-web-asia.agora.io"],CDS_AP:["cds-ap-web-asia.agora.io","cds-ap-web-asia2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-asia.agora.io","sua-ap-web-asia2.agora.io"],UAP_AP:["uap-ap-web-asia.agora.io","uap-ap-web-asia2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_SERVER_TYPE3:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]},NORTH_AMERICA:{CODE:Xr.NORTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-north-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-north-america.agora.io"],PROXY_CS:["proxy-ap-web-america.agora.io"],CDS_AP:["cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],UAP_AP:["uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_SERVER_TYPE3:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]},EUROPE:{CODE:Xr.EUROPE,WEBCS_DOMAIN:["ap-web-1-europe.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-europe.agora.io"],PROXY_CS:["proxy-ap-web-europe.agora.io"],CDS_AP:["cds-ap-web-europe.agora.io","cds-ap-web-europe2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-europe.agora.io","sua-ap-web-europe.agora.io"],UAP_AP:["uap-ap-web-europe.agora.io","uap-ap-web-europe2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_SERVER_TYPE3:["europe.webrtc-cloud-proxy.sd-rtn.com"]},JAPAN:{CODE:Xr.JAPAN,WEBCS_DOMAIN:["ap-web-1-japan.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-japan.agora.io"],PROXY_CS:["proxy-ap-web-japan.agora.io"],CDS_AP:["cds-ap-web-japan.agora.io","cds-ap-web-japan2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-japan.agora.io","sua-ap-web-japan2.agora.io"],UAP_AP:["uap-ap-web-japan.agora.io","uap-ap-web-japan2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_SERVER_TYPE3:["japan.webrtc-cloud-proxy.sd-rtn.com"]},INDIA:{CODE:Xr.INDIA,WEBCS_DOMAIN:["ap-web-1-india.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-india.agora.io"],PROXY_CS:["proxy-ap-web-india.agora.io"],CDS_AP:["cds-ap-web-india.agora.io","cds-ap-web-india2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-india.agora.io","sua-ap-web-india2.agora.io"],UAP_AP:["uap-ap-web-india.agora.io","uap-ap-web-india2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_SERVER_TYPE3:["india.webrtc-cloud-proxy.sd-rtn.com"]},KOREA:{CODE:Xr.KOREA,WEBCS_DOMAIN:["ap-web-1-korea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-korea.agora.io"],PROXY_CS:["proxy-ap-web-korea.agora.io"],CDS_AP:["cds-ap-web-korea.agora.io","cds-ap-web-korea2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-korea.agora.io","sua-ap-web-korea2.agora.io"],UAP_AP:["uap-ap-web-korea.agora.io","uap-ap-web-korea2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-korea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-korea.agora.io"],LOG_UPLOAD_SERVER:["logservice-korea.agora.io"],PROXY_SERVER_TYPE3:["korea.webrtc-cloud-proxy.sd-rtn.com"]},HKMC:{CODE:Xr.HKMC,WEBCS_DOMAIN:["ap-web-1-hkmc.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-hkmc.agora.io"],PROXY_CS:["proxy-ap-web-hkmc.agora.io"],CDS_AP:["cds-ap-web-hkmc.agora.io","cds-ap-web-hkmc2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-hkmc.agora.io","sua-ap-web-hkmc2.agora.io"],UAP_AP:["uap-ap-web-hkmc.agora.io","uap-ap-web-hkmc2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-hkmc.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-hkmc.agora.io"],LOG_UPLOAD_SERVER:["logservice-hkmc.agora.io"],PROXY_SERVER_TYPE3:["hkmc.webrtc-cloud-proxy.sd-rtn.com"]},US:{CODE:Xr.US,WEBCS_DOMAIN:["ap-web-1-us.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-us.agora.io"],PROXY_CS:["proxy-ap-web-us.agora.io"],CDS_AP:["cds-ap-web-us.agora.io","cds-ap-web-us2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-us.agora.io","sua-ap-web-us2.agora.io"],UAP_AP:["uap-ap-web-us.agora.io","uap-ap-web-us2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-us.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-us.agora.io"],LOG_UPLOAD_SERVER:["logservice-us.agora.io"],PROXY_SERVER_TYPE3:["us.webrtc-cloud-proxy.sd-rtn.com"]},OVERSEA:{CODE:Xr.OVERSEA,WEBCS_DOMAIN:["ap-web-1-oversea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oversea.agora.io"],PROXY_CS:["proxy-ap-web-oversea.agora.io"],CDS_AP:["cds-ap-web-oversea.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oversea.agora.io"],UAP_AP:["uap-ap-web-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.agora.io"]},GLOBAL:{CODE:Xr.GLOBAL,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-ap-web-3.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-ap-web-3.agora.io"],UAP_AP:["uap-ap-web-1.agora.io","uap-ap-web-3.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2.agora.io"],LOG_UPLOAD_SERVER:["logservice.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com"]},OCEANIA:{CODE:Xr.OCEANIA,WEBCS_DOMAIN:["ap-web-1-oceania.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oceania.agora.io"],PROXY_CS:["proxy-ap-web-oceania.agora.io"],CDS_AP:["cds-ap-web-oceania.agora.io","cds-ap-web-oceania2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oceania.agora.io","sua-ap-web-oceania2.agora.io"],UAP_AP:["uap-ap-web-oceania.agora.io","uap-ap-web-oceania2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_SERVER_TYPE3:["oceania.webrtc-cloud-proxy.sd-rtn.com"]},SOUTH_AMERICA:{CODE:Xr.SOUTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-south-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-south-america.agora.io"],PROXY_CS:["proxy-ap-web-south-america.agora.io"],CDS_AP:["cds-ap-web-south-america.agora.io","cds-ap-web-south-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-south-america.agora.io","sua-ap-web-south-america2.agora.io"],UAP_AP:["uap-ap-web-south-america.agora.io","uap-ap-web-south-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_SERVER_TYPE3:["south-america.webrtc-cloud-proxy.sd-rtn.com"]},AFRICA:{CODE:Xr.AFRICA,WEBCS_DOMAIN:["ap-web-1-africa.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-africa.agora.io"],PROXY_CS:["proxy-ap-web-africa.agora.io"],CDS_AP:["cds-ap-web-africa.agora.io","cds-ap-web-africa2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-africa.agora.io","sua-ap-web-africa2.agora.io"],UAP_AP:["uap-ap-web-africa.agora.io","uap-ap-web-africa2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_SERVER_TYPE3:["africa.webrtc-cloud-proxy.sd-rtn.com"]},EXTENSIONS:{}};ob&&(nT.CHINA={CODE:Xr.CHINA,WEBCS_DOMAIN:["webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["proxy-web.ap.sd-rtn.com"],CDS_AP:["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-web-2.ap.sd-rtn.com","uap-web-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_SERVER_TYPE3:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]});let qE=(function(e){return e.UPDATE_BITRATE_LIMIT="update_bitrate_limit",e.UPDATE_CLIENT_ROLE_OPTIONS="update_client_role_options",e})({});function LM(e){return!!e&&!(!e.uplink||!e.id)&&e.uplink.max_bitrate!==void 0&&e.uplink.min_bitrate!==void 0}class xM extends Pn{constructor(t,n){super(),k(this,"onICEConnectionStateChange",void 0),k(this,"onConnectionStateChange",void 0),k(this,"onDTLSTransportStateChange",void 0),k(this,"onDTLSTransportError",void 0),k(this,"onICETransportStateChange",void 0),k(this,"onFirstAudioReceived",void 0),k(this,"onFirstVideoReceived",void 0),k(this,"onFirstAudioDecoded",void 0),k(this,"onFirstVideoDecoded",void 0),k(this,"onFirstVideoRender",void 0),k(this,"onFirstVideoDecodedTimeout",void 0),k(this,"onSelectedLocalCandidateChanged",void 0),k(this,"onSelectedRemoteCandidateChanged",void 0),k(this,"onICECandidateError",void 0),k(this,"getLocalVideoStats",void 0)}}class MM extends xM{constructor(t,n){super(t,n),k(this,"establishPromise",void 0)}}let Le=(function(e){return e.VIDEO="video",e.AUDIO="audio",e})({}),Jr=(function(e){return e.UDP_RELAY="udp_relay",e.UDP_TCP_RELAY="udp_tcp_relay",e.TCP_RELAY="tcp_relay",e.RELAY="relay",e})({}),vl=(function(e){return e[e.FIRST_CONNECTION=0]="FIRST_CONNECTION",e[e.UDP_TCP_RESTART=1]="UDP_TCP_RESTART",e[e.RELAY_RESTART=2]="RELAY_RESTART",e[e.TCP_RESTART=3]="TCP_RESTART",e[e.OLD_FIRST_CONNECTION=10]="OLD_FIRST_CONNECTION",e[e.OLD_RESTART=11]="OLD_RESTART",e[e.DISCONNECTED_OR_FAILED=20]="DISCONNECTED_OR_FAILED",e})({});const UM=["disconnected","failed"];let Ee=(function(e){return e.LocalVideoTrack="videoTrack",e.LocalAudioTrack="audioTrack",e.LocalVideoLowTrack="videoLowTrack",e})({}),Zt=(function(e){return e.New="new",e.Connected="connected",e.Reconnecting="reconnecting",e.Disconnected="disconnected",e})({}),Xe=(function(e){return e.AudioMetadata="audioMetadata",e.AudioPts="audioPts",e.StateChange="stateChange",e.IceConnectionStateChange="iceConnectionStateChange",e.RequestMuteLocal="requestMuteLocal",e.RequestUnmuteLocal="requestUnmuteLocal",e.RequestRePublish="requestRePublish",e.RequestRePublishDataChannel="requestRePublishDataChannel",e.RequestReSubscribe="requestReSubscribe",e.RequestUploadStats="requestUploadStats",e.RequestUpload="requestUpload",e.MediaReconnectStart="MediaReconnectStart",e.MediaReconnectEnd="MediaReconnectEnd",e.NeedSignalRTT="NeedSignalRTT",e.RequestRestartICE="RequestRestartIce",e.PeerConnectionStateChange="PeerConnectionStateChange",e.RequestReconnect="RequestReconnect",e.RequestReconnectPC="RequestReconnectPC",e.RequestUnpublishForReconnectPC="RequestUnpublishForReconnectPC",e.P2PLost="P2PLost",e.UpdateVideoEncoder="UpdateVideoEncoder",e.ConnectionTypeChange="ConnectionTypeChange",e.RequestLowStreamParameter="RequestLowStreamParameter",e.QueryClientConnectionState="QueryClientConnectionState",e.LocalCandidate="LocalCandidate",e.RequestP2PMuteLocal="requestP2PMuteLocal",e.RequestP2PUnPublish="RequestP2PUnPublish",e.RequestP2PUnmuteRemote="RequestP2PUnmuteRemote",e.RequestP2PMuteRemote="RequestP2PMuteRemote",e.RequestP2PRestartICE="RequestP2PRestartICE",e})({}),Go=(function(e){return e.CONNECTING="CONNECTING",e.RECONNECTING="RECONNECTING",e.CONNECTED="CONNECTED",e.CLOSED="CLOSED",e})({}),Ho=(function(e){return e[e.CONNECT_AP=0]="CONNECT_AP",e[e.AP_CONNECTED=1]="AP_CONNECTED",e[e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e[e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e[e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e[e.CONNECT_WORKER=5]="CONNECT_WORKER",e[e.WORKER_CONNECTED=6]="WORKER_CONNECTED",e[e.CLOSED=7]="CLOSED",e})({}),wr=(function(e){return e.CONNECTION_STATE_CHANGE="connection-state-change",e.STATE_CHANGE="state-change",e.INSPECT_RESULT="inspect-result",e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e.REQUEST_NEW_WORKER_URL="request-new-worker-url",e})({}),VM=(function(e){return e.CONNECTED="transmitter:connected",e.RECONNECTING="transmitter:reconnecting",e.WILL_RECONNECT="transmitter:will_reconnect",e.CLOSED="transmitter:closed",e.FAILED="transmitter:failed",e.ON_MESSAGE="transmitter:on_message",e.REQUEST_NEW_URLS="transmitter:request_new_urls",e.RECONNECT_CREATE_CONNECTION="transmitter:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="transmitter:on_token_privilege_did_expire",e.TO_CONNECT_DATACHANNEL="transmitter:to_connect_datachannel",e.FAILBACK="transmitter:failback",e.PRE_CONNECT_PC="transmitter:pre_connect_pc",e})({}),bc=(function(e){return e.CAMERA_CHANGED="camera-changed",e.MICROPHONE_CHANGED="microphone-changed",e.PLAYBACK_DEVICE_CHANGED="playback-device-changed",e.AUDIO_AUTOPLAY_FAILED="audio-autoplay-failed",e.AUTOPLAY_FAILED="autoplay-failed",e.AUDIO_CONTEXT_STATE_CHANGED="audio-context-state-changed",e.SECURITY_POLICY_VIOLATION="security-policy-violation",e})({}),so=(function(e){return e.CONNECTING="CONNECTING",e.RECONNECTING="RECONNECTING",e.CONNECTED="CONNECTED",e.CLOSED="CLOSED",e})({}),ba=(function(e){return e.CONNECTION_STATE_CHANGE="connection-state-change",e.STATE_CHANGE="state-change",e.INSPECT_RESULT="inspect-result",e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e.REQUEST_NEW_WORKER_URL="request-new-worker-url",e})({}),Bf=(function(e){return e[e.CONNECT_AP=0]="CONNECT_AP",e[e.AP_CONNECTED=1]="AP_CONNECTED",e[e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e[e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e[e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e[e.CONNECT_WORKER=5]="CONNECT_WORKER",e[e.WORKER_CONNECTED=6]="WORKER_CONNECTED",e[e.CLOSED=7]="CLOSED",e})({}),Hn=(function(e){return e.CALL="call",e.CANDIDATE="candidate",e.PUBLISH="publish",e.UNPUBLISH="unpublish",e.CONTROL="control",e.RESTART_ICE="restart_ice",e.ACK="ack",e.RESPONSE="response",e.JOIN="join",e.CHECK="check",e})({}),Wf=(function(e){return e.ABORT="abort",e})({}),Od=(function(e){return e.MUTE_LOCAL_AUDIO="mute_local_audio",e.MUTE_LOCAL_VIDEO="mute_local_video",e.UNMUTE_LOCAL_AUDIO="unmute_local_audio",e.UNMUTE_LOCAL_VIDEO="unmute_local_video",e})({}),s9=(function(e){return e.P2P_TOKEN_TIMEOUT="p2p_token_timeout",e.P2P_TOKEN_CHANGED="p2p_token_changed",e})({});const o9={[ZS.ACCESS_POINT]:{[bi.NO_FLAG_SET]:{desc:"flag is zero",retry:!1},[bi.FLAG_SET_BUT_EMPTY]:{desc:"flag is empty",retry:!1},[bi.INVALID_FALG_SET]:{desc:"invalid flag",retry:!1},[bi.FLAG_SET_BUT_NO_RE]:{desc:"flag set unilbs but no request",retry:!1},[bi.INVALID_SERVICE_ID]:{desc:"invalid service id",retry:!1},[bi.NO_SERVICE_AVAILABLE]:{desc:"no service available",retry:!0},[bi.NO_SERVICE_AVAILABLE_P2P]:{desc:"no unilbs p2p service available",retry:!0},[bi.NO_SERVICE_AVAILABLE_VOICE]:{desc:"no unilbs voice service available",retry:!0},[bi.NO_SERVICE_AVAILABLE_WEBRTC]:{desc:"no unilbs webrtc service available",retry:!0},[bi.NO_SERVICE_AVAILABLE_CDS]:{desc:"no cds service available",retry:!0},[bi.NO_SERVICE_AVAILABLE_CDN]:{desc:"no cdn dispatcher service available",retry:!0},[bi.NO_SERVICE_AVAILABLE_TDS]:{desc:"no tds service available",retry:!0},[bi.NO_SERVICE_AVAILABLE_REPORT]:{desc:"no unilbs report service available",retry:!0},[bi.NO_SERVICE_AVAILABLE_APP_CENTER]:{desc:"no app center service available",retry:!0},[bi.NO_SERVICE_AVAILABLE_ENV0]:{desc:"no unilbs sig env0 service available",retry:!0},[bi.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voet service available",retry:!0},[bi.NO_SERVICE_AVAILABLE_STRING_UID]:{desc:"no string uid service available",retry:!0},[bi.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS]:{desc:"no webrtc unilbs service available",retry:!0}},[ZS.UNILBS]:{[Wo.INVALID_VENDOR_KEY]:{desc:"invalid vendor key, can not find appid",retry:!1},[Wo.INVALID_CHANNEL_NAME]:{desc:"invalid channel name",retry:!1},[Wo.INTERNAL_ERROR]:{desc:"unilbs internal error",retry:!1},[Wo.NO_AUTHORIZED]:{desc:"invalid token, authorized failed",retry:!1},[Wo.DYNAMIC_KEY_TIMEOUT]:{desc:"dynamic key or token timeout",retry:!1},[Wo.NO_ACTIVE_STATUS]:{desc:"no active status",retry:!1},[Wo.DYNAMIC_KEY_EXPIRED]:{desc:"dynamic key expired",retry:!1},[Wo.STATIC_USE_DYNAMIC_KEY]:{desc:"static use dynamic key",retry:!1},[Wo.DYNAMIC_USE_STATIC_KEY]:{desc:"dynamic use static key",retry:!1},[Wo.USER_OVERLOAD]:{desc:"amount of users over load",retry:!1},[Wo.FORBIDDEN_REGION]:{desc:"the request is forbidden in this area",retry:!1},[Wo.CANNOT_MEET_AREA_DEMAND]:{desc:"unable to allocate services in this area",retry:!1}},[ZS.STRING_UID_ALLOCATOR]:{[Fb.IIIEGAL_APPID]:{desc:"invalid appid",retry:!1},[Fb.IIIEGAL_UID]:{desc:"invalid string uid",retry:!1},[Fb.INTERNAL_ERROR]:{desc:"string uid allocator internal error",retry:!0}}};function Gf(e){const t=o9[Math.floor(e/1e4)];if(!t)return{desc:"unknown error",retry:!1};const n=t[e%1e4];if(!n){if(Math.floor(e/1e4)===ZS.ACCESS_POINT){const r=e%1e4;if(r.toString()[0]==="1")return{desc:e.toString(),retry:!1};if(r.toString()[0]==="2")return{desc:e.toString(),retry:!0}}return{desc:"unknown error",retry:!1}}return n}const a9={[Ze.K_TIMESTAMP_EXPIRED]:{desc:"K_TIMESTAMP_EXPIRED",action:"failed"},[Ze.K_CHANNEL_PERMISSION_INVALID]:{desc:"K_CHANNEL_PERMISSION_INVALID",action:"failed"},[Ze.K_CERTIFICATE_INVALID]:{desc:"K_CERTIFICATE_INVALID",action:"failed"},[Ze.K_CHANNEL_NAME_EMPTY]:{desc:"K_CHANNEL_NAME_EMPTY",action:"failed"},[Ze.K_CHANNEL_NOT_FOUND]:{desc:"K_CHANNEL_NOT_FOUND",action:"failed"},[Ze.K_TICKET_INVALID]:{desc:"K_TICKET_INVALID",action:"failed"},[Ze.K_CHANNEL_CONFLICTED]:{desc:"K_CHANNEL_CONFLICTED",action:"failed"},[Ze.K_SERVICE_NOT_READY]:{desc:"K_SERVICE_NOT_READY",action:"tryNext"},[Ze.K_SERVICE_TOO_HEAVY]:{desc:"K_SERVICE_TOO_HEAVY",action:"tryNext"},[Ze.K_UID_BANNED]:{desc:"K_UID_BANNED",action:"failed"},[Ze.K_IP_BANNED]:{desc:"K_IP_BANNED",action:"failed"},[Ze.DATASTREAM2_NOT_AVAILABLE]:{desc:"DATASTREAM2_NOT_AVAILABLE",action:"quit"},[Ze.K_AUTO_REBALANCE]:{desc:"k_AUTO_REBALANCE",action:"recover"},[Ze.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[Ze.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[Ze.WARN_NO_AVAILABLE_CHANNEL]:{desc:"WARN_NO_AVAILABLE_CHANNEL",action:"failed"},[Ze.WARN_LOOKUP_CHANNEL_TIMEOUT]:{desc:"WARN_LOOKUP_CHANNEL_TIMEOUT",action:"tryNext"},[Ze.WARN_LOOKUP_CHANNEL_REJECTED]:{desc:"WARN_LOOKUP_CHANNEL_REJECTED",action:"failed"},[Ze.WARN_OPEN_CHANNEL_TIMEOUT]:{desc:"WARN_OPEN_CHANNEL_TIMEOUT",action:"tryNext"},[Ze.WARN_OPEN_CHANNEL_REJECTED]:{desc:"WARN_OPEN_CHANNEL_REJECTED",action:"failed"},[Ze.WARN_REQUEST_DEFERRED]:{desc:"WARN_REQUEST_DEFERRED",action:"failed"},[Ze.ERR_DYNAMIC_KEY_TIMEOUT]:{desc:"ERR_DYNAMIC_KEY_TIMEOUT",action:"failed"},[Ze.ERR_NO_AUTHORIZED]:{desc:"ERR_NO_AUTHORIZED",action:"failed"},[Ze.ERR_VOM_SERVICE_UNAVAILABLE]:{desc:"ERR_VOM_SERVICE_UNAVAILABLE",action:"tryNext"},[Ze.ERR_NO_CHANNEL_AVAILABLE_CODE]:{desc:"ERR_NO_CHANNEL_AVAILABLE_CODE",action:"failed"},[Ze.ERR_MASTER_VOCS_UNAVAILABLE]:{desc:"ERR_MASTER_VOCS_UNAVAILABLE",action:"tryNext"},[Ze.ERR_INTERNAL_ERROR]:{desc:"ERR_INTERNAL_ERROR",action:"tryNext"},[Ze.ERR_NO_ACTIVE_STATUS]:{desc:"ERR_NO_ACTIVE_STATUS",action:"failed"},[Ze.ERR_INVALID_UID]:{desc:"ERR_INVALID_UID",action:"failed"},[Ze.ERR_DYNAMIC_KEY_EXPIRED]:{desc:"ERR_DYNAMIC_KEY_EXPIRED",action:"failed"},[Ze.ERR_STATIC_USE_DYANMIC_KE]:{desc:"ERR_STATIC_USE_DYANMIC_KE",action:"failed"},[Ze.ERR_DYNAMIC_USE_STATIC_KE]:{desc:"ERR_DYNAMIC_USE_STATIC_KE",action:"failed"},[Ze.ERR_NO_VOCS_AVAILABLE]:{desc:"ERR_NO_VOCS_AVAILABLE",action:"tryNext"},[Ze.ERR_NO_VOS_AVAILABLE]:{desc:"ERR_NO_VOS_AVAILABLE",action:"tryNext"},[Ze.ERR_JOIN_CHANNEL_TIMEOUT]:{desc:"ERR_JOIN_CHANNEL_TIMEOUT",action:"tryNext"},[Ze.ERR_JOIN_BY_MULTI_IP]:{desc:"ERR_JOIN_BY_MULTI_IP",action:"recover"},[Ze.ERR_NOT_JOINED]:{desc:"ERR_NOT_JOINED",action:"failed"},[Ze.ERR_REPEAT_JOIN_REQUEST]:{desc:"ERR_REPEAT_JOIN_REQUEST",action:"quit"},[Ze.ERR_REPEAT_JOIN_CHANNEL]:{desc:"ERR_REPEAT_JOIN_CHANNEL",action:"quit"},[Ze.ERR_INVALID_STRINGUID]:{desc:"ERR_INVALID_STRINGUID",action:"failed"},[Ze.ERR_TOO_MANY_USERS]:{desc:"ERR_TOO_MANY_USERS",action:"tryNext"},[Ze.ERR_SET_CLIENT_ROLE_TIMEOUT]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[Ze.ERR_SET_CLIENT_ROLE_NO_PERMISSION]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[Ze.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE]:{desc:"ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",action:"success"},[Ze.ERR_PUBLISH_REQUEST_INVALID]:{desc:"ERR_PUBLISH_REQUEST_INVALID",action:"failed"},[Ze.ERR_SUBSCRIBE_REQUEST_INVALID]:{desc:"ERR_SUBSCRIBE_REQUEST_INVALID",action:"failed"},[Ze.ERR_NOT_SUPPORTED_MESSAGE]:{desc:"ERR_NOT_SUPPORTED_MESSAGE",action:"failed"},[Ze.ERR_ILLEAGAL_PLUGIN]:{desc:"ERR_ILLEAGAL_PLUGIN",action:"failed"},[Ze.ILLEGAL_CLIENT_ROLE_LEVEL]:{desc:"ILLEGAL_CLIENT_ROLE_LEVEL",action:"failed"},[Ze.ERR_REJOIN_TOKEN_INVALID]:{desc:"ERR_REJOIN_TOKEN_INVALID",action:"failed"},[Ze.ERR_REJOIN_USER_NOT_JOINED]:{desc:"ERR_REJOIN_NOT_JOINED",action:"failed"},[Ze.ERR_INVALID_OPTIONAL_INFO]:{desc:"ERR_INVALID_OPTIONAL_INFO",action:"quit"},[Ze.ERR_TEST_RECOVER]:{desc:"ERR_TEST_RECOVER",action:"recover"},[Ze.ERR_TEST_TRYNEXT]:{desc:"ERR_TEST_TRYNEXT",action:"recover"},[Ze.ERR_TEST_RETRY]:{desc:"ERR_TEST_RETRY",action:"recover"},[Ze.ILLEGAL_AES_PASSWORD]:{desc:"ERR_TEST_RETRY",action:"failed"},[Ze.ERR_TOO_MANY_BROADCASTERS]:{desc:"ERR_TOO_MANY_BROADCASTERS",action:"failed"},[Ze.ERR_TOO_MANY_SUBSCRIBERS]:{desc:"ERR_TOO_MANY_SUBSCRIBERS",action:"failed"},[Ze.ERR_LICENSE_ILLEGAL]:{desc:"ERR_LICENSE_ILLEGAL",action:"quit"},[Ze.ERR_LICENSE_MISSING]:{desc:"ERR_LICENSE_MISSING",action:"quit"},[Ze.ERR_LICENSE_EXPIRED]:{desc:"ERR_LICENSE_EXPIRED",action:"quit"},[Ze.ERR_LICENSE_MINUTES_EXCEEDED]:{desc:"ERR_LICENSE_MINUTES_EXCEEDED",action:"quit"},[Ze.ERR_LICENSE_PERIOD_INVALID]:{desc:"ERR_LICENSE_PERIOD_INVALID",action:"quit"},[Ze.ERR_LICENSE_MULTIPLE_SDK_SERVICE]:{desc:"ERR_LICENSE_MULTIPLE_SDK_SERVICE",action:"quit"}};function XE(e){return a9[e]||{desc:"UNKNOWN_ERROR_".concat(e),action:"failed"}}function jM(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable}))),n.push.apply(n,r)}return n}function Hb(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?jM(Object(n),!0).forEach((function(r){k(e,r,n[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):jM(Object(n)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))}))}return e}function Kb(e,t){if(typeof e=="string")return e;const{proxy:n,host:r,port:i}=e;if(t){const s=F("JOIN_GATEWAY_FALLBACK_PORT")||443;return s===443?"wss://".concat(r,"/ws/?p=").concat(Number(i)+150):"wss://".concat(r,":").concat(s,"/ws/?p=").concat(Number(i)+150)}return n?"wss://".concat(n,"/ws/?h=").concat(r,"&p=").concat(i):"wss://".concat(r,":").concat(i)}const c9=/wss:\/\/(.+)\/ws\/\?h=(.+)&p=([0-9]+)\/?/,l9=/wss:\/\/(.+)\/ws\/\?p=([0-9]+)\/?/,d9=/wss:\/\/(.+):([0-9]+)\/?/,u9=/wss:\/\/(.[^\/]+)\/?/;let h9=0;class p9{constructor(t,n){k(this,"id",0),k(this,"store",void 0),k(this,"recordIndex",void 0),k(this,"websockets",[]),k(this,"try443PortDuration",2e3),k(this,"forceCloseWSDuration",5e3),k(this,"try443PortTimeout",null),k(this,"forceCloseTimeout",null),k(this,"isTry443PortFailed",!1),k(this,"isNormalPortFailed",!1),k(this,"useDoubleDomain",!1),k(this,"useProxy",!1),k(this,"startTime",Date.now()),this.id=++h9,this.try443PortDuration=F("JOIN_GATEWAY_TRY_443PORT_DURATION")||2e3,this.forceCloseWSDuration=t||5e3,this.store=n}closeAllWebsockets(){this.websockets.forEach((t=>{t.onopen=null,t.onclose=null,t.onmessage=null,t.close()})),this.websockets.length=0}clearTimeout(){this.forceCloseTimeout&&clearTimeout(this.forceCloseTimeout),this.try443PortTimeout&&clearTimeout(this.try443PortTimeout),this.forceCloseTimeout=null,this.try443PortTimeout=null}logger(){var t;const n=Date.now()-this.startTime;for(var r=arguments.length,i=new Array(r),s=0;s<r;s++)i[s]=arguments[s];R.debug("[choose-best-ws ".concat((t=this.store)===null||t===void 0?void 0:t.clientId," ").concat(this.id,"] ").concat(n,"ms:"),...i)}createWebSocket(t,n,r){this.logger("createWebSocket:",t,{isTry443Port:n,hasTimeoutDetection:r});const i=F("GATEWAY_DOMAINS"),s=Date.now(),o=[],c=i.find((g=>{var v;return Re(v=t.host).call(v,g)}));c||(this.useDoubleDomain=!1);const l=[];if(this.useDoubleDomain)i.forEach((g=>{l.push(Kb(Hb(Hb({},t),{},{host:t.host.replace(c,g)}),n))}));else{const g=Hb({},t);if(n&&c){const v=i.find((O=>O!==c));v&&(g.host=g.host.replace(c,v))}l.push(Kb(g,n))}try{l.forEach((g=>{const v=new WebSocket(g);v.binaryType="arraybuffer",o.push(v),this.logger("ws is connecting:",v.url)}))}catch(g){if(this.logger("ws create failed"),o.forEach((v=>v.close())),o.length=0,this.useDoubleDomain)return this.useDoubleDomain=!1,this.createWebSocket(t,n,r);if(!n&&Number(t.port)!==443)return this.createWebSocket(t,!0,r);throw new se(U.WS_ERR,"init websocket failed! Error: ".concat(g.toString()))}const h=kE();this.store&&this.store.recordJoinChannelService({urls:o.map((g=>g.url)),service:"gateway"},this.recordIndex),o.forEach((g=>{g.onopen=()=>{this.logger("onopen: ws ".concat(g.url," open cost ").concat(Date.now()-s,"ms")),this.websockets.forEach((v=>{v!==g&&(v.onopen=null,v.onclose=null,v.onmessage=null,v.close(),this.logger("close backup websocket: ".concat(v.url)))})),this.websockets.length=0,h.resolve(g)},g.onclose=v=>{this.logger("onclose: ws ".concat(g.url," closed cost ").concat(Date.now()-s,"ms state: ").concat(g.readyState));const O=o.every((I=>I.readyState===WebSocket.CLOSED||I.readyState===WebSocket.CLOSING));this.logger("".concat(n?"443":"47xx"," websocket closed, all failed: ").concat(O)),O&&(n||this.isTry443PortFailed||this.useProxy)?(this.logger("onclose: all websocket is closed, ".concat(v.reason)),h.reject({code:v.code,reason:tT.A_ROUND_WS_FAILED})):!n&&O&&!this.isNormalPortFailed&&this.try443PortTimeout&&(this.logger("all 47xx websocket is closed, try 443 port"),this.clearTimeout(),E()),n?this.isTry443PortFailed=O:this.isNormalPortFailed=O},g.onmessage=v=>this.logger("".concat(g.url," onmessage: ").concat(v.data))})),this.websockets.push(...o);const p=()=>{this.websockets.forEach((g=>g.readyState!==WebSocket.OPEN&&g.close()))},E=()=>{if(h.isResolved)return p();xt().os===Er.MAC_OS&&xn()&&p(),this.createWebSocket(t,!0,!0).then((g=>{h.resolve(g)})).catch((g=>{this.isNormalPortFailed&&h.reject(g),this.logger("try 443 port to create ws failed")})),this.forceCloseTimeout=window.setTimeout((()=>{this.logger("5s timeout close un-opens, isWebsocket created: ",h.isResolved),this.forceCloseTimeout=null,p()}),this.forceCloseWSDuration)};return r||(()=>{if(n||this.useProxy)return this.logger("add 5s timeout at ".concat(n?"try-443":"proxy"," condition")),this.forceCloseTimeout=window.setTimeout((()=>{this.forceCloseTimeout=null,p()}),this.forceCloseWSDuration);this.try443PortTimeout=window.setTimeout((()=>{this.logger("2s timeout, isWebsocket created: ",h.isResolved),this.try443PortTimeout=null,E()}),this.try443PortDuration)})(),h.promise}chooseBestWebsocket(t,n,r,i){return this.useDoubleDomain=!!n,typeof t=="string"&&(t=(function(s){let o,c,l;return[,o,c,l]=s.match(c9)||[],o||([,c,l]=s.match(l9)||[]),c&&l||([,c,l]=s.match(d9)||[]),c&&l||([,c]=s.match(u9)||[]),c||R.warning("un-destructible url: ",s),{proxy:o,host:c,port:l||"443"}})(t)),this.recordIndex=i,this.useProxy=!!t.proxy,r&&this.useProxy&&(R.warn("cannot use 443 only when use proxy"),r=!1),this.createWebSocket(t,!!r,!1).finally((()=>this.clearTimeout()))}}function FM(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable}))),n.push.apply(n,r)}return n}class BM extends Pn{get url(){return this.websocket&&this.websocket.url||this._websocketUrl}get reconnectMode(){return this._reconnectMode}set reconnectMode(t){var n;Re(n=["tryNext","recover"]).call(n,t)&&this.resetReconnectCount(t),this._reconnectMode=t}get state(){return this._state}set state(t){t!==this._state&&(this._state=t,this._state==="reconnecting"?this.emit(gt.RECONNECTING,this.reconnectReason):this._state==="connected"?this.emit(gt.CONNECTED):this._state==="closed"?this.emit(gt.CLOSED):this._state==="failed"&&this.emit(gt.FAILED))}resetReconnectCount(t){R.debug("websocket reset reconnect count, reason: "+t),this.reconnectCount=0}constructor(t,n){let r=arguments.length>2&&arguments[2]!==void 0&&arguments[2],i=arguments.length>3&&arguments[3]!==void 0&&arguments[3],s=arguments.length>4&&arguments[4]!==void 0&&arguments[4],o=arguments.length>5?arguments[5]:void 0;super(),k(this,"_websocketUrl",null),k(this,"connectionID",0),k(this,"currentURLIndex",0),k(this,"urls",[]),k(this,"_reconnectMode","tryNext"),k(this,"reconnectReason",void 0),k(this,"_initMutex",void 0),k(this,"name",void 0),k(this,"_state","closed"),k(this,"reconnectInterrupter",void 0),k(this,"websocket",void 0),k(this,"retryConfig",void 0),k(this,"reconnectCount",0),k(this,"forceCloseTimeout",5e3),k(this,"onlineReconnectListener",void 0),k(this,"useCompress",void 0),k(this,"tryDoubleDomain",!1),k(this,"use443PortOnly",!1),k(this,"wsInflateLength",0),k(this,"wsDeflateLength",0),k(this,"closeEstablishingWs",(()=>{})),k(this,"store",void 0),k(this,"joinGatewayRecordIndex",void 0),this.store=o,this.name=t,this.retryConfig=(function(E){for(var g=1;g<arguments.length;g++){var v=arguments[g]!=null?arguments[g]:{};g%2?FM(Object(v),!0).forEach((function(O){k(E,O,v[O])})):Object.getOwnPropertyDescriptors?Object.defineProperties(E,Object.getOwnPropertyDescriptors(v)):FM(Object(v)).forEach((function(O){Object.defineProperty(E,O,Object.getOwnPropertyDescriptor(v,O))}))}return E})({},n),this.useCompress=r,this.tryDoubleDomain=i,this.use443PortOnly=s,this._initMutex=new Yr("websocket",o?o.clientId:void 0);const{timeout:c,timeoutFactor:l}=n,h=Math.max(300,Math.floor(3*c/5)),p=Math.max(1.2,Math.floor(8*l)/10);_s.ONLINE&&(this.retryConfig.timeout=h,this.retryConfig.timeoutFactor=p),Qn.on(Tf.NETWORK_STATE_CHANGE,((E,g)=>{E!==g&&(this.resetReconnectCount("network state change: ".concat(g," -> ").concat(E)),E===_s.ONLINE?(this.retryConfig.timeout=h,this.retryConfig.timeoutFactor=p):(this.retryConfig.timeout=c,this.retryConfig.timeoutFactor=l))}))}getConnection(){return this.websocket||void 0}async init(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const r=await this._initMutex.lock();this._reconnectMode="tryNext",this.forceCloseTimeout=n,this.urls=t,this.state="connecting";try{var i;const s=kE(),o=this.urls[this.currentURLIndex];(i=this.store)===null||i===void 0||i.beforeConnect(),(function(c){return!(MS()||F("USE_NEW_TOKEN")||!F("ENABLE_PREALLOC_PC")&&(c==null||!c.autoSubscribe||F("FORCE_DISABLE_AUTO_SUB")))})(this.store)&&this.emit(VM.PRE_CONNECT_PC),this.createWebSocketConnection(o).then(s.resolve).catch(s.reject),this.once(gt.CLOSED,(()=>{s.reject(new ce(U.WS_DISCONNECT))})),this.once(gt.CONNECTED,s.resolve),await s.promise}catch{}finally{r()}}close(t,n){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this.reconnectInterrupter&&this.reconnectInterrupter(),this.websocket){this.websocket.onclose=null,this.websocket.onopen=null,this.websocket.onmessage=null;const r=this.websocket;n?setTimeout((()=>r.close()),500):r.close(),this.websocket=void 0,this._websocketUrl=null}this.state=t?"failed":"closed",this.closeEstablishingWs&&this.closeEstablishingWs()}reconnect(t,n){if(!this.websocket)return void R.warning("[".concat(this.name,"] can not reconnect, no websocket"));t!==void 0&&(this.reconnectMode=t),R.debug("[".concat(this.name,"] reconnect is triggered initiative")),typeof this.joinGatewayRecordIndex=="number"&&this.store&&this.store.recordJoinChannelService({status:"error",errors:[new Error(n)]},this.joinGatewayRecordIndex);const r=this.websocket.onclose;this.websocket.onclose=null,this.websocket.close(),r&&r.bind(this.websocket)({code:9999,reason:n})}sendMessage(t){let n=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!this.websocket||this.websocket.readyState!==WebSocket.OPEN)throw new ce(U.WS_ABORT,"websocket is not ready");try{n||(t=JSON.stringify(t)),this.websocket.send(t)}catch(r){throw new ce(U.WS_ERR,"send websocket message error"+r.toString())}}setWsInflateData(t){this.wsDeflateLength=this.wsDeflateLength+t.originLength,this.wsInflateLength=this.wsInflateLength+t.compressedLength}getWsInflateData(){const t=this.wsInflateLength,n=this.wsDeflateLength;return this.clearWsInflateData(),{wsInflateLength:t,wsDeflateLength:n}}clearWsInflateData(){this.wsInflateLength=0,this.wsDeflateLength=0}async createWebSocketConnection(t){var n;const r=kE();this.connectionID+=1,this.joinGatewayRecordIndex=void 0;const i=p=>{var E;(E=this.store)===null||E===void 0||E.signalChannelOpen(),R.debug("[".concat(this.name,"] websocket opened:"),p),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),r.resolve()},s=async p=>{var E;if(R.debug("[".concat(this.name,"] websocket close ").concat((E=this.websocket)===null||E===void 0?void 0:E.url,", code: ").concat(p.code,", reason: ").concat(p.reason,", current mode: ").concat(this.reconnectMode)),this.reconnectCount>=this.retryConfig.maxRetryCount)r.reject(new ce(U.WS_DISCONNECT,"websocket close: ".concat(p.code))),this.close();else{this.state==="connected"&&(this.reconnectReason=p.reason,this.state="reconnecting");const g=Is(this,gt.WILL_RECONNECT,this.reconnectMode,p.reason)||this.reconnectMode,v=await this.reconnectWithAction(g);if(this.state==="closed")return void R.debug("[".concat(this.connectionID,"] ws is closed, no need to reconnect"));if(!v)return r.reject(new ce(U.WS_DISCONNECT,"websocket reconnect failed: ".concat(p.code))),this.close(!0);r.resolve()}},o=p=>{this.emit(gt.ON_MESSAGE,p)},c=p=>{R.warn("[".concat(this.connectionID,"] ws open error ").concat(p))};this.websocket&&(this.websocket.onclose=null,this.websocket.close()),F("GATEWAY_WSS_ADDRESS")&&this.name.startsWith("gateway")&&(t=F("GATEWAY_WSS_ADDRESS")),R.debug("[".concat(this.name,"] start connect, url:"),t);const l=(n=this.store)===null||n===void 0?void 0:n.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"});try{var h;this._websocketUrl=Kb(t);const p=await this.chooseBestWebsocketConnection(t);this.websocket=p,i&&i(this.websocket.url),this.websocket.onclose=s,this.websocket.onmessage=o,this.websocket.onerror=c,(h=this.store)===null||h===void 0||h.recordJoinChannelService({endTs:Date.now(),status:"success"},l),this.joinGatewayRecordIndex=l}catch(p){const E=this.state==="closed",g=p instanceof ce,v=g&&p.code===U.WS_ABORT,O=g&&p.code===U.WS_ERR,I=g?p.message:p&&(p.reason||p.toString());R.warning("[choose-best-ws] chooseBestWebsocket error: ".concat(I)),this.store&&this.store.recordJoinChannelService({endTs:Date.now(),status:v?"aborted":"error",errors:[p]},l),E||O?(r.reject(E?new ce(U.WS_DISCONNECT,"websocket is closed: ".concat(I)):new ce(U.WS_ERR,"init websocket failed: ".concat(I))),O&&R.error("[".concat(this.name,"] init websocket failed: ").concat(I))):s&&s(p)}return r.promise}async reconnectWithAction(t){let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(this.reconnectCount>=this.retryConfig.maxRetryCount||this.urls.length===0||this.state==="closed")return!1;R.warning("[choose-best-ws] action: =>",t),this.onlineReconnectListener||Qn.isOnline||!Qn.onlineWaiter||(this.onlineReconnectListener=Qn.onlineWaiter.then((()=>{this.onlineReconnectListener=void 0})));let r=!0;if(this.reconnectInterrupter=()=>r=!1,n){const o=Z0(this.reconnectCount,this.retryConfig);R.debug("[".concat(this.name,"] wait ").concat(o,"ms to reconnect websocket, mode: ").concat(t)),await Pe.race([Dr(o),this.onlineReconnectListener||new Pe((()=>{}))])}if(this._state==="closed"||!r)return!1;this.reconnectCount+=1;const i=async(o,c)=>{this.emit(gt.RECONNECT_CREATE_CONNECTION,c),await this.createWebSocketConnection(o)};try{if(t==="retry")await i(this.urls[this.currentURLIndex],t);else if(t==="tryNext"){if(this.currentURLIndex+=1,this.currentURLIndex>=this.urls.length)return this.reconnectWithAction("recover",!1);R.debug("[".concat(this.name,"] websocket url length: ").concat(this.urls.length," current index: ").concat(this.currentURLIndex)),await i(this.urls[this.currentURLIndex],t)}else t==="recover"&&(R.debug("[".concat(this.name,"] request new urls")),this.resetReconnectCount("recover mode"),this.urls=await Fr(this,gt.REQUEST_NEW_URLS),this.currentURLIndex=0,await i(this.urls[this.currentURLIndex],t))}catch(o){var s;R.error("[".concat(this.name,"] reconnect failed ").concat(o&&o.toString()));const c=o==null||(s=o.data)===null||s===void 0?void 0:s.desc;return Array.isArray(c)&&Re(c).call(c,"dynamic key expired")?(this.emit(gt.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):this.reconnectWithAction(t,n)}return!0}}class zb extends BM{constructor(t,n){super(t,n,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(t,n){const r=kE(),i=(function(o,c){return new p9(o,c)})(this.forceCloseTimeout,this.store);this.closeEstablishingWs=()=>{R.debug("[choose-best-ws] close establishing websockets"),i.closeAllWebsockets(),r.reject(new ce(U.WS_ABORT,"choose best websocket aborted"))};const s=F("GATEWAY_DOMAINS");return R.debug("[choose-best-ws] currentDomain: ",t,", domains: ",s,"total: ".concat(this.urls.length),"current: ".concat(this.currentURLIndex+1)),i.chooseBestWebsocket(t,this.tryDoubleDomain,this.use443PortOnly,n).then(r.resolve).catch(r.reject),r.promise.finally((()=>{this.closeEstablishingWs=void 0}))}}class JE extends BM{constructor(t,n){super(t,n,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(t,n){return new Pe(((r,i)=>{let s=!1;const o=[];this.closeEstablishingWs=()=>{R.debug("[choose-best-ws] close establishing websockets"),o.forEach((O=>{O.onclose=null,O.onopen=null,O.onmessage=null,O.close()})),i(new ce(U.WS_ABORT,"choose best websocket aborted"))};const c=F("GATEWAY_DOMAINS");let l;const h=t.indexOf("?h="),p=c.find((O=>h!==-1?Re(t).call(t,O,h):Re(t).call(t,O)));R.debug("[choose-best-ws] currentDomain: ",p,", domains: ",c);let E=!this.tryDoubleDomain||!p;if(!E&&p){var g;const O=Date.now();try{c.forEach((I=>{const N=h===-1?t.replace(p,I):t.substr(0,h)+t.substr(h).replace(p,I),M=new WebSocket(N);M.binaryType="arraybuffer",o.push(M),R.debug("[choose-best-ws] ws is connecting:",M.url)}))}catch{for(R.debug("[choose-best-ws] ws create failed, fallback to single url"),o.forEach((N=>N.close()));o.length;)o.pop();E=!0}(g=this.store)===null||g===void 0||g.recordJoinChannelService({urls:o.map((I=>I.url)),service:"gateway"},n),o.forEach((I=>{I.onopen=()=>{if(s)return;const N=Date.now()-O;R.debug("[choose-best-ws] ws open cost ".concat(N,"ms")),o.filter((M=>M!==I)).forEach((M=>{R.debug("[choose-best-ws]close backup websocket: ".concat(M.url)),M.close()})),s=!0,r(I)},I.onclose=N=>{l=N,!s&&(o.find((M=>!(M.readyState===WebSocket.CLOSED||M.readyState===WebSocket.CLOSING)))||(R.debug("[choose-best-ws] all websocket is closed"),s=!0,i(l)))},I.onmessage=N=>{R.debug("[choose-best-ws]".concat(I.url," onmessage: ").concat(N.data))}})),Dr(this.forceCloseTimeout).then((()=>{o.forEach((I=>{I.readyState!==WebSocket.OPEN&&I.close()}))}))}if(E){var v;let O;R.debug("[choose-best-ws] use single url: ",t),(v=this.store)===null||v===void 0||v.recordJoinChannelService({urls:[t],service:"gateway"},n);try{O=new WebSocket(t),o.push(O),O.binaryType="arraybuffer"}catch(I){const N=new ce(U.WS_ERR,"init websocket failed! Error: ".concat(I.toString()));return R.error("[".concat(this.name,"]").concat(N)),void i(N)}O.onopen=()=>{r(O)},O.onclose=I=>{i(I)},O.onmessage=I=>{R.debug("[choose-best-ws]".concat(O.url," onmessage: ").concat(I.data))},Dr(this.forceCloseTimeout).then((()=>{O&&O.readyState!==WebSocket.OPEN&&O.close()}))}})).then((r=>(this.closeEstablishingWs=void 0,r))).catch((r=>{throw this.closeEstablishingWs=void 0,r}))}}class f9 extends Pn{get connectionState(){return this._connectionState}set connectionState(t){t!==this._connectionState&&(this._connectionState=t,t===_n.CONNECTED?this.emit(at.WS_CONNECTED):t===_n.RECONNECTING?this.emit(at.WS_RECONNECTING,this._websocketReconnectReason):t===_n.CLOSED&&this.emit(at.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(t,n){super(),k(this,"_disconnectedReason",void 0),k(this,"_websocketReconnectReason",void 0),k(this,"_connectionState",_n.CLOSED),k(this,"reconnectToken",void 0),k(this,"websocket",void 0),k(this,"openConnectionTime",void 0),k(this,"clientId",void 0),k(this,"lastMsgTime",Date.now()),k(this,"uploadCache",[]),k(this,"uploadCacheInterval",void 0),k(this,"rttRolling",new X1(5)),k(this,"pingpongTimer",void 0),k(this,"wsInflateDataTimer",void 0),k(this,"pingpongTimeoutCount",0),k(this,"ortc",void 0),k(this,"joinResponse",void 0),k(this,"multiIpOption",void 0),k(this,"initError",void 0),k(this,"spec",void 0),k(this,"store",void 0),k(this,"onWebsocketMessage",(r=>{if(r.data instanceof ArrayBuffer)return void this.emit(at.ON_BINARY_DATA,r.data);const i=JSON.parse(r.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(i,"_id")){const s="res-@".concat(i._id);this.emit(s,i._result,i._message)}else if(Object.prototype.hasOwnProperty.call(i,"_type")){if(this.emit(i._type,i._message),i._type===Pt.ON_NOTIFICATION&&this.handleNotification(i._message),i._type===Pt.ON_USER_BANNED)switch(i._message.error_code){case 14:this.close(Qt.UID_BANNED);break;case 15:this.close(Qt.IP_BANNED);break;case 16:this.close(Qt.CHANNEL_BANNED)}if(i._type===Pt.ON_USER_LICENSE_BANNED)switch(i._message.error_code){case Ze.ERR_LICENSE_MISSING:this.close(Qt.LICENSE_MISSING);break;case Ze.ERR_LICENSE_EXPIRED:this.close(Qt.LICENSE_EXPIRED);break;case Ze.ERR_LICENSE_MINUTES_EXCEEDED:this.close(Qt.LICENSE_MINUTES_EXCEEDED);break;case Ze.ERR_LICENSE_PERIOD_INVALID:this.close(Qt.LICENSE_PERIOD_INVALID);break;case Ze.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(Qt.LICENSE_MULTIPLE_SDK_SERVICE);break;case Ze.ERR_LICENSE_ILLEGAL:this.close(Qt.LICENSE_ILLEGAL);break;default:this.close()}}})),this.clientId=t.clientId,this.spec=t,this.store=n,this.websocket=new zb("gateway-".concat(this.clientId),this.spec.retryConfig,!0,F("JOIN_GATEWAY_USE_DUAL_DOMAIN"),F("JOIN_GATEWAY_USE_443PORT_ONLY"),n),this.handleWebsocketEvents(),window.addEventListener("offline",(()=>{this.connectionState===_n.CONNECTED&&this.reconnect("retry",jr.OFFLINE)}))}async request(t,n,r,i){const s=ln(6,""),o={_id:s,_type:t,_message:n},c=this.websocket.connectionID,l=()=>new Pe(((O,I)=>{if(this.connectionState===_n.CONNECTED)return O();const N=()=>{this.off(at.WS_CLOSED,M),O()},M=()=>{this.off(at.WS_CONNECTED,N),I(new se(U.WS_ABORT))};this.once(at.WS_CONNECTED,N),this.once(at.WS_CLOSED,M),t!==st.PUBLISH&&t!==st.PUBLISH_DATASTREAM&&t!==st.SUBSCRIBE&&t!==st.SUBSCRIBE_DATASTREAM&&t!==st.UNSUBSCRIBE&&t!==st.UNSUBSCRIBE_DATASTREAM&&t!==st.UNPUBLISH&&t!==st.UNPUBLISH_DATASTREAM&&t!==st.CONTROL&&t!==st.RESTART_ICE||this.once(at.DISCONNECT_P2P,(()=>{I(new se(U.DISCONNECT_P2P))})),t!==st.PUBLISH&&t!==st.RESTART_ICE||this.once(at.ABORT_P2P_EXECUTION,(()=>{I(new se(U.DISCONNECT_P2P))}))}));if(this.connectionState!==_n.CONNECTING&&this.connectionState!==_n.RECONNECTING||t===st.JOIN||t===st.REJOIN||await l(),this.websocket.sendMessage(o,!0),i)return;const h=new Pe(((O,I)=>{let N=!1;const M=(B,Z)=>{N=!0,O({isSuccess:B==="success",message:Z||{}}),this.off(at.WS_CLOSED,x),this.off(at.WS_RECONNECTING,x),this.emit(at.REQUEST_SUCCESS,t,n)};this.once("res-@".concat(s),M);const x=()=>{I(new se(U.WS_ABORT,"type: ".concat(t))),this.off(at.WS_CLOSED,x),this.off(at.WS_RECONNECTING,x),this.off("res-@".concat(s),M)};this.once(at.WS_CLOSED,x),this.once(at.WS_RECONNECTING,x),Dr(F("SIGNAL_REQUEST_TIMEOUT")).then((()=>{this.websocket.connectionID!==c||N||(R.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(t)),this.emit(at.REQUEST_TIMEOUT,t,n))}))}));let p=null;try{p=await h}catch(O){if(this.connectionState===_n.CLOSED||t===st.LEAVE)throw new se(U.WS_ABORT);return!this.spec.forceWaitGatewayResponse||r?O.throw():t===st.JOIN||t===st.REJOIN?null:(await l(),await this.request(t,n))}if(p.isSuccess)return p.message;const E=Number(p.message.error_code||p.message.code),g=XE(E),v=new se(U.UNEXPECTED_RESPONSE,"".concat(g.desc,": ").concat(p.message.error_str),{code:E,data:p.message,desc:g.desc});return g.action==="success"?p.message:(R.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(t,", error_code: ").concat(E,", message: ").concat(g.desc,", action: ").concat(g.action)),E===Ze.ERR_TOO_MANY_BROADCASTERS?((t===st.JOIN||t===st.REJOIN)&&(this.initError=v,this.close()),v.throw()):g.action==="failed"?v.throw():g.action==="quit"?(this.initError=v,this.close(),v.throw()):(E===Ze.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=p.message.option,R.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",jr.MULTI_IP)):this.reconnect(g.action,jr.SERVER_ERROR),t===st.JOIN||t===st.REJOIN?null:await this.request(t,n)))}waitMessage(t,n){return new Pe((r=>{const i=s=>{(!n||n(s))&&(this.off(t,i),r(s))};this.on(t,i)}))}uploadWRTCStats(t){if(!this.store.sessionId)return void R.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const n={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:t};this.upload(YE.WRTC_STATS,n)}upload(t,n){const r={_type:t,_message:n};try{this.websocket.sendMessage(r)}catch{const s=F("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(r),this.uploadCache.length>s&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval((()=>{if(this.connectionState!==_n.CONNECTED)return;const o=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(o._type,o._message)}),F("UPLOAD_CACHE_INTERVAL")||2e3))}}send(t,n){const r={_type:t,_message:n};this.websocket.sendMessage(r)}init(t){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new Pe(((n,r)=>{this.once(at.WS_CONNECTED,(()=>n(this.joinResponse))),this.once(at.WS_CLOSED,(i=>r(this.initError||new se(U.WS_ABORT,i)))),this.connectionState=_n.CONNECTING,this.websocket.init(t).catch(r),this.wsInflateDataTimer&&window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=window.setInterval((()=>{this.handleWsInflateData()}),2e4)}))}close(t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=t||Qt.LEAVE,this.connectionState=_n.CLOSED,R.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close()}async join(){if(!this.joinResponse){this.emit(at.ABORT_P2P_EXECUTION),this.store.signalConnected();const t=await Fr(this,at.REQUEST_JOIN_INFO);this.store.joinReq();const n=await this.request(st.JOIN,t);if(this.ortc=t?.ortc,this.store.joinRep(),!n)return this.emit(at.REPORT_JOIN_GATEWAY,tT.TIMEOUT,this.url||""),!1;this.joinResponse=n,this.emit(at.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=_n.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}async rejoin(){if(!this.reconnectToken)throw new se(U.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const t=VE(this,at.REQUEST_REJOIN_INFO);t.token=this.reconnectToken;const n=await this.request(st.REJOIN,t);return!!n&&(this.connectionState=_n.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),n.peers&&n.peers.forEach((r=>{this.emit(Pt.ON_USER_ONLINE,{uid:r.uid}),r.audio&&this.emit(Pt.ON_ADD_AUDIO_STREAM,{uid:r.uid,uint_id:r.uint_id,audio:!0,ssrcId:r.audio_ssrc}),r.video&&this.emit(Pt.ON_ADD_VIDEO_STREAM,{uid:r.uid,uint_id:r.uint_id,video:!0,ssrcId:r.video_ssrc}),r.audio_mute?this.emit(Pt.MUTE_AUDIO,{uid:r.uid}):this.emit(Pt.UNMUTE_AUDIO,{uid:r.uid}),r.video_mute?this.emit(Pt.MUTE_VIDEO,{uid:r.uid}):this.emit(Pt.UNMUTE_VIDEO,{uid:r.uid}),r.audio_enable_local?this.emit(Pt.ENABLE_LOCAL_AUDIO,{uid:r.uid}):this.emit(Pt.DISABLE_LOCAL_AUDIO,{uid:r.uid}),r.video_enable_local?this.emit(Pt.ENABLE_LOCAL_VIDEO,{uid:r.uid}):this.emit(Pt.DISABLE_LOCAL_VIDEO,{uid:r.uid}),r.audio||r.video||this.emit(Pt.ON_REMOVE_STREAM,{uid:r.uid,uint_id:r.uint_id})})),!0)}reconnect(t,n){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(t,n)}async downgradeCodec(t){if(!this.ortc)return!1;const n={downgrade_codec:t,ortc:this.ortc};return!!await this.request(st.DOWNGRADE_CODEC,n)}handleNotification(t){R.debug("[".concat(this.clientId,"] receive notification: "),t);const n=XE(t.code);if(t.code===28&&"detail"in t&&(R.info("[".concat(this.clientId,"] receive recover notification: "),t.detail),this.emit(at.RECOVER_NOTIFICATION,t.detail)),n.action!=="success"){if(n.action!=="failed")return n.action==="quit"?(n.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(Qt.UID_BANNED),void this.close()):void this.reconnect(n.action,jr.SERVER_ERROR);R.error("[".concat(this.clientId,"] ignore error: "),n.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const t=F("PING_PONG_TIME_OUT"),n=Date.now();this.pingpongTimeoutCount>=t&&(R.warning("[".concat(this.clientId,"] PING-PONG Timeout. Last Socket Message: ").concat(n-this.lastMsgTime,"ms")),n-this.lastMsgTime>F("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",jr.TIMEOUT):this.request(st.PING,void 0,!0).then((()=>{this.pingpongTimeoutCount=0;const r=Date.now()-n;this.rttRolling.add(r),F("REPORT_STATS")&&this.send(st.PING_BACK,{pingpongElapse:r})})).catch((r=>{}))}handleWsInflateData(){const{wsInflateLength:t,wsDeflateLength:n}=this.websocket.getWsInflateData();t!==0&&n!==0&&this.upload(YE.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:n,ws_inflate_length:t})}handleWebsocketEvents(){this.websocket.on(gt.RECONNECT_CREATE_CONNECTION,(t=>{this.emit(at.WS_RECONNECT_CREATE_CONNECTION,t)})),this.websocket.on(gt.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(gt.CLOSED,(()=>{this.connectionState=_n.CLOSED})),this.websocket.on(gt.FAILED,(()=>{this._disconnectedReason=Qt.NETWORK_ERROR,this.connectionState=_n.CLOSED})),this.websocket.on(gt.RECONNECTING,(t=>{this._websocketReconnectReason=t,this.joinResponse=void 0,this.connectionState===_n.CONNECTED?this.connectionState=_n.RECONNECTING:this.connectionState=_n.CONNECTING})),this.websocket.on(gt.WILL_RECONNECT,((t,n,r)=>{const i=VE(this,at.IS_P2P_DISCONNECTED),s=i||t!=="retry";i&&t==="retry"&&(R.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),t="tryNext",n=tT.P2P_DISCONNECTED),s&&(R.debug("".concat(this.clientId," will renewSession, reconnect mode: ").concat(t)),this.emit(at.REPORT_JOIN_GATEWAY,n||tT.UNKNOWN_REASON,this.url||""),this.reconnectToken=void 0,this.emit(at.DISCONNECT_P2P)),r(t)})),this.websocket.on(gt.CONNECTED,(()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch((t=>{R.warning("[".concat(this.clientId,"] rejoin failed ").concat(t)),this.reconnect("tryNext",jr.SERVER_ERROR)})):this.join().catch((t=>{if(this.emit(at.REPORT_JOIN_GATEWAY,t,this.url||""),t instanceof se){if(t.code===U.UNEXPECTED_RESPONSE&&t.data.code===Ze.ERR_NO_AUTHORIZED)return this.initError=new se(U.TOKEN_EXPIRE,"dynamic key expired"),void this.close(Qt.TOKEN_EXPIRE);R.error("[".concat(this.clientId,"] join gateway request failed"),t.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",jr.SERVER_ERROR):(this.initError=t,this.close())}}))})),this.websocket.on(gt.REQUEST_NEW_URLS,((t,n)=>{Fr(this,at.REQUEST_RECOVER,this.multiIpOption).then(t).catch(n)})),this.websocket.on(gt.ON_TOKEN_PRIVILEGE_DID_EXPIRE,(()=>{this.emit(Pt.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})),this.websocket.on(VM.PRE_CONNECT_PC,(()=>{this.emit(at.PRE_CONNECT_PC)}))}}let m9=(function(e){return e.NATIVE_RTC="native_rtc",e.NATIVE_RTM="native_rtm",e.WEB_RTC="web_rtc",e.WEB_RTM="web_rtm",e})({}),Zn=(function(e){return e[e.CHOOSE_SERVER=11]="CHOOSE_SERVER",e[e.CLOUD_PROXY=18]="CLOUD_PROXY",e[e.CLOUD_PROXY_5=20]="CLOUD_PROXY_5",e[e.CLOUD_PROXY_FALLBACK=26]="CLOUD_PROXY_FALLBACK",e})({});function WM(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable}))),n.push.apply(n,r)}return n}function rT(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?WM(Object(n),!0).forEach((function(r){k(e,r,n[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):WM(Object(n)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))}))}return e}function Pd(e){return e.match(/^[\.\:\d]+$/)?"".concat(e.replace(/[^\d]/g,"-"),".").concat(F("TURN_DOMAIN")):(R.debug("Cannot recognized as ip address: ".concat(e,", use as host2")),e)}function iT(e){try{const t=F("GATEWAY_DOMAINS").concat(F("TURN_DOMAIN")).find((n=>Re(e).call(e,n)));return t?e.split(".".concat(t))[0].replace(/-/g,"."):e}catch{return R.debug("serverUrlToIp error, fallback to url",e),e}}function Yb(e,t){e.addresses||(e.addresses=[]);const n=(function(c,l){if(F("CONNECT_GATEWAY_WITHOUT_DOMAIN"))return c.map((E=>{let{ip:g,port:v}=E;return{address:"".concat(g,":").concat(v)}}));const h=F("GATEWAY_DOMAINS");let p=h[1]&&Re(l).call(l,h[1])?1:0;return c.map((E=>{let{domain_prefix:g,port:v,ip:O}=E;if(g)return{address:"".concat(g,".").concat(h[p++%h.length],":").concat(v)};const I=/^[\.\:\d]+$/.test(O),N=I?"".concat(O.replace(/[^\d]/g,"-"),".").concat(h[p++%h.length],":").concat(v):"".concat(O,":").concat(v);return I||R.debug("Cannot recognized as ip address: ".concat(O,", use as host3")),{ip:O,port:v,address:N}}))})(e.addresses,t),r=Array.isArray(e.detail)&&e.detail[18];if(r&&typeof r=="string"){const c=r.split(";");for(let l=0;l<c.length;l++){var i;const h=pi(i=c[l]).call(i);n[l]&&h&&(n[l].ip6=h)}}const s=e.detail&&e.detail.candidate;let o;if(s){const[c,l]=s.split(":");c&&l&&(o={port:Number(l),ip:c,address:"".concat(c,":").concat(l)})}return{gatewayAddrs:n,apGatewayAddress:o,uid:e.uid,cid:e.cid,cert:e.cert,vid:e.detail&&e.detail[8],uni_lbs_ip:e.detail&&e.detail[1],res:e,csIp:e.detail&&e.detail[502]}}function Es(e){return typeof e=="number"?e:e.exact||e.ideal||e.max||e.min||0}function GM(e){const t=e._encoderConfig;if(!t)return{};const n={resolution:t.width&&t.height?"".concat(Es(t.width),"x").concat(Es(t.height)):void 0,maxVideoBW:t.bitrateMax,minVideoBW:t.bitrateMin};return typeof t.frameRate=="number"?(n.maxFrameRate=t.frameRate,n.minFrameRate=t.frameRate):t.frameRate&&(n.maxFrameRate=t.frameRate.max||t.frameRate.ideal||t.frameRate.exact||t.frameRate.min,n.minFrameRate=t.frameRate.min||t.frameRate.ideal||t.frameRate.exact||t.frameRate.max),n}function HM(e){return e>=0&&e<.17?1:e>=.17&&e<.36?2:e>=.36&&e<.59?3:e>=.59&&e<=1?4:e>1?5:0}function QE(e,t){let n,r,i;switch(t){case Zn.CHOOSE_SERVER:r=4096,i="choose server";break;case Zn.CLOUD_PROXY:r=1048576,i="proxy";break;case Zn.CLOUD_PROXY_5:r=4194304,i="proxy5";break;case Zn.CLOUD_PROXY_FALLBACK:r=4194310,i="proxy fallback";break;default:throw new se(U.UNEXPECTED_ERROR,"multi unlibs response transformer get unknown service id",{csIp:e.detail&&e.detail[502],retry:!1})}if(e.response_body.forEach((s=>{s.buffer&&s.buffer.flag===r&&(n={code:s.buffer.code,addresses:(s.buffer.edges_services||[]).map((o=>rT(rT({},o),{},{ticket:s.buffer.cert}))),server_ts:e.enter_ts,uid:s.buffer.uid,cid:s.buffer.cid,cname:s.buffer.cname,detail:rT(rT({},s.buffer.detail),e.detail),flag:s.buffer.flag,opid:e.opid,cert:s.buffer.cert})})),!n)throw new se(U.MULTI_UNILBS_RESPONSE_ERROR,"cannot parse response ".concat(i," from multi unilbs response"),{csIp:e.detail&&e.detail[502]});return n}async function KM(e,t){return await Pe.all(e.addresses.map((async n=>({address:Pd(n.ip),tcpport:n.port,udpport:n.port,username:t&&F("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?t.toString():Br.username,password:t&&F("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?await q0(t.toString()):Br.password}))))}function qb(e,t){const n=t.getMediaStreamTrack(!0).getSettings(),r=t.videoHeight||n.height,i=t.videoWidth||n.width;return r&&i?Math.max(Math.min(r,i)/Math.min(Es(e.height),Es(e.width)),1):(R.warning("can't get ori-track's height, default scale down 4 times for low stream"),4)}function Dd(e){let{candidateType:t,relayProtocol:n,type:r,address:i,port:s,protocol:o}=e;const c={candidateType:t,relayProtocol:n,protocol:o};if(r!=="local-candidate"){const l=i.split(".");l.length>=4&&(l[1]="*",l[2]="*"),c.address=l.join("."),c.port=s}return c}function wh(e){const t=e.split(":"),n=e.split(/[-.]/),r=Re(e).call(e,"-")?"-":".";let i=e;return t.length>1?n.length>1?(n[1]="**",i=n[0]+r+"**:"+t[t.length-1]):i=t.length>2?t[0]+r+"**:"+t[t.length-1]:"**:"+t[t.length-1]:n.length>1&&(i=n[0]+r+"**"),i}function sT(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:F("SVC_MODE");if(F("ENABLE_SVC"))return(function(t){return t in kS})(e)?e:kS.L1T3}const zM={[Le.VIDEO]:[{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"},{key:"video-orientation",extensionName:"urn:3gpp:video-orientation"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"playout-delay",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/playout-delay"},{key:"video-content-type",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-content-type"},{key:"color-space",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/color-space"},{key:"video-timing",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-timing"}],[Le.AUDIO]:[{key:"ssrc-audio-level",extensionName:"urn:ietf:params:rtp-hdrext:ssrc-audio-level"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"}]};function oT(e,t,n){t.forEach((r=>{var i;const s=zM[e].find((c=>{var l;let{key:h}=c;return Re(l=r.extensionName).call(l,h)}));if(!s)return;const o=n.find((c=>{let{extensionName:l}=c;return Re(l).call(l,s.key)}));o&&Re(i=o.extensionName).call(i,"gdpr_forbidden")&&(r.extensionName=o.extensionName)}))}function Hf(e,t){t.forEach((n=>{var r;const i=zM[e].find((s=>{var o;let{key:c}=s;return Re(o=n.extensionName).call(o,c)}));Re(r=n.extensionName).call(r,"gdpr_forbidden")&&i&&(n.extensionName=i.extensionName)}))}function YM(e){return e==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"||Re(e).call(e,"abs-send-time")}function aT(e){return e==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"||Re(e).call(e,"draft-holmer-rmcat-transport-wide-cc-extensions-01")}function qM(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable}))),n.push.apply(n,r)}return n}function XM(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?qM(Object(n),!0).forEach((function(r){k(e,r,n[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):qM(Object(n)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))}))}return e}function ZE(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},r=arguments.length>3?arguments[3]:void 0;const{filterRTX:i,filterVideoFec:s,filterAudioFec:o,filterAudioCodec:c,filterVideoCodec:l,unsupportedVideoUplinkCodec:h,unsupportedVideoDownlinkCodec:p}=t,{useXR:E}=n;let g=[],v=[],O=[],I=[],N=!1,M=!1;if(Zi(e).mediaDescriptions.forEach((B=>{r&&r!==B.attributes.direction||(B.media.mediaType!=="video"||N||(v=B.attributes.payloads,I=B.attributes.extmaps,N=!0),B.media.mediaType!=="audio"||M||(g=B.attributes.payloads,O=B.attributes.extmaps,M=!0))})),!I||v.length===0)throw new Error("Cannot get video capabilities from SDP.");if(!O||g.length===0)throw new Error("Cannot get audio capabilities from SDP.");if(v.forEach((B=>{var Z;(Z=B.rtpMap)!==null&&Z!==void 0&&Z.clockRate&&(B.rtpMap.clockRate=parseInt(B.rtpMap.clockRate)),E&&B.rtcpFeedbacks.push({type:"rrtr"})})),g.forEach((B=>{var Z;(Z=B.rtpMap)!==null&&Z!==void 0&&Z.clockRate&&(B.rtpMap.clockRate=parseInt(B.rtpMap.clockRate)),E&&B.rtcpFeedbacks.push({type:"rrtr"})})),i&&(g=g.filter((B=>{var Z;return((Z=B.rtpMap)===null||Z===void 0?void 0:Z.encodingName.toLowerCase())!=="rtx"})),v=v.filter((B=>{var Z;return((Z=B.rtpMap)===null||Z===void 0?void 0:Z.encodingName.toLowerCase())!=="rtx"}))),s){const B=v.filter((z=>{var te;return/(red)|(ulpfec)|(flexfec)/i.test(((te=z.rtpMap)===null||te===void 0?void 0:te.encodingName)||"")})),Z=Ld(B,v).map((z=>z.payloadType)),Q=[...B.map((z=>z.payloadType)),...Z];v=v.filter((z=>!Re(Q).call(Q,z.payloadType)))}if(o&&(g=g.filter((B=>{var Z;return!/(red)|(ulpfec)|(flexfec)/i.test(((Z=B.rtpMap)===null||Z===void 0?void 0:Z.encodingName)||"")}))),c&&c?.length>0&&(g=g.filter((B=>{var Z;return Re(c).call(c,((Z=B.rtpMap)===null||Z===void 0?void 0:Z.encodingName.toLowerCase())||"")}))),l&&l?.length>0){const B=v.filter((Z=>{var Q;return Re(l).call(l,((Q=Z.rtpMap)===null||Q===void 0?void 0:Q.encodingName.toLowerCase())||"")}));v=B.concat(i?[]:Ld(B,v))}const x=F("UNSUPPORTED_VIDEO_CODEC");if(x&&x.length>0){const B=v.filter((z=>z.rtpMap&&Re(x).call(x,z.rtpMap.encodingName.toLowerCase()))),Z=Ld(B,v),Q=B.concat(Z).map((z=>z.payloadType));v=v.filter((z=>!Re(Q).call(Q,z.payloadType))),R.debug("unsupportedVideoCodec: ".concat(x,", toBeRemoved: ").concat(Q))}if(h&&h.length>0&&r==="sendonly"){const B=v.filter((z=>z.rtpMap&&Re(h).call(h,z.rtpMap.encodingName.toLowerCase()))),Z=Ld(B,v),Q=B.concat(Z).map((z=>z.payloadType));v=v.filter((z=>!Re(Q).call(Q,z.payloadType))),R.debug("unsupportedVideoUplinkCodec: ".concat(h,", toBeRemoved: ").concat(Q))}if(p&&p.length>0&&r==="recvonly"){const B=v.filter((z=>z.rtpMap&&Re(p).call(p,z.rtpMap.encodingName.toLowerCase()))),Z=Ld(B,v),Q=B.concat(Z).map((z=>z.payloadType));v=v.filter((z=>!Re(Q).call(Q,z.payloadType))),R.debug("unsupportedVideoDownlinkCodec: ".concat(p,", toBeRemoved: ").concat(Q))}return{audioCodecs:g,videoCodecs:v,audioExtensions:O,videoExtensions:I}}function kd(e){const t=Zi(e);let n,r;for(const i of t.mediaDescriptions){if(!n){const s=i.attributes.iceUfrag,o=i.attributes.icePwd;if(!s||!o)throw new Error("Cannot get iceUfrag or icePwd from SDP.");n={iceUfrag:s,icePwd:o}}if(!r){const s=i.attributes.fingerprints;s.length>0&&(r={fingerprints:s})}}if(!r&&t.attributes.fingerprints.length>0&&(r={fingerprints:t.attributes.fingerprints}),!r||!n)throw new Error("Cannot get iceParameters or dtlsParameters from SDP.");return{iceParameters:n,dtlsParameters:r}}function JM(e,t){const n=[],r=e.attributes.ssrcGroups.filter((o=>o.semantic==="FID")),i=e.attributes.ssrcGroups.find((o=>o.semantic==="SIM")),s=e.attributes.ssrcs;if(i)i.ssrcIds.forEach((o=>{var c;const l=(c=r.find((h=>h.ssrcIds[0]===o)))===null||c===void 0?void 0:c.ssrcIds[1];n.push({ssrcId:o,rtx:t?l:void 0})}));else if(r.length>0){const o=r[0].ssrcIds[0],c=r[0].ssrcIds[1];n.push({ssrcId:o,rtx:t?c:void 0})}else{if(s.length===0)throw new Error("No ssrcs found on local media description.");n.push({ssrcId:s[0].ssrcId})}return n}function QM(e,t,n){const{cname:r}=e;let i=[];t&&(i=ZM(t)),i.length===0&&(i=e.iceParameters.candidates.map((p=>({foundation:p.foundation,componentId:"1",transport:p.protocol,priority:p.priority.toString(),connectionAddress:p.ip,port:p.port.toString(),type:p.type,extension:{}}))),R.debug("Using candidates from gateway."));const s={fingerprints:e.dtlsParameters.fingerprints.map((p=>({hashFunction:p.algorithm,fingerprint:p.fingerprint})))},o={iceUfrag:e.iceParameters.iceUfrag,icePwd:e.iceParameters.icePwd};let c;switch(e.dtlsParameters.role){case"server":c="passive";break;case"client":c="active";break;case"auto":c="actpass"}const l=lT(e.rtpCapabilities),h=[];return Array.isArray(n)&&n.length>0&&n.forEach((p=>{h.push({kind:Le.VIDEO,ssrcMsg:[{ssrcId:p.v,rtx:p.v_rtx}],mslabel:"".concat(p.v,"_").concat(p.a)},{kind:Le.AUDIO,ssrcMsg:[{ssrcId:p.a}],mslabel:"".concat(p.v,"_").concat(p.a)})})),{dtlsParameters:s,iceParameters:o,candidates:i,rtpCapabilities:l,setup:c,cname:r,preSSRCs:h}}function ZM(e){let t=[];return e.ip&&typeof e.port=="number"&&(t=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:e.ip,port:e.port.toString(),type:"host",extension:{}}],R.debug("Using remote candidate from AP ".concat(wh(e.ip),":").concat(e.port)),e.ip6&&(t.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:e.ip6,port:e.port.toString(),type:"host",extension:{}}),R.debug("Using IPV6 remote candidate from AP ".concat(wh(e.ip6),":").concat(e.port)))),t}function $E(e,t,n){const r=[],i=[];return e.forEach((s=>{let{ssrcId:o,rtx:c}=s;const l=ln(8,"track-"),h={ssrcId:o,attributes:XM({label:l,mslabel:n=n||ln(10,""),msid:"".concat(n," ").concat(l)},t&&{cname:t})};if(r.push(h),c!==void 0){const p={ssrcId:c,attributes:XM({label:l,mslabel:n,msid:"".concat(n," ").concat(l)},t&&{cname:t})};r.push(p),i.push({semantic:"FID",ssrcIds:[o,c]})}})),e.length>1&&i.push({semantic:"SIM",ssrcIds:e.map((s=>{let{ssrcId:o}=s;return o}))}),{ssrcs:r,ssrcGroups:i}}function Kf(e,t){t instanceof Fn&&e.attributes.payloads.forEach((n=>{var r;const i=(r=n.rtpMap)===null||r===void 0?void 0:r.encodingName.toLowerCase();if(!i||["opus","pcmu","pcma","g722"].indexOf(i)===-1)return;n.fmtp||(n.fmtp={parameters:{}}),i==="opus"&&typeof F("OPUS_PTIME")=="number"?n.fmtp.parameters.ptime=F("OPUS_PTIME"):n.fmtp.parameters.minptime="10",n.fmtp.parameters.useinbandfec="1";const s=t._encoderConfig;s&&(i!=="pcmu"&&i!=="pcma"&&i!=="g722"&&(s.bitrate&&!xn()&&(n.fmtp.parameters.maxaveragebitrate="".concat(Math.floor(1e3*s.bitrate))),s.sampleRate&&(n.fmtp.parameters.maxplaybackrate="".concat(s.sampleRate),n.fmtp.parameters["sprop-maxcapturerate"]="".concat(s.sampleRate)),s.stereo&&(n.fmtp.parameters.stereo="1",n.fmtp.parameters["sprop-stereo"]="1")),t instanceof KE&&i==="opus"&&t._config.DTX&&(n.fmtp.parameters.usedtx="1"))}))}function Xb(e){const t=e.attributes.unrecognized.findIndex((n=>n.attField==="x-google-flag"&&n.attValue==="conference"));t!==-1&&e.attributes.unrecognized.splice(t,1)}function Jb(e,t){var n;if(!(t instanceof vn&&t._encoderConfig&&t._hints.indexOf(an.SCREEN_TRACK)===-1))return;const r=t._encoderConfig;Ft().supportMinBitrate&&r.bitrateMin&&e.attributes.payloads.forEach((i=>{var s,o;Re(s=["h264","h265","vp8","vp9","av1"]).call(s,((o=i.rtpMap)===null||o===void 0?void 0:o.encodingName.toLowerCase())||"")&&(i.fmtp||(i.fmtp={parameters:{}}),i.fmtp.parameters["x-google-min-bitrate"]="".concat(r.bitrateMin))})),Ft().supportMinBitrate&&!Re(n=t._hints).call(n,an.LOW_STREAM)&&r.bitrateMax&&e.attributes.payloads.forEach((i=>{var s,o;Re(s=["h264","h265","vp8","vp9","av1"]).call(s,((o=i.rtpMap)===null||o===void 0?void 0:o.encodingName.toLowerCase())||"")&&(i.fmtp||(i.fmtp={parameters:{}}),i.fmtp.parameters["x-google-start-bitrate"]="".concat(F("X_GOOGLE_START_BITRATE")||Math.floor(r.bitrateMax)))}))}function $M(e){if(e.media.mediaType!=="video")return;const t=xt();if(t.name!==Gt.SAFARI&&t.os!==Er.IOS)return;const n=e.attributes.extmaps.findIndex((r=>/video-orientation/g.test(r.extensionName)));n!==-1&&e.attributes.extmaps.splice(n,1)}function cT(e,t,n){if(!t)return;let r,i;if(e.media.mediaType==="video"?(r=n.videoExtensions,i=n.videoCodecs):(r=n.audioExtensions,i=n.audioCodecs),t.twcc===!0){const s=r.find((o=>aT(o.extensionName)));if(s){const o=s.extensionName;e.attributes.extmaps.find((l=>aT(l.extensionName)))||e.attributes.extmaps.push({entry:s.entry,extensionName:o}),(function(l,h){return h.filter((p=>!!l.find((E=>E.payloadType===p.payloadType&&!!E.rtcpFeedbacks.find((g=>g.type==="transport-cc"))))))})(i,e.attributes.payloads).forEach((l=>{l.rtcpFeedbacks.find((h=>h.type==="transport-cc"))||l.rtcpFeedbacks.push({type:"transport-cc"})}))}}else if(t.twcc===!1){const s=e.attributes.extmaps.findIndex((o=>aT(o.extensionName)));s!==-1&&e.attributes.extmaps.splice(s,1),e.attributes.payloads.forEach((o=>{const c=o.rtcpFeedbacks.findIndex((l=>l.type==="transport-cc"));c!==-1&&o.rtcpFeedbacks.splice(c,1)}))}if(t.remb===!0){const s=r.find((o=>YM(o.extensionName)));if(s){const o=s.extensionName;e.attributes.extmaps.find((l=>l.extensionName===o))||e.attributes.extmaps.push({entry:s.entry,extensionName:o}),(function(l,h){return h.filter((p=>!!l.find((E=>E.payloadType===p.payloadType&&!!E.rtcpFeedbacks.find((g=>g.type==="goog-remb"))))))})(i,e.attributes.payloads).forEach((l=>{l.rtcpFeedbacks.find((h=>h.type==="goog-remb"))||l.rtcpFeedbacks.push({type:"goog-remb"})}))}}else if(t.remb===!1){const s=e.attributes.extmaps.findIndex((o=>YM(o.extensionName)));s!==-1&&e.attributes.extmaps.splice(s,1),e.attributes.payloads.forEach((o=>{const c=o.rtcpFeedbacks.findIndex((l=>l.type==="goog-remb"));c!==-1&&o.rtcpFeedbacks.splice(c,1)}))}}function e2(e,t,n){if(xn()||e.media.mediaType!=="video"||!(t instanceof vn)||n!=="vp9"&&n!=="vp8"||n==="vp8"&&!F("SIMULCAST")||n==="vp9"&&F("ENABLE_SVC")||t._scalabilityMode===void 0||t._scalabilityMode.numSpatialLayers<=1)return;const r=n==="vp8"?2:t._scalabilityMode.numSpatialLayers,i=e.attributes.ssrcs[0],s=e.attributes.ssrcGroups.find((c=>c.semantic==="FID"&&c.ssrcIds[0]===i.ssrcId)),o={semantic:"SIM",ssrcIds:[i.ssrcId]};for(let c=1;c<r;c++)e.attributes.ssrcs.push({ssrcId:i.ssrcId+c,attributes:An(i.attributes)}),o.ssrcIds.push(i.ssrcId+c),s&&(e.attributes.ssrcs.push({ssrcId:s.ssrcIds[1]+c,attributes:An(i.attributes)}),e.attributes.ssrcGroups.push({semantic:"FID",ssrcIds:[i.ssrcId+c,s.ssrcIds[1]+c]}));e.attributes.ssrcGroups.unshift(o)}async function t2(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=new RTCPeerConnection;n.addTransceiver("video",{direction:"sendonly"}),n.addTransceiver("audio",{direction:"sendonly"}),n.addTransceiver("video",{direction:"recvonly"}),n.addTransceiver("audio",{direction:"recvonly"});const r=(await n.createOffer()).sdp,{send:i,recv:s,sendrecv:o}=(function(){let c=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},h=arguments.length>2?arguments[2]:void 0;const p=ZE(h,c,l,"sendonly"),E=ZE(h,c,l,"recvonly"),g={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},v={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},O={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(Ko(p,E,"videoExtensions",g,v,O),Ko(p,E,"videoCodecs",g,v,O),Ko(p,E,"audioExtensions",g,v,O),Ko(p,E,"audioCodecs",g,v,O),F("RAISE_H264_BASELINE_PRIORITY")){const I=[],N=[];if(O.videoCodecs.forEach(((M,x)=>{var B;if(((B=M.rtpMap)===null||B===void 0?void 0:B.encodingName.toLocaleLowerCase())==="h264"){var Z,Q;const z=O.videoCodecs[x+1],te=z&&o2(M,z),de=(Z=M.fmtp)===null||Z===void 0?void 0:Z.parameters["profile-level-id"],me=(Q=M.fmtp)===null||Q===void 0?void 0:Q.parameters["packetization-mode"];!de||de!==F("FIRST_H264_PROFILE_LEVEL_ID")||F("FIRST_PACKETIZATION_MODE")&&me!==F("FIRST_PACKETIZATION_MODE")?te?N.push([M,z]):N.push([M]):te?I.push([M,z]):I.push([M])}})),I.length>0&&N.length>0){R.debug("raising H264 baseline profile priority"),O.videoCodecs.forEach(((x,B)=>{var Z;if(((Z=x.rtpMap)===null||Z===void 0?void 0:Z.encodingName.toLocaleLowerCase())==="h264"){const Q=o2(x,O.videoCodecs[B+1]),z=I.shift()||N.shift()||[];z.length>0&&(Q?O.videoCodecs.splice(B,2,...z):O.videoCodecs.splice(B,1,...z))}}));const M=v.videoCodecs.filter((x=>{var B,Z;return((B=x.rtpMap)===null||B===void 0?void 0:B.encodingName.toLocaleLowerCase())==="h264"&&((Z=x.fmtp)===null||Z===void 0?void 0:Z.parameters["profile-level-id"])!==F("FIRST_H264_PROFILE_LEVEL_ID")}));if(M.length>0){const x=Ld(M,v.videoCodecs).map((Z=>Z.payloadType)),B=[...M.map((Z=>Z.payloadType)),...x];v.videoCodecs=v.videoCodecs.filter((Z=>!Re(B).call(B,Z.payloadType)))}F("FILTER_SEND_H264_BASELINE")&&(g.videoCodecs=g.videoCodecs.filter((x=>{var B,Z;return!(((B=x.rtpMap)===null||B===void 0?void 0:B.encodingName.toLocaleLowerCase())==="h264"&&((Z=x.fmtp)===null||Z===void 0?void 0:Z.parameters["profile-level-id"])!==F("FIRST_H264_PROFILE_LEVEL_ID"))})))}return{send:g,recv:v,sendrecv:O}}return{send:g,recv:v,sendrecv:O}})(e,t,r);try{n.close()}catch{}return{send:i,recv:s,sendrecv:o}}function n2(){const e={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},t=ZE(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"recvonly"),n={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},r={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},i={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(Ko(e,t,"videoExtensions",n,r,i),Ko(e,t,"videoCodecs",n,r,i),Ko(e,t,"audioExtensions",n,r,i),Ko(e,t,"audioCodecs",n,r,i),F("RAISE_H264_BASELINE_PRIORITY")){const s=i.videoCodecs.findIndex((o=>o.rtpMap&&o.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&o.fmtp&&o.fmtp.parameters["profile-level-id"]==="42001f"));if(s!==-1){const o=i.videoCodecs.findIndex((c=>c.rtpMap&&c.rtpMap.encodingName.toLocaleLowerCase()==="h264"));if(o<s){R.debug("raising H264 baseline profile priority");const c=i.videoCodecs[s];i.videoCodecs.splice(s,1),i.videoCodecs.splice(o,0,c)}o!==-1&&(r.videoCodecs=r.videoCodecs.filter((c=>!(c.rtpMap&&c.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&c.fmtp&&c.fmtp.parameters["profile-level-id"]!=="42001f"))))}}return{send:n,recv:r,sendrecv:i}}function Ko(e,t,n,r,i,s){if(n==="videoExtensions"||n==="audioExtensions"){const o=[];return e[n].forEach((c=>{t[n].some(((l,h)=>{if(c.entry===l.entry&&c.extensionName===l.extensionName)return o.push(h),!0}))?s[n].push(c):r[n].push(c)})),void t[n].forEach(((c,l)=>{o.indexOf(l)===-1&&i[n].push(c)}))}if(n==="videoCodecs"||n==="audioCodecs"){const o=[];return e[n].forEach((c=>{t[n].some(((l,h)=>{if(c.payloadType===l.payloadType&&JSON.stringify(c)===JSON.stringify(l))return o.push(h),!0}))?s[n].push(c):r[n].push(c)})),void t[n].forEach(((c,l)=>{o.indexOf(l)===-1&&i[n].push(c)}))}}function lT(e){const{send:t,recv:n,sendrecv:r}=e;if(!r){if(!t||!n)throw new Error("cannot merge rtp capabilities because one of send or recv is empty!");return{send:t,recv:n}}let i,s;return t?(i={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},i.audioCodecs=[...t.audioCodecs,...r.audioCodecs],i.videoCodecs=[...t.videoCodecs,...r.videoCodecs],i.audioExtensions=[...t.audioExtensions,...r.audioExtensions],i.videoExtensions=[...t.videoExtensions,...r.videoExtensions]):i=r,n?(s={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},s.audioCodecs=[...n.audioCodecs,...r.audioCodecs],s.videoCodecs=[...n.videoCodecs,...r.videoCodecs],s.audioExtensions=[...n.audioExtensions,...r.audioExtensions],s.videoExtensions=[...n.videoExtensions,...r.videoExtensions]):s=r,{send:i,recv:s}}function zf(e){e.media.mediaType==="audio"&&e.attributes.payloads.filter((t=>{var n;return((n=t.rtpMap)===null||n===void 0?void 0:n.encodingName.toLowerCase())==="opus"})).forEach((t=>{t.fmtp||(t.fmtp={parameters:{}}),t.fmtp.parameters.stereo="1",t.fmtp.parameters["sprop-stereo"]="1"}))}function eg(e,t,n,r){let i=[];if(e===Le.VIDEO){if(F("H264_PROFILE_LEVEL_ID")&&r==="h264"&&(i=t.videoCodecs.filter((s=>{var o;return Re(o=s.rtpMap&&s.rtpMap.encodingName.toLowerCase()||"").call(o,r)&&s&&s.fmtp&&s.fmtp.parameters["profile-level-id"]===F("H264_PROFILE_LEVEL_ID")}))),!Array.isArray(i)||i.length===0){let s=[];const o=[],c=[],l=[];if(n.videoCodecs.forEach((h=>{const p=h.rtpMap&&h.rtpMap.encodingName.toLowerCase()||"";Re(p).call(p,r)?s.push(h):Re(p).call(p,"vp9")?o.push(h):Re(p).call(p,"vp8")?c.push(h):Re(p).call(p,"h264")&&l.push(h)})),s.length===0){let h="";o.length!==0?(s=o,h="vp9"):c.length!==0?(s=c,h="vp8"):l.length!==0&&(s=l,h="h264"),R.warning("codec ".concat(r," not included in rtpCapabilities, fallback to default payloads: ").concat(h))}s.length!==0&&(i=t.videoCodecs.filter((h=>s.some((p=>p.payloadType===h.payloadType)))))}if(i.length===0&&(R.warning("codec ".concat(r," not included in rtpCapabilities, fallback to default payloads: ").concat(t.videoCodecs[0].rtpMap&&t.videoCodecs[0].rtpMap.encodingName)),i=t.videoCodecs),F("USE_PUB_RTX")||F("USE_SUB_RTX")){const s=Ld(i,t.videoCodecs);i=[...i,...s]}}else{i=t.audioCodecs.filter((o=>{var c;return Re(c=o.rtpMap&&o.rtpMap.encodingName.toLowerCase()||"").call(c,r)}));const s=t.audioCodecs.filter((o=>{var c;return Re(c=o.rtpMap&&o.rtpMap.encodingName.toLowerCase()||"").call(c,"red")}));i.length===0&&(R.warning("codec ".concat(r," not included in rtpCapabilities, fallback to opus")),i=t.audioCodecs.filter((o=>{var c;return Re(c=o.rtpMap&&o.rtpMap.encodingName.toLowerCase()||"").call(c,"opus")}))),F("ENABLE_AUDIO_RED")&&s.length!==0&&(i=[...s,...i])}return i}function Ld(e,t){const n=e.map((r=>r.payloadType.toString()));return t.filter((r=>r.rtpMap&&r.rtpMap.encodingName==="rtx"&&r.fmtp&&r.fmtp.parameters.apt&&Re(n).call(n,r.fmtp&&r.fmtp.parameters.apt)))}async function xd(e,t,n){const r=t.toString(),i=i2(r,"offer","remote","exchangeSDP");await e.setRemoteDescription({type:"offer",sdp:r});const s=await e.createAnswer();if(!s.sdp)throw new Error("cannot get answer sdp");let o=s.sdp;o=r2(o,n||{}),i?.(o||""),await e.setLocalDescription({type:"answer",sdp:o})}function r2(e,t,n){const r=Zi(e),{useXR:i}=t;return r.mediaDescriptions.forEach((s=>{var o;s.attributes.mid&&(Array.isArray(n)&&!Re(n).call(n,s.attributes.mid)||(s.media.mediaType==="audio"&&zf(s),i&&Re(o=["audio","video"]).call(o,s.media.mediaType)&&s.attributes.payloads.forEach((c=>{c.rtcpFeedbacks.findIndex((l=>l.type==="rrtr"))===-1&&c.rtcpFeedbacks.push({type:"rrtr"})}))))})),Id(r)}function i2(e,t,n,r){if(F("SDP_LOGGING"))return R.upload("exchanging ".concat(n," ").concat(t," SDP during P2PConnection.").concat(r,`
`),e),t==="offer"?i=>{i2(i,"answer",n==="local"?"remote":"local",r)}:void 0}function s2(e){const t=F("COMPATIBLE_SDP_EXTENSION");return!!(Array.isArray(t)&&t.length>0)&&t.some((n=>Re(e).call(e,n)))}function o2(e,t){try{var n;return((n=e.fmtp)===null||n===void 0?void 0:n.parameters.apt)===t.payloadType.toString()}catch{return!1}}function a2(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable}))),n.push.apply(n,r)}return n}function Ms(e,t){return typeof F(e)===t?F(e):void 0}function _9(){try{const e=F("EXPERIMENTS")||{};return typeof e=="string"||Array.isArray(e)?{}:(function(t){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?a2(Object(r),!0).forEach((function(i){k(t,i,r[i])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):a2(Object(r)).forEach((function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(r,i))}))}return t})({},e)}catch(e){return R.debug("handle gateway attributes failed: ",e),{}}}const c2={};function Md(e){(!(arguments.length>1&&arguments[1]!==void 0)||arguments[1])&&R.debug("install service ".concat(e.name)),c2[e.name]=e}function yl(e){const t=c2[e];if(!t)throw new ce(U.INVALID_OPERATION,"".concat(e," not found, please use AgoraRTC.use(").concat(e,"Service) to load it first"));return t}function l2(e,t){return yl("DataStream").create(e,t)}function dT(){return yl("InterceptFrame").create()}function d2(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable}))),n.push.apply(n,r)}return n}function ri(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?d2(Object(n),!0).forEach((function(r){k(e,r,n[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):d2(Object(n)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))}))}return e}const Qb=new Map;class E9 extends Pn{get state(){return this._state}set state(t){if(t===this._state)return;const n=this._state;this._state=t,t==="DISCONNECTED"&&this._disconnectedReason?this.emit(Cr.CONNECTION_STATE_CHANGE,t,n,this._disconnectedReason):this.emit(Cr.CONNECTION_STATE_CHANGE,t,n)}get joinGatewayStartTime(){return this._joinGatewayStartTime}set joinGatewayStartTime(t){R.debug("[".concat(this.store.clientId,"] set joinGatewayStartTime at ").concat(t)),this._joinGatewayStartTime=t}constructor(t,n){var r,i,s;super(),k(this,"store",void 0),k(this,"joinInfo",void 0),k(this,"key",void 0),k(this,"ntpOffset",0),k(this,"signal",void 0),k(this,"role",void 0),k(this,"isPreallocation",void 0),k(this,"isPreSub",void 0),k(this,"inChannelInfo",{joinAt:null,duration:0}),k(this,"spec",void 0),k(this,"_state","DISCONNECTED"),k(this,"_statsCollector",void 0),k(this,"_disconnectedReason",void 0),k(this,"isSignalRecover",!1),k(this,"hasChangeBGPAddress",!1),k(this,"trafficStatsInterval",void 0),k(this,"networkQualityInterval",void 0),k(this,"_joinGatewayStartTime",0),k(this,"_signalTimeout",!1),k(this,"_clientRoleOptions",void 0),k(this,"_isProactiveJoin",!1),this.store=t,this.spec=n,this.signal=this.store.useP2P?(r={spec:ri(ri({},n),{},{retryConfig:n.websocketRetryConfig}),store:t},(i=(s=yl("P2PChannel")).createSubmodule)===null||i===void 0?void 0:i.call(s,r)):new f9(ri(ri({},n),{},{retryConfig:n.websocketRetryConfig}),t),this._statsCollector=n.statsCollector,this.role=n.role||"audience",this._clientRoleOptions=n.clientRoleOptions,this.handleSignalEvents()}async join(t,n,r){this.store.joinGatewayStart(),t.cloudProxyServer!=="disabled"&&(this.hasChangeBGPAddress=!0);const i=Date.now();let s=Qb.get(t.cname);if(s||(s=new Map,Qb.set(t.cname,s)),this._isProactiveJoin=!0,s.has(t.uid)){const h=new se(U.UID_CONFLICT);throw We.joinGateway(t.sid,{lts:i,succ:!1,ec:h.code,addr:null,uid:t.uid,cid:t.cid,firstSuccess:this._isProactiveJoin,isProxy:!!t.proxyServer,signalChannel:"0",preload:t.preload}),h}s.set(t.uid,!0),this.joinInfo=t,this.key=n;let o=0;this.joinGatewayStartTime=i;const c=t.proxyServer;try{R.debug("[".concat(this.store.clientId,"] use websocket join uid ").concat(o));const h=t.gatewayAddrs.map((p=>{let{address:E}=p;const[g,v]=E.split(":"),O={host:g,port:v};return t.proxyServer&&(O.proxy=t.proxyServer),O}));o=(await this.signal.init(h)).uid,R.debug("[".concat(this.store.clientId,"] websocket join uid ").concat(o," cost ").concat(Date.now()-this.joinGatewayStartTime))}catch(h){var l;throw R.error("[".concat(this.store.clientId,"] User join failed"),h.toString()),We.joinGateway(t.sid,{lts:i,succ:!1,ec:((l=h.data)===null||l===void 0?void 0:l.desc)||h.code,errorMsg:h.message,addr:this.signal.url,uid:t.uid,cid:t.cid,firstSuccess:this._isProactiveJoin,isProxy:!!c,signalChannel:"0",preload:t.preload}),s.delete(t.uid),this.signal.close(),h}return this.state="CONNECTED",this.inChannelInfo.joinAt=Date.now(),R.debug("[".concat(this.store.clientId,"] Connected to gateway server")),this.trafficStatsInterval=window.setInterval((()=>{this.updateTrafficStats().catch((h=>{R.warning("[".concat(this.store.clientId,"] get traffic stats error"),h.toString())}))}),3e3),this.networkQualityInterval=window.setInterval((()=>{navigator&&navigator.onLine!==void 0&&!navigator.onLine?this.emit(Cr.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6}):this._signalTimeout?this.emit(Cr.NETWORK_QUALITY,{downlinkNetworkQuality:5,uplinkNetworkQuality:5}):this.state==="CONNECTED"&&this._statsCollector.trafficStats?this.emit(Cr.NETWORK_QUALITY,{uplinkNetworkQuality:HM(this._statsCollector.trafficStats.B_unq),downlinkNetworkQuality:HM(this._statsCollector.trafficStats.B_dnq)}):this.emit(Cr.NETWORK_QUALITY,{uplinkNetworkQuality:0,downlinkNetworkQuality:0})}),2e3),this.store.joinGatewayEnd(),o}async leave(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0],n=arguments.length>1?arguments[1]:void 0;if(this.state!=="DISCONNECTED"){n!==Qt.FALLBACK&&(this.state="DISCONNECTING");try{t||this.signal.connectionState!==_n.CONNECTED||await(function(r,i){return i===1/0?r:Pe.race([r,Wz(i)])})(this.signal.request(st.LEAVE,void 0,!0),3e3)}catch(r){R.warning("[".concat(this.store.clientId,"] leave request failed, ignore"),r)}this.signal.close(n),n!==Qt.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}}async publish(t,n,r){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new se(U.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const i={state:"offer",p2p_id:this.store.p2pId,ortc:n,mode:this.spec.mode,extend:F("PUB_EXTEND"),twcc:!!F("PUBLISH_TWCC"),rtx:!!F("USE_PUB_RTX")};try{return(await this.signal.request(st.PUBLISH,i,!0))._message}catch(s){if(r&&s.data&&s.data.code===Ze.ERR_PUBLISH_REQUEST_INVALID)return R.warning("[".concat(this.store.clientId,"] receive publish error code, retry"),s.toString()),await this.tryUnpubBeforeRepub(t,n),this.publish(t,n,!1);throw s}}async publishDataChannel(t,n,r){var i;if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new se(U.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const s={stream_id:n.streamId,ordered:n.ordered?1:0,max_retrans_times:(i=n.maxRetransmits)!==null&&i!==void 0?i:10,channel_id:n.channelId,metadata:n.metadata};try{await this.signal.request(st.PUBLISH_DATASTREAM,s,!0)}catch(o){if(r&&o.data&&o.data.code===Ze.ERR_PUBLISH_REQUEST_INVALID)return R.warning("[".concat(this.store.clientId,"] receive publish datachannels error code, retry"),o.toString()),await this.tryUnpubDataChannelBeforeRepub(t,n),this.publishDataChannel(t,n,!1);throw o}}async unpublish(t,n){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new se(U.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await this.signal.request(st.UNPUBLISH,{stream_id:n,ortc:t},!0)}catch(r){R.warning("[".concat(this.store.clientId,"] unpublish warning: "),r)}}async unpublishDataChannel(t){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new se(U.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await Pe.all(t.map((n=>this.signal.request(st.UNPUBLISH_DATASTREAM,{channel_id:n},!0))))}catch(n){R.warning("unpublish datachannels warning: ",n)}}async presubscribe(t,n,r){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new se(U.INVALID_OPERATION,"can not presubscribe when connection state is ".concat(this.state));const i={stream_id:t,stream_type:n,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!F("SUBSCRIBE_TWCC"),rtx:!!F("USE_SUB_RTX")||void 0,extend:F("SUB_EXTEND"),svc:Array.isArray(F("SVC"))&&F("SVC").length!==0?F("SVC"):void 0};try{return await this.signal.request(st.PRE_SUBSCRIBE,i,!0)}catch(s){if(r&&s.data&&s.data.code===Ze.ERR_SUBSCRIBE_REQUEST_INVALID)return R.warning("[".concat(this.store.clientId,"] pre-subscribe error, retry"),s.toString()),this.presubscribe(t,n,!1);throw s}}async subscribe(t,n,r){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new se(U.INVALID_OPERATION,"can not subscribe when connection state is ".concat(this.state));const i={stream_id:t,stream_type:n.stream_type,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!F("SUBSCRIBE_TWCC"),rtx:!!F("USE_SUB_RTX"),extend:F("SUB_EXTEND"),ssrcId:n.ssrcId,svc:Array.isArray(F("SVC"))&&F("SVC").length!==0?F("SVC"):void 0};try{return(await this.signal.request(st.SUBSCRIBE,i,!0))._message}catch(s){if(r&&s.data&&s.data.code===Ze.ERR_SUBSCRIBE_REQUEST_INVALID)return R.warning("[".concat(this.store.clientId,"] receiver subscribe error code, retry"),s.toString()),await this.tryUnsubBeforeResub(t,n),await this.subscribe(t,n,!1);throw s}}async subscribeDataChannel(t,n,r){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new se(U.INVALID_OPERATION,"can not subscribe datachannel when connection state is ".concat(this.state));const i={uid:t,stream_id:n.id,channel_id:n.datachannelId};try{return void await this.signal.request(st.SUBSCRIBE_DATASTREAM,i,!0)}catch(s){if(r&&s.data&&s.data.code===Ze.ERR_SUBSCRIBE_REQUEST_INVALID)return R.warning("[".concat(this.store.clientId,"] receiver subscribe datachannel error code, retry"),s.toString()),await this.tryUnsubDataChannelBeforeResub(t,n),await this.subscribeDataChannel(t,n,!1);throw s}}async subscribeAll(t,n){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new se(U.INVALID_OPERATION,"can not massSubscribe when connection state is ".concat(this.state));const r={p2p_id:this.store.p2pId,users:t,dtx:!1,rtx:!!F("USE_SUB_RTX"),twcc:!!F("SUBSCRIBE_TWCC"),svc:Array.isArray(F("SVC"))&&F("SVC").length!==0?F("SVC"):void 0};try{return await this.signal.request(st.SUBSCRIBE_STREAMS,r,!0)}catch(i){if(n&&i.data&&i.data.code===Ze.ERR_SUBSCRIBE_REQUEST_INVALID)return R.warning("[".concat(this.store.clientId,"] receiver massSubscribe error code, retry"),i.toString()),await this.tryMassUnsubBeforeResub(t),await this.subscribeAll(t,!1);throw i}}async setVideoProfile(t){const n=(function(r){if(!(r.bitrateMax&&r.bitrateMin&&r.frameRate&&r.height&&r.width))return;let i=r.frameRate,s=r.width,o=r.height,c=!0;return typeof i!="number"&&(i=i.exact||i.ideal||i.max||i.min||0,i||(c=!1)),typeof s!="number"&&(s=s.exact||s.ideal||s.max||s.min||0,s||(c=!1)),typeof o!="number"&&(o=o.exact||o.ideal||o.max||o.min||0,i||(c=!1)),c?{stream_type:0,width:s,height:o,fps:i,start_bps:1e3*r.bitrateMax,min_bps:1e3*r.bitrateMin,target_bps:1e3*r.bitrateMax}:void 0})(t);if(n)return this.signal.request(st.SET_VIDEO_PROFILE,n);R.debug("[".concat(this.store.clientId,"] encoder config is not complete, do not report to gateway"))}async unsubscribe(t,n){try{await this.signal.request(st.UNSUBSCRIBE,{p2p_id:this.store.p2pId,ortc:t,stream_id:n},!0)}catch(r){R.warning("[".concat(this.store.clientId,"] unsubscribe warning: "),r)}}async unsubscribeDataChannel(t,n){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new se(U.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await Pe.all(t.map((r=>this.signal.request(st.UNSUBSCRIBE_DATASTREAM,{stream_id:r,uid:n},!0))))}catch(r){R.warning("unsubscribeDataChannel warning: ",r)}}async massUnsubscribe(t){try{await this.signal.request(st.UNSUBSCRIBE_STREAMS,t,!0)}catch(n){R.warning("[".concat(this.store.clientId,"] massUnsubscribeAll warning: "),n)}}async reconnectPC(t){const{iceParameters:n,dtlsParameters:r,rtpCapabilities:i}=t;return{gatewayEstablishParams:await this.signal.request(st.CONNECT_PC,{p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:{iceParameters:n,dtlsParameters:r,rtpCapabilities:i}},!0),gatewayAddress:this.getCurrentGatewayAddress()}}getGatewayInfo(){return this.signal.request(st.GATEWAY_INFO)}async renewToken(t){await this.signal.request(st.RENEW_TOKEN,t),this.key=t.token}updateClientRole(t,n){n&&(this._clientRoleOptions=Object.assign({},n)),F("CLIENT_ROLE_OPTIONS")&&(R.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(F("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," ")),this._clientRoleOptions=Object.assign({},F("CLIENT_ROLE_OPTIONS"))),this.role=t}async setClientRole(t,n){if(n&&(this._clientRoleOptions=Object.assign({},n)),F("CLIENT_ROLE_OPTIONS")&&(this._clientRoleOptions=Object.assign({},F("CLIENT_ROLE_OPTIONS")),R.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(F("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," "))),this.state!=="CONNECTED")return void(this.role=t);let r,i=0;t==="audience"?this._clientRoleOptions&&this._clientRoleOptions.delay?(r=this._clientRoleOptions.delay,i=1):i=this._clientRoleOptions&&this._clientRoleOptions.level?this._clientRoleOptions.level:2:i=0;const s=Object.assign({},n);delete s.delay,delete s.level,await this.signal.request(st.SET_CLIENT_ROLE,ri(ri({role:t,level:i,delay:r},s),{},{client_ts:Date.now()})),this.role=t}async setRemoteVideoStreamType(t,n){await this.signal.request(st.SWITCH_VIDEO_STREAM,{stream_id:t,stream_type:n})}async setDefaultRemoteVideoStreamType(t){await this.signal.request(st.DEFAULT_VIDEO_STREAM,{stream_type:t})}async setStreamFallbackOption(t,n){await this.signal.request(st.SET_FALLBACK_OPTION,{stream_id:t,fallback_type:n})}async pickSVCLayer(t,n){await this.signal.request(st.PICK_SVC_LAYER,{stream_id:t,spatial_layer:n.spatialLayer,temporal_layer:n.temporalLayer})}async setRTM2Flag(t){await this.signal.request(st.SET_RTM2_FLAG,{rtm2_flag:t})}async sendExtensionMessage(t,n,r){if(this.store.useP2P)return this.signal.sendExtensionMessage(t,n,r)}getInChannelInfo(){return this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt),ri({},this.inChannelInfo)}async getGatewayVersion(){return(await this.signal.request(st.GATEWAY_INFO)).version}reset(){if(this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt,this.inChannelInfo.joinAt=null),this.trafficStatsInterval&&(window.clearInterval(this.trafficStatsInterval),this.trafficStatsInterval=void 0),this.joinInfo){const t=Qb.get(this.joinInfo.cname);t&&t.delete(this.joinInfo.uid)}this.joinInfo=void 0,this.key=void 0,this.networkQualityInterval&&(window.clearInterval(this.networkQualityInterval),this.networkQualityInterval=void 0)}updateTurnConfigFromSignal(){if(!this.joinInfo)return;const t=(function(n){let r;return r=n.startsWith("dc")?n.match(/(dc\:\/\/)?([^:]+):(\d+)/):n.match(/(wss\:\/\/)?([^:]+):(\d+)/),r?{username:Br.username,password:Br.password,turnServerURL:r[2],tcpport:parseInt(r[3])+30,udpport:parseInt(r[3])+30,forceturn:!1}:null})((this.joinInfo.cloudProxyServer==="disabled"?this.signal.url:this.joinInfo.gatewayAddrs[this.signal.currentURLIndex].address)||"");this.joinInfo.turnServer.serversFromGateway=[],t&&this.joinInfo.turnServer.mode!=="off"&&this.joinInfo.cloudProxyServer==="disabled"&&this.joinInfo.turnServer.serversFromGateway.push(ri(ri({},Br),{},{turnServerURL:t.turnServerURL,tcpport:t.tcpport,udpport:t.udpport,username:this.joinInfo.uid.toString(),password:this.joinInfo.token}))}async updateTrafficStats(){if(this.state!=="CONNECTED")return;const t=await this.signal.request(st.TRAFFIC_STATS,void 0,!0);t.timestamp=Date.now(),t.ntp_offset!=null&&(this.ntpOffset=t.ntp_offset),t.peer_delay.forEach((n=>{const r=this._statsCollector.trafficStats&&this._statsCollector.trafficStats.peer_delay.find((i=>i.peer_uid===n.peer_uid));r&&r.B_st!==n.B_st&&NS((()=>{this.emit(Cr.STREAM_TYPE_CHANGE,n.peer_uid,n.B_st)}))})),this._statsCollector.updateTrafficStats(t)}getJoinMessage(t){var n,r;if(!this.joinInfo||!this.key)throw new se(U.UNEXPECTED_ERROR,"can not generate join message, no join info");const i=Object.assign({},this.joinInfo.apResponse);let s=F("REPORT_APP_SCENARIO");if(typeof s!="string")try{s=JSON.stringify(s)}catch{s=void 0}var o;s&&s.length>128&&(s=void 0),this.store.hasStartJoinChannel=!0,this.store.isABTestSuccess||this.emit(Cr.UPDATE_GATEWAY_CONFIG),o=this.store.clientId,Re(jf).call(jf,o)||jf.push(o);const c=hb(this.store),l=!((n=this.isPreallocation)===null||n===void 0||!n.call(this)),h=pL(this.store),p=_9(),E=yf(87)||T1()||F0(117),g=((function(){const O=xt();if(O.name!==Gt.SAFARI||!O.browserVersion)return!1;const I=O.browserVersion.split(".");return Number(I[0])>18||Number(I[0])===18&&Number(I[1])>=4})()||b1(18,4,!1))&&B0(18,6,!0)&&this.spec.codec==="h264"&&F("ENABLE_ABSSENDTIME_AS_SENTTS"),v=ri({license:this.joinInfo.license,p2p_id:this.store.p2pId,session_id:this.joinInfo.sid,app_id:this.joinInfo.appId,channel_key:this.key,channel_name:this.joinInfo.cname,sdk_version:to,browser:navigator.userAgent,process_id:F("PROCESS_ID"),mode:this.store.useP2P?"p2p":this.spec.mode,codec:this.spec.codec,role:this.role,has_changed_gateway:this.hasChangeBGPAddress,ap_response:i,extend:F("JOIN_EXTEND"),details:{6:this.joinInfo.stringUid,cservice_map:this.joinInfo.cloudProxyServer==="proxy3"?"1":this.joinInfo.cloudProxyServer==="proxy5"?"2":void 0},features:{rejoin:!0},optionalInfo:this.joinInfo.optionalInfo,appScenario:s,attributes:{userAttributes:ri(ri({enableEncodedTransform:(!!F("ENABLE_AUDIO_METADATA")||!!F("ENABLE_AUDIO_PTS"))&&E||!!F("ENABLE_AUDIO_TOPN")&&V0(Gt.CHROME,87,116)||void 0,enableAudioMetadata:!!F("ENABLE_AUDIO_METADATA")&&E,enableAudioPts:!!F("ENABLE_AUDIO_PTS")&&E,topnSmoothLevel:F("TOPN_SMOOTH_LEVEL"),topnNewSpeakerDelay:F("TOPN_NEW_SPEAKER_DELAY"),topnSwitchHoldMs:F("TOPN_SWITCH_HOLD_MS"),topnAudioGain:F("TOPN_AUDIO_GAIN"),enablePublishedUserList:F("ENABLE_PUBLISHED_USER_LIST"),maxSubscription:F("MAX_SUBSCRIPTION"),subscribeAudioFilterTopN:Ms("SUBSCRIBE_AUDIO_FILTER_TOPN","number"),enablePublishAudioFilter:Ms("ENABLE_PUBLISH_AUDIO_FILTER","boolean"),enableUserLicenseCheck:Ms("ENABLE_USER_LICENSE_CHECK","boolean"),enableRTX:F("USE_PUB_RTX")===!0||F("USE_SUB_RTX")===!0||void 0,disableFEC:F("DISABLE_FEC"),enableNTPReport:!!F("ENABLE_NTP_REPORT")||void 0,enableInstantVideo:h,enableFulllinkAvSync:!!F("ENABLE_FULL_LINK_AV_SYNC")||void 0,enableDataStream2:Ms("ENABLE_DATASTREAM_2","boolean"),enableAutFeedback:!!F("FORCE_ENABLE_AUT_CC")||!MS()&&(!!F("ENABLE_AUT_FEEDBACK")||void 0),rtm2Flag:typeof this.joinInfo.rtmFlag=="number"?this.joinInfo.rtmFlag:void 0,enableUserAutoRebalanceCheck:!!F("ENABLE_USER_AUTO_REBALANCE_CHECK"),enableXR:Ms("USE_XR","boolean"),enableLossbasedBwe:Ms("ENABLE_LOSSBASED_BWE","boolean"),enableAutCC:!!F("FORCE_ENABLE_AUT_CC")||!MS()&&(!!F("ENABLE_AUT_CC")||void 0),enableCCFallback:Ms("ENABLE_CC_FALLBACK","boolean"),enablePreallocPC:l,preSubNum:c?Ms("PRE_SUB_NUM","number"):void 0,enablePubTWCC:Ms("PUBLISH_TWCC","boolean"),enableSubTWCC:Ms("SUBSCRIBE_TWCC","boolean"),enablePubRTX:Ms("USE_PUB_RTX","boolean"),enableSubRTX:Ms("USE_SUB_RTX","boolean"),enableSubSVC:F("ENABLE_SVC")?F("ENABLE_SVC_DEFAULT_CODECS"):Array.isArray(F("SVC"))&&F("SVC").length!==0?F("SVC"):void 0,enableSvcExtended:F("ENABLE_SVC")&&Array.isArray(F("SVC_EXTENDED"))&&F("SVC_EXTENDED").length!==0?F("SVC_EXTENDED"):void 0},p),{},{audioDuplicate:Ms("ENABLE_AUDIO_RED","boolean")?(r=Ms("AUDIO_DUPLICATE_NUM","number"))!==null&&r!==void 0?r:2:void 0,senttsUsesAbsSendTime:!!g||void 0})},join_ts:this.joinGatewayStartTime},t);return this.joinInfo.stringUid&&(v.string_uid=this.joinInfo.stringUid),this.joinInfo.aesmode&&this.joinInfo.aespassword&&(v.aes_mode=this.joinInfo.aesmode,F("ENCRYPT_AES")?(v.aes_secret=this.joinInfo.aespassword,v.aes_encrypt=!0):v.aes_secret=this.joinInfo.aespassword,this.joinInfo.aessalt&&(v.aes_salt=this.joinInfo.aessalt)),i.addresses[this.signal.websocket.currentURLIndex]&&(v.ap_response.ticket=i.addresses[this.signal.websocket.currentURLIndex].ticket,delete i.addresses),this.joinInfo.defaultVideoStream!==void 0&&(v.default_video_stream=this.joinInfo.defaultVideoStream),v}getRejoinMessage(){if(!this.joinInfo)throw new se(U.UNEXPECTED_ERROR,"can not generate rejoin message, no join info");return{session_id:this.joinInfo.sid,channel_name:this.joinInfo.cname,cid:this.joinInfo.cid,uid:this.joinInfo.uid,vid:Number(this.joinInfo.vid)}}handleSignalEvents(){this.signal.on(at.WS_RECONNECT_CREATE_CONNECTION,(t=>{this.joinGatewayStartTime=Date.now()})),this.signal.on(at.WS_RECONNECTING,(t=>{this.joinInfo&&We.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:t||jr.NETWORK_ERROR}),this.joinInfo&&(this.state="RECONNECTING",We.sessionInit(this.joinInfo.sid,{lts:new Date().getTime(),extend:this.isSignalRecover?{recover:!0}:{rejoin:!0},cname:this.joinInfo.cname,appid:this.joinInfo.appId,mode:this.spec.mode,stringUid:this.joinInfo.stringUid,channelProfile:this.spec.mode==="live"?1:0,channelMode:0,lsid:this.joinInfo.sid,clientRole:this.role==="audience"?2:1,buildFormat:1}),this.isSignalRecover=!1,this.joinGatewayStartTime=Date.now())})),this.signal.on(at.WS_CLOSED,(t=>{let n;switch(t){case Qt.LEAVE:n=jr.LEAVE;break;case Qt.UID_BANNED:case Qt.IP_BANNED:case Qt.CHANNEL_BANNED:case Qt.SERVER_ERROR:n=jr.SERVER_ERROR;break;case Qt.FALLBACK:n=jr.FALLBACK;break;case Qt.LICENSE_MISSING:case Qt.LICENSE_EXPIRED:case Qt.LICENSE_MINUTES_EXCEEDED:case Qt.LICENSE_PERIOD_INVALID:case Qt.LICENSE_MULTIPLE_SDK_SERVICE:case Qt.LICENSE_ILLEGAL:case Qt.TOKEN_EXPIRE:n=t;break;default:n=jr.NETWORK_ERROR}R.debug("[".concat(this.store.clientId,"] [signal] websocket closed, reason: ").concat(n||"undefined -> "+jr.NETWORK_ERROR)),this.joinInfo&&We.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:t===Qt.LEAVE?1:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:n}),this._disconnectedReason=t,t!==Qt.FALLBACK&&(this.state="DISCONNECTED"),this.reset()})),this.signal.on(at.WS_CONNECTED,(()=>{if(this.updateTurnConfigFromSignal(),this.state="CONNECTED",this.joinInfo){if(this.role==="audience"){const t=F("CLIENT_ROLE_OPTIONS")||this._clientRoleOptions;t&&(t.level||t.delay)&&(R.debug("[".concat(this.store.clientId,"] patch to send set client role, role: ").concat(this.role,", mode: ").concat(this.spec.mode,", level: ").concat(t.level,", delay: ").concat(t.delay)),this.setClientRole(this.role,t))}if(We.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!0,ec:null,vid:this.joinInfo.vid,addr:this.signal.url,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload,isABTestSuccess:this.store.isABTestSuccess}),this._isProactiveJoin=!1,this.joinInfo.useLocalAccessPoint&&this.joinInfo.setLocalAPVersion===1){const t=this.signal.url&&this.signal.url.match(/wss\:\/\/([^:]+):(\d+)/);if(!t)return void R.error("[".concat(this.store.clientId,"] set local access point after joined failed: ").concat(t));nn("EVENT_REPORT_DOMAIN",t[1]),nn("EVENT_REPORT_BACKUP_DOMAIN",t[1]),nn("LOG_UPLOAD_SERVER","".concat(t[1],":6444"))}}})),this.signal.on(Pt.ON_UPLINK_STATS,(t=>{this._statsCollector.updateUplinkStats(t)})),this.signal.on(at.REQUEST_RECOVER,((t,n,r)=>{if(!this.joinInfo)return r(new se(U.UNEXPECTED_ERROR,"gateway: can not recover, no join info"));t&&(this.joinInfo.multiIP=t,this.hasChangeBGPAddress=!0),this.isSignalRecover=!0,Fr(this,Cr.REQUEST_NEW_GATEWAY_LIST).then(n).catch(r)})),this.signal.on(at.REQUEST_JOIN_INFO,(async(t,n,r)=>{var i,s,o;if(this.updateTurnConfigFromSignal(),this.store.useP2P)return void t(this.getJoinMessage({ortc:{}}));const c=An((i=this.joinInfo)===null||i===void 0?void 0:i.turnServer);if(F("NEW_TURN_MODE")&&c&&((s=this.joinInfo)===null||s===void 0?void 0:s.cloudProxyServer)==="disabled"){var l;let g=c.servers.map((I=>"turnServerURL"in I&&F("USE_TURN_IP")?ri(ri({},I),{},{turnServerURL:iT(I.turnServerURL)}):I)),v=(l=c.serversFromGateway)===null||l===void 0?void 0:l.map((I=>F("USE_TURN_IP")?ri(ri({},I),{},{turnServerURL:iT(I.turnServerURL)}):I));const O=this.signal.currentURLIndex;g.length>0&&(g=[g[O%g.length]],c.servers=g),Array.isArray(v)&&v.length>0&&(v=[v[0]],c.serversFromGateway=v),R.debug("[".concat(this.store.clientId,"] use single turn, use turn server index: ").concat(O))}const{iceParameters:h,dtlsParameters:p,rtpCapabilities:E}=await Fr(this,Cr.REQUEST_P2P_CONNECTION_PARAMS,{turnServer:c,cloudProxyServer:(o=this.joinInfo)===null||o===void 0?void 0:o.cloudProxyServer});try{t(this.getJoinMessage({ortc:{iceParameters:h,dtlsParameters:p,rtpCapabilities:E,version:"2"}}))}catch(g){n(g)}})),this.signal.on(at.REQUEST_REJOIN_INFO,(t=>{t(this.getRejoinMessage())})),this.signal.on(at.REPORT_JOIN_GATEWAY,((t,n)=>{if(!this.joinInfo)return;let r,i="";var s;t instanceof se?(r=((s=t.data)===null||s===void 0?void 0:s.desc)||t.code,i=t.message):r=t,We.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!1,ec:r,errorMsg:i,addr:n,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload})})),this.signal.on(at.IS_P2P_DISCONNECTED,(t=>{t(VE(this,Cr.IS_P2P_DISCONNECTED))})),this.signal.on(at.DISCONNECT_P2P,(()=>{this.emit(Cr.DISCONNECT_P2P)})),this.signal.on(at.REQUEST_SUCCESS,(()=>{this._signalTimeout=!1})),this.signal.on(at.REQUEST_TIMEOUT,(()=>{this._signalTimeout=!0})),this.signal.on(at.JOIN_RESPONSE,(t=>{const n=this.getCurrentGatewayAddress();this.emit(Cr.JOIN_RESPONSE,t,n)})),this.signal.on(at.PRE_CONNECT_PC,(async()=>{if(this.joinInfo){var t,n;this.updateTurnConfigFromSignal();const i=this.getCurrentGatewayAddress(),s=An((t=this.joinInfo)===null||t===void 0?void 0:t.turnServer);if(F("NEW_TURN_MODE")&&s&&((n=this.joinInfo)===null||n===void 0?void 0:n.cloudProxyServer)==="disabled"){var r;let c=s.servers.map((p=>"turnServerURL"in p&&F("USE_TURN_IP")?ri(ri({},p),{},{turnServerURL:iT(p.turnServerURL)}):p)),l=(r=s.serversFromGateway)===null||r===void 0?void 0:r.map((p=>F("USE_TURN_IP")?ri(ri({},p),{},{turnServerURL:iT(p.turnServerURL)}):p));const h=this.signal.currentURLIndex;c.length>0&&(c=[c[h%c.length]],s.servers=c),Array.isArray(l)&&l.length>0&&(l=[l[0]],s.serversFromGateway=l),R.debug("[".concat(this.store.clientId,"] use single turn, use turn server index: ").concat(h,",in pre pc"))}const o=F("FINGERPRINT")||this.joinInfo.apResponse.addresses[this.signal.currentURLIndex].fingerprint;if(i&&o){const c=ZM(i);this.emit(Cr.PRE_CONNECT_PC,{candidates:c,fingerprint:o,turnServer:s})}}})),this.signal.on(at.RECOVER_NOTIFICATION,(t=>{this.joinInfo&&typeof F("AP_REQUEST_DETAIL")=="string"&&(this.joinInfo.apRequestDetail="".concat(F("AP_REQUEST_DETAIL"),";").concat(t))}))}async tryUnsubBeforeResub(t,n){try{await this.signal.request(st.UNSUBSCRIBE,{p2p_id:this.store.p2pId,stream_id:t,ortc:[n]},!0)}catch(r){throw R.warning("[".concat(this.store.clientId,"] tryUnsubBeforeResub warning"),r),r}}async tryUnsubDataChannelBeforeResub(t,n){try{await this.signal.request(st.UNSUBSCRIBE,{stream_id:n.id},!0)}catch(r){throw R.warning("unsubscribe datachannel warning",r),r}}async tryUnpubBeforeRepub(t,n){try{await this.signal.request(st.UNPUBLISH,{stream_id:t,ortc:n},!0)}catch(r){throw R.warning("[".concat(this.store.clientId,"] tryUnpubBeforeRepub warning: "),r),r}}async tryUnpubDataChannelBeforeRepub(t,n){try{await this.signal.request(st.UNPUBLISH_DATASTREAM,{channnel_id:n.channelId},!0)}catch(r){throw R.warning("unpublish datastream warning: ",r),r}}async tryMassUnsubBeforeResub(t){const n={users:t.map((r=>({stream_id:r.stream_id,stream_type:r.stream_type})))};try{await this.signal.request(st.UNSUBSCRIBE_STREAMS,n,!0)}catch(r){throw R.warning("[".concat(this.store.clientId,"] tryMassUnsubBeforeResub warning"),r),r}}async muteLocal(t,n){const r={action:t.find((i=>i.stream_type===en.Audio))?"mute_local_audio":"mute_local_video",p2p_id:this.store.p2pId,ortc:t,stream_id:n};try{await this.signal.request(st.CONTROL,r,!0,!0)}catch(i){throw R.warning("[".concat(this.store.clientId,"] gateway muteLocal warning: "),i),i}}async unmuteLocal(t,n){const r={action:t.find((i=>i.stream_type===en.Audio))?"unmute_local_audio":"unmute_local_video",p2p_id:this.store.p2pId,ortc:t,stream_id:n};try{await this.signal.request(st.CONTROL,r,!0,!0)}catch(i){throw R.warning("[".concat(this.store.clientId,"] gateway unmuteLocal warning: "),i),i}}async muteRemote(t,n){const r={action:t===Le.AUDIO?"mute_remote_audio":"mute_remote_video",p2p_id:this.store.p2pId,stream_id:n};try{await this.signal.request(st.CONTROL,r,!0,!0)}catch(i){throw R.warning("[".concat(this.store.clientId,"] gateway muteRemote warning: "),i),i}}async unmuteRemote(t,n){const r={action:t===Le.AUDIO?"unmute_remote_audio":"unmute_remote_video",p2p_id:this.store.p2pId,stream_id:n};try{await this.signal.request(st.CONTROL,r,!0,!0)}catch(i){throw R.warning("[".concat(this.store.clientId,"] gateway unmuteRemote warning: "),i),i}}uploadWRTCStats(t){this.signal.uploadWRTCStats(t)}upload(t,n){this.signal.upload(t,n)}getSignalRTT(){return this.signal.rtt}async restartICE(t){const n={p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:t};try{return await this.signal.request(st.RESTART_ICE,n,!0)}catch(r){throw R.warning("[".concat(this.store.clientId,"] P2PChannel.restartICE warning: "),r),r}}reconnect(t,n){this.state==="CONNECTED"&&this.signal.reconnect(t||void 0,n||jr.P2P_FAILED)}getCurrentGatewayAddress(){var t,n;if(!F("GATEWAY_WSS_ADDRESS"))return F("USE_CANDIDATE_FROM_AP_DETAIL")&&(t=this.joinInfo)!==null&&t!==void 0&&t.apGatewayAddress?(R.debug("[".concat(this.store.clientId,"] use candidate from ap detail, ").concat(JSON.stringify(this.joinInfo.apGatewayAddress))),this.joinInfo.apGatewayAddress):(n=this.joinInfo)!==null&&n!==void 0&&n.gatewayAddrs?this.joinInfo.gatewayAddrs[this.signal.currentURLIndex]:void 0}async setPublishAudioFilterEnabled(t){await this.signal.request(st.SET_PARAMETER,{enablePublishAudioFilter:t})}downgradeCodec(t){this.signal.downgradeCodec(t)}}let uT=0,Zb=0;function Ia(e,t,n,r){return new Pe(((i,s)=>{t.timeout=t.timeout||F("HTTP_CONNECT_TIMEOUT"),t.responseType=t.responseType||"json",t.data&&!n?(t.data=JSON.stringify(t.data),uT+=Sc(t.data)):n&&(t.data.size?uT+=t.data.size:t.data instanceof FormData?uT+=W1(t.data):uT+=Sc(JSON.stringify(t.data))),t.headers=t.headers||{},t.headers["Content-Type"]=t.headers["Content-Type"]||"application/json",t.method="POST",t.url=e,Mi.request(t).then((o=>{typeof o.data=="string"?Zb+=Sc(o.data):o.data instanceof ArrayBuffer||o.data instanceof Uint8Array?Zb+=o.data.byteLength:Zb+=Sc(JSON.stringify(o.data)),r&&i({data:o.data,headers:o.headers}),i(o.data)})).catch((o=>{Mi.isCancel(o)?s(new se(U.OPERATION_ABORTED,"cancel token canceled")):o.code==="ECONNABORTED"?s(new se(U.NETWORK_TIMEOUT,o.message)):o.response?s(new se(U.NETWORK_RESPONSE_ERROR,o.response.status)):s(new se(U.NETWORK_ERROR,o.message))}))}))}/*! formdata-polyfill. MIT License. Jimmy W?rting <https://jimmy.warting.se/opensource> */(function(){var e;function t(fe){var we=0;return function(){return we<fe.length?{done:!1,value:fe[we++]}:{done:!0}}}var n=typeof Object.defineProperties=="function"?Object.defineProperty:function(fe,we,Me){return fe==Array.prototype||fe==Object.prototype||(fe[we]=Me.value),fe},r,i=(function(fe){fe=[typeof globalThis=="object"&&globalThis,fe,typeof window=="object"&&window,typeof self=="object"&&self,typeof y=="object"&&y];for(var we=0;we<fe.length;++we){var Me=fe[we];if(Me&&Me.Math==Math)return Me}throw Error("Cannot find global object")})(this);function s(fe,we){if(we)e:{var Me=i;fe=fe.split(".");for(var _e=0;_e<fe.length-1;_e++){var w=fe[_e];if(!(w in Me))break e;Me=Me[w]}(we=we(_e=Me[fe=fe[fe.length-1]]))!=_e&&we!=null&&n(Me,fe,{configurable:!0,writable:!0,value:we})}}function o(fe){return(fe={next:fe})[Symbol.iterator]=function(){return this},fe}function c(fe){var we=typeof Symbol<"u"&&Symbol.iterator&&fe[Symbol.iterator];return we?we.call(fe):{next:t(fe)}}if(s("Symbol",(function(fe){function we(w,H){this.A=w,n(this,"description",{configurable:!0,writable:!0,value:H})}if(fe)return fe;we.prototype.toString=function(){return this.A};var Me="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",_e=0;return function w(H){if(this instanceof w)throw new TypeError("Symbol is not a constructor");return new we(Me+(H||"")+"_"+_e++,H)}})),s("Symbol.iterator",(function(fe){if(fe)return fe;fe=Symbol("Symbol.iterator");for(var we="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),Me=0;Me<we.length;Me++){var _e=i[we[Me]];typeof _e=="function"&&typeof _e.prototype[fe]!="function"&&n(_e.prototype,fe,{configurable:!0,writable:!0,value:function(){return o(t(this))}})}return fe})),typeof Object.setPrototypeOf=="function")r=Object.setPrototypeOf;else{var l;e:{var h={};try{h.__proto__={a:!0},l=h.a;break e}catch{}l=!1}r=l?function(fe,we){if(fe.__proto__=we,fe.__proto__!==we)throw new TypeError(fe+" is not extensible");return fe}:null}var p=r;function E(){this.m=!1,this.j=null,this.v=void 0,this.h=1,this.u=this.C=0,this.l=null}function g(fe){if(fe.m)throw new TypeError("Generator is already running");fe.m=!0}function v(fe,we){return fe.h=3,{value:we}}function O(fe){this.g=new E,this.G=fe}function I(fe,we,Me,_e){try{var w=we.call(fe.g.j,Me);if(!(w instanceof Object))throw new TypeError("Iterator result "+w+" is not an object");if(!w.done)return fe.g.m=!1,w;var H=w.value}catch(J){return fe.g.j=null,fe.g.s(J),N(fe)}return fe.g.j=null,_e.call(fe.g,H),N(fe)}function N(fe){for(;fe.g.h;)try{var we=fe.G(fe.g);if(we)return fe.g.m=!1,{value:we.value,done:!1}}catch(Me){fe.g.v=void 0,fe.g.s(Me)}if(fe.g.m=!1,fe.g.l){if(we=fe.g.l,fe.g.l=null,we.F)throw we.D;return{value:we.return,done:!0}}return{value:void 0,done:!0}}function M(fe){this.next=function(we){return fe.o(we)},this.throw=function(we){return fe.s(we)},this.return=function(we){return(function(Me,_e){g(Me.g);var w=Me.g.j;return w?I(Me,"return"in w?w.return:function(H){return{value:H,done:!0}},_e,Me.g.return):(Me.g.return(_e),N(Me))})(fe,we)},this[Symbol.iterator]=function(){return this}}function x(fe,we){return we=new M(new O(we)),p&&fe.prototype&&p(we,fe.prototype),we}if(E.prototype.o=function(fe){this.v=fe},E.prototype.s=function(fe){this.l={D:fe,F:!0},this.h=this.C||this.u},E.prototype.return=function(fe){this.l={return:fe},this.h=this.u},O.prototype.o=function(fe){return g(this.g),this.g.j?I(this,this.g.j.next,fe,this.g.o):(this.g.o(fe),N(this))},O.prototype.s=function(fe){return g(this.g),this.g.j?I(this,this.g.j.throw,fe,this.g.o):(this.g.s(fe),N(this))},s("Array.prototype.entries",(function(fe){return fe||function(){return(function(we,Me){we instanceof String&&(we+="");var _e=0,w=!1,H={next:function(){if(!w&&_e<we.length){var J=_e++;return{value:Me(J,we[J]),done:!1}}return w=!0,{done:!0,value:void 0}}};return H[Symbol.iterator]=function(){return H},H})(this,(function(we,Me){return[we,Me]}))}})),typeof Blob<"u"&&(typeof FormData>"u"||!FormData.prototype.keys)){var B=function(fe,we){for(var Me=0;Me<fe.length;Me++)we(fe[Me])},Z=function(fe){return fe.replace(/\r?\n|\r/g,`\r
`)},Q=function(fe,we,Me){return we instanceof Blob?(Me=Me!==void 0?Me+"":typeof we.name=="string"?we.name:"blob",we.name===Me&&Object.prototype.toString.call(we)!=="[object Blob]"||(we=new File([we],Me)),[String(fe),we]):[String(fe),String(we)]},z=function(fe,we){if(fe.length<we)throw new TypeError(we+" argument required, but only "+fe.length+" present.")},te=typeof globalThis=="object"?globalThis:typeof window=="object"?window:typeof self=="object"?self:this,de=te.FormData,me=te.XMLHttpRequest&&te.XMLHttpRequest.prototype.send,ve=te.Request&&te.fetch,St=te.navigator&&te.navigator.sendBeacon,wt=te.Element&&te.Element.prototype,ot=te.Symbol&&Symbol.toStringTag;ot&&(Blob.prototype[ot]||(Blob.prototype[ot]="Blob"),"File"in te&&!File.prototype[ot]&&(File.prototype[ot]="File"));try{new File([],"")}catch{te.File=function(we,Me,_e){return we=new Blob(we,_e||{}),Object.defineProperties(we,{name:{value:Me},lastModified:{value:+(_e&&_e.lastModified!==void 0?new Date(_e.lastModified):new Date)},toString:{value:function(){return"[object File]"}}}),ot&&Object.defineProperty(we,ot,{value:"File"}),we}}var Xt=function(fe){return fe.replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22")},zt=function(fe){this.i=[];var we=this;fe&&B(fe.elements,(function(Me){if(Me.name&&!Me.disabled&&Me.type!=="submit"&&Me.type!=="button"&&!Me.matches("form fieldset[disabled] *"))if(Me.type==="file"){var _e=Me.files&&Me.files.length?Me.files:[new File([],"",{type:"application/octet-stream"})];B(_e,(function(w){we.append(Me.name,w)}))}else Me.type==="select-multiple"||Me.type==="select-one"?B(Me.options,(function(w){!w.disabled&&w.selected&&we.append(Me.name,w.value)})):Me.type==="checkbox"||Me.type==="radio"?Me.checked&&we.append(Me.name,Me.value):(_e=Me.type==="textarea"?Z(Me.value):Me.value,we.append(Me.name,_e))}))};if((e=zt.prototype).append=function(fe,we,Me){z(arguments,2),this.i.push(Q(fe,we,Me))},e.delete=function(fe){z(arguments,1);var we=[];fe=String(fe),B(this.i,(function(Me){Me[0]!==fe&&we.push(Me)})),this.i=we},e.entries=function fe(){var we,Me=this;return x(fe,(function(_e){if(_e.h==1&&(we=0),_e.h!=3)return we<Me.i.length?_e=v(_e,Me.i[we]):(_e.h=0,_e=void 0),_e;we++,_e.h=2}))},e.forEach=function(fe,we){z(arguments,1);for(var Me=c(this),_e=Me.next();!_e.done;_e=Me.next()){var w=c(_e.value);_e=w.next().value,w=w.next().value,fe.call(we,w,_e,this)}},e.get=function(fe){z(arguments,1);var we=this.i;fe=String(fe);for(var Me=0;Me<we.length;Me++)if(we[Me][0]===fe)return we[Me][1];return null},e.getAll=function(fe){z(arguments,1);var we=[];return fe=String(fe),B(this.i,(function(Me){Me[0]===fe&&we.push(Me[1])})),we},e.has=function(fe){z(arguments,1),fe=String(fe);for(var we=0;we<this.i.length;we++)if(this.i[we][0]===fe)return!0;return!1},e.keys=function fe(){var we,Me,_e,w,H=this;return x(fe,(function(J){if(J.h==1&&(we=c(H),Me=we.next()),J.h!=3)return Me.done?void(J.h=0):(_e=Me.value,w=c(_e),v(J,w.next().value));Me=we.next(),J.h=2}))},e.set=function(fe,we,Me){z(arguments,2),fe=String(fe);var _e=[],w=Q(fe,we,Me),H=!0;B(this.i,(function(J){J[0]===fe?H&&(H=!_e.push(w)):_e.push(J)})),H&&_e.push(w),this.i=_e},e.values=function fe(){var we,Me,_e,w,H=this;return x(fe,(function(J){if(J.h==1&&(we=c(H),Me=we.next()),J.h!=3)return Me.done?void(J.h=0):(_e=Me.value,(w=c(_e)).next(),v(J,w.next().value));Me=we.next(),J.h=2}))},zt.prototype._asNative=function(){for(var fe=new de,we=c(this),Me=we.next();!Me.done;Me=we.next()){var _e=c(Me.value);Me=_e.next().value,_e=_e.next().value,fe.append(Me,_e)}return fe},zt.prototype._blob=function(){var fe="----formdata-polyfill-"+Math.random(),we=[],Me="--"+fe+`\r
Content-Disposition: form-data; name="`;return this.forEach((function(_e,w){return typeof _e=="string"?we.push(Me+Xt(Z(w))+`"\r
\r
`+Z(_e)+`\r
`):we.push(Me+Xt(Z(w))+'"; filename="'+Xt(_e.name)+`"\r
Content-Type: `+(_e.type||"application/octet-stream")+`\r
\r
`,_e,`\r
`)})),we.push("--"+fe+"--"),new Blob(we,{type:"multipart/form-data; boundary="+fe})},zt.prototype[Symbol.iterator]=function(){return this.entries()},zt.prototype.toString=function(){return"[object FormData]"},wt&&!wt.matches&&(wt.matches=wt.matchesSelector||wt.mozMatchesSelector||wt.msMatchesSelector||wt.oMatchesSelector||wt.webkitMatchesSelector||function(fe){for(var we=(fe=(this.document||this.ownerDocument).querySelectorAll(fe)).length;0<=--we&&fe.item(we)!==this;);return-1<we}),ot&&(zt.prototype[ot]="FormData"),me){var Zr=te.XMLHttpRequest.prototype.setRequestHeader;te.XMLHttpRequest.prototype.setRequestHeader=function(fe,we){Zr.call(this,fe,we),fe.toLowerCase()==="content-type"&&(this.B=!0)},te.XMLHttpRequest.prototype.send=function(fe){fe instanceof zt?(fe=fe._blob(),this.B||this.setRequestHeader("Content-Type",fe.type),me.call(this,fe)):me.call(this,fe)}}ve&&(te.fetch=function(fe,we){return we&&we.body&&we.body instanceof zt&&(we.body=we.body._blob()),ve.call(this,fe,we)}),St&&(te.navigator.sendBeacon=function(fe,we){return we instanceof zt&&(we=we._asNative()),St.call(this,fe,we)}),te.FormData=zt}})();const tg=()=>{const e=F("AREAS");return e.length===0&&e.push(qt.GLOBAL),zi(e).call(e,((t,n,r)=>{const i=u2(n);return i?r===0?i:"".concat(t,",").concat(i):t}),"")},u2=e=>e===qt.OVERSEA?"".concat(Xr.ASIA,",").concat(Xr.EUROPE,",").concat(Xr.AFRICA,",").concat(Xr.NORTH_AMERICA,",").concat(Xr.SOUTH_AMERICA,",").concat(Xr.OCEANIA):Xr[e],g9=e=>{const t={CODE:"",WEBCS_DOMAIN:[],WEBCS_DOMAIN_BACKUP_LIST:[],PROXY_CS:[],CDS_AP:[],ACCOUNT_REGISTER:[],UAP_AP:[],EVENT_REPORT_DOMAIN:[],EVENT_REPORT_BACKUP_DOMAIN:[],LOG_UPLOAD_SERVER:[],PROXY_SERVER_TYPE3:[]};return e.map((n=>{const r=nT[n],i=Object.keys(r);i&&i.map((s=>{s!=="CODE"&&(t[s]=t[s].concat(r[s]))}))})),t},hT={GLOBAL:{ASIA:[qt.CHINA,qt.JAPAN,qt.INDIA,qt.KOREA,qt.HKMC],EUROPE:[],NORTH_AMERICA:[qt.US],SOUTH_AMERICA:[],OCEANIA:[],AFRICA:[]}},pT=Object.keys(hT[qt.GLOBAL]),$b=[qt.CHINA,qt.NORTH_AMERICA,qt.EUROPE,qt.ASIA,qt.JAPAN,qt.INDIA,qt.OCEANIA,qt.SOUTH_AMERICA,qt.AFRICA,qt.KOREA,qt.HKMC,qt.US],v9=function(e,t){let n=[];if(Re(e).call(e,qt.GLOBAL)){const s=[qt.GLOBAL,qt.OVERSEA],o=Object.keys(nT);if(t===qt.GLOBAL)throw new se(U.INVALID_PARAMS,"GLOBAL is an invalid excludedArea value");if(t===qt.CHINA)n=[qt.OVERSEA];else if(i=t,Re(pT).call(pT,i)){const c=(r=t,hT[qt.GLOBAL][r]||[]),l=[...s,t,...c];n=o.filter((h=>!Re(l).call(l,h)))}else if((function(c){let l=!1;return pT.forEach((h=>{var p;Re(p=hT[qt.GLOBAL][h]).call(p,c)&&(l=!0)})),l})(t)){const c=(function(h){let p;return pT.forEach((E=>{var g;Re(g=hT[qt.GLOBAL][E]).call(g,h)&&(p=E)})),p})(t),l=[...s,c,t];n=o.filter((h=>!Re(l).call(l,h)))}else n=e;n=(function(c){const l=[];return $b.forEach((h=>{Re(c).call(c,h)&&l.push(h)})),l.concat(c.filter((h=>!Re($b).call($b,h))))})(n)}else n=e;var r,i;return n};function h2(e){var t,n;if(!e&&Re(t=F("AREAS")).call(t,qt.EXTENSIONS))return R.debug("update area from ap : reset"),void eI(IY,!0);if(!Re(n=F("AREAS")).call(n,qt.GLOBAL)||!e)return;let r=nT.EXTENSIONS;r&&(r={CODE:u2(qt.EXTENSIONS),WEBCS_DOMAIN:["ap-web-1-".concat(e,".agora.io")],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-".concat(e,".ap.sd-rtn.com")],PROXY_CS:["proxy-ap-web-".concat(e,".agora.io")],CDS_AP:["cds-ap-web-1-".concat(e,".agora.io"),"cds-ap-web-2-".concat(e,".ap.sd-rtn.com")],ACCOUNT_REGISTER:["sua-ap-web-1-".concat(e,".agora.io"),"sua-ap-web-2-".concat(e,".ap.sd-rtn.com")],UAP_AP:["uap-ap-web-1-".concat(e,".agora.io"),"uap-ap-web-2-".concat(e,".ap.sd-rtn.com")],EVENT_REPORT_DOMAIN:["statscollector-1-".concat(e,".agora.io")],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-".concat(e,".agora.io")],LOG_UPLOAD_SERVER:["logservice-".concat(e,".agora.io")],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy-".concat(e,".agora.io")]},R.debug("update area from ap success: ".concat(e,",config is "),r),nn("AREAS",[qt.EXTENSIONS],!0),Object.keys(r).map((i=>{i==="LOG_UPLOAD_SERVER"||i==="EVENT_REPORT_DOMAIN"||i==="EVENT_REPORT_BACKUP_DOMAIN"||i==="PROXY_SERVER_TYPE3"?nn(i,r[i][0]):nn(i,r[i])})))}function eI(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const n=We.reportApiInvoke(null,{name:Bn.SET_AREA,options:e,tag:In.TRACER});try{let r=[];if(typeof e=="string"&&(r=[e]),Array.isArray(e)&&(e.forEach((s=>{if(!Re(kM).call(kM,s))throw new se(U.INVALID_PARAMS,"invalid area code")})),r=e),Object.prototype.toString.call(e)==="[object Object]"){const{areaCode:s,excludedArea:o}=e;if(!s)throw new se(U.INVALID_PARAMS,"area code is needed");let c=s;typeof s=="string"&&(c=[s]),r=o?v9(c,o):c}if(!t){if(Ra.AREAS){const s=new se(U.PROHIBITED_OPERATION,"setArea is prohibited because of config-distribute");return n.onError(s),void R.warning("setArea is prohibited because of config-distribute")}if(Re(r).call(r,qt.GLOBAL)&&F("AREAS")===qt.EXTENSIONS){const s=new se(U.PROHIBITED_OPERATION,"setArea is prohibited because of ap extensions");return n.onError(s),void R.warning("setArea is prohibited because of ap extensions")}}nn("AREAS",r,t);const i=g9(r);Object.keys(i).map((s=>{s==="LOG_UPLOAD_SERVER"||s==="EVENT_REPORT_DOMAIN"||s==="EVENT_REPORT_BACKUP_DOMAIN"||s==="PROXY_SERVER_TYPE3"?nn(s,i[s][0]):nn(s,i[s])})),R.debug("set area success:",r.join(","))}catch(r){throw n.onError(r),r}n.onSuccess()}function p2(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable}))),n.push.apply(n,r)}return n}function Ic(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?p2(Object(n),!0).forEach((function(r){k(e,r,n[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):p2(Object(n)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))}))}return e}let tI=1;function y9(e,t,n,r,i){tI+=1;const s={sid:n.sid,command:"convergeAllocateEdge",uid:"666",appId:n.appId,ts:Math.floor(Date.now()/1e3),seq:tI,requestId:tI,version:to,cname:n.cname},o={service_name:t,json_body:JSON.stringify(s)};let c,l,h=e[0];return Ta((async()=>{c=Date.now();const p=await Ia(h,{data:o,cancelToken:r,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"}});if(l=Date.now()-c,p.code!==0){const v=new se(U.UNEXPECTED_RESPONSE,"live streaming ap error, code"+p.code,{retry:!0,responseTime:l});throw R.error(v.toString()),v}const E=JSON.parse(p.json_body);if(E.code!==200){const v=new se(U.UNEXPECTED_RESPONSE,"live streaming app center error, code: ".concat(E.code,", reason: ").concat(E.reason),{code:E.code,responseTime:l});throw R.error(v.toString()),v}if(!E.servers||E.servers.length===0){const v=new se(U.UNEXPECTED_RESPONSE,"live streaming app center empty server",{code:E.code,responseTime:l});throw R.error(v.toString()),v}const g=(function(v,O){return{addressList:v.servers.map((I=>"wss://".concat(I.address.replace(/\./g,"-"),".").concat(F("WORKER_DOMAIN"),":").concat(I.wss,"?serviceName=").concat(encodeURIComponent(O)))),workerToken:v.workerToken,vid:v.vid}})(E,t);return F("LIVE_STREAMING_ADDRESS")&&(g.addressList=F("LIVE_STREAMING_ADDRESS")instanceof Array?F("LIVE_STREAMING_ADDRESS"):[F("LIVE_STREAMING_ADDRESS")]),Ic(Ic({},g),{},{responseTime:l})}),((p,E)=>(We.apworkerEvent(n.sid,{success:!0,sc:200,serviceName:t,responseDetail:JSON.stringify(p.addressList),firstSuccess:E===0,responseTime:l,serverIp:e[E%e.length]}),!1)),((p,E)=>(We.apworkerEvent(n.sid,{success:!1,sc:p.data&&p.data.code||200,serviceName:t,responseTime:l,serverIp:e[E%e.length]}),!!(p.code!==U.OPERATION_ABORTED&&p.code!==U.UNEXPECTED_RESPONSE||p.data&&p.data.retry)&&(h=e[(E+1)%e.length],!0))),i)}let nI=1;function f2(e,t,n,r){let{url:i,areaCode:s}=e;const{clientId:o,sid:c}=t,l=Date.now();let h;const p=t.role,[E,g]=iI(t,s,[Zn.CHOOSE_SERVER]);let v=Qn.networkState;return Ta((async()=>{v&&Qn.networkState===_s.OFFLINE&&Qn.onlineWaiter&&await Pe.race([Qn.onlineWaiter,Dr(r&&r.maxRetryTimeout||rr.maxRetryTimeout)]),v=Qn.networkState;const{data:O,headers:I}=await Ia(i,{data:E,cancelToken:n,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);h=I.http3==="1"?1:-1,We.reportResourceTiming(i,c),_2(O,i,t,l,[Zn.CHOOSE_SERVER],h);const N=QE(O,Zn.CHOOSE_SERVER);return rI(N),Yb(N,i)}),(O=>(O&&We.joinChooseServer(c,{role:p,lts:l,succ:!0,csAddr:i,opid:g,serverList:O.gatewayAddrs.map((I=>I.address)),ec:null,cid:O.cid.toString(),uid:O.uid.toString(),csIp:O.csIp,unilbsServerIds:[Zn.CHOOSE_SERVER].toString(),isHttp3:h,corssRegionTagReq:t.apRequestDetail,corssRegionTagRes:O.res.detail&&O.res.detail[38]}),!1)),(O=>O.code!==U.OPERATION_ABORTED&&(O.code===U.CAN_NOT_GET_GATEWAY_SERVER?O.data.retry:(We.joinChooseServer(c,{role:p,lts:l,succ:!1,csAddr:i,serverList:null,opid:g,ec:O.code,csIp:O.data&&O.data.csIp,unilbsServerIds:[Zn.CHOOSE_SERVER].toString(),extend:JSON.stringify({networkState:v}),isHttp3:h,corssRegionTagReq:t.apRequestDetail}),R.warning("[".concat(o||"sid-".concat(c.slice(0,6)),"] Choose server network error, retry"),O),!0))),r)}function m2(e,t,n,r){let i,{url:s,areaCode:o,serviceIds:c}=e;const l=Date.now(),h=t.role,[p,E]=iI(t,o,c);let g;return Ta((async()=>{g&&Qn.networkState===_s.OFFLINE&&Qn.onlineWaiter&&await Pe.race([Qn.onlineWaiter,Dr(r&&r.maxRetryTimeout||rr.maxRetryTimeout)]),g=Qn.networkState;const{data:v,headers:O}=await Ia(s,{data:p,cancelToken:n,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);i=O.http3==="1"?1:-1,We.reportResourceTiming(s,t.sid),_2(v,s,t,l,c,i);const I=QE(v,Zn.CHOOSE_SERVER),N=QE(v,t.cloudProxyServer==="proxy5"?Zn.CLOUD_PROXY_5:t.cloudProxyServer==="proxy3"||t.cloudProxyServer==="proxy4"?Zn.CLOUD_PROXY:Zn.CLOUD_PROXY_FALLBACK),M=performance.getEntriesByName(s),x=M[M.length-1];let B;return x&&(B={name:x.name,protocol:"nextHopProtocol"in x?x.nextHopProtocol:"",dnscost:"domainLookupEnd"in x&&"domainLookupStart"in x&&typeof x.domainLookupEnd=="number"&&typeof x.domainLookupStart=="number"?x.domainLookupEnd-x.domainLookupStart:-1,tcpTlsCost:"connectEnd"in x&&"connectStart"in x&&typeof x.connectEnd=="number"&&typeof x.connectStart=="number"?x.connectEnd-x.connectStart:-1,reqCost:"requestStart"in x&&typeof x.requestStart=="number"&&"responseEnd"in x&&typeof x.responseEnd=="number"?x.responseEnd-x.requestStart:-1,handleCost:"leave_ts"in v&&"enter_ts"in v&&typeof v.leave_ts=="number"&&typeof v.enter_ts=="number"?v.leave_ts-v.enter_ts:-1}),rI(I),{gatewayInfo:Yb(I,s),proxyInfo:N,url:s,resourceTimingInfo:B}}),(v=>(v.gatewayInfo&&We.joinChooseServer(t.sid,{role:h,lts:l,succ:!0,csAddr:s,serverList:v.gatewayInfo.gatewayAddrs.map((O=>O.address)),ec:null,opid:E,cid:v.gatewayInfo.cid.toString(),uid:v.gatewayInfo.uid.toString(),csIp:v.gatewayInfo.csIp,unilbsServerIds:c.toString(),isHttp3:i,corssRegionTagReq:t.apRequestDetail,corssRegionTagRes:v.gatewayInfo.res.detail&&v.gatewayInfo.res.detail[38],resourceTimingInfo:v.resourceTimingInfo?JSON.stringify(v.resourceTimingInfo):void 0}),v.proxyInfo&&We.joinWebProxyAP(t.sid,{lts:l,sucess:1,apServerAddr:s,turnServerAddrList:v.proxyInfo.addresses.map((O=>O.ip)).join(","),errorCode:null,eventType:t.cloudProxyServer,unilbsServerIds:c.toString()}),!1)),(v=>v.code!==U.OPERATION_ABORTED&&(v.code===U.CAN_NOT_GET_GATEWAY_SERVER?v.data.retry:(We.joinWebProxyAP(t.sid,{lts:l,sucess:0,apServerAddr:s,turnServerAddrList:null,errorCode:v.code,eventType:t.cloudProxyServer,unilbsServerIds:c.toString(),extend:JSON.stringify({networkState:g})}),R.warning("[".concat(t.clientId,"] multi unilbs network error, retry"),v),!0))),r)}const _2=(e,t,n,r,i,s)=>{const{sid:o,clientId:c,cloudProxyServer:l}=n,h=[],p=E=>{E.flag===4096?We.joinChooseServer(o,{role:n.role,lts:r,succ:!1,csAddr:t,opid:e.opid,serverList:null,ec:E.error.message,csIp:E.error.data&&E.error.data.csIp,unilbsServerIds:i.toString(),isHttp3:s,corssRegionTagReq:n.apRequestDetail}):E.flag!==1048576&&E.flag!==4194304&&E.flag!==4194310||We.joinWebProxyAP(o,{lts:r,sucess:0,apServerAddr:t,turnServerAddrList:null,errorCode:E.error.code,eventType:l,unilbsServerIds:i.toString()})};if(e.response_body.forEach((E=>{const g=E.buffer.code;if(E.uri===23&&g===0&&!E.buffer.edges_services)if(E.buffer.flag===4194310)R.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers"),E.buffer.edges_services=[];else{const v={error:new se(U.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:e.detail[502]}),flag:E.buffer.flag};h.push(v),p(v)}if(g!==0){const v=Gf(g),O={error:new se(U.CAN_NOT_GET_GATEWAY_SERVER,v.desc,{desc:v.desc,retry:v.retry,csIp:e.detail[502]}),flag:E.buffer.flag};E.buffer.flag===4194310?R.warning(O.error.toString()):h.push(O),p(O)}})),h.length)throw R.warning("[".concat(c||"sid-".concat(o.slice(0,6)),"] multi unilbs ").concat(t," failed, ").concat(h.map((E=>"flag: ".concat(E.flag,", message: ").concat(E.error.message,", retry: ").concat(E.error.data.retry))).join(" | "))),new se(U.CAN_NOT_GET_GATEWAY_SERVER,h.map((E=>"flag: ".concat(E.flag,", message: ").concat(E.error.message))).join(" | "),{retry:!!h.find((E=>E.error.data.retry)),csIp:e.detail[502],desc:[...new Set(h.map((E=>{var g;return E==null||(g=E.error)===null||g===void 0||(g=g.data)===null||g===void 0?void 0:g.desc})).filter((E=>!!E)))]})},rI=e=>{var t,n,r,i;if(e.addresses&&e.addresses.length===0&&e.code===0)throw new se(U.CAN_NOT_GET_GATEWAY_SERVER,"void gateway address",{retry:!0,csIp:e.detail&&e.detail[502]});if(F("AP_AREA")&&((r=e.detail)!==null&&r!==void 0&&r[23]&&typeof((i=e.detail)===null||i===void 0?void 0:i[23])=="string"?h2(e.detail[23].toLowerCase()):h2()),(t=e.detail)!==null&&t!==void 0&&t[19]&&typeof((n=e.detail)===null||n===void 0?void 0:n[19])=="string"){const o=e.detail[19],c=o?.split(";");for(let l=0;l<c.length;l++){var s;const h=pi(s=c[l]).call(s);e.addresses[l]&&c&&(e.addresses[l].fingerprint=h)}}if(F("GATEWAY_ADDRESS")&&F("GATEWAY_ADDRESS").length>0){R.debug("assign gateway address to",F("GATEWAY_ADDRESS"));const o=F("GATEWAY_ADDRESS").map((c=>{var l,h;const p=(l=(h=e.addresses.find((E=>E.ip===c.ip&&E.port===c.port)))===null||h===void 0?void 0:h.fingerprint)!==null&&l!==void 0?l:"";return{ip:c.ip,port:c.port,ticket:e.addresses[0]&&e.addresses[0].ticket,fingerprint:p}}));e.addresses=o}},S9=(e,t)=>{if(e.response_body&&e.response_body.length){const n=e.response_body[0];if(n.buffer.code!==0){const r=Gf(n.buffer.code);throw new se(U.UPDATE_TICKET_FAILED,"[".concat(n.buffer.code,"]: ").concat(r.desc),{retry:r.retry})}return n.buffer.ticket}throw R.debug("update ticket request received ap response without response body:",t),new se(U.UPDATE_TICKET_FAILED,"cannot find response body from ap response",{retry:!1})},iI=(e,t,n)=>{const r=Math.floor(Math.random()*1e12),i=e.role==="host"?"1":e.role==="audience"?"2":void 0,s={appid:e.appId,client_ts:Date.now(),opid:r,sid:e.sid,request_bodies:[{uri:22,buffer:{cname:e.cname,detail:Ic(Ic(Ic({6:e.stringUid,11:t,12:F("USE_NEW_TOKEN")?"1":void 0},i?{17:i}:{}),{},{22:t},e.apRequestDetail?{33:e.apRequestDetail}:{}),e.apRTM?{26:"RTM2"}:{}),key:e.token,service_ids:n,uid:e.uid||0}}]};s.request_bodies.forEach((c=>{e.multiIP&&e.multiIP.gateway_ip&&(c.buffer.detail[5]=JSON.stringify({vocs_ip:[e.multiIP.uni_lbs_ip],vos_ip:[e.multiIP.gateway_ip]}))}));const o=new FormData;return o.append("request",JSON.stringify(s)),[o,r]},T9=(e,t)=>{const n=Math.floor(Math.random()*1e12),r={appid:e.appId,client_ts:Date.now(),opid:n,sid:e.sid,request_bodies:[{uri:28,buffer:{cname:e.cname,detail:{1:"",6:e.stringUid,12:"1"},token:e.token,service_ids:t,uid:e.uid||0,edges_services:e.apResponse.addresses.map((s=>({ip:s.ip,port:s.port})))}}]},i=new FormData;return i.append("request",JSON.stringify(r)),[i,n]};let Yf=0;function qf(e){return Pe.all(e.map((t=>t.then((n=>{throw n}),(n=>n))))).then((t=>{throw t}),(t=>t))}const ng=async e=>{let{fragementLength:t,referenceList:n,asyncMapHandler:r,allFailedhandler:i,promisesCollector:s}=e,o=0;const c=t;let l,h=0;const p=async()=>{const E=(()=>{const g=o*c,v=g+c;return n.slice(g,v).map(r)})();s&&s.push(...E);try{l=await qf(E)}catch(g){if(h+=c,o++,!(h>=n.length))return void await p();i(g)}E.forEach((g=>g.cancel()))};return await p(),l},E2=async e=>{let{referenceList:t,asyncMapHandler:n,closeFn:r}=e;const i=t.length;let s=0;const o=async()=>{const c=n(t.shift());try{return await c}catch(l){if(s++,s>=i||r!=null&&r(l))throw l;return o()}};return o()};async function R9(){if(typeof VideoDecoder>"u")return!0;let e;const t=[18,0,10,13,0,0,0,3,180,253,144,6,136,8,8,8,32,50,85,16,66,128,2,8,32,132,0,8,0,180,90,204,169,166,242,109,241,190,143,149,160,133,4,144,43,122,168,159,120,159,205,39,82,131,57,52,87,187,68,23,248,134,204,226,97,17,49,183,55,236,219,249,221,98,208,215,190,59,179,167,213,47,1,246,150,14,194,245,159,83,35,64,103,218,38,21,82,3,135,21,185,84,248,134],n=[18,0,10,13,0,0,0,3,180,253,144,6,136,8,8,8,32,50,87,16,66,128,2,8,32,132,0,8,0,180,90,204,169,166,242,109,241,190,143,148,62,134,140,92,172,141,77,35,94,181,164,65,169,65,156,154,43,221,162,11,252,67,102,113,48,136,137,219,62,43,113,239,23,126,250,186,252,10,138,218,25,193,244,74,68,194,209,107,23,52,206,199,78,72,98,103,151,71,96,62,51,210,158,72,231,158],r=[18,0,10,13,0,0,0,3,180,253,144,6,136,8,8,8,32,50,87,16,66,128,2,8,32,132,0,8,0,180,90,204,169,166,242,109,241,190,143,143,233,163,51,196,98,95,151,224,22,134,33,240,150,248,67,18,34,196,142,81,238,173,140,80,205,232,132,144,67,12,131,157,4,171,243,86,122,35,6,166,184,243,85,126,13,206,103,152,62,168,160,187,2,241,138,52,211,72,121,128,151,63,147,128,19,42],i=[18,0,50,138,1,48,192,64,253,248,65,17,67,192,32,0,16,0,0,0,0,0,0,0,195,12,48,144,64,32,0,209,75,61,9,204,25,115,79,226,115,63,63,208,70,210,220,153,126,241,237,37,107,195,153,1,99,112,230,189,209,169,130,10,11,22,167,215,159,205,197,7,183,162,26,48,254,141,134,103,32,16,235,45,1,15,18,119,169,110,206,251,51,115,202,60,148,1,46,39,109,25,28,86,168,15,77,211,239,2,58,43,146,26,230,184,81,48,140,226,226,250,222,146,171,133,164,13,188,180,64,122,142,146,32,208,238,170,193,35,53,44,225],s=[18,0,50,107,48,0,133,125,248,65,26,195,64,62,32,31,16,0,0,0,0,0,1,4,16,64,144,64,32,0,204,24,122,65,56,165,18,52,206,218,4,187,51,97,9,29,191,90,253,106,185,31,197,155,52,205,245,185,203,131,20,226,25,124,95,113,220,113,141,15,15,104,211,144,152,237,150,157,127,51,143,24,231,218,171,255,176,241,128,229,149,150,148,66,245,228,91,27,182,228,136,61,182,237,133,45,220,24,103,214,152],o=[18,0,50,122,48,1,9,253,248,65,26,67,64,62,32,31,16,0,0,0,0,0,1,4,16,64,144,64,32,0,198,182,231,242,220,235,163,140,12,36,36,166,46,132,210,4,71,23,218,132,27,30,17,45,244,79,31,243,195,136,100,169,76,88,142,85,204,217,121,168,29,163,198,17,251,223,73,12,212,244,139,123,151,179,75,216,96,208,136,40,229,42,59,149,10,116,228,85,99,93,221,108,255,140,248,20,30,167,122,109,206,164,108,197,110,251,23,243,133,160,63,13,207,177,12,128];return await new Pe(((l,h)=>{let p;(async function(){e&&e.state!=="closed"||await(async function(){e=new VideoDecoder({output:g=>{g.close(),clearTimeout(p),l(!0)},error:g=>{clearTimeout(p),l(!1)}}),await e.configure({codec:"av01.0.05M.08",width:160,height:90})})();const E=[t,n,r,i,s,o];for(let g=0;g<E.length;g++){const v=new EncodedVideoChunk({type:g==0?"key":"delta",timestamp:33333*g,duration:33333,data:new Uint8Array(E[g])});try{await e.decode(v)}catch{return void l(!1)}}})(),p=setTimeout((()=>{l(!1)}),5e3)}))}async function sI(e,t,n,r){return{gatewayInfo:await(async function(s,o,c,l){let h=null;const p=[],E=async()=>{const v=F("WEBCS_DOMAIN").slice(0,F("AJAX_REQUEST_CONCURRENT")).map((N=>({url:s.proxyServer?"https://".concat(s.proxyServer,"/ap/?url=").concat(N+"/api/v2/transpond/webrtc?v=2"):"https://".concat(N,"/api/v2/transpond/webrtc?v=2"),areaCode:tg()}))),O=l.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:v.map((N=>N.url))}),I=await ng({fragementLength:F("FRAGEMENT_LENGTH"),referenceList:v,asyncMapHandler:N=>(R.debug("[".concat(s.clientId,"] Connect to choose_server:"),N.url),f2(N,s,o,c)),allFailedhandler:N=>{throw l.recordJoinChannelService({endTs:Date.now(),status:"error",errors:N},O),N[0]},promisesCollector:p});return l.recordJoinChannelService({endTs:Date.now(),status:"success"},O),I},g=async()=>{if(await Dr(1e3),h!==null)return h;const v=F("WEBCS_DOMAIN_BACKUP_LIST").map((N=>({url:s.proxyServer?"https://".concat(s.proxyServer,"/ap/?url=").concat(N+"/api/v2/transpond/webrtc?v=2"):"https://".concat(N,"/api/v2/transpond/webrtc?v=2"),areaCode:tg()}))),O=l.recordJoinChannelService({endTs:void 0,startTs:Date.now(),status:"pending",service:"chooseServer",urls:v.map((N=>N.url))}),I=await ng({fragementLength:F("FRAGEMENT_LENGTH"),referenceList:v,asyncMapHandler:N=>(R.debug("[".concat(s.clientId,"] Connect to backup choose_server:"),N.url),f2(N,s,o,c)),allFailedhandler:N=>{throw l.recordJoinChannelService({endTs:Date.now(),status:"error",errors:N},O),N[0]},promisesCollector:p});return l.recordJoinChannelService({endTs:Date.now(),status:"success"},O),I};try{return h=await qf([E(),g()]),p.length&&p.forEach((v=>v.cancel&&typeof v.cancel=="function"&&v.cancel())),h}catch(v){throw v[0]}})(e,t,n,r)}}async function g2(e,t,n,r,i){const s=e.cloudProxyServer;if(s==="disabled"){if(e.useLocalAccessPoint)return await sI(e,t,n,i);if(F("JOIN_WITH_FALLBACK_MEDIA_PROXY")){const{gatewayInfo:g,proxyInfo:v}=await S2(e,t,n,i);if(e.turnServer&&e.turnServer.mode!=="auto")return{gatewayInfo:g};const O=v.map((I=>({turnServerURL:I.address,tcpport:I.tcpport||Br.tcpport,udpport:I.udpport||Br.udpport,username:I.username||Br.username,password:I.password||Br.password,forceturn:!1,security:!0})));if(i.useP2P){var o;const I=(o=e.uid)!==null&&o!==void 0?o:g.uid,N="glb:".concat(I.toString()),M=await q0(N),x=v.map((B=>({turnServerURL:B.address,tcpport:B.tcpport||Br.tcpport,udpport:B.udpport||Br.udpport,username:N,password:M,forceturn:!1,security:!0})));O.push(...x)}return e.turnServer={mode:"manual",servers:O},{gatewayInfo:g}}return await sI(e,t,n,i)}const{proxyInfo:c,gatewayInfo:l}=await S2(e,t,n,i),h={gatewayInfo:l},p=c.map((g=>({turnServerURL:g.address,tcpport:s==="proxy3"?void 0:g.tcpport?g.tcpport:Br.tcpport,udpport:s==="proxy4"?void 0:g.udpport?g.udpport:Br.udpport,username:g.username||Br.username,password:g.password||Br.password,forceturn:s!=="proxy4",security:s==="proxy5"})));if(i.useP2P){var E;const g=(E=e.uid)!==null&&E!==void 0?E:l.uid,v="glb:".concat(g.toString()),O=await q0(v),I=c.map((N=>({turnServerURL:N.address,tcpport:s==="proxy3"?void 0:N.tcpport||Br.tcpport,udpport:s==="proxy4"?void 0:N.udpport||Br.udpport,username:v,password:O,forceturn:s!=="proxy4",security:s==="proxy5"})));p.push(...I)}return e.turnServer={mode:"manual",servers:p},R.debug("[".concat(e.clientId,"] set proxy server: ").concat(e.proxyServer,", mode: ").concat(s)),h}async function v2(e,t,n,r,i){const s=F("ACCOUNT_REGISTER").slice(0,F("AJAX_REQUEST_CONCURRENT"));let o=[];o=t.proxyServer?s.map((l=>"https://".concat(t.proxyServer,"/ap/?url=").concat(l+"/api/v1"))):s.map((l=>"https://".concat(l,"/api/v1")));const c=i?.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"stringUID",urls:o});try{const l=await(async function(h,p,E,g,v){const O=Date.now(),I={sid:E.sid,opid:10,appid:E.appId,string_uid:p};let N=h[0];const M=await Ta((()=>Ia(N+"".concat(N.indexOf("?")===-1?"?":"&","action=stringuid"),{data:I,cancelToken:g,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}})),((x,B)=>{if(x.code===0){if(x.uid<=0||x.uid>=Math.pow(2,32))throw R.error("Invalid Uint Uid ".concat(p," => ").concat(x.uid),x),We.reqUserAccount(I.sid,{lts:O,success:!1,serverAddr:N,stringUid:I.string_uid,uid:x.uid,errorCode:U.INVALID_UINT_UID_FROM_STRING_UID,extend:I}),new se(U.INVALID_UINT_UID_FROM_STRING_UID);return We.reqUserAccount(I.sid,{lts:O,success:!0,serverAddr:N,stringUid:I.string_uid,uid:x.uid,errorCode:null,extend:I}),!1}const Z=Gf(x.code);return Z.retry&&(N=h[(B+1)%h.length]),We.reqUserAccount(I.sid,{lts:O,success:!1,serverAddr:N,stringUid:I.string_uid,uid:x.uid,errorCode:Z.desc,extend:I}),Z.retry}),((x,B)=>x.code!==U.OPERATION_ABORTED&&(We.reqUserAccount(I.sid,{lts:O,success:!1,serverAddr:N,stringUid:I.string_uid,uid:null,errorCode:x.code,extend:I}),N=h[(B+1)%h.length],!0)),v);if(M.code!==0){const x=Gf(M.code);throw new se(U.UNEXPECTED_RESPONSE,x.desc)}return M})(o,e,t,n,r);return i?.recordJoinChannelService({status:"success",endTs:Date.now()},c),l.uid}catch(l){throw i?.recordJoinChannelService({status:"error",endTs:Date.now(),errors:[l]},c),l}}async function C9(e,t,n){const r=F("ACCOUNT_REGISTER");let i=[];i=t.proxyServer?r.map((s=>"https://".concat(t.proxyServer,"/ap/?url=").concat(s+"/api/v1"))):r.map((s=>"https://".concat(s,"/api/v1")));try{return await E2({referenceList:i,asyncMapHandler:o=>(async function(c,l,h,p){const E=Date.now(),g={sid:h.sid,opid:10,appid:h.appId,string_uid:l};try{const v=await Ia(c+"".concat(c.indexOf("?")===-1?"?":"&","action=stringuid"),{data:g,cancelToken:p,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}});if(v.code!==0){const O=Gf(v.code);throw new se(U.UNEXPECTED_RESPONSE,"preload sua error:".concat(O.desc),O)}if(v.uid<=0||v.uid>=Math.pow(2,32))throw new se(U.INVALID_UINT_UID_FROM_STRING_UID);return{requestTime:E,url:c,req:g,uid:v.uid,elapse:Date.now()-E}}catch(v){throw v}})(o,e,t,n),closeFn:o=>o.code===U.OPERATION_ABORTED||o.code===U.UNEXPECTED_RESPONSE&&!o.data.retry})}catch(s){throw s}}async function w9(e,t,n){const r=F("CDS_AP").slice(0,F("AJAX_REQUEST_CONCURRENT")).map((l=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(l+"/api/v1"):"https://".concat(l,"/api/v1?action=config"))),i=r.map((l=>(function(h,p,E,g){const v=xt(),O={flag:64,cipher_method:0,features:Ic(Ic(Ic(Ic(Ic({install_id:sb(),device:v.name,system:v.os,system_general:navigator.userAgent,vendor:p.appId,version:to,cname:p.cname,session_id:p.sid,proxyServer:p.proxyServer,sdk_type:m9.WEB_RTC,browser_name:v.name,browser_version:v.version,user_agent:navigator.userAgent,channel_name:p.cname},p.stringUid&&{string_uid:p.stringUid}),p.uid&&{uid:p.uid+""}),v.os&&{os_name:v.os}),v.osVersion&&{os_version:v.osVersion}),{},{detail:""})};return Ta((()=>Ia(h,{data:O,timeout:1e3,cancelToken:E,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":54}})),void 0,(I=>I.code!==U.OPERATION_ABORTED),g)})(l,e,t,n)));let s=null,o=null,c={};try{s=await qf(i)}catch(l){if(l.code===U.OPERATION_ABORTED)throw l;o=l}if(i.forEach((l=>l.cancel())),We.reportApiInvoke(e.sid,{name:Bn.REQUEST_CONFIG_DISTRIBUTE,options:{error:o,res:s}}).onSuccess(),s&&s.test_tags)try{c=(function(l){if(!l.test_tags)return{};const h=l.test_tags,p=Object.keys(h),E={};return p.forEach((g=>{var v;const O=pi(v=g.slice(4)).call(v),I=JSON.parse(h[g]),N=I[1];E[O]={tag:I[0]||"",value:N}})),E})(s)}catch{}return c}async function y2(e,t){const n=F("WEBCS_DOMAIN").concat(F("WEBCS_DOMAIN_BACKUP_LIST")).map((r=>({url:"https://".concat(r,"/api/v2/transpond/webrtc?v=2"),areaCode:tg(),serviceIds:[Zn.CHOOSE_SERVER,Zn.CLOUD_PROXY_FALLBACK]})));try{return await E2({referenceList:n,asyncMapHandler:i=>(async function(s,o,c){let l,{url:h,areaCode:p,serviceIds:E}=s;const g=Date.now(),[v,O]=iI(o,p,E);let I=Qn.networkState;try{I&&Qn.networkState===_s.OFFLINE&&Qn.onlineWaiter&&await Pe.race([Qn.onlineWaiter,Dr(rr.maxRetryTimeout)]),I=Qn.networkState;const{data:N,headers:M}=await Ia(h,{data:v,cancelToken:c,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);l=M.http3==="1"?1:-1,(Q=>{const z=[];if(Q.response_body.forEach((te=>{const de=te.buffer.code;if(te.uri===23&&de===0&&!te.buffer.edges_services)if(te.buffer.flag===4194310)te.buffer.edges_services=[];else{const me={error:new se(U.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:Q.detail[502]}),flag:te.buffer.flag};z.push(me)}if(de!==0){const me=Gf(de),ve={error:new se(U.CAN_NOT_GET_GATEWAY_SERVER,me.desc,{desc:me.desc,retry:me.retry,csIp:Q.detail[502]}),flag:te.buffer.flag};te.buffer.flag===4194310?R.warning(ve.error.toString()):z.push(ve)}})),z.length)throw new se(U.CAN_NOT_GET_GATEWAY_SERVER,z.map((te=>"flag: ".concat(te.flag,", message: ").concat(te.error.message))).join(" | "),{retry:!!z.find((te=>te.error.data.retry)),csIp:Q.detail[502],desc:[...new Set(z.map((te=>{var de;return te==null||(de=te.error)===null||de===void 0||(de=de.data)===null||de===void 0?void 0:de.desc})).filter((te=>!!te)))]})})(N);const B=QE(N,Zn.CHOOSE_SERVER),Z=QE(N,Zn.CLOUD_PROXY_FALLBACK);return rI(B),{gatewayInfo:Yb(B,h),proxyInfo:Z,opid:O,requestTime:g,url:h,isHttp3:l,elapse:Date.now()-g}}catch(N){throw N}})(i,e,t),closeFn:i=>i.code===U.OPERATION_ABORTED||i.code===U.CAN_NOT_GET_GATEWAY_SERVER&&!i.data.retry})}catch(r){throw r}}async function S2(e,t,n,r){const i=F("PROXY_SERVER_TYPE3"),s=(v,O,I)=>{let N=I||i;return Array.isArray(N)&&(N=O%2==0&&i[1]||i[0]),"https://".concat(N,"/ap/?url=").concat(v)};let o=null;const c=[],l=async()=>{const v=F("WEBCS_DOMAIN").slice(0,F("AJAX_REQUEST_CONCURRENT")).map(((N,M)=>{let x;return x=e.cloudProxyServer==="disabled"&&e.proxyServer?s("".concat(N,"/api/v2/transpond/webrtc?v=2"),M,e.proxyServer):e.cloudProxyServer==="disabled"||e.cloudProxyServer==="fallback"?"https://".concat(N,"/api/v2/transpond/webrtc?v=2"):s("".concat(N,"/api/v2/transpond/webrtc?v=2"),M),{url:x,areaCode:tg(),serviceIds:[Zn.CHOOSE_SERVER,e.cloudProxyServer==="proxy5"?Zn.CLOUD_PROXY_5:e.cloudProxyServer==="proxy3"||e.cloudProxyServer==="proxy4"?Zn.CLOUD_PROXY:Zn.CLOUD_PROXY_FALLBACK]}})),O=r.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:v.map((N=>N.url))}),I=await ng({fragementLength:F("FRAGEMENT_LENGTH"),referenceList:v,asyncMapHandler:N=>(R.debug("[".concat(e.clientId,"] Connect to choose_server:"),N.url),m2(N,e,t,n)),allFailedhandler:N=>{throw r.recordJoinChannelService({endTs:Date.now(),status:"error",errors:N},O),N[0]},promisesCollector:c});return r.recordJoinChannelService({endTs:Date.now(),status:"success"},O),I},h=async()=>{if(await Dr(1e3),o!==null)return o;const v=F("WEBCS_DOMAIN_BACKUP_LIST").map(((N,M)=>{let x;return x=e.cloudProxyServer==="disabled"&&e.proxyServer?s("".concat(N,"/api/v2/transpond/webrtc?v=2"),M,e.proxyServer):e.cloudProxyServer==="disabled"||e.cloudProxyServer==="fallback"?"https://".concat(N,"/api/v2/transpond/webrtc?v=2"):s("".concat(N,"/api/v2/transpond/webrtc?v=2"),M),{url:x,areaCode:tg(),serviceIds:[Zn.CHOOSE_SERVER,e.cloudProxyServer==="proxy5"?Zn.CLOUD_PROXY_5:e.cloudProxyServer==="proxy3"||e.cloudProxyServer==="proxy4"?Zn.CLOUD_PROXY:Zn.CLOUD_PROXY_FALLBACK]}})),O=r.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:v.map((N=>N.url))}),I=await ng({fragementLength:F("FRAGEMENT_LENGTH"),referenceList:v,asyncMapHandler:N=>(R.debug("[".concat(e.clientId,"] Connect to backup choose_server:"),N.url),m2(N,e,t,n)),allFailedhandler:N=>{throw r.recordJoinChannelService({endTs:Date.now(),status:"error",errors:N},O),N[0]},promisesCollector:c});return r.recordJoinChannelService({endTs:Date.now(),status:"success"},O),I};let p,E,g;try{({gatewayInfo:p,proxyInfo:E,url:g}=await qf([l(),h()]))}catch(v){throw v[0]}if(c.length&&c.forEach((v=>v.cancel&&typeof v.cancel=="function"&&v.cancel())),!p||!E)throw new se(U.UNEXPECTED_ERROR,"missing gateway or proxy response").print();if(e.apUrl=g,e.cloudProxyServer!=="disabled"&&Array.isArray(i)&&g){const v=/^https?:\/\/(.+?)(\/.*)?$/.exec(g)[1];Re(i).call(i,v)&&(e.proxyServer=v,R.setProxyServer(v),We.setProxyServer(v))}return o={gatewayInfo:p,proxyInfo:await KM(E,p.uid)},o}async function b9(e,t,n){const r=F("UAP_AP").slice(0,F("AJAX_REQUEST_CONCURRENT")).map((s=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(s+"/api/v1?action=uap"):"https://".concat(s,"/api/v1?action=uap"))),i=r.map((s=>(function(o,c,l,h){const p={command:"convergeAllocateEdge",sid:c.sid,appId:c.appId,token:c.token,ts:Date.now(),version:to,cname:c.cname,uid:c.uid.toString(),requestId:nI,seq:nI};nI+=1;const E={service_name:"tele_channel",json_body:JSON.stringify(p)};return Ta((async()=>{const g=await Ia(o,{data:E,cancelToken:l,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":61}});if(g.code!==0){const O=new se(U.UNEXPECTED_RESPONSE,"cross channel ap error, code"+g.code,{retry:!0});throw R.error(O.toString()),O}const v=JSON.parse(g.json_body);if(v.code!==200){const O=new se(U.UNEXPECTED_RESPONSE,"cross channel app center error, code: ".concat(v.code,", reason: ").concat(v.reason));throw R.error(O.toString()),O}if(!v.servers||v.servers.length===0){const O=new se(U.UNEXPECTED_RESPONSE,"cross channel app center empty server");throw R.error(O.toString()),O}return{vid:v.vid,workerToken:v.workerToken,addressList:(F("CHANNEL_MEDIA_RELAY_SERVERS")||v.servers).map((O=>"wss://".concat(O.address.replace(/\./g,"-"),".").concat(F("WORKER_DOMAIN"),":").concat(O.wss)))}}),void 0,(g=>!!(g.code!==U.OPERATION_ABORTED&&g.code!==U.UNEXPECTED_RESPONSE||g.data&&g.data.retry)),h)})(s,e,t,n)));try{const s=await qf(i);return i.forEach((o=>o.cancel())),s}catch(s){throw s[0]}}async function I9(e,t,n){let r=null;const i=[],s=async o=>{const c=F(o?"WEBCS_DOMAIN_BACKUP_LIST":"WEBCS_DOMAIN").map((l=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(l+"/api/v2/transpond/webrtc?v=2"):"https://".concat(l,"/api/v2/transpond/webrtc?v=2")));return o&&(await Dr(1e3),r!==null)?r:await ng({fragementLength:F("FRAGEMENT_LENGTH"),referenceList:c,asyncMapHandler:l=>(R.debug("[".concat(e.clientId,"] update ticket, Connect to ").concat(o?"backup":""," choose_server:"),l),(function(h,p,E,g){const[v]=T9(p,[Zn.CHOOSE_SERVER]);let O=Qn.networkState;return Ta((async()=>{O&&Qn.networkState===_s.OFFLINE&&Qn.onlineWaiter&&await Pe.race([Qn.onlineWaiter,Dr(g&&g.maxRetryTimeout||rr.maxRetryTimeout)]),O=Qn.networkState;const I=await Ia(h,{data:v,cancelToken:E,headers:{"Content-Type":"multipart/form-data;"}},!0);return S9(I,h)}),(()=>!1),(I=>I.code!==U.OPERATION_ABORTED&&(I.code===U.UPDATE_TICKET_FAILED?I.data.retry:(R.warning("[".concat(p.clientId,"] update ticket network error, retry"),I),!0))),g)})(l,e,t,n)),allFailedhandler:l=>{throw l[0]},promisesCollector:i})};try{return r=await qf([s(!1),s(!0)]),i.length&&i.forEach((o=>o.cancel&&typeof o.cancel=="function"&&o.cancel())),r}catch(o){throw o[0]}}function T2(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable}))),n.push.apply(n,r)}return n}function oI(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?T2(Object(n),!0).forEach((function(r){k(e,r,n[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):T2(Object(n)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))}))}return e}class A9 extends Pn{get isSuccess(){return!!this.configs}constructor(t,n){super(),k(this,"configs",void 0),k(this,"store",void 0),k(this,"joinInfo",void 0),k(this,"cancelToken",void 0),k(this,"retryConfig",{timeout:3e3,timeoutFactor:1.5,maxRetryCount:1,maxRetryTimeout:1e4}),k(this,"interval",void 0),k(this,"mutex",void 0),k(this,"mutableParamsRead",!1),k(this,"configCache",{}),k(this,"limit_bitrate",void 0),this.mutex=new Yr("config-distribute",t),this.store=n}startGetConfigDistribute(t,n){this.joinInfo=t,this.cancelToken=n,this.interval&&this.stopGetConfigDistribute(),F("ENABLE_CONFIG_DISTRIBUTE")&&(this.updateConfigDistribute(),this.interval=window.setInterval((()=>{this.updateConfigDistribute()}),F("CONFIG_DISTRIBUTE_INTERVAL")))}stopGetConfigDistribute(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.joinInfo=void 0,this.cancelToken=void 0,this.configs=void 0,this.limit_bitrate=void 0}async awaitConfigDistributeComplete(){this.mutex.isLocked&&(await this.mutex.lock())()}async updateConfigDistribute(){if(this.mutableParamsRead||(this.mutableParamsRead=!0,We.reportApiInvoke(null,{options:void 0,name:Bn.LOAD_CONFIG_FROM_LOCALSTORAGE,tag:In.TRACER}).onSuccess(JSON.stringify(Ra))),!this.joinInfo||!this.cancelToken||!this.retryConfig)return void R.debug("[config-distribute] get config distribute interrupted have no joininfo");let t;const n=await this.mutex.lock();try{t=await w9(this.joinInfo,this.cancelToken,this.retryConfig),R.debug("[config-distribute] get config distribute",JSON.stringify(t));const r=(function(i){var s;const o=sh(s=Object.keys(i).filter((h=>/^webrtc_ng_global_parameter/.test(h)))).call(s);for(let h=0;h<o.length;h++)for(let p=o.length-1;p>h;p--){const E=o[p],g=i[E].value;if(typeof g.__priority=="number"){const v=g.__priority,O=o[p-1],I=i[O].value;if(typeof I.__priority=="number"){if(!(v>I.__priority))continue;{const N=E;o[p]=o[p-1],o[p-1]=N}}else{const N=E;o[p]=o[p-1],o[p-1]=N}}}const c=Date.now();let l={};return o.forEach((h=>{const p=i[h].value.__expires;p&&p<=c||(l[h]=i[h])})),l})(t);this.cacheGlobalParameterConfig(r),this.store.hasStartJoinChannel||(this.store.isABTestSuccess=!0),this.configs=r}catch(r){const i=new se(U.NETWORK_RESPONSE_ERROR,r);R.warning("[config-distribute] ".concat(i.toString()))}finally{n()}}getBitrateLimit(){return this.limit_bitrate||void 0}handleBitrateLimit(t){LM(t)&&(this.limit_bitrate?this.limit_bitrate&&this.limit_bitrate.id!==t.id&&this.emit(qE.UPDATE_BITRATE_LIMIT,t):this.emit(qE.UPDATE_BITRATE_LIMIT,t))}getLowStreamConfigDistribute(){return this.limit_bitrate&&oI({},this.limit_bitrate.low_stream_uplink)}handleABTestConfigDistribute(t){try{const n={},r=Object.keys(t),i=[];r.forEach((s=>{const o=t[s].value;n[s]=o;const c=o.__id;if(c&&this.configCache[s]&&this.configCache[s].__id===c)return;const l=o.__type,h=t[s].value,p=t[s].tag;let E=0;l?l===iL.REALTIME&&(E=1):Object.keys(h).some((g=>Object.prototype.hasOwnProperty.call(lb,g)||!Mb()&&Object.prototype.hasOwnProperty.call(LS,g)?(E=1,!0):void 0)),i.push({tag:p,isApplied:E,feature:s,params:JSON.stringify(o)})})),i.forEach((s=>{let{tag:o,feature:c,params:l,isApplied:h}=s;this.store.sessionId&&We.abTest(this.store.sessionId,{intSucc:1,isApplied:h,tag:o,feature:c,params:l,cid:this.store.cid,uid:this.store.intUid})})),this.configCache=n}catch(n){R.debug("handleABTestConfigDistribute error",n)}}cacheGlobalParameterConfig(t){const n=(function(i){const s={};return Object.keys(i).forEach((o=>{const c=i[o].value,l=c.__expires,h=c.__type;Object.keys(c).forEach((p=>{p==="__id"||p==="__type"||p==="__priority"||p==="__expires"||Object.prototype.hasOwnProperty.call(s,p)||(s[p]=oI(oI({value:c[p]},l&&{expires:l}),h&&{type:h}))}))})),s})(t);try{var r;const i=(r=n.LIMIT_BITRATE)===null||r===void 0?void 0:r.value;delete n.LIMIT_BITRATE,i&&LM(i)&&this.handleBitrateLimit(i),this.limit_bitrate=i,this.handleGlobalParameterConfig(n),this.handleABTestConfigDistribute(t),(function(c){try{const l=Date.now();Object.keys(c).forEach((h=>{const{value:p,type:E,expires:g}=c[h];g&&g<=l||((E===iL.REALTIME||Object.prototype.hasOwnProperty.call(lb,h))&&(Ra[h]=p,wn[h]=p,R.debug("Update realtime parameters from config distribute",h,p)),E||Mb()||!Object.prototype.hasOwnProperty.call(LS,h)||(Ra[h]=p,wn[h]=p,R.debug("Update gateway parameters from config distribute",h,p)))}))}catch(l){R.error("Error update config immediately: ".concat(c),l.message)}})(n);const s=JSON.stringify(n),o=window.btoa(s);window.localStorage.setItem("websdk_ng_global_parameter",o),R.debug("Caching global parameters ".concat(s))}catch(i){R.error("Error caching global parameters:",i.message)}}handleGlobalParameterConfig(t){try{const n=Date.now();Object.keys(t).forEach((r=>{if(r==="CLIENT_ROLE_OPTIONS"&&Object.prototype.hasOwnProperty.call(wn,r)){const{value:i,expires:s}=t[r];if(s&&s<=n)return;(function(o,c){try{return typeof o=="object"&&typeof c=="object"&&JSON.stringify(o)===JSON.stringify(c)}catch{return!1}})(wn[r],i)||(Ra[r]=i,wn[r]=i,this.emit(qE.UPDATE_CLIENT_ROLE_OPTIONS,i),R.debug("Updating client role options: ".concat(JSON.stringify(i))))}}))}catch(n){R.error("Error handling global parameter config:",n.message)}}}class N9 extends Pn{constructor(){super(...arguments),k(this,"resultStorage",new Map)}setLocalAudioStats(t,n,r){this.record("AUDIO_INPUT_LEVEL_TOO_LOW",t,this.checkAudioInputLevel(r,n)),this.record("SEND_AUDIO_BITRATE_TOO_LOW",t,this.checkSendAudioBitrate(r,n))}setLocalVideoStats(t,n,r){this.record("SEND_VIDEO_BITRATE_TOO_LOW",t,this.checkSendVideoBitrate(r,n)),this.record("FRAMERATE_INPUT_TOO_LOW",t,this.checkFramerateInput(r,n)),this.record("FRAMERATE_SENT_TOO_LOW",t,this.checkFramerateSent(r)),!n.muted&&this.record("VIDEO_ENCODE_FAILED",t,this.checResolutionSent(r))}setRemoteAudioStats(t,n){const r=t.getUserId();this.record("AUDIO_OUTPUT_LEVEL_TOO_LOW",r,this.checkAudioOutputLevel(n))}setRemoteVideoStats(t,n){const r=t.getUserId();this.record("RECV_VIDEO_DECODE_FAILED",r,this.checkVideoDecode(n))}record(t,n,r){if(F("STATS_UPDATE_INTERVAL")>500)return;this.resultStorage.has(t)||this.resultStorage.set(t,{result:[],isPrevNormal:!0});const i=this.resultStorage.get(t);if(!i)return;i.result.push(r);const s=t==="VIDEO_ENCODE_FAILED"?F("ENCODE_EXCEPTION_TIMES"):5;if(i.result.length>=s){var o;const c=Re(o=i.result).call(o,!0);i.isPrevNormal&&!c&&this.emit("exception",aI[t],t,n),!i.isPrevNormal&&c&&this.emit("exception",aI[t]+2e3,t+"_RECOVER",n),i.isPrevNormal=c,i.result=[]}}checkAudioOutputLevel(t){return!(t.receiveBitrate>0&&t.receiveLevel===0)}checkAudioInputLevel(t,n){return n instanceof ar&&!n.isActive||!!n.muted||t.sendVolumeLevel!==0}checkFramerateInput(t,n){let r=null;n._encoderConfig&&n._encoderConfig.frameRate&&(r=Es(n._encoderConfig.frameRate));const i=t.captureFrameRate;return!r||!i||!(r>10&&i<5||r<10&&r>=5&&i<=1)}checkFramerateSent(t){return!(t.captureFrameRate&&t.sendFrameRate&&t.captureFrameRate>5&&t.sendFrameRate<=1)}checResolutionSent(t){var n;return!(!t.codecType||Re(n=F("ENCODE_EXCEPTION_VALIDATE_CODEC")).call(n,t.codecType.toLocaleLowerCase()))||!t.captureFrameRate||t.sendFrameRate!==0||t.sendResolutionWidth!==0||t.sendResolutionHeight!==0}checkSendVideoBitrate(t,n){return!!n.muted||t.sendBitrate!==0}checkSendAudioBitrate(t,n){return n instanceof ar&&!n.isActive||!!n.muted||t.sendBitrate!==0}checkVideoDecode(t){return t.receiveBitrate===0||t.decodeFrameRate!==0}}const aI={FRAMERATE_INPUT_TOO_LOW:1001,FRAMERATE_SENT_TOO_LOW:1002,SEND_VIDEO_BITRATE_TOO_LOW:1003,RECV_VIDEO_DECODE_FAILED:1005,AUDIO_INPUT_LEVEL_TOO_LOW:2001,AUDIO_OUTPUT_LEVEL_TOO_LOW:2002,SEND_AUDIO_BITRATE_TOO_LOW:2003,VIDEO_ENCODE_FAILED:2004},Qr=new class{markSubscribeStart(e,t){performance.mark("agora-web-sdk/".concat(e,"/subscribe-").concat(t))}markPublishStart(e,t){performance.mark("agora-web-sdk/".concat(e,"/publish-").concat(t))}measureFromSubscribeStart(e,t){const n=performance.getEntriesByName("agora-web-sdk/".concat(e,"/subscribe-").concat(t));if(n.length>0){const r=n[n.length-1];return Math.round(performance.now()-r.startTime)}return 0}measureFromPublishStart(e,t){const n=performance.getEntriesByName("agora-web-sdk/".concat(e,"/publish-").concat(t));if(n.length>0){const r=n[n.length-1];return Math.round(performance.now()-r.startTime)}return 0}};function R2(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable}))),n.push.apply(n,r)}return n}function bh(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?R2(Object(n),!0).forEach((function(r){k(e,r,n[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):R2(Object(n)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))}))}return e}class rg{constructor(t){k(this,"store",void 0),k(this,"onStatsException",void 0),k(this,"onUploadPublishDuration",void 0),k(this,"onStatsChanged",void 0),k(this,"onVideoCodecChanged",void 0),k(this,"localStats",new Map),k(this,"remoteStats",new Map),k(this,"updateStatsInterval",void 0),k(this,"trafficStats",void 0),k(this,"trafficStatsPeerList",[]),k(this,"uplinkStats",void 0),k(this,"exceptionMonitor",void 0),k(this,"p2pChannel",void 0),k(this,"scalabilityMode",kS.L1T1),k(this,"updateStats",(()=>{this.p2pChannel&&(this.updateRemoteStats(this.p2pChannel),this.updateLocalStats(this.p2pChannel))})),this.store=t,this.exceptionMonitor=new N9,this.exceptionMonitor.on("exception",((n,r,i)=>{this.onStatsException&&this.onStatsException(n,r,i)}))}startUpdateStats(){this.updateStatsInterval||(this.updateStatsInterval=window.setInterval(this.updateStats,1e3))}stopUpdateStats(){this.updateStatsInterval&&(window.clearInterval(this.updateStatsInterval),this.updateStatsInterval=void 0)}reset(){this.localStats=new Map,this.remoteStats=new Map,this.trafficStats=void 0,this.trafficStatsPeerList=[],this.uplinkStats=void 0}getLocalAudioTrackStats(){return this.localStats.get(Ee.LocalAudioTrack)||bh({},mb)}getLocalVideoTrackStats(){return this.localStats.get(Ee.LocalVideoTrack)||bh({},_b)}getRemoteAudioTrackStats(t){const n=(s,o)=>{if(!this.trafficStats)return o;const c=this.trafficStats.peer_delay.find((l=>l.peer_uid===s));return c&&(o.publishDuration=c.B_ppad+(Date.now()-this.trafficStats.timestamp)),o},r={};if(t){var i;const s=(i=this.remoteStats.get(t))===null||i===void 0?void 0:i.audioStats;s&&(r[t]=n(t,s))}else Array.from(this.remoteStats.entries()).forEach((s=>{let[o,{audioStats:c}]=s;c&&(r[o]=n(o,c))}));return r}getRemoteNetworkQualityStats(t){const n={};if(t){var r;const i=(r=this.remoteStats.get(t))===null||r===void 0?void 0:r.networkStats;i&&(n[t]=i)}else Array.from(this.remoteStats.entries()).forEach((i=>{let[s,{networkStats:o}]=i;o&&(n[s]=o)}));return n}getRemoteVideoTrackStats(t){const n=(s,o)=>{if(!this.trafficStats)return o;const c=this.trafficStats.peer_delay.find((l=>l.peer_uid===s));return c&&(o.publishDuration=c.B_ppvd+(Date.now()-this.trafficStats.timestamp)),o},r={};if(t){var i;const s=(i=this.remoteStats.get(t))===null||i===void 0?void 0:i.videoStats;s&&(r[t]=n(t,s))}else Array.from(this.remoteStats.entries()).forEach((s=>{let[o,{videoStats:c}]=s;c&&(r[o]=n(o,c))}));return r}getRTCStats(){let t=0,n=0,r=0,i=0;const s=this.localStats.get(Ee.LocalAudioTrack);s&&(t+=s.sendBytes,n+=s.sendBitrate);const o=this.localStats.get(Ee.LocalVideoTrack);o&&(t+=o.sendBytes,n+=o.sendBitrate);const c=this.localStats.get(Ee.LocalVideoLowTrack);c&&(t+=c.sendBytes,n+=c.sendBitrate),this.remoteStats.forEach((h=>{let{audioStats:p,videoStats:E}=h;p&&(r+=p.receiveBytes,i+=p.receiveBitrate),E&&(r+=E.receiveBytes,i+=E.receiveBitrate)}));let l=1;return this.trafficStats&&(l+=this.trafficStats.peer_delay.length),{Duration:0,UserCount:l,SendBitrate:n,SendBytes:t,RecvBytes:r,RecvBitrate:i,OutgoingAvailableBandwidth:this.uplinkStats?this.uplinkStats.B_uab/1e3:0,RTT:this.trafficStats?2*this.trafficStats.B_acd:0}}addLocalStats(t){this.localStats.set(t,void 0)}removeLocalStats(t){t?this.localStats.delete(t):this.localStats.clear()}addRemoteStats(t){this.remoteStats.set(t,{})}removeRemoteStats(t){t?this.remoteStats.delete(t):this.remoteStats.clear()}addP2PChannel(t){this.p2pChannel=t}updateTrafficStats(t){t.peer_delay=t.peer_delay.filter((n=>n.B_ppad!==void 0||n.B_ppvd!==void 0)),t.peer_delay.filter((n=>this.trafficStatsPeerList.indexOf(n.peer_uid)===-1)).forEach((n=>{var r;const i=(r=this.p2pChannel)===null||r===void 0?void 0:r.getRemoteMedia(n.peer_uid),s=i!=null&&i.videoSSRC?Qr.measureFromSubscribeStart(this.store.clientId,i.videoSSRC):0,o=i!=null&&i.audioSSRC?Qr.measureFromSubscribeStart(this.store.clientId,i.audioSSRC):0;n.B_ppad!==void 0&&n.B_ppvd!==void 0&&(this.onUploadPublishDuration&&this.onUploadPublishDuration(n.peer_uid,n.B_ppad,n.B_ppvd,s>o?s:o),this.trafficStatsPeerList.push(n.peer_uid))})),this.trafficStats=t}updateUplinkStats(t){this.uplinkStats&&this.uplinkStats.B_fir!==t.B_fir&&R.debug("[".concat(this.store.clientId,"]: Period fir changes to ").concat(t.B_fir)),this.uplinkStats=t}static isRemoteVideoFreeze(t,n,r){if(!t)return!1;const i=!!r&&n.framesDecodeFreezeTime>r.framesDecodeFreezeTime,s=!r||n.framesDecodeCount>r.framesDecodeCount;return i||!s}static isRemoteAudioFreeze(t){return!!t&&t._isFreeze()}isLocalVideoFreeze(t){return!(!t.inputFrame||!t.sentFrame)&&t.inputFrame.frameRate>5&&t.sentFrame.frameRate<3}updateLocalStats(t){Array.from(this.localStats.entries()).forEach((n=>{let[r,i]=n;switch(r){case Ee.LocalVideoTrack:case Ee.LocalVideoLowTrack:{const c=i,l=bh({},_b),h=t.getStats(),p=t.getLocalMedia(r);if(h){const E=h.videoSend.find((g=>g.ssrc===p?.ssrcs[0].ssrcId));if(E){const g=t.getLocalVideoSize(),v=t.getEncoderConfig(Ee.LocalVideoTrack);var s;(E.codec==="H264"||E.codec==="H265"||E.codec==="VP8"||E.codec==="VP9"||E.codec==="AV1X"||E.codec==="AV1")&&(l.codecType=E.codec,c?.codecType!==E.codec&&((s=this.onVideoCodecChanged)===null||s===void 0||s.call(this,E.codec.toLocaleLowerCase()))),l.sendBytes=E.bytes,l.sendBitrate=c?8*Math.max(0,l.sendBytes-c.sendBytes):0,E.inputFrame?(l.captureFrameRate=E.inputFrame.frameRate,l.captureResolutionHeight=E.inputFrame.height,l.captureResolutionWidth=E.inputFrame.width):g&&(l.captureResolutionWidth=g.width,l.captureResolutionHeight=g.height),E.sentFrame?(l.sendFrameRate=E.sentFrame.frameRate,l.sendResolutionHeight=E.sentFrame.height,l.sendResolutionWidth=E.sentFrame.width):g&&(l.sendResolutionWidth=g.width,l.sendResolutionHeight=g.height),E.avgEncodeMs&&(l.encodeDelay=E.avgEncodeMs),v&&v.bitrateMax?l.targetSendBitrate=1e3*v.bitrateMax:E.targetBitrate&&(l.targetSendBitrate=E.targetBitrate),l.sendPackets=E.packets,l.sendPacketsLost=E.packetsLost,l.sendJitterMs=E.jitterMs,l.sendRttMs=E.rttMs,l.totalDuration=c?c.totalDuration+1:1,l.totalFreezeTime=c?c.totalFreezeTime:0,this.isLocalVideoFreeze(E)&&(l.totalFreezeTime+=1),E.scalabilityMode&&this.scalabilityMode!==E.scalabilityMode&&(R.debug("[".concat(this.store.clientId,"]: The scalabilityMode of the video sending stream is ").concat(E.scalabilityMode)),this.scalabilityMode=E.scalabilityMode)}this.trafficStats&&(l.currentPacketLossRate=(this.trafficStats.B_pvlr4||0)/100)}var o;this.localStats.set(r,l),(c?.sendResolutionWidth!==l.sendResolutionWidth||c?.sendResolutionHeight!==l.sendResolutionHeight)&&((o=this.onStatsChanged)===null||o===void 0||o.call(this,"resolution",{width:l.sendResolutionWidth,height:l.sendResolutionHeight})),l&&p&&this.exceptionMonitor.setLocalVideoStats(this.store.uid,p.track,l);break}case Ee.LocalAudioTrack:{const c=i,l=bh({},mb),h=t.getStats(),p=t.getLocalMedia(r);if(h){const E=h.audioSend.find((g=>g.ssrc===p?.ssrcs[0].ssrcId));if(E){if(E.codec!=="opus"&&E.codec!=="aac"&&E.codec!=="PCMU"&&E.codec!=="PCMA"&&E.codec!=="G722"||(l.codecType=E.codec),E.inputLevel)l.sendVolumeLevel=Math.round(32767*E.inputLevel);else{const g=t.getLocalAudioVolume();g&&(l.sendVolumeLevel=Math.round(32767*g))}l.sendBytes=E.bytes,l.sendPackets=E.packets,l.sendPacketsLost=E.packetsLost,l.sendJitterMs=E.jitterMs,l.sendRttMs=E.rttMs,l.sendBitrate=c?8*Math.max(0,l.sendBytes-c.sendBytes):0}}this.trafficStats&&(l.currentPacketLossRate=(this.trafficStats.B_palr4||0)/100),this.localStats.set(Ee.LocalAudioTrack,l),l&&p&&this.exceptionMonitor.setLocalAudioStats(this.store.uid,p.track,l);break}}}))}updateRemoteStats(t){Array.from(this.remoteStats.entries()).forEach((n=>{var r,i;let[s,{videoStats:o,audioStats:c,videoPcStats:l}]=n;const h=c,p=o,E=l,g=bh({},mL),v=bh({},_L),O=bh({},hY),{audioTrack:I,videoTrack:N,audioSSRC:M,videoSSRC:x}=t.getRemoteMedia(s);let B;B=this.store.useP2P?t.getStats(!0):t.getStats();const Z=(r=B)===null||r===void 0?void 0:r.audioRecv.find((de=>de.ssrc===M)),Q=(i=B)===null||i===void 0?void 0:i.videoRecv.find((de=>de.ssrc===x)),z=this.trafficStats&&this.trafficStats.peer_delay.find((de=>de.peer_uid===s));if(Z&&(Z.codec!=="opus"&&Z.codec!=="aac"&&Z.codec!=="PCMU"&&Z.codec!=="PCMA"&&Z.codec!=="G722"||(g.codecType=Z.codec),Z.outputLevel?g.receiveLevel=Math.round(32767*Z.outputLevel):I&&(g.receiveLevel=Math.round(32767*I.getVolumeLevel())),g.receiveBytes=Z.bytes,g.receivePackets=Z.packets,g.receivePacketsLost=Z.packetsLost,g.receivePacketsDiscarded=Z.packetsDiscarded,g.packetLossRate=g.receivePacketsLost/(g.receivePackets+g.receivePacketsLost),g.receiveBitrate=h?8*Math.max(0,g.receiveBytes-h.receiveBytes):0,g.totalDuration=h?h.totalDuration+1:1,g.totalFreezeTime=h?h.totalFreezeTime:0,g.freezeRate=g.totalFreezeTime/g.totalDuration,g.receiveDelay=Z.jitterBufferMs,g.totalDuration>10&&rg.isRemoteAudioFreeze(I)&&(g.totalFreezeTime+=1)),Q){var te;Q.codec!=="H264"&&Q.codec!=="H265"&&Q.codec!=="VP8"&&Q.codec!=="VP9"&&Q.codec!=="AV1X"&&Q.codec!=="AV1"||(v.codecType=Q.codec),v.receiveBytes=Q.bytes,v.receiveBitrate=p?8*Math.max(0,v.receiveBytes-p.receiveBytes):0,v.decodeFrameRate=Q.decodeFrameRate<0?0:Q.decodeFrameRate,v.renderFrameRate=Q.decodeFrameRate<0?0:Q.decodeFrameRate,Q.outputFrame&&(v.renderFrameRate=Q.outputFrame.frameRate),Q.receivedFrame?(v.receiveFrameRate=Q.receivedFrame.frameRate,v.receiveResolutionHeight=Q.receivedFrame.height,v.receiveResolutionWidth=Q.receivedFrame.width):N&&(v.receiveResolutionHeight=N._videoHeight||0,v.receiveResolutionWidth=N._videoWidth||0),Q.framesRateFirefox!==void 0&&(v.receiveFrameRate=Math.round(Q.framesRateFirefox)),v.receivePackets=Q.packets,v.receivePacketsLost=Q.packetsLost,v.packetLossRate=v.receivePacketsLost/(v.receivePackets+v.receivePacketsLost);const de=p?p.totalFreezeTime:0,me=p?p.totalDuration:0;v.totalDuration=p?p.totalDuration+1:1,v.totalFreezeTime=(te=Q.totalFreezesDuration)!==null&&te!==void 0?te:de||0,v.receiveDelay=Q.jitterBufferMs||0;const ve=!!x&&t.getRemoteVideoIsReady(x);Q.totalFreezesDuration===void 0&&N&&ve&&rg.isRemoteVideoFreeze(N,Q,E)&&(v.totalFreezeTime+=1),v.freezeRate=Math.max(0,Math.min((v.totalFreezeTime-de)/(v.totalDuration-me),1))}z&&(g.end2EndDelay=z.B_ad,v.end2EndDelay=z.B_vd,g.transportDelay=z.B_ed,v.transportDelay=z.B_ed,g.currentPacketLossRate=z.B_ealr4/100,v.currentPacketLossRate=z.B_evlr4/100,O.uplinkNetworkQuality=z.B_punq?z.B_punq:0,O.downlinkNetworkQuality=z.B_pdnq?z.B_pdnq:0),this.remoteStats.set(s,{audioStats:g,videoStats:v,videoPcStats:Q,networkStats:O}),I&&this.exceptionMonitor.setRemoteAudioStats(I,g),N&&this.exceptionMonitor.setRemoteVideoStats(N,v)}))}}class C2{constructor(){k(this,"destChannelMediaInfos",new Map),k(this,"srcChannelMediaInfo",void 0)}setSrcChannelInfo(t){DM(t),this.srcChannelMediaInfo=t}addDestChannelInfo(t){DM(t),this.destChannelMediaInfos.set(t.channelName,t)}removeDestChannelInfo(t){$S(t),this.destChannelMediaInfos.delete(t)}getSrcChannelMediaInfo(){return this.srcChannelMediaInfo}getDestChannelMediaInfo(){return this.destChannelMediaInfos}}function w2(e){if(!(e instanceof C2))return new se(U.INVALID_PARAMS,"Config should be instance of [ChannelMediaRelayConfiguration]").throw();const t=e.getSrcChannelMediaInfo(),n=e.getDestChannelMediaInfo();if(!t)return new se(U.INVALID_PARAMS,"srcChannelMediaInfo should not be empty").throw();if(n.size===0)return new se(U.INVALID_PARAMS,"destChannelMediaInfo should not be empty").throw()}class Ud{get hasVideo(){return this._video_enabled_&&!this._video_muted_&&this._video_added_}get hasAudio(){return this._audio_enabled_&&!this._audio_muted_&&this._audio_added_}get audioTrack(){if(this.hasAudio||this._audio_pre_subscribed)return this._audioTrack}get videoTrack(){if(this.hasVideo||this._video_pre_subscribed)return this._videoTrack}get dataChannels(){return this._dataChannels}constructor(t,n){k(this,"uid",void 0),k(this,"_uintid",void 0),k(this,"_trust_in_room_",!0),k(this,"_trust_audio_enabled_state_",!0),k(this,"_trust_video_enabled_state_",!0),k(this,"_trust_audio_mute_state_",!0),k(this,"_trust_video_mute_state_",!0),k(this,"_audio_muted_",!1),k(this,"_video_muted_",!1),k(this,"_audio_enabled_",!0),k(this,"_video_enabled_",!0),k(this,"_audio_added_",!1),k(this,"_video_added_",!1),k(this,"_is_pre_created",!1),k(this,"_video_pre_subscribed",!1),k(this,"_audio_pre_subscribed",!1),k(this,"_trust_video_stream_added_state_",!0),k(this,"_trust_audio_stream_added_state_",!0),k(this,"_audioTrack",void 0),k(this,"_videoTrack",void 0),k(this,"_dataChannels",[]),k(this,"_audioSSRC",void 0),k(this,"_videoSSRC",void 0),k(this,"_audioOrtc",void 0),k(this,"_videoOrtc",void 0),k(this,"_cname",void 0),k(this,"_rtxSsrcId",void 0),k(this,"_videoMid",void 0),k(this,"_audioMid",void 0),this.uid=t,this._uintid=n}}function b2(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable}))),n.push.apply(n,r)}return n}function cI(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?b2(Object(n),!0).forEach((function(r){k(e,r,n[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):b2(Object(n)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))}))}return e}const fT="9",lI=2e4,mT=4e4;function I2(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable}))),n.push.apply(n,r)}return n}function Sl(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?I2(Object(n),!0).forEach((function(r){k(e,r,n[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):I2(Object(n)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))}))}return e}var Xf=(function(e){return e[e.DOWN=0]="DOWN",e[e.UP=1]="UP",e})(Xf||{});const _T=new Map;function A2(e,t,n,r){let{scale:i}=e;if(i===0&&r===Xf.UP||i>=t.length-1&&r===Xf.DOWN)return e;let s=Sl(Sl({},e),{},{scale:r===Xf.DOWN?++i:--i});switch(n){case"maintain-framerate":s=Sl(Sl({},s),t[i].motion);break;case"maintain-resolution":s=Sl(Sl({},s),t[i].detail);break;case"balanced":s=Sl(Sl({},s),t[i].balanced)}return s}function N2(e,t){if(t){const n={overUse:0,underUse:0,adaptationList:O2(t)};_T.set(e,n)}else _T.delete(e)}function O2(e){const t=Sl({},e),{bitrateMax:n,frameRate:r,scaleResolutionDownBy:i,bitrateMin:s}=t,{MIN_FRAME_RATE:o,MAX_THRESHOLD_FRAMERATE:c,MAX_SCALE:l,BITRATE_MIN_THRESHOLD:h,BITRATE_MAX_THRESHOLD:p,BWE_SCALE_UP_THRESHOLD:E,BWE_SCALE_DOWN_THRESHOLD:g,PERF_SCALE_DOWN_THRESHOLD:v,PERF_SCALE_UP_THRESHOLD:O,BALANCE_BITRATE_FACTOR:I,BALANCE_FRAMERATE_FACTOR:N,BALANCE_RESOLUTION_FACTOR:M,MOTION_RESOLUTION_FACTOR:x,MOTION_BITRATE_FACTOR:B,DETAIL_FRAMERATE_FACTOR:Z,DETAIL_BITRATE_FACTOR:Q}=ab,z=Math.min(t.frameRate,c),te=[{scale:0,threshold:{bwe_down:Math.round(Math.pow(g,1)*n),bwe_up:n,fps_down:Math.round(Math.pow(v,1)*z),fps_up:r},balanced:{scaleResolutionDownBy:1,frameRate:r,bitrateMax:n,bitrateMin:s},motion:{scaleResolutionDownBy:1,frameRate:r,bitrateMax:n,bitrateMin:s},detail:{scaleResolutionDownBy:1,frameRate:r,bitrateMax:n,bitrateMin:s}}];for(let de=1;de<=l;de++){const me={bwe_up:Math.round(Math.pow(E,de)*n),bwe_down:Math.round(Math.pow(g,de+1)*n),fps_up:Math.round(Math.pow(O,de)*z),fps_down:Math.round(Math.pow(v,de+1)*z)},ve={scaleResolutionDownBy:i/Math.pow(M,de),frameRate:Math.max(Math.round(Math.pow(N,de)*r),o),bitrateMax:Math.max(Math.round(Math.pow(I,de)*n),p),bitrateMin:Math.max(Math.round(Math.pow(I,de)*s),h)},St={scaleResolutionDownBy:i/Math.pow(x,de),frameRate:r,bitrateMax:Math.max(Math.round(Math.pow(B,de)*n),p),bitrateMin:Math.max(Math.round(Math.pow(B,de)*s),h)},wt={scaleResolutionDownBy:1,frameRate:Math.max(Math.round(Math.pow(Z,de)*r),o),bitrateMax:Math.max(Math.round(Math.pow(Q,de)*n),p),bitrateMin:Math.max(Math.round(Math.pow(Q,de)*s),h)};te.push({scale:de,threshold:me,balanced:ve,motion:St,detail:wt})}return te}function O9(e,t,n,r,i,s){const o=_T.get(e)||{overUse:0,underUse:0,adaptationList:O2(i)},{adaptationList:c}=o;_T.set(e,o);const{OVERUSE_TIMES_THRESHOLD:l,UNDERUSE_TIMES_THRESHOLD:h}=ab,{scale:p}=r;let E,g;return typeof t=="number"&&t>0&&(function(v,O,I,N){if(O>=I.length)return!1;let{threshold:{fps_down:M}}=I[O];return F("FORCE_AG_HIGH_FRAMERATE")&&N==="maintain-framerate"&&(M=I[0].threshold.fps_down),v<M})(t,p,c,s)&&(o.overUse++,g=FE.CPU,o.overUse>l)||typeof n=="number"&&n>0&&(function(v,O,I){if(O>=I.length)return!1;const{threshold:{bwe_down:N}}=I[O];return v<N})(n,p,c)&&(o.overUse++,g=FE.BANDWIDTH,o.overUse>l)?(o.overUse=0,o.underUse=0,E=A2(r,c,s,Xf.DOWN),[E,g]):(typeof t=="number"&&t>0&&typeof n=="number"&&n>0&&(function(v,O,I,N){if(O===0)return;let{threshold:{fps_up:M}}=I[O];return F("FORCE_AG_HIGH_FRAMERATE")&&N==="maintain-framerate"&&(M=I[1].threshold.fps_up),v>M})(t,p,c,s)&&(function(v,O,I){if(O===0)return;const{threshold:{bwe_up:N}}=I[O];return v>N})(n,p,c)&&(o.underUse++,o.underUse>h&&(o.overUse=0,o.underUse=0,E=A2(r,c,s,Xf.UP),E.scale===0&&(g=FE.NONE))),[E,g])}function P2(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable}))),n.push.apply(n,r)}return n}function dI(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?P2(Object(n),!0).forEach((function(r){k(e,r,n[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):P2(Object(n)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))}))}return e}const ET=new Map;function gT(e,t){const n=ET.get(e);if(n){const{timer:r}=n;window.clearTimeout(r),ET.delete(e)}t.qualityLimitationReason=FE.NONE,N2(e)}function P9(e,t){var n;let r;switch(t){case Ee.LocalAudioTrack:r=en.Audio;break;case Ee.LocalVideoTrack:r=Re(n=e._hints).call(n,an.SCREEN_TRACK)?en.Screen:en.High;break;case Ee.LocalVideoLowTrack:r=en.Low}return r}function uI(e){const t=Ft();if(e.some((n=>n._bypassWebAudio)))throw new ce(U.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");if(!t.webAudioMediaStreamDest)throw new ce(U.NOT_SUPPORTED,"cannot publish multiple tracks because your browser does not support audio mixing")}function hI(e,t){uI(e);const n=new ar;return e.forEach((r=>n.addAudioTrack(r))),n}const D9=!Ft().supportUnifiedPlan||F("CHROME_FORCE_PLAN_B")&&ml();function vT(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var n;return D9?(n={spec:t,store:e},yl("PlanBConnection").create(n)):new oo(t,e)}function pI(e){return e&&(e.iceConnectionState==="disconnected"||e.iceConnectionState==="checking"||e.iceConnectionState==="failed")}function D2(e){try{if(e.iceServers)return!1;if(e.turnServer&&e.turnServer.mode!=="off"){if(UE(e.turnServer.servers))return!1;if(F("FORCE_TURN_TCP")||e.turnServer.servers.concat(e.turnServer.serversFromGateway||[]).some((t=>t.forceturn)))return!0}return!1}catch{return!1}}var Mt;function k2(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable}))),n.push.apply(n,r)}return n}function Aa(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?k2(Object(n),!0).forEach((function(r){k(e,r,n[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):k2(Object(n)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))}))}return e}let oo=(Mt=class Fh extends MM{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var t,n;return(t=(n=this.peerConnection.getReceivers()[0])===null||n===void 0||(n=n.transport)===null||n===void 0?void 0:n.state)!==null&&t!==void 0?t:null}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.send.videoCodecs.map((t=>t.rtpMap&&t.rtpMap.encodingName.toLowerCase()||"")).filter((t=>{var n;return Re(n=Object.keys(WE)).call(n,t)})))]}constructor(t,n){super(t,n),k(this,"id",ln(5,"connection-")),k(this,"store",void 0),k(this,"peerConnection",void 0),k(this,"forceTurn",!1),k(this,"remoteSDP",void 0),k(this,"initialOffer",void 0),k(this,"transportEventReceiver",void 0),k(this,"statsFilter",void 0),k(this,"extension",{useXR:F("USE_XR")}),k(this,"localCapabilities",void 0),k(this,"remoteCodecs",void 0),k(this,"localCandidateCount",0),k(this,"allCandidatesReceived",!1),k(this,"isPreallocation",!1),k(this,"preMediaMap",new Map),k(this,"dataStreamChannelMap",new Map),k(this,"establishPromise",void 0),k(this,"recoveredDataChannelIds",[]),k(this,"currentDataChannelId",1),k(this,"supportAV1RtpSpec",!1),k(this,"mutex",void 0),k(this,"qualityLimitationReason",FE.NONE),k(this,"isFirstConnected",!1),this.store=n,this.forceTurn=D2(t),this.mutex=new Yr("P2PConnection-mutex",n.clientId),this.peerConnection=new RTCPeerConnection(Fh.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.isFirstConnected=!1,this.statsFilter=ib(this.peerConnection,F("STATS_UPDATE_INTERVAL"),void 0,xn()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,t.isPreallocation&&(this.isPreallocation=!0),this.establishPromise=this.establish()}getPreMedia(t){return this.preMediaMap.get(t)}isPreSub(){return this.preMediaMap.size>0}async updateRemoteRTPCapabilities(t,n){if(this.remoteCodecs=n,!this.remoteSDP)return void R.debug("[P2PConnection] cannot updateRemoteRTPCapabilities before remote SDP created, local codecs: ".concat(this.localCodecs,", codecs: ").concat(n));if(this.remoteSDP.updateRemoteCodec(t,n,this.store.codec)){const r=await this.peerConnection.createOffer(),i=this.logSDPExchange(r.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(r);const s=this.remoteSDP.toString();i?.(s),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}else R.debug("[P2PConnection] updateRemoteRTPCapabilities no need to exchange SDP.")}async establish(){try{this.peerConnection.addTransceiver("video",{direction:"recvonly"}),this.peerConnection.addTransceiver("audio",{direction:"recvonly"});const r=await this.peerConnection.createOffer();if(!r.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const i=kd(r.sdp),s=await t2({filterRTX:!F("USE_PUB_RTX")&&!F("USE_SUB_RTX"),filterVideoFec:F("FILTER_VIDEO_FEC"),filterAudioFec:F("FILTER_AUDIO_FEC"),filterVideoCodec:F("FILTER_VIDEO_CODEC"),unsupportedVideoUplinkCodec:F("UNSUPPORTED_VIDEO_UPLINK_CODEC"),unsupportedVideoDownlinkCodec:F("UNSUPPORTED_VIDEO_DOWNLINK_CODEC")},this.extension);if(this.localCapabilities=lT(s),this.initialOffer=r,F("ENABLE_SVC")&&this.store.codec=="av1"){const c=await(async function(){try{const l=new RTCPeerConnection;l.addTransceiver("video",{direction:"sendonly",sendEncodings:[{scalabilityMode:kS.L1T3}]});const h=await l.createOffer();if(!h.sdp)return void l.close();const p=Zi(h.sdp).mediaDescriptions[0];if(!p)return;const E=p.attributes.extmaps.find((g=>g.extensionName==="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension"));return l.close(),E}catch{return}})();var t;c&&(this.supportAV1RtpSpec=!0,(t=s.send)===null||t===void 0||t.videoExtensions.push(c))}let o;return r.sdp&&s2(r.sdp)&&(o=An(s),(n=o).send&&(Hf(Le.VIDEO,n.send.videoExtensions),Hf(Le.AUDIO,n.send.audioExtensions)),n.recv&&(Hf(Le.VIDEO,n.recv.videoExtensions),Hf(Le.AUDIO,n.recv.audioExtensions)),n.sendrecv&&(Hf(Le.VIDEO,n.sendrecv.videoExtensions),Hf(Le.AUDIO,n.sendrecv.audioExtensions))),Aa(Aa({},i),{},{rtpCapabilities:o||s,offerSDP:r.sdp})}catch(r){throw new ce(U.GET_LOCAL_CONNECTION_PARAMS_FAILED,r.toString())}var n}async connect(t){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.initialOffer.sdp&&s2(this.initialOffer.sdp)&&(n=t.rtpCapabilities,r=this.localCapabilities,n.send&&(oT(Le.VIDEO,n.send.videoExtensions,r.send.videoExtensions),oT(Le.AUDIO,n.send.audioExtensions,r.send.audioExtensions)),n.recv&&(oT(Le.VIDEO,n.recv.videoExtensions,r.recv.videoExtensions),oT(Le.AUDIO,n.recv.audioExtensions,r.recv.audioExtensions))),this.remoteSDP=new class{get localCapabilities(){return An(this._localCapabilities)}get rtpCapabilities(){return An(this._rtpCapabilities)}get candidates(){return An(this._candidates)}get iceParameters(){return An(this._iceParameters)}get dtlsParameters(){return An(this._dtlsParameters)}constructor(l){let h=arguments.length>1&&arguments[1]!==void 0&&arguments[1],p=arguments.length>2&&arguments[2]!==void 0&&arguments[2];k(this,"sessionDesc",void 0),k(this,"_localCapabilities",void 0),k(this,"_rtpCapabilities",void 0),k(this,"_candidates",void 0),k(this,"_originCandidates",void 0),k(this,"_iceParameters",void 0),k(this,"_isUseExtmapAllowMixed",void 0),k(this,"_isUseLocalCodecs",void 0),k(this,"_dtlsParameters",void 0),k(this,"setup",void 0),k(this,"currentMidIndex",void 0),k(this,"cname",void 0),k(this,"useLocalCodecsMids",[]),k(this,"preloadSsrcs",[]),k(this,"firefoxSsrcMidMap",new Map),this._isUseExtmapAllowMixed=h,this._isUseLocalCodecs=p,l=An(l);const{iceParameters:E,dtlsParameters:g,candidates:v,rtpCapabilities:O,setup:I,localCapabilities:N,cname:M}=l;this._rtpCapabilities=O,this._candidates=v,this._originCandidates=An(v),this._iceParameters=E,this._dtlsParameters=g,this._localCapabilities=N,this.setup=I,this.cname=M,[this.sessionDesc]=this.updateRemoteRTPCapabilities(O),this.currentMidIndex=this.sessionDesc.mediaDescriptions.length-1}checkPreloadSsrcs(l){return l.length===this.preloadSsrcs.length&&l.every((h=>{var p;return Re(p=this.preloadSsrcs).call(p,h)}))}preloadRemoteMedia(l){let h=0;const p=[],E=[];for(;l>0;){const g=[cI({ssrcId:mT+h},F("USE_SUB_RTX")?{rtx:mT+h+1}:{})],v="".concat(mT+h,"_").concat(lI+h),{ssrcs:O,ssrcGroups:I}=$E(g,this.cname,F("SYNC_GROUP")?v:void 0),N=this.preCreateOrRecycleSendMedia("video",O,I,void 0),M=[{ssrcId:lI+h}],x="".concat(mT+h,"_").concat(lI+h),{ssrcs:B,ssrcGroups:Z}=$E(M,this.cname,F("SYNC_GROUP")?x:void 0),Q=this.preCreateOrRecycleSendMedia("audio",B,Z,void 0);l--,h+=2,p.push(N,Q),E.push(O[0].ssrcId,B[0].ssrcId)}return this.useLocalCodecsMids.push(...p),this.preloadSsrcs=E,{mids:p,preSSRCs:E,isAvailable:!0}}preCreateOrRecycleSendMedia(l,h,p,E){const g=this.rtpCapabilities.send.videoCodecs,v=this._isUseLocalCodecs||g.length===0?this.localCapabilities.recv:this.rtpCapabilities.send;R.debug("create or recycle send media without remote rtp capabilities, ssrcs ",h[0].ssrcId);const O=l===Le.VIDEO?v.videoCodecs:v.audioCodecs,I=l===Le.VIDEO?v.videoExtensions:v.audioExtensions;this.currentMidIndex+=1;const N="".concat(this.currentMidIndex);let M={media:{mediaType:l,port:fT,protos:["UDP","TLS","RTP","SAVPF"],fmts:O.map((x=>x.payloadType.toString(10)))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:I,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:h,ssrcGroups:p,rtcpFeedbackWildcards:[],payloads:O,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(N)}};return M=this.mungSendMediaDesc(M,E),this.sessionDesc.mediaDescriptions.push(M),this.updateBundleMids(),N}toString(){return Id(this.sessionDesc)}send(l,h,p,E){const{ssrcs:g,ssrcGroups:v}=$E(h,this.cname,F("SYNC_GROUP")?p:void 0),O=this.findPreloadMediaDesc(g);if(O){if(xn()&&this.firefoxSsrcMidMap.set(g[0].ssrcId,O.attributes.mid),E&&(E.twcc||E.remb)){const I=this.sessionDesc.mediaDescriptions.indexOf(O);return this.sessionDesc.mediaDescriptions[I]=this.mungSendMediaDesc(O,E),{mid:O.attributes.mid,needExchangeSDP:!0}}return{mid:O.attributes.mid,needExchangeSDP:!1}}{const I=this.findAvailableMediaIndex(l,g);let N;return I===-1||I===1&&(Vr()||(function(){const M=xt();return!(M.name!==Gt.CHROME||!M.osVersion)&&Number(M.version)<=90})()||F("ENABLE_ENCODED_TRANSFORM")&&fl())||I===0&&!(function(M){const x=xt();return!(x.name!==Gt.FIREFOX||!x.osVersion)&&Number(x.version)===M})(138)&&F("USE_SUB_RTX")||A1()?(N=this.createOrRecycleSendMedia(l,g,v,"sendonly",E),this.updateBundleMids()):(N=An(this.sessionDesc.mediaDescriptions[I]),N.attributes.direction="sendonly",N.attributes.ssrcs=g,N.attributes.ssrcGroups=v,this.sessionDesc.mediaDescriptions[I]=this.mungSendMediaDesc(N,E)),xn()&&this.firefoxSsrcMidMap.set(g[0].ssrcId,N.attributes.mid),{mid:N.attributes.mid,needExchangeSDP:!0}}}sendDataChannel(){const{mediaDesc:l,needExchangeSDP:h}=this.createOrRecycleDataChannel();return this.updateBundleMids(),{mid:l.attributes.mid,needExchangeSDP:h}}batchSend(l){const h=l.map((g=>{let{kind:v,ssrcMsg:O,mslabel:I}=g;return this.send(v,O,I)})),p=[];let E=!1;return h.forEach((g=>{let{mid:v,needExchangeSDP:O}=g;O&&(E=!0),p.push(v)})),{mids:p,needExchangeSDP:E}}stopSending(l){const h=this.sessionDesc.mediaDescriptions.filter((p=>p.attributes.mid&&l.indexOf(p.attributes.mid)!==-1));if(h.length!==l.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");h.forEach((p=>{p.attributes.mid==="0"||xn()||A1()?p.attributes.ssrcs=[]:(p.attributes.ssrcs=[],p.attributes.direction="inactive",p.media.port="0")})),this.updateBundleMids()}mute(l){const h=this.sessionDesc.mediaDescriptions.find((p=>p.attributes.mid===l));if(!h)throw new Error("mediaDescription not found with ".concat(l," in remote SDP when calling RemoteSDP.mute."));h.attributes.direction="inactive"}unmute(l){const h=this.sessionDesc.mediaDescriptions.find((p=>p.attributes.mid===l));if(!h)throw new Error("mediaDescription not found with ".concat(l," in remote SDP when calling RemoteSDP.unmute."));h.attributes.direction="sendonly"}muteRemote(l){const h=this.sessionDesc.mediaDescriptions.filter((p=>Re(l).call(l,p.attributes.mid||"")));if(h.length!==l.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");h.forEach((p=>{p.attributes.direction="inactive"}))}unmuteRemote(l){const h=this.sessionDesc.mediaDescriptions.filter((p=>Re(l).call(l,p.attributes.mid||"")));if(h.length!==l.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");h.forEach((p=>{p.attributes.direction="recvonly"}))}receive(l,h,p,E){l.forEach(((g,v)=>{this.createOrRecycleRecvMedia(g,[],"recvonly",h,p,E[v])})),this.updateBundleMids()}stopReceiving(l){const h=this.sessionDesc.mediaDescriptions.filter((p=>l.indexOf(p.attributes.mid)!==-1));if(h.length!==l.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");h.forEach((p=>{p.media.port="0",p.attributes.direction="inactive"})),this.updateBundleMids()}updateRemoteRTPCapabilities(l){const h=this.sessionDesc||Zi((p=this._isUseExtmapAllowMixed,`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=ice-lite`.concat(p?`
a=extmap-allow-mixed`:"",`
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`)));var p;this._rtpCapabilities=l;let E=!1;const g=this.rtpCapabilities.send,v=this.localCapabilities.send,O=this.localCapabilities.recv,I=O.videoCodecs,N=O.audioCodecs,M=O.videoExtensions,x=O.audioExtensions;for(const z of h.mediaDescriptions){var B;if(z.attributes.direction!=="sendonly"||typeof z.attributes.mid!="string"||!Re(B=this.useLocalCodecsMids).call(B,z.attributes.mid)){if(E=!0,z.attributes.iceUfrag=this._iceParameters.iceUfrag,z.attributes.icePwd=this._iceParameters.icePwd,z.attributes.fingerprints=this._dtlsParameters.fingerprints,z.attributes.candidates=this._candidates,z.attributes.setup=this.setup,z.media.mediaType==="application"&&(z.attributes.sctpPort="5000"),z.media.mediaType==="video")if(this._isUseLocalCodecs&&z.attributes.direction==="sendonly"){var Z;z.media.fmts=I.map((de=>de.payloadType.toString(10))),z.attributes.payloads=I,z.attributes.extmaps=M;const te=z.attributes.mid;typeof te!="string"||Re(Z=this.useLocalCodecsMids).call(Z,te)||this.useLocalCodecsMids.push(te)}else if(g.videoCodecs.length===0){const te=v.videoCodecs.filter((de=>{var me,ve;return(me=de.rtpMap)===null||me===void 0?void 0:Re(ve=me.encodingName.toLowerCase()).call(ve,"vp8")}))||[v.videoCodecs[0]];z.media.fmts=te.map((de=>de.payloadType.toString(10))),z.attributes.payloads=te,z.attributes.extmaps=[]}else z.media.fmts=g.videoCodecs.map((te=>te.payloadType.toString(10))),z.attributes.payloads=g.videoCodecs,z.attributes.extmaps=g.videoExtensions;if(z.media.mediaType==="audio")if(this._isUseLocalCodecs&&z.attributes.direction==="sendonly"){var Q;z.media.fmts=N.map((de=>de.payloadType.toString(10))),z.attributes.payloads=N,z.attributes.extmaps=x;const te=z.attributes.mid;typeof te!="string"||Re(Q=this.useLocalCodecsMids).call(Q,te)||this.useLocalCodecsMids.push(te)}else if(g.audioCodecs.length===0){const te=v.audioCodecs.filter((de=>{var me,ve;return(me=de.rtpMap)===null||me===void 0?void 0:Re(ve=me.encodingName.toLowerCase()).call(ve,"opus")}))||[v.audioCodecs[0]];z.media.fmts=te.map((de=>de.payloadType.toString(10))),z.attributes.payloads=te,z.attributes.extmaps=[]}else z.media.fmts=g.audioCodecs.map((te=>te.payloadType.toString(10))),z.attributes.payloads=g.audioCodecs,z.attributes.extmaps=g.audioExtensions,zf(z)}}return this.sessionDesc=h,this.currentMidIndex=h.mediaDescriptions.length-1,[this.sessionDesc,E]}updateCandidates(l){const h=this._originCandidates.filter((E=>E.transport==="udp")),p=[];if(h.forEach((E=>{p.push(cI(cI({},E),{},{foundation:"tcpcandidate",priority:Number(E.priority)-1+"",transport:"tcp",port:Number(E.port)+90+""}))})),h.length!==0){switch(l){case Jr.TCP_RELAY:this._candidates=p;break;case Jr.UDP_TCP_RELAY:case Jr.RELAY:this._candidates=[...h,...p];break;default:this._candidates=h}for(const E of this.sessionDesc.mediaDescriptions)E.attributes.candidates=this.candidates}}restartICE(l){l=An(l),this._iceParameters=l,this.sessionDesc.mediaDescriptions.forEach((h=>{h.attributes.iceUfrag=l.iceUfrag,h.attributes.icePwd=l.icePwd}))}predictReceivingMids(l){const h=[];for(let p=0;p<l;p++)h.push((this.currentMidIndex+p+1).toString(10));return h}findAvailableMediaIndex(l,h){return this.sessionDesc.mediaDescriptions.findIndex((p=>{const E=p.media.mediaType===l&&p.media.port!=="0"&&(p.attributes.direction==="sendonly"||p.attributes.direction==="sendrecv")&&p.attributes.ssrcs.length===0;if(xn()){if(E){const g=this.firefoxSsrcMidMap.get(h[0].ssrcId);return!(g||p.attributes.mid!=="0"&&p.attributes.mid!=="1")||!(!g||g!==p.attributes.mid)}return!1}return E}))}createOrRecycleDataChannel(){for(const p of this.sessionDesc.mediaDescriptions)if(p.media.mediaType==="application")return{mediaDesc:p,needExchangeSDP:!1};this.currentMidIndex+=1;const l="".concat(this.currentMidIndex),h={media:{mediaType:"application",port:fT,protos:["UDP","DTLS","SCTP"],fmts:["webrtc-datachannel"]},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:[],fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[],rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,mid:"".concat(l),sctpPort:"5000"}};return this.sessionDesc.mediaDescriptions.push(h),{mediaDesc:h,needExchangeSDP:!0}}createOrRecycleRecvMedia(l,h,p,E,g,v){const O=l._mediaStreamTrack.kind,I=this.rtpCapabilities.recv,N=eg(O,I,this.localCapabilities.send,O===Le.VIDEO?E:g),M=O===Le.VIDEO?I.videoExtensions:I.audioExtensions;this.currentMidIndex+=1;const x="".concat(this.currentMidIndex);let B={media:{mediaType:O,port:fT,protos:["UDP","TLS","RTP","SAVPF"],fmts:N.map((Q=>Q.payloadType.toString(10)))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:M,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:h,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:N,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:p,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(x)}};B=this.mungRecvMediaDsec(B,l,v);const Z=this.findFirstClosedMedia(O);if(Z){const Q=this.sessionDesc.mediaDescriptions.indexOf(Z);this.sessionDesc.mediaDescriptions[Q]=B}else this.sessionDesc.mediaDescriptions.push(B);return B}updateRemoteDtlsParameters(l){const h=new Set(this._dtlsParameters.fingerprints.map((g=>g.fingerprint))),p=new Set(l.map((g=>g.fingerprint)));let E=!1;h.size!==p.size&&(E=!0);for(const g of h)p.has(g)||(E=!0);return E}updateRemoteCodec(l,h,p){const E=[...new Set(this._rtpCapabilities.recv.videoCodecs.map((B=>B.rtpMap&&B.rtpMap.encodingName.toLowerCase()||"")).filter((B=>{var Z;return Re(Z=Object.keys(WE)).call(Z,B)})))],g=new Set(h);if(E.every((B=>g.has(B))))return R.debug("codecs has not changed, no need to updateRemoteCodec, codecs: ".concat(h)),!1;const v=this._rtpCapabilities.recv.videoCodecs.filter((B=>h.some((Z=>{var Q;return Re(Q=B.rtpMap&&B.rtpMap.encodingName.toLowerCase()||"").call(Q,Z)}))));if(v.length===0)return R.debug("updateRemoteCodec failed, because cannot find matched codec, remoteCapabilities codecs: ".concat(E," codecs: ").concat(h)),!1;const O=[...new Set(v.map((B=>B.rtpMap&&B.rtpMap.encodingName.toLowerCase()||"")))];let I;if(R.debug("updateRemoteCodec, from ".concat(E," to ").concat(O)),l.length===0)I=this.sessionDesc.mediaDescriptions.filter((B=>B.media.mediaType==="video"&&B.attributes.direction==="recvonly"));else if(I=this.sessionDesc.mediaDescriptions.filter((B=>B.attributes.mid&&B.media.mediaType==="video"&&Re(l).call(l,B.attributes.mid)&&B.attributes.direction==="recvonly")),I.length!==l.length)return R.debug("updateRemoteCodec failed, because cannot find mids, mids: ".concat(l,", codecs: ").concat(h)),!1;if(F("USE_PUB_RTX")||F("USE_SUB_RTX")){const B=Ld(v,this.rtpCapabilities.recv.videoCodecs);v.push(...B)}this._rtpCapabilities.recv.videoCodecs=v;const N=this.localCapabilities.send,M=this.rtpCapabilities.recv,x=eg(Le.VIDEO,M,N,p);return I.forEach((B=>{const Z=x.map((Q=>Q.payloadType.toString(10)));R.debug("updateRemoteCodec mid: ".concat(B.attributes.mid,", from"),B.attributes.payloads,"to",x),B.attributes.payloads=x,B.media.fmts=Z})),!0}createOrRecycleSendMedia(l,h,p,E,g){const v=this.rtpCapabilities.send.videoCodecs,O=this._isUseLocalCodecs||v.length===0?this.localCapabilities.recv:this.rtpCapabilities.send,I=l===Le.VIDEO?O.videoCodecs:O.audioCodecs,N=l===Le.VIDEO?O.videoExtensions:O.audioExtensions;this.currentMidIndex+=1;const M="".concat(this.currentMidIndex);let x={media:{mediaType:l,port:fT,protos:["UDP","TLS","RTP","SAVPF"],fmts:I.map((Z=>Z.payloadType.toString(10)))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:N,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:h,ssrcGroups:p,rtcpFeedbackWildcards:[],payloads:I,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:E,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(M)}};x=this.mungSendMediaDesc(x,g);const B=this.findFirstClosedMedia(l);if(B){const Z=this.sessionDesc.mediaDescriptions.indexOf(B);this.sessionDesc.mediaDescriptions[Z]=x}else this.sessionDesc.mediaDescriptions.push(x);return x}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter((l=>l.media.port!=="0")).map((l=>l.attributes.mid))}mungRecvMediaDsec(l,h,p){const E=An(l);return Xb(E),Kf(E,h),Jb(E,h),$M(E),cT(E,p,this.localCapabilities.send),E}mungSendMediaDesc(l,h){const p=An(l);return cT(p,h,this.localCapabilities.recv),zf(p),p}updateRecvMedia(l,h){const p=this.sessionDesc.mediaDescriptions.findIndex((E=>E.attributes.mid===l));if(p!==-1){const E=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[p],h);this.sessionDesc.mediaDescriptions[p]=E}}bumpMid(l){this.currentMidIndex+=l}findFirstClosedMedia(l){return this.sessionDesc.mediaDescriptions.find((h=>xn()?h.media.port==="0"&&h.media.mediaType===l:h.media.port==="0"))}findPreloadMediaDesc(l){return this.sessionDesc.mediaDescriptions.find((h=>{var p;return((p=h.attributes)===null||p===void 0||(p=p.ssrcs[0])===null||p===void 0?void 0:p.ssrcId)===l[0].ssrcId}))}getSSRC(l){var h;return(h=this.sessionDesc.mediaDescriptions.find((p=>p.attributes.mid===l)))===null||h===void 0?void 0:h.attributes.ssrcs}}(Aa(Aa({},t),{},{localCapabilities:this.localCapabilities}),this.supportAV1RtpSpec,!(!F("ENABLE_PRE_SUB_WITH_PRE_PC")||!F("PRE_USE_LOCAL_CODECS"))&&hb(this.store)),t.preallocation&&(this.isPreallocation=!0),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);const i=this.remoteSDP.toString(),s=r2(this.initialOffer.sdp,this.extension),o=this.logSDPExchange(s||"","offer","local","connect");this.store.descriptionStart(),await this.peerConnection.setLocalDescription({type:"offer",sdp:s}),o?.(i),await this.peerConnection.setRemoteDescription({type:"answer",sdp:i});const c=this.peerConnection.getTransceivers()[0];if(c!=null&&c.receiver&&this.tryBindTransportEvents(c.receiver),hb(this.store))if(t.preallocation&&F("ENABLE_PRE_SUB_WITH_PRE_PC")){const l=F("PRE_SUB_NUM"),{mids:h,preSSRCs:p}=this.remoteSDP.preloadRemoteMedia(l);await xd(this.peerConnection,this.remoteSDP,this.extension),R.debug("[".concat(this.store.clientId,"] [P2PConnection] preload media, in pre pc,add preload ssrcs ").concat(p)),this.presetMedia(h,p)}else{const{preSSRCs:l=[]}=t,h=l.map((E=>E.ssrcMsg[0].ssrcId));if(l.length===0)return;const{mids:p}=this.remoteSDP.batchSend(l.map((E=>Object.assign({},E))));await xd(this.peerConnection,this.remoteSDP,this.extension),R.debug("[P2PConnection.connect] preload media, after join, add preload ssrcs ".concat(h)),this.presetMedia(p,h)}}catch(i){throw new ce(U.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(i.toString()))}var n,r}presetMedia(t,n){t.forEach(((r,i)=>{this.peerConnection.getTransceivers().forEach((s=>{if(s.mid!=null&&r===s.mid&&s.receiver.track){const o=s.receiver.track;let c;o.kind==="video"&&F("ENABLE_PRE_RENDER")&&(c=new wb({trackId:"track-".concat(o.kind,"-unknown-").concat(this.store.clientId,"_").concat(ln(5,""))},!0),c.updateVideoTrack(o),c.onFirstVideoFrameRender=()=>{var l;const h=this.preMediaMap.get(n[i]);h&&(h.firstVideoRender=Date.now()),(l=this.onFirstVideoRender)===null||l===void 0||l.call(this,n[i])},c.play(this.store.sessionId||void 0)),this.preMediaMap.set(n[i],{mid:r,track:o,player:c,transceiver:s})}})),this.store.peerReceiver()}))}checkDtlsParameters(t){return!!this.remoteSDP&&t.length>0&&this.remoteSDP.updateRemoteDtlsParameters(t)}async updateRemoteConnect(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateRemoteConnect before remote SDP created");let n=!1;const{rtpCapabilities:r}=t;if([,n]=this.remoteSDP.updateRemoteRTPCapabilities(r),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0){const o=this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);n=n||o}const{preSSRCs:i=[]}=t,s=i.map((o=>o.ssrcMsg[0].ssrcId));if(!this.remoteSDP.checkPreloadSsrcs(s)){const o=[],c=[];if(Array.from(this.preMediaMap.entries()).every((l=>{let[h,{mid:p,player:E,track:g}]=l;return o.push(p),c.push(h),this.preMediaMap.delete(h),E&&E.destroy(),!0})),o.length>0&&(this.remoteSDP.stopSending(o),await xd(this.peerConnection,this.remoteSDP,this.extension),R.warn("[P2PConnection.updateRemoteConnect] preload media, failed, del preload ssrcs ".concat(c)),We.reportApiInvoke(this.store.sessionId,{name:Bn.PRELOAD_MEDIA_FAILED,options:[i,c],tag:In.TRACER}).onSuccess()),i.length>0){const{mids:l}=this.remoteSDP.batchSend(i.map((h=>Object.assign({},h))));await xd(this.peerConnection,this.remoteSDP,this.extension),R.debug("[P2PConnection.updateRemoteConnect] preload media, after join, add preload ssrcs ".concat(s)),this.presetMedia(l,s)}}n?(await xd(this.peerConnection,this.remoteSDP,this.extension),R.debug("[P2PConnection] updateRemoteConnect by exchanging SDP.")):R.debug("[P2PConnection] updateRemoteConnect no need to exchange SDP, because no need to update remote codecs (use local codecs)")}catch(n){throw new ce(U.EXCHANGE_SDP_FAILED,"P2PConnection.updateRemoteConnect failed; ".concat(n.toString()))}}send(t,n,r){var i=this;return eo((function*(){const s=yield jt(i.mutex.lock("From P2PConnection.send"));try{if(!i.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const o=[],c=sT();t.forEach((N=>{const M=i.peerConnection.addTransceiver(N._mediaStreamTrack,Aa({direction:"sendonly"},N.trackMediaType==="video"&&i.supportAV1RtpSpec&&c?{sendEncodings:[{scalabilityMode:c}]}:{}));o.push(M),N._updateRtpTransceiver(M)})),xn()&&F("SIMULCAST")===!0&&(yield jt(i.applySimulcastForFirefox(o,t)));const l=yield jt(i.peerConnection.createOffer()),h=i.remoteSDP.predictReceivingMids(t.length),p=i.mungSendOfferSDP(l.sdp,t,h),E=Zi(p),g=h.map((N=>{const M=E.mediaDescriptions.find((x=>x.attributes.mid===N));if(!M)throw new Error("Cannot extract ssrc from mediaDescription.");return JM(M,F("USE_PUB_RTX"))}));let v;try{v=yield g}catch(N){v=[],i.remoteSDP.receive(t,n,r,v);const M=i.remoteSDP.toString();throw yield jt(i.peerConnection.setLocalDescription({type:"offer",sdp:p})),yield jt(i.peerConnection.setRemoteDescription({type:"answer",sdp:M})),yield jt(i.stopSending(h,!0)),N}i.remoteSDP.receive(t,n,r,v);const O=i.remoteSDP.toString(),I=i.logSDPExchange(p,"offer","local","send");return yield jt(i.peerConnection.setLocalDescription({type:"offer",sdp:p})),yield jt(i.applySimulcastEncodings(o,t)),yield jt(i.applySendEncodings(o,t)),I?.(O),yield jt(i.peerConnection.setRemoteDescription({type:"answer",sdp:O})),o.map(((N,M)=>{const x=h[M];return{localSSRC:g[M],id:x,transceiver:N}}))}catch(o){throw o instanceof ce?o:new ce(U.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(o.toString()))}finally{s()}}))()}async createDataChannels(t,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.createDataChannels before remote SDP created");let r=this.dataStreamChannelMap.get(t);if(r&&r.readyState==="open")R.debug("[P2PConnection] Channels are already available and can be reused directly.");else{const s=this.currentDataChannelId<1023?this.currentDataChannelId++:this.recoveredDataChannelIds.shift();if(typeof s!="number")throw new Error("create DataChannel error, because cannot get dc id");r=this.peerConnection.createDataChannel("datastream-channel",{id:s,negotiated:!0,ordered:!1,maxRetransmits:F("DATASTREAM_MAX_RETRANSMITS")}),r.binaryType="arraybuffer",this.dataStreamChannelMap.set(t,r)}n.forEach((s=>{s._updateOriginDataChannel(r)}));const{needExchangeSDP:i}=this.remoteSDP.sendDataChannel();if(i){const s=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:s});const o=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(o),R.debug("[P2PConnection] createDataChannels by exchanging SDP.")}else R.debug("[P2PConnection] createDataChannels no need to exchange SDP.");return}catch(r){throw r instanceof ce?r:new ce(U.EXCHANGE_SDP_FAILED,"P2PConnection.createDataChannels failed; ".concat(r.toString()))}}async stopDataChannels(t){try{const n=this.dataStreamChannelMap.get(t);return n&&(n.id&&this.recoveredDataChannelIds.push(n.id),n.close()),void this.dataStreamChannelMap.delete(t)}catch(n){throw n instanceof ce?n:new ce(U.DATACHANNEL_FAILED,"P2PConnection.stopDataChannels failed; ".concat(n.toString()))}}async stopSending(t,n){const r=n?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const i=this.peerConnection.getTransceivers().filter((l=>t.indexOf(l.mid)!==-1));if(i.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");i.map((l=>{var h;gT(this.id+l.mid,this),l.direction="inactive",(h=l.stop)===null||h===void 0||h.call(l)}));const s=await this.peerConnection.createOffer(),o=this.logSDPExchange(s.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(s),this.remoteSDP.stopReceiving(t);const c=this.remoteSDP.toString();o?.(c),await this.peerConnection.setRemoteDescription({type:"answer",sdp:c})}catch(i){throw new ce(U.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(i.toString()))}finally{r&&r()}}async receive(t,n,r,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));const{mid:s,needExchangeSDP:o}=this.remoteSDP.send(t,n,r,i);o&&(await xd(this.peerConnection,this.remoteSDP,this.extension),R.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," by exchanging SDP.")));const c=this.peerConnection.getTransceivers().find((l=>l.mid===s));if(!c)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:c.receiver.track,id:s,transceiver:c}}catch(s){throw new ce(U.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(s.toString()))}}async batchReceive(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const{mids:n,needExchangeSDP:r}=this.remoteSDP.batchSend(t);return r&&(await xd(this.peerConnection,this.remoteSDP,this.extension),R.debug("[".concat(this.store.clientId,"] [P2PConnection] batchReceive by exchanging SDP."))),n.map((i=>{const s=this.peerConnection.getTransceivers().find((o=>o.mid===i));if(!s)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:s.receiver.track,id:i,transceiver:s}}))}catch(n){throw new ce(U.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(n.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");t.forEach((s=>{Array.from(this.preMediaMap.entries()).some((o=>{let[c,{mid:l,player:h}]=o;if(l===s)return this.preMediaMap.delete(c),h&&h.destroy(),!0}))})),this.remoteSDP.stopSending(t);const n=this.remoteSDP.toString(),r=this.logSDPExchange(n,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const i=await this.peerConnection.createAnswer();r?.(i.sdp||""),await this.peerConnection.setLocalDescription(i)}catch(n){throw new ce(U.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n.toString()))}}async muteRemote(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteRemote mid=".concat(t," before remote SDP created."));this.remoteSDP.mute(t);const n=this.remoteSDP.toString(),r=this.logSDPExchange(n,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const i=await this.peerConnection.createAnswer();r?.(i.sdp||""),await this.peerConnection.setLocalDescription(i)}catch(n){throw new ce(U.EXCHANGE_SDP_FAILED,"P2PConnection.muteRemote failed; ".concat(n.toString()))}}async unmuteRemote(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteRemote mid=".concat(t," before remote SDP created."));this.remoteSDP.unmute(t);const n=this.remoteSDP.toString(),r=this.logSDPExchange(n,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const i=await this.peerConnection.createAnswer();r?.(i.sdp||""),await this.peerConnection.setLocalDescription(i)}catch(n){throw new ce(U.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteRemote failed; ".concat(n.toString()))}}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter((o=>o.mid&&t.indexOf(o.mid)!==-1));if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map((o=>{o.direction="inactive"}));const r=await this.peerConnection.createOffer(),i=this.logSDPExchange(r.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(r),this.remoteSDP.muteRemote(t);const s=this.remoteSDP.toString();i?.(s),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(n){throw new ce(U.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(n.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter((o=>o.mid&&t.indexOf(o.mid)!==-1));if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map((async(o,c)=>{o.direction="sendonly"}));const r=await this.peerConnection.createOffer(),i=this.logSDPExchange(r.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(r),this.remoteSDP.unmuteRemote(t),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec(t,this.remoteCodecs,this.store.codec);const s=this.remoteSDP.toString();i?.(s),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(n){throw new ce(U.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(n.toString()))}}restartICE(t){var n=this;return eo((function*(){const r=yield jt(n.mutex.lock("From P2PConnection.restartICE"));try{if(!n.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const i=Ft().supportPCSetConfiguration,s=F("FORCE_TURN_TCP")||n.forceTurn;if(t===Jr.RELAY&&!i)return;if(i&&!s){const E=t===Jr.RELAY?"relay":"all",g=n.peerConnection.getConfiguration();g.iceTransportPolicy!==E&&(R.debug("[".concat(n.store.clientId,"] restartICE change iceTransportPolicy from [").concat(g.iceTransportPolicy,"] to [").concat(E,"]")),g.iceTransportPolicy=E,n.peerConnection.setConfiguration(g))}n.remoteSDP.updateCandidates(t);const o=yield jt(n.peerConnection.createOffer({iceRestart:!0}));if(!o.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const c=kd(o.sdp),{remoteIceParameters:l}=yield c.iceParameters;n.remoteSDP.restartICE(l);const h=n.remoteSDP.toString(),p=n.logSDPExchange(o.sdp||"","offer","local","restartICE");n.store.descriptionStart(),yield jt(n.peerConnection.setLocalDescription(o)),p?.(h),yield jt(n.peerConnection.setRemoteDescription({type:"answer",sdp:h}))}catch(i){R.warning("[".concat(n.store.clientId,"] restart ICE failed, abort operation"),i)}finally{r()}}))()}async extendCandidate(){if(!this.remoteSDP||this.isFirstConnected)return;const t=await this.mutex.lock("From P2PConnection.extendCandidate");try{this.remoteSDP.updateCandidates(Jr.TCP_RELAY),await xd(this.peerConnection,this.remoteSDP,this.extension)}catch(n){R.warning("[".concat(this.store.clientId,"] extend candidate failed, abort operation"),n)}finally{t()}}close(){var t;this.peerConnection.getTransceivers().forEach((n=>{gT(this.id+n.mid,this)})),this.preMediaMap.forEach((n=>{let{player:r}=n;r&&r.destroy()})),this.preMediaMap.clear(),this.peerConnection.close(),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear(),this.recoveredDataChannelIds=[],this.currentDataChannelId=1}getStats(){return Aa(Aa({},this.statsFilter.getStats()),{},{qualityLimitationReason:this.qualityLimitationReason})}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const r=await this.peerConnection.createOffer(),i=this.mungSendOfferSDP(r.sdp,[n],[t]);this.remoteSDP.updateRecvMedia(t,n);const s=this.remoteSDP.toString(),o=this.logSDPExchange(i,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:i}),o?.(s),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(r){throw new ce(U.EXCHANGE_SDP_FAILED,r.toString())}}async updateSendParameters(t,n){const r=this.peerConnection.getTransceivers().filter((i=>i.mid===t));r.length===1&&(this.isVP8Simulcast(n)?xn()||await this.applySimulcastEncodings(r,[n]):await this.applySendEncodings(r,[n]))}setStatsRemoteVideoIsReady(t,n){this.statsFilter.setVideoIsReady2(t,n)}async replaceTrack(t,n){const r=this.peerConnection.getTransceivers().find((i=>i.mid===n));r&&await r.sender.replaceTrack(t._mediaStreamTrack)}async getSelectedCandidatePair(){const t=this.peerConnection.getReceivers();if(t.length>0&&t[0].transport&&t[0].transport.iceTransport&&t[0].transport.iceTransport.getSelectedCandidatePair&&t[0].transport.iceTransport.getSelectedCandidatePair()){const n=t[0].transport.iceTransport,{local:r,remote:i}=n.getSelectedCandidatePair();return{local:Aa(Aa({},Tc),{},{candidateType:r.type,protocol:r.protocol,address:r.address,port:r.port}),remote:Aa(Aa({},Tc),{},{candidateType:i.type,protocol:i.protocol,address:i.address,port:i.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t;(t=this.onICEConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;this.peerConnection.connectionState==="connected"&&(this.isFirstConnected=!0),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidateerror=t=>{if(t&&(t.errorCode||t.errorText)){var n;const r="code: ".concat(t.errorCode,", message: ").concat(t.errorText),i=t.port?"local: ".concat(t.port):"",s=wh(t.url||"");R.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICECandidateError(").concat(r,"), url: ").concat(s||"",", host_candidate:").concat(i)),(n=this.onICECandidateError)===null||n===void 0||n.call(this,r)}},this.peerConnection.onicegatheringstatechange=t=>{t&&t.target&&"iceGatheringState"in t.target&&R.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] RTCPeerConnection.onicegatheringstatechange(").concat(t.target.iceGatheringState,")"))},this.peerConnection.onicecandidate=t=>{t.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,R.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout((()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,R.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))}),F("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){const n={iceServers:[]},r=t.cloudProxyServer||"disabled";return t.iceServers?n.iceServers=t.iceServers:t.turnServer&&(UE(t.turnServer.servers)?n.iceServers=t.turnServer.servers:F("NEW_TURN_MODE")&&n.iceServers&&r==="disabled"?(F("USE_TURN_SERVER_OF_GATEWAY")?t.turnServer.serversFromGateway&&n.iceServers.push(...Fh.newTurnServerConfigToIceServers(t.turnServer.serversFromGateway)):n.iceServers.push(...Fh.newTurnServerConfigToIceServers(t.turnServer.servers)),F("NEW_FORCE_TURN")&&(n.iceTransportPolicy="relay")):t.turnServer.mode!=="off"&&(n.iceServers&&n.iceServers.push(...Fh.turnServerConfigToIceServers(t.turnServer.servers)),F("USE_TURN_SERVER_OF_GATEWAY")&&n.iceServers&&t.turnServer.serversFromGateway&&n.iceServers.push(...Fh.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),F("FORCE_TURN_TCP")?n.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach((i=>{i.forceturn&&(n.iceTransportPolicy="relay")})))),F("ENABLE_ENCODED_TRANSFORM")&&Ft().supportWebRTCEncodedTransform&&(n.encodedInsertableStreams=!0),n}static turnServerConfigToIceServers(t){const n=[];return t.forEach((r=>{r.security?r.tcpport&&n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turns:".concat(Pd(r.turnServerURL),":").concat(r.tcpport,"?transport=tcp")}):(r.udpport&&!F("FORCE_TURN_TCP")&&n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":").concat(r.udpport,"?transport=udp")}),r.tcpport&&n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":").concat(r.tcpport,"?transport=tcp")}))})),n}static newTurnServerConfigToIceServers(t){const n=[];return t.forEach((r=>{const i=F("NEW_TURN_MODE");i===1?n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":3478?transport=udp")}):i===2?n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":3478?transport=tcp")}):i===3?n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turns:".concat(Pd(r.turnServerURL),":443?transport=tcp")}):i===4&&(n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":3478?transport=udp")}),n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":3478?transport=tcp")}),n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turns:".concat(Pd(r.turnServerURL),":443?transport=tcp")}))})),n}tryBindTransportEvents(t){const n=t.transport;if(n){this.transportEventReceiver=t,n.onstatechange=()=>{var i;n!=null&&n.state&&((i=this.onDTLSTransportStateChange)===null||i===void 0||i.call(this,n.state))},n.onerror=i=>{var s;(s=this.onDTLSTransportError)===null||s===void 0||s.call(this,"error"in i?i.error:i)};const r=n.iceTransport;r&&(r.onstatechange=()=>{const i=n?.iceTransport.state;var s;i&&((s=this.onICETransportStateChange)===null||s===void 0||s.call(this,i))},r.getSelectedCandidatePair&&(r.onselectedcandidatepairchange=()=>{if(r.getSelectedCandidatePair()){const{local:i,remote:s}=r.getSelectedCandidatePair()||{};if(i&&s){const o=i.address+":"+i.port,c=s.address+":"+s.port;R.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify(wh(o)),", remote ").concat(JSON.stringify(wh(c))))}}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(t,n){var r,i;if(n||(n=this.peerConnection.getSenders().find((N=>N.track===t._mediaStreamTrack))),!n)return R.warn("[".concat(t.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(t))return R.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!Ft().supportSetRtpSenderParameters)return R.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const s={},o={};switch(t._optimizationMode){case"motion":s.degradationPreference="maintain-framerate";break;case"detail":s.degradationPreference="maintain-resolution";break;case"balanced":s.degradationPreference="balanced"}const c=(function(I,N){return I.getTransceivers().find((M=>M.sender.track===N||M.receiver.track===N))})(this.peerConnection,t._mediaStreamTrack),l=EY(t);if((function(I){var N;return!(!F("ENABLE_AG_ADAPTATION")||!(I instanceof WS||Re(N=I._hints).call(N,an.CUSTOM_TRACK))||!F("FORCE_SUPPORT_AG_ADAPTATION")&&!(b1(14,0,!1)&&I1(17,4)||w1(14)&&B0(17,4,!0)))})(t)&&c&&n&&l&&this.getLocalVideoStats&&Re(r=["vp8","vp9"]).call(r,this.store.codec)){var h;const I=s.degradationPreference||(Re(h=t._hints).call(h,an.CUSTOM_TRACK)?F("CUSTOM_ADAPTATION_DEFAULT_MODE"):"maintain-framerate");(function(N,M,x,B,Z,Q){if(gT(N,x),Z(M),B!=="balanced"&&B!=="maintain-framerate"&&B!=="maintain-resolution")return;let z=-1;N2(N,M);const te=window.setInterval((()=>{const me=ET.get(N);if(!F("ENABLE_AG_ADAPTATION")||!me)return gT(N,x),void Z(M);const ve=Q();if(ve.sendPackets>0&&ve.OutgoingAvailableBandwidth>0){if(z===-1)return void(z=Date.now());if(Date.now()-z<1e3)return;const St=ve.sendFrameRate,wt=ve.OutgoingAvailableBandwidth,[ot,Xt]=O9(N,St,wt,me.adaptationConfig,M,B);Xt&&(x.qualityLimitationReason=Xt),ot&&me.adaptationConfig.scale!==ot.scale&&(R.debug("[".concat(N,"] applyAdaptation: ").concat(x.qualityLimitationReason,`
           sendFps `).concat(St,", bwe ").concat(wt,", switch from ").concat(me.adaptationConfig.scale," to ").concat(ot.scale," ")),me.adaptationConfig=dI(dI({},me.adaptationConfig),ot),Z(ot))}}),F("CHECK_LOCAL_STATS_INTERVAL")),de=dI({},M);ET.set(N,{timer:te,adaptationConfig:de,originConfig:M,adaptationFunc:Z}),R.debug("[".concat(N,"] start adaptation, originConfig: ").concat(JSON.stringify(M),", degradationPreference: ").concat(B))})(this.id+c.mid,l,this,I,(N=>{n&&this.updateAdaptation(n,N)}),this.getLocalVideoStats.bind(this))}if(t._encoderConfig){var p;const{bitrateMax:I,frameRate:N,scaleResolutionDownBy:M}=t._encoderConfig;I&&(o.maxBitrate=1e3*I),(Re(p=t._hints).call(p,an.LOW_STREAM)||t.isUseScaleResolutionDownBy)&&(N&&(o.maxFramerate=Es(N)),M&&M>=1&&(o.scaleResolutionDownBy=M))}const{maxFramerate:E}=F("ENCODER_CONFIG_LIMIT");if(E&&typeof E=="number"&&(o.maxFramerate=o.maxFramerate?Math.min(o.maxFramerate,E):E),F("DSCP_TYPE")&&ml()){var g;const I=F("DSCP_TYPE");Re(g=["very-low","low","medium","high"]).call(g,I)&&(o.networkPriority=I)}const v=n.getParameters(),O=(i=v.encodings)===null||i===void 0?void 0:i[0];xn()&&!O&&(s.encodings=[o]),O&&Object.assign(O,o),Object.assign(v,s),R.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(v.encodings))),await n.setParameters(v),await(async function(I,N,M){try{var x;if(!Ft().supportSetRtpSenderParameters||!(function(te){return te==="vp9"||te==="av1"})(I)||!F("ENABLE_SVC"))return;const B={},Z={},Q=N.getParameters(),z=(x=Q.encodings)===null||x===void 0?void 0:x[0];Z.scalabilityMode=sT(M),z&&Object.assign(z,Z),Object.assign(Q,B),await N.setParameters(Q),R.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode success: ".concat(JSON.stringify(Q.encodings)))}catch(B){R.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode failed",B)}})(this.store.codec,n,F("SVC_MODE"))}async updateAdaptation(t,n){var r,i;if(!t)return R.debug("[updateAdaptation] no rtpSender found");if(!Ft().supportSetRtpSenderParameters)return R.debug("[updateAdaptation] Browser not support set rtp-sender parameters");const s={},{bitrateMax:o,frameRate:c,scaleResolutionDownBy:l}=n;o&&(s.maxBitrate=1e3*o),c&&(s.maxFramerate=Es(c)),l&&l>=1&&Re(r=["vp8","vp9"]).call(r,this.store.codec)&&(s.scaleResolutionDownBy=l);const h=t.getParameters(),p=(i=h.encodings)===null||i===void 0?void 0:i[0];p&&Object.assign(p,s),Object.assign(h,{});try{await t.setParameters(h),R.debug("[updateAdaptation] updateRtpSenderEncodings: ".concat(JSON.stringify(h.encodings)))}catch(E){!("transport"in t)||t.transport&&t.transport.state==="connected"?this.peerConnectionState!=="connected"?R.debug("[updateAdaptation] peerConnection not connected}"):R.debug("[updateAdaptation] updateRtpSenderEncodings failed",E):R.debug("[updateAdaptation] rtpSender transport not connected}")}}async applySendEncodings(t,n){try{if(!Ft().supportSetRtpSenderParameters||t.length!==n.length)return;for(let r=0;r<t.length;r++){const i=t[r],s=n[r];s instanceof vn&&!this.isVP8Simulcast(s)&&await this.updateRtpSenderEncodings(s,i.sender)}}catch{R.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(t,n,r){const i=Zi(t);return n.forEach(((s,o)=>{const c=r[o],l=i.mediaDescriptions.find((h=>h.attributes.mid===c));l&&(Kf(l,s),e2(l,s,this.store.codec))})),Id(i)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var n;(n=this.onFirstAudioReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var n;(n=this.onFirstVideoReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var n;(n=this.onFirstAudioDecoded)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,n,r)=>{var i;(i=this.onFirstVideoDecoded)===null||i===void 0||i.call(this,t,n,r)},this.statsFilter.onSelectedLocalCandidateChanged=(t,n)=>{var r;(r=this.onSelectedLocalCandidateChanged)===null||r===void 0||r.call(this,t,n)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,n)=>{var r;(r=this.onSelectedRemoteCandidateChanged)===null||r===void 0||r.call(this,t,n)},this.statsFilter.onFirstVideoDecodedTimeout=t=>{var n;(n=this.onFirstVideoDecodedTimeout)===null||n===void 0||n.call(this,t)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(t,n){if(t.length===n.length)for(let l=0;l<t.length;l++){var r,i,s,o,c;const h=t[l],p=n[l];if(p instanceof vn&&!Re(r=p._hints).call(r,an.LOW_STREAM)&&(i=p._encoderConfig)!==null&&i!==void 0&&i.bitrateMax&&((s=p._encoderConfig)===null||s===void 0?void 0:s.bitrateMax)>200&&(o=p._scalabilityMode)!==null&&o!==void 0&&o.numSpatialLayers&&((c=p._scalabilityMode)===null||c===void 0?void 0:c.numSpatialLayers)>1&&this.store.codec==="vp8"){const E={},g={high:1e3*(p._encoderConfig.bitrateMax-50),medium:5e4};E.encodings=[{rid:"m",active:!0,maxBitrate:g.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:g.high}];const v=h.sender.getParameters();await h.sender.setParameters(Object.assign(v,E))}}}async applySimulcastEncodings(t,n){if(!xn()&&t.length===n.length)for(let r=0;r<t.length;r++){const i=n[r];if(i instanceof vn&&this.isVP8Simulcast(i)){const s=t[r],o={},c={high:1e3*(i._encoderConfig.bitrateMax-50),medium:5e4};o.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:c.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:c.medium,scaleResolutionDownBy:4}];const l=s.sender.getParameters();await s.sender.setParameters(Object.assign(l,o))}}}isVP8Simulcast(t){var n,r,i,s,o;return!!(t instanceof vn&&F("SIMULCAST")&&this.store.codec==="vp8"&&!Re(n=t._hints).call(n,an.LOW_STREAM)&&(r=t._encoderConfig)!==null&&r!==void 0&&r.bitrateMax&&((i=t._encoderConfig)===null||i===void 0?void 0:i.bitrateMax)>200&&(s=t._scalabilityMode)!==null&&s!==void 0&&s.numSpatialLayers&&((o=t._scalabilityMode)===null||o===void 0?void 0:o.numSpatialLayers)>1)}logSDPExchange(t,n,r,i){if(F("SDP_LOGGING"))return R.upload("[".concat(this.store.clientId,"] exchanging ").concat(r," ").concat(n," SDP during P2PConnection.").concat(i,`
`),t),n==="offer"?s=>{this.logSDPExchange(s,"answer",r==="local"?"remote":"local",i)}:void 0}async getRemoteSSRC(t){if(!this.remoteSDP)return;const n=this.remoteSDP.getSSRC(t);return n&&n.length!==0?n[0].ssrcId:void 0}setConfiguration(t){if(Ft().supportPCSetConfiguration){const n=Fh.resolvePCConfiguration(t);this.peerConnection.setConfiguration(n)}t.isPreallocation&&(this.isPreallocation=!0)}},Be(Mt.prototype,"updateRemoteRTPCapabilities",[Vi],Object.getOwnPropertyDescriptor(Mt.prototype,"updateRemoteRTPCapabilities"),Mt.prototype),Be(Mt.prototype,"connect",[Vi],Object.getOwnPropertyDescriptor(Mt.prototype,"connect"),Mt.prototype),Be(Mt.prototype,"updateRemoteConnect",[Vi],Object.getOwnPropertyDescriptor(Mt.prototype,"updateRemoteConnect"),Mt.prototype),Be(Mt.prototype,"createDataChannels",[Vi],Object.getOwnPropertyDescriptor(Mt.prototype,"createDataChannels"),Mt.prototype),Be(Mt.prototype,"receive",[Vi],Object.getOwnPropertyDescriptor(Mt.prototype,"receive"),Mt.prototype),Be(Mt.prototype,"batchReceive",[Vi],Object.getOwnPropertyDescriptor(Mt.prototype,"batchReceive"),Mt.prototype),Be(Mt.prototype,"stopReceiving",[Vi],Object.getOwnPropertyDescriptor(Mt.prototype,"stopReceiving"),Mt.prototype),Be(Mt.prototype,"muteRemote",[Vi],Object.getOwnPropertyDescriptor(Mt.prototype,"muteRemote"),Mt.prototype),Be(Mt.prototype,"unmuteRemote",[Vi],Object.getOwnPropertyDescriptor(Mt.prototype,"unmuteRemote"),Mt.prototype),Be(Mt.prototype,"muteLocal",[Vi],Object.getOwnPropertyDescriptor(Mt.prototype,"muteLocal"),Mt.prototype),Be(Mt.prototype,"unmuteLocal",[Vi],Object.getOwnPropertyDescriptor(Mt.prototype,"unmuteLocal"),Mt.prototype),Be(Mt.prototype,"close",[Vi],Object.getOwnPropertyDescriptor(Mt.prototype,"close"),Mt.prototype),Be(Mt.prototype,"updateEncoderConfig",[Vi],Object.getOwnPropertyDescriptor(Mt.prototype,"updateEncoderConfig"),Mt.prototype),Be(Mt.prototype,"updateSendParameters",[Vi],Object.getOwnPropertyDescriptor(Mt.prototype,"updateSendParameters"),Mt.prototype),Be(Mt.prototype,"replaceTrack",[Vi],Object.getOwnPropertyDescriptor(Mt.prototype,"replaceTrack"),Mt.prototype),Be(Mt.prototype,"updateAdaptation",[Vi],Object.getOwnPropertyDescriptor(Mt.prototype,"updateAdaptation"),Mt.prototype),Be(Mt.prototype,"getRemoteSSRC",[Vi],Object.getOwnPropertyDescriptor(Mt.prototype,"getRemoteSSRC"),Mt.prototype),Mt);function Vi(e,t,n){const r=e[t];if(typeof r!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const i=this.mutex,s=await i.lock("From P2PConnection.".concat(t));try{for(var o=arguments.length,c=new Array(o),l=0;l<o;l++)c[l]=arguments[l];return await r.apply(this,c)}finally{s()}},n}function fI(e,t){let n=document.createElement("video"),r=document.createElement("canvas");n.setAttribute("style","display:none"),r.setAttribute("style","display:none"),n.setAttribute("muted",""),n.muted=!0,n.setAttribute("autoplay",""),n.autoplay=!0,n.setAttribute("playsinline",""),r.width=Es(t.width),r.height=Es(t.height);const i=Es(t.framerate||15);document.body.append(n),document.body.append(r);let s=e._mediaStreamTrack;n.srcObject=new MediaStream([s]),n.play();const o=r.getContext("2d");if(!o)throw new se(U.UNEXPECTED_ERROR,"can not get canvas context");const c=Ft(),l=r.captureStream(c.supportRequestFrame?0:i).getVideoTracks()[0];l.canvas||(l.canvas=r),r.startCapture=()=>{if(!n)return r.stopCapture&&r.stopCapture();if(n.paused&&n.play(),n.videoHeight>2&&n.videoWidth>2){const p=n.videoWidth,E=n.videoHeight/p,g=r.width*E;Math.abs(g-r.height)>=2&&(R.debug("adjust low stream resolution","".concat(r.width,"x").concat(r.height," -> ").concat(r.width,"x").concat(g)),r.height=g)}o.drawImage(n,0,0,r.width,r.height),l.requestFrame&&l.requestFrame(),s!==e._mediaStreamTrack&&(s=e._mediaStreamTrack,n.srcObject=new MediaStream([s]))},r.stopCapture=vb((()=>r.startCapture&&r.startCapture()),i);const h=l.stop;return l.stop=()=>{h.call(l),n&&(n.remove(),n.srcObject=null,n=null),r&&(r.width=0,r.remove(),r.stopCapture&&r.stopCapture(),r.startCapture=void 0,r.stopCapture=void 0,r=null),R.debug("clean low stream renderer")},l}var L2=(function(e){return e[e.Video_Send_Type=190]="Video_Send_Type",e})(L2||{}),Na=(function(e){return e[e.Video_Send_Qp_Sum=2143]="Video_Send_Qp_Sum",e[e.Video_Send_Freeze=2082]="Video_Send_Freeze",e[e.Video_Recv_Qp_Sum=2144]="Video_Recv_Qp_Sum",e[e.Video_Recv_Freeze=2084]="Video_Recv_Freeze",e[e.Video_Render_Freeze_Time=2109]="Video_Render_Freeze_Time",e[e.Video_Render_Freeze_Time_Render=2147]="Video_Render_Freeze_Time_Render",e[e.Video_Render_Freeze_Time_Render2=2223]="Video_Render_Freeze_Time_Render2",e[e.Audio_Recv_Freeze=2083]="Audio_Recv_Freeze",e})(Na||{}),ut=(function(e){return e[e.Video_Send_Retransmit=2062]="Video_Send_Retransmit",e[e.Video_Send_Target_Encoded=2064]="Video_Send_Target_Encoded",e[e.Video_Send_Actual_Encoded=2060]="Video_Send_Actual_Encoded",e[e.Video_Send_Transmit=2066]="Video_Send_Transmit",e[e.Video_Send_Bandwidth=2061]="Video_Send_Bandwidth",e[e.Video_Capture_Height=2033]="Video_Capture_Height",e[e.Video_Capture_Width=2035]="Video_Capture_Width",e[e.Video_Capture_Frame_Rate=2034]="Video_Capture_Frame_Rate",e[e.Video_Send_Low_Height=2073]="Video_Send_Low_Height",e[e.Video_Send_Low_Frame_Rate=2075]="Video_Send_Low_Frame_Rate",e[e.Video_Send_Low_Width=2077]="Video_Send_Low_Width",e[e.Video_Send_Low_Bitrate=2069]="Video_Send_Low_Bitrate",e[e.Video_Send_Low_Package_Lost=2070]="Video_Send_Low_Package_Lost",e[e.Video_Send_Low_Package_Rate=2071]="Video_Send_Low_Package_Rate",e[e.Video_Send_Frame_Rate=2002]="Video_Send_Frame_Rate",e[e.Video_Send_Width=2003]="Video_Send_Width",e[e.Video_Send_Height=2004]="Video_Send_Height",e[e.Video_Send_Disabled=2095]="Video_Send_Disabled",e[e.Video_Send_Adaptation=2032]="Video_Send_Adaptation",e[e.Video_Send_Player_Status=2128]="Video_Send_Player_Status",e[e.Video_Send_Nacks=2009]="Video_Send_Nacks",e[e.Video_Send_Plis=2010]="Video_Send_Plis",e[e.Video_Send_Firs=2011]="Video_Send_Firs",e[e.Video_Send_Avg_Encode=2007]="Video_Send_Avg_Encode",e[e.Video_Send_Huge_Frame_Sent=2174]="Video_Send_Huge_Frame_Sent",e[e.Video_Send_Bytes_Retransmit=2173]="Video_Send_Bytes_Retransmit",e[e.Video_Send_Packages_Retransmit=2172]="Video_Send_Packages_Retransmit",e[e.Video_Send_Key_Frames_Encoded=2207]="Video_Send_Key_Frames_Encoded",e[e.Video_Send_Bitrate=2012]="Video_Send_Bitrate",e[e.Video_Send_Package_Rate=2031]="Video_Send_Package_Rate",e[e.Video_Send_Package_Lost=2005]="Video_Send_Package_Lost",e[e.Audio_Capture_PCM_Level=2104]="Audio_Capture_PCM_Level",e[e.Audio_Send_Level=2038]="Audio_Send_Level",e[e.Audio_Send_Bitrate=2039]="Audio_Send_Bitrate",e[e.Audio_Send_Package_Rate=2040]="Audio_Send_Package_Rate",e[e.Audio_Send_AEC_Return_Loss=2041]="Audio_Send_AEC_Return_Loss",e[e.Audio_Send_AEC_Return_Loss_Enhancement=2042]="Audio_Send_AEC_Return_Loss_Enhancement",e[e.Audio_Send_Freeze=2081]="Audio_Send_Freeze",e[e.Audio_Send_Disabled=2096]="Audio_Send_Disabled",e[e.Audio_Send_Bytes_Retransmit=2179]="Audio_Send_Bytes_Retransmit",e[e.Audio_Send_Packages_Retransmit=2180]="Audio_Send_Packages_Retransmit",e[e.Video_Recv_Height=2019]="Video_Recv_Height",e[e.Video_Recv_Width=2018]="Video_Recv_Width",e[e.Video_Recv_Frame_Rate_Output=2155]="Video_Recv_Frame_Rate_Output",e[e.Video_Recv_Jitter_Buffer=2023]="Video_Recv_Jitter_Buffer",e[e.Video_Recv_Current_Delay=2024]="Video_Recv_Current_Delay",e[e.Video_Recv_Nacks=2026]="Video_Recv_Nacks",e[e.Video_Recv_Plis=2027]="Video_Recv_Plis",e[e.Video_Recv_Firs=2028]="Video_Recv_Firs",e[e.Video_Recv_Disabled=2101]="Video_Recv_Disabled",e[e.Video_Recv_Player_Status=2129]="Video_Recv_Player_Status",e[e.Video_Recv_I_Frame_Delay=2149]="Video_Recv_I_Frame_Delay",e[e.Video_Render_Frame_Rate_Render=2022]="Video_Render_Frame_Rate_Render",e[e.Video_Render_Freeze_Duration=2156]="Video_Render_Freeze_Duration",e[e.Audio_Render_Level=2043]="Audio_Render_Level",e[e.Audio_Render_Freeze_Time_80ms=2226]="Audio_Render_Freeze_Time_80ms",e[e.Audio_Render_Freeze_Time_200ms=2227]="Audio_Render_Freeze_Time_200ms",e[e.Audio_Render_Freeze_Samples_80ms=2228]="Audio_Render_Freeze_Samples_80ms",e[e.Audio_Render_Freeze_Samples_200ms=2229]="Audio_Render_Freeze_Samples_200ms",e[e.Audio_Recv_PCM_Level=2105]="Audio_Recv_PCM_Level",e[e.Audio_Recv_Disabled=2102]="Audio_Recv_Disabled",e[e.Audio_Recv_Jitter_Buffer=2054]="Audio_Recv_Jitter_Buffer",e[e.Audio_Recv_Current_Delay=2047]="Audio_Recv_Current_Delay",e[e.Audio_Recv_Player_Status=2130]="Audio_Recv_Player_Status",e[e.Audio_Recv_Bitrate=2044]="Audio_Recv_Bitrate",e[e.Audio_Recv_Concealed_Samples=2148]="Audio_Recv_Concealed_Samples",e[e.Audio_Recv_Total_Samples_Received=2224]="Audio_Recv_Total_Samples_Received",e})(ut||{}),xr=(function(e){return e[e.Video_Render_Frame_Rate_Decode=2021]="Video_Render_Frame_Rate_Decode",e[e.Video_Recv_Frame_Rate=2020]="Video_Recv_Frame_Rate",e[e.Video_Recv_Frame_Dropped=2181]="Video_Recv_Frame_Dropped",e[e.Video_Recv_Bytes_Retransmit=2175]="Video_Recv_Bytes_Retransmit",e[e.Video_Recv_Packages_Retransmit=2176]="Video_Recv_Packages_Retransmit",e[e.Video_Recv_Packages_Discarded=2198]="Video_Recv_Packages_Discarded",e[e.Video_Recv_Avg_Decode=2200]="Video_Recv_Avg_Decode",e[e.Video_Recv_Avg_Processing_Delay=2202]="Video_Recv_Avg_Processing_Delay",e[e.Video_Recv_Avg_Assembly_Time=2203]="Video_Recv_Avg_Assembly_Time",e[e.Video_Recv_Avg_Inter_Frame_Delay=2204]="Video_Recv_Avg_Inter_Frame_Delay",e[e.Video_Recv_Key_Frames_Decoded=2206]="Video_Recv_Key_Frames_Decoded",e[e.Video_Recv_Package_Lost=2014]="Video_Recv_Package_Lost",e[e.Video_Recv_Bitrate=2029]="Video_Recv_Bitrate",e[e.Video_Recv_Package_Rate=2078]="Video_Recv_Package_Rate",e[e.Audio_Recv_Jitter=2055]="Audio_Recv_Jitter",e[e.Audio_Recv_Bytes_Retransmit=2178]="Audio_Recv_Bytes_Retransmit",e[e.Audio_Recv_Packages_Retransmit=2177]="Audio_Recv_Packages_Retransmit",e[e.Audio_Recv_Packages_Discarded=2199]="Audio_Recv_Packages_Discarded",e[e.Audio_Recv_Avg_Processing_Delay=2201]="Audio_Recv_Avg_Processing_Delay",e[e.Audio_Recv_Package_Rate=2046]="Audio_Recv_Package_Rate",e[e.Audio_Recv_Package_Lost=2045]="Audio_Recv_Package_Lost",e})(xr||{}),ji=(function(e){return e[e.RTT=2006]="RTT",e[e.CONN_TYPE=801]="CONN_TYPE",e[e.STATS_UPDATE_INTERVAL=2205]="STATS_UPDATE_INTERVAL",e})(ji||{}),yT=(function(e){return e[e.RTC_PEER_CONNECTION_STATE=2219]="RTC_PEER_CONNECTION_STATE",e})(yT||{});const Ih=1e3,ST=6,ig=3,k9=Math.max(ST,ig,60);function $e(e,t,n){n!=null&&Number.isFinite(n)&&(e[t]=Math.round(Math.max(0,n)))}function x2(e){const t={[ji.CONN_TYPE]:0,[ji.RTT]:e.rtt,[ji.STATS_UPDATE_INTERVAL]:e.updateInterval?Math.round(Math.max(0,e.updateInterval)):void 0};switch(e.selectedCandidatePair.localCandidate.candidateType){case"relay":{const n=e.selectedCandidatePair.localCandidate.relayProtocol;n==="udp"&&(t[ji.CONN_TYPE]=1),n==="tcp"&&(t[ji.CONN_TYPE]=3),n==="tls"&&(t[ji.CONN_TYPE]=4);break}case"srflx":t[ji.CONN_TYPE]=2;break;case"unknown":t[ji.CONN_TYPE]=5;break;default:t[ji.CONN_TYPE]=0}return t}function M2(e){let t=0;switch(e){case"none":t=0;break;case"cpu":t=1;break;case"bandwidth":t=2;break;case"other":t=3}return t}class U2 extends Pn{constructor(t){super(),k(this,"store",void 0),k(this,"uploadWRTCStatsTimer",void 0),k(this,"uploadOutboundDenoiserStatsTimer",void 0),k(this,"uploadExtStatsTimer",void 0),k(this,"uploadExtUsageStatsTimer",void 0),k(this,"uploadInboundExtStatsTimer",void 0),k(this,"requestStats",void 0),k(this,"requestTransportStats",void 0),k(this,"requestLocalMedia",void 0),k(this,"requestRemoteMedia",void 0),k(this,"requestAllTracks",void 0),k(this,"requestVideoIsReady",void 0),k(this,"requestUploadStats",void 0),k(this,"requestUpload",void 0),k(this,"uploadOutboundStarted",!1),k(this,"uploadInboundStarted",!1),k(this,"uploadTransportStarted",!1),k(this,"uploadBaseStatsStarted",!1),k(this,"uploadExtensionUsageStarted",!1),k(this,"lastRecvStats",void 0),k(this,"lastSendStats",void 0),k(this,"lastRefRecvStats",void 0),k(this,"lastRefSendStats",void 0),k(this,"lastNormalRecvStats",void 0),k(this,"lastNormalSendStats",void 0),k(this,"lastExtendStats",{}),k(this,"needUploadStats",{}),k(this,"needUploadRenderFreezeTime",!0),k(this,"lastUploadCompensateTime",-1),k(this,"uploadCompensateDeltaTime",0),this.store=t}uploadWRTCStats(t){if(!this.requestStats||!this.requestUploadStats)return;const n=t%ig==0,r=t%ST==0,i=t%60==0;let s,o;if(this.uploadTransportStarted&&(s=this.requestStats(),this.store.useP2P&&(o=this.requestStats(!0))),!s&&this.uploadOutboundStarted&&(s=this.requestStats()),!o&&this.uploadInboundStarted&&(o=this.requestStats(!0)),s||o){var c;const l={};if(this.uploadTransportStarted&&s){const p=this.getTransportStats(s,o,n);p&&(l.misc=[p])}if(this.uploadOutboundStarted&&s){const p=this.getOutboundStats(s,r?this.lastNormalSendStats:void 0,n?this.lastRefSendStats:void 0,this.lastSendStats,i);p&&(l.outbound=[p])}if(this.uploadInboundStarted&&o){this.uploadCompensateStats(t);const p=this.getInboundStats(o,r?this.lastNormalRecvStats:void 0,n?this.lastRefRecvStats:void 0,this.lastRecvStats);p&&(l.inbound=p)}const h=(c=this.requestTransportStats)===null||c===void 0?void 0:c.call(this).connectState;h&&(Array.isArray(l.misc)?l.misc[0]&&l.misc[0].addition&&(l.misc[0].addition[yT.RTC_PEER_CONNECTION_STATE]=rb[h]):l.misc=[{addition:{[yT.RTC_PEER_CONNECTION_STATE]:rb[h]}}]),this.needUploadStats.sendType&&(Array.isArray(l.outbound)&&l.outbound[0]&&l.outbound[0].high&&(l.outbound[0].high[L2.Video_Send_Type]=this.needUploadStats.sendType),this.needUploadStats.sendType=void 0),this.requestUploadStats(l)}this.lastRecvStats=o,this.lastSendStats=s,r&&(this.lastNormalRecvStats=o,this.lastNormalSendStats=s),n&&(this.lastRefRecvStats=o,this.lastRefSendStats=s)}startUploadWRTCStats(){if(this.uploadWRTCStatsTimer)return;this.uploadBaseStatsStarted=!0;let t=1;this.uploadWRTCStatsTimer=window.setInterval((()=>{if(!this.uploadTransportStarted&&!this.uploadInboundStarted&&!this.uploadOutboundStarted){if(this.uploadBaseStatsStarted){var n,r;const i=(n=this.requestTransportStats)===null||n===void 0?void 0:n.call(this);return void(i&&((r=this.requestUploadStats)===null||r===void 0||r.call(this,{misc:[{addition:{[yT.RTC_PEER_CONNECTION_STATE]:rb[i.connectState]}}]})))}return this.stopUploadWRTCStats()}this.uploadWRTCStats(t),++t===k9+1&&(t=1)}),Ih)}uploadCompensateStats(t){if(!this.requestStats||!this.requestUploadStats||!this.requestRemoteMedia)return;const n=t%ig==0&&this.needUploadRenderFreezeTime;if(!this.uploadInboundStarted||!n)return;if(this.lastUploadCompensateTime===-1)return void(this.lastUploadCompensateTime=Date.now());const r=Math.max(-6e3,Date.now()-this.lastUploadCompensateTime-6e3);if(this.uploadCompensateDeltaTime+=r,this.lastUploadCompensateTime=Date.now(),this.uploadCompensateDeltaTime<6e3)return;const i=Math.min(Math.floor(this.uploadCompensateDeltaTime/6e3),10);this.uploadCompensateDeltaTime-=6e3*i;const s=this.requestStats(!0);new Array(i).fill(0).forEach((()=>{if(!this.requestStats||!this.requestUploadStats||!this.requestRemoteMedia)return;const o={};if(this.uploadInboundStarted&&s){const c=this.requestRemoteMedia()||[],l=[];c.forEach((h=>{let[p,E]=h;const g={peer:p.uid};if(p._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(p._videoSSRC)&&E.has(Le.VIDEO)&&p.videoTrack){const v=(function(O,I,N){if(!I.videoRecv.find((x=>x.ssrc===O)))return;const M={};if(N&&N._player){const x=N._player,{renderFreezeAccTime2:B,videoElementStatus:Z}=x;if(wc.visibility==="visible"&&Z===qr.PLAYING&&Ft().supportRequestVideoFrameCallback){const Q=Math.min(6e3,B);x.renderFreezeAccTime2=Math.max(0,B-Q),$e(M,Na.Video_Render_Freeze_Time_Render2,Q),F("USE_NEW_RENDER_FREEZE_TIME")&&$e(M,Na.Video_Render_Freeze_Time_Render,Q)}}return M})(p._videoSSRC,s,p.videoTrack);v&&(g.video=v)}g.video&&l.push(g)})),l.length>0&&(o.inbound=l,this.requestUploadStats(o))}}))}stopUploadWRTCStats(){window.clearInterval(this.uploadWRTCStatsTimer),this.uploadWRTCStatsTimer=void 0,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0),this.lastRefSendStats&&(this.lastRefSendStats.videoSend=[],this.lastRefSendStats.audioSend=[],this.lastRefSendStats=void 0),this.lastRefRecvStats&&(this.lastRefRecvStats.videoRecv=[],this.lastRefRecvStats.audioRecv=[],this.lastRefRecvStats=void 0),this.lastNormalSendStats&&(this.lastNormalSendStats.videoSend=[],this.lastNormalSendStats.audioSend=[],this.lastNormalSendStats=void 0),this.lastNormalRecvStats&&(this.lastNormalRecvStats.videoRecv=[],this.lastNormalRecvStats.audioRecv=[],this.lastNormalRecvStats=void 0),this.lastExtendStats={},this.needUploadStats={},this.lastUploadCompensateTime=-1,this.uploadCompensateDeltaTime=0,this.needUploadRenderFreezeTime=!0}getTransportStats(t,n,r){if(!this.requestStats)return;if(!r)return t.rtt==null?void 0:{addition:{[ji.RTT]:t.rtt,[ji.CONN_TYPE]:void 0,[ji.STATS_UPDATE_INTERVAL]:t.updateInterval||void 0}};const i=x2(t);if(this.store.useP2P){if(n){const s=x2(n);i[ji.CONN_TYPE]+=s[ji.CONN_TYPE]<<3}i[ji.CONN_TYPE]+=110}else i[ji.CONN_TYPE]+=100;return{addition:i}}getOutboundStats(t,n,r,i,s){if(!this.requestUploadStats||!this.requestLocalMedia)return;const o=this.requestLocalMedia();if(!o||o.length===0)return;let c,l,h;return o.forEach((p=>{let[E,{track:g,ssrcs:v}]=p;switch(E){case Ee.LocalVideoLowTrack:case Ee.LocalVideoTrack:if(E===Ee.LocalVideoTrack){var O;const I=(function(B,Z,Q,z,te,de){const me=Z.videoSend.find((ot=>ot.ssrc===B));if(!me)return;const ve={},{sentFrame:St,inputFrame:wt}=me;if(z&&($e(ve,Na.Video_Send_Qp_Sum,me.qpSumPerFrame),wt&&St)){const ot=wt.frameRate,Xt=St.frameRate;ve[Na.Video_Send_Freeze]=(function(zt,Zr){let fe=!0;return fe=!(zt<=5)&&(zt<=10?Zr<3:zt<=20?Zr<4:Zr<5),fe})(ot,Xt)?1:0}if(te){switch(St&&($e(ve,ut.Video_Send_Height,St.height),$e(ve,ut.Video_Send_Width,St.width),$e(ve,ut.Video_Send_Frame_Rate,St.frameRate)),ve[ut.Video_Send_Disabled]=Q._originMediaStreamTrack&&!Q._originMediaStreamTrack.enabled||Q._mediaStreamTrack&&!Q._mediaStreamTrack.enabled?1:0,me.adaptionChangeReason){case"none":ve[ut.Video_Send_Adaptation]=0;break;case"cpu":ve[ut.Video_Send_Adaptation]=1;break;case"bandwidth":ve[ut.Video_Send_Adaptation]=2;break;case"other":ve[ut.Video_Send_Adaptation]=3}let ot=0;me.adaptionChangeReason&&(ot+=M2(me.adaptionChangeReason)),Z.qualityLimitationReason&&(ot+=M2(Z.qualityLimitationReason)<<3),ve[ut.Video_Send_Adaptation]=ot,ve[ut.Video_Send_Player_Status]=Eb[Q._player?Q._player.videoElementStatus:"uninit"],$e(ve,ut.Video_Send_Nacks,me.nacksCount),$e(ve,ut.Video_Send_Plis,me.plisCount),$e(ve,ut.Video_Send_Firs,me.firsCount),$e(ve,ut.Video_Send_Avg_Encode,me.avgEncodeMs),$e(ve,ut.Video_Send_Huge_Frame_Sent,me.hugeFramesSent),$e(ve,ut.Video_Send_Bytes_Retransmit,me.retransmittedBytesSent),$e(ve,ut.Video_Send_Packages_Retransmit,me.retransmittedPacketsSent),$e(ve,ut.Video_Send_Key_Frames_Encoded,me.keyFramesEncoded);const Xt=te.videoSend.find((zt=>zt.ssrc===B));if(Xt){let zt=Ih*ig;Xt.timestamp&&me.timestamp&&(zt=me.timestamp-Xt.timestamp),Xt.packets!=null&&me.packets!=null&&$e(ve,ut.Video_Send_Package_Rate,1e3*(me.packets-Xt.packets)/zt),me.packetsLost!=null&&Xt.packetsLost!=null&&$e(ve,ut.Video_Send_Package_Lost,me.packetsLost-Xt.packetsLost),Xt.bytes!=null&&me.bytes!=null&&$e(ve,ut.Video_Send_Bitrate,8*(me.bytes-Xt.bytes)/zt)}}return ve})(v[0].ssrcId,t,g,n,r),N=g.__className__==="CameraVideoTrack"?3:Re(O=g._hints).call(O,an.SCREEN_TRACK)?7:10;(this.lastExtendStats.sendType!==N||s)&&(this.needUploadStats={sendType:N},this.lastExtendStats.sendType=N);const M=g&&(function(B,Z,Q,z){const te=Z.videoSend.find((me=>me.ssrc===B));if(!te)return null;const de={};if(z){const me=te.inputFrame,ve=me&&me.height||Q.videoHeight||0,St=me&&me.width||Q.videoWidth||0,wt=me&&me.frameRate||0;$e(de,ut.Video_Capture_Height,ve),$e(de,ut.Video_Capture_Width,St),$e(de,ut.Video_Capture_Frame_Rate,wt)}return de})(v[0].ssrcId,t,g,!!r),x=(function(B,Z){const Q={};return Z&&($e(Q,ut.Video_Send_Retransmit,B.bitrate.retransmit),$e(Q,ut.Video_Send_Target_Encoded,B.bitrate.targetEncoded),$e(Q,ut.Video_Send_Actual_Encoded,B.bitrate.actualEncoded),$e(Q,ut.Video_Send_Transmit,B.bitrate.transmit),$e(Q,ut.Video_Send_Bandwidth,B.sendBandwidth)),Q})(t,!!r);l=Object.assign({},I,M,x)}else h=(function(I,N,M,x,B){const Z=N.videoSend.find((z=>z.ssrc===I));if(!Z)return;const Q={};if(x){const z=Z.sentFrame;z&&($e(Q,ut.Video_Send_Low_Height,z.height),$e(Q,ut.Video_Send_Low_Width,z.width),$e(Q,ut.Video_Send_Low_Frame_Rate,z.frameRate));const te=x.videoSend.find((de=>de.ssrc===I));if(te){let de=Ih*ST;te.timestamp&&Z.timestamp&&(de=Z.timestamp-te.timestamp),te.packets!=null&&Z.packets!=null&&$e(Q,ut.Video_Send_Low_Package_Rate,1e3*(Z.packets-te.packets)/de),Z.packetsLost!=null&&te.packetsLost!=null&&$e(Q,ut.Video_Send_Low_Package_Lost,Z.packetsLost-te.packetsLost),te.bytes!=null&&Z.bytes!=null&&$e(Q,ut.Video_Send_Low_Bitrate,8*(Z.bytes-te.bytes)/de)}}return Q})(v[0].ssrcId,t,0,r);break;case Ee.LocalAudioTrack:c=g&&(function(I,N,M,x,B,Z){const Q=N.audioSend.find((te=>te.ssrc===I));if(!Q)return;const z={};if(B){z[ut.Audio_Send_Disabled]=M._originMediaStreamTrack&&!M._originMediaStreamTrack.enabled||M._mediaStreamTrack&&!M._mediaStreamTrack.enabled?1:0;const te=100*M._source.getAccurateVolumeLevel(),de=Q.inputLevel;if(de!=null){const ve=Math.ceil(50*Math.log10(100*de+1));$e(z,ut.Audio_Send_Level,ve)}$e(z,ut.Audio_Capture_PCM_Level,te),$e(z,ut.Audio_Send_AEC_Return_Loss,Q.aecReturnLoss),$e(z,ut.Audio_Send_AEC_Return_Loss_Enhancement,Q.aecReturnLossEnhancement),$e(z,ut.Audio_Send_Bytes_Retransmit,Q.retransmittedBytesSent),$e(z,ut.Audio_Send_Packages_Retransmit,Q.retransmittedPacketsSent),z[ut.Audio_Send_Freeze]=0;const me=B.audioSend.find((ve=>ve.ssrc===I));if(me){let ve=Ih*ST;me.timestamp&&Q.timestamp&&(ve=Q.timestamp-me.timestamp),me.bytes!=null&&Q.bytes!=null&&$e(z,ut.Audio_Send_Bitrate,8*(Q.bytes-me.bytes)/ve),me.packets!=null&&Q.packets!=null&&$e(z,ut.Audio_Send_Package_Rate,1e3*(Q.packets-me.packets)/ve)}}return z})(v[0].ssrcId,t,g,0,r)}})),{high:l,low:h,audio:c}}getInboundStats(t,n,r,i){if(!this.requestRemoteMedia)return;const s=this.requestRemoteMedia()||[],o=[];return s.forEach((c=>{let[l,h]=c;const p={peer:l.uid};if(h.has(Le.VIDEO)&&l.videoTrack){const E=l._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(l._videoSSRC)||!1,g=l.videoTrack?(function(v,O,I,N,M,x,B,Z){const Q=O.videoRecv.find((ot=>ot.ssrc===v));if(!Q)return;const z={},{receivedFrame:te,outputFrame:de,decodeFrameRate:me}=Q;$e(z,xr.Video_Render_Frame_Rate_Decode,me),Q.framesRateFirefox&&$e(z,xr.Video_Recv_Frame_Rate,Q.framesRateFirefox),te&&$e(z,xr.Video_Recv_Frame_Rate,te.frameRate),$e(z,xr.Video_Recv_Frame_Dropped,Q.framesDroppedCount),$e(z,xr.Video_Recv_Bytes_Retransmit,Q.retransmittedBytesReceived),$e(z,xr.Video_Recv_Packages_Retransmit,Q.retransmittedPacketsReceived),$e(z,xr.Video_Recv_Packages_Discarded,Q.packetsDiscarded),$e(z,xr.Video_Recv_Avg_Decode,Q.avgDecodeMs),$e(z,xr.Video_Recv_Avg_Processing_Delay,Q.avgProcessingDelayMs),$e(z,xr.Video_Recv_Avg_Assembly_Time,Q.avgFramesAssembledFromMultiplePacketsMs),$e(z,xr.Video_Recv_Avg_Inter_Frame_Delay,Q.avgInterFrameDelayMs),$e(z,xr.Video_Recv_Key_Frames_Decoded,Q.keyFramesDecoded);const ve=Z&&Z.videoRecv.find((ot=>ot.ssrc===v));if(ve){const ot=O.timestamp-Z.timestamp||Ih;Q.packetsLost!=null&&ve.packetsLost!=null&&$e(z,xr.Video_Recv_Package_Lost,Q.packetsLost-ve.packetsLost),ve.bytes!=null&&Q.bytes!=null&&$e(z,xr.Video_Recv_Bitrate,8*(Q.bytes-ve.bytes)/ot),ve.packets!=null&&Q.packets!=null&&$e(z,xr.Video_Recv_Package_Rate,1e3*(Q.packets-ve.packets)/ot)}const St=x&&x.videoRecv.find((ot=>ot.ssrc===v));if(St&&($e(z,Na.Video_Recv_Qp_Sum,Q.qpSumPerFrame),z[Na.Video_Recv_Freeze]=N&&rg.isRemoteVideoFreeze(I,Q,St)?1:0),B){var wt;const ot=B.videoRecv.find((zt=>zt.ssrc===v));te?($e(z,ut.Video_Recv_Height,te.height),$e(z,ut.Video_Recv_Width,te.width)):I&&($e(z,ut.Video_Recv_Height,I._videoHeight||0),$e(z,ut.Video_Recv_Width,I._videoWidth||0)),de&&$e(z,ut.Video_Recv_Frame_Rate_Output,de.frameRate);const Xt=(wt=I._player)===null||wt===void 0?void 0:wt.rendFrameRate.toFixed(0);if(Xt&&$e(z,ut.Video_Render_Frame_Rate_Render,+Xt),$e(z,ut.Video_Recv_Jitter_Buffer,Q.jitterBufferMs),$e(z,ut.Video_Recv_Current_Delay,Q.currentDelayMs),$e(z,ut.Video_Recv_Firs,Q.firsCount),$e(z,ut.Video_Recv_Nacks,Q.nacksCount),$e(z,ut.Video_Recv_Plis,Q.plisCount),I){z[ut.Video_Recv_Disabled]=I._originMediaStreamTrack.enabled&&I._mediaStreamTrack.enabled?0:1;const zt=I._player;if(zt){const{freezeTimeCounterList:Zr,renderFreezeAccTime:fe,renderFreezeAccTime2:we,videoElementStatus:Me}=zt;if(Zr&&Zr.length>0&&$e(z,Na.Video_Render_Freeze_Time,Zr.splice(0,1)[0]),M&&wc.visibility==="visible"&&Me===qr.PLAYING&&Ft().supportRequestVideoFrameCallback){const _e=Math.min(6e3,we);zt.renderFreezeAccTime2=Math.max(0,we-_e),$e(z,Na.Video_Render_Freeze_Time_Render2,_e);const w=Math.min(6e3,fe);zt.renderFreezeAccTime=Math.max(0,fe-w),$e(z,Na.Video_Render_Freeze_Time_Render,F("USE_NEW_RENDER_FREEZE_TIME")?_e:w)}if(typeof Q.totalFreezesDuration=="number"){const _e=ot&&ot.totalFreezesDuration?Q.totalFreezesDuration-ot.totalFreezesDuration:Q.totalFreezesDuration;$e(z,ut.Video_Render_Freeze_Duration,1e3*_e)}}}if(z[ut.Video_Recv_Player_Status]=Eb[I._player?I._player.videoElementStatus:"uninit"],ot&&Q.totalInterFrameDelay!==void 0&&Q.totalSquaredInterFrameDelay!==void 0&&ot.totalInterFrameDelay!==void 0&&ot.totalSquaredInterFrameDelay!==void 0){const zt=Q.totalInterFrameDelay-ot.totalInterFrameDelay,Zr=Q.totalSquaredInterFrameDelay-ot.totalSquaredInterFrameDelay,fe=Q.framesDecodeCount-ot.framesDecodeCount,we=zt/fe*1e3,Me=Math.round(1e3*Math.sqrt((Zr-Math.pow(zt,2)/fe)/fe));!isNaN(Me)&&we+Me>Math.max(3*we,we+150)&&(z[ut.Video_Recv_I_Frame_Delay]=Me)}}return z})(l._videoSSRC,t,l.videoTrack,E===!0,this.needUploadRenderFreezeTime,n,r,i):void 0;g&&(p.video=g)}if(h.has(Le.AUDIO)&&l.audioTrack){const E=l.audioTrack?(function(g,v,O,I,N,M){const x=v.audioRecv.find((z=>z.ssrc===g));if(!x)return;const B={};$e(B,xr.Audio_Recv_Jitter,x.jitterMs),$e(B,xr.Audio_Recv_Bytes_Retransmit,x.retransmittedBytesReceived),$e(B,xr.Audio_Recv_Packages_Retransmit,x.retransmittedPacketsReceived),$e(B,xr.Audio_Recv_Packages_Discarded,x.packetsDiscarded),$e(B,xr.Audio_Recv_Avg_Processing_Delay,x.avgProcessingDelayMs);const Z=M&&M.audioRecv.find((z=>z.ssrc===g));if(Z){const z=Ih;x.packets!=null&&Z.packets!=null&&$e(B,xr.Audio_Recv_Package_Rate,1e3*(x.packets-Z.packets)/z),x.packetsLost!=null&&Z.packetsLost!=null&&$e(B,xr.Audio_Recv_Package_Lost,x.packetsLost-Z.packetsLost)}if(I){const{receivedFrames:z,droppedFrames:te}=x;z!=null&&te!=null&&(B[Na.Audio_Recv_Freeze]=(Q=z)===0||100*te/Q>20?1:0)}var Q;if(N){const z=100*O._source.getAccurateVolumeLevel(),te=x.outputLevel;if(te!=null){const me=Math.ceil(50*Math.log10(100*te+1));$e(B,ut.Audio_Render_Level,me)}$e(B,ut.Audio_Recv_PCM_Level,z),O&&(B[ut.Audio_Recv_Disabled]=O._originMediaStreamTrack.enabled&&O._mediaStreamTrack.enabled?0:1),$e(B,ut.Audio_Recv_Jitter_Buffer,x.jitterBufferMs),$e(B,ut.Audio_Recv_Current_Delay,x.jitterBufferMs),B[ut.Audio_Recv_Player_Status]=Eb[Ui.getPlayerState(O.getTrackId())];const de=N.audioRecv.find((me=>me.ssrc===g));if(de){de.bytes!=null&&x.bytes!=null&&$e(B,ut.Audio_Recv_Bitrate,8*(x.bytes-de.bytes)/(Ih*ig));const me=x.concealedSamples-de.concealedSamples;me>0&&$e(B,ut.Audio_Recv_Concealed_Samples,me);const ve=x.totalSamplesReceived-de.totalSamplesReceived;ve>0&&$e(B,ut.Audio_Recv_Total_Samples_Received,ve);const St=x.freezeSamples80-de.freezeSamples80;St>0&&$e(B,ut.Audio_Render_Freeze_Samples_80ms,St);const wt=x.freezeSamples200-de.freezeSamples200;wt>0&&$e(B,ut.Audio_Render_Freeze_Samples_200ms,wt);const ot=x.freezeMs80-de.freezeMs80;$e(B,ut.Audio_Render_Freeze_Time_80ms,ot<0?0:ot);const Xt=x.freezeMs200-de.freezeMs200;$e(B,ut.Audio_Render_Freeze_Time_200ms,Xt<0?0:Xt)}}return B})(l._audioSSRC,t,l.audioTrack,n,r,i):void 0;E&&(p.audio=E)}(p.video||p.audio)&&o.push(p)})),this.needUploadRenderFreezeTime=!this.needUploadRenderFreezeTime,o}startUploadTransportStats(){this.uploadTransportStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats()}stopUploadTransportStats(){this.uploadTransportStarted=!1}startUploadOutboundStats(){this.uploadOutboundStarted||(this.uploadOutboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=window.setInterval((()=>{if(!this.requestAllTracks||!this.requestUpload)return;const t=(this.requestAllTracks()||[]).find((n=>n instanceof KE));if(t&&t._external.getDenoiserStats){const n=t._external.getDenoiserStats();n&&this.requestUpload(YE.DENOISER_STATS,n)}}),2e3),this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=window.setInterval((()=>{!this.requestAllTracks||!this.requestUpload||this.requestAllTracks().forEach((t=>{t.getProcessorStats().forEach((n=>{this.requestUpload&&this.requestUpload(n.type,n.stats)}))}))}),2e3))}stopUploadOutboundStats(){this.uploadOutboundStarted&&(this.uploadOutboundStarted=!1,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRefSendStats&&(this.lastRefSendStats.videoSend=[],this.lastRefSendStats.audioSend=[],this.lastRefSendStats=void 0),this.lastNormalSendStats&&(this.lastNormalSendStats.videoSend=[],this.lastNormalSendStats.audioSend=[],this.lastNormalSendStats=void 0),this.lastExtendStats={},this.needUploadStats={},this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=void 0,this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=void 0)}startUploadInboundStats(){this.uploadInboundStarted||(this.uploadInboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=window.setInterval((()=>{!this.requestUpload||!this.requestRemoteMedia||(this.requestRemoteMedia()||[]).forEach((t=>{let[n,r]=t;r.has(Le.VIDEO)&&n.videoTrack&&n.videoTrack.getProcessorStats().forEach((i=>{this.requestUpload&&this.requestUpload(i.type,i.stats)})),r.has(Le.AUDIO)&&n.audioTrack&&n.audioTrack.getProcessorStats().forEach((i=>{this.requestUpload&&this.requestUpload(i.type,i.stats)}))}))}),2e3))}stopUploadInboundStats(){this.uploadInboundStarted&&(this.uploadInboundStarted=!1,this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0),this.lastRefRecvStats&&(this.lastRefRecvStats.videoRecv=[],this.lastRefRecvStats.audioRecv=[],this.lastRefRecvStats=void 0),this.lastNormalRecvStats&&(this.lastNormalRecvStats.videoRecv=[],this.lastNormalRecvStats.audioRecv=[],this.lastNormalRecvStats=void 0),this.lastUploadCompensateTime=-1,this.uploadCompensateDeltaTime=0,this.needUploadRenderFreezeTime=!0,this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=void 0)}startUploadExtensionUsageStats(){if(this.uploadExtensionUsageStarted)return;this.uploadExtensionUsageStarted=!0,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer);const t=new Map;this.uploadExtUsageStatsTimer=window.setInterval((async()=>{const n=Date.now(),r={connectionInterval:F("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3,details:[],lts:n};let i=[];const s=this.requestAllTracks&&this.requestAllTracks()||[];for(const h of s)!h.muted&&h.enabled&&(i=i.concat(await h.getProcessorUsage()));const o=this.requestRemoteMedia&&this.requestRemoteMedia()||[];for(const[h,p]of o)p.has(Le.VIDEO)&&h.videoTrack&&(i=i.concat(await h.videoTrack.getProcessorUsage())),p.has(Le.AUDIO)&&h.audioTrack&&(i=i.concat(await h.audioTrack.getProcessorUsage()));if(i.length===0)return;r.details=(function(h,p){const E={};for(const{id:I,value:N,level:M,direction:x}of h){var g;const B=(g=p.get(I))!==null&&g!==void 0?g:0,Z=N===2?B+F("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3:B;var v,O;p.set(I,Z),E[I]?(N===2&&(E[I].value=N),M>E[I].level&&(E[I].level=M),x==="remote"&&(E[I].remoteUidCount+=1),E[I].totalTs=(v=p.get(I))!==null&&v!==void 0?v:0):E[I]={value:N,level:M,remoteUidCount:x==="local"?0:1,totalTs:(O=p.get(I))!==null&&O!==void 0?O:0}}return Object.keys(E).map((I=>{const{level:N,value:M,totalTs:x}=E[I];return{id:I,level:N,value:M,totalTs:x}}))})(i,t);const c=Date.now(),l=c>n?c:n+1;this.requestUpload&&this.requestUpload(YE.EXTENSION_USAGE_STATS,{usageStats:r,sendTs:l})}),F("EXTENSION_USAGE_UPLOAD_INTERVAL"))}stopUploadExtensionUsageStats(){this.uploadExtensionUsageStarted&&(this.uploadExtensionUsageStarted=!1,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer),this.uploadExtUsageStatsTimer=void 0)}stopUploadBaseStats(){this.uploadBaseStatsStarted=!1}}const L9=F("ICE_RESTART_INTERVAL");let TT=new Map,Jf=new Map,Vd=[Jr.UDP_TCP_RELAY,Jr.TCP_RELAY,Jr.RELAY],mI=F("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&Ft().supportPCSetConfiguration;function V2(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const n=TT.get(e.id);n&&(window.clearTimeout(n),TT.delete(e.id));const r=Jf.get(e.id);t&&r&&r.index===Vd.length-1&&(R.debug("[".concat(e.id,"] reset ICE restart policy")),Jf.delete(e.id))}function j2(e,t,n){if(TT.size===0&&Jf.size===0&&(Array.isArray(F("RESTART_SEQUENCE"))&&F("RESTART_SEQUENCE").length>0&&!(function(c,l){if(c.length!==l.length)return!1;for(let h=0;h<c.length;h+=1){const p=c[h];if(c.filter((E=>E===p)).length!==l.filter((E=>E===p)).length)return!1}return!0})(Vd,F("RESTART_SEQUENCE"))&&(Vd=F("RESTART_SEQUENCE").filter((c=>{var l;if(Re(l=Object.values(Jr)).call(l,c))return!0})),R.debug("use reconnection policy from config distribution, queues: ".concat(Vd.join(" => ")))),mI=F("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&Ft().supportPCSetConfiguration),Vd.length===0)return void n();let r,{index:i=0,type:s}=Jf.get(e.id)||{};if(mI&&s===Jr.RELAY)return void n();let o=s&&i>=Vd.length-1;if(mI)s=Jr.RELAY;else{if(o)return void n();s?(i++,s=Vd[i]):(s=Vd[0],i=0)}R.debug("[".concat(e.id,"] choose ICE restart policy: ").concat(s,", index: ").concat(i)),t(s),Jf.set(e.id,{index:i,type:s}),r=window.setTimeout((()=>j2(e,t,n)),L9),TT.set(e.id,r)}var It;function F2(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable}))),n.push.apply(n,r)}return n}function Ac(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?F2(Object(n),!0).forEach((function(r){k(e,r,n[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):F2(Object(n)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))}))}return e}function B2(e){var t,n,r,i=2;for(typeof Symbol<"u"&&(n=O0,r=Symbol.iterator);i--;){if(n&&(t=e[n])!=null)return t.call(e);if(r&&(t=e[r])!=null)return new RT(t.call(e));n="@@asyncIterator",r="@@iterator"}throw new TypeError("Object is not async iterable")}function RT(e){function t(n){if(Object(n)!==n)return Pe.reject(new TypeError(n+" is not an object."));var r=n.done;return Pe.resolve(n.value).then((function(i){return{value:i,done:r}}))}return RT=function(n){this.s=n,this.n=n.next},RT.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(n){var r=this.s.return;return r===void 0?Pe.resolve({value:n,done:!0}):t(r.apply(this.s,arguments))},throw:function(n){var r=this.s.return;return r===void 0?Pe.reject(n):t(r.apply(this.s,arguments))}},new RT(e)}let sg=(It=class extends Pn{get state(){return this._state}set state(e){const t=this._state;this._state=e,this.emit(Xe.StateChange,t,this._state)}constructor(e,t){super(),k(this,"isPlanB",void 0),k(this,"store",void 0),k(this,"statsUploader",void 0),k(this,"connection",void 0),k(this,"localTrackMap",new Map),k(this,"remoteUserMap",new Map),k(this,"localDataChannels",[]),k(this,"remoteDataChannelMap",new Map),k(this,"pendingLocalTracks",[]),k(this,"pendingRemoteTracks",[]),k(this,"pendingLocalDataChannels",[]),k(this,"pendingRemoteDataChannels",[]),k(this,"statsCollector",void 0),k(this,"shouldForwardP2PCreation",void 0),k(this,"iceFailedCount",0),k(this,"dtlsFailedCount",0),k(this,"mutex",void 0),k(this,"_state",Zt.Disconnected),k(this,"_pcStatsUploadType",F("NEW_ICE_RESTART")?vl.FIRST_CONNECTION:vl.OLD_FIRST_CONNECTION),k(this,"_isStartRestartIce",!1),k(this,"_restartTimer",void 0),k(this,"_isTryConnecting",!1),k(this,"_iceError",null),k(this,"_forceTurn",!1),k(this,"_isWaitPcToRePub",!1),k(this,"handleMuteLocalTrack",(async(n,r,i)=>{const s=await this.mutex.lock("Locking from P2PChannel.handleMuteLocalTrack");try{if(!this.connection||this.state!==Zt.Connected)return void i(new ce(U.INVALID_OPERATION,"Cannot call P2PChannel.handleMuteLocalTrack before connection established."));const o=this.filterTobeMutedTracks(n);if(o.length===0)return void r();const c=o.find((h=>h[0]==="videoLowTrack"));if(c){const h=c[1];this.store.enableInstantMuteRestore?(h.track._originMediaStreamTrack.enabled=!1,R.info("[".concat(this.store.clientId,"] P2PChannel muteLocalLowTrack without close sender because enableInstantMuteRestore is true"))):h.track._originMediaStreamTrack.stop()}this.store.enableInstantMuteRestore?R.info("[".concat(this.store.clientId,"] P2PChannel muteLocalTrack without close sender because enableInstantMuteRestore is true")):await this.connection.muteLocal(o.map((h=>{let[,{id:p}]=h;return p})));const l=this.createMuteMessage(o);await cn(this,Xe.RequestMuteLocal,l),r()}catch(o){i(o)}finally{s()}})),k(this,"handleUnmuteLocalTrack",(async(n,r,i)=>{const s=await this.mutex.lock("Locking from P2PChannel.handleUnmuteLocalTrack");try{if(!this.connection||this.state!==Zt.Connected)return void i(new ce(U.INVALID_OPERATION,"Cannot call P2PChannel.handleUnmuteLocalTrack before connection established."));const o=this.filterTobeUnmutedTracks(n);if(o.length===0)return void r();const c=o.find((h=>h[0]==="videoLowTrack"));if(c){const h=c[1];if(this.store.enableInstantMuteRestore)h.track._originMediaStreamTrack.enabled=!0,R.info("[".concat(this.store.clientId,"] P2PChannel unmuteLocalLowTrack without close sender because enableInstantMuteRestore is true"));else{if(h.track._originMediaStreamTrack.stop(),!F("DISABLE_DUAL_STREAM_USE_ENCODING")&&Ft().supportDualStreamEncoding){const p=n._mediaStreamTrack.clone();h.track._mediaStreamTrack=p,h.track._originMediaStreamTrack=p}else{const p=fI(n,VE(this,Xe.RequestLowStreamParameter));h.track._mediaStreamTrack=p,h.track._originMediaStreamTrack=p}await new Pe(((p,E)=>{this.handleReplaceTrack(h.track,p,E,!0)}))}}this.store.enableInstantMuteRestore?R.info("[".concat(this.store.clientId,"] P2PChannel unmuteLocalTrack without close sender because enableInstantMuteRestore is true")):await this.connection.unmuteLocal(o.map((h=>{let[,{id:p}]=h;return p})));const l=this.createUnmuteMessage(o);await cn(this,Xe.RequestUnmuteLocal,l),r()}catch(o){i(o)}finally{s()}})),k(this,"handleUpdateVideoEncoder",(async(n,r,i,s)=>{let o;s||(o=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoEncoder"));try{const l=this.localTrackMap.get(Ee.LocalVideoTrack);if(!this.connection||!l||l.track!==n||this.state!==Zt.Connected)return void r();const{id:h,track:p}=l;await this.connection.updateSendParameters(h,p),await this.connection.updateEncoderConfig(h,p),this.emit(Xe.UpdateVideoEncoder,p),r()}catch(l){i(l)}finally{var c;(c=o)===null||c===void 0||c()}})),k(this,"handleUpdateVideoSendParameters",(async(n,r,i)=>{const s=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoSendParameters");try{const o=this.localTrackMap.get(Ee.LocalVideoTrack);if(!this.connection||!o||o.track!==n||this.state!==Zt.Connected)return void r();const{id:c,track:l}=o;await this.connection.updateSendParameters(c,l),r()}catch(o){i(o)}finally{s()}})),k(this,"handleReplaceMixingTrack",(async(n,r,i,s)=>{if(!this.connection||this.state!==Zt.Connected)return void r();const o=hI([n]);let c;R.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(o.getTrackId(),"]")),typeof s=="boolean"&&s||(c=await this.mutex.lock("From P2PChannel.handleReplaceMixingTrack"));try{await this.replaceTrack(n,o),r()}catch(h){i(h)}finally{var l;(l=c)===null||l===void 0||l()}})),k(this,"handleReplaceTrack",(async(n,r,i,s)=>{let o;R.debug("[".concat(this.store.clientId,"] P2PChannel handleReplaceTrack for [track-id-").concat(n.getTrackId(),"]")),typeof s=="boolean"&&s||(o=await this.mutex.lock("From P2PChannel.handleReplaceTrack"));try{var c;const h=Array.from(this.localTrackMap.entries()).find((p=>{let[,{track:E}]=p;return n===E}));if(!this.connection||!h||this.state!==Zt.Connected)return void r();if(await((c=this.connection)===null||c===void 0?void 0:c.replaceTrack(n,h[1].id)),this.isPlanB){const p=h[1];p.id=n._mediaStreamTrack.id,this.localTrackMap.set(h[0],p)}if(h[0]===Ee.LocalVideoTrack&&!F("DISABLE_DUAL_STREAM_USE_ENCODING")&&Ft().supportDualStreamEncoding){const p=this.localTrackMap.get(Ee.LocalVideoLowTrack);if(p){const E=n._mediaStreamTrack.clone();p.track._originMediaStreamTrack.stop(),p.track._mediaStreamTrack=E,p.track._originMediaStreamTrack=E,await new Pe(((g,v)=>{this.handleReplaceTrack(p.track,g,v,!0)}))}}r()}catch(h){i(h)}finally{var l;(l=o)===null||l===void 0||l()}})),k(this,"handleGetRTCStats",(n=>{n(this.statsCollector.getRTCStats())})),k(this,"handleGetLocalVideoStats",(n=>{n(this.statsCollector.getLocalVideoTrackStats())})),k(this,"handleGetLocalAudioStats",(n=>{n(this.statsCollector.getLocalAudioTrackStats())})),k(this,"handleGetRemoteVideoStats",(n=>this.statsCollector.getRemoteVideoTrackStats(n.uid)[n.uid])),k(this,"handleGetRemoteAudioStats",(n=>this.statsCollector.getRemoteAudioTrackStats(n.uid)[n.uid])),this.store=e,this.statsCollector=t,this.statsCollector.addP2PChannel(this),this.statsUploader=new U2(this.store),this.bindStatsUploaderEvents(),this.mutex=new Yr("P2PChannel-mutex",this.store.clientId),this.isPlanB=!Ft().supportUnifiedPlan||F("CHROME_FORCE_PLAN_B")&&ml(),this.shouldForwardP2PCreation=F("FORWARD_P2P_CREATION")&&Ft().supportPCSetConfiguration&&H0(),this.shouldForwardP2PCreation&&(this.connection=vT(this.store),this.emit(Xe.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection))}async startP2PConnection(e,t){var n;this.state=Zt.New,this._forceTurn=D2(e),R.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] forceTurn: ").concat(this._forceTurn));const r=this.shouldForwardP2PCreation&&((n=this.connection)===null||n===void 0?void 0:n.peerConnectionState)==="closed";if((!this.shouldForwardP2PCreation||r||t)&&((r||t)&&this.connection&&(R.warning("[".concat(this.store.clientId,"] P2PChannel.startP2PConnection ForwardP2P closed.")),this.resetConnection(this.connection)),this.connection=vT(this.store,e),this.emit(Xe.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),!this.connection)throw new ce(U.UNEXPECTED_ERROR,"Cannot P2PChannel.startConnection before P2PConnection initialization .");return this._pcStatsUploadType=F("NEW_ICE_RESTART")?vl.FIRST_CONNECTION:vl.OLD_FIRST_CONNECTION,this._isTryConnecting=!0,this._isStartRestartIce=!1,this._iceError=null,this.connection.setConfiguration(e),this.connection.establishPromise}async connect(e){if(!this.connection)throw new ce(U.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");if(this.isPreallocation()&&this.state===Zt.Connected){if(this.connection instanceof oo&&this.connection.checkDtlsParameters(e.dtlsParameters.fingerprints))return R.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] dtls parameters mismatch, try next.")),We.reportApiInvoke(this.store.sessionId,{name:Bn.MISMATCH_DTLS_PARAMETERS,options:[e.dtlsParameters.fingerprints],tag:In.TRACER}).onSuccess(),void setTimeout((()=>{this.emit(Xe.RequestReconnect)}));await this.connection.updateRemoteConnect(e)}else this.store.peerConnectionStart(),await this.connection.connect(e),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=Zt.Connected}updateRemoteRTPCapabilities(e){const t=Array.from(this.localTrackMap.entries()).filter((i=>{var s;let[o]=i;return Re(s=[Ee.LocalVideoLowTrack,Ee.LocalVideoTrack]).call(s,o)})),n=t.map((i=>{let[,{id:s}]=i;return s})),r=t.map((i=>{let[s]=i;return s}));if(this.connection instanceof oo){if(We.updateRemoteRTPCapabilities(this.store.sessionId,{trackTypes:JSON.stringify(r),localCodecs:JSON.stringify(this.connection.localCodecs),remoteCodecs:JSON.stringify(e)}),!Re(e).call(e,this.store.codec)){const i=["vp9","vp8","h264"].find((s=>Re(e).call(e,s)));i&&(this.store.codec=i,R.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId," updateRemoteRTPCapabilities] default codec is not available, hence the fallback to ").concat(i,".")))}this.connection.updateRemoteRTPCapabilities(n,e)}}async getEstablishParams(){var e;if(this.connection instanceof oo&&this.connection.peerConnectionState!=="closed"&&Re(e=[Zt.New,Zt.Connected]).call(e,this.state))return this.connection.establishPromise}async publishDataChannel(e){if(!this.connection||this.state!==Zt.Connected){if(this.state===Zt.Disconnected)throw new ce(U.UNEXPECTED_ERROR,"PeerConnection already disconnected.");return e.forEach((n=>{var r;Re(r=this.pendingLocalDataChannels).call(r,n)||this.pendingLocalDataChannels.push(n)})),[]}const t=this.filterTobePublishedDataChannels(e);return t.length===0?[]:(t.forEach((n=>{const r=Date.now();this.store.publish(n.id.toString(),"datachannel",r)})),await this.connection.createDataChannels(this.store.uid,t),t.forEach((n=>{this.localDataChannels.push(n);const r=Date.now();this.store.publish(n.id+"","datachannel",void 0,r)})),e.map((n=>({streamId:n.id,ordered:n.ordered,maxRetransmits:n.maxRetransmits,metadata:n.metadata,channelId:n._originDataChannelId}))))}publish(e,t,n){var r=this;return eo((function*(){const i=yield jt(r.mutex.lock("From P2PChannel.publish"));try{var s;const o=r.connection&&Re(s=["disconnected","failed"]).call(s,r.connection.peerConnectionState);if(!r.connection||r.state!==Zt.Connected||o){if(r.state===Zt.Disconnected)throw new ce(U.UNEXPECTED_ERROR,"PeerConnection already disconnected.");r.throwIfTrackTypeNotMatch(e);const l=e.filter((h=>r.pendingLocalTracks.indexOf(h)===-1));return r.pendingLocalTracks=r.pendingLocalTracks.concat(l),void(o&&(r._isWaitPcToRePub=!0))}r.store.pubId=r.store.pubId+1,Qr.markPublishStart(r.store.clientId,r.store.pubId);const c=r.filterTobePublishedTracks(e,t,n);if(c.length===0)return void(yield jt(r.tryToUnmuteAudio(e)));yield*mS(B2(r.doPublish(r.connection,c)))}finally{i()}}))()}doPublish(e,t){var n=this;return eo((function*(){t.forEach((g=>{let{track:v,type:O}=g;const I=Date.now();n.store.publish(v.getTrackId(),O===Ee.LocalAudioTrack?"audio":"video",I)})),n.bindLocalTrackEvents(t);const r=t.map((g=>{let{track:v}=g;return v})),i=yield jt(e.send(r,n.store.codec,n.store.audioCodec)),s=(yield jt(i.next())).value,o=n.createGatewayPublishMessage(t,s);let c;try{c=yield o}catch(g){throw i.throw(g),g?.code===U.WS_ABORT&&t.forEach((v=>{let{track:O}=v;n.pendingLocalTracks.indexOf(O)===-1&&n.pendingLocalTracks.push(O)})),n.unbindLocalTrackEvents(t),g}const l=n.mapPubResToRemoteConfig(o,c,r),h=(yield jt(i.next(l))).value;if(n.state===Zt.Disconnected)throw new ce(U.UNEXPECTED_ERROR,"PeerConnection already disconnected.");F("ENABLE_VIDEO_SEI");const p=F("ENABLE_ENCODED_TRANSFORM"),E=F("ENABLE_AUDIO_METADATA");r.forEach((async g=>{const v=g.getRTCRtpTransceiver();if(!v||!p)return;const{interceptLocalVideoFrame:O,interceptLocalAudioFrame:I}=dT();g.trackMediaType===Le.VIDEO?await O(v.sender,g):g.trackMediaType===Le.AUDIO&&await I(v.sender,{metadata:E?()=>{const N=g.metadata.shift();return N&&N.value}:void 0})})),t.forEach((g=>{let{type:v}=g;n.statsCollector.addLocalStats(v)})),n.assignLocalTracks(t,h),n.statsUploader.startUploadOutboundStats(),t.forEach((g=>{let{track:v,type:O}=g;const I=Date.now();n.store.publish(v.getTrackId(),O===Ee.LocalAudioTrack?"audio":"video",void 0,I)}))}))()}async updateVideoStreamParameter(e,t){const n=this.localTrackMap.get(t);if(!n||!this.connection)return;if(!(n.track instanceof vn))return R.warn("[updateVideoStreamParameter]: track is not an instance of LocalVideoTrack");const{track:r}=n,i=(function(s,o){const c={};return s.height&&s.width&&(c.scaleResolutionDownBy=qb(s,o)),c.maxFramerate=s.framerate?Es(s.framerate):void 0,c.maxBitrate=s.bitrate?1e3*s.bitrate:void 0,c})(e,r);if(r._encoderConfig||(r._encoderConfig={}),t!==Ee.LocalVideoLowTrack||!F("DISABLE_DUAL_STREAM_USE_ENCODING")&&Ft().supportDualStreamEncoding)i.scaleResolutionDownBy!=null&&(r._encoderConfig.scaleResolutionDownBy=i.scaleResolutionDownBy);else{const s=r._originMediaStreamTrack;if(!s.canvas)return R.warn("[".concat(r.getTrackId(),"] no canvas on track"));(function(o,c){const l=o.canvas;c.width&&(l.width=Es(c.width)),c.height&&(l.height=Es(c.height)),c.framerate&&(l.stopCapture&&l.stopCapture(),l.stopCapture=vb((()=>{!l.startCapture&&l.stopCapture&&l.stopCapture(),l.startCapture&&l.startCapture()}),Es(c.framerate)))})(s,e)}i.maxBitrate!=null&&(r._encoderConfig.bitrateMax=i.maxBitrate/1e3),i.maxFramerate!=null&&(r._encoderConfig.frameRate&&typeof r._encoderConfig.frameRate=="object"?r._encoderConfig.frameRate.max=i.maxFramerate:r._encoderConfig.frameRate={max:i.maxFramerate}),R.debug("[".concat(r.getTrackId(),"] LowStreamEncoderConfig: , ").concat(JSON.stringify(r._encoderConfig))),await this.connection.updateRtpSenderEncodings(r)}publishLowStream(e){var t=this;return eo((function*(){if(!t.connection||t.state!==Zt.Connected)return;const n=yield jt(t.mutex.lock("Locking from P2PChannel.publishLowStream"));try{const i=t.localTrackMap.get(Ee.LocalVideoTrack);if(!i)throw new ce(U.UNEXPECTED_ERROR,"Could not find high stream");if(t.localTrackMap.has(Ee.LocalVideoLowTrack))throw new ce(U.UNEXPECTED_ERROR,"[".concat(t.store.clientId,"] Can't publish low stream when stream already publish"));const s=[{track:t.getLowVideoTrack(i.track,e),type:Ee.LocalVideoLowTrack}];if(yield*mS(B2(t.doPublish(t.connection,s))),i.track.muted||!i.track.enabled){var r;const o=(r=t.localTrackMap.get(Ee.LocalVideoLowTrack))===null||r===void 0?void 0:r.id;o!==void 0&&(yield jt(t.connection.muteLocal([o])))}}finally{n()}}))()}async republish(){this.pendingLocalTracks.length>0&&(R.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await Fr(this,Xe.RequestRePublish,this.pendingLocalTracks),this.emit(Xe.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[]),this.pendingLocalDataChannels.length>0&&(R.debug("Emit P2PChannelEvents.RequestRePublishDataChannel to republish datachannels."),await Fr(this,Xe.RequestRePublishDataChannel,this.pendingLocalDataChannels),this.pendingLocalDataChannels=[]),this._isWaitPcToRePub=!1}async reSubscribe(e){for(let t=this.pendingRemoteTracks.length-1;t>=0;t--){const{user:n,kind:r}=this.pendingRemoteTracks[t];(r!==Le.AUDIO||n._audio_added_&&n._audioSSRC)&&(r!==Le.VIDEO||n._video_added_&&n._videoSSRC)||this.pendingRemoteTracks.splice(t,1)}if(e)await Fr(this,Xe.RequestReSubscribe,this.pendingRemoteTracks);else for(const{user:t,kind:n}of this.pendingRemoteTracks)await this.subscribe(t,n,n===Le.VIDEO?t._videoSSRC:t._audioSSRC);this.pendingRemoteTracks.forEach((t=>{let{user:n}=t;this.emit(Xe.MediaReconnectEnd,n.uid)})),this.pendingRemoteTracks=[]}async unpublish(e){if(!this.connection||this.state!==Zt.Connected)return void e.forEach((r=>{const i=this.pendingLocalTracks.indexOf(r);i!==-1&&this.pendingLocalTracks.splice(i,1)}));const t=this.filterTobeUnpublishedTracks(e);if(t.length===0)return;const n=t.find((r=>r[0]==="videoLowTrack"));return n&&n[1].track.close(),this.doUnpublish(this.connection,t)}async unpublishDataChannel(e){if(!this.connection||this.state!==Zt.Connected)return void e.forEach((n=>{const r=this.pendingLocalDataChannels.indexOf(n);r!==-1&&this.pendingLocalDataChannels.splice(r,1)}));const t=this.filterTobeUnpublishedDataChannels(e);return t.length!==0?(t.forEach((n=>{const r=this.localDataChannels.indexOf(n);r!==-1&&this.localDataChannels.splice(r,1)})),this.localDataChannels.length===0&&await this.connection.stopDataChannels(this.store.uid),t.map((n=>n.id))):void 0}async unpublishLowStream(){if(!this.connection||this.state!==Zt.Connected)return;const e=this.localTrackMap.get(Ee.LocalVideoLowTrack);if(!e)return;e.track.close();const t=[[Ee.LocalVideoLowTrack,e]];return this.doUnpublish(this.connection,t)}async doUnpublish(e,t){const n=this.createGatewayUnpublishMessage(t);return await e.stopSending(t.map((r=>{let[,{id:i}]=r;return i}))),this.withdrawLocalTracks(t),this.unbindLocalTrackEvents(t.map((r=>{let[i,{track:s}]=r;return{type:i,track:s}}))),t.forEach((r=>{let[i]=r;this.statsCollector.removeLocalStats(i)})),this.localTrackMap.size===0&&this.statsUploader.stopUploadOutboundStats(),n}async subscribeDataChannel(e,t){if(!this.connection||this.state!==Zt.Connected)throw new ce(U.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");const n=t.filter((r=>{var i;return!((i=this.remoteDataChannelMap.get(e))!==null&&i!==void 0&&i.get(r.id))}));if(n.length!==0)return await this.connection.createDataChannels(e.uid,n),n.forEach((r=>{var i;this.remoteDataChannelMap.has(e)?(i=this.remoteDataChannelMap.get(e))===null||i===void 0||i.set(r.id,r):this.remoteDataChannelMap.set(e,new Map([[r.id,r]]));const s=this.pendingRemoteDataChannels.findIndex((o=>{let{user:c,id:l}=o;return c.uid===e.uid&&l===r.id}));s!==-1&&this.pendingRemoteDataChannels.splice(s,1)})),n.map((r=>r.id))}async subscribe(e,t,n,r,i){var s;if(!this.connection||this.state!==Zt.Connected)throw new ce(U.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");if((s=this.remoteUserMap.get(e))!==null&&s!==void 0&&s.has(t))return;let o,c,l,h;const p=this.connection.getPreMedia(n);if(p)R.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] preSSRCMap has ssrcId: ").concat(n,", no need to send sub to gateway.")),l=p.transceiver,o=p.track,c=p.mid,h=p.player,p.firstVideoRender&&this.store.firstVideoFrameDecoded(e.uid,{firstPreRender:p.firstVideoRender});else if(i){const v=i.find((I=>{let{stream_type:N}=I;return N===t}));if(!v)throw new ce(U.UNEXPECTED_ERROR,"Cannot subscribe to remote ".concat(t," for user: ").concat(e.uid," because subscribe answer from gateway does not contain stream_type: ").concat(t,"."));const O=await this.connection.receive(t,v.ssrcs,String(e._uintid),v.attributes);this.connection instanceof oo&&(l=O.transceiver),o=O.track,c=O.id}else{const v=await this.connection.receive(t,[{ssrcId:n,rtx:r}],String(e._uintid),void 0);this.connection instanceof oo&&(l=v.transceiver),o=v.track,c=v.id}if(t===Le.AUDIO?(e._audioTrack?e._audioTrack._updateOriginMediaStreamTrack(o):(e._audioTrack=new Uf(o,e.uid,e._uintid,this.store),R.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(e._audioTrack.getTrackId()))),l&&e._audioTrack._updateRtpTransceiver(l),this.bindRemoteTrackEvents(e,e._audioTrack)):(e._videoTrack?e._videoTrack._updateOriginMediaStreamTrack(o):(e._videoTrack=new Mf(o,e.uid,e._uintid,this.store,h),R.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(e._videoTrack.getTrackId())),e._videoTrack.once(ro.PLAY_START,(()=>{this.store.firstVideoFrameDecoded(e.uid,{playStart:Date.now()})})),e._videoTrack.once(ro.PLAY_END,(()=>{this.store.firstVideoFrameDecoded(e.uid,{playEnd:Date.now()}),this.reportVideoFirstFrameRender(e)})),h?e._videoTrack.once(ro.FIRST_FRAME_RENDER,(()=>{this.store.firstVideoFrameDecoded(e.uid,{firstRender:Date.now()}),this.reportVideoFirstFrameRender(e)})):e._videoTrack.once(ro.FIRST_FRAME_DECODED,(()=>{this.store.firstVideoFrameDecoded(e.uid,{firstRender:Date.now()}),this.reportVideoFirstFrameRender(e)}))),l&&e._videoTrack._updateRtpTransceiver(l),this.bindRemoteTrackEvents(e,e._videoTrack)),l&&F("ENABLE_ENCODED_TRANSFORM")){const{interceptRemoteVideoFrame:v,interceptRemoteAudioFrame:O}=dT();t==Le.VIDEO?await v(l.receiver,{onSei:F("ENABLE_VIDEO_SEI")&&(I=>{var N;return(N=e._videoTrack)===null||N===void 0?void 0:N._onSei(I)})}):t==Le.AUDIO&&await O(l.receiver,{enableTopn:!!F("ENABLE_AUDIO_TOPN"),enableMetadata:!!F("ENABLE_AUDIO_METADATA"),enablePts:!!F("ENABLE_AUDIO_PTS"),onMetadata:I=>{this.safeEmit(Xe.AudioMetadata,I)},onPts:I=>{this.safeEmit(Xe.AudioPts,I)}})}const E=this.remoteUserMap.get(e);E?E.set(t,c):this.remoteUserMap.set(e,new Map([[t,c]])),this.statsCollector.addRemoteStats(e.uid),this.statsUploader.startUploadInboundStats();const g=this.pendingRemoteTracks.findIndex((v=>{let{user:O,kind:I}=v;return O.uid===e.uid&&t===I}));g!==-1&&(this.pendingRemoteTracks.splice(g,1),this.emit(Xe.MediaReconnectEnd,e.uid))}async massSubscribe(e){return this.massSubscribeNoLock(e)}async massSubscribeNoLock(e){if(!this.connection||this.state!==Zt.Connected)throw new ce(U.INVALID_OPERATION,"Cannot subscribeAll remote users when peerConnection disconnected.");e=e.filter((i=>{var s;let{user:o,mediaType:c}=i;return!((s=this.remoteUserMap.get(o))!==null&&s!==void 0&&s.has(c))}));const t=[],n=new Map;e.forEach((i=>{if(!this.connection)return;const s=this.connection.getPreMedia(i.ssrcId);if(s){const{track:o,mid:c,transceiver:l,player:h}=s;n.set(i.ssrcId,{track:o,id:c,transceiver:l,player:h})}else t.push(i)}));const r=await this.connection.batchReceive(t.map((i=>{let{user:s,mediaType:o,ssrcId:c,rtxSsrcId:l}=i;return{kind:o,ssrcMsg:[{ssrcId:c,rtx:l}],mslabel:String(s._uintid)}})));t.forEach(((i,s)=>{n.set(i.ssrcId,r[s])}));for(const{user:i,mediaType:s,ssrcId:o}of e){const c=n.get(o);if(!c)return void R.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] cannot find ").concat(i.uid," subscribe data,").concat(s,", ").concat(o));const{track:l,id:h,transceiver:p,player:E}=c;if(p&&F("ENABLE_ENCODED_TRANSFORM")){const{interceptRemoteVideoFrame:O,interceptRemoteAudioFrame:I}=dT();s==Le.VIDEO?await O(p.receiver,{onSei:F("ENABLE_VIDEO_SEI")&&(N=>{var M;return(M=i._videoTrack)===null||M===void 0?void 0:M._onSei(N)})}):s==Le.AUDIO&&await I(p.receiver,{enableTopn:!!F("ENABLE_AUDIO_TOPN"),enableMetadata:!!F("ENABLE_AUDIO_METADATA"),enablePts:!!F("ENABLE_AUDIO_PTS"),onMetadata:N=>{this.safeEmit(Xe.AudioMetadata,N)},onPts:N=>{this.safeEmit(Xe.AudioPts,N)}})}if(s===Le.AUDIO?(i._audioTrack?i._audioTrack._updateOriginMediaStreamTrack(l):(i._audioTrack=new Uf(l,i.uid,i._uintid,this.store),R.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(i._audioTrack.getTrackId()))),p&&i._audioTrack._updateRtpTransceiver(p),this.bindRemoteTrackEvents(i,i._audioTrack)):(i._videoTrack?i._videoTrack._updateOriginMediaStreamTrack(l):(i._videoTrack=new Mf(l,i.uid,i._uintid,this.store,E),R.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(i._videoTrack.getTrackId()))),p&&i._videoTrack._updateRtpTransceiver(p),this.bindRemoteTrackEvents(i,i._videoTrack)),F("ENABLE_VIDEO_SEI")&&p){const{interceptRemoteVideoFrame:O,interceptRemoteAudioFrame:I}=dT();s==Le.VIDEO?await O(p.receiver,{onSei:N=>{var M;(M=i._videoTrack)===null||M===void 0||M._onSei(N)}}):s==Le.AUDIO&&await I(p.receiver)}const g=this.remoteUserMap.get(i);g?g.set(s,h):this.remoteUserMap.set(i,new Map([[s,h]])),this.statsCollector.addRemoteStats(i.uid),this.statsUploader.startUploadInboundStats();const v=this.pendingRemoteTracks.findIndex((O=>{let{user:I,kind:N}=O;return I.uid===i.uid&&s===N}));v!==-1&&(this.pendingRemoteTracks.splice(v,1),this.emit(Xe.MediaReconnectEnd,i.uid))}}async unsubscribe(e,t,n){const r=this.pendingRemoteTracks.filter((o=>{let{user:c,kind:l}=o;return t!==void 0?c.uid===e.uid&&t===l:c.uid===e.uid}));if(r.forEach((o=>{const c=this.pendingRemoteTracks.indexOf(o);this.pendingRemoteTracks.splice(c,1)})),this.connection&&this.state===Zt.Connected||n||r.forEach((o=>{let{kind:c}=o;var l;if(c===Le.AUDIO)(l=e._audioTrack)===null||l===void 0||l._destroy(),e._audioTrack=void 0;else if(c===Le.VIDEO){var h;(h=e._videoTrack)===null||h===void 0||h._destroy(),e._videoTrack=void 0}})),!this.connection||this.state!==Zt.Connected)return;const i=this.filterTobeUnSubscribedTracks(e,t);if(i.length===0)return;await this.connection.stopReceiving(i.map((o=>{let[,{id:c}]=o;return c})));const s=this.createUnsubscribeMessage(i);return this.withdrawRemoteTracks(i),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),i.forEach((o=>{let[c,{kind:l}]=o;var h,p;if(l===Le.VIDEO&&c._videoSSRC&&((h=this.connection)===null||h===void 0||h.setStatsRemoteVideoIsReady(c._videoSSRC,!1)),l===Le.VIDEO)this.unbindRemoteTrackEvents(c._videoTrack),n||((p=c._videoTrack)===null||p===void 0||p._destroy(),c._videoTrack=void 0);else if(l===Le.AUDIO){var E;this.unbindRemoteTrackEvents(c._audioTrack),!n&&((E=c._audioTrack)===null||E===void 0||E._destroy(),c._audioTrack=void 0)}})),s}async unsubscribeDataChannel(e,t){if(t.forEach((i=>{const s=this.pendingRemoteDataChannels.findIndex((o=>o.id===i.id));s!==-1&&this.pendingRemoteDataChannels.splice(s,1)})),!this.connection)return;const n=this.filterTobeUnSubscribedDataChannels(e,t);if(n.length===0)return;t.forEach((i=>{i._close()}));const r=this.remoteDataChannelMap.get(e);return n.forEach((i=>{r&&r.delete(i.id)})),r&&r.size===0&&(this.remoteDataChannelMap.delete(e),await this.connection.stopDataChannels(e.uid)),n.map((i=>i.id))}async massUnsubscribe(e){return this.massUnsubscribeNoLock(e)}async massUnsubscribeNoLock(e){let t=[];for(const{user:i,mediaType:s}of e){const o=this.pendingRemoteTracks.filter((c=>{let{user:l,kind:h}=c;return s!==void 0?l.uid===i.uid&&s===h:l.uid===i.uid}));o.forEach((c=>{const l=this.pendingRemoteTracks.indexOf(c);this.pendingRemoteTracks.splice(l,1)})),t=t.concat(o)}if(!this.connection||this.state!==Zt.Connected)return void t.forEach((i=>{let{user:s,kind:o}=i;var c;if(o===Le.AUDIO)(c=s._audioTrack)===null||c===void 0||c._destroy(),s._audioTrack=void 0;else if(o===Le.VIDEO){var l;(l=s._videoTrack)===null||l===void 0||l._destroy(),s._videoTrack=void 0}}));const n=zi(e).call(e,((i,s)=>{let{user:o,mediaType:c}=s;const l=this.filterTobeUnSubscribedTracks(o,c);return i.concat(l)}),[]);if(n.length===0)return;await this.connection.stopReceiving(n.map((i=>{let[,{id:s}]=i;return s})));const r=this.createUnsubscribeAllMessage(n);return this.withdrawRemoteTracks(n),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),n.forEach((i=>{let[s,{kind:o}]=i;var c,l;if(o===Le.VIDEO&&s._videoSSRC&&((c=this.connection)===null||c===void 0||c.setStatsRemoteVideoIsReady(s._videoSSRC,!1)),o===Le.VIDEO)this.unbindRemoteTrackEvents(s._videoTrack),(l=s._videoTrack)===null||l===void 0||l._destroy(),s._videoTrack=void 0;else if(o===Le.AUDIO){var h;this.unbindRemoteTrackEvents(s._audioTrack),(h=s._audioTrack)===null||h===void 0||h._destroy(),s._audioTrack=void 0}})),r}isPreSubScribe(e){return!this.connection||this.state!==Zt.Connected?!1:!!this.connection.getPreMedia(e)}async muteRemote(e,t){if(!this.connection)return;const n=this.remoteUserMap.get(e);if(!n)return void R.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid,"."));if(!n.get(t))return void R.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."));const r=t===Le.VIDEO?e._videoSSRC:e._audioSSRC;r!==void 0&&this.connection.setStatsRemoteVideoIsReady(r,!1)}async unmuteRemote(e,t){return this.unmuteRemoteNoLock(e,t)}async unmuteRemoteNoLock(e,t){if(!this.connection)return;const n=this.remoteUserMap.get(e);if(!n)return void R.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid,"."));n.get(t)||R.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."))}addAudioMetadata(e){const t=this.localTrackMap.get(Ee.LocalAudioTrack),n=t&&t.track;n&&n.metadata.push(e)}getAllTracks(e){const t=this.localTrackMap.get(Ee.LocalAudioTrack);if(t?.track instanceof ar){const n=t.track;return Array.from(this.localTrackMap.entries()).filter((r=>{let[i]=r;return i!==Ee.LocalAudioTrack})).filter((r=>{let[i]=r;return!(e&&i===Ee.LocalVideoLowTrack)})).map((r=>{let[,{track:i}]=r;return i})).concat(n.trackList)}return Array.from(this.localTrackMap.entries()).filter((n=>{let[r]=n;return!(e&&r===Ee.LocalVideoLowTrack)})).map((n=>{let[,{track:r}]=n;return r}))}getAllDataChannels(){return this.localDataChannels}reportPublishEvent(e,t,n,r,i){if(e){const o=this.localTrackMap.get(Ee.LocalAudioTrack),c=r?this.localTrackMap.get(Ee.LocalVideoLowTrack):this.localTrackMap.get(Ee.LocalVideoTrack);We.publish(this.store.sessionId,{eventElapse:Qr.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:o?.track.getTrackLabel(),videoName:c?.track.getTrackLabel(),screenshare:c?.track._hints.indexOf(an.SCREEN_TRACK)!==-1,audio:!!o,video:!!c,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:i})}else{var s;n||(n=[]);const o=n.find((l=>l instanceof Fn)),c=r?(s=this.localTrackMap.get(Ee.LocalVideoTrack))===null||s===void 0?void 0:s.track:n.find((l=>l instanceof vn));We.publish(this.store.sessionId,{eventElapse:Qr.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:o?.getTrackLabel(),videoName:c?.getTrackLabel(),screenshare:c?._hints.indexOf(an.SCREEN_TRACK)!==-1,audio:!!o,video:!!c,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:i})}}reportSubscribeEvent(e,t,n,r){const i=r===Le.VIDEO?n._videoSSRC:n._audioSSRC;i&&We.subscribe(this.store.sessionId,{succ:e,ec:t,video:r===Le.VIDEO,audio:r===Le.AUDIO,peerid:n.uid,subscribeRequestid:i,p2pid:this.store.p2pId,eventElapse:Qr.measureFromSubscribeStart(this.store.clientId,i),preSsrc:this.isPreSubScribe(i)})}reset(){R.debug("[".concat(this.store.clientId,"] P2PChannel.reset")),this.mutex=new Yr("P2PChannel-mutex",this.store.clientId),this.connection&&(this.resetConnection(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=vT(this.store),this.emit(Xe.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.statsUploader.stopUploadBaseStats(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const e=this.localTrackMap.get(Ee.LocalAudioTrack);if(e?.track instanceof ar){if(e.track.trackList.length>0){const t=e.track;e.track.trackList.forEach((n=>{t.removeAudioTrack(n)}))}e.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.iceFailedCount=0,this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.localDataChannels=[],this.remoteDataChannelMap.clear(),this.pendingLocalDataChannels=[],this.pendingRemoteDataChannels=[],this.state=Zt.Disconnected}getStats(){var e;return(e=this.connection)===null||e===void 0?void 0:e.getStats()}getRemoteVideoIsReady(e){var t;return((t=this.connection)===null||t===void 0?void 0:t.getRemoteVideoIsReady(e))||!1}getLocalAudioVolume(){const e=this.localTrackMap.get(Ee.LocalAudioTrack);if(e)return e.track.getVolumeLevel()}getLocalVideoSize(){const e=this.localTrackMap.get(Ee.LocalVideoTrack);if(e)return{width:e.track.videoWidth||0,height:e.track.videoHeight||0}}getEncoderConfig(e){const t=this.localTrackMap.get(e);return t&&t.track instanceof vn||t&&t.track instanceof Fn?t.track._encoderConfig:void 0}getLocalMedia(e){return this.localTrackMap.get(e)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(e,t){if(!e)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(e);return!!n&&(!t||n.has(t))}async hasRemoteMediaWithLock(e,t){if(!e)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(e);return!!n&&(!t||n.has(t))}getRemoteMedia(e){var t;const n=Array.from($i(t=this.remoteUserMap).call(t)).find((r=>r.uid===e));return n?{audioTrack:n.audioTrack,audioSSRC:n._audioSSRC,videoTrack:n.videoTrack,videoSSRC:n._videoSSRC}:{}}getAudioLevels(){let e=Array.from(this.remoteUserMap.entries()).map((n=>{let[r]=n;return{uid:r.uid,level:r.audioTrack?100*r.audioTrack._source.getAccurateVolumeLevel():0}}));const t=this.localTrackMap.get(Ee.LocalAudioTrack);return t&&e.push({level:100*t.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e=sh(e).call(e,((n,r)=>n.level-r.level)),e}async disconnectForReconnect(){this.connection&&(R.debug("[".concat(this.store.clientId,"] P2PChannel.disconnectForReconnect closing P2PConnection")),this.state=Zt.Reconnecting,F("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach((e=>{let[t]=e;var n;t._videoTrack&&t._videoTrack._player&&((n=t._videoTrack._player.getVideoElement())===null||n===void 0||n.pause(),t._videoTrack._player.isKeepLastFrame=!0,t._videoTrack._originMediaStreamTrack.stop())})),this.resetConnection(this.connection),this.connection=void 0,this.shouldForwardP2PCreation&&(this.connection=vT(this.store),this.emit(Xe.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach((e=>{var t;let[n,{track:r}]=e;switch(n){case Ee.LocalVideoTrack:Re(t=r._hints).call(t,an.LOW_STREAM)?r.close():this.pendingLocalTracks.push(r);break;case Ee.LocalAudioTrack:r instanceof ar?this.pendingLocalTracks=this.pendingLocalTracks.concat(r.trackList):this.pendingLocalTracks.push(r);case Ee.LocalVideoLowTrack:}})),this.emit(Xe.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach((e=>{let[t,n]=e;Array.from($i(n).call(n)).forEach((r=>{this.setPendingRemoteMedia(t,r)})),this.emit(Xe.MediaReconnectStart,t.uid)})),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.localDataChannels.length!==0&&(this.localDataChannels.forEach((e=>{this.pendingLocalDataChannels.push(e)})),this.localDataChannels.length=0),this.remoteDataChannelMap.size!==0&&(Array.from(this.remoteDataChannelMap.entries()).forEach((e=>{let[t,n]=e;Array.from($i(n).call(n)).forEach((r=>{this.setPendingRemoteDataChannel(t,r)}))})),this.remoteDataChannelMap.clear()),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),R.debug("[".concat(this.store.clientId,"] P2PChannel disconnected, waiting to reconnect.")))}hasPendingRemoteDataChannel(e,t){for(const n of this.pendingRemoteDataChannels){const{user:r,id:i}=n;if((e instanceof Ud?e.uid:e)===r.uid&&i===t)return!0}return!1}setPendingRemoteDataChannel(e,t){this.hasPendingRemoteDataChannel(e,t)||this.pendingRemoteDataChannels.push({user:e,id:t})}hasPendingRemoteMedia(e,t){for(const n of this.pendingRemoteTracks){const{user:r,kind:i}=n;if((e instanceof Ud?e.uid:e)===r.uid&&t===i)return!0}return!1}setPendingRemoteMedia(e,t){this.hasPendingRemoteMedia(e,t)||this.pendingRemoteTracks.push({user:e,kind:t})}restartICE(e){var t=this;return eo((function*(){if(!t.connection||t.state!==Zt.Connected)return;const n=yield jt(t.mutex.lock("From P2PChannel.restartICE"));let r;try{r=yield jt(t.connection.restartICE(e));const s=yield jt(r.next());if(s.done)return;const o=s.value,c=yield o;switch(pI(t.connection)&&t.reportPCStats(Date.now(),!1,t._pcStatsUploadType),e){case Jr.UDP_TCP_RELAY:t._pcStatsUploadType=vl.UDP_TCP_RESTART;break;case Jr.TCP_RELAY:t._pcStatsUploadType=vl.TCP_RESTART;break;case Jr.RELAY:t._pcStatsUploadType=vl.RELAY_RESTART;break;default:t._pcStatsUploadType=vl.OLD_RESTART}t._isTryConnecting=!0,r.next(c)}catch(s){var i;(i=r)===null||i===void 0||i.throw(s)}finally{n()}}))()}getUplinkNetworkQuality(){if(!this.connection)return 0;const e=this.connection.getStats(),t=this.localTrackMap.get(Ee.LocalVideoTrack),n=this.localTrackMap.get(Ee.LocalAudioTrack),r=e.videoSend.find((v=>v.ssrc===t?.ssrcs[0].ssrcId)),i=e.audioSend.find((v=>v.ssrc===n?.ssrcs[0].ssrcId));if(!r||!i)return 1;const s=Is(this,Xe.NeedSignalRTT),o=r?r.rttMs:void 0,c=i?i.rttMs:void 0,l=o&&c?(o+c)/2:o||c,h=(l&&s?(l+s)/2:l||s)||0,p=100*e.sendPacketLossRate*.7/50+.3*h/1500,E=p<.17?1:p<.36?2:p<.59?3:p<.1?4:5,g=t?.track;if(g&&g._encoderConfig&&g._hints.indexOf(an.SCREEN_TRACK)===-1){const v=g._encoderConfig.bitrateMax,O=e.bitrate.actualEncoded;if(v&&O){const I=(1e3*v-O)/(1e3*v);return IM[I<.15?0:I<.3?1:I<.45?2:I<.6?3:4][E]}}return E}getDownlinkNetworkQuality(){if(!this.connection)return 0;const e=this.connection.getStats();let t=0;return Array.from(this.remoteUserMap.entries()).forEach((n=>{let[r]=n;const i=r._audioSSRC,s=r._videoSSRC,o=e.audioRecv.find((O=>O.ssrc===i)),c=e.videoRecv.find((O=>O.ssrc===s));if(!o&&!c)return void(t+=1);const l=Is(this,Xe.NeedSignalRTT),h=e.rtt,p=(h&&l?(h+l)/2:h||l)||0,E=o?o.jitterMs:void 0,g=e.recvPacketLossRate;let v=.7*g*100/50+.3*p/1500;E&&(v=.6*g*100/50+.2*p/1500+.2*E/400),t+=v<.1?1:v<.17?2:v<.36?3:v<.59?4:5})),this.remoteUserMap.size>0?Math.round(t/this.remoteUserMap.size):t}async muteLocalTrack(e){return new Pe(((t,n)=>{this.handleMuteLocalTrack(e,t,n)}))}async replaceTrack(e,t){var n;if(R.debug("[".concat(this.store.clientId,"] P2PChannel replaceTrack from [").concat(e.getTrackId(),"] to [").concat(t.getTrackId(),"]")),!this.connection||this.state!==Zt.Connected)return;const r=Array.from(this.localTrackMap.entries()).find((s=>{let[,{track:o}]=s;return e===o}));if(!r)return;const i=r[0];if(e!==t&&(this.unbindLocalTrackEvents([{track:e,type:i}]),this.bindLocalTrackEvents([{track:t,type:i}]),r[1].track=t),await((n=this.connection)===null||n===void 0?void 0:n.replaceTrack(t,r[1].id)),this.isPlanB){const s=r[1];s.id=t._mediaStreamTrack.id,this.localTrackMap.set(i,s)}if(i===Ee.LocalVideoTrack&&!F("DISABLE_DUAL_STREAM_USE_ENCODING")&&Ft().supportDualStreamEncoding){const s=this.localTrackMap.get(Ee.LocalVideoLowTrack);if(s){const o=e._mediaStreamTrack.clone();s.track._originMediaStreamTrack.stop(),s.track._mediaStreamTrack=o,s.track._originMediaStreamTrack=o,await new Pe(((c,l)=>{this.handleReplaceTrack(s.track,c,l,!0)}))}}}filterTobePublishedTracks(e,t,n){const r=[],i=this.getAllTracks();e=Rf(e=e.filter((l=>i.indexOf(l)===-1)));let s,o=!1;const c=this.localTrackMap.get(Ee.LocalAudioTrack);for(const l of e){if(l instanceof vn&&(this.localTrackMap.has(Ee.LocalVideoTrack)||o?new ce(U.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(r.push({track:l,type:Ee.LocalVideoTrack}),o=!0),t)){const h=this.getLowVideoTrack(l,n);r.push({track:h,type:Ee.LocalVideoLowTrack})}if(l instanceof Fn)if(c){const h=c.track;if(h instanceof ar)uI([l]),h.addAudioTrack(l),this.bindLocalAudioTrackEvents(l,!0);else{const p=hI([h,l]);R.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(p.getTrackId(),"]")),this.replaceTrack(h,p)}}else s instanceof ar?(uI([l]),s.addAudioTrack(l)):s||!l._useAudioElement&&Ft().webAudioMediaStreamDest&&!l._bypassWebAudio?s=hI(s?[l,s]:[l]):s=l}return s&&(R.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will send audioTrack [").concat(s.getTrackId(),"]")),r.push({track:s,type:Ee.LocalAudioTrack})),r}filterTobeUnpublishedTracks(e){const t=[],n=this.getAllTracks();e=Rf(e=e.filter((r=>n.indexOf(r)!==-1)));for(const r of e){if(r instanceof Fn){const i=this.localTrackMap.get(Ee.LocalAudioTrack);if(!i)continue;i.track instanceof ar?(i.track.removeAudioTrack(r),this.unbindLocalAudioTrackEvents(r),i.track.trackList.length===0&&(t.push([Ee.LocalAudioTrack,i]),i.track.close())):t.push([Ee.LocalAudioTrack,i])}if(r instanceof vn){const i=this.localTrackMap.get(Ee.LocalVideoTrack);if(!i)continue;t.push([Ee.LocalVideoTrack,i]);const s=this.localTrackMap.get(Ee.LocalVideoLowTrack);s&&t.push([Ee.LocalVideoLowTrack,s])}}return t}filterTobePublishedDataChannels(e){return e=(e=Rf(e)).filter((t=>this.localDataChannels.findIndex((n=>n.id===t.id))===-1))}filterTobeUnpublishedDataChannels(e){return e=(e=(e=Rf(e)).filter((t=>this.localDataChannels.indexOf(t)!==-1))).filter((t=>t._originDataChannel))}bindLocalTrackEvents(e){e.forEach((t=>{let{track:n,type:r}=t;switch(r){case Ee.LocalVideoTrack:n.addListener(Ve.GET_STATS,this.handleGetLocalVideoStats),n.addListener(Ve.GET_RTC_STATS,this.handleGetRTCStats),n.addListener(Ve.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(Ve.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(Ve.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n.addListener(Ve.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),n.addListener(Ve.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.addListener(Ve.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(Ve.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Ee.LocalAudioTrack:this.bindLocalAudioTrackEvents(n);case Ee.LocalVideoLowTrack:}}))}bindLocalAudioTrackEvents(e,t){e instanceof ar?e.trackList.forEach((n=>{n.addListener(Ve.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(Ve.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(Ve.GET_STATS,this.handleGetLocalAudioStats),n.addListener(Ve.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(Ve.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)})):(e.addListener(Ve.GET_STATS,this.handleGetLocalAudioStats),e.addListener(Ve.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(Ve.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(Ve.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(Ve.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),t||(e.addListener(Ve.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.addListener(Ve.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack)))}unbindLocalTrackEvents(e){e||(e=Array.from(this.localTrackMap.entries()).map((t=>{let[n,{track:r}]=t;return{track:r,type:n}}))),e.forEach((t=>{let{track:n,type:r}=t;switch(r){case Ee.LocalVideoTrack:n.off(Ve.GET_STATS,this.handleGetLocalVideoStats),n.off(Ve.GET_RTC_STATS,this.handleGetRTCStats),n.off(Ve.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.off(Ve.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.off(Ve.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n.off(Ve.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),n.off(Ve.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.off(Ve.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.off(Ve.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Ee.LocalAudioTrack:this.unbindLocalAudioTrackEvents(n);case Ee.LocalVideoLowTrack:}}))}unbindLocalAudioTrackEvents(e){e instanceof ar?e.trackList.forEach((t=>{t.off(Ve.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(Ve.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(Ve.GET_STATS,this.handleGetLocalAudioStats),t.off(Ve.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(Ve.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)})):(e.off(Ve.GET_STATS,this.handleGetLocalAudioStats),e.off(Ve.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(Ve.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(Ve.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(Ve.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack),e.off(Ve.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(Ve.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(e,t){t instanceof Mf&&t.addListener(Ve.GET_STATS,(n=>{n(this.handleGetRemoteVideoStats(e))})),t instanceof Uf&&t.addListener(Ve.GET_STATS,(n=>{n(this.handleGetRemoteAudioStats(e))}))}unbindRemoteTrackEvents(e){e&&e.removeAllListeners(Ve.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach((e=>{let[t,n]=e;n.has(Le.AUDIO)&&this.unbindRemoteTrackEvents(t._audioTrack),n.has(Le.VIDEO)&&this.unbindRemoteTrackEvents(t._videoTrack)}))}createGatewayPublishMessage(e,t){return e.map(((n,r)=>{var i;let s,o,{track:c,type:l}=n;switch(l){case Ee.LocalAudioTrack:s=en.Audio,o={dtx:c instanceof KE&&c._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1};break;case Ee.LocalVideoTrack:s=Re(i=c._hints).call(i,an.SCREEN_TRACK)?en.Screen:en.High,o=Ac(Ac({},GM(c)),{},{codec:this.store.codec,svc_mode:sT()});break;case Ee.LocalVideoLowTrack:s=en.Low,o=Ac(Ac({},GM(c)),{},{codec:this.store.codec,svc_mode:sT()})}return{stream_type:s,attributes:o,ssrcs:t[r]}}))}createGatewayUnpublishMessage(e){return e.map((t=>{var n;let r,[i,{track:s,ssrcs:o,id:c}]=t;switch(i){case Ee.LocalVideoTrack:r=Re(n=s._hints).call(n,an.SCREEN_TRACK)?en.Screen:en.High;break;case Ee.LocalAudioTrack:r=en.Audio;break;case Ee.LocalVideoLowTrack:r=en.Low}return{stream_type:r,ssrcs:o,mid:c}}))}assignLocalTracks(e,t){e.forEach(((n,r)=>{let{track:i,type:s}=n;this.localTrackMap.set(s,{track:i,id:t[r].id,ssrcs:t[r].localSSRC})}))}withdrawLocalTracks(e){e.forEach((t=>{let[n]=t;this.localTrackMap.delete(n)}))}bindConnectionEvents(e){e.onConnectionStateChange=async t=>{if(R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onConnectionStateChange(").concat(t,")")),this.emit(Xe.PeerConnectionStateChange,t),t==="connecting"&&e instanceof oo&&!xn()&&F("FIRST_TCP_CANDIDATE")&&window.setTimeout((()=>{t==="connecting"&&e.extendCandidate()}),F("FIRST_TCP_CANDIDATE_INTERVAL")),t!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),t==="connected"&&(this._restartTimer&&(window.clearTimeout(this._restartTimer),this._restartTimer=void 0),e instanceof oo&&V2(e,!0),this._isTryConnecting&&this.reportPCStats(Date.now(),!0,this._pcStatsUploadType),this._isTryConnecting=!1,this._isStartRestartIce=!1,this._pcStatsUploadType=vl.DISCONNECTED_OR_FAILED,Is(this,Xe.QueryClientConnectionState)==="CONNECTED"&&this._isWaitPcToRePub)){const n=this.pendingLocalTracks.map((i=>i.getTrackId())),r=this.pendingLocalDataChannels.map((i=>"dc_".concat(i.id)));We.reportApiInvoke(this.store.sessionId,{name:Bn.REPUB_AFTER_PC_CONNECTED,options:n.concat(r),tag:In.TRACER}).onSuccess(),this.republish()}if(F("NEW_ICE_RESTART")&&e instanceof oo&&!xn()&&!this._forceTurn){if(Re(UM).call(UM,t)){if(this._isStartRestartIce)return;this._isStartRestartIce=!0;const n=i=>{pI(e)&&(R.debug("[".concat(this.store.clientId,"] [P2PChannel] try to restartICE, type is ").concat(i)),Is(this,Xe.QueryClientConnectionState)==="CONNECTED"&&this.emit(Xe.RequestRestartICE,i))},r=()=>{pI(e)&&(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),R.debug("[".concat(this.store.clientId,"] P2PConnection disconnected timeout, force reconnect")),setTimeout((()=>this.emit(Xe.P2PLost)),0),this.iceFailedCount+=1,this.requestReconnect())};return void(this._restartTimer=window.setTimeout((()=>{j2(e,n,r)}),800))}}else{if(t==="disconnected"&&e.iceConnectionState==="disconnected")return setTimeout((()=>{e.iceConnectionState==="disconnected"&&F("ICE_RESTART")&&Is(this,Xe.QueryClientConnectionState)==="CONNECTED"&&this.emit(Xe.RequestRestartICE)}),800),void setTimeout((()=>{e.peerConnectionState==="disconnected"&&(R.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection disconnected timeout 4000ms, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isTryConnecting=!1,setTimeout((()=>this.emit(Xe.P2PLost)),0),this.iceFailedCount+=1,this.requestReconnect())}),4e3);t==="failed"&&(R.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection state failed, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),setTimeout((()=>this.emit(Xe.P2PLost)),0),this.iceFailedCount+=1,await this.requestReconnect())}},e.onICEConnectionStateChange=t=>{t!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(t,")")),We.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:t,tag:In.TRACER}).onSuccess(),this.emit(Xe.IceConnectionStateChange,t)},e.onICETransportStateChange=t=>{R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(t,")"))},e.onDTLSTransportStateChange=t=>{R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(t,")"))},e.onDTLSTransportError=t=>{R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(t,")"))},e.onFirstAudioDecoded=t=>{var n;const r=Array.from($i(n=this.remoteUserMap).call(n)).find((s=>s._audioSSRC===t));var i;r&&(this.store.subscribe(r.uid,"audio",void 0,void 0,void 0,Date.now()),(i=r.audioTrack)===null||i===void 0||i.emit(ro.FIRST_FRAME_DECODED),We.firstRemoteFrame(this.store.sessionId,pr.FIRST_AUDIO_DECODE,bn.FIRST_AUDIO_DECODE,{peer:r._uintid,subscribeElapse:Qr.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId}))},e.onFirstAudioReceived=t=>{var n;const r=Array.from($i(n=this.remoteUserMap).call(n)).find((i=>i._audioSSRC===t));r&&We.firstRemoteFrame(this.store.sessionId,pr.FIRST_AUDIO_RECEIVED,bn.FIRST_AUDIO_RECEIVED,{peer:r._uintid,subscribeElapse:Qr.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onFirstVideoDecoded=(t,n,r)=>{var i;const s=Array.from($i(i=this.remoteUserMap).call(i)).find((o=>o._videoSSRC===t));s&&this.store.firstVideoFrameDecoded(s.uid,{firstDecoded:Date.now()}),this.reportVideoFirstFrameDecoded(t,n,r)},e.onFirstVideoRender=t=>{var n;const r=Array.from($i(n=this.remoteUserMap).call(n)).find((i=>i._videoSSRC===t));r&&(this.store.firstVideoFrameDecoded(r.uid,{firstPreRender:Date.now()}),this.reportVideoFirstFrameRender(r))},e.onFirstVideoReceived=t=>{var n;const r=Array.from($i(n=this.remoteUserMap).call(n)).find((i=>i._videoSSRC===t));r&&(this.store.firstVideoFrameDecoded(r.uid,{firstReceived:Date.now()}),We.firstRemoteFrame(this.store.sessionId,pr.FIRST_VIDEO_RECEIVED,bn.FIRST_VIDEO_RECEIVED,{peer:r._uintid,subscribeElapse:Qr.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId}))},e.onSelectedLocalCandidateChanged=(t,n)=>{const r=t.candidateType==="relay",i=n.candidateType==="relay";n.candidateType!=="unknown"&&r===i||this.emit(Xe.ConnectionTypeChange,r),R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(Dd(n))," -> ").concat(JSON.stringify(Dd(t)),")"))},e.onSelectedRemoteCandidateChanged=(t,n)=>{R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(Dd(n))," -> ").concat(JSON.stringify(Dd(t)),")"))},e.onFirstVideoDecodedTimeout=t=>{this.reportVideoFirstFrameDecoded(t,void 0,void 0,!0)},e.getLocalVideoStats=()=>{const t=this.statsCollector.getLocalVideoTrackStats(),n=this.statsCollector.getRTCStats();return Ac(Ac({},t),n)},e.onICECandidateError=t=>{this._iceError=t}}resetConnection(e){e instanceof oo&&(function(t){Jf.delete(t.id),V2(t)})(e),e.close(),this.emit(Xe.PeerConnectionStateChange,"closed"),(function(t){t.onConnectionStateChange=void 0,t.onICEConnectionStateChange=void 0,t.onICETransportStateChange=void 0,t.onDTLSTransportStateChange=void 0,t.onDTLSTransportError=void 0,t.onFirstAudioDecoded=void 0,t.onFirstAudioReceived=void 0,t.onFirstVideoDecoded=void 0,t.onFirstVideoReceived=void 0,t.onSelectedLocalCandidateChanged=void 0,t.onSelectedRemoteCandidateChanged=void 0,t.onFirstVideoDecodedTimeout=void 0,t.getLocalVideoStats=void 0})(e),this._isWaitPcToRePub=!1}filterTobeMutedTracks(e){const t=[];if(this.getAllTracks().indexOf(e)===-1)return t;const n=this.localTrackMap.get(Ee.LocalAudioTrack);if(e instanceof Fn&&n?.track instanceof ar)return n.track.isActive||t.push([Ee.LocalAudioTrack,n]),t;const r=Array.from(this.localTrackMap.entries()).find((i=>{let[,{track:s}]=i;return e===s}));if(r&&(t.push(r),r[0]===Ee.LocalVideoTrack)){const i=this.localTrackMap.get(Ee.LocalVideoLowTrack);i&&t.push([Ee.LocalVideoLowTrack,i])}return t}filterTobeUnmutedTracks(e){const t=[],n=this.localTrackMap.get(Ee.LocalAudioTrack);if(e instanceof Fn&&n?.track instanceof ar)return n.track.isActive&&t.push([Ee.LocalAudioTrack,n]),t;const r=Array.from(this.localTrackMap.entries()).find((i=>{let[,{track:s}]=i;return e===s}));if(r)if(r[0]===Ee.LocalVideoTrack){t.push(r);const i=this.localTrackMap.get(Ee.LocalVideoLowTrack);i&&t.push([Ee.LocalVideoLowTrack,i])}else t.push(r);return t}createMuteMessage(e){return e.map((t=>{var n;let r,[i,{track:s,ssrcs:o,id:c}]=t;switch(i){case Ee.LocalAudioTrack:r=en.Audio;break;case Ee.LocalVideoTrack:r=Re(n=s._hints).call(n,an.SCREEN_TRACK)?en.Screen:en.High;break;case Ee.LocalVideoLowTrack:r=en.Low}return{stream_type:r,ssrcs:o,mid:c}}))}createUnmuteMessage(e){return e.map((t=>{var n;let r,[i,{track:s,ssrcs:o,id:c}]=t;switch(i){case Ee.LocalAudioTrack:r=en.Audio;break;case Ee.LocalVideoTrack:r=Re(n=s._hints).call(n,an.SCREEN_TRACK)?en.Screen:en.High;break;case Ee.LocalVideoLowTrack:r=en.Low}return{stream_type:r,ssrcs:o,mid:c}}))}filterTobeUnSubscribedTracks(e,t){const n=[],r=this.remoteUserMap.get(e);if(!r)return n;if(t){const i=r.get(t);if(!i)return n;n.push([e,{kind:t,id:i}])}else Array.from(r.entries()).forEach((i=>{let[s,o]=i;n.push([e,{kind:s,id:o}])}));return n}filterTobeUnSubscribedDataChannels(e,t){const n=[];return t.forEach((r=>{var i;(i=this.remoteDataChannelMap.get(e))!==null&&i!==void 0&&i.has(r.id)&&n.push(r)})),n}createUnsubscribeMessage(e){const t=[];return e.forEach((n=>{let[r,{kind:i,id:s}]=n;switch(i){case Le.VIDEO:return void(r._videoSSRC&&t.push({stream_type:Le.VIDEO,ssrcId:r._videoSSRC}));case Le.AUDIO:return void(r._audioSSRC&&t.push({stream_type:Le.AUDIO,ssrcId:r._audioSSRC}))}})),t}createUnsubscribeAllMessage(e){const t=new Map;return e.forEach((n=>{let[r,{kind:i}]=n;if(t.has(r)){let s=t.get(r);i===Le.VIDEO?s|=gr.Video:s|=gr.Audio,t.set(r,s)}else i===Le.VIDEO?t.set(r,gr.Video):t.set(r,gr.Audio)})),{users:Array.from(t.entries()).map((n=>{let[r,i]=n;return{stream_id:r.uid,stream_type:i}}))}}withdrawRemoteTracks(e){e.forEach((t=>{let[n,{kind:r}]=t;const i=this.remoteUserMap.get(n);i&&(i.delete(r),Array.from(i.entries()).length===0&&this.remoteUserMap.delete(n))}))}async updateBitrateLimit(e){const t=this.localTrackMap.get(Ee.LocalVideoTrack),n=this.localTrackMap.get(Ee.LocalVideoLowTrack);t&&(await t.track.setBitrateLimit(e.uplink),await new Pe(((r,i)=>{this.handleUpdateVideoEncoder(t.track,r,i,!0)}))),n&&e.low_stream_uplink&&(await n.track.setBitrateLimit({max_bitrate:e.low_stream_uplink.bitrate,min_bitrate:e.low_stream_uplink.bitrate||0}),await new Pe(((r,i)=>{this.handleUpdateVideoEncoder(n.track,r,i,!0)})))}isP2PDisconnected(){return this.connection?this.connection.peerConnectionState!=="connected":!0}isPreallocation(){return this.connection instanceof oo&&this.connection.isPreallocation}isPreSub(){return this.connection instanceof oo&&this.connection.isPreSub()}mapPubResToRemoteConfig(e,t,n){return e.map(((r,i)=>{var s;let{stream_type:o}=r;const c=(s=t.find((l=>{let{stream_type:h}=l;return o===h})))===null||s===void 0?void 0:s.attributes;if(c&&F("DISABLE_SCREEN_SHARE_REMB")){const l=n[i]._hints;(Re(l).call(l,an.SCREEN_TRACK)||Re(l).call(l,an.SCREEN_LOW_TRACK))&&(c.remb=!1,R.debug("disable remb for screen share, hints:",l))}return c}))}async tryToUnmuteAudio(e){for(let n=0;n<e.length;n++)if(e[n]instanceof Fn){var t;const r=this.filterTobeUnmutedTracks(e[n]);if(r.length===0)continue;await((t=this.connection)===null||t===void 0?void 0:t.unmuteLocal(r.map((s=>{let[,{id:o}]=s;return o}))));const i=this.createUnmuteMessage(r);return void await cn(this,Xe.RequestUnmuteLocal,i)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=()=>this.getStats(),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=e=>{var t;return!((t=this.connection)===null||t===void 0||!t.getRemoteVideoIsReady(e))},this.statsUploader.requestUpload=(e,t)=>this.emit(Xe.RequestUpload,e,t),this.statsUploader.requestUploadStats=e=>this.emit(Xe.RequestUploadStats,e),this.statsUploader.requestAllTracks=()=>this.getAllTracks(),this.statsUploader.requestTransportStats=()=>{var e;return{connectState:((e=this.connection)===null||e===void 0?void 0:e.peerConnectionState)||"closed"}}}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await Dr(Z0(this.dtlsFailedCount,rr)),this.emit(Xe.RequestReconnect)}async reconnectP2P(){const e=Array.from(this.localTrackMap.entries()),t=this.createGatewayUnpublishMessage(e);Array.from(this.remoteUserMap.entries()),t.length>0&&await Fr(this,Xe.RequestUnpublishForReconnectPC,t),this.disconnectForReconnect(),this.emit(Xe.RequestReconnectPC)}canPublishLowStream(){return this.localTrackMap.has(Ee.LocalVideoTrack)||this.pendingLocalTracks.some((e=>e instanceof vn))}throwIfTrackTypeNotMatch(e){if(e.filter((t=>t instanceof vn)).length>1)throw new ce(U.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e.filter((t=>t instanceof Fn)).length>1&&(e.some((t=>t instanceof Fn&&t._bypassWebAudio))||!Ft().webAudioMediaStreamDest))throw new ce(U.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const t of e){if(t instanceof vn&&this.pendingLocalTracks.some((n=>n instanceof vn)))throw new ce(U.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t instanceof Fn&&this.pendingLocalTracks.some((n=>n instanceof Fn))&&(!Ft().webAudioMediaStreamDest||t._bypassWebAudio||this.pendingLocalTracks.some((n=>n instanceof Fn&&n._bypassWebAudio))))throw new ce(U.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(e,t){var n;const r=!F("DISABLE_DUAL_STREAM_USE_ENCODING")&&Ft().supportDualStreamEncoding,i=Ac(Ac({},{width:160,height:120,framerate:15,bitrate:50}),t);let s;s=r?e._mediaStreamTrack.clone():fI(e,i);const o=ln(8,"track-low-"),c=new vn(s,Ac(Ac({},r&&{scaleResolutionDownBy:qb(i,e)}),{},{frameRate:i.framerate,bitrateMax:i.bitrate,bitrateMin:i.bitrate}),void 0,void 0,o);return c.on(gh.TRANSCEIVER_UPDATED,(l=>{e._updateRtpTransceiver(l,Of.LOW_STREAM)})),c._hints.push(an.LOW_STREAM),Re(n=e._hints).call(n,an.SCREEN_TRACK)&&c._hints.push(an.SCREEN_LOW_TRACK),e.on("sei-to-send",(l=>{c.emit("sei-to-send",l)})),e.addListener(Ve.NEED_CLOSE,(()=>{c.close()})),c}async globalLock(){return this.mutex.lock("From P2PChannel.globalLock")}async reportPCStats(e,t,n){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;if(this.connection&&this.connection instanceof oo){var i,s,o,c;const l=this.store.keyMetrics.descriptionStart||0,{iceConnectionState:h,dtlsTransportState:p,peerConnectionState:E}=this.connection,{local:g,remote:v}=await this.connection.getSelectedCandidatePair();We.pcStats(this.store.sessionId,{startTime:l,eventElapse:e-l||0,iceconnectionsate:h,dtlsstate:p,connectionstate:E,intSucc:t?1:2,error:this._iceError||r||"",selectedLocalCandidateProtocol:(i=g?.protocol)!==null&&i!==void 0?i:"",selectedLocalCandidateType:(s=g.candidateType)!==null&&s!==void 0?s:"",selectedLocalCandidateAddress:"".concat(g.address,":").concat(g.port),selectedRemoteCandidateProtocol:(o=v.protocol)!==null&&o!==void 0?o:"",selectedRemoteCandidateType:(c=v.candidateType)!==null&&c!==void 0?c:"",selectedRemoteCandidateAddress:"".concat(v.address,":").concat(v.port),restartCnt:n,preallocation:this.connection.isPreallocation}),this._iceError=null}}reportVideoFirstFrameRender(e){const t=this.store.keyMetrics,n=t.firstVideoFrameDecoded.find((p=>p.userId===e.uid));if(!n)return;const{isInternalUpload:r,isExternalUpload:i}=n;if(r&&i)return;const{subscribeEnd:s,firstPreRender:o,peerPublishDuration:c,peerPubStatusMs:l}=n;let{firstRender:h=0}=n;if(s&&(h||o)&&c&&l){n.isInternalUpload=!0;const{playEnd:p}=n;p&&(n.isExternalUpload=!0);const{firstPreRender:E=0}=n;h=E||h;const g=e.videoTrack,v={peer:e._uintid,width:g?._videoWidth||0,height:g?._videoHeight||0,ssrc:e._videoSSRC||0,p2pid:this.store.p2pId,peerPublishDuration:c,peerPubStatusMs:l,joinChannelStart:t.joinStart||0,preloadStart:t.preloadStart||0,preloadEnd:t.preloadEnd||0,apStart:t.requestAPStart||0,apEnd:t.requestAPEnd||0,suaEnd:t.requestSUAEnd||0,beforeConnect:t.beforeConnect||0,peerReceiver:t.peerReceiver||0,ice:t.iceConnectionEnd||0,pc:t.peerConnectionEnd||0,signalConnected:t.signalConnected||0,joinReq:t.joinReq||0,joinRes:t.joinRep||0,userJoinNotify:n.userJoinNotify||0,videoAddNotify:n.videoAddNotify||0,subscribeStart:n.subscribeStart||0,subscribeEnd:n.subscribeEnd||0,firstReceived:n.firstReceived||0,firstDecoded:n.firstDecoded||0,firstPreRender:E||0,firstRender:p?Math.max(h,p):Math.max(h,s),playStart:n.playStart||0,playEnd:n.playEnd||0,isPreSub:!(!e._videoSSRC||!this.isPreSubScribe(e._videoSSRC)),isPrePc:this.isPreallocation(),isPreInstantVideo:pL(this.store)};We.firstXLAPeerFirstVideoFrame(this.store.sessionId,v)}}reportVideoFirstFrameDecoded(e,t,n,r){var i;const s=Array.from($i(i=this.remoteUserMap).call(i)).find((o=>o._videoSSRC===e));if(s){r||this.store.subscribe(s.uid,"video",void 0,void 0,void 0,void 0,Date.now());const o=this.store.keyMetrics,c=o.subscribe.find((l=>l.userId===s.uid&&l.type==="video"));We.firstRemoteVideoDecode(this.store.sessionId,pr.FIRST_VIDEO_DECODE,bn.FIRST_VIDEO_DECODE,{peer:s._uintid,videowidth:t,videoheight:n,subscribeElapse:Qr.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId,apEnd:o.requestAPEnd||0,apStart:o.requestAPStart||0,joinGwEnd:o.joinGatewayEnd||0,joinGwStart:o.joinGatewayStart||0,pcEnd:o.peerConnectionEnd||0,pcStart:o.peerConnectionStart||0,subscriberEnd:c?.subscribeEnd||0,subscriberStart:c?.subscribeStart||0,videoAddNotify:c?.streamAdded||0,state:r?1:0,firstFrame:c?.firstFrame||0})}}async remoteMediaSsrcChanged(e,t,n){if(!this.connection)return!1;const r=this.remoteUserMap.get(e);if(!r)return!1;const i=r.get(t);if(!i)return!1;const s=await this.connection.getRemoteSSRC(i);return s!==void 0&&s!==n}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach((e=>{let[t,{track:n}]=e;t===Ee.LocalVideoLowTrack?n._updateRtpTransceiver(void 0,Of.LOW_STREAM):n._updateRtpTransceiver(void 0)}))}},Be(It.prototype,"startP2PConnection",[mi],Object.getOwnPropertyDescriptor(It.prototype,"startP2PConnection"),It.prototype),Be(It.prototype,"connect",[mi],Object.getOwnPropertyDescriptor(It.prototype,"connect"),It.prototype),Be(It.prototype,"updateRemoteRTPCapabilities",[mi],Object.getOwnPropertyDescriptor(It.prototype,"updateRemoteRTPCapabilities"),It.prototype),Be(It.prototype,"publishDataChannel",[mi],Object.getOwnPropertyDescriptor(It.prototype,"publishDataChannel"),It.prototype),Be(It.prototype,"unpublish",[mi],Object.getOwnPropertyDescriptor(It.prototype,"unpublish"),It.prototype),Be(It.prototype,"unpublishDataChannel",[mi],Object.getOwnPropertyDescriptor(It.prototype,"unpublishDataChannel"),It.prototype),Be(It.prototype,"unpublishLowStream",[mi],Object.getOwnPropertyDescriptor(It.prototype,"unpublishLowStream"),It.prototype),Be(It.prototype,"subscribeDataChannel",[mi],Object.getOwnPropertyDescriptor(It.prototype,"subscribeDataChannel"),It.prototype),Be(It.prototype,"subscribe",[mi],Object.getOwnPropertyDescriptor(It.prototype,"subscribe"),It.prototype),Be(It.prototype,"massSubscribe",[mi],Object.getOwnPropertyDescriptor(It.prototype,"massSubscribe"),It.prototype),Be(It.prototype,"unsubscribe",[mi],Object.getOwnPropertyDescriptor(It.prototype,"unsubscribe"),It.prototype),Be(It.prototype,"unsubscribeDataChannel",[mi],Object.getOwnPropertyDescriptor(It.prototype,"unsubscribeDataChannel"),It.prototype),Be(It.prototype,"massUnsubscribe",[mi],Object.getOwnPropertyDescriptor(It.prototype,"massUnsubscribe"),It.prototype),Be(It.prototype,"muteRemote",[mi],Object.getOwnPropertyDescriptor(It.prototype,"muteRemote"),It.prototype),Be(It.prototype,"unmuteRemote",[mi],Object.getOwnPropertyDescriptor(It.prototype,"unmuteRemote"),It.prototype),Be(It.prototype,"hasRemoteMediaWithLock",[mi],Object.getOwnPropertyDescriptor(It.prototype,"hasRemoteMediaWithLock"),It.prototype),Be(It.prototype,"disconnectForReconnect",[mi],Object.getOwnPropertyDescriptor(It.prototype,"disconnectForReconnect"),It.prototype),Be(It.prototype,"updateBitrateLimit",[mi],Object.getOwnPropertyDescriptor(It.prototype,"updateBitrateLimit"),It.prototype),Be(It.prototype,"remoteMediaSsrcChanged",[mi],Object.getOwnPropertyDescriptor(It.prototype,"remoteMediaSsrcChanged"),It.prototype),It);function mi(e,t,n){const r=e[t];if(typeof r!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const i=this.mutex,s=await i.lock("From P2PChannel.".concat(t));try{for(var o=arguments.length,c=new Array(o),l=0;l<o;l++)c[l]=arguments[l];return await r.apply(this,c)}finally{s()}},n}function W2(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable}))),n.push.apply(n,r)}return n}function G2(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?W2(Object(n),!0).forEach((function(r){k(e,r,n[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):W2(Object(n)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))}))}return e}const x9=Date.now(),M9=20,_I=new Map,CT=new Map;async function H2(e){const t=_I.get(e),n=Array.isArray(t)&&t[t.length-1],r=CT.get(e);if(!n)return void(r.isSyncing=!1);const i={uid:n.uid,payload:n.payload};r.firstRecvTs===0&&(r.firstRecvTs=n.recvTs,r.firstSendTs=n.sendTs);const s=n.sendTs-r.firstSendTs,o=s-(Date.now()-r.firstRecvTs);o>0&&(r.firstRecvTs=Date.now()-s);let c=n.mediaDelay+o;c<=0?(t.pop(),K2(n.context,i),c=0):c=Math.min(c,M9),setTimeout((()=>t.length&&H2(e)),c)}function K2(e,t){e.safeEmit(Nt.STREAM_MESSAGE,t.uid,t.payload),e.onStreamMessage&&e.onStreamMessage(t)}function U9(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0;if(!e.syncWithAudio)return K2(n,{uid:e.uid,payload:e.payload});const r="".concat(n.id,"-").concat(e.uid),i=_I.get(r)||[],s=i.findIndex((h=>e.sendTs>=h.sendTs)),o=G2(G2({},e),{},{context:n,mediaDelay:t,recvTs:Date.now()});s===-1?i.push(o):i.splice(s,0,o),_I.set(r,i);let c=!1;var l;CT.has(r)?c=!((l=CT.get(r))===null||l===void 0||!l.isSyncing):CT.set(r,{isSyncing:c,firstRecvTs:0,firstSendTs:0}),c||H2(r)}const V9=xt().name;function z2(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable}))),n.push.apply(n,r)}return n}function Y2(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?z2(Object(n),!0).forEach((function(r){k(e,r,n[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):z2(Object(n)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))}))}return e}const Qf="websdk_ng_cache_parameter",j9=F("MAX_PRELOAD_ASYNC_LENGTH"),F9=1e4,Ah=new Map,Nh=[];let EI=null,gI=0,vI=0;const wT=new Map,B9=(function(e,t){const n=[];let r=0;const i=async()=>{const s=n.shift();s&&await s(),n.length>0&&r<t?i():r--};return async function(){for(var s=arguments.length,o=new Array(s),c=0;c<s;c++)o[c]=arguments[c];return new Pe((async(l,h)=>{n.push((async()=>{try{const p=await e(...o);l(p)}catch(p){h(p)}})),r<t&&(r++,i())}))}})(q2,j9),yI=Mi.CancelToken.source();async function q2(e,t,n,r,i,s){try{if(!F("ENABLE_PRELOAD"))return;if(!Ft().supportWebCrypto)return void wd((()=>{R.warn("Your browser does not support preloading, this feature  be run in a secure environment")}),"preload_webcrypto_not_supported");if(!n&&n!==null)throw new ce(U.INVALID_PARAMS,"Invalid token: ".concat(n,". If you don not use token, set it to null"));n&&Pr(n,"token",1,2047),Pr(e,"appid",1,2047),$S(t),r&&eT(r);const o=_h();R.debug("preload channel ".concat(t,", uid is ").concat(r));const c={appId:e,cname:t,token:n||e,uid:typeof r!="string"?r:null,sid:o,proxyServer:i};let l,h;typeof r=="string"?(c.stringUid=r,[h,l]=await Pe.all([C9(r,{sid:o,appId:e},yI.token),y2(Y2(Y2({},c),{},{token:n||e,uid:0}),yI.token)]),c.uid=h.uid,l.gatewayInfo.uid=c.uid,l.gatewayInfo.res.uid=c.uid):(s&&(c.stringUid=s),l=await y2(c,yI.token));const p={sid:o,appId:e,cname:t,token:n||e,uid:c.stringUid||r,intUid:c.uid||l.gatewayInfo.uid,stringUid:c.stringUid,ts:Date.now(),sua:h,ap:l};await(async function(E){let g;try{E.uid&&J2({appId:E.appId,cname:E.cname,token:E.token,uid:E.uid,stringUid:E.stringUid});const v=eU(E),O=await(async function(N,M){try{const x=await window.crypto.subtle.importKey("raw",F1(M),"AES-GCM",!1,["encrypt"]),B=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:new Uint8Array(1)},x,mh(window.btoa(JSON.stringify(N))));return bd(new Uint8Array(B))}catch{return}})(E,E.token||E.appId);if(!O)return;g=$2(Qf);const I=g?JSON.parse(g):[];I.push({[v]:O}),I.length>F("AP_CACHE_NUM")&&I.shift(),bT(Qf,JSON.stringify(I))}catch(v){R.warn("Error caching server parameters:",v.message),bT(Qf,"")}})(p),gI++}catch(o){throw vI++,(function(c){EI||(EI=window.setTimeout((()=>{let h="";wT.forEach(((p,E)=>{h+="".concat(E,": ").concat(p," ;")})),We.reportApiInvoke(null,{name:Bn.PRELOAD,options:{success:gI,failed:vI,err:h}}).onError(c),gI=0,vI=0,wT.clear(),EI=null}),F9));const l=wT.get(c.code)||0;wT.set(c.code,l+1)})(o),o}}async function X2(e){try{if(F("AP_REQUEST_DETAIL")||F("ENABLE_ROLE_SELECT_EDGE"))return;const t=J2(e);if(!t||e.cloudProxyServer!=="disabled")return;const n=await(async function(r,i){try{const s=await window.crypto.subtle.importKey("raw",F1(i),"AES-GCM",!1,["decrypt"]),o=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:new Uint8Array(1)},s,mh(r));return JSON.parse(window.atob(bd(new Uint8Array(o))))}catch{return}})(t,e.token||e.appId);if(!n||!(function(r,i){return r.cname===i.cname&&r.appId===i.appId&&r.token===i.token?i.stringUid?r.stringUid===i.stringUid:typeof i.uid=="number"?r.uid===i.uid:r.uid==i.uid:!1})(n,e))return;if(n&&Date.now()-n.ts<F("AP_CACHE_LIFETIME"))return n}catch(t){R.warn("Error get preloadInfo",t.message)}}function J2(e){let t;try{if(t=$2(Qf),!t)return;const n=JSON.parse(t),r=eU(e),i=(function(o,c){for(let l=o.length-1;l>=0;l--)if(c(o[l]))return l;return-1})(n,(o=>r in o));if(i===-1)return;const s=n.splice(i,1)[0];return bT(Qf,JSON.stringify(n)),s[r]}catch(n){R.warn("Error delete preload info: ".concat(t),n.message),bT(Qf,"")}}function SI(e){if(e){let t=Ah.get(e);t&&(window.clearTimeout(t),t=null,Ah.delete(e)),Re(Nh).call(Nh,e)||e.cloudProxyServer!=="disabled"||Nh.push(e)}if(Ah.size<F("AP_CACHE_NUM")&&Nh.length>0){const t=Nh.shift();Ah.set(t,window.setTimeout((async()=>{const{appId:n,cname:r,token:i,stringUid:s,uid:o,proxyServer:c}=t;try{await B9(n,r,i,o,c,s),Ah.has(t)&&SI(t)}catch(l){R.warn("update preload failed",l.message),Q2(t)}}),F("AP_UPDATE_INTERVAL")))}}function Q2(e){const t=Nh.indexOf(e);t!==-1&&Nh.splice(t,1);let n=Ah.get(e);n&&(window.clearTimeout(n),n=null,Ah.delete(e),SI())}function Z2(e,t){const n=e.sua,r=e.ap;t&&n&&We.reqUserAccount(e.sid,{lts:n.requestTime,elapse:n.elapse,success:!0,serverAddr:n.url,stringUid:t,uid:e.intUid,errorCode:null,extend:n.req}),We.reportResourceTiming(e.ap.url,e.sid),We.joinWebProxyAP(e.sid,{lts:r.requestTime,elapse:r.elapse,sucess:1,apServerAddr:r.url,turnServerAddrList:r.proxyInfo.addresses.map((i=>i.ip)).join(","),eventType:"disabled",unilbsServerIds:[Zn.CHOOSE_SERVER,Zn.CLOUD_PROXY_FALLBACK].toString()}),We.joinChooseServer(e.sid,{lts:r.requestTime,elapse:r.elapse,succ:!0,csAddr:r.url,opid:r.opid,serverList:r.gatewayInfo.gatewayAddrs.map((i=>i.address)),ec:null,cid:r.gatewayInfo.cid.toString(),uid:r.gatewayInfo.uid.toString(),csIp:r.gatewayInfo.csIp,unilbsServerIds:[Zn.CHOOSE_SERVER].toString(),isHttp3:r.isHttp3})}function $2(e){return window.atob(window.localStorage.getItem(e)||"")}function bT(e,t){window.localStorage.setItem(e,window.btoa(t))}function eU(e){let t="".concat(e.appId,"_").concat(e.cname);return typeof e.uid=="string"&&(t+="_s_".concat(e.uid)),typeof e.uid=="number"&&(t+="_".concat(e.uid)),e.token&&(t+="_".concat(e.token)),Y1(t)}function W9(e){let t=(function(){const n=K9.pop();return n?(n.offset=n.limit=0,n):{bytes:new Uint8Array(64),offset:0,limit:0}})();return(function(n,r){let i=n.appId;i!==void 0&&($n(r,10),jd(r,i));let s=n.cid;s!==void 0&&($n(r,16),$n(r,s));let o=n.cname;o!==void 0&&($n(r,26),jd(r,o));let c=n.deviceId;c!==void 0&&($n(r,34),jd(r,c));let l=n.elapse;l!==void 0&&($n(r,40),Fd(r,l));let h=n.fileSize;h!==void 0&&($n(r,48),Fd(r,Zf(h)));let p=n.height;p!==void 0&&($n(r,56),Fd(r,Zf(p)));let E=n.jpg;E!==void 0&&($n(r,66),$n(r,E.length),nU(r,E));let g=n.networkType;g!==void 0&&($n(r,72),Fd(r,Zf(g)));let v=n.osType;v!==void 0&&($n(r,80),Fd(r,Zf(v)));let O=n.requestId;O!==void 0&&($n(r,90),jd(r,O));let I=n.sdkVersion;I!==void 0&&($n(r,98),jd(r,I));let N=n.sequence;N!==void 0&&($n(r,104),Fd(r,Zf(N)));let M=n.sid;M!==void 0&&($n(r,114),jd(r,M));let x=n.timestamp;x!==void 0&&($n(r,120),Fd(r,x));let B=n.uid;B!==void 0&&($n(r,128),$n(r,B));let Z=n.vid;Z!==void 0&&($n(r,136),$n(r,Z));let Q=n.width;Q!==void 0&&($n(r,144),Fd(r,Zf(Q)));let z=n.service;z!==void 0&&($n(r,152),$n(r,z));let te=n.callbackData;te!==void 0&&($n(r,162),$n(r,te.length),nU(r,te));let de=n.ticket;de!==void 0&&($n(r,170),jd(r,de));let me=n.vendorConfigs;me!==void 0&&($n(r,178),jd(r,me))})(e,t),(function(n){let r=n.bytes,i=n.limit;return r.length===i?r:r.subarray(0,i)})(t)}function G9(e){return(function(n){let r={};e:for(;!z9(n);){let i=og(n);switch(i>>>3){case 0:break e;case 1:r.code=og(n);break;case 2:r.msg=rU(n,og(n));break;case 3:r.requestId=rU(n,og(n));break;case 4:r.timestamp=Y9(n,!1);break;default:H9(n,7&i)}}return r})({bytes:t=e,offset:0,limit:t.length});var t}function H9(e,t){switch(t){case 0:for(;128&zo(e););break;case 2:TI(e,og(e));break;case 5:TI(e,4);break;case 1:TI(e,8);break;default:throw new Error("Unimplemented type: "+t)}}function Zf(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}let K9=[];function TI(e,t){if(e.offset+t>e.limit)throw new Error("Skip past limit");e.offset+=t}function z9(e){return e.offset>=e.limit}function IT(e,t){let n=e.bytes,r=e.offset,i=e.limit,s=r+t;if(s>n.length){let o=new Uint8Array(2*s);o.set(n),e.bytes=o}return e.offset=s,s>i&&(e.limit=s),r}function tU(e,t){let n=e.offset;if(n+t>e.limit)throw new Error("Read past limit");return e.offset+=t,n}function nU(e,t){let n=IT(e,t.length);e.bytes.set(t,n)}function rU(e,t){let n=tU(e,t),r=String.fromCharCode,i=e.bytes,s="",o="";for(let c=0;c<t;c++){let l,h,p,E,g=i[c+n];(128&g)==0?o+=r(g):(224&g)==192?c+1>=t?o+=s:(l=i[c+n+1],(192&l)!=128?o+=s:(E=(31&g)<<6|63&l,E<128?o+=s:(o+=r(E),c++))):(240&g)==224?c+2>=t?o+=s:(l=i[c+n+1],h=i[c+n+2],(49344&(l|h<<8))!=32896?o+=s:(E=(15&g)<<12|(63&l)<<6|63&h,E<2048||E>=55296&&E<=57343?o+=s:(o+=r(E),c+=2))):(248&g)==240?c+3>=t?o+=s:(l=i[c+n+1],h=i[c+n+2],p=i[c+n+3],(12632256&(l|h<<8|p<<16))!=8421504?o+=s:(E=(7&g)<<18|(63&l)<<12|(63&h)<<6|63&p,E<65536||E>1114111?o+=s:(E-=65536,o+=r(55296+(E>>10),56320+(1023&E)),c+=3))):o+=s}return o}function jd(e,t){let n=t.length,r=0;for(let o=0;o<n;o++){let c=t.charCodeAt(o);c>=55296&&c<=56319&&o+1<n&&(c=(c<<10)+t.charCodeAt(++o)-56613888),r+=c<128?1:c<2048?2:c<65536?3:4}$n(e,r);let i=IT(e,r),s=e.bytes;for(let o=0;o<n;o++){let c=t.charCodeAt(o);c>=55296&&c<=56319&&o+1<n&&(c=(c<<10)+t.charCodeAt(++o)-56613888),c<128?s[i++]=c:(c<2048?s[i++]=c>>6&31|192:(c<65536?s[i++]=c>>12&15|224:(s[i++]=c>>18&7|240,s[i++]=c>>12&63|128),s[i++]=c>>6&63|128),s[i++]=63&c|128)}}function zo(e){return e.bytes[tU(e,1)]}function iU(e,t){let n=IT(e,1);e.bytes[n]=t}function og(e){let t,n=0,r=0;do t=zo(e),n<32&&(r|=(127&t)<<n),n+=7;while(128&t);return r}function $n(e,t){for(t>>>=0;t>=128;)iU(e,127&t|128),t>>>=7;iU(e,t)}function Y9(e,t){let n,r=0,i=0,s=0;return n=zo(e),r=127&n,128&n&&(n=zo(e),r|=(127&n)<<7,128&n&&(n=zo(e),r|=(127&n)<<14,128&n&&(n=zo(e),r|=(127&n)<<21,128&n&&(n=zo(e),i=127&n,128&n&&(n=zo(e),i|=(127&n)<<7,128&n&&(n=zo(e),i|=(127&n)<<14,128&n&&(n=zo(e),i|=(127&n)<<21,128&n&&(n=zo(e),s=127&n,128&n&&(n=zo(e),s|=(127&n)<<7))))))))),{low:r|i<<28,high:i>>>4|s<<24,unsigned:t}}function Fd(e,t){let n=t.low>>>0,r=(t.low>>>28|t.high<<4)>>>0,i=t.high>>>24,s=i===0?r===0?n<16384?n<128?1:2:n<1<<21?3:4:r<16384?r<128?5:6:r<1<<21?7:8:i<128?9:10,o=IT(e,s),c=e.bytes;switch(s){case 10:c[o+9]=i>>>7&1;case 9:c[o+8]=s!==9?128|i:127&i;case 8:c[o+7]=s!==8?r>>>21|128:r>>>21&127;case 7:c[o+6]=s!==7?r>>>14|128:r>>>14&127;case 6:c[o+5]=s!==6?r>>>7|128:r>>>7&127;case 5:c[o+4]=s!==5?128|r:127&r;case 4:c[o+3]=s!==4?n>>>21|128:n>>>21&127;case 3:c[o+2]=s!==3?n>>>14|128:n>>>14&127;case 2:c[o+1]=s!==2?n>>>7|128:n>>>7&127;case 1:c[o]=s!==1?128|n:127&n}}const sU={},oU={},AT=4294967296,q9=AT*AT,aU=q9/2;lU(0,!0);const cU=lU(0),X9=ag(0,-2147483648,!1),J9=ag(-1,2147483647,!1);function lU(e,t){let n,r,i;return t?(i=0<=(e>>>=0)&&e<256)&&(r=oU[e],r)?r:(n=ag(e,0,!0),i&&(oU[e]=n),n):(i=-128<=(e|=0)&&e<128)&&(r=sU[e],r)?r:(n=ag(e,e<0?-1:0,!1),i&&(sU[e]=n),n)}function ag(e,t,n){return{low:0|e,high:0|t,unsigned:!!n}}function dU(e,t){if(isNaN(e))return cU;{if(e<=-aU)return X9;if(e+1>=aU)return J9}return e<0?cU:ag(e%AT|0,e/AT|0,t)}function uU(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable}))),n.push.apply(n,r)}return n}class RI extends Pn{get connectionState(){return this._connectionState}set connectionState(t){if(this._connectionState===t)return;const n=this._connectionState;this._connectionState=t,this.emit(ba.CONNECTION_STATE_CHANGE,t,n)}get quality(){return this._quality}set quality(t){this._quality=t>1?1:t<.1?.1:t,this._qualityTimer&&(window.clearTimeout(this._qualityTimer),this._qualityTimer=null),this._quality>=1||(this._qualityTimer=window.setTimeout((()=>{this.quality=this._quality/this._qualityRatio}),6e4))}constructor(t){var n;super(),k(this,"name","AgoraRTCImageModeration"),k(this,"_connectionState",so.CONNECTING),k(this,"_sequence",0),k(this,"_moderationStartTime",void 0),k(this,"_workerConnection",void 0),k(this,"_workerMessageLengthLimit",void 0),k(this,"_qualityRatio",void 0),k(this,"_connectInfo",void 0),k(this,"_cancelTokenSource",Mi.CancelToken.source()),k(this,"_retryConfig",void 0),k(this,"_moderationInterval",void 0),k(this,"_moderationTimer",null),k(this,"_moderationMode",1),k(this,"_quality",1),k(this,"_qualityTimer",null),k(this,"_ticket",void 0),k(this,"_moderationIntervalMinimum",void 0),k(this,"_uploadFailedNum",0),k(this,"_uploadNum",0),k(this,"_uploadTimer",null),k(this,"_extraInfo",void 0),k(this,"_vendor",""),k(this,"_encoder",new TextEncoder),k(this,"_moderationId",void 0),k(this,"inspectImage",(()=>{if(this.connectionState!==so.CONNECTED)throw new se(U.OPERATION_ABORTED,"image moderation service connection status is ".concat(this.connectionState));this._moderationTimer&&(window.clearInterval(this._moderationTimer),this._moderationTimer=null),this._moderationTimer=window.setInterval((()=>{this.connectionState===so.CONNECTED?this.requestToInspectImage():R.debug("[".concat(this._moderationId,"] Moderation State is not connected , "),this.connectionState)}),this._moderationInterval<this._moderationIntervalMinimum?this._moderationIntervalMinimum:this._moderationInterval),this.requestToInspectImage()})),this._moderationId=ln(5,"image-moderation-"),this._workerMessageLengthLimit=F("IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT"),this._moderationIntervalMinimum=F("IMAGE_MODERATION_INTERVAL_MINIMUM"),this._moderationInterval=(n=t.interval)!==null&&n!==void 0?n:1e3,t.extraInfo&&(this._extraInfo=this._encoder.encode(t.extraInfo)),t.vendor&&(this._vendor=t.vendor),this._qualityRatio=F("IMAGE_MODERATION_QUALITY_RATIO"),this._moderationStartTime=Number(Date.now()),this._workerConnection=new JE("worker-"+this._moderationId,rr),this.on(ba.STATE_CHANGE,((r,i)=>{R.debug("[".concat(this._moderationId,"] Moderation operation :").concat(Bf[r]," ").concat(i||""))})),this.handleWorkerEvents()}async init(t,n){this.emit(ba.STATE_CHANGE,Bf.CONNECT_AP),this._connectInfo=t;const r=this._cancelTokenSource.token;return this._retryConfig=n,new Pe(((i,s)=>{this.on(ba.CONNECTION_STATE_CHANGE,((o,c)=>{o===so.CONNECTED&&i()})),this.requestAP(t,r,n).then((o=>{this.connectWorker(o)})).catch((o=>{s(o)}))}))}updateConfig(t){var n;this._moderationInterval=(n=t.interval)!==null&&n!==void 0?n:1e3,t.extraInfo&&(this._extraInfo=this._encoder.encode(t.extraInfo)),t.vendor&&(this._vendor=t.vendor),R.debug("[".concat(this._moderationId,"] updateConfig: ").concat(JSON.stringify(t))),this.connectionState===so.CONNECTED&&this.inspectImage()}async requestAP(t,n,r){const i=F("WEBCS_DOMAIN").map((l=>"https://".concat(l,"/api/v1"))),s=await(function(l,h,p,E){let{appId:g,areaCode:v,cname:O,sid:I,token:N,uid:M}=h;Yf++;const x="moderation_plugin",B={service_name:x,json_body:JSON.stringify({appId:g,areaCode:v,cname:O,command:"allocateEdge",requestId:Yf,seq:Yf,sid:I,appToken:N,ts:Date.now(),uid:M+""})};let Z,Q,z=l[0];return Ta((async()=>{Z=Date.now();const te=await Ia(z,{data:B,cancelToken:p,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(Q=Date.now()-Z,te.code!==0){const ve=new se(U.UNEXPECTED_RESPONSE,"moderation plugin ap error, code"+te.code,{retry:!0,responseTime:Q});throw R.error(ve.toString()),ve}const de=JSON.parse(te.json_body);if(de.code!==200){const ve=new se(U.UNEXPECTED_RESPONSE,"moderation plugin ap error, code: ".concat(de.code,", reason: ").concat(de.reason),{code:de.code,responseTime:Q});throw R.error(ve.toString()),ve}if(!de.servers||!Array.isArray(de.servers)||de.servers.length===0){const ve=new se(U.UNEXPECTED_RESPONSE,"moderation plugin ap empty server",{code:de.code,responseTime:Q});throw R.error(ve.toString()),ve}if(!de.servers.some((ve=>!!ve.wss))){const ve=new se(U.UNEXPECTED_RESPONSE,"moderation plugin ap empty port",{code:de.code,responseTime:Q});throw R.error(ve.toString()),ve}const me=F("IMAGE_MODERATION_WORKER_HOST");return{addressList:de.servers.map((ve=>{let{address:St,wss:wt}=ve;if(St&&wt)return"wss://".concat(St.replace(/\./g,"-"),".").concat(me,":").concat(wt,"/moderation")})).filter((ve=>!!ve)),workerToken:de.workerToken,vid:de.vid,ticket:de.appTicket,responseTime:Q}}),((te,de)=>(We.apworkerEvent(I,{success:!0,sc:200,serviceName:x,responseDetail:JSON.stringify(te.addressList),firstSuccess:de===0,responseTime:Q,serverIp:l[de%l.length]}),!1)),((te,de)=>(We.apworkerEvent(I,{success:!1,sc:te.data&&te.data.code||200,serviceName:x,responseTime:Q,serverIp:l[de%l.length]}),!!(te.code!==U.OPERATION_ABORTED&&te.code!==U.UNEXPECTED_RESPONSE||te.data&&te.data.retry)&&(z=l[(de+1)%l.length],!0))),E)})(i,t,n,r);this.emit(ba.STATE_CHANGE,Bf.AP_CONNECTED);const{addressList:o,ticket:c}=s;return this._ticket=c,o}async connectWorker(t){this.emit(ba.STATE_CHANGE,Bf.CONNECT_WORKER),await this._workerConnection.init(t,1e4)}handleWorkerEvents(){this._workerConnection.on(gt.CONNECTED,(async()=>{this.emit(ba.STATE_CHANGE,Bf.WORKER_CONNECTED,this._workerConnection.url),this.connectionState=so.CONNECTED})),this._workerConnection.on(gt.CLOSED,(()=>{this.connectionState=so.CLOSED})),this._workerConnection.on(gt.FAILED,(()=>{this.connectionState=so.CLOSED})),this._workerConnection.on(gt.RECONNECTING,(()=>{this.connectionState=this.connectionState===so.CONNECTED?so.RECONNECTING:so.CONNECTING})),this._workerConnection.on(gt.ON_MESSAGE,(async t=>{if(t.data instanceof ArrayBuffer){const n=G9(new Uint8Array(t.data));F("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&R.debug("[".concat(this._moderationId,"] Response message for worker of image moderation "),JSON.stringify(n)),this._uploadNum++,n.code===void 0||n.code===0||(this._uploadFailedNum++,R.error("[".concat(this._moderationId,"] Error response from worke, code is ").concat(n.code,", msg is ").concat(n.msg)),this._uploadTimer||(this._uploadTimer=window.setTimeout((()=>{We.reportApiInvoke(this._connectInfo.sid||null,{name:Bn.IMAGE_MODERATION_UPLOAD,options:[this._uploadFailedNum,this._uploadNum,n.code],tag:In.TRACER}).onError(new se(U.IMAGE_MODERATION_UPLOAD_FAILED,n.msg)),this._uploadTimer=null}),F("IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL"))))}else R.error("[".concat(this._moderationId,"] Unexpected message type from worker"))})),this._workerConnection.on(gt.WILL_RECONNECT,((t,n,r)=>{t==="recover"&&r(t),r("tryNext")})),this._workerConnection.on(gt.REQUEST_NEW_URLS,((t,n)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(t).catch(n)}))}static intToLong(t){return{low:t|=0,high:t>>31,unsigned:t>=0}}async requestToInspectImage(){const t=Is(this,ba.CLIENT_LOCAL_VIDEO_TRACK),n={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(t){if(!t.isPlaying)return void(F("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&R.debug("Only the track being played can be inspected"));this._sequence++;const r=await this.generateRequestData(t,n);this._workerConnection.sendMessage(r,!0,!0)}else F("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&R.debug("Only the track being published can be inspected")}async generateRequestData(t,n){let{appId:r,cname:i,cid:s,vid:o,sid:c,uid:l}=n;const h=Date.now(),p=await t.getCurrentFrameImage("image/jpeg",this.quality),E=await ML(p,r,i),g=this._sequence+"-"+s+"-"+l+"-"+h+"-"+ln(12,""),v={appId:r,cid:s,cname:i,deviceId:"",elapse:RI.intToLong(Number(h-this._moderationStartTime)),fileSize:p.buffer.byteLength,height:p.height,width:p.width,jpg:E,networkType:6,osType:7,requestId:g,sdkVersion:"4.24.0",sequence:this._sequence,sid:c,timestamp:dU(h),uid:l,vid:o,service:this._moderationMode,ticket:this._ticket,callbackData:this._extraInfo,vendorConfigs:this._vendor};this._extraInfo===void 0&&delete v.callbackData;const O=W9(v);if(O.byteLength<this._workerMessageLengthLimit){if(F("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")){const I=(function(N){for(var M=1;M<arguments.length;M++){var x=arguments[M]!=null?arguments[M]:{};M%2?uU(Object(x),!0).forEach((function(B){k(N,B,x[B])})):Object.getOwnPropertyDescriptors?Object.defineProperties(N,Object.getOwnPropertyDescriptors(x)):uU(Object(x)).forEach((function(B){Object.defineProperty(N,B,Object.getOwnPropertyDescriptor(x,B))}))}return N})({},v);delete I.jpg,R.debug("[".concat(this._moderationId,"] Request message for worker of image moderation service: "),JSON.stringify(I))}return O}{const I=this.quality*this._qualityRatio;return this.quality=I,await this.generateRequestData(t,{appId:r,cname:i,cid:s,vid:o,sid:c,uid:l})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=Mi.CancelToken.source(),this._workerConnection&&this._workerConnection.close(),this._moderationTimer&&window.clearInterval(this._moderationTimer),this._moderationTimer=null,this._uploadTimer&&window.clearTimeout(this._uploadTimer),this._uploadTimer=null,this.connectionState=so.CLOSED,this.emit(ba.STATE_CHANGE,Bf.CLOSED)}}function hU(e){if(on(e.interval,"interval",1e3,1/0),e&&e.extraInfo&&e.extraInfo.length>1024)throw new se(U.INVALID_PARAMS,"config.extraInfo length cannot exceed 1024 bytes");if(e&&e.vendor&&e.vendor.length>1024)throw new se(U.INVALID_PARAMS,"config.vendor length cannot exceed 1024 bytes")}const Q9={name:"ImageModeration",create:function(e){let{config:t}=e;return hU(t),new RI(t)}};var pU,fU,mU,_U,EU,gU,vU,yU,SU,TU,RU,CU,wU,bU,IU,AU,NU,OU,PU,DU,kU,LU,xU,MU,UU,VU,jU,FU,BU,WU,GU,HU,KU,zU,YU,qU,XU,JU,QU,ZU,$U,De;function eV(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable}))),n.push.apply(n,r)}return n}function Yo(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?eV(Object(n),!0).forEach((function(r){k(e,r,n[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):eV(Object(n)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))}))}return e}Yr.setLogger(R);let Z9=(pU=et(),fU=et({argsMap:(e,t)=>{if(!Array.isArray(t)){if(!(t instanceof kf))return[t];t=[t]}return t.map((n=>n?Object(n).toString():"null"))}}),mU=et({argsMap:(e,t)=>(t||(t=[]),Array.isArray(t)||t.trackMediaType!==Df.DATA?(Array.isArray(t)||(t=[t]),t.map((n=>n.getTrackId()))):[t.getChannelId()])}),_U=et({argsMap:(e,t,n,r)=>[typeof t=="object"?t.uid:t,n,r]}),EU=et({argsMap:(e,t,n)=>[t,n]}),gU=et({argsMap:(e,t)=>t.map((n=>{let{user:r,mediaType:i}=n;return[r?.uid,i]}))}),vU=et({argsMap:(e,t,n,r)=>[typeof t=="object"?t.uid:t,n,r]}),yU=et({argsMap:(e,t)=>t.map((n=>{let{user:r,mediaType:i}=n;return{uid:r?.uid,mediaType:i}}))}),SU=et(),TU=et(),RU=et(),CU=et(),wU=et(),bU=et(),IU=et(),AU=et(),NU=et(),OU=et(),PU=et(),DU=et(),kU=et(),LU=et(),xU=et(),MU=et({argsMap:(e,t)=>[t]}),UU=et(),VU=et(),jU=et(),FU=et(),BU=et(),WU=et(),GU=et(),HU=et(),KU=et({argsMap:(e,t)=>(Array.isArray(t)||(t=[t]),[JSON.stringify(t)])}),zU=et(),YU=et(),qU=et(),XU=et(),JU=et(),QU=et(),ZU=et({reportResult:!0}),$U=et(),De=class extends Pn{get connectionState(){return this._gateway.state}get remoteUsers(){return this._users}get localTracks(){return this._p2pChannel.getAllTracks(!0)}get uid(){return this._uid}get channelName(){return this._channelName}get localDataChannels(){return this._p2pChannel.getAllDataChannels()}get mode(){return this._config.mode}get role(){var e;return((e=this._config)===null||e===void 0?void 0:e.role)||"audience"}get codec(){return this._config.codec}get audioCodec(){return this._config.audioCodec||"opus"}get isStringUID(){return!!this._joinInfo&&!!this._joinInfo.stringUid}get __className__(){return"Client"}constructor(e,t){let n;if(super(),k(this,"store",void 0),k(this,"_uid",void 0),k(this,"_channelName",void 0),k(this,"_uintUid",void 0),k(this,"_users",[]),k(this,"_config",void 0),k(this,"_clientId",void 0),k(this,"_appId",void 0),k(this,"_sessionId",null),k(this,"_key",void 0),k(this,"_rtmConfig",{}),k(this,"_joinInfo",void 0),k(this,"_gateway",void 0),k(this,"_statsCollector",void 0),k(this,"_configDistribute",void 0),k(this,"_leaveMutex",void 0),k(this,"_publishMutex",void 0),k(this,"_renewTokenMutex",void 0),k(this,"_subscribeMutex",void 0),k(this,"_encryptionMode","none"),k(this,"_encryptionSecret",null),k(this,"_encryptionSalt",null),k(this,"_encryptDataStream",!1),k(this,"_encryptDataStreamKey",null),k(this,"_encryptDataStreamIv",null),k(this,"_proxyServer",void 0),k(this,"_turnServer",{servers:[],mode:"auto"}),k(this,"_cloudProxyServerMode","disabled"),k(this,"_isDualStreamEnabled",!1),k(this,"_defaultStreamFallbackType",void 0),k(this,"_lowStreamParameter",void 0),k(this,"_streamFallbackTypeCacheMap",new Map),k(this,"_remoteStreamTypeCacheMap",new Map),k(this,"_axiosCancelSource",Mi.CancelToken.source()),k(this,"_audioVolumeIndicationInterval",void 0),k(this,"_networkQualityInterval",void 0),k(this,"_userOfflineTimeout",void 0),k(this,"_streamRemovedTimeout",void 0),k(this,"_liveTranscodeStreamingClient",void 0),k(this,"_liveRawStreamingClient",void 0),k(this,"_channelMediaRelayClient",void 0),k(this,"_networkQualitySensitivity","normal"),k(this,"_p2pChannel",void 0),k(this,"_useLocalAccessPoint",!1),k(this,"_setLocalAPVersion",void 0),k(this,"_joinAndNotLeaveYet",!1),k(this,"_numberOfJoinCount",0),k(this,"_joinResponse",null),k(this,"_remoteDefaultVideoStreamType",void 0),k(this,"_inspect",void 0),k(this,"_moderation",void 0),k(this,"_license",void 0),k(this,"_pendingPublishedUsers",[]),k(this,"ntpAlignErrorCount",0),k(this,"remoteInboundOffset",0),k(this,"_peerConnectionState",void 0),k(this,"_handleLocalTrackEnable",((i,s,o)=>{this.publish(i,!1).then(s).catch(o)})),k(this,"_handleLocalTrackDisable",((i,s,o)=>{this.unpublish(i).then(s).catch(o)})),k(this,"_handleUserOnline",(i=>{if(F("BLOCK_LOCAL_CLIENT")&&Ch(i.uid,this.channelName))return void R.debug("[".concat(i.uid,"] will be ignored in local"));this.isStringUID&&typeof i.uid!="string"&&R.error("[".concat(this._clientId,"] StringUID is Mixed with UintUID"));const s=this._users.find((o=>o.uid===i.uid));if(s)s._trust_in_room_=!0,s._is_pre_created&&(s._is_pre_created=!1,this.safeEmit(Nt.USER_JOINED,s));else{const o=new Ud(i.uid,i.uint_id||i.uid);this._users.push(o),R.debug("[".concat(this._clientId,"] user online"),i.uid),this.store.firstVideoFrameDecoded(o.uid,{userJoinNotify:Date.now()}),this.safeEmit(Nt.USER_JOINED,o)}})),k(this,"_handleUserOffline",(i=>{if(F("BLOCK_LOCAL_CLIENT")&&Ch(i.uid,this.channelName))return;const s=this._users.find((o=>o.uid===i.uid));s&&(this._handleRemoveStream(i),this._handleRemoveDataChannels(i),s._audio_pre_subscribed||s._video_pre_subscribed?s._is_pre_created=!0:AS(this._users,s),this._remoteStreamTypeCacheMap.delete(s.uid),this._streamFallbackTypeCacheMap.delete(s.uid),R.debug("[".concat(this._clientId,"] user offline"),i.uid,"reason:",i.reason),this.safeEmit(Nt.USER_LEAVED,s,i.reason))})),k(this,"_handleAddAudioOrVideoStream",((i,s,o,c,l,h,p,E)=>{if(F("BLOCK_LOCAL_CLIENT")&&Ch(s,this.channelName))return;const g=this._users.find((O=>O.uid===s));if(!g)return void R.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));R.debug("[".concat(this._clientId,"] stream added with uid ").concat(s,", type ").concat(i)),this.store.subscribe(g.uid,i,void 0,void 0,void 0,Date.now()),i==="video"&&this.store.firstVideoFrameDecoded(g.uid,{videoAddNotify:Date.now()});const v=i==="audio"?g.hasAudio:g.hasVideo;if(g._uintid||(g._uintid=h||s),i==="audio"?g._trust_audio_stream_added_state_=!0:g._trust_video_stream_added_state_=!0,i==="audio"?(g._audio_added_=!0,o!==void 0&&(g._audioSSRC=o),c!==void 0&&(g._cname=c),p&&(g._audioOrtc=p)):(g._video_added_=!0,o!==void 0&&(g._videoSSRC=o),c!==void 0&&(g._cname=c),E!==void 0&&(g._rtxSsrcId=E),p&&(g._videoOrtc=p)),(i==="audio"?g.hasAudio:g.hasVideo)&&!v&&(R.info("[".concat(this._clientId,"] remote user ").concat(g.uid," published ").concat(i)),this.safeEmit(Nt.USER_PUBLISHED,g,i)),i==="video"?We.onGatewayStream(this._sessionId,pr.ON_ADD_VIDEO_STREAM,bn.ON_ADD_VIDEO_STREAM,{peer:h||s,ssrc:g._videoSSRC}):We.onGatewayStream(this._sessionId,pr.ON_ADD_AUDIO_STREAM,bn.ON_ADD_AUDIO_STREAM,{peer:h||s,ssrc:g._audioSSRC}),this._p2pChannel.remoteMediaSsrcChanged(g,i,o).then((O=>{if(O&&(R.debug("[".concat(this._clientId,"] resubscribe ").concat(i," for user ").concat(g.uid," after rejoin because SSRC id changed.")),this._p2pChannel instanceof sg))return this._p2pChannel.unsubscribe(g,i,!0).then((()=>this._subscribe(g,i,!0).catch((I=>{R.error("[".concat(this._clientId,"] resubscribe error"),I.toString())}))))})),this._p2pChannel.hasPendingRemoteMedia(g,i)&&(R.debug("[".concat(this._clientId,"] resubscribe ").concat(i," for user ").concat(g.uid," after reconnect.")),this._subscribe(g,i,!0).catch((O=>{R.error("[".concat(this._clientId,"] resubscribe error"),O.toString())}))),i==="video"&&!Vr()&&!ni()){const O=this._getEncodingName(l);O?.toLocaleLowerCase()==WE.av1&&R9().then((I=>{I||this._gateway.downgradeCodec(O)}))}})),k(this,"_handleRemoveStream",(i=>{if(F("BLOCK_LOCAL_CLIENT")&&Ch(i.uid,this.channelName))return;const s=this._users.find((c=>c.uid===i.uid));if(!s)return void R.warning("[".concat(this._clientId,"] can not find target user!(on_remove_stream)"));R.debug("[".concat(this._clientId,"] stream removed with uid ").concat(i.uid));let o=()=>{};s.hasAudio&&s.hasVideo?o=()=>{R.info("[".concat(this._clientId,"] remote user ").concat(s.uid," unpublished audio track")),this.safeEmit(Nt.USER_UNPUBLISHED,s,"audio"),R.info("[".concat(this._clientId,"] remote user ").concat(s.uid," unpublished video track")),this.safeEmit(Nt.USER_UNPUBLISHED,s,"video")}:s.hasVideo?o=()=>{R.info("[".concat(this._clientId,"] remote user ").concat(s.uid," unpublished video track")),this.safeEmit(Nt.USER_UNPUBLISHED,s,"video")}:s.hasAudio&&(o=()=>{R.info("[".concat(this._clientId,"] remote user ").concat(s.uid," unpublished audio track")),this.safeEmit(Nt.USER_UNPUBLISHED,s,"audio")}),s._video_pre_subscribed||s._audio_pre_subscribed||(s._trust_audio_stream_added_state_=!0,s._trust_video_stream_added_state_=!0,s._audio_added_=!1,s._video_added_=!1,this._p2pChannel instanceof sg&&this._p2pChannel.unsubscribe(s).then((c=>{if(c)return this._gateway.unsubscribe(c,s.uid)})),s._audioSSRC=void 0,s._videoSSRC=void 0,s._audioOrtc=void 0,s._videoOrtc=void 0,s._rtxSsrcId=void 0),We.onGatewayStream(this._sessionId,pr.ON_REMOVE_STREAM,bn.ON_REMOVE_STREAM,{peer:i.uint_id||i.uid}),o()})),k(this,"_handleSetStreamLocalEnable",((i,s,o)=>{if(F("BLOCK_LOCAL_CLIENT")&&Ch(s,this.channelName))return;const c=this._users.find((p=>p.uid===s));if(!c)return void R.error("[".concat(this._clientId,"] can not find target user!(disable_local)"));R.debug("[".concat(this._clientId,"] local ").concat(i," ").concat(o?"enabled":"disabled"," with uid ").concat(s));const l=i==="audio"?c.hasAudio:c.hasVideo;if(i==="audio"){c._trust_audio_enabled_state_=!0;const p=c._audio_enabled_;if(c._audio_enabled_=o,c._audio_enabled_===p)return;{const E=c._audio_enabled_?"enable-local-audio":"disable-local-audio";R.debug("[".concat(this._clientId,"] user-info-updated, uid: ").concat(s,", msg: ").concat(E)),this.safeEmit(Nt.USER_INFO_UPDATED,s,E)}}else{c._trust_video_enabled_state_=!0;const p=c._video_enabled_;if(c._video_enabled_=o,c._video_enabled_===p)return;{const E=c._video_enabled_?"enable-local-video":"disable-local-video";R.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(s,", msg: ").concat(E)),this.safeEmit(Nt.USER_INFO_UPDATED,s,E)}}const h=i==="audio"?c.hasAudio:c.hasVideo;return l!==h?!l&&h?(R.info("[".concat(this._clientId,"] remote user ").concat(s," published ").concat(i)),void this.safeEmit(Nt.USER_PUBLISHED,c,i)):(i==="video"&&c._videoTrack&&c._videoTrack._destroy(),i==="audio"&&c._audioTrack,this._p2pChannel.muteRemote(c,i),R.info("[".concat(this._clientId,"] remote user ").concat(s," unpublished ").concat(i)),void this.safeEmit(Nt.USER_UNPUBLISHED,c,i)):void 0})),k(this,"_handleMuteStream",((i,s,o)=>{if(F("BLOCK_LOCAL_CLIENT")&&Ch(i,this.channelName))return;R.debug("[".concat(this._clientId,"] receive mute message"),i,s,o);const c=this._users.find((p=>p.uid===i));if(!c)return void R.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(i));const l=s==="audio"?c.hasAudio:c.hasVideo;if(s==="audio"){c._trust_audio_mute_state_=!0;const p=c._audio_muted_;if(c._audio_muted_=o,c._audio_muted_===p)return;{const E=c._audio_muted_?"mute-audio":"unmute-audio";R.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(i,", msg: ").concat(E)),this.safeEmit(Nt.USER_INFO_UPDATED,i,E)}}else{c._trust_video_mute_state_=!0;const p=c._video_muted_;if(c._video_muted_=o,c._video_muted_===p)return;{const E=c._video_muted_?"mute-video":"unmute-video";R.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(i,", msg: ").concat(E)),this.safeEmit(Nt.USER_INFO_UPDATED,i,E)}}const h=s==="audio"?c.hasAudio:c.hasVideo;if(l!==h){if(!l&&h)return(s==="audio"?c._audioSSRC:c._videoSSRC)?(R.info("[".concat(this._clientId,"] remote user ").concat(i," published ").concat(s)),void this.safeEmit(Nt.USER_PUBLISHED,c,s)):void R.warning("[".concat(this._clientId,"] remote user ").concat(i," receive ").concat(s," unmute message  before add stream message, ").concat(s," SSRC doesn't exist yet."));s==="video"&&c._videoTrack&&!c._video_pre_subscribed&&c._videoTrack._destroy(),s==="audio"&&c._audioTrack,this._p2pChannel.muteRemote(c,s),R.info("[".concat(this._clientId,"] remote user ").concat(i," unpublished ").concat(s)),this.safeEmit(Nt.USER_UNPUBLISHED,c,s)}})),k(this,"_handleP2PLost",(async i=>{R.debug("[".concat(this._clientId,"] receive p2p lost"),i),parseInt(i.p2pid,10)===this.store.p2pId?await this._p2pChannel.requestReconnect():R.warning("[".concat(this._clientId,"] P2PLost stream not found"),i)})),k(this,"_handleTokenWillExpire",(()=>{R.debug("[".concat(this._clientId,"] received message onTokenPrivilegeWillExpire")),this.safeEmit(Nt.ON_TOKEN_PRIVILEGE_WILL_EXPIRE)})),k(this,"_handleBeforeUnload",(i=>{i.type==="beforeunload"&&i.returnValue!==void 0&&i.returnValue!==""||(this.leave(),R.info("[".concat(this._clientId,"] auto leave onbeforeunload or pagehide")))})),k(this,"_handleUpdateNetworkQuality",(()=>{if(this._networkQualitySensitivity==="normal")return;if(navigator&&navigator.onLine!==void 0&&!navigator.onLine)return void this.safeEmit(Nt.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6});const i={downlinkNetworkQuality:0,uplinkNetworkQuality:0};i.uplinkNetworkQuality=this._p2pChannel.getUplinkNetworkQuality(),i.downlinkNetworkQuality=this._p2pChannel.getDownlinkNetworkQuality(),this.safeEmit(Nt.NETWORK_QUALITY,i)})),k(this,"_handleP2PAddAudioOrVideoStream",((i,s,o,c)=>{const l=this._users.find((p=>p.uid===s));if(!l)return void R.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));R.debug("[".concat(this._clientId,"] stream added with uid ").concat(s,", type ").concat(i)),this.store.subscribe(l.uid,i,void 0,void 0,void 0,Date.now());const h=i==="audio"?l.hasAudio:l.hasVideo;i==="audio"?l._trust_audio_stream_added_state_=!0:l._trust_video_stream_added_state_=!0,i==="audio"?(l._audio_added_=!0,o!==void 0&&(l._audioSSRC=o),c!==void 0&&(l._audioMid=c)):(l._video_added_=!0,o!==void 0&&(l._videoSSRC=o),c!==void 0&&(l._videoMid=c)),(i==="audio"?l.hasAudio:l.hasVideo)&&!h&&(R.info("[".concat(this._clientId,"] remote user ").concat(l.uid," published ").concat(i)),this.safeEmit(Nt.USER_PUBLISHED,l,i)),this._p2pChannel.hasPendingRemoteMedia(l,i)&&(R.debug("[".concat(this._clientId,"] resubscribe ").concat(i," for user ").concat(l.uid," after reconnect.")),this._subscribe(l,i,!0).catch((p=>{R.error("[".concat(this._clientId,"] resubscribe error"),p.toString())})))})),this._config=e,this._clientId=t||ln(5,"client-"),this.store=new class{constructor(i,s,o,c){ct(this,"state",void 0),this.state={codec:i,audioCodec:s,mode:o,clientId:c,sessionId:null,p2pId:0,dcId:0,pubId:0,subId:0,keyMetrics:{publish:[],subscribe:[],firstVideoFrameDecoded:[]},joinChannelServiceRecords:[],cloudProxyServerMode:"disabled",useP2P:!1,p2pTransport:Eh.Default,hasStartJoinChannel:!1,isABTestSuccess:!1,autoSubscribe:!1,enableInstantMuteRestore:!1}}dispatch(i){this.state=(function(s,o){switch(o.type){case dt.SET_SESSION_ID:return ye(ye({},s),{},{sessionId:o.sessionId});case dt.SET_P2P_ID:return ye(ye({},s),{},{p2pId:o.p2pId});case dt.SET_UID:return ye(ye({},s),{},{uid:o.uid});case dt.SET_INT_UID:return ye(ye({},s),{},{intUid:o.intUid});case dt.SET_PUB_ID:return ye(ye({},s),{},{pubId:o.pubId});case dt.KEY_METRIC_CLIENT_CREATED:return ye(ye({},s),{},{keyMetrics:ye(ye({},s.keyMetrics),{},{clientCreated:o.metric})});case dt.KEY_METRIC_JOIN_START:return ye(ye({},s),{},{keyMetrics:ye(ye({},s.keyMetrics),{},{joinStart:o.metric})});case dt.KEY_METRIC_PRELOAD_START:return ye(ye({},s),{},{keyMetrics:ye(ye({},s.keyMetrics),{},{preloadStart:o.metric})});case dt.KEY_METRIC_PRELOAD_END:return ye(ye({},s),{},{keyMetrics:ye(ye({},s.keyMetrics),{},{preloadEnd:o.metric})});case dt.KEY_METRIC_JOIN_END:return ye(ye({},s),{},{keyMetrics:ye(ye({},s.keyMetrics),{},{joinEnd:o.metric})});case dt.KEY_METRIC_REQUEST_AP_START:return ye(ye({},s),{},{keyMetrics:ye(ye({},s.keyMetrics),{},{requestAPStart:o.metric})});case dt.KEY_METRIC_REQUEST_AP_END:return ye(ye({},s),{},{keyMetrics:ye(ye({},s.keyMetrics),{},{requestAPEnd:o.metric})});case dt.KEY_METRIC_REQUEST_SUA_END:return ye(ye({},s),{},{keyMetrics:ye(ye({},s.keyMetrics),{},{requestSUAEnd:o.metric})});case dt.KEY_METRIC_BEFORE_CONNECT:return ye(ye({},s),{},{keyMetrics:ye(ye({},s.keyMetrics),{},{beforeConnect:o.metric})});case dt.KEY_METRIC_PEER_RECEIVER:return ye(ye({},s),{},{keyMetrics:ye(ye({},s.keyMetrics),{},{peerReceiver:o.metric})});case dt.KEY_METRIC_SIGNAL_CONNECTED:return ye(ye({},s),{},{keyMetrics:ye(ye({},s.keyMetrics),{},{signalConnected:o.metric})});case dt.KEY_METRIC_JOIN_REQ:return ye(ye({},s),{},{keyMetrics:ye(ye({},s.keyMetrics),{},{joinReq:o.metric})});case dt.KEY_METRIC_JOIN_REP:return ye(ye({},s),{},{keyMetrics:ye(ye({},s.keyMetrics),{},{joinRep:o.metric})});case dt.KEY_METRIC_JOIN_GATEWAY_START:return ye(ye({},s),{},{keyMetrics:ye(ye({},s.keyMetrics),{},{joinGatewayStart:o.metric})});case dt.KEY_METRIC_JOIN_GATEWAY_END:return ye(ye({},s),{},{keyMetrics:ye(ye({},s.keyMetrics),{},{joinGatewayEnd:o.metric})});case dt.KEY_METRIC_PEER_CONNECTION_START:return ye(ye({},s),{},{keyMetrics:ye(ye({},s.keyMetrics),{},{peerConnectionStart:o.metric})});case dt.KEY_METRIC_PEER_CONNECTION_END:return ye(ye({},s),{},{keyMetrics:ye(ye({},s.keyMetrics),{},{peerConnectionEnd:o.metric})});case dt.KEY_METRIC_DESCRIPTION_START:return ye(ye({},s),{},{keyMetrics:ye(ye({},s.keyMetrics),{},{descriptionStart:o.metric})});case dt.KEY_METRIC_SIGNAL_CHANNEL_OPEN:return ye(ye({},s),{},{keyMetrics:ye(ye({},s.keyMetrics),{},{signalChannelOpen:o.metric})});case dt.KEY_METRIC_ICE_CONNECTION_END:return ye(ye({},s),{},{keyMetrics:ye(ye({},s.keyMetrics),{},{iceConnectionEnd:o.metric})});case dt.KEY_METRIC_PUBLISH:{const c=s.keyMetrics.publish,l=c.findIndex((h=>h.trackId===o.metric.trackId));return l!==-1?(c[l]=ye(ye({},c[l]),o.metric),ye(ye({},s),{},{keyMetrics:ye(ye({},s.keyMetrics),{},{publish:[...c]})})):ye(ye({},s),{},{keyMetrics:ye(ye({},s.keyMetrics),{},{publish:[...s.keyMetrics.publish,o.metric]})})}case dt.KEY_METRIC_SUBSCRIBE:{const c=s.keyMetrics.subscribe,l=c.findIndex((h=>h.userId===o.metric.userId&&h.type===o.metric.type));return l!==-1?(c[l]=ye(ye({},c[l]),o.metric),ye(ye({},s),{},{keyMetrics:ye(ye({},s.keyMetrics),{},{subscribe:[...c]})})):ye(ye({},s),{},{keyMetrics:ye(ye({},s.keyMetrics),{},{subscribe:[...s.keyMetrics.subscribe,o.metric]})})}case dt.KEY_METRIC_FIRST_VIDEO_FRAME_DECODED:{const c=s.keyMetrics.firstVideoFrameDecoded,l=c.findIndex((h=>h.userId===o.metric.userId));return l!==-1?(c[l]=ye(ye({},c[l]),o.metric),ye(ye({},s),{},{keyMetrics:ye(ye({},s.keyMetrics),{},{firstVideoFrameDecoded:[...c]})})):ye(ye({},s),{},{keyMetrics:ye(ye({},s.keyMetrics),{},{firstVideoFrameDecoded:[...s.keyMetrics.firstVideoFrameDecoded,o.metric]})})}case dt.RESET_FIRST_VIDEO_FRAME_DECODED:return s.keyMetrics.firstVideoFrameDecoded=[],s;case dt.SET_CLOUD_PROXY_SERVER_MODE:return s.cloudProxyServerMode=o.mode,s;case dt.RECORD_JOIN_CHANNEL_SERVICE:return typeof o.index!="number"?s.joinChannelServiceRecords=[...s.joinChannelServiceRecords,o.record]:(s.joinChannelServiceRecords[o.index]=ye(ye({},s.joinChannelServiceRecords[o.index]),o.record),s.joinChannelServiceRecords=[...s.joinChannelServiceRecords]),s;case dt.RESET_JOIN_CHANNEL_SERVICE_RECORDS:return s.joinChannelServiceRecords=[],s;case dt.RESET_KEY_METRICS:return s.keyMetrics={publish:[],subscribe:[],firstVideoFrameDecoded:[]},s;case dt.SET_USE_P2P:return ye(ye({},s),{},{useP2P:o.val});case dt.SET_TRANSPORT_TYPE:return ye(ye({},s),{},{p2pTransport:o.val});default:return s}})(this.state,i)}set autoSubscribe(i){this.state.autoSubscribe=i}get autoSubscribe(){return this.state.autoSubscribe}set enableInstantMuteRestore(i){this.state.enableInstantMuteRestore=i}get enableInstantMuteRestore(){return this.state.enableInstantMuteRestore}set sessionId(i){this.dispatch({type:dt.SET_SESSION_ID,sessionId:i})}get sessionId(){return this.state.sessionId}set cid(i){this.state.cid=i}get cid(){return this.state.cid}set codec(i){this.state.codec=i}get codec(){return this.state.codec}get mode(){return this.state.mode}get audioCodec(){return this.state.audioCodec}get clientId(){return this.state.clientId}set p2pId(i){this.dispatch({type:dt.SET_P2P_ID,p2pId:i})}get p2pId(){return this.state.p2pId}set dcId(i){this.dispatch({type:dt.SET_DC_ID,dcId:i})}get dcId(){return this.state.dcId}set uid(i){this.dispatch({type:dt.SET_UID,uid:i})}get uid(){return this.state.uid}set intUid(i){this.dispatch({type:dt.SET_INT_UID,intUid:i})}get intUid(){return this.state.intUid}set pubId(i){this.dispatch({type:dt.SET_PUB_ID,pubId:i})}get pubId(){return this.state.pubId}set cloudProxyServerMode(i){this.dispatch({type:dt.SET_CLOUD_PROXY_SERVER_MODE,mode:i})}get cloudProxyServerMode(){return this.state.cloudProxyServerMode}set useP2P(i){this.dispatch({type:dt.SET_USE_P2P,val:i})}get useP2P(){return this.state.useP2P}set p2pTransport(i){this.dispatch({type:dt.SET_TRANSPORT_TYPE,val:i})}get p2pTransport(){return this.state.p2pTransport}set hasStartJoinChannel(i){this.state.hasStartJoinChannel=i}get hasStartJoinChannel(){return this.state.hasStartJoinChannel}set isABTestSuccess(i){this.state.isABTestSuccess=i}get isABTestSuccess(){return this.state.isABTestSuccess}clientCreated(){this.dispatch({type:dt.KEY_METRIC_CLIENT_CREATED,metric:Date.now()})}joinStart(){this.dispatch({type:dt.KEY_METRIC_JOIN_START,metric:Date.now()})}preloadStart(){this.dispatch({type:dt.KEY_METRIC_PRELOAD_START,metric:Date.now()})}preloadEnd(){this.dispatch({type:dt.KEY_METRIC_PRELOAD_END,metric:Date.now()})}joinEnd(){this.dispatch({type:dt.KEY_METRIC_JOIN_END,metric:Date.now()})}requestAPStart(){this.dispatch({type:dt.KEY_METRIC_REQUEST_AP_START,metric:Date.now()})}requestAPEnd(){this.dispatch({type:dt.KEY_METRIC_REQUEST_AP_END,metric:Date.now()})}requestSUAEnd(){this.dispatch({type:dt.KEY_METRIC_REQUEST_SUA_END,metric:Date.now()})}beforeConnect(){this.dispatch({type:dt.KEY_METRIC_BEFORE_CONNECT,metric:Date.now()})}peerReceiver(){this.dispatch({type:dt.KEY_METRIC_PEER_RECEIVER,metric:Date.now()})}signalConnected(){this.dispatch({type:dt.KEY_METRIC_SIGNAL_CONNECTED,metric:Date.now()})}joinReq(){this.dispatch({type:dt.KEY_METRIC_JOIN_REQ,metric:Date.now()})}joinRep(){this.dispatch({type:dt.KEY_METRIC_JOIN_REP,metric:Date.now()})}joinGatewayStart(){this.dispatch({type:dt.KEY_METRIC_JOIN_GATEWAY_START,metric:Date.now()})}joinGatewayEnd(){this.dispatch({type:dt.KEY_METRIC_JOIN_GATEWAY_END,metric:Date.now()})}peerConnectionStart(){this.dispatch({type:dt.KEY_METRIC_PEER_CONNECTION_START,metric:Date.now()})}peerConnectionEnd(){this.dispatch({type:dt.KEY_METRIC_PEER_CONNECTION_END,metric:Date.now()})}firstVideoFrameDecoded(i,s){this.dispatch({type:dt.KEY_METRIC_FIRST_VIDEO_FRAME_DECODED,metric:ye({userId:i},s)})}descriptionStart(){this.dispatch({type:dt.KEY_METRIC_DESCRIPTION_START,metric:Date.now()})}signalChannelOpen(){this.dispatch({type:dt.KEY_METRIC_SIGNAL_CHANNEL_OPEN,metric:Date.now()})}iceConnectionEnd(){this.dispatch({type:dt.KEY_METRIC_ICE_CONNECTION_END,metric:Date.now()})}publish(i,s,o,c){this.dispatch({type:dt.KEY_METRIC_PUBLISH,metric:ye(ye({trackId:i,type:s},o&&{publishStart:o}),c&&{publishEnd:c})})}subscribe(i,s,o,c,l,h,p){this.dispatch({type:dt.KEY_METRIC_SUBSCRIBE,metric:ye(ye(ye(ye(ye({userId:i,type:s},o&&{subscribeStart:o}),c&&{subscribeEnd:c}),l&&{firstFrame:l}),h&&{streamAdded:h}),p&&{firstDecoded:p})})}massSubscribe(i,s,o,c){i.forEach((l=>{this.dispatch({type:dt.KEY_METRIC_SUBSCRIBE,metric:ye(ye(ye({userId:l.userId,type:l.type},s&&{subscribeStart:s}),o&&{subscribeEnd:o}),c&&{firstFrame:c})})}))}get keyMetrics(){return this.state.keyMetrics}recordJoinChannelService(i,s){i.service==="gateway"&&Array.isArray(i.urls)&&(i.urls=i.urls.map((o=>o.replace(/(\d+)-\d+-\d+-(\d+)/,"$1-*-*-$2"))));try{return typeof s!="number"?(this.dispatch({type:dt.RECORD_JOIN_CHANNEL_SERVICE,record:ye(ye({},i),{},{sessionId:this.sessionId,cloudProxyMode:this.cloudProxyServerMode,uid:this.uid})}),this.state.joinChannelServiceRecords.length-1):(s<0||s>=this.state.joinChannelServiceRecords.length||this.dispatch({type:dt.RECORD_JOIN_CHANNEL_SERVICE,record:i,index:s}),s)}catch{return 0}}resetJoinChannelServiceRecords(){this.dispatch({type:dt.RESET_JOIN_CHANNEL_SERVICE_RECORDS})}resetKeyMetrics(){this.dispatch({type:dt.RESET_KEY_METRICS})}resetFirstVideoFrameDecoded(){this.dispatch({type:dt.RESET_FIRST_VIDEO_FRAME_DECODED})}get joinChannelServiceRecords(){try{return this.state.joinChannelServiceRecords}catch{return[]}}}(e.codec,e.audioCodec,e.mode,this._clientId),this._leaveMutex=new Yr("client-leave",this._clientId),this._publishMutex=new Yr("client-publish",this._clientId),this._renewTokenMutex=new Yr("client-renewtoken",this._clientId),this._subscribeMutex=new Yr("client-subscribe",this._clientId),this.store.clientCreated(),e.proxyServer&&this.setProxyServer(e.proxyServer,!0),e.turnServer&&this.setTurnServer(e.turnServer,!0),R.info("[".concat(this._clientId,"] Initializing AgoraRTC client v").concat(to," build: ").concat(cb,", mode: ").concat(this.mode,", codec: ").concat(this.codec)),e.clientRoleOptions)try{X0(e.clientRoleOptions),n=Object.assign({},e.clientRoleOptions)}catch(i){R.warning("[".concat(this._clientId,"] ").concat(i.toString()))}var r;this._statsCollector=new rg(this.store),this._statsCollector.onStatsException=(i,s,o)=>{R.warn("[".concat(this._clientId,"] receive exception msg, code: ").concat(i,", msg: ").concat(s,", uid: ").concat(o)),i===aI.VIDEO_ENCODE_FAILED&&this.localTracks.forEach((c=>{c instanceof WS&&F("ENABLE_ENCODE_EXCEPTION")&&c.findClosestProfile()})),this.safeEmit(Nt.EXCEPTION,{code:i,msg:s,uid:o})},this._statsCollector.onUploadPublishDuration=(i,s,o,c)=>{const l=this._users.find((h=>h.uid===i));l&&(this.store.keyMetrics&&(this.store.firstVideoFrameDecoded(l._uintid,{peerPublishDuration:o,peerPubStatusMs:Date.now()}),this._p2pChannel.reportVideoFirstFrameRender(l)),We.peerPublishStatus(this._sessionId,{subscribeElapse:c,audioPublishDuration:s,videoPublishDuration:o,peer:l._uintid}))},this._statsCollector.onVideoCodecChanged=i=>{if(F("VIDEO_STANDARD_BITRATE_VERSION")&&(i==="av1"||i==="h265"||i==="h264")){const s=this.localTracks.find((o=>o instanceof vn));s&&s._saveEncodeBitrateRatio!==1&&s.setSaveEncodeBitrateRatio(i==="h264"?F("BASELINE_MORE_H264_BITRATE_RATIO"):void 0)}},this.store.useP2P=e.mode==="p2p",this._gateway=new E9(this.store,{clientId:this._clientId,mode:this.mode,codec:this.codec,websocketRetryConfig:e.websocketRetryConfig||rr,httpRetryConfig:e.httpRetryConfig||rr,forceWaitGatewayResponse:e.forceWaitGatewayResponse===void 0||e.forceWaitGatewayResponse,statsCollector:this._statsCollector,role:e.role,clientRoleOptions:n}),this._configDistribute=new A9(this._clientId,this.store),this.store.useP2P?(this._p2pChannel=(r={store:this.store,statsCollector:this._statsCollector},yl("P2PChannel").create(r)),this._handleP2PEvents()):this._p2pChannel=new sg(this.store,this._statsCollector),this._handleP2PChannelEvents(),this._handleGatewayEvents(),this._handleGatewaySignalEvents()}async joinMeta(e,t,n,r,i){let s=!(arguments.length>5&&arguments[5]!==void 0)||arguments[5],o=arguments.length>6&&arguments[6]!==void 0&&arguments[6];nn("JOIN_GATEWAY_USE_443PORT_ONLY",s),nn("JOIN_GATEWAY_USE_DUAL_DOMAIN",o);const c=this._gateway.signal.websocket;return c instanceof zb&&(c.use443PortOnly=s,c.tryDoubleDomain=o),(async function(l,h,p){RS.get(l)||RS.set(l,[]),CS.get(l)||CS.set(l,h),yc.get(l)||yc.set(l,0);const E=RS.get(l),g=CS.get(l);if(!E||!g)throw new Error("concurrent: deferQueue or maxConcurrency is null");if(yc.get(l)===g){const M=kE();E.push(M),await M.promise}yc.set(l,yc.get(l)+1);for(var v=arguments.length,O=new Array(v>3?v-3:0),I=3;I<v;I++)O[I-3]=arguments[I];const N=await p(...O);return yc.set(l,yc.get(l)-1),yc.get(l)===g-1&&E.length>0&&(E[0].resolve(),E.shift()),yc.get(l)===0&&(RS.set(l,[]),CS.set(l,0),yc.set(l,0)),N})("client.join",F("JOIN_MAX_CONCURRENCY"),this.join.bind(this),e,t,n,r,i)}async join(e,t,n,r,i){const s=++this._numberOfJoinCount;this.store.joinStart(),r&&(this.store.uid=r);const o=(PS||PS||(PS=(window.location.protocol.split(":")[0]||"").toUpperCase(),PS))==="HTTPS",c=J1()?window.isSecureContext:"Browser Not Support";(!J1()&&!o||!window.isSecureContext)&&R.warning("The website must be running in a secure context (About secure context: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts ), otherwise the media collection will be restricted by the browser");let l;We.setAppId(e);try{if(!n&&n!==null)throw new se(U.INVALID_PARAMS,"Invalid token: ".concat(n,". If you don not use token, set it to null"));if(n&&Pr(n,"token",1,2047),Pr(e,"appid",1,2047),$S(t),r&&eT(r),i)if(typeof i=="string")Pr(i,"optionalInfo",1,256),l=i;else{if(typeof i!="object")throw new se(U.INVALID_PARAMS,"Invalid options: options is not a string or object");{const{autoSubscribe:N,enableInstantMuteRestore:M}=i;N&&(Sa(N,"autoSubscribe"),R.info("[".concat(this._clientId,"] join: autoSubscribe: ").concat(N)),this.store.autoSubscribe=N),M&&(Sa(M,"enableInstantMuteRestore"),R.info("[".concat(this._clientId,"] join: enableInstantMuteRestore: ").concat(M)),this.store.enableInstantMuteRestore=M)}}}catch(N){throw We.reportApiInvoke(_h(),{name:Bn.JOIN,options:[e,t,n,r],states:{isHttps:o,isSecureContext:c},tag:In.TRACER}).onError(N),N}if(this._leaveMutex.isLocked&&(R.debug("[".concat(this._clientId,"] join: waiting leave operation")),(await this._leaveMutex.lock())(),R.debug("[".concat(this._clientId,"] join: continue"))),this._joinAndNotLeaveYet=!0,this.connectionState!=="DISCONNECTED"){const N=new se(U.INVALID_OPERATION,"[".concat(this._clientId,"] Client already in connecting/connected state"));throw We.reportApiInvoke(_h(),{name:Bn.JOIN,options:[e,t,n,r],states:{isHttps:o,isSecureContext:c},tag:In.TRACER}).onError(N),N}this._gateway.state="CONNECTING",this.store.preloadStart();const h=await X2({appId:e,cname:t,uid:r,stringUid:typeof r=="string"?r:void 0,token:n||e,cloudProxyServer:this._cloudProxyServerMode});if(this.store.preloadEnd(),!this._joinAndNotLeaveYet)throw new se(U.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));const p=h?.sid||_h();R.info("[".concat(this._clientId,"] start join channel ").concat(t,", join number: ").concat(s)),this._sessionId||(this._sessionId=p,this.store.sessionId=this._sessionId);const E=We.reportApiInvoke(p,{id:this._clientId,name:Bn.JOIN,options:[e,t,n,r],states:{isHttps:o,isSecureContext:c},tag:In.TRACER}),g=Yo(Yo(Yo({},this._rtmConfig),{},{role:this.role,clientId:this._clientId,appId:e,sid:this._sessionId,cname:t,uid:typeof r!="string"?r:null,turnServer:this._turnServer,proxyServer:this._proxyServer,token:n||e,cloudProxyServer:this._cloudProxyServerMode,optionalInfo:l,license:this._license,useLocalAccessPoint:this._useLocalAccessPoint,preload:!!h},this._remoteDefaultVideoStreamType!==void 0&&{defaultVideoStream:this._remoteDefaultVideoStreamType}),{},{apRequestDetail:F("AP_REQUEST_DETAIL")||void 0});if(this._useLocalAccessPoint&&(g.setLocalAPVersion=this._setLocalAPVersion),typeof r=="string"&&(g.stringUid=r,this._uintUid?(g.uid=this._uintUid,this._uintUid=void 0):g.uid=0),this._encryptionMode!=="none"&&this._encryptionSecret){if(g.aesmode=this._encryptionMode,g.aespassword=await(async N=>{const M=(function(Q){const z=window.atob(`MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDCMnXAHkKIGAM+x4N22gCI+Wyu
STM9ztkT3uYslTT2PuKmZfPzhH6kVdO7PTjGCOZnAsyb3oTtWat0KcxQ4jxvqQV+
HvYl3iI1Yd4vl2c3qRMJPLtRDfNxa2Mcxgq7e9aEUibzdd0st+OJAy3tOj/Y0aVy
xQiYDz3vqa6bP29adwIDAQAB`),te=new Uint8Array(new ArrayBuffer(z.length));for(let de=0;de<z.length;de+=1)te[de]=z.charCodeAt(de);return te})(),x=await window.crypto.subtle.importKey("spki",M,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]),B=Y0(N),Z=await window.crypto.subtle.encrypt({name:"RSA-OAEP"},x,B);return(function(Q){let z="";for(let te=0;te<Q.length;te+=1)z+=String.fromCharCode(Q[te]);return window.btoa(z)})(new Uint8Array(Z))})(this._encryptionSecret),!this._joinAndNotLeaveYet)throw new se(U.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));this._encryptionSalt&&(g.aessalt=this._encryptionSalt)}if(this._encryptDataStream&&(this._encryptionMode==="aes-128-gcm2"||this._encryptionMode==="aes-256-gcm2"))if(this._encryptionSalt&&this._encryptionSecret)if(window.crypto.subtle){const N=new TextEncoder,M=F("USE_PURE_ENCRYPTION_MASTER_KEY")?N.encode(g.appId+this._encryptionSecret+this._encryptionSecret):N.encode(g.appId+g.cname+this._encryptionSecret);this._encryptDataStreamIv=await(async function(x,B,Z){const Q=await window.crypto.subtle.importKey("raw",B,"PBKDF2",!1,["deriveBits","deriveKey"]),z=x==="aes-128-gcm2"?128:256,te=await window.crypto.subtle.deriveBits({name:"PBKDF2",iterations:oL,hash:"SHA-256",salt:Z},Q,z+Yz);return new Uint8Array(te).subarray(z/8)})(this._encryptionMode,M,mh(this._encryptionSalt)),this._encryptDataStreamKey=await(async function(x,B,Z){const Q=await window.crypto.subtle.importKey("raw",B,"PBKDF2",!1,["deriveBits","deriveKey"]),z=x==="aes-128-gcm2"?128:256;return await window.crypto.subtle.deriveKey({name:"PBKDF2",iterations:oL,hash:"SHA-256",salt:Z},Q,{name:"AES-GCM",length:z},!0,["encrypt","decrypt"])})(this._encryptionMode,M,mh(this._encryptionSalt))}else c?R.warning("[".concat(this._clientId,"] encrypt datastream must be running in a secure context, fallback to plain data stream")):R.warning("[".concat(this._clientId,"] current browser do not support WebCrypto ,fallback to plain data stream")),this._encryptDataStream=!1;else this._encryptDataStream=!1,R.debug("[".concat(this._clientId,"] no salt / secret, cannot support encrypt data stream, fallback to plain data stream"));this._startSession(this._sessionId,{channel:t,appId:e,stringUid:g.stringUid});const v=this._sessionId;setTimeout((()=>{this.connectionState==="CONNECTING"&&v===this._sessionId&&We.joinChannelTimeout(this._sessionId,5)}),5e3);try{var O;let N;const M=g.cloudProxyServer;if(Re(O=["proxy3","proxy4","proxy5"]).call(O,M)){const z=F("PROXY_SERVER_TYPE3");Array.isArray(z)?g.proxyServer=z[0]:g.proxyServer=z}if(We.setProxyServer(g.proxyServer),R.setProxyServer(g.proxyServer),this.store.requestAPStart(),h){if(R.debug("[".concat(this._clientId,"] get serverInfo Success from Preload Cache ").concat(g.stringUid?", ".concat(g.stringUid," => ").concat(h.intUid):""," ")),g.stringUid&&!g.uid&&(g.uid=h.intUid),N={gatewayInfo:h.ap.gatewayInfo},F("JOIN_WITH_FALLBACK_MEDIA_PROXY")&&g.turnServer.mode==="auto")if(h.ap.proxyInfo.addresses.length===0)R.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers");else{const z=(await KM(h.ap.proxyInfo,h.ap.gatewayInfo.uid)).map((te=>({turnServerURL:te.address,tcpport:te.tcpport||Br.tcpport,udpport:te.udpport||Br.udpport,username:te.username||Br.username,password:te.password||Br.password,forceturn:!1,security:!0})));g.turnServer={mode:"manual",servers:z}}Z2(h,g.stringUid)}else{if(g.stringUid&&!g.uid){let z;[z,N]=await Pe.all([v2(g.stringUid,g,this._axiosCancelSource.token,this._config.httpRetryConfig||rr,this.store).finally((()=>{this.store.requestSUAEnd()})),g2(g,this._axiosCancelSource.token,this._config.httpRetryConfig||rr,!0,this.store).finally((()=>{this.store.requestAPEnd()}))]),R.debug("[".concat(this._clientId,"] getUserAccount Success ").concat(g.stringUid," => ").concat(z)),g.uid=z,N.gatewayInfo.uid=z,N.gatewayInfo.res.uid=z}else N=await g2(g,this._axiosCancelSource.token,this._config.httpRetryConfig||rr,!0,this.store);if(!this._joinAndNotLeaveYet)throw new se(U.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"))}this.store.requestAPEnd(),setTimeout((()=>{this._configDistribute.startGetConfigDistribute(g,this._axiosCancelSource.token),this._configDistribute.on(qE.UPDATE_BITRATE_LIMIT,(z=>{this._p2pChannel.updateBitrateLimit(z)})),this._configDistribute.on(qE.UPDATE_CLIENT_ROLE_OPTIONS,(z=>{this._setClientRoleOptions(z)}))}),0),this._key=n||e;const x=N.gatewayInfo,B=g.uid?g.uid:x.uid;this._joinInfo=Yo(Yo({},g),{},{cid:x.cid,uid:B,vid:x.vid,apResponse:x.res,apGatewayAddress:x.apGatewayAddress,uni_lbs_ip:x.uni_lbs_ip,gatewayAddrs:x.gatewayAddrs}),this.store.intUid=B,this.store.cid=x.cid;const Z=await this._joinGateway();if(!this._joinAndNotLeaveYet)throw new se(U.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));E.onSuccess(Z),this._appId=e,this._channelName=g.cname,this._uid=Z,this.store.uid=Z,setTimeout((()=>{this._networkQualityInterval&&window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=window.setInterval(this._handleUpdateNetworkQuality,2e3),window.addEventListener(Vr()?"beforeunload":"pagehide",this._handleBeforeUnload),this._statsCollector.startUpdateStats()}),0);const Q=g.stringUid?"string uid: ".concat(g.stringUid,",uid: ").concat(g.uid):"uid: ".concat(this._uid);return R.info("[".concat(this._clientId,"] Joining channel success: channel: ").concat(t,",").concat(Q)),setTimeout((()=>{R.startUpload()}),5e3),this.store.joinEnd(),I=this,Re(Rh).call(Rh,I)||Rh.push(I),this._cloudProxyServerMode==="disabled"&&Ft().supportWebCrypto&&F("ENABLE_PRELOAD")&&SI(this._joinInfo),Z}catch(N){const M=Array.isArray(N)?N[0]:N;throw M&&M.code===U.OPERATION_ABORTED?R.warning("[".concat(this._clientId,"] join number: ").concat(s,", Joining channel failed, rollback"),M):R.error("[".concat(this._clientId,"] join number: ").concat(s,", Joining channel failed, rollback"),M),M.code!==U.OPERATION_ABORTED&&this._numberOfJoinCount===s&&(this._gateway.state="DISCONNECTED",this._reset()),E.onError(M),M}var I}_joinGateway(){if(!this._joinInfo||!this._key)throw new se(U.INVALID_OPERATION);return this._gateway.join(this._joinInfo,this._key,!(this._joinInfo.cloudProxyServer!=="disabled"||this._joinInfo.proxyServer||!F("JOIN_WITH_FALLBACK_SIGNAL_PROXY")))}async leave(){R.info("[".concat(this._clientId,"] Leaving channel")),window.removeEventListener(Vr()?"beforeunload":"pagehide",this._handleBeforeUnload),this._reset(),(function(t){const n=Rh.indexOf(t);n!==-1&&Rh.splice(n,1)})(this),this._statsCollector.stopUpdateStats();const e=await this._leaveMutex.lock();if(this.connectionState==="DISCONNECTED")return R.info("[".concat(this._clientId,"] Leaving channel repeated, success")),void e();await this._gateway.leave(this.connectionState!=="CONNECTED",Qt.LEAVE),R.info("[".concat(this._clientId,"] Leaving channel success")),this._joinAndNotLeaveYet=!1,this.store.resetJoinChannelServiceRecords(),e()}async publish(e){let t=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!Array.isArray(e)){if(!(e instanceof kf))return this._publishDataChannel(e);e=[e]}if(e.length===0)throw new se(U.INVALID_PARAMS,"param list is empty");const n=e;if(this._gateway.role==="audience")throw new se(U.INVALID_OPERATION,"audience can not publish stream");for(const i of n){if(!(i instanceof kf))throw new se(U.INVALID_PARAMS,"parameter is not local track");if(!i._enabled&&t)throw new se(U.TRACK_IS_DISABLED,"can not publish a disabled track: ".concat(i.getTrackId()))}R.info("[".concat(this._clientId,"] Publishing tracks, id ").concat(n.map((i=>"".concat(i.getTrackId()," ")))));const r=await this._publishMutex.lock();await this._configDistribute.awaitConfigDistributeComplete(),t&&n.forEach((i=>{const s=this._configDistribute.getBitrateLimit();i instanceof vn&&s&&i.setBitrateLimit(s.uplink)}));try{await this._publishHighStream(n),R.info("[".concat(this._clientId,"] Publish success, id ").concat(n.map((i=>"".concat(i.getTrackId()," ")))))}catch(i){throw R.error("[".concat(this._clientId,"] publish error"),i.toString()),i}finally{r()}}async _publishDataChannel(e){if(e==null)throw new se(U.INVALID_PARAMS,"parameter is not local track or datachannel config, config is ".concat(JSON.stringify(e)));on(e.id,"id",0,65535,!0),Sa(e.ordered,"ordered"),Pr(e.metadata,"metadata",0,512),R.info("[".concat(this._clientId,"] Publishing datachannels, id ").concat(e.id));const t=await this._publishMutex.lock();try{if(this._p2pChannel.getAllDataChannels().findIndex((i=>i.id===e.id))!==-1)throw new se(U.INVALID_PARAMS,"Invalid id: ".concat(e.id,". If you want to republish the datachannel, unpublish first"));if(!this._joinInfo||this._uid===void 0)throw new se(U.INVALID_OPERATION,"Can't publish datachannel, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new se(U.INVALID_OPERATION,"can not publish datachannel in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&F("FORCE_TURN")&&!F("TURN_ENABLE_TCP")&&!F("TURN_ENABLE_UDP"))throw new se(U.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");const n=(function(i){return l2(i,!1)})(e),r=await this._p2pChannel.publishDataChannel([n]);if(r.length>0){if(typeof n._originDataChannelId!="number")throw R.error("[".concat(this._clientId,"] can not publish with mediaType datachannel, cannot get RTCDatachannel id")),new se(U.CREATE_DATACHANNEL_ERROR);try{await Pe.all(r.map((i=>this._uid&&this._gateway.publishDataChannel(this._uid,i,!0)))),await n._waitTillOpen()}catch(i){if(i.code!==U.DISCONNECT_P2P)throw i}}return R.info("[".concat(this._clientId,"] Publish dataChannels success, id ").concat(n.id)),n}catch(n){throw R.error("[".concat(this._clientId,"] publish datachannels error"),n.toString()),n}finally{t()}}async unpublish(e){if(!this._joinInfo||this._uid===void 0)throw new se(U.INVALID_OPERATION,"Can't unpublish stream, haven't joined yet!");let t=[];if(e)if(Array.isArray(e))t=e;else{if(!(e instanceof kf))return this._unpublishDataChannel([e]);t=[e]}else this.store.useP2P||await this._unpublishDataChannel(),t=this._p2pChannel.getAllTracks(!0);R.info("[".concat(this._clientId,"] Unpublish tracks, tracks ").concat(t.map((r=>"".concat(r.getTrackId()," ")))," "));const n=await this._publishMutex.lock();try{if(this.store.useP2P){const r=await this._p2pChannel.unpublish(t);r&&await this._gateway.sendExtensionMessage(Hn.UNPUBLISH,{unpubMsg:r},!0)}else{const r=await this._p2pChannel.unpublish(t);r&&await this._gateway.unpublish(r,this._uid),R.info("[".concat(this._clientId,"] Unpublish success,tracks ").concat(t.map((i=>"".concat(i.getTrackId())))))}}catch(r){throw R.error("[".concat(this._clientId,"] unpublish error"),r.toString()),r}finally{n&&n()}}async _unpublishDataChannel(e){e!==void 0&&e.length!==0||(e=this._p2pChannel.getAllDataChannels()),R.info("[".concat(this._clientId,"] Unpublish datachannels, datachannels ").concat(e.map((n=>"".concat(n.id," ")))," "));const t=await this._publishMutex.lock();try{const n=await this._p2pChannel.unpublishDataChannel(e);n&&await this._gateway.unpublishDataChannel(n),R.info("[".concat(this._clientId,"] Unpublish dataChannel success,dataChannel ").concat(e.map((r=>"".concat(r.id)))))}catch(n){throw R.error("[".concat(this._clientId,"] unpublish dataChannel error"),n.toString()),n}finally{t&&t()}}async subscribe(e,t,n){if(!(e instanceof Ud)){const r=this.remoteUsers.find((i=>i.uid===e));if(!r)throw new se(U.INVALID_REMOTE_USER,"user is not in the channel");e=r}return t==="datachannel"?this._subscribeDataChannel(e,n):this._subscribe(e,t)}async presubscribe(e,t){if(hr(t,"mediaType",["audio","video"]),this.store.useP2P)throw new se(U.INVALID_OPERATION,"can't presub at p2p mode");if(!this._joinInfo)throw new se(U.INVALID_OPERATION,"can't presub when not join");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new se(U.INVALID_OPERATION,"can't presub in ".concat(this.connectionState," state"));const n=t===Le.AUDIO,r=t===Le.VIDEO,i=await this._subscribeMutex.lock();try{const{ssrcId:s,ortc:o,rtxSsrcId:c,cname:l,uint_id:h}=await this._gateway.presubscribe(e,t,!0);if(s==null)throw new se(U.UNEXPECTED_RESPONSE,"no ssrc id");let p=this._users.find((g=>g.uid===e));p||(p=new Ud(e,h||e),p._is_pre_created=!0,this._users.push(p)),l&&(p._cname=l),p._uintid||(p._uintid=h||e),n&&(p._audioSSRC=s,p._audio_pre_subscribed=!0,o&&(p._audioOrtc=o)),r&&(p._videoSSRC=s,p._video_pre_subscribed=!0,o&&(p._videoOrtc=o),c!=null&&(p._rtxSsrcId=c)),R.info("[".concat(this._clientId,"] presub succeed ssrc: ").concat(s)),await this._p2pChannel.subscribe(p,t,s,c,o);const E=n?p._audioTrack:p._videoTrack;if(!E)throw new se(U.UNEXPECTED_ERROR,"can not find remote track in user");return n&&(p._trust_audio_stream_added_state_=!0,p._audio_added_=!0),r&&(p._trust_video_stream_added_state_=!0,p._video_added_=!0),E}catch(s){throw R.error("[".concat(this._clientId,"] presub user ").concat(e," error"),s),s}finally{i()}}async _subscribeDataChannel(e,t){var n;if(on(t,"channelId",0,65535,!0),!this._joinInfo)throw new se(U.INVALID_OPERATION,"Can't subscribe datachannel, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new se(U.INVALID_OPERATION,"Can't subscribe datachannel in ".concat(this.connectionState," state"));if(!this._users.find((c=>c===e)))throw R.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),new se(U.INVALID_REMOTE_USER,"user is not in the channel");if(!e.hasAudio&&!e.hasVideo&&e._dataChannels.length===0)throw R.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),new se(U.INVALID_REMOTE_USER,"user is not published");const i=(n=e._dataChannels)===null||n===void 0?void 0:n.find((c=>c.id===t));if(!i)throw R.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType datachannel, remote datachannel is not published")),new se(U.REMOTE_USER_IS_NOT_PUBLISHED);const s=await this._subscribeMutex.lock();R.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: datachannel"));try{const c=await this._p2pChannel.subscribeDataChannel(e,[i]);if(c&&Re(c).call(c,i.id))try{var o;if(typeof i._originDataChannelId!="number")throw R.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType datachannel, cannot get RTCDatachannel")),new se(U.CREATE_DATACHANNEL_ERROR);const l={id:i.id,datachannelId:i._originDataChannelId,ordered:i.ordered,maxRetransmits:i.maxRetransmits,metadata:(o=i.metadata)!==null&&o!==void 0?o:""};await this._gateway.subscribeDataChannel(e.uid,l,!0),await i._waitTillOpen()}catch(l){if(l?.code!==U.WS_ABORT)throw await this._p2pChannel.unsubscribeDataChannel(e,[i]),l;await this._p2pChannel.unsubscribeDataChannel(e,[i]),this._p2pChannel.setPendingRemoteDataChannel(e,i.id)}return R.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: datachannel")),i}finally{s()}}async _p2pSubscribe(e,t,n){if(hr(t,"mediaType",["audio","video"]),!this._joinInfo)throw new se(U.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new se(U.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find((s=>s===e))){const s=new se(U.INVALID_REMOTE_USER,"user is not in the channel");throw R.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),s}if(!e.hasAudio&&!e.hasVideo){const s=new se(U.INVALID_REMOTE_USER,"user is not published");throw R.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),s}if(!n&&(t==="audio"&&!e.hasAudio||t==="video"&&!e.hasVideo)){const s=new se(U.REMOTE_USER_IS_NOT_PUBLISHED);throw R.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType ").concat(t,", remote track is not published")),s}const i=await this._subscribeMutex.lock();R.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: ").concat(t));try{if(await this._p2pChannel.hasRemoteMediaWithLock(e,t))await this._p2pChannel.unmuteRemote(e,t);else try{const o=t==="audio"?e._audioSSRC:e._videoSSRC,c=t==="audio"?e._audioMid:e._videoMid;this.store.subscribe(e.uid,t,Date.now()),this.store.useP2P&&await this._p2pChannel.subscribe(e,t,o,c)}catch(o){throw o}R.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: ").concat(t)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(e.uid,this._defaultStreamFallbackType).catch((o=>{R.warning("[".concat(this._clientId,"] auto set fallback failed"),o)}));const s=t==="audio"?e._audioTrack:e._videoTrack;if(!s)throw new se(U.UNEXPECTED_ERROR,"can not find remote track in user object");return s}catch(s){throw R.error("[".concat(this._clientId,"] subscribe user ").concat(e.uid," error"),s),s}finally{i()}}async _subscribe(e,t,n){if(this.store.useP2P)return this._p2pSubscribe(e,t);if(hr(t,"mediaType",["audio","video"]),!this._joinInfo)throw new se(U.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new se(U.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find((h=>h===e))){const h=new se(U.INVALID_REMOTE_USER,"user is not in the channel");throw R.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),h}if(!e.hasAudio&&!e.hasVideo){const h=new se(U.INVALID_REMOTE_USER,"user is not published");throw R.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),h}if(!(n||(t!=="audio"||e.hasAudio&&e._audioSSRC!==void 0)&&(t!=="video"||e.hasVideo&&e._videoSSRC!==void 0))){const h=new se(U.REMOTE_USER_IS_NOT_PUBLISHED);throw R.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType ").concat(t,", remote track is not published")),h}let i=t==="audio"?e._audioSSRC:e._videoSSRC,s=t==="audio"?e._audioOrtc:e._videoOrtc,o=t==="video"?e._rtxSsrcId:void 0,c={stream_type:t==="audio"?Le.AUDIO:Le.VIDEO,ssrcId:i};t==="video"&&this.store.firstVideoFrameDecoded(e.uid,{subscribeStart:Date.now()});const l=await this._subscribeMutex.lock();R.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: ").concat(t));try{if(await this._p2pChannel.hasRemoteMediaWithLock(e,t))await this._p2pChannel.unmuteRemote(e,t);else try{const p=t==="audio"?e._audioSSRC:e._videoSSRC;p!==void 0&&p!==i&&(i=p,s=t==="audio"?e._audioOrtc:e._videoOrtc,o=t==="video"?e._rtxSsrcId:void 0,c={stream_type:t==="audio"?Le.AUDIO:Le.VIDEO,ssrcId:i}),Qr.markSubscribeStart(this.store.clientId,i),this.store.subscribe(e.uid,t,Date.now()),await this._p2pChannel.subscribe(e,t,i,o,s);try{this._p2pChannel.isPreSubScribe(i)||await this._gateway.subscribe(e.uid,c,!0)}catch(E){if(E?.code!==U.WS_ABORT)throw await this._p2pChannel.unsubscribe(e,t),E;await this._p2pChannel.unsubscribe(e,t,!0),this._p2pChannel.setPendingRemoteMedia(e,t)}this.store.subscribe(e.uid,t,void 0,Date.now()),this._p2pChannel.reportSubscribeEvent(!0,null,e,t)}catch(p){throw this._p2pChannel.reportSubscribeEvent(!1,p?.code,e,t),p}R.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: ").concat(t)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(e.uid,this._defaultStreamFallbackType).catch((p=>{R.warning("[".concat(this._clientId,"] auto set fallback failed"),p)}));const h=t==="audio"?e._audioTrack:e._videoTrack;if(!h)throw new se(U.UNEXPECTED_ERROR,"can not find remote track in user object");return t==="video"&&(this.store.firstVideoFrameDecoded(e.uid,{subscribeEnd:Date.now()}),this._p2pChannel.reportVideoFirstFrameRender(e)),h}catch(h){throw R.error("[".concat(this._clientId,"] subscribe user ").concat(e.uid," error"),h),h}finally{l()}}async massSubscribe(e){if(_l(e,"subscribeList"),!this._joinInfo)throw new se(U.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new se(U.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));const t=Date.now(),n=new Map,r=await this._subscribeMutex.lock();R.info("[".concat(this._clientId,"]start massSubscribe user ").concat(e.map((c=>{let{user:l,mediaType:h}=c;return"user: ".concat(l?.uid,", mediaType: ").concat(h)})).join("; ")));const i=(e=[...e]).map((c=>{let{user:l,mediaType:h}=c;return{user:l,mediaType:h}})),s=await this._p2pChannel.globalLock();try{var o;for(let l=e.length-1;l>=0;l--){const h=e[l],{user:p,mediaType:E}=h;if(hr(E,"mediaType",["audio","video"]),!p){const I=new se(U.INVALID_PARAMS,"user property does not exist in subscribeList item");throw R.error("[".concat(this._clientId,"] user property does not exist in subscribeList item")),I}if(!this._users.find((I=>I===p))){const I=new se(U.INVALID_REMOTE_USER,"user is not in the channel");R.error("[".concat(this._clientId,"] can not massSubscribe ").concat(p.uid,", this user is not in the channel")),i[l].error=I,e.splice(l,1);continue}if(E==="audio"&&(!p.hasAudio||p._audioSSRC===void 0)||E==="video"&&(!p.hasVideo||p._videoSSRC===void 0)){const I=new se(U.REMOTE_USER_IS_NOT_PUBLISHED);R.error("[".concat(this._clientId,"] can not subscribe ").concat(p.uid," with mediaType ").concat(E,", remote user is not published")),i[l].error=I,e.splice(l,1);continue}const v=gr.Video|gr.LwoVideo,O=n.get(p);if(O){if(E==="video"?O&v:O&gr.Audio){e.splice(l,1),R.warning("[".concat(this._clientId,"] repeat massSubscribe user:").concat(p.uid,", mediaType:").concat(E," twice"));continue}n.set(p,O|(E==="video"?v:gr.Audio))}else n.set(p,E==="video"?v:gr.Audio)}for(let l=e.length-1;l>=0;l--){const h=e[l],{user:p,mediaType:E}=h,g=gr.Video|gr.LwoVideo;if(this._p2pChannel.hasRemoteMedia(p,E)){await this._p2pChannel.unmuteRemoteNoLock(p,E);const v=n.get(p);n.set(p,E==="video"?v^g:v^gr.Audio),e.splice(l,1)}}this.store.massSubscribe(e.map((l=>({userId:l.user.uid,type:l.mediaType}))),t);let c=zi(o=Array.from(n.entries())).call(o,((l,h)=>{let[p,E]=h;if(E===0)return l;const g={stream_id:p.uid,stream_type:E};return E&gr.Audio&&(g.audio_ssrc=p._audioSSRC),E&gr.Video&&(g.video_ssrc=p._videoSSRC),l.push(g),l}),[]);try{e.length>0&&await this._p2pChannel.massSubscribeNoLock(e.map((h=>{let{user:p,mediaType:E}=h;return{user:p,mediaType:E,ssrcId:E===Le.VIDEO?p._videoSSRC:p._audioSSRC,rtxSsrcId:E===Le.VIDEO?p._rtxSsrcId:void 0}})));const l=new Map;if(c=c.filter((h=>h.video_ssrc&&!this._p2pChannel.isPreSubScribe(h.video_ssrc)||h.audio_ssrc&&!this._p2pChannel.isPreSubScribe(h.audio_ssrc)||!h.video_ssrc&&!h.audio_ssrc)),c.length>0){const h=await this._gateway.subscribeAll(c,!0);(h?.users||[]).forEach((p=>{let{stream_id:E,video_error_code:g,audio_error_code:v,error_code:O}=p;(g||v||O)&&l.set(E,{video_error_code:g,audio_error_code:v,error_code:O})}))}if(Array.from(l.entries()).length>0){const h=[];Array.from(l.entries()).forEach((p=>{let[E,g]=p;const v=this.remoteUsers.find((O=>O.uid===E));if(v){let O;g.error_code||g.video_error_code&&g.audio_error_code?O=void 0:g.video_error_code?O=Le.VIDEO:g.audio_error_code&&(O=Le.AUDIO),h.push({user:v,mediaType:O})}})),h.length>0&&await this._p2pChannel.massUnsubscribeNoLock(h)}for(const h of i){const p=l.get(h.user.uid);if(p){const E=p.error_code||h.mediaType==="audio"&&p.audio_error_code||h.mediaType==="video"&&p.video_error_code;if(E){const g=XE(E);R.error("user:".concat(h.user.uid," mediaType:").concat(h.mediaType," has massSubscribe error ").concat(g.desc)),h.error=new se(U.SUBSCRIBE_FAILED,"code ".concat(E,": ").concat(g.desc))}}h.error||(h.mediaType==="video"?h.track=h.user.videoTrack:h.track=h.user.audioTrack)}return this.store.massSubscribe(i.filter((h=>!h.error)).map((h=>({userId:h.user.uid,type:h.mediaType}))),void 0,Date.now()),i.forEach((h=>{var p;We.subscribe(this.store.sessionId,{succ:!!h.error,ec:((p=h.error)===null||p===void 0?void 0:p.code)||null,video:h.mediaType===Le.VIDEO,audio:h.mediaType===Le.AUDIO,peerid:h.user.uid,subscribeRequestid:h.mediaType===Le.VIDEO?h.user._videoSSRC:h.user._audioSSRC,p2pid:this.store.p2pId,eventElapse:Math.floor(performance.now()-t),preSsrc:this._p2pChannel.isPreSubScribe(h.user._videoSSRC)},!0)})),R.info("[".concat(this._clientId,"] massSubscribe success ").concat(e.map((h=>{let{user:p,mediaType:E}=h;return"user: ".concat(p?.uid,", mediaType: ").concat(E)})).join("; "))),i}catch(l){throw await this._p2pChannel.massUnsubscribeNoLock(e),l}}finally{s(),r()}}async unsubscribe(e,t,n){if(!(e instanceof Ud)){const s=this.remoteUsers.find((o=>o.uid===e));if(!s)throw new se(U.INVALID_REMOTE_USER,"user is not in the channel");e=s}if(t||this.store.useP2P){if(t==="datachannel")return this._unsubscribeDataChannel(e,n)}else await this._unsubscribeDataChannel(e,n);if(t&&hr(t,"mediaType",["audio","video"]),!this._joinInfo)throw new se(U.INVALID_OPERATION,"Can't unsubscribe stream, haven't joined yet!");if(!this._users.find((s=>s===e))){const s=new se(U.INVALID_REMOTE_USER,"user is not in the channel");throw R.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid,", user is not in the channel")),s}R.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(e.uid,", mediaType: ").concat(t));const i=await this._subscribeMutex.lock();try{if(this.store.useP2P)await this._p2pChannel.unsubscribe(e,t);else{const s=await this._p2pChannel.unsubscribe(e,t);s&&await this._gateway.unsubscribe(s,e.uid),t&&t!=="audio"||(e._audio_pre_subscribed=!1),t&&t!=="video"||(e._video_pre_subscribed=!1),e._is_pre_created&&AS(this._users,e),R.info("[".concat(this._clientId,"] unsubscribe success uid: ").concat(e.uid,", mediaType: ").concat(t))}}catch(s){if(s.code===U.DISCONNECT_P2P)return void R.warning("disconnecting p2p, abort unsubscribe request.");throw R.error("[".concat(this._clientId,"] unsubscribe user ").concat(e.uid," error"),s.toString()),s}finally{i()}}async _unsubscribeDataChannel(e,t){if(t&&on(t,"id",0,65535,!0),!this._joinInfo)throw new se(U.INVALID_OPERATION,"Can't unsubscribe datachannel, haven't joined yet!");if(!this._users.find((i=>i===e))){const i=new se(U.INVALID_REMOTE_USER,"user is not in the channel");throw R.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid,", user is not in the channel")),i}let r;if(typeof t=="number"){const i=e._dataChannels.find((s=>s.id===t));i&&(r=[i])}else r=e._dataChannels;if(r===void 0){const i=new se(U.REMOTE_USER_IS_NOT_PUBLISHED);throw R.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid," with channelId ").concat(t,", remote datachannel is not published")),i}R.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(e.uid,", mediaType: datachannel, ids: ").concat(r.map((i=>i.id))));try{const i=await this._p2pChannel.unsubscribeDataChannel(e,r);i&&await this._gateway.unsubscribeDataChannel(i,e.uid),R.info("[".concat(this._clientId,"] unsubscribe datachannel success uid: ").concat(e.uid,", mediaType: datachannel, ids: ").concat(i))}catch(i){if(i.code===U.DISCONNECT_P2P)return void R.warning("disconnecting p2p, abort unsubscribe request.");throw R.error("[".concat(this._clientId,"] unsubscribe user ").concat(e.uid," error"),i.toString()),i}}async massUnsubscribe(e){if(_l(e,"unsubscribeList"),!this._joinInfo)throw new se(U.INVALID_OPERATION,"Can't unsubscribeAll stream, haven't joined yet!");R.info("[".concat(this._clientId,"] start massUnsubscribe ").concat(e.map((n=>{let{user:r,mediaType:i}=n;return"user: ".concat(r?.uid,", mediaType: ").concat(i,";")})).join())),e=[...e];const t=new Map;for(let n=e.length-1;n>=0;n--){const{user:r,mediaType:i}=e[n];if(!r){const c=new se(U.INVALID_PARAMS,"user property does not exist in unsubscribeList item");throw R.error("[".concat(this._clientId,"] user property does not exist in unsubscribeList item")),c}if(hr(i,"mediaType",["video","audio",void 0]),!this._users.find((c=>c===r))){R.warning("[".concat(this._clientId,"] can not unsubscribe ").concat(r.uid,", user is not in the channel")),e.splice(n,1);continue}const o=gr.Video|gr.LwoVideo;if(t.has(r)){const c=t.get(r);let l;switch(i){case"video":l=c&o;break;case"audio":l=c&gr.Audio;break;default:l=c&(gr.Audio|o)}if(l){R.warning("[".concat(this._clientId,"] repeat massUnsubscribe user:").concat(r.uid,",mediaType:").concat(i," twice.")),e.splice(n,1);continue}i?i==="audio"?t.set(r,c|gr.Audio):i==="video"&&t.set(r,c|o):t.set(r,c|gr.Audio|o)}else i?i==="audio"?t.set(r,gr.Audio):i==="video"&&t.set(r,o):t.set(r,gr.Audio|o)}try{const n=await this._p2pChannel.massUnsubscribe(e);n&&await this._gateway.massUnsubscribe(n),R.info("[".concat(this._clientId,"] massUnsubscribe success ").concat(e.map((r=>{let{user:i,mediaType:s}=r;return"user: ".concat(i?.uid,", mediaType: ").concat(s,";")})).join()))}catch(n){if(n.code===U.DISCONNECT_P2P)return void R.warning("[".concat(this._clientId,"] disconnecting p2p, abort unsubscribe request."));throw R.error("[".concat(this._clientId,"] massUnsubscribe error"),n.toString()),n}}async setLowStreamParameter(e){(function(n){if(!n)throw new ce(U.INVALID_PARAMS);Mn(n.width)||K0(n.width,"streamParameter.width"),Mn(n.height)||K0(n.height,"streamParameter.height"),Mn(n.framerate)||K0(n.framerate,"streamParameter.framerate"),Mn(n.bitrate)||on(n.bitrate,"streamParameter.bitrate")})(e),(!e.width&&e.height||e.width&&!e.height)&&R.warning("[".concat(this._clientId,"] The width and height parameters take effect only when both are set")),R.info("[".concat(this._clientId,"] set low stream parameter to"),JSON.stringify(e));const t=this._configDistribute.getLowStreamConfigDistribute();if(t&&t.bitrate&&e.bitrate&&t.bitrate<e.bitrate&&(e.bitrate=t.bitrate),this._lowStreamParameter=e,this._isDualStreamEnabled)return this._p2pChannel.updateVideoStreamParameter(e,Ee.LocalVideoLowTrack)}async enableDualStream(){if(!Ft().supportDualStream)throw We.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),new se(U.NOT_SUPPORTED,"Your browser is not support dual stream");if(this._isDualStreamEnabled)throw new se(U.INVALID_OPERATION,"Dual stream is already enabled");if(this._p2pChannel.canPublishLowStream())try{await this._publishLowStream()}catch(e){throw We.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),e}this._isDualStreamEnabled=!0,We.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!0}),R.info("[".concat(this._clientId,"] enable dual stream"))}async disableDualStream(){if(this._isDualStreamEnabled){if(!this._joinInfo)throw new se(U.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this._p2pChannel.getLocalMedia(Ee.LocalVideoLowTrack))try{const e=await this._p2pChannel.unpublishLowStream();e&&await this._gateway.unpublish(e,this._joinInfo.stringUid||this._joinInfo.uid)}catch(e){throw We.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!1}),e}this._isDualStreamEnabled=!1,We.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!0}),R.info("[".concat(this._clientId,"] disable dual stream"))}}async setClientRole(e,t){if((function(r){hr(r,"role",["audience","host"])})(e),t&&X0(t),this.mode==="rtc"||this.mode==="p2p")throw R.warning("[".concat(this._clientId,"]").concat(this.mode," mode can not use setClientRole")),new se(U.INVALID_OPERATION,"".concat(this.mode," mode can not use setClientRole"));if(t&&t.level&&e==="host")throw new se(U.INVALID_OPERATION,"host mode can not set audience latency level");if(e==="audience"&&this._p2pChannel.hasLocalMedia())throw new se(U.INVALID_OPERATION,"can not set client role to audience when publishing stream");const n=this._config.role;this._joinInfo&&(this._joinInfo.role=e),e!==n&&F("ENABLE_ROLE_SELECT_EDGE")?(this._gateway.updateClientRole(e,t),this._config.role=e,this._gateway.reconnect("recover",jr.REGIONAL_DISTRIBUTION)):(await this._gateway.setClientRole(e,t),this._config.role=e),R.info("[".concat(this._clientId,"] set client role to ").concat(e,", level: ").concat(t&&t.level))}async _setClientRoleOptions(e){if(this.mode==="rtc"||this.mode==="p2p"||this._config.role!=="audience"||this._p2pChannel.hasLocalMedia())return;let t=!1;try{e&&X0(e),await this._gateway.setClientRole(this._config.role,e),t=!0}catch{}finally{R.info("[".concat(this._clientId,"] set client role options ").concat(t?"succeed":"failed",", options is ").concat(e))}}getRemoteInboundOffset(){var e;const t=(e=this._p2pChannel.getStats())===null||e===void 0?void 0:e.audioSend[0];if(!t||!t.timestamp)return 0;const n=t.timestamp-Date.now();return Math.abs(n)>1e3+t.rttMs+100?this.ntpAlignErrorCount+=1:this.ntpAlignErrorCount=0,this.ntpAlignErrorCount>=3?n:0}getNtpWallTimeInMs(){return document.visibilityState==="visible"&&(this.remoteInboundOffset=this.getRemoteInboundOffset()),this.remoteInboundOffset+Date.now()+this._gateway.ntpOffset}setProxyServer(e,t){if(Pr(e,"proxyServer"),!t){if(this.connectionState!=="DISCONNECTED")throw new se(U.INVALID_OPERATION,"Set proxy server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new se(U.INVALID_OPERATION,"You have already set the proxy")}this._proxyServer=e,We.setProxyServer(this._proxyServer),R.setProxyServer(this._proxyServer),R.info("[".concat(this._clientId,"] Set proxy server ").concat(t?"by initialize call":""," success."))}setTurnServer(e,t){if(Array.isArray(e)||(e=[e]),!t){if(this.connectionState!=="DISCONNECTED")throw new se(U.INVALID_OPERATION,"Set turn server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new se(U.INVALID_OPERATION,"You have already set the proxy")}if(UE(e))return this._turnServer={servers:e,mode:"original-manual"},void R.info("[".concat(this._clientId,"] Set original turnserver ").concat(t?"by initialize call":""," success: ").concat(e.map((n=>n.urls)).join(","),"."));e.forEach((n=>V1(n))),this._turnServer={servers:e,mode:"manual"},R.info("[".concat(this._clientId,"] Set turnserver ").concat(t?"by initialize call":""," success."))}setLicense(e){if(this.connectionState!=="DISCONNECTED")throw new se(U.INVALID_OPERATION,"you should set license before join channel");if(Pr(e,"license",32,32),!/^[A-Za-z\d]+$/.test(e))throw new se(U.INVALID_PARAMS,"license should only contains characters from A-Z a-z 0-9");this._license=e,R.info("[".concat(this._clientId,"] set license success"),e)}startProxyServer(e){if(this.connectionState!=="DISCONNECTED")throw new se(U.INVALID_OPERATION,"Start proxy server before join channel");if(this._proxyServer||this._turnServer.mode==="manual"||this._useLocalAccessPoint)throw new se(U.INVALID_OPERATION,"You have already set the proxy");const t=[3,4,5];let n;switch(e===void 0&&(e=3),e){case 1:case 2:throw new se(U.NOT_SUPPORTED,"proxy mode 1/2 has been deprecated and not supported.");case 3:n="proxy3";break;case 4:n="proxy4";break;case 5:n="proxy5";break;default:throw new se(U.INVALID_PARAMS,"proxy server mode must be ".concat(t.join("|")))}this._cloudProxyServerMode=n,this.store.cloudProxyServerMode=n,R.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode)}stopProxyServer(){if(this.connectionState!=="DISCONNECTED")throw new se(U.INVALID_OPERATION,"Stop proxy server after leave channel");We.setProxyServer(),R.setProxyServer(),this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled",R.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),this._proxyServer=void 0,this._turnServer={mode:"auto",servers:[]}}setLocalAccessPointsV2(e){if(!e.accessPoints)throw new se(U.INVALID_PARAMS,"accessPoints is required.");_l(e.accessPoints.serverList,"accessPoints.serverList"),Pr(e.accessPoints.domain,"accessPoints.domain");const t=(g,v)=>{on(g,v,0,65535,!0)};let n=443;if(e.accessPoints.port&&(t(e.accessPoints.port,"accessPoints.port"),n=e.accessPoints.port),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new se(U.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");F("CLOSE_AFB_FOR_LOCAL_AP")&&(nn("JOIN_WITH_FALLBACK_SIGNAL_PROXY",!1),nn("JOIN_WITH_FALLBACK_MEDIA_PROXY",!1));const r=/^((\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.){3}(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/,i=e.accessPoints.domain,s=e.accessPoints.serverList.map((g=>r.test(g)?"".concat(g.replace(/\./g,"-"),".").concat(i):g)),o=s.map((g=>"".concat(g,":").concat(n)));this._useLocalAccessPoint=!0,this._setLocalAPVersion=2,nn("WEBCS_DOMAIN",o),nn("WEBCS_DOMAIN_BACKUP_LIST",o),nn("GATEWAY_DOMAINS",[i]),e.report&&e.report.hostname&&Array.isArray(e.report.hostname)&&e.report.hostname.length?(_l(e.report.hostname,"report.hostname"),nn("EVENT_REPORT_DOMAIN",e.report.hostname[0]),nn("EVENT_REPORT_BACKUP_DOMAIN",e.report.hostname[1]||e.report.hostname[0])):(nn("EVENT_REPORT_DOMAIN",s[0]),nn("EVENT_REPORT_BACKUP_DOMAIN",s[1]||s[0]));let c=6443;e.report&&e.report.port&&(t(e.report.port,"report.port"),c=e.report.port),nn("STATS_COLLECTOR_PORT",c),e.report?nn("ENABLE_EVENT_REPORT",!0):nn("ENABLE_EVENT_REPORT",!1);let l="";e.log&&e.log.hostname&&Array.isArray(e.log.hostname)&&e.log.hostname.length?(_l(e.log.hostname,"log.hostname"),l=e.log.hostname[0]):l=s[0];let h=6444;e.log&&e.log.port&&(t(e.log.port,"log.port"),h=e.log.port),nn("LOG_UPLOAD_SERVER","".concat(l,":").concat(h));let p=[];e.cds&&e.cds.hostname&&Array.isArray(e.cds.hostname)&&e.cds.hostname.length?(_l(e.cds.hostname,"cds.hostname"),p=e.cds.hostname):p=s;let E=443;e.cds&&e.cds.port&&(t(e.cds.port,"cds.port"),E=e.cds.port),nn("CDS_AP",p.map((g=>"".concat(g,":").concat(E)))),e.cds?nn("ENABLE_CONFIG_DISTRIBUTE",!0):nn("ENABLE_CONFIG_DISTRIBUTE",!1),R.info("set local access point v2 success")}setLocalAccessPoints(e,t){if(_l(e,"serverList"),Pr(t,"domain"),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new se(U.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");const n=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;e=e.map((r=>n.test(r)?"".concat(r.replace(/\./g,"-"),".").concat(t):r)),this._useLocalAccessPoint=!0,this._setLocalAPVersion=1,nn("WEBCS_DOMAIN",e),nn("WEBCS_DOMAIN_BACKUP_LIST",e),nn("GATEWAY_DOMAINS",[t]),nn("EVENT_REPORT_DOMAIN",e[0]),nn("EVENT_REPORT_BACKUP_DOMAIN",e[1]||e[0]),nn("LOG_UPLOAD_SERVER","".concat(e[0],":6444")),R.info("[".concat(this._clientId,"] set local access point success"))}async setRemoteDefaultVideoStreamType(e){if(hr(e,"streamType",[0,1,4,5,6,7,8,9]),this._remoteDefaultVideoStreamType=e,this._joinInfo)try{await this._gateway.setDefaultRemoteVideoStreamType(e),this._joinInfo.defaultVideoStream=this._remoteDefaultVideoStreamType}catch(t){throw R.error("[".concat(this._clientId,"] set default remote video stream type error"),t.toString()),t}else R.debug("[".concat(this._clientId,"] haven't joined yet, cache remoteDefaultVideoStreamType ").concat(e))}async setRemoteVideoStreamType(e,t){hr(t,"streamType",[0,1,4,5,6,7,8,9]);try{await this._gateway.setRemoteVideoStreamType(e,t),setTimeout((()=>{const n=this._users.find((r=>r.uid===e));n&&n.videoTrack&&n.videoTrack.updateMediaStreamTrackResolution()}),2e3)}catch(n){throw R.error("[".concat(this._clientId,"] set remote video stream type error"),n.toString()),n}R.info("[".concat(this._clientId,"] set remote ").concat(e," video stream type to ").concat(t)),this._remoteStreamTypeCacheMap.set(e,t)}async setStreamFallbackOption(e,t){hr(t,"fallbackType",[0,1,2,3,4,5,6,7,8]);try{await this._gateway.setStreamFallbackOption(e,t)}catch(n){throw R.error("[".concat(this._clientId,"] set stream fallback option"),n.toString()),n}R.info("[".concat(this._clientId,"] set remote ").concat(e," stream fallback type to ").concat(t)),this._streamFallbackTypeCacheMap.set(e,t)}setEncryptionConfig(e,t,n,r){(function(s){hr(s,"encryptionMode",["aes-128-xts","aes-256-xts","aes-128-ecb","sm4-128-ecb","aes-128-gcm","aes-256-gcm","aes-128-gcm2","aes-256-gcm2","none"])})(e),Pr(t,"secret");const i=["aes-128-gcm2","aes-256-gcm2"];if(Re(i).call(i,e)){if(!n||!(n instanceof Uint8Array&&n.length===32))throw new se(U.INVALID_PARAMS,"salt must be an Uint8Array and exactly equal to 32 bytes")}else if(n)throw new se(U.INVALID_PARAMS,"current encrypt mode does not need salt");if(r){if(Sa(r,"encryptDataStream"),!Re(i).call(i,e))throw new se(U.INVALID_PARAMS,"current encrypt mode does not support data stream");this._encryptDataStream=!0}new RegExp(`^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*,.<>?/:;'"|{}\\[\\]])(?=.{8,})`).test(t)||R.warning(`The secret is not strong:
      The secret must contain at least 1 lowercase alphabetical character,
      The secret must contain at least 1 uppercase alphabetical character,
      The secret must contain at least 1 numeric character,
      The secret must contain at least one special character,
      The secret must be eight characters or longer.
      `),this._encryptionMode=e,this._encryptionSecret=t,n&&(this._encryptionSalt=bd(n))}async renewToken(e){if(Pr(e,"token",1,2047),!this._key||!this._joinInfo)throw new se(U.INVALID_OPERATION,"renewToken should not be called before user join");const t=this._key;this._key=e,this._joinInfo&&(this._joinInfo.token=e);const n=await this._renewTokenMutex.lock();try{if(F("USE_NEW_TOKEN")){R.debug("[".concat(this._clientId,"] start renew token with ticket from unilbs"));const r=await I9(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||rr);R.debug("[".concat(this._clientId,"] get ticket from unilbs success")),await this._gateway.renewToken({token:e,ticket:r})}else R.debug("[".concat(this._clientId,"] start renew token without ticket")),await this._gateway.renewToken({token:e});R.debug("[".concat(this._clientId,"] renewToken success"))}catch(r){throw this._key=t,this._joinInfo.token=t,R.error("[".concat(this._clientId,"] renewToken failed"),r.toString()),r}finally{n()}}enableAudioVolumeIndicator(){this._audioVolumeIndicationInterval?R.warning("you have already enabled audio volume indicator!"):this._audioVolumeIndicationInterval=window.setInterval((()=>{const e=this._p2pChannel.getAudioLevels();this.safeEmit(Nt.VOLUME_INDICATOR,e)}),F("AUDIO_VOLUME_INDICATION_INTERVAL")||2e3)}getRTCStats(){const e=this._statsCollector.getRTCStats(),t=this._gateway.getInChannelInfo();return e.Duration=Math.round(t.duration/1e3),e}async startLiveStreaming(e,t){if(!t){if(this.codec!=="h264")throw new se(U.LIVE_STREAMING_INVALID_RAW_STREAM,"raw streaming is only support h264");if(!this._p2pChannel.hasLocalMedia())throw new se(U.LIVE_STREAMING_INVALID_RAW_STREAM,"can not find stream to raw streaming")}if(this._liveRawStreamingClient&&this._liveRawStreamingClient.hasUrl(e)||this._liveTranscodeStreamingClient&&this._liveTranscodeStreamingClient.hasUrl(e))throw new se(U.LIVE_STREAMING_TASK_CONFLICT);const n=t?El.TRANSCODE:El.RAW;return this._createLiveStreamingClient(n).startLiveStreamingTask(e,n)}setLiveTranscoding(e){return this._createLiveStreamingClient(El.TRANSCODE).setTranscodingConfig(e)}async stopLiveStreaming(e){const t=[this._liveRawStreamingClient,this._liveTranscodeStreamingClient].filter((n=>n&&n.hasUrl(e)));if(!t.length)throw new se(U.INVALID_PARAMS,"can not find live streaming url to stop");await Pe.all(t.map((n=>n&&n.stopLiveStreamingTask(e))))}async startChannelMediaRelay(e){w2(e),await this._createChannelMediaRelayClient().startChannelMediaRelay(e)}async updateChannelMediaRelay(e){w2(e),await this._createChannelMediaRelayClient().updateChannelMediaRelay(e)}async stopChannelMediaRelay(){await this._createChannelMediaRelayClient().stopChannelMediaRelay(),this._statsCollector.onStatsChanged&&(this._statsCollector.onStatsChanged=void 0)}sendAudioMetadata(e){this._p2pChannel instanceof sg&&this._p2pChannel.addAudioMetadata(e)}async sendStreamMessage(e){var t;let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!this._joinInfo)throw new se(U.INVALID_OPERATION,"can not send data stream, not joined");if((typeof e=="string"||e instanceof Uint8Array)&&(e={payload:e}),typeof e.payload=="string"){const i=new TextEncoder;e.payload=i.encode(e.payload)}let r=!1;if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&Re(t=["aes-128-gcm2","aes-256-gcm2"]).call(t,this._encryptionMode)&&(r=!0,e.payload=await(async function(i,s,o){var c;const l=zi(c=Array.from(o)).call(c,((I,N)=>I+N),0),h={serverTs:0,seq:qz++,length:o.length,checkSum:l},p=new Uint8Array(z1(l,2)),E=new ArrayBuffer(If),g=new DataView(E);g.setUint32(0,h.serverTs),g.setUint16(4,h.seq),g.setUint16(6,h.length),g.setUint16(8,h.checkSum);const v=16-o.length%16;o=B1(o,new Uint8Array(v));const O=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:i,tagLength:sL,additionalData:p},s,o);return B1(new Uint8Array(E),new Uint8Array(O))})(this._encryptDataStreamIv,this._encryptDataStreamKey,e.payload)),new Blob([e.payload]).size>1024)throw new se(U.INVALID_PARAMS,r?"encrypted stream message out of range.":"stream message out of range.");return this._gateway.signal.request(st.DATA_STREAM,{payload:bd(e.payload),syncWithAudio:e.syncWithAudio,sendTs:Date.now()-x9},!n)}sendMetadata(e){if(!this._joinInfo)throw new se(U.INVALID_OPERATION,"can not send metadata, not joined");if(new Blob([e]).size>1024)throw new se(U.METADATA_OUT_OF_RANGE);return this._gateway.signal.request(st.SEND_METADATA,{session_id:this._joinInfo.sid,metadata:bd(e)})}async sendCustomReportMessage(e){if(Array.isArray(e)||(e=[e]),e.forEach(rY),!this._joinInfo)throw new se(U.INVALID_OPERATION,"can not send custom report, not joined");await We.sendCustomReportMessage(this._joinInfo.sid,e)}getLocalAudioStats(){return this._statsCollector.getLocalAudioTrackStats()}getRemoteAudioStats(){return this._statsCollector.getRemoteAudioTrackStats()}getLocalVideoStats(){return this._statsCollector.getLocalVideoTrackStats()}getRemoteVideoStats(){return this._statsCollector.getRemoteVideoTrackStats()}getRemoteNetworkQuality(){const e=this._statsCollector.getRemoteNetworkQualityStats();if(F("DELETE_NEQ_AFTER_USER_LEAVE")){const t=this._users.map((n=>n.uid+""));Object.keys(e).forEach((n=>{Re(t).call(t,n)||delete e[n]}))}return e}async pickSVCLayer(e,t){hr(t.spatialLayer,"spatialLayer",[0,1,2,3]),hr(t.temporalLayer,"temporalLayer",[0,1,2,3]);try{await this._gateway.pickSVCLayer(e,t)}catch(n){throw R.error("[".concat(this._clientId,"] pick SVC layer failed"),n.toString()),n}}async setRTMConfig(e){const{apRTM:t=!1,rtmFlag:n}=e;if(Sa(t,"apRTM"),on(n,"rtmFlag",0),this._rtmConfig.apRTM=t,this._rtmConfig.rtmFlag=n,R.debug("[".concat(this._clientId,"] setRTMconfig ").concat(JSON.stringify(e)," in ").concat(this.connectionState," state")),(this.connectionState==="CONNECTED"||this.connectionState==="RECONNECTING")&&this._joinInfo)return this._joinInfo.apRTM=t,this._joinInfo.rtmFlag=n,this._gateway.setRTM2Flag(n)}_reset(){if(R.debug("[".concat(this._clientId,"] reset client")),(function(e){const t=jf.indexOf(e);t!==-1&&jf.splice(t,1)})(this._clientId),this.store.hasStartJoinChannel=!1,this.store.isABTestSuccess=!1,this.store.autoSubscribe=!1,this._axiosCancelSource.cancel(),this._axiosCancelSource=Mi.CancelToken.source(),this._streamFallbackTypeCacheMap=new Map,this._remoteStreamTypeCacheMap=new Map,this._configDistribute.stopGetConfigDistribute(),this._joinInfo&&Q2(this._joinInfo),this._joinInfo=void 0,this._proxyServer=void 0,this._defaultStreamFallbackType=void 0,this._sessionId&&We.removeSid(this._sessionId),this._sessionId=null,this.store.sessionId=null,this.store.resetFirstVideoFrameDecoded(),this._statsCollector.reset(),this._key=void 0,this._appId=void 0,this._uid=void 0,this.store.uid=void 0,this._channelName=void 0,this._encryptionMode="none",this._encryptionSecret=null,this._encryptionSalt=null,this._encryptDataStreamKey=null,this._encryptDataStreamIv=null,this._pendingPublishedUsers=[],this._users.forEach((e=>{e._audioTrack&&e._audioTrack._destroy(),e._videoTrack&&e._videoTrack._destroy(),e._dataChannels&&(e._dataChannels.forEach((t=>t._close())),e._dataChannels.length=0)})),this._users=[],this._audioVolumeIndicationInterval&&(window.clearInterval(this._audioVolumeIndicationInterval),this._audioVolumeIndicationInterval=void 0),this._cloudProxyServerMode==="fallback"&&(this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled"),this._p2pChannel.reset(),this._publishMutex=new Yr("client-publish",this._clientId),this._subscribeMutex=new Yr("client-subscribe",this._clientId),this._networkQualityInterval&&(window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=void 0),this._liveRawStreamingClient&&(this._liveRawStreamingClient.terminate(),this._liveRawStreamingClient.removeAllListeners(),this._liveRawStreamingClient=void 0),this._liveTranscodeStreamingClient&&(this._liveTranscodeStreamingClient.terminate(),this._liveTranscodeStreamingClient.removeAllListeners(),this._liveTranscodeStreamingClient=void 0),this._channelMediaRelayClient&&(this._channelMediaRelayClient.dispose(),this._channelMediaRelayClient=void 0),this._inspect)try{this._inspect.close(),this._inspect=void 0}catch{}if(this._moderation)try{this.setImageModeration(!1)}catch{}}_startSession(e,t){var n;const r=e||_h();e?R.debug("[".concat(this._clientId,"] new Session ").concat(r)):R.debug("[".concat(this._clientId,"] renewSession ").concat(this._sessionId," => ").concat(r));const i=e?"":this._sessionId||"";this._sessionId=r,this.store.sessionId=r,We.addSid(r);const s={lts:new Date().getTime(),mode:this.mode,buildFormat:1,stringUid:t?.stringUid||((n=this._joinInfo)===null||n===void 0?void 0:n.stringUid),channelProfile:this.mode==="live"?1:0,channelMode:0,isABTestSuccess:Number(this._configDistribute.isSuccess),lsid:i,clientRole:this.role==="audience"?2:1};We.sessionInit(this._sessionId,Yo({cname:t.channel,appid:t.appId},s)),this._joinInfo&&(this._joinInfo.sid=r),this._gateway.joinInfo&&(this._gateway.joinInfo.sid=r)}async _publishHighStream(e){if(!this._joinInfo||this._uid===void 0)throw new se(U.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new se(U.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&F("FORCE_TURN")&&!F("TURN_ENABLE_TCP")&&!F("TURN_ENABLE_UDP"))throw new se(U.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");R.debug("[".concat(this._clientId,"] publish high stream"));try{const n=await this._p2pChannel.publish(e,this._isDualStreamEnabled,this._lowStreamParameter);if(this.store.useP2P){const r=(await n.next()).value;if(r){try{await this._gateway.sendExtensionMessage(Hn.PUBLISH,r,!0)}catch(i){throw n.throw(i),i}await n.next()}this._p2pChannel.reportPublishEvent(!0,null)}else{const r=(await n.next()).value;if(r){var t;let i;try{i=await this._gateway.publish(this._uid,r,!0)}catch(s){if(s.code!==U.DISCONNECT_P2P)throw n.throw(s),s}await n.next(((t=i)===null||t===void 0?void 0:t.ortc)||[])}this._p2pChannel.reportPublishEvent(!0,null);for(const i of e)i instanceof vn&&i._encoderConfig&&this._gateway.setVideoProfile(i._encoderConfig).catch((s=>{R.debug("[".concat(this._clientId,"] stop setVideoProfile, because websocket is closed"))})),!i.muted&&i.enabled||await this._p2pChannel.muteLocalTrack(i)}}catch(n){if(this._p2pChannel.reportPublishEvent(!1,n?.code,e),n?.code===U.WS_ABORT)return;throw n}}async _publishLowStream(){if(!this._joinInfo||this._uid===void 0)throw new se(U.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new se(U.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));R.debug("[".concat(this._clientId,"] publish low stream"));const e=this._configDistribute.getLowStreamConfigDistribute();e&&e.bitrate&&(this._lowStreamParameter||(this._lowStreamParameter={width:160,height:120,framerate:15,bitrate:50}),this._lowStreamParameter&&this._lowStreamParameter.bitrate&&e.bitrate<this._lowStreamParameter.bitrate&&(this._lowStreamParameter.bitrate=e.bitrate));try{const n=await this._p2pChannel.publishLowStream(this._lowStreamParameter),r=(await n.next()).value;if(r){var t;let i;try{i=await this._gateway.publish(this._uid,r,!0)}catch(s){if(s.code!==U.DISCONNECT_P2P)throw n.throw(s),s}n.next(((t=i)===null||t===void 0?void 0:t.ortc)||[]),this._p2pChannel.reportPublishEvent(!0,null,void 0,!0)}}catch(n){if(this._p2pChannel.reportPublishEvent(!1,n?.code,void 0,!0),n?.code===U.WS_ABORT)return;throw n}}_createLiveStreamingClient(e){const t=()=>{if(!this._joinInfo||!this._appId)return new se(U.INVALID_OPERATION,"can not create live streaming client, please join channel first").throw();const n=(r={joinInfo:this._joinInfo,appId:this._appId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig},yl("LiveStreaming").create(r));var r;return n.onLiveStreamError=(i,s)=>{We.reportApiInvoke(this._sessionId,{name:Bn.ON_LIVE_STREAM_ERROR,options:[i,s],tag:In.TRACER}).onSuccess(),this.safeEmit(Nt.LIVE_STREAMING_ERROR,i,s)},n.onLiveStreamWarning=(i,s)=>{We.reportApiInvoke(this._sessionId,{name:Bn.ON_LIVE_STREAM_WARNING,options:[i,s],tag:In.TRACER}).onSuccess(),this.safeEmit(Nt.LIVE_STREAMING_WARNING,i,s)},n.on(Gb.REQUEST_WORKER_MANAGER_LIST,((i,s,o)=>{if(!this._joinInfo)return o(new se(U.INVALID_OPERATION,"can not find join info to get worker manager"));(async function(c,l,h,p){const E=F("UAP_AP").slice(0,F("AJAX_REQUEST_CONCURRENT")).map((g=>l.proxyServer?"https://".concat(l.proxyServer,"/ap/?url=").concat(g+"/api/v1?action=uap"):"https://".concat(g,"/api/v1?action=uap")));return await y9(E,c,l,h,p)})(i,this._joinInfo,this._axiosCancelSource.token,rr).then(s).catch(o)})),n};return e===El.RAW?(this._liveRawStreamingClient=this._liveRawStreamingClient||t(),this._liveRawStreamingClient):(this._liveTranscodeStreamingClient=this._liveTranscodeStreamingClient||t(),this._liveTranscodeStreamingClient)}_createChannelMediaRelayClient(){if(!this._joinInfo)return new se(U.INVALID_OPERATION,"can not create channel media relay client, please join channel first").throw();if(!this._channelMediaRelayClient){const{sendResolutionWidth:t,sendResolutionHeight:n}=this.getLocalVideoStats(),r=(e={joinInfo:this._joinInfo,clientId:this._clientId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig,resolution:{width:t,height:n}},yl("ChannelMediaRelay").create(e));r.on("state",(i=>{i===es.RELAY_STATE_FAILURE&&r&&r.dispose(),this.safeEmit(Nt.CHANNEL_MEDIA_RELAY_STATE,i)})),r.on("event",(i=>{this.safeEmit(Nt.CHANNEL_MEDIA_RELAY_EVENT,i)})),this._channelMediaRelayClient=r,this._statsCollector.onStatsChanged=(i,s)=>{var o;i==="resolution"&&((o=this._channelMediaRelayClient)===null||o===void 0||o.setVideoProfile(s))}}var e;return this._channelMediaRelayClient}_handleUpdateDataChannel(e,t){const{added:n,deleted:r}=e,i=[];if(t){const s=[];this._users.forEach((o=>{o._dataChannels.forEach((c=>{n.every((l=>l.uid!==o._uintid||l.stream_id!==c.id))&&s.push({uid:o._uintid,stream_id:c.id,ordered:c.ordered,max_retrans_times:c.maxRetransmits,metadata:c.metadata})}))})),s.length>0&&this._handleUpdateDataChannel({added:[],deleted:s})}Array.isArray(n)&&n.length>0&&n.forEach((s=>{const{uid:o,stream_id:c,ordered:l,max_retrans_times:h,metadata:p}=s,E=this._users.find((g=>g._uintid===o));if(!E)return void R.error("[".concat(this._clientId,"] can not find target user!(on_add_data_channel)"));if(R.debug("[".concat(this._clientId,"] data_channel added with uid ").concat(o)),Re(i).call(i,E)||i.push(E),E._uintid||(E._uintid=o),E._dataChannels.findIndex((g=>g.id===s.stream_id))===-1){const g={id:c,ordered:!!l,maxRetransmits:h,metadata:p},v=(function(O){return l2(O,!0)})(g);E._dataChannels.push(v),R.info("[".concat(this._clientId,"] remote user ").concat(E.uid," published datachannel")),t||this.safeEmit(Nt.USER_PUBLISHED,E,"datachannel",g)}this._p2pChannel.hasPendingRemoteDataChannel(E,s.stream_id)&&(R.debug("[".concat(this._clientId,"] resubscribe datachannel for user ").concat(E.uid," after reconnect.")),this._subscribeDataChannel(E,s.stream_id).catch((g=>{R.error("[".concat(this._clientId,"] resubscribe datachannel error"),g.toString())})))})),t&&(this.safeEmit(Nt.PUBLISHED_USER_LIST,this._pendingPublishedUsers),this._pendingPublishedUsers=[]),Array.isArray(r)&&r.length>0&&r.forEach((s=>{const{uid:o,stream_id:c}=s,l=this._users.find((p=>p._uintid===o));if(!l)return void R.error("[".concat(this._clientId,"] can not find target user!(on_delete_data_channel)"));const h=l._dataChannels.find((p=>p.id===s.stream_id));h&&(R.debug("[".concat(this._clientId,"] data_stream delete with uid ").concat(o)),this._p2pChannel.unsubscribeDataChannel(l,[h]).then((p=>{if(l._dataChannels=l._dataChannels.filter((E=>E!==h)),p)return this._gateway.unsubscribeDataChannel(p,l.uid)})),R.info("[".concat(this._clientId,"] remote user ").concat(o," unpublished datachannel ,id:").concat(h.id)),this.safeEmit(Nt.USER_UNPUBLISHED,l,"datachannel",h._config))}))}_getEncodingName(e){var t;if(!this._joinResponse)return;const n=(t=this._joinResponse.ortc.rtpCapabilities.sendrecv)===null||t===void 0?void 0:t.videoCodecs;if(n)for(const i of n){var r;if(i.payloadType===e)return i==null||(r=i.rtpMap)===null||r===void 0?void 0:r.encodingName}}_handleRemoveDataChannels(e){const t=this._users.find((n=>n.uid===e.uid));if(t){if(t._dataChannels!==void 0&&t._dataChannels.length>0){R.debug("[".concat(this._clientId,"] datachannel removed with uid ").concat(e.uid));const n=()=>{R.info("[".concat(this._clientId,"] remote user ").concat(t.uid," unpublished datachannel")),t._dataChannels.forEach((r=>{this.safeEmit(Nt.USER_UNPUBLISHED,t,"datachannel",r._config)}))};this._p2pChannel.unsubscribeDataChannel(t,t._dataChannels).then((r=>{if(r)return this._gateway.unsubscribeDataChannel(r,t.uid)})),n()}}else R.warning("[".concat(this._clientId,"] can not find target user!(on_remove_datachannel)"))}_handleGatewayEvents(){this._gateway.on(Cr.UPDATE_GATEWAY_CONFIG,(()=>{(function(){let e;try{e=window.localStorage.getItem("websdk_ng_global_parameter")}catch(t){return void R.error("Error loading sdk config",t.message)}if(e)try{const t=JSON.parse(window.atob(e)),n=Date.now();Object.keys(t).forEach((r=>{const{value:i,type:s,expires:o}=t[r];o&&o<=n||s||Mb()||!Object.prototype.hasOwnProperty.call(LS,r)||(Ra[r]=i,wn[r]=i,R.debug("Update gateway parameters from config distribute",r,i))}))}catch(t){R.error("Error update config from local cache",t.message)}})()})),this._gateway.on(Cr.DISCONNECT_P2P,(async()=>{await this._p2pChannel.disconnectForReconnect()})),this._gateway.on(Cr.CONNECTION_STATE_CHANGE,((e,t,n)=>{var r;if(n===Qt.FALLBACK)return;const i=()=>{this.safeEmit(Nt.CONNECTION_STATE_CHANGE,e,t,n)};if(We.reportApiInvoke(this._sessionId||((r=this._gateway.joinInfo)===null||r===void 0?void 0:r.sid)||null,{name:Bn.CONNECTION_STATE_CHANGE,options:[e,t,n],tag:In.TRACER}).onSuccess(JSON.stringify({cur:e,prev:t,reason:n})),R.info("[".concat(this._clientId,"] signal connection state change: ").concat(t," -> ").concat(e)),e==="DISCONNECTED")return this._reset(),void i();if(e==="RECONNECTING")this._users.forEach((o=>{o._trust_in_room_=!1,o._trust_audio_enabled_state_=!1,o._trust_video_enabled_state_=!1,o._trust_audio_mute_state_=!1,o._trust_video_mute_state_=!1,o._trust_audio_stream_added_state_=!1,o._trust_video_stream_added_state_=!1,o._is_pre_created||(o._audio_pre_subscribed||(o._audioSSRC=void 0,o._audioOrtc=void 0),o._video_pre_subscribed||(o._videoSSRC=void 0,o._videoOrtc=void 0,o._rtxSsrcId=void 0),o._cname=void 0)})),this._userOfflineTimeout&&window.clearTimeout(this._userOfflineTimeout),this._streamRemovedTimeout&&window.clearTimeout(this._streamRemovedTimeout),this._userOfflineTimeout=void 0,this._streamRemovedTimeout=void 0;else if(e==="CONNECTED"){var s;this._streamFallbackTypeCacheMap.forEach(((o,c)=>{this._gateway.setStreamFallbackOption(c,o).catch((l=>{R.warning("[".concat(this._clientId,"] auto set stream fallback option failed"),l)}))})),this._remoteStreamTypeCacheMap.forEach(((o,c)=>{this._gateway.setRemoteVideoStreamType(c,o).catch((l=>{R.warning("[".concat(this._clientId,"] auto set remote stream type failed"),l)}))})),this._remoteDefaultVideoStreamType!==void 0&&((s=this._joinInfo)===null||s===void 0?void 0:s.defaultVideoStream)===void 0&&this.setRemoteDefaultVideoStreamType(this._remoteDefaultVideoStreamType).then((()=>{R.debug("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway connected"))})).catch((o=>{R.error("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway failed, ").concat(o))})),this.store.useP2P||(this._p2pChannel.republish(),this._userOfflineTimeout=window.setTimeout((()=>{this.connectionState==="CONNECTED"&&(this._userOfflineTimeout=void 0,this._users.filter((o=>!o._trust_in_room_)).forEach((o=>{R.debug("[".concat(this._clientId,"] user offline timeout, emit user offline ").concat(o.uid)),this._handleUserOffline({uid:o.uid})})))}),3e3),this._streamRemovedTimeout=window.setTimeout((()=>{this.connectionState==="CONNECTED"&&(this._streamRemovedTimeout=void 0,this._users.forEach((o=>{o._trust_audio_mute_state_||(R.debug("[".concat(this._clientId,"] auto dispatch audio unmute event ").concat(o.uid)),this._handleMuteStream(o.uid,Le.AUDIO,!1)),o._trust_video_mute_state_||(R.debug("[".concat(this._clientId,"] auto dispatch video unmute event ").concat(o.uid)),this._handleMuteStream(o.uid,Le.VIDEO,!1)),o._trust_audio_enabled_state_||(R.debug("[".concat(this._clientId,"] auto dispatch enable local audio ").concat(o.uid)),this._handleSetStreamLocalEnable("audio",o.uid,!0)),o._trust_video_enabled_state_||(R.debug("[".concat(this._clientId,"] auto dispatch enable local video ").concat(o.uid)),this._handleSetStreamLocalEnable("video",o.uid,!0)),o._trust_video_stream_added_state_||(R.debug("[".concat(this._clientId,"] auto dispatch reset video stream added ").concat(o.uid)),this._handleResetAddStream(o,"video")),o._trust_audio_stream_added_state_||(R.debug("[".concat(this._clientId,"] auto dispatch reset audio stream added ").concat(o.uid)),this._handleResetAddStream(o,"audio")),o._video_added_||o._audio_added_||(R.debug("[".concat(this._clientId,"] auto dispatch stream remove ").concat(o.uid)),this._handleRemoveStream({uid:o.uid,uint_id:o._uintid}))})))}),1e3))}i()})),this._gateway.on(Cr.REQUEST_NEW_GATEWAY_LIST,(async(e,t)=>{if(!this._joinInfo)return t(new se(U.UNEXPECTED_ERROR,"can not recover, no join info"));try{let n;const r=await X2(Yo(Yo({},this._joinInfo),{},{uid:this._joinInfo.uid,stringUid:void 0}));r?(n=r.ap,Z2(r),this._joinInfo.preload=!0):(n=await sI(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||rr,this.store),this._joinInfo.preload=!1),this._joinInfo&&(this._joinInfo.apResponse=n.gatewayInfo.res,this._joinInfo.gatewayAddrs=n.gatewayInfo.gatewayAddrs,this._joinInfo.uni_lbs_ip=n.gatewayInfo.uni_lbs_ip);const i=[];n.gatewayInfo.gatewayAddrs.forEach((s=>{let{address:o}=s;const[c,l]=o.split(":");this._joinInfo&&this._joinInfo.proxyServer?i.push({proxy:this._joinInfo.proxyServer,host:c,port:l}):i.push({host:c,port:l})})),e(i)}catch(n){t(n)}})),this._gateway.on(Cr.NETWORK_QUALITY,(e=>{this._networkQualitySensitivity==="normal"&&this.safeEmit(Nt.NETWORK_QUALITY,e)})),this._gateway.on(Cr.STREAM_TYPE_CHANGE,((e,t)=>{this.safeEmit(Nt.STREAM_TYPE_CHANGED,e,t),We.reportApiInvoke(this._sessionId,{name:Bn.STREAM_TYPE_CHANGE,options:[e,t],tag:In.TRACER}).onSuccess(JSON.stringify({uid:e,streamType:t}))})),this._gateway.isPreSub=()=>"isPreSub"in this._p2pChannel&&this._p2pChannel.isPreSub(),this._gateway.isPreallocation=()=>"isPreallocation"in this._p2pChannel&&this._p2pChannel.isPreallocation(),this._gateway.on(Cr.IS_P2P_DISCONNECTED,(e=>{this._p2pChannel.isP2PDisconnected()?e(!0):this._p2pChannel.hasLocalMedia()||this._p2pChannel.hasRemoteMedia()?e(!1):e(!0)})),this._gateway.on(Cr.REQUEST_P2P_CONNECTION_PARAMS,(async(e,t,n)=>{try{let r=await this._p2pChannel.getEstablishParams();r&&"isPreallocation"in this._p2pChannel&&this._p2pChannel.isPreallocation()||(r=await this._p2pChannel.startP2PConnection(e)),t(r)}catch(r){n(r)}})),this._gateway.on(Cr.JOIN_RESPONSE,((e,t)=>{if(this.store.useP2P)return;let n;this._joinResponse=e,e.attributes?n=e.attributes.userAttributes.preSubSsrcs:R.debug("no attributes in joinResponse");const r=QM(e.ortc,t,n);this._p2pChannel.connect(r)})),this._gateway.on(Cr.PRE_CONNECT_PC,(async e=>{const{candidates:t,fingerprint:n,turnServer:r}=e;if(this._joinInfo&&t.length>0&&!this._p2pChannel.isPlanB){const{cert:s,cid:o}=this._joinInfo.apResponse,c="".concat(o,"_").concat(s);if(c.length<4||c.length>256)return;await this._p2pChannel.startP2PConnection({turnServer:r,cloudProxyServer:this._joinInfo.cloudProxyServer,isPreallocation:!0});try{var i;await this._p2pChannel.connect({iceParameters:{iceUfrag:"".concat(o,"_").concat(s),icePwd:"".concat(o,"_").concat(s)},dtlsParameters:{fingerprints:[{hashFunction:"sha-256",fingerprint:(i=F("FINGERPRINT"))!==null&&i!==void 0?i:n}]},candidates:t,rtpCapabilities:{send:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},recv:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]}},setup:"active",cname:"o/i14u9pJrxRKAsu",preallocation:!0})}catch(l){l.code&&l.code===U.EXCHANGE_SDP_FAILED&&await this._p2pChannel.startP2PConnection({turnServer:r,cloudProxyServer:this._joinInfo.cloudProxyServer},!0)}}}))}_handleGatewaySignalEvents(){this._gateway.signal.on(Pt.ON_USER_ONLINE,this._handleUserOnline),this._gateway.signal.on(Pt.ON_USER_OFFLINE,this._handleUserOffline),this._gateway.signal.on(Pt.ON_ADD_AUDIO_STREAM,(e=>this._handleAddAudioOrVideoStream("audio",e.uid,e.ssrcId,e.cname,e.pt,e.uint_id,e.ortc))),this._gateway.signal.on(Pt.ON_ADD_VIDEO_STREAM,(e=>this._handleAddAudioOrVideoStream("video",e.uid,e.ssrcId,e.cname,e.pt,e.uint_id,e.ortc,e.rtxSsrcId))),this._gateway.signal.on(Pt.ON_REMOTE_DATASTREAM_UPDATE,(e=>{this._handleUpdateDataChannel(e)})),this._gateway.signal.on(Pt.ON_REMOTE_FULL_DATASTREAM_INFO,(e=>{this._handleUpdateDataChannel({added:e.datastreams||[],deleted:[]},!0)})),this._gateway.signal.on(Pt.ON_REMOVE_STREAM,this._handleRemoveStream),this._gateway.signal.on(Pt.ON_P2P_LOST,this._handleP2PLost),this._gateway.signal.on(Pt.MUTE_AUDIO,(e=>this._handleMuteStream(e.uid,Le.AUDIO,!0))),this._gateway.signal.on(Pt.UNMUTE_AUDIO,(e=>this._handleMuteStream(e.uid,Le.AUDIO,!1))),this._gateway.signal.on(Pt.MUTE_VIDEO,(e=>this._handleMuteStream(e.uid,Le.VIDEO,!0))),this._gateway.signal.on(Pt.UNMUTE_VIDEO,(e=>this._handleMuteStream(e.uid,Le.VIDEO,!1))),this._gateway.signal.on(Pt.RECEIVE_METADATA,(e=>{const t=mh(e.metadata);this.safeEmit(Nt.RECEIVE_METADATA,e.uid,t)})),this._gateway.signal.on(Pt.ON_DATA_STREAM,(async e=>{var t;if(!e)return;let n=mh(e.payload);if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&Re(t=["aes-128-gcm2","aes-256-gcm2"]).call(t,this._encryptionMode)){if(e.payload.length<If)throw new se(U.UNEXPECTED_RESPONSE,"payload length ".concat(e.payload.length," is less than header length ").concat(If));n=await(async function(s,o,c){const l=c.subarray(0,If),h=l.slice(8,If),p=(h[0]<<8)+h[1],E=(l[6]<<8)+l[7],g=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:s,tagLength:sL,additionalData:new Uint8Array(z1(p,2))},o,c.subarray(If));return new Uint8Array(g).subarray(0,E)})(this._encryptDataStreamIv,this._encryptDataStreamKey,n)}let r=0;if(e.ordered||e.syncWithAudio){const i=this._p2pChannel.getStats(),s=this.remoteUsers.find((c=>c.uid===e.uid)),o=i?.audioRecv.find((c=>c.ssrc===s?._audioSSRC));r=o?.jitterBufferMs}(r==null||Number.isNaN(r))&&(r=0),U9(Yo(Yo({},e),{},{payload:n}),r,{id:this._clientId,onStreamMessage:typeof this.onStreamMessage=="function"?this.onStreamMessage.bind(this):void 0,safeEmit:this.safeEmit.bind(this)})})),this._gateway.signal.on(Pt.ON_CRYPT_ERROR,(()=>{wd((()=>{R.warning("[".concat(this._clientId,"] on crypt error")),this.safeEmit(Nt.CRYPT_ERROR)}),this._sessionId)})),this._gateway.signal.on(Pt.ON_TOKEN_PRIVILEGE_WILL_EXPIRE,this._handleTokenWillExpire),this._gateway.signal.on(Pt.ON_TOKEN_PRIVILEGE_DID_EXPIRE,(()=>{R.warning("[".concat(this._clientId,"] received message onTokenPrivilegeDidExpire, please get new token and join again")),this._gateway.leave(!0,Qt.TOKEN_EXPIRE),this.safeEmit(Nt.ON_TOKEN_PRIVILEGE_DID_EXPIRE),this._reset()})),this._gateway.signal.on(Pt.ON_STREAM_FALLBACK_UPDATE,(e=>{R.debug("[".concat(this._clientId,"] stream fallback peerId: ").concat(e.stream_id,", attr: ").concat(e.stream_type)),this.safeEmit(Nt.STREAM_FALLBACK,e.stream_id,e.stream_type===1?"fallback":"recover")})),this._gateway.signal.on(Pt.ON_PUBLISH_STREAM,(e=>{this.uid===this._uid&&(this._p2pChannel.reportPublishEvent(!0,null,void 0,!1,JSON.stringify({proxy:e.proxy})),R.info("[".concat(this._clientId,"] on publish stream, ").concat(JSON.stringify(e))))})),this._gateway.signal.on(Pt.ENABLE_LOCAL_VIDEO,(e=>{this._handleSetStreamLocalEnable("video",e.uid,!0)})),this._gateway.signal.on(Pt.DISABLE_LOCAL_VIDEO,(e=>{this._handleSetStreamLocalEnable("video",e.uid,!1)})),this._gateway.signal.on(at.REQUEST_TIMEOUT,((e,t)=>{if(this._joinInfo)switch(e){case st.PUBLISH:{if(!t)return;const i=t.ortc;if(i){var n,r;const s=i.some((l=>{let{stream_type:h}=l;return h===en.Audio})),o=i.some((l=>{let{stream_type:h}=l;return h!==en.Audio})),c=i.some((l=>{let{stream_type:h}=l;return h===en.Screen||h===en.ScreenLow}));t.state==="offer"&&We.publish(this._joinInfo.sid,{eventElapse:Qr.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:!1,ec:U.TIMEOUT,audio:s,video:o,p2pid:t.p2p_id,publishRequestid:this.store.pubId,screenshare:c,audioName:s?(n=i.find((l=>{let{stream_type:h}=l;return h===en.Audio})))===null||n===void 0||(n=n.ssrcs[0])===null||n===void 0?void 0:n.ssrcId.toString():void 0,videoName:o?(r=i.find((l=>{let{stream_type:h}=l;return h!==en.Audio})))===null||r===void 0||(r=r.ssrcs[0])===null||r===void 0?void 0:r.ssrcId.toString():void 0})}break}case st.SUBSCRIBE:t&&We.subscribe(this._joinInfo.sid,{succ:!1,ec:U.TIMEOUT,audio:t.stream_type===Le.AUDIO,video:t.stream_type===Le.VIDEO,peerid:t.stream_id,subscribeRequestid:t.ssrcId,p2pid:this.store.p2pId,eventElapse:Qr.measureFromSubscribeStart(this.store.clientId,t.ssrcId),preSsrc:this._p2pChannel.isPreSubScribe(t.ssrcId)})}})),this._gateway.signal.on(Pt.ON_P2P_OK,(e=>{this.uid,this._uid})),this._gateway.signal.on(Pt.ON_PUBLISHED_USER_LIST,(e=>{if(e==null||!e.users)return;F("BLOCK_LOCAL_CLIENT")&&(e.users=e.users.filter((r=>!Ch(r.string_id||r.stream_id,this.channelName))));const t=[],n=[];for(const r of e.users){let i=this._users.find((p=>p._uintid===r.stream_id));i?i._trust_in_room_=!0:(i=new Ud(r.string_id||r.stream_id,r.stream_id),this._users.push(i),this.store.firstVideoFrameDecoded(i.uid,{userJoinNotify:Date.now()}),this.getListeners(Nt.PUBLISHED_USER_LIST).length===0&&(R.debug("[".concat(this._clientId,"] user online"),r.stream_id),this.safeEmit(Nt.USER_JOINED,i)));const s=gr.Audio&r.stream_type,o=(gr.Video|gr.LwoVideo)&r.stream_type,c=(65280&r.stream_type)!=0,l=s&&i.hasAudio,h=o&&i.hasVideo;o&&(i._trust_video_stream_added_state_=!0,i._video_added_=!0,i._videoSSRC=r.video_ssrc,i._rtxSsrcId=r.video_rtx),s&&(i._trust_audio_stream_added_state_=!0,i._audio_added_=!0,i._audioSSRC=r.audio_ssrc),s&&!l&&this.getListeners(Nt.PUBLISHED_USER_LIST).length===0&&(R.info("[".concat(this._clientId,"] remote user ").concat(i.uid," published audio")),this.safeEmit(Nt.USER_PUBLISHED,i,"audio")),o&&!h&&this.getListeners(Nt.PUBLISHED_USER_LIST).length===0&&(R.info("[".concat(this._clientId,"] remote user ").concat(i.uid," published video")),this.safeEmit(Nt.USER_PUBLISHED,i,"video")),(s&&!l||o&&!h||c)&&t.push(i),o&&this._p2pChannel.hasPendingRemoteMedia(i,"video")&&n.push({user:i,mediaType:"video"}),s&&this._p2pChannel.hasPendingRemoteMedia(i,"audio")&&n.push({user:i,mediaType:"audio"})}n.length>0&&(R.debug("[".concat(this._clientId,"] RE massSubscribe after reconnect ").concat(n.map((r=>"user: ".concat(r.user.uid,", mediaType: ").concat(r.mediaType))).join("; ")," ")),this.massSubscribe(n).catch((r=>{R.error("[".concat(this._clientId,"] mass resubscribe error"),r.toString())}))),this.getListeners(Nt.PUBLISHED_USER_LIST).length>0?F("ENABLE_DATASTREAM_2")?this._pendingPublishedUsers=t:(R.info("[".concat(this._clientId,"] client emit user-list event, users: ").concat(t.map((r=>r.uid)).join(", "))),this.safeEmit(Nt.PUBLISHED_USER_LIST,t)):R.info("[".concat(this._clientId,"] client not emit user-list event case there is no user-list listener, users: ").concat(t.map((r=>r.uid)).join(", ")))})),this._gateway.signal.on(Pt.ON_RTP_CAPABILITY_CHANGE,(e=>{const{video_codec:t}=e;this._p2pChannel instanceof sg&&this._p2pChannel.updateRemoteRTPCapabilities(t.map((n=>n.toLowerCase())).filter((n=>{var r;return Re(r=Object.keys(WE)).call(r,n)})))}))}_handleP2PEvents(){this._gateway.signal.on(Pt.ON_USER_OFFLINE,(()=>{this._p2pChannel.disconnectForReconnect()})),this._gateway.signal.on(Hn.PUBLISH,((e,t,n)=>{const{uid:r}=e;e.forEach((i=>{const{kind:s,ssrcs:o,mid:c,isMuted:l}=i;this._handleP2PAddAudioOrVideoStream(s,r,o[0].ssrcId,c);const h=this._users.find((p=>p.uid===r));return h&&this.store.useP2P?this._p2pChannel.mockSubscribe(h,s,o[0].ssrcId,c).then((()=>{t()})).catch(n):t(),this._handleMuteStream(r,s,!!l)}))})),this._gateway.signal.on(Hn.CALL,(async(e,t,n)=>{if(this.store.useP2P)try{var r;t(await this._p2pChannel.startP2P({turnServer:(r=this._joinInfo)===null||r===void 0?void 0:r.turnServer},e))}catch(i){n(i)}})),this._gateway.signal.on(at.P2P_CONNECTION,(async e=>{this.store.useP2P&&(await this._p2pChannel).p2pConnect(e)})),this._gateway.signal.on(Hn.UNPUBLISH,(async(e,t,n)=>{if(this.store.useP2P){const{unpubMsg:r,uid:i}=e,s=this._users.find((o=>o.uid===i));if(!s)return R.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(i)),void t();try{r.forEach((async o=>{let{stream_type:c}=o;const l=c===en.Audio?Le.AUDIO:Le.VIDEO;await this._p2pChannel.unsubscribe(s,l),this._handleMuteStream(i,l,!0)})),t()}catch(o){n(o)}}})),this._gateway.signal.on(Hn.CONTROL,(async(e,t)=>{const{action:n}=e;switch(n){case Od.MUTE_LOCAL_VIDEO:this._handleMuteStream(t,Le.VIDEO,!0);break;case Od.MUTE_LOCAL_AUDIO:this._handleMuteStream(t,Le.AUDIO,!0);break;case Od.UNMUTE_LOCAL_VIDEO:this._handleP2PAddAudioOrVideoStream("video",t),this._handleMuteStream(t,Le.VIDEO,!1);break;case Od.UNMUTE_LOCAL_AUDIO:this._handleP2PAddAudioOrVideoStream("audio",t),this._handleMuteStream(t,Le.AUDIO,!1)}})),this._gateway.signal.on(Hn.RESTART_ICE,(async(e,t,n)=>{if(this.store.useP2P)try{const{direction:r,iceParameter:i}=e;r!==Ii.SEND_ONLY||i?t(await this._p2pChannel.restartICE(r,i)):(this._p2pChannel.handleDisconnect(r),t())}catch(r){n(r)}})),this._gateway.signal.on(Hn.CANDIDATE,(e=>{if(this.store.useP2P){const{candidate:t,direction:n}=e;this._p2pChannel.addRemoteCandidate(t,n)}})),this._p2pChannel.on(Xe.RequestP2PRestartICE,(async(e,t,n)=>{try{const{direction:r}=e;t(await this._gateway.sendExtensionMessage(Hn.RESTART_ICE,e,r===Ii.SEND_ONLY))}catch(r){n(r)}})),this._p2pChannel.on(Xe.LocalCandidate,(e=>{this._gateway.sendExtensionMessage(Hn.CANDIDATE,JSON.stringify(e),!0)})),this._p2pChannel.on(Xe.RequestP2PMuteLocal,(async(e,t,n)=>{try{await this._gateway.sendExtensionMessage(Hn.CONTROL,e,!0),t()}catch(r){n(r)}})),this._p2pChannel.on(Xe.RequestP2PUnmuteRemote,(async(e,t,n)=>{if(this._joinInfo)try{await this._gateway.unmuteRemote(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(r){r.code===U.DISCONNECT_P2P?t():n(r)}else t()})),this._p2pChannel.on(Xe.RequestP2PMuteRemote,(async(e,t,n)=>{if(this._joinInfo)try{await this._gateway.muteRemote(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(r){r.code===U.DISCONNECT_P2P?t():n(r)}else t()})),this._p2pChannel.on(Xe.StateChange,((e,t)=>{t===Zt.Connected&&this._p2pChannel.republish()}))}_handleP2PChannelEvents(){this._p2pChannel.on(Xe.PeerConnectionStateChange,(e=>{const t=this._peerConnectionState;e!==t&&(this.safeEmit(Nt.PEERCONNECTION_STATE_CHANGE,e,t),this._peerConnectionState=e)})),this._p2pChannel.on(Xe.RequestMuteLocal,(async(e,t,n)=>{if(this._joinInfo)try{await this._gateway.muteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(r){r.code===U.DISCONNECT_P2P?t():n(r)}else t()})),this._p2pChannel.on(Xe.RequestUnmuteLocal,(async(e,t,n)=>{if(this._joinInfo)try{await this._gateway.unmuteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(r){r.code===U.DISCONNECT_P2P?t():n(r)}else t()})),this._p2pChannel.on(Xe.RequestRePublish,((e,t,n)=>{this.publish(e,!1).then(t).catch(n)})),this._p2pChannel.on(Xe.RequestRePublishDataChannel,((e,t,n)=>{Pe.all(e.map((async r=>{const i=await this._p2pChannel.publishDataChannel([r]);try{i.forEach((s=>{this._uid&&this._gateway.publishDataChannel(this._uid,s,!0)}))}catch(s){if(s.code!==U.DISCONNECT_P2P)throw s}}))).then(t).catch(n)})),this._p2pChannel.on(Xe.RequestReSubscribe,(async(e,t,n)=>{try{for(const{user:r,kind:i}of e)i===Le.VIDEO?await this.subscribe(r,"video"):await this.subscribe(r,"audio");t()}catch(r){n(r)}})),this._p2pChannel.on(Xe.RequestUpload,((e,t)=>{this._gateway.upload(e,t)})),this._p2pChannel.on(Xe.RequestUploadStats,(e=>{this._gateway.uploadWRTCStats(e)})),this._p2pChannel.on(Xe.MediaReconnectStart,(e=>{this.safeEmit(Nt.MEDIA_RECONNECT_START,e)})),this._p2pChannel.on(Xe.MediaReconnectEnd,(e=>{this.safeEmit(Nt.MEDIA_RECONNECT_END,e)})),this._p2pChannel.on(Xe.NeedSignalRTT,(e=>{e(this._gateway.getSignalRTT())})),this._p2pChannel.on(Xe.RequestRestartICE,(async e=>{if(this.store.useP2P)return;const t=await this._p2pChannel.restartICE(e),n=await t.next();if(n.done)return;const r=n.value;let i;try{i=await this._gateway.restartICE({iceParameters:r})}catch(o){return void t.throw(o)}const{iceParameters:s}=(function(o){const c=o.iceParameters;return{iceParameters:{iceUfrag:c.iceUfrag,icePwd:c.icePwd}}})(i);await t.next({remoteIceParameters:s})})),this._p2pChannel.on(Xe.RequestReconnect,(async()=>{this._gateway.reconnect()})),this._p2pChannel.on(Xe.RequestReconnectPC,(async()=>{var e;const{iceParameters:t,dtlsParameters:n,rtpCapabilities:r}=await this._p2pChannel.startP2PConnection({turnServer:(e=this._joinInfo)===null||e===void 0?void 0:e.turnServer}),{gatewayEstablishParams:i,gatewayAddress:s}=await this._gateway.reconnectPC({iceParameters:t,dtlsParameters:n,rtpCapabilities:r}),o=QM(i,s);await this._p2pChannel.connect(o),await this._p2pChannel.republish(),await this._p2pChannel.reSubscribe()})),this._p2pChannel.on(Xe.RequestUnpublishForReconnectPC,(async(e,t,n)=>{this._joinInfo&&this._uid!==void 0?(await this._gateway.unpublish(e,this._uid),t()):n()})),this._p2pChannel.on(Xe.P2PLost,(()=>{this.safeEmit(Nt.P2P_LOST,this.store.uid)})),this._p2pChannel.on(Xe.UpdateVideoEncoder,(e=>{e._encoderConfig&&this._gateway.setVideoProfile(e._encoderConfig)})),this._p2pChannel.on(Xe.ConnectionTypeChange,(e=>{this.safeEmit(Nt.IS_USING_CLOUD_PROXY,e)})),this._p2pChannel.on(Xe.RequestLowStreamParameter,(e=>{e(this._lowStreamParameter||{width:160,height:120,framerate:15,bitrate:50})})),this._p2pChannel.on(Xe.QueryClientConnectionState,(e=>{e(this.connectionState)})),this._p2pChannel.on(Xe.AudioMetadata,(e=>{this.safeEmit(Nt.AUDIO_METADATA,e)})),this._p2pChannel.on(Xe.AudioPts,(e=>{this.safeEmit(Nt.AUDIO_PTS,Number(e))}))}getKeyMetrics(){return this.store.keyMetrics}async enableContentInspect(e){if(!this._joinInfo||this.connectionState!=="CONNECTED")throw new se(U.INVALID_OPERATION,"[".concat(this._clientId,"] can not create content inspect, please join channel first"));if(this._inspect)throw new se(U.INVALID_OPERATION,"[".concat(this._clientId,"] Inspect content service already in connecting/connected state"));try{const n=(t={config:e},yl("ContentInspect").create(t));this._inspect=n,this.handleVideoInspectEvents(n);const{appId:r,cname:i,sid:s,token:o,uid:c,cid:l,vid:h}=this._joinInfo;await n.init({appId:r,areaCode:"",cname:i,sid:s,token:o,uid:c,cid:l,vid:h?Number(h):0},rr)}catch(n){throw Array.isArray(n)?n[0]:n}var t}handleVideoInspectEvents(e){e.on(wr.CONNECTION_STATE_CHANGE,((t,n)=>{if(this.safeEmit(Nt.CONTENT_INSPECT_CONNECTION_STATE_CHANGE,t,n),n===Go.CONNECTED){if(this.connectionState!=="CONNECTED")return void this.safeEmit(Nt.CONTENT_INSPECT_ERROR,new se(U.OPERATION_ABORTED,"Content inspect was cancelled because it left the channel"));e.inspectImage()}})),e.on(wr.INSPECT_RESULT,((t,n)=>{var r;if(n?.code===U.INVALID_OPERATION&&this.connectionState==="DISCONNECTED")return R.debug("Stop inspect content because that has left channel"),this==null||(r=this._inspect)===null||r===void 0||r.close(),void(this._inspect=void 0);this.safeEmit(Nt.CONTENT_INSPECT_RESULT,t,n)})),e.on(wr.CLIENT_LOCAL_VIDEO_TRACK,(t=>{t(this.localTracks.filter((n=>n.trackMediaType==="video"))[0])}))}async disableContentInspect(){if(!this._inspect)throw new se(U.INVALID_OPERATION,"[".concat(this._clientId,"] inspectVideoContent not started"));try{this._inspect.close(),this._inspect=void 0}catch(e){throw Array.isArray(e)?e[0]:e}}async setImageModeration(e,t){if(Sa(e,"enabled"),e){if(!t)throw new se(U.INVALID_PARAMS,"config is required");if(hU(t),!this._joinInfo)throw new se(U.INVALID_OPERATION,"can not create image moderation, please join channel first");try{if(this._moderation)this._moderation.updateConfig(t);else{const r=(n={config:t},yl("ImageModeration").create(n));this._moderation=r,this.handleImageModerationEvents(r);const{appId:i,cname:s,sid:o,token:c,uid:l,cid:h,vid:p}=this._joinInfo;await r.init({appId:i,areaCode:"",cname:s,sid:o,token:c,uid:l,cid:h,vid:p?Number(p):0},rr)}}catch(r){throw Array.isArray(r)?r[0]:r}}else{var n;if(!this._moderation)throw new se(U.INVALID_OPERATION,"[".concat(this._clientId,"] image moderation not started"));try{this._moderation.close(),this._moderation.removeAllListeners(),this._moderation=void 0}catch(r){throw Array.isArray(r)?r[0]:r}}}handleImageModerationEvents(e){e.on(ba.CONNECTION_STATE_CHANGE,((t,n)=>{if(this.safeEmit(Nt.IMAGE_MODERATION_CONNECTION_STATE_CHANGE,t,n),t===so.CONNECTED){if(this.connectionState!=="CONNECTED")throw this.setImageModeration(!1),new se(U.OPERATION_ABORTED,"Image moderation was cancelled because it left the channel");e.inspectImage()}})),e.on(ba.CLIENT_LOCAL_VIDEO_TRACK,(t=>{t(this.localTracks.filter((n=>n.trackMediaType==="video"))[0])}))}setP2PTransport(e){if((function(t){hr(t,"transport",["default","auto","relay","sd-rtn"])})(e),this.mode!=="p2p")throw new se(U.INVALID_OPERATION,"only p2p mode can set p2pTransport");this.store.p2pTransport=e,R.info("[".concat(this._clientId,"] set client p2pTransport to ").concat(e))}getJoinChannelServiceRecords(){return R.debug("getJoinChannelServiceRecords"),this.store.joinChannelServiceRecords}async setPublishAudioFilterEnabled(e){Sa(e,"enabled"),nn("ENABLE_PUBLISH_AUDIO_FILTER",e),this._joinInfo&&await this._gateway.setPublishAudioFilterEnabled(e)}_handleResetAddStream(e,t){switch(t){case"audio":e._audio_added_=!1,e._trust_audio_stream_added_state_=!0;break;case"video":e._video_added_=!1,e._trust_video_stream_added_state_=!0}}},Be(De.prototype,"leave",[pU],Object.getOwnPropertyDescriptor(De.prototype,"leave"),De.prototype),Be(De.prototype,"publish",[fU],Object.getOwnPropertyDescriptor(De.prototype,"publish"),De.prototype),Be(De.prototype,"unpublish",[mU],Object.getOwnPropertyDescriptor(De.prototype,"unpublish"),De.prototype),Be(De.prototype,"subscribe",[_U],Object.getOwnPropertyDescriptor(De.prototype,"subscribe"),De.prototype),Be(De.prototype,"presubscribe",[EU],Object.getOwnPropertyDescriptor(De.prototype,"presubscribe"),De.prototype),Be(De.prototype,"massSubscribe",[gU],Object.getOwnPropertyDescriptor(De.prototype,"massSubscribe"),De.prototype),Be(De.prototype,"unsubscribe",[vU],Object.getOwnPropertyDescriptor(De.prototype,"unsubscribe"),De.prototype),Be(De.prototype,"massUnsubscribe",[yU],Object.getOwnPropertyDescriptor(De.prototype,"massUnsubscribe"),De.prototype),Be(De.prototype,"setLowStreamParameter",[SU],Object.getOwnPropertyDescriptor(De.prototype,"setLowStreamParameter"),De.prototype),Be(De.prototype,"enableDualStream",[TU],Object.getOwnPropertyDescriptor(De.prototype,"enableDualStream"),De.prototype),Be(De.prototype,"disableDualStream",[RU],Object.getOwnPropertyDescriptor(De.prototype,"disableDualStream"),De.prototype),Be(De.prototype,"setClientRole",[CU],Object.getOwnPropertyDescriptor(De.prototype,"setClientRole"),De.prototype),Be(De.prototype,"_setClientRoleOptions",[wU],Object.getOwnPropertyDescriptor(De.prototype,"_setClientRoleOptions"),De.prototype),Be(De.prototype,"setProxyServer",[bU],Object.getOwnPropertyDescriptor(De.prototype,"setProxyServer"),De.prototype),Be(De.prototype,"setTurnServer",[IU],Object.getOwnPropertyDescriptor(De.prototype,"setTurnServer"),De.prototype),Be(De.prototype,"setLicense",[AU],Object.getOwnPropertyDescriptor(De.prototype,"setLicense"),De.prototype),Be(De.prototype,"startProxyServer",[NU],Object.getOwnPropertyDescriptor(De.prototype,"startProxyServer"),De.prototype),Be(De.prototype,"stopProxyServer",[OU],Object.getOwnPropertyDescriptor(De.prototype,"stopProxyServer"),De.prototype),Be(De.prototype,"setLocalAccessPointsV2",[PU],Object.getOwnPropertyDescriptor(De.prototype,"setLocalAccessPointsV2"),De.prototype),Be(De.prototype,"setLocalAccessPoints",[DU],Object.getOwnPropertyDescriptor(De.prototype,"setLocalAccessPoints"),De.prototype),Be(De.prototype,"setRemoteDefaultVideoStreamType",[kU],Object.getOwnPropertyDescriptor(De.prototype,"setRemoteDefaultVideoStreamType"),De.prototype),Be(De.prototype,"setRemoteVideoStreamType",[LU],Object.getOwnPropertyDescriptor(De.prototype,"setRemoteVideoStreamType"),De.prototype),Be(De.prototype,"setStreamFallbackOption",[xU],Object.getOwnPropertyDescriptor(De.prototype,"setStreamFallbackOption"),De.prototype),Be(De.prototype,"setEncryptionConfig",[MU],Object.getOwnPropertyDescriptor(De.prototype,"setEncryptionConfig"),De.prototype),Be(De.prototype,"renewToken",[UU],Object.getOwnPropertyDescriptor(De.prototype,"renewToken"),De.prototype),Be(De.prototype,"enableAudioVolumeIndicator",[VU],Object.getOwnPropertyDescriptor(De.prototype,"enableAudioVolumeIndicator"),De.prototype),Be(De.prototype,"startLiveStreaming",[jU],Object.getOwnPropertyDescriptor(De.prototype,"startLiveStreaming"),De.prototype),Be(De.prototype,"setLiveTranscoding",[FU],Object.getOwnPropertyDescriptor(De.prototype,"setLiveTranscoding"),De.prototype),Be(De.prototype,"stopLiveStreaming",[BU],Object.getOwnPropertyDescriptor(De.prototype,"stopLiveStreaming"),De.prototype),Be(De.prototype,"startChannelMediaRelay",[WU],Object.getOwnPropertyDescriptor(De.prototype,"startChannelMediaRelay"),De.prototype),Be(De.prototype,"updateChannelMediaRelay",[GU],Object.getOwnPropertyDescriptor(De.prototype,"updateChannelMediaRelay"),De.prototype),Be(De.prototype,"stopChannelMediaRelay",[HU],Object.getOwnPropertyDescriptor(De.prototype,"stopChannelMediaRelay"),De.prototype),Be(De.prototype,"sendCustomReportMessage",[KU],Object.getOwnPropertyDescriptor(De.prototype,"sendCustomReportMessage"),De.prototype),Be(De.prototype,"pickSVCLayer",[zU],Object.getOwnPropertyDescriptor(De.prototype,"pickSVCLayer"),De.prototype),Be(De.prototype,"setRTMConfig",[YU],Object.getOwnPropertyDescriptor(De.prototype,"setRTMConfig"),De.prototype),Be(De.prototype,"enableContentInspect",[qU],Object.getOwnPropertyDescriptor(De.prototype,"enableContentInspect"),De.prototype),Be(De.prototype,"disableContentInspect",[XU],Object.getOwnPropertyDescriptor(De.prototype,"disableContentInspect"),De.prototype),Be(De.prototype,"setImageModeration",[JU],Object.getOwnPropertyDescriptor(De.prototype,"setImageModeration"),De.prototype),Be(De.prototype,"setP2PTransport",[QU],Object.getOwnPropertyDescriptor(De.prototype,"setP2PTransport"),De.prototype),Be(De.prototype,"getJoinChannelServiceRecords",[ZU],Object.getOwnPropertyDescriptor(De.prototype,"getJoinChannelServiceRecords"),De.prototype),Be(De.prototype,"setPublishAudioFilterEnabled",[$U],Object.getOwnPropertyDescriptor(De.prototype,"setPublishAudioFilterEnabled"),De.prototype),De);class cg{constructor(t,n){k(this,"id",0),k(this,"element",void 0),k(this,"peerPair",void 0),k(this,"context",void 0),k(this,"audioPlayerElement",void 0),k(this,"audioTrack",void 0),cg.count+=1,this.id=cg.count,this.element=t,this.context=n}initPeers(){this.peerPair=[new RTCPeerConnection,new RTCPeerConnection],this.peerPair[1].ontrack=t=>{const n=document.createElement("audio");n.srcObject=new MediaStream([t.track]),n.play(),this.audioPlayerElement=n}}async switchSdp(){if(!this.peerPair)return;const t=async(r,i)=>{const s=i==="offer"?await r.createOffer():await r.createAnswer();return await r.setLocalDescription(s),r.iceGatheringState==="complete"?r.localDescription:new Pe((o=>{r.onicegatheringstatechange=()=>{r.iceGatheringState==="complete"&&o(r.localDescription)}}))},n=async(r,i)=>await r.setRemoteDescription(i);try{const r=await t(this.peerPair[0],"offer");await n(this.peerPair[1],r);const i=await t(this.peerPair[1],"answer");await n(this.peerPair[0],i)}catch(r){throw new se(U.LOCAL_AEC_ERROR,r.toString()).print()}}async getTracksFromMediaElement(t){if(this.audioTrack)return this.audioTrack;let n;try{t instanceof HTMLVideoElement&&(t.captureStream?t.captureStream():t.mozCaptureStream()),n=this.context.createMediaStreamDestination(),this.context.createMediaElementSource(t).connect(n)}catch(i){throw new se(U.LOCAL_AEC_ERROR,i.toString()).print()}if(!n)throw new se(U.LOCAL_AEC_ERROR,"no dest node when local aec").print();const r=n.stream.getAudioTracks()[0];return this.audioTrack=r,r}getElement(){return this.element}async startEchoCancellation(){this.context.resume(),this.peerPair&&this.close(),this.initPeers();const t=this.element,n=await this.getTracksFromMediaElement(t);this.peerPair&&this.peerPair[0].addTrack(n),await this.switchSdp()}close(){R.debug("close echo cancellation unit, id is",this.id),this.audioPlayerElement&&this.audioPlayerElement.pause(),this.peerPair&&this.peerPair.forEach((t=>{t.close()})),this.peerPair=void 0,this.audioPlayerElement=void 0}}var tV,NT;k(cg,"count",0);const $9=window.AudioContext||window.webkitAudioContext,e7=new(tV=et({report:We}),Be((NT=class{constructor(){k(this,"units",[]),k(this,"context",void 0)}processExternalMediaAEC(e){if(!this._doesEnvironmentNeedAEC())return R.debug("the system does not need to process local aec"),-1;this.context||(this.context=new $9);let t=this.units.find((n=>n&&n.getElement()===e));return t||(t=new cg(e,this.context),this.units.push(t)),t.startEchoCancellation(),R.debug("start processing local audio echo cancellation, id is",t.id),t.id}_doesEnvironmentNeedAEC(){return xt().name!==Gt.SAFARI}}).prototype,"processExternalMediaAEC",[tV],Object.getOwnPropertyDescriptor(NT.prototype,"processExternalMediaAEC"),NT.prototype),NT);function nV(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable}))),n.push.apply(n,r)}return n}function rV(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?nV(Object(n),!0).forEach((function(r){k(e,r,n[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):nV(Object(n)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))}))}return e}const CI=window||document;function iV(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];if(!CI)return;const n=ir._cspEventHandlerPointer;if(n&&t)return void console.error(n,t);const r=i=>{if(!(i&&i.blockedURI&&(ir.onSecurityPolicyViolation||ir.getListeners(bc.SECURITY_POLICY_VIOLATION).length>0)))return;const s=i.blockedURI;F("CSP_DETECTED_HOSTNAME_LIST").some((o=>Re(s).call(s,o)))&&(ir.onSecurityPolicyViolation&&typeof ir.onSecurityPolicyViolation=="function"&&ir.onSecurityPolicyViolation(i),ir.getListeners(bc.SECURITY_POLICY_VIOLATION).length>0&&ir.safeEmit(bc.SECURITY_POLICY_VIOLATION,i))};n&&CI.removeEventListener("securitypolicyviolation",n),(t||e&&typeof e=="function"||ir.getListeners(bc.SECURITY_POLICY_VIOLATION).length>0)&&CI.addEventListener("securitypolicyviolation",r),ir._cspEventHandlerPointer=r}var t7=ee,n7=jk,sV=RegExp.prototype,r7=function(e){return e===sV||t7(sV,e)?n7(e):e.flags},_i=C(r7);function $f(e){let t=e.length;for(;--t>=0;)e[t]=0}const wI=256,oV=286,lg=30,dg=15,bI=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),OT=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),i7=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),aV=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Tl=new Array(576);$f(Tl);const ug=new Array(60);$f(ug);const hg=new Array(512);$f(hg);const pg=new Array(256);$f(pg);const II=new Array(29);$f(II);const PT=new Array(lg);function AI(e,t,n,r,i){this.static_tree=e,this.extra_bits=t,this.extra_base=n,this.elems=r,this.max_length=i,this.has_stree=e&&e.length}let cV,lV,dV;function NI(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}$f(PT);const uV=e=>e<256?hg[e]:hg[256+(e>>>7)],fg=(e,t)=>{e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255},Us=(e,t,n)=>{e.bi_valid>16-n?(e.bi_buf|=t<<e.bi_valid&65535,fg(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=n-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=n)},Nc=(e,t,n)=>{Us(e,n[2*t],n[2*t+1])},hV=(e,t)=>{let n=0;do n|=1&e,e>>>=1,n<<=1;while(--t>0);return n>>>1},pV=(e,t,n)=>{const r=new Array(16);let i,s,o=0;for(i=1;i<=dg;i++)o=o+n[i-1]<<1,r[i]=o;for(s=0;s<=t;s++){let c=e[2*s+1];c!==0&&(e[2*s]=hV(r[c]++,c))}},fV=e=>{let t;for(t=0;t<oV;t++)e.dyn_ltree[2*t]=0;for(t=0;t<lg;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.sym_next=e.matches=0},mV=e=>{e.bi_valid>8?fg(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},_V=(e,t,n,r)=>{const i=2*t,s=2*n;return e[i]<e[s]||e[i]===e[s]&&r[t]<=r[n]},OI=(e,t,n)=>{const r=e.heap[n];let i=n<<1;for(;i<=e.heap_len&&(i<e.heap_len&&_V(t,e.heap[i+1],e.heap[i],e.depth)&&i++,!_V(t,r,e.heap[i],e.depth));)e.heap[n]=e.heap[i],n=i,i<<=1;e.heap[n]=r},EV=(e,t,n)=>{let r,i,s,o,c=0;if(e.sym_next!==0)do r=255&e.pending_buf[e.sym_buf+c++],r+=(255&e.pending_buf[e.sym_buf+c++])<<8,i=e.pending_buf[e.sym_buf+c++],r===0?Nc(e,i,t):(s=pg[i],Nc(e,s+wI+1,t),o=bI[s],o!==0&&(i-=II[s],Us(e,i,o)),r--,s=uV(r),Nc(e,s,n),o=OT[s],o!==0&&(r-=PT[s],Us(e,r,o)));while(c<e.sym_next);Nc(e,256,t)},PI=(e,t)=>{const n=t.dyn_tree,r=t.stat_desc.static_tree,i=t.stat_desc.has_stree,s=t.stat_desc.elems;let o,c,l,h=-1;for(e.heap_len=0,e.heap_max=573,o=0;o<s;o++)n[2*o]!==0?(e.heap[++e.heap_len]=h=o,e.depth[o]=0):n[2*o+1]=0;for(;e.heap_len<2;)l=e.heap[++e.heap_len]=h<2?++h:0,n[2*l]=1,e.depth[l]=0,e.opt_len--,i&&(e.static_len-=r[2*l+1]);for(t.max_code=h,o=e.heap_len>>1;o>=1;o--)OI(e,n,o);l=s;do o=e.heap[1],e.heap[1]=e.heap[e.heap_len--],OI(e,n,1),c=e.heap[1],e.heap[--e.heap_max]=o,e.heap[--e.heap_max]=c,n[2*l]=n[2*o]+n[2*c],e.depth[l]=(e.depth[o]>=e.depth[c]?e.depth[o]:e.depth[c])+1,n[2*o+1]=n[2*c+1]=l,e.heap[1]=l++,OI(e,n,1);while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],((p,E)=>{const g=E.dyn_tree,v=E.max_code,O=E.stat_desc.static_tree,I=E.stat_desc.has_stree,N=E.stat_desc.extra_bits,M=E.stat_desc.extra_base,x=E.stat_desc.max_length;let B,Z,Q,z,te,de,me=0;for(z=0;z<=dg;z++)p.bl_count[z]=0;for(g[2*p.heap[p.heap_max]+1]=0,B=p.heap_max+1;B<573;B++)Z=p.heap[B],z=g[2*g[2*Z+1]+1]+1,z>x&&(z=x,me++),g[2*Z+1]=z,Z>v||(p.bl_count[z]++,te=0,Z>=M&&(te=N[Z-M]),de=g[2*Z],p.opt_len+=de*(z+te),I&&(p.static_len+=de*(O[2*Z+1]+te)));if(me!==0){do{for(z=x-1;p.bl_count[z]===0;)z--;p.bl_count[z]--,p.bl_count[z+1]+=2,p.bl_count[x]--,me-=2}while(me>0);for(z=x;z!==0;z--)for(Z=p.bl_count[z];Z!==0;)Q=p.heap[--B],Q>v||(g[2*Q+1]!==z&&(p.opt_len+=(z-g[2*Q+1])*g[2*Q],g[2*Q+1]=z),Z--)}})(e,t),pV(n,h,e.bl_count)},gV=(e,t,n)=>{let r,i,s=-1,o=t[1],c=0,l=7,h=4;for(o===0&&(l=138,h=3),t[2*(n+1)+1]=65535,r=0;r<=n;r++)i=o,o=t[2*(r+1)+1],++c<l&&i===o||(c<h?e.bl_tree[2*i]+=c:i!==0?(i!==s&&e.bl_tree[2*i]++,e.bl_tree[32]++):c<=10?e.bl_tree[34]++:e.bl_tree[36]++,c=0,s=i,o===0?(l=138,h=3):i===o?(l=6,h=3):(l=7,h=4))},vV=(e,t,n)=>{let r,i,s=-1,o=t[1],c=0,l=7,h=4;for(o===0&&(l=138,h=3),r=0;r<=n;r++)if(i=o,o=t[2*(r+1)+1],!(++c<l&&i===o)){if(c<h)do Nc(e,i,e.bl_tree);while(--c!=0);else i!==0?(i!==s&&(Nc(e,i,e.bl_tree),c--),Nc(e,16,e.bl_tree),Us(e,c-3,2)):c<=10?(Nc(e,17,e.bl_tree),Us(e,c-3,3)):(Nc(e,18,e.bl_tree),Us(e,c-11,7));c=0,s=i,o===0?(l=138,h=3):i===o?(l=6,h=3):(l=7,h=4)}};let yV=!1;const SV=(e,t,n,r)=>{Us(e,0+(r?1:0),3),mV(e),fg(e,n),fg(e,~n),n&&e.pending_buf.set(e.window.subarray(t,t+n),e.pending),e.pending+=n};var s7=e=>{yV||((()=>{let t,n,r,i,s;const o=new Array(16);for(r=0,i=0;i<28;i++)for(II[i]=r,t=0;t<1<<bI[i];t++)pg[r++]=i;for(pg[r-1]=i,s=0,i=0;i<16;i++)for(PT[i]=s,t=0;t<1<<OT[i];t++)hg[s++]=i;for(s>>=7;i<lg;i++)for(PT[i]=s<<7,t=0;t<1<<OT[i]-7;t++)hg[256+s++]=i;for(n=0;n<=dg;n++)o[n]=0;for(t=0;t<=143;)Tl[2*t+1]=8,t++,o[8]++;for(;t<=255;)Tl[2*t+1]=9,t++,o[9]++;for(;t<=279;)Tl[2*t+1]=7,t++,o[7]++;for(;t<=287;)Tl[2*t+1]=8,t++,o[8]++;for(pV(Tl,287,o),t=0;t<lg;t++)ug[2*t+1]=5,ug[2*t]=hV(t,5);cV=new AI(Tl,bI,257,oV,dg),lV=new AI(ug,OT,0,lg,dg),dV=new AI(new Array(0),i7,0,19,7)})(),yV=!0),e.l_desc=new NI(e.dyn_ltree,cV),e.d_desc=new NI(e.dyn_dtree,lV),e.bl_desc=new NI(e.bl_tree,dV),e.bi_buf=0,e.bi_valid=0,fV(e)},o7=(e,t,n,r)=>{let i,s,o=0;e.level>0?(e.strm.data_type===2&&(e.strm.data_type=(c=>{let l,h=4093624447;for(l=0;l<=31;l++,h>>>=1)if(1&h&&c.dyn_ltree[2*l]!==0)return 0;if(c.dyn_ltree[18]!==0||c.dyn_ltree[20]!==0||c.dyn_ltree[26]!==0)return 1;for(l=32;l<wI;l++)if(c.dyn_ltree[2*l]!==0)return 1;return 0})(e)),PI(e,e.l_desc),PI(e,e.d_desc),o=(c=>{let l;for(gV(c,c.dyn_ltree,c.l_desc.max_code),gV(c,c.dyn_dtree,c.d_desc.max_code),PI(c,c.bl_desc),l=18;l>=3&&c.bl_tree[2*aV[l]+1]===0;l--);return c.opt_len+=3*(l+1)+5+5+4,l})(e),i=e.opt_len+3+7>>>3,s=e.static_len+3+7>>>3,s<=i&&(i=s)):i=s=n+5,n+4<=i&&t!==-1?SV(e,t,n,r):e.strategy===4||s===i?(Us(e,2+(r?1:0),3),EV(e,Tl,ug)):(Us(e,4+(r?1:0),3),((c,l,h,p)=>{let E;for(Us(c,l-257,5),Us(c,h-1,5),Us(c,p-4,4),E=0;E<p;E++)Us(c,c.bl_tree[2*aV[E]+1],3);vV(c,c.dyn_ltree,l-1),vV(c,c.dyn_dtree,h-1)})(e,e.l_desc.max_code+1,e.d_desc.max_code+1,o+1),EV(e,e.dyn_ltree,e.dyn_dtree)),fV(e),r&&mV(e)},a7=(e,t,n)=>(e.pending_buf[e.sym_buf+e.sym_next++]=t,e.pending_buf[e.sym_buf+e.sym_next++]=t>>8,e.pending_buf[e.sym_buf+e.sym_next++]=n,t===0?e.dyn_ltree[2*n]++:(e.matches++,t--,e.dyn_ltree[2*(pg[n]+wI+1)]++,e.dyn_dtree[2*uV(t)]++),e.sym_next===e.sym_end),c7=e=>{Us(e,2,3),Nc(e,256,Tl),(t=>{t.bi_valid===16?(fg(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)})(e)},l7={_tr_init:s7,_tr_stored_block:SV,_tr_flush_block:o7,_tr_tally:a7,_tr_align:c7},mg=(e,t,n,r)=>{let i=65535&e|0,s=e>>>16&65535|0,o=0;for(;n!==0;){o=n>2e3?2e3:n,n-=o;do i=i+t[r++]|0,s=s+i|0;while(--o);i%=65521,s%=65521}return i|s<<16|0};const d7=new Uint32Array((()=>{let e,t=[];for(var n=0;n<256;n++){e=n;for(var r=0;r<8;r++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e}return t})());var Ni=(e,t,n,r)=>{const i=d7,s=r+n;e^=-1;for(let o=r;o<s;o++)e=e>>>8^i[255&(e^t[o])];return-1^e},Oh={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},DT={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:u7,_tr_stored_block:DI,_tr_flush_block:h7,_tr_tally:Bd,_tr_align:p7}=l7,{Z_NO_FLUSH:Wd,Z_PARTIAL_FLUSH:f7,Z_FULL_FLUSH:m7,Z_FINISH:qo,Z_BLOCK:TV,Z_OK:Fi,Z_STREAM_END:RV,Z_STREAM_ERROR:Oc,Z_DATA_ERROR:_7,Z_BUF_ERROR:kI,Z_DEFAULT_COMPRESSION:E7,Z_FILTERED:g7,Z_HUFFMAN_ONLY:kT,Z_RLE:v7,Z_FIXED:y7,Z_DEFAULT_STRATEGY:S7,Z_UNKNOWN:T7,Z_DEFLATED:LT}=DT,LI=286,R7=30,C7=19,w7=2*LI+1,b7=15,Ph=258,Pc=262,em=42,Dh=113,_g=666,kh=(e,t)=>(e.msg=Oh[t],t),CV=e=>2*e-(e>4?9:0),Gd=e=>{let t=e.length;for(;--t>=0;)e[t]=0},I7=e=>{let t,n,r,i=e.w_size;t=e.hash_size,r=t;do n=e.head[--r],e.head[r]=n>=i?n-i:0;while(--t);t=i,r=t;do n=e.prev[--r],e.prev[r]=n>=i?n-i:0;while(--t)};let Hd=(e,t,n)=>(t<<e.hash_shift^n)&e.hash_mask;const ao=e=>{const t=e.state;let n=t.pending;n>e.avail_out&&(n=e.avail_out),n!==0&&(e.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+n),e.next_out),e.next_out+=n,t.pending_out+=n,e.total_out+=n,e.avail_out-=n,t.pending-=n,t.pending===0&&(t.pending_out=0))},co=(e,t)=>{h7(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,ao(e.strm)},Wn=(e,t)=>{e.pending_buf[e.pending++]=t},Eg=(e,t)=>{e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t},xI=(e,t,n,r)=>{let i=e.avail_in;return i>r&&(i=r),i===0?0:(e.avail_in-=i,t.set(e.input.subarray(e.next_in,e.next_in+i),n),e.state.wrap===1?e.adler=mg(e.adler,t,i,n):e.state.wrap===2&&(e.adler=Ni(e.adler,t,i,n)),e.next_in+=i,e.total_in+=i,i)},wV=(e,t)=>{let n,r,i=e.max_chain_length,s=e.strstart,o=e.prev_length,c=e.nice_match;const l=e.strstart>e.w_size-Pc?e.strstart-(e.w_size-Pc):0,h=e.window,p=e.w_mask,E=e.prev,g=e.strstart+Ph;let v=h[s+o-1],O=h[s+o];e.prev_length>=e.good_match&&(i>>=2),c>e.lookahead&&(c=e.lookahead);do if(n=t,h[n+o]===O&&h[n+o-1]===v&&h[n]===h[s]&&h[++n]===h[s+1]){s+=2,n++;do;while(h[++s]===h[++n]&&h[++s]===h[++n]&&h[++s]===h[++n]&&h[++s]===h[++n]&&h[++s]===h[++n]&&h[++s]===h[++n]&&h[++s]===h[++n]&&h[++s]===h[++n]&&s<g);if(r=Ph-(g-s),s=g-Ph,r>o){if(e.match_start=t,o=r,r>=c)break;v=h[s+o-1],O=h[s+o]}}while((t=E[t&p])>l&&--i!=0);return o<=e.lookahead?o:e.lookahead},tm=e=>{const t=e.w_size;let n,r,i;do{if(r=e.window_size-e.lookahead-e.strstart,e.strstart>=t+(t-Pc)&&(e.window.set(e.window.subarray(t,t+t-r),0),e.match_start-=t,e.strstart-=t,e.block_start-=t,e.insert>e.strstart&&(e.insert=e.strstart),I7(e),r+=t),e.strm.avail_in===0)break;if(n=xI(e.strm,e.window,e.strstart+e.lookahead,r),e.lookahead+=n,e.lookahead+e.insert>=3)for(i=e.strstart-e.insert,e.ins_h=e.window[i],e.ins_h=Hd(e,e.ins_h,e.window[i+1]);e.insert&&(e.ins_h=Hd(e,e.ins_h,e.window[i+3-1]),e.prev[i&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=i,i++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<Pc&&e.strm.avail_in!==0)},bV=(e,t)=>{let n,r,i,s=e.pending_buf_size-5>e.w_size?e.w_size:e.pending_buf_size-5,o=0,c=e.strm.avail_in;do{if(n=65535,i=e.bi_valid+42>>3,e.strm.avail_out<i||(i=e.strm.avail_out-i,r=e.strstart-e.block_start,n>r+e.strm.avail_in&&(n=r+e.strm.avail_in),n>i&&(n=i),n<s&&(n===0&&t!==qo||t===Wd||n!==r+e.strm.avail_in)))break;o=t===qo&&n===r+e.strm.avail_in?1:0,DI(e,0,0,o),e.pending_buf[e.pending-4]=n,e.pending_buf[e.pending-3]=n>>8,e.pending_buf[e.pending-2]=~n,e.pending_buf[e.pending-1]=~n>>8,ao(e.strm),r&&(r>n&&(r=n),e.strm.output.set(e.window.subarray(e.block_start,e.block_start+r),e.strm.next_out),e.strm.next_out+=r,e.strm.avail_out-=r,e.strm.total_out+=r,e.block_start+=r,n-=r),n&&(xI(e.strm,e.strm.output,e.strm.next_out,n),e.strm.next_out+=n,e.strm.avail_out-=n,e.strm.total_out+=n)}while(o===0);return c-=e.strm.avail_in,c&&(c>=e.w_size?(e.matches=2,e.window.set(e.strm.input.subarray(e.strm.next_in-e.w_size,e.strm.next_in),0),e.strstart=e.w_size,e.insert=e.strstart):(e.window_size-e.strstart<=c&&(e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,e.insert>e.strstart&&(e.insert=e.strstart)),e.window.set(e.strm.input.subarray(e.strm.next_in-c,e.strm.next_in),e.strstart),e.strstart+=c,e.insert+=c>e.w_size-e.insert?e.w_size-e.insert:c),e.block_start=e.strstart),e.high_water<e.strstart&&(e.high_water=e.strstart),o?4:t!==Wd&&t!==qo&&e.strm.avail_in===0&&e.strstart===e.block_start?2:(i=e.window_size-e.strstart,e.strm.avail_in>i&&e.block_start>=e.w_size&&(e.block_start-=e.w_size,e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,i+=e.w_size,e.insert>e.strstart&&(e.insert=e.strstart)),i>e.strm.avail_in&&(i=e.strm.avail_in),i&&(xI(e.strm,e.window,e.strstart,i),e.strstart+=i,e.insert+=i>e.w_size-e.insert?e.w_size-e.insert:i),e.high_water<e.strstart&&(e.high_water=e.strstart),i=e.bi_valid+42>>3,i=e.pending_buf_size-i>65535?65535:e.pending_buf_size-i,s=i>e.w_size?e.w_size:i,r=e.strstart-e.block_start,(r>=s||(r||t===qo)&&t!==Wd&&e.strm.avail_in===0&&r<=i)&&(n=r>i?i:r,o=t===qo&&e.strm.avail_in===0&&n===r?1:0,DI(e,e.block_start,n,o),e.block_start+=n,ao(e.strm)),o?3:1)},MI=(e,t)=>{let n,r;for(;;){if(e.lookahead<Pc){if(tm(e),e.lookahead<Pc&&t===Wd)return 1;if(e.lookahead===0)break}if(n=0,e.lookahead>=3&&(e.ins_h=Hd(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),n!==0&&e.strstart-n<=e.w_size-Pc&&(e.match_length=wV(e,n)),e.match_length>=3)if(r=Bd(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do e.strstart++,e.ins_h=Hd(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart;while(--e.match_length!=0);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=Hd(e,e.ins_h,e.window[e.strstart+1]);else r=Bd(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(r&&(co(e,!1),e.strm.avail_out===0))return 1}return e.insert=e.strstart<2?e.strstart:2,t===qo?(co(e,!0),e.strm.avail_out===0?3:4):e.sym_next&&(co(e,!1),e.strm.avail_out===0)?1:2},nm=(e,t)=>{let n,r,i;for(;;){if(e.lookahead<Pc){if(tm(e),e.lookahead<Pc&&t===Wd)return 1;if(e.lookahead===0)break}if(n=0,e.lookahead>=3&&(e.ins_h=Hd(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,n!==0&&e.prev_length<e.max_lazy_match&&e.strstart-n<=e.w_size-Pc&&(e.match_length=wV(e,n),e.match_length<=5&&(e.strategy===g7||e.match_length===3&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){i=e.strstart+e.lookahead-3,r=Bd(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do++e.strstart<=i&&(e.ins_h=Hd(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart);while(--e.prev_length!=0);if(e.match_available=0,e.match_length=2,e.strstart++,r&&(co(e,!1),e.strm.avail_out===0))return 1}else if(e.match_available){if(r=Bd(e,0,e.window[e.strstart-1]),r&&co(e,!1),e.strstart++,e.lookahead--,e.strm.avail_out===0)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(r=Bd(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,t===qo?(co(e,!0),e.strm.avail_out===0?3:4):e.sym_next&&(co(e,!1),e.strm.avail_out===0)?1:2};function Dc(e,t,n,r,i){this.good_length=e,this.max_lazy=t,this.nice_length=n,this.max_chain=r,this.func=i}const gg=[new Dc(0,0,0,0,bV),new Dc(4,4,8,4,MI),new Dc(4,5,16,8,MI),new Dc(4,6,32,32,MI),new Dc(4,4,16,16,nm),new Dc(8,16,32,32,nm),new Dc(8,16,128,128,nm),new Dc(8,32,128,256,nm),new Dc(32,128,258,1024,nm),new Dc(32,258,258,4096,nm)];function A7(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=LT,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(2*w7),this.dyn_dtree=new Uint16Array(2*(2*R7+1)),this.bl_tree=new Uint16Array(2*(2*C7+1)),Gd(this.dyn_ltree),Gd(this.dyn_dtree),Gd(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(b7+1),this.heap=new Uint16Array(2*LI+1),Gd(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*LI+1),Gd(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const vg=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.status!==em&&t.status!==57&&t.status!==69&&t.status!==73&&t.status!==91&&t.status!==103&&t.status!==Dh&&t.status!==_g?1:0},IV=e=>{if(vg(e))return kh(e,Oc);e.total_in=e.total_out=0,e.data_type=T7;const t=e.state;return t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap===2?57:t.wrap?em:Dh,e.adler=t.wrap===2?0:1,t.last_flush=-2,u7(t),Fi},AV=e=>{const t=IV(e);return t===Fi&&(n=>{n.window_size=2*n.w_size,Gd(n.head),n.max_lazy_match=gg[n.level].max_lazy,n.good_match=gg[n.level].good_length,n.nice_match=gg[n.level].nice_length,n.max_chain_length=gg[n.level].max_chain,n.strstart=0,n.block_start=0,n.lookahead=0,n.insert=0,n.match_length=n.prev_length=2,n.match_available=0,n.ins_h=0})(e.state),t},NV=(e,t,n,r,i,s)=>{if(!e)return Oc;let o=1;if(t===E7&&(t=6),r<0?(o=0,r=-r):r>15&&(o=2,r-=16),i<1||i>9||n!==LT||r<8||r>15||t<0||t>9||s<0||s>y7||r===8&&o!==1)return kh(e,Oc);r===8&&(r=9);const c=new A7;return e.state=c,c.strm=e,c.status=em,c.wrap=o,c.gzhead=null,c.w_bits=r,c.w_size=1<<c.w_bits,c.w_mask=c.w_size-1,c.hash_bits=i+7,c.hash_size=1<<c.hash_bits,c.hash_mask=c.hash_size-1,c.hash_shift=~~((c.hash_bits+3-1)/3),c.window=new Uint8Array(2*c.w_size),c.head=new Uint16Array(c.hash_size),c.prev=new Uint16Array(c.w_size),c.lit_bufsize=1<<i+6,c.pending_buf_size=4*c.lit_bufsize,c.pending_buf=new Uint8Array(c.pending_buf_size),c.sym_buf=c.lit_bufsize,c.sym_end=3*(c.lit_bufsize-1),c.level=t,c.strategy=s,c.method=n,AV(e)};var N7=(e,t)=>{if(vg(e)||t>TV||t<0)return e?kh(e,Oc):Oc;const n=e.state;if(!e.output||e.avail_in!==0&&!e.input||n.status===_g&&t!==qo)return kh(e,e.avail_out===0?kI:Oc);const r=n.last_flush;if(n.last_flush=t,n.pending!==0){if(ao(e),e.avail_out===0)return n.last_flush=-1,Fi}else if(e.avail_in===0&&CV(t)<=CV(r)&&t!==qo)return kh(e,kI);if(n.status===_g&&e.avail_in!==0)return kh(e,kI);if(n.status===em&&n.wrap===0&&(n.status=Dh),n.status===em){let i=LT+(n.w_bits-8<<4)<<8,s=-1;if(s=n.strategy>=kT||n.level<2?0:n.level<6?1:n.level===6?2:3,i|=s<<6,n.strstart!==0&&(i|=32),i+=31-i%31,Eg(n,i),n.strstart!==0&&(Eg(n,e.adler>>>16),Eg(n,65535&e.adler)),e.adler=1,n.status=Dh,ao(e),n.pending!==0)return n.last_flush=-1,Fi}if(n.status===57){if(e.adler=0,Wn(n,31),Wn(n,139),Wn(n,8),n.gzhead)Wn(n,(n.gzhead.text?1:0)+(n.gzhead.hcrc?2:0)+(n.gzhead.extra?4:0)+(n.gzhead.name?8:0)+(n.gzhead.comment?16:0)),Wn(n,255&n.gzhead.time),Wn(n,n.gzhead.time>>8&255),Wn(n,n.gzhead.time>>16&255),Wn(n,n.gzhead.time>>24&255),Wn(n,n.level===9?2:n.strategy>=kT||n.level<2?4:0),Wn(n,255&n.gzhead.os),n.gzhead.extra&&n.gzhead.extra.length&&(Wn(n,255&n.gzhead.extra.length),Wn(n,n.gzhead.extra.length>>8&255)),n.gzhead.hcrc&&(e.adler=Ni(e.adler,n.pending_buf,n.pending,0)),n.gzindex=0,n.status=69;else if(Wn(n,0),Wn(n,0),Wn(n,0),Wn(n,0),Wn(n,0),Wn(n,n.level===9?2:n.strategy>=kT||n.level<2?4:0),Wn(n,3),n.status=Dh,ao(e),n.pending!==0)return n.last_flush=-1,Fi}if(n.status===69){if(n.gzhead.extra){let i=n.pending,s=(65535&n.gzhead.extra.length)-n.gzindex;for(;n.pending+s>n.pending_buf_size;){let c=n.pending_buf_size-n.pending;if(n.pending_buf.set(n.gzhead.extra.subarray(n.gzindex,n.gzindex+c),n.pending),n.pending=n.pending_buf_size,n.gzhead.hcrc&&n.pending>i&&(e.adler=Ni(e.adler,n.pending_buf,n.pending-i,i)),n.gzindex+=c,ao(e),n.pending!==0)return n.last_flush=-1,Fi;i=0,s-=c}let o=new Uint8Array(n.gzhead.extra);n.pending_buf.set(o.subarray(n.gzindex,n.gzindex+s),n.pending),n.pending+=s,n.gzhead.hcrc&&n.pending>i&&(e.adler=Ni(e.adler,n.pending_buf,n.pending-i,i)),n.gzindex=0}n.status=73}if(n.status===73){if(n.gzhead.name){let i,s=n.pending;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>s&&(e.adler=Ni(e.adler,n.pending_buf,n.pending-s,s)),ao(e),n.pending!==0)return n.last_flush=-1,Fi;s=0}i=n.gzindex<n.gzhead.name.length?255&n.gzhead.name.charCodeAt(n.gzindex++):0,Wn(n,i)}while(i!==0);n.gzhead.hcrc&&n.pending>s&&(e.adler=Ni(e.adler,n.pending_buf,n.pending-s,s)),n.gzindex=0}n.status=91}if(n.status===91){if(n.gzhead.comment){let i,s=n.pending;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>s&&(e.adler=Ni(e.adler,n.pending_buf,n.pending-s,s)),ao(e),n.pending!==0)return n.last_flush=-1,Fi;s=0}i=n.gzindex<n.gzhead.comment.length?255&n.gzhead.comment.charCodeAt(n.gzindex++):0,Wn(n,i)}while(i!==0);n.gzhead.hcrc&&n.pending>s&&(e.adler=Ni(e.adler,n.pending_buf,n.pending-s,s))}n.status=103}if(n.status===103){if(n.gzhead.hcrc){if(n.pending+2>n.pending_buf_size&&(ao(e),n.pending!==0))return n.last_flush=-1,Fi;Wn(n,255&e.adler),Wn(n,e.adler>>8&255),e.adler=0}if(n.status=Dh,ao(e),n.pending!==0)return n.last_flush=-1,Fi}if(e.avail_in!==0||n.lookahead!==0||t!==Wd&&n.status!==_g){let i=n.level===0?bV(n,t):n.strategy===kT?((s,o)=>{let c;for(;;){if(s.lookahead===0&&(tm(s),s.lookahead===0)){if(o===Wd)return 1;break}if(s.match_length=0,c=Bd(s,0,s.window[s.strstart]),s.lookahead--,s.strstart++,c&&(co(s,!1),s.strm.avail_out===0))return 1}return s.insert=0,o===qo?(co(s,!0),s.strm.avail_out===0?3:4):s.sym_next&&(co(s,!1),s.strm.avail_out===0)?1:2})(n,t):n.strategy===v7?((s,o)=>{let c,l,h,p;const E=s.window;for(;;){if(s.lookahead<=Ph){if(tm(s),s.lookahead<=Ph&&o===Wd)return 1;if(s.lookahead===0)break}if(s.match_length=0,s.lookahead>=3&&s.strstart>0&&(h=s.strstart-1,l=E[h],l===E[++h]&&l===E[++h]&&l===E[++h])){p=s.strstart+Ph;do;while(l===E[++h]&&l===E[++h]&&l===E[++h]&&l===E[++h]&&l===E[++h]&&l===E[++h]&&l===E[++h]&&l===E[++h]&&h<p);s.match_length=Ph-(p-h),s.match_length>s.lookahead&&(s.match_length=s.lookahead)}if(s.match_length>=3?(c=Bd(s,1,s.match_length-3),s.lookahead-=s.match_length,s.strstart+=s.match_length,s.match_length=0):(c=Bd(s,0,s.window[s.strstart]),s.lookahead--,s.strstart++),c&&(co(s,!1),s.strm.avail_out===0))return 1}return s.insert=0,o===qo?(co(s,!0),s.strm.avail_out===0?3:4):s.sym_next&&(co(s,!1),s.strm.avail_out===0)?1:2})(n,t):gg[n.level].func(n,t);if(i!==3&&i!==4||(n.status=_g),i===1||i===3)return e.avail_out===0&&(n.last_flush=-1),Fi;if(i===2&&(t===f7?p7(n):t!==TV&&(DI(n,0,0,!1),t===m7&&(Gd(n.head),n.lookahead===0&&(n.strstart=0,n.block_start=0,n.insert=0))),ao(e),e.avail_out===0))return n.last_flush=-1,Fi}return t!==qo?Fi:n.wrap<=0?RV:(n.wrap===2?(Wn(n,255&e.adler),Wn(n,e.adler>>8&255),Wn(n,e.adler>>16&255),Wn(n,e.adler>>24&255),Wn(n,255&e.total_in),Wn(n,e.total_in>>8&255),Wn(n,e.total_in>>16&255),Wn(n,e.total_in>>24&255)):(Eg(n,e.adler>>>16),Eg(n,65535&e.adler)),ao(e),n.wrap>0&&(n.wrap=-n.wrap),n.pending!==0?Fi:RV)},O7=(e,t)=>{let n=t.length;if(vg(e))return Oc;const r=e.state,i=r.wrap;if(i===2||i===1&&r.status!==em||r.lookahead)return Oc;if(i===1&&(e.adler=mg(e.adler,t,n,0)),r.wrap=0,n>=r.w_size){i===0&&(Gd(r.head),r.strstart=0,r.block_start=0,r.insert=0);let l=new Uint8Array(r.w_size);l.set(t.subarray(n-r.w_size,n),0),t=l,n=r.w_size}const s=e.avail_in,o=e.next_in,c=e.input;for(e.avail_in=n,e.next_in=0,e.input=t,tm(r);r.lookahead>=3;){let l=r.strstart,h=r.lookahead-2;do r.ins_h=Hd(r,r.ins_h,r.window[l+3-1]),r.prev[l&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=l,l++;while(--h);r.strstart=l,r.lookahead=2,tm(r)}return r.strstart+=r.lookahead,r.block_start=r.strstart,r.insert=r.lookahead,r.lookahead=0,r.match_length=r.prev_length=2,r.match_available=0,e.next_in=o,e.input=c,e.avail_in=s,r.wrap=i,Fi},yg={deflateInit:(e,t)=>NV(e,t,LT,15,8,S7),deflateInit2:NV,deflateReset:AV,deflateResetKeep:IV,deflateSetHeader:(e,t)=>vg(e)||e.state.wrap!==2?Oc:(e.state.gzhead=t,Fi),deflate:N7,deflateEnd:e=>{if(vg(e))return Oc;const t=e.state.status;return e.state=null,t===Dh?kh(e,_7):Fi},deflateSetDictionary:O7,deflateInfo:"pako deflate (from Nodeca project)"};const P7=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var xT={assign:function(e){const t=Array.prototype.slice.call(arguments,1);for(;t.length;){const n=t.shift();if(n){if(typeof n!="object")throw new TypeError(n+"must be non-object");for(const r in n)P7(n,r)&&(e[r]=n[r])}}return e},flattenChunks:e=>{let t=0;for(let r=0,i=e.length;r<i;r++)t+=e[r].length;const n=new Uint8Array(t);for(let r=0,i=0,s=e.length;r<s;r++){let o=e[r];n.set(o,i),i+=o.length}return n}};let OV=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{OV=!1}const Sg=new Uint8Array(256);for(let e=0;e<256;e++)Sg[e]=e>=252?6:e>=248?5:e>=240?4:e>=224?3:e>=192?2:1;Sg[254]=Sg[254]=1;var Tg={string2buf:e=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(e);let t,n,r,i,s,o=e.length,c=0;for(i=0;i<o;i++)n=e.charCodeAt(i),(64512&n)==55296&&i+1<o&&(r=e.charCodeAt(i+1),(64512&r)==56320&&(n=65536+(n-55296<<10)+(r-56320),i++)),c+=n<128?1:n<2048?2:n<65536?3:4;for(t=new Uint8Array(c),s=0,i=0;s<c;i++)n=e.charCodeAt(i),(64512&n)==55296&&i+1<o&&(r=e.charCodeAt(i+1),(64512&r)==56320&&(n=65536+(n-55296<<10)+(r-56320),i++)),n<128?t[s++]=n:n<2048?(t[s++]=192|n>>>6,t[s++]=128|63&n):n<65536?(t[s++]=224|n>>>12,t[s++]=128|n>>>6&63,t[s++]=128|63&n):(t[s++]=240|n>>>18,t[s++]=128|n>>>12&63,t[s++]=128|n>>>6&63,t[s++]=128|63&n);return t},buf2string:(e,t)=>{const n=t||e.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(e.subarray(0,t));let r,i;const s=new Array(2*n);for(i=0,r=0;r<n;){let o=e[r++];if(o<128){s[i++]=o;continue}let c=Sg[o];if(c>4)s[i++]=65533,r+=c-1;else{for(o&=c===2?31:c===3?15:7;c>1&&r<n;)o=o<<6|63&e[r++],c--;c>1?s[i++]=65533:o<65536?s[i++]=o:(o-=65536,s[i++]=55296|o>>10&1023,s[i++]=56320|1023&o)}}return((o,c)=>{if(c<65534&&o.subarray&&OV)return String.fromCharCode.apply(null,o.length===c?o:o.subarray(0,c));let l="";for(let h=0;h<c;h++)l+=String.fromCharCode(o[h]);return l})(s,i)},utf8border:(e,t)=>{(t=t||e.length)>e.length&&(t=e.length);let n=t-1;for(;n>=0&&(192&e[n])==128;)n--;return n<0||n===0?t:n+Sg[e[n]]>t?n:t}},PV=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const DV=Object.prototype.toString,{Z_NO_FLUSH:D7,Z_SYNC_FLUSH:k7,Z_FULL_FLUSH:L7,Z_FINISH:x7,Z_OK:MT,Z_STREAM_END:M7,Z_DEFAULT_COMPRESSION:U7,Z_DEFAULT_STRATEGY:V7,Z_DEFLATED:j7}=DT;function UT(e){this.options=xT.assign({level:U7,method:j7,chunkSize:16384,windowBits:15,memLevel:8,strategy:V7},e||{});let t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new PV,this.strm.avail_out=0;let n=yg.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(n!==MT)throw new Error(Oh[n]);if(t.header&&yg.deflateSetHeader(this.strm,t.header),t.dictionary){let r;if(r=typeof t.dictionary=="string"?Tg.string2buf(t.dictionary):DV.call(t.dictionary)==="[object ArrayBuffer]"?new Uint8Array(t.dictionary):t.dictionary,n=yg.deflateSetDictionary(this.strm,r),n!==MT)throw new Error(Oh[n]);this._dict_set=!0}}function F7(e,t){const n=new UT(t);if(n.push(e,!0),n.err)throw n.msg||Oh[n.err];return n.result}UT.prototype.push=function(e,t){const n=this.strm,r=this.options.chunkSize;let i,s;if(this.ended)return!1;for(s=t===~~t?t:t===!0?x7:D7,typeof e=="string"?n.input=Tg.string2buf(e):DV.call(e)==="[object ArrayBuffer]"?n.input=new Uint8Array(e):n.input=e,n.next_in=0,n.avail_in=n.input.length;;)if(n.avail_out===0&&(n.output=new Uint8Array(r),n.next_out=0,n.avail_out=r),(s===k7||s===L7)&&n.avail_out<=6)this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;else{if(i=yg.deflate(n,s),i===M7)return n.next_out>0&&this.onData(n.output.subarray(0,n.next_out)),i=yg.deflateEnd(this.strm),this.onEnd(i),this.ended=!0,i===MT;if(n.avail_out!==0){if(s>0&&n.next_out>0)this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;else if(n.avail_in===0)break}else this.onData(n.output)}return!0},UT.prototype.onData=function(e){this.chunks.push(e)},UT.prototype.onEnd=function(e){e===MT&&(this.result=xT.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var B7={deflate:F7};const VT=16209;var W7=function(e,t){let n,r,i,s,o,c,l,h,p,E,g,v,O,I,N,M,x,B,Z,Q,z,te,de,me;const ve=e.state;n=e.next_in,de=e.input,r=n+(e.avail_in-5),i=e.next_out,me=e.output,s=i-(t-e.avail_out),o=i+(e.avail_out-257),c=ve.dmax,l=ve.wsize,h=ve.whave,p=ve.wnext,E=ve.window,g=ve.hold,v=ve.bits,O=ve.lencode,I=ve.distcode,N=(1<<ve.lenbits)-1,M=(1<<ve.distbits)-1;e:do{v<15&&(g+=de[n++]<<v,v+=8,g+=de[n++]<<v,v+=8),x=O[g&N];t:for(;;){if(B=x>>>24,g>>>=B,v-=B,B=x>>>16&255,B===0)me[i++]=65535&x;else{if(!(16&B)){if((64&B)==0){x=O[(65535&x)+(g&(1<<B)-1)];continue t}if(32&B){ve.mode=16191;break e}e.msg="invalid literal/length code",ve.mode=VT;break e}Z=65535&x,B&=15,B&&(v<B&&(g+=de[n++]<<v,v+=8),Z+=g&(1<<B)-1,g>>>=B,v-=B),v<15&&(g+=de[n++]<<v,v+=8,g+=de[n++]<<v,v+=8),x=I[g&M];n:for(;;){if(B=x>>>24,g>>>=B,v-=B,B=x>>>16&255,!(16&B)){if((64&B)==0){x=I[(65535&x)+(g&(1<<B)-1)];continue n}e.msg="invalid distance code",ve.mode=VT;break e}if(Q=65535&x,B&=15,v<B&&(g+=de[n++]<<v,v+=8,v<B&&(g+=de[n++]<<v,v+=8)),Q+=g&(1<<B)-1,Q>c){e.msg="invalid distance too far back",ve.mode=VT;break e}if(g>>>=B,v-=B,B=i-s,Q>B){if(B=Q-B,B>h&&ve.sane){e.msg="invalid distance too far back",ve.mode=VT;break e}if(z=0,te=E,p===0){if(z+=l-B,B<Z){Z-=B;do me[i++]=E[z++];while(--B);z=i-Q,te=me}}else if(p<B){if(z+=l+p-B,B-=p,B<Z){Z-=B;do me[i++]=E[z++];while(--B);if(z=0,p<Z){B=p,Z-=B;do me[i++]=E[z++];while(--B);z=i-Q,te=me}}}else if(z+=p-B,B<Z){Z-=B;do me[i++]=E[z++];while(--B);z=i-Q,te=me}for(;Z>2;)me[i++]=te[z++],me[i++]=te[z++],me[i++]=te[z++],Z-=3;Z&&(me[i++]=te[z++],Z>1&&(me[i++]=te[z++]))}else{z=i-Q;do me[i++]=me[z++],me[i++]=me[z++],me[i++]=me[z++],Z-=3;while(Z>2);Z&&(me[i++]=me[z++],Z>1&&(me[i++]=me[z++]))}break}}break}}while(n<r&&i<o);Z=v>>3,n-=Z,v-=Z<<3,g&=(1<<v)-1,e.next_in=n,e.next_out=i,e.avail_in=n<r?r-n+5:5-(n-r),e.avail_out=i<o?o-i+257:257-(i-o),ve.hold=g,ve.bits=v};const jT=15,G7=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),H7=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),K7=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),z7=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var Rg=(e,t,n,r,i,s,o,c)=>{const l=c.bits;let h,p,E,g,v,O,I=0,N=0,M=0,x=0,B=0,Z=0,Q=0,z=0,te=0,de=0,me=null;const ve=new Uint16Array(16),St=new Uint16Array(16);let wt,ot,Xt,zt=null;for(I=0;I<=jT;I++)ve[I]=0;for(N=0;N<r;N++)ve[t[n+N]]++;for(B=l,x=jT;x>=1&&ve[x]===0;x--);if(B>x&&(B=x),x===0)return i[s++]=20971520,i[s++]=20971520,c.bits=1,0;for(M=1;M<x&&ve[M]===0;M++);for(B<M&&(B=M),z=1,I=1;I<=jT;I++)if(z<<=1,z-=ve[I],z<0)return-1;if(z>0&&(e===0||x!==1))return-1;for(St[1]=0,I=1;I<jT;I++)St[I+1]=St[I]+ve[I];for(N=0;N<r;N++)t[n+N]!==0&&(o[St[t[n+N]]++]=N);if(e===0?(me=zt=o,O=20):e===1?(me=G7,zt=H7,O=257):(me=K7,zt=z7,O=0),de=0,N=0,I=M,v=s,Z=B,Q=0,E=-1,te=1<<B,g=te-1,e===1&&te>852||e===2&&te>592)return 1;for(;;){wt=I-Q,o[N]+1<O?(ot=0,Xt=o[N]):o[N]>=O?(ot=zt[o[N]-O],Xt=me[o[N]-O]):(ot=96,Xt=0),h=1<<I-Q,p=1<<Z,M=p;do p-=h,i[v+(de>>Q)+p]=wt<<24|ot<<16|Xt|0;while(p!==0);for(h=1<<I-1;de&h;)h>>=1;if(h!==0?(de&=h-1,de+=h):de=0,N++,--ve[I]==0){if(I===x)break;I=t[n+o[N]]}if(I>B&&(de&g)!==E){for(Q===0&&(Q=B),v+=M,Z=I-Q,z=1<<Z;Z+Q<x&&(z-=ve[Z+Q],!(z<=0));)Z++,z<<=1;if(te+=1<<Z,e===1&&te>852||e===2&&te>592)return 1;E=de&g,i[E]=B<<24|Z<<16|v-s|0}}return de!==0&&(i[v+de]=I-Q<<24|64<<16|0),c.bits=B,0};const{Z_FINISH:kV,Z_BLOCK:Y7,Z_TREES:FT,Z_OK:Lh,Z_STREAM_END:q7,Z_NEED_DICT:X7,Z_STREAM_ERROR:Xo,Z_DATA_ERROR:LV,Z_MEM_ERROR:xV,Z_BUF_ERROR:J7,Z_DEFLATED:MV}=DT,BT=16180,WT=16190,Rl=16191,UI=16192,VI=16194,GT=16199,HT=16200,jI=16206,br=16209,UV=e=>(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24);function Q7(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const xh=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.mode<BT||t.mode>16211?1:0},VV=e=>{if(xh(e))return Xo;const t=e.state;return e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=BT,t.last=0,t.havedict=0,t.flags=-1,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(852),t.distcode=t.distdyn=new Int32Array(592),t.sane=1,t.back=-1,Lh},jV=e=>{if(xh(e))return Xo;const t=e.state;return t.wsize=0,t.whave=0,t.wnext=0,VV(e)},FV=(e,t)=>{let n;if(xh(e))return Xo;const r=e.state;return t<0?(n=0,t=-t):(n=5+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?Xo:(r.window!==null&&r.wbits!==t&&(r.window=null),r.wrap=n,r.wbits=t,jV(e))},BV=(e,t)=>{if(!e)return Xo;const n=new Q7;e.state=n,n.strm=e,n.window=null,n.mode=BT;const r=FV(e,t);return r!==Lh&&(e.state=null),r};let FI,BI,WV=!0;const Z7=e=>{if(WV){FI=new Int32Array(512),BI=new Int32Array(32);let t=0;for(;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(Rg(1,e.lens,0,288,FI,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;Rg(2,e.lens,0,32,BI,0,e.work,{bits:5}),WV=!1}e.lencode=FI,e.lenbits=9,e.distcode=BI,e.distbits=5},GV=(e,t,n,r)=>{let i;const s=e.state;return s.window===null&&(s.wsize=1<<s.wbits,s.wnext=0,s.whave=0,s.window=new Uint8Array(s.wsize)),r>=s.wsize?(s.window.set(t.subarray(n-s.wsize,n),0),s.wnext=0,s.whave=s.wsize):(i=s.wsize-s.wnext,i>r&&(i=r),s.window.set(t.subarray(n-r,n-r+i),s.wnext),(r-=i)?(s.window.set(t.subarray(n-r,n),0),s.wnext=r,s.whave=s.wsize):(s.wnext+=i,s.wnext===s.wsize&&(s.wnext=0),s.whave<s.wsize&&(s.whave+=i))),0};var $7=(e,t)=>{let n,r,i,s,o,c,l,h,p,E,g,v,O,I,N,M,x,B,Z,Q,z,te,de=0;const me=new Uint8Array(4);let ve,St;const wt=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(xh(e)||!e.output||!e.input&&e.avail_in!==0)return Xo;n=e.state,n.mode===Rl&&(n.mode=UI),o=e.next_out,i=e.output,l=e.avail_out,s=e.next_in,r=e.input,c=e.avail_in,h=n.hold,p=n.bits,E=c,g=l,te=Lh;e:for(;;)switch(n.mode){case BT:if(n.wrap===0){n.mode=UI;break}for(;p<16;){if(c===0)break e;c--,h+=r[s++]<<p,p+=8}if(2&n.wrap&&h===35615){n.wbits===0&&(n.wbits=15),n.check=0,me[0]=255&h,me[1]=h>>>8&255,n.check=Ni(n.check,me,2,0),h=0,p=0,n.mode=16181;break}if(n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&h)<<8)+(h>>8))%31){e.msg="incorrect header check",n.mode=br;break}if((15&h)!==MV){e.msg="unknown compression method",n.mode=br;break}if(h>>>=4,p-=4,z=8+(15&h),n.wbits===0&&(n.wbits=z),z>15||z>n.wbits){e.msg="invalid window size",n.mode=br;break}n.dmax=1<<n.wbits,n.flags=0,e.adler=n.check=1,n.mode=512&h?16189:Rl,h=0,p=0;break;case 16181:for(;p<16;){if(c===0)break e;c--,h+=r[s++]<<p,p+=8}if(n.flags=h,(255&_i(n))!==MV){e.msg="unknown compression method",n.mode=br;break}if(57344&_i(n)){e.msg="unknown header flags set",n.mode=br;break}n.head&&(n.head.text=h>>8&1),512&_i(n)&&4&n.wrap&&(me[0]=255&h,me[1]=h>>>8&255,n.check=Ni(n.check,me,2,0)),h=0,p=0,n.mode=16182;case 16182:for(;p<32;){if(c===0)break e;c--,h+=r[s++]<<p,p+=8}n.head&&(n.head.time=h),512&_i(n)&&4&n.wrap&&(me[0]=255&h,me[1]=h>>>8&255,me[2]=h>>>16&255,me[3]=h>>>24&255,n.check=Ni(n.check,me,4,0)),h=0,p=0,n.mode=16183;case 16183:for(;p<16;){if(c===0)break e;c--,h+=r[s++]<<p,p+=8}n.head&&(n.head.xflags=255&h,n.head.os=h>>8),512&_i(n)&&4&n.wrap&&(me[0]=255&h,me[1]=h>>>8&255,n.check=Ni(n.check,me,2,0)),h=0,p=0,n.mode=16184;case 16184:if(1024&_i(n)){for(;p<16;){if(c===0)break e;c--,h+=r[s++]<<p,p+=8}n.length=h,n.head&&(n.head.extra_len=h),512&_i(n)&&4&n.wrap&&(me[0]=255&h,me[1]=h>>>8&255,n.check=Ni(n.check,me,2,0)),h=0,p=0}else n.head&&(n.head.extra=null);n.mode=16185;case 16185:if(1024&_i(n)&&(v=n.length,v>c&&(v=c),v&&(n.head&&(z=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Uint8Array(n.head.extra_len)),n.head.extra.set(r.subarray(s,s+v),z)),512&_i(n)&&4&n.wrap&&(n.check=Ni(n.check,r,v,s)),c-=v,s+=v,n.length-=v),n.length))break e;n.length=0,n.mode=16186;case 16186:if(2048&_i(n)){if(c===0)break e;v=0;do z=r[s+v++],n.head&&z&&n.length<65536&&(n.head.name+=String.fromCharCode(z));while(z&&v<c);if(512&_i(n)&&4&n.wrap&&(n.check=Ni(n.check,r,v,s)),c-=v,s+=v,z)break e}else n.head&&(n.head.name=null);n.length=0,n.mode=16187;case 16187:if(4096&_i(n)){if(c===0)break e;v=0;do z=r[s+v++],n.head&&z&&n.length<65536&&(n.head.comment+=String.fromCharCode(z));while(z&&v<c);if(512&_i(n)&&4&n.wrap&&(n.check=Ni(n.check,r,v,s)),c-=v,s+=v,z)break e}else n.head&&(n.head.comment=null);n.mode=16188;case 16188:if(512&_i(n)){for(;p<16;){if(c===0)break e;c--,h+=r[s++]<<p,p+=8}if(4&n.wrap&&h!==(65535&n.check)){e.msg="header crc mismatch",n.mode=br;break}h=0,p=0}n.head&&(n.head.hcrc=_i(n)>>9&1,n.head.done=!0),e.adler=n.check=0,n.mode=Rl;break;case 16189:for(;p<32;){if(c===0)break e;c--,h+=r[s++]<<p,p+=8}e.adler=n.check=UV(h),h=0,p=0,n.mode=WT;case WT:if(n.havedict===0)return e.next_out=o,e.avail_out=l,e.next_in=s,e.avail_in=c,n.hold=h,n.bits=p,X7;e.adler=n.check=1,n.mode=Rl;case Rl:if(t===Y7||t===FT)break e;case UI:if(n.last){h>>>=7&p,p-=7&p,n.mode=jI;break}for(;p<3;){if(c===0)break e;c--,h+=r[s++]<<p,p+=8}switch(n.last=1&h,h>>>=1,p-=1,3&h){case 0:n.mode=16193;break;case 1:if(Z7(n),n.mode=GT,t===FT){h>>>=2,p-=2;break e}break;case 2:n.mode=16196;break;case 3:e.msg="invalid block type",n.mode=br}h>>>=2,p-=2;break;case 16193:for(h>>>=7&p,p-=7&p;p<32;){if(c===0)break e;c--,h+=r[s++]<<p,p+=8}if((65535&h)!=(h>>>16^65535)){e.msg="invalid stored block lengths",n.mode=br;break}if(n.length=65535&h,h=0,p=0,n.mode=VI,t===FT)break e;case VI:n.mode=16195;case 16195:if(v=n.length,v){if(v>c&&(v=c),v>l&&(v=l),v===0)break e;i.set(r.subarray(s,s+v),o),c-=v,s+=v,l-=v,o+=v,n.length-=v;break}n.mode=Rl;break;case 16196:for(;p<14;){if(c===0)break e;c--,h+=r[s++]<<p,p+=8}if(n.nlen=257+(31&h),h>>>=5,p-=5,n.ndist=1+(31&h),h>>>=5,p-=5,n.ncode=4+(15&h),h>>>=4,p-=4,n.nlen>286||n.ndist>30){e.msg="too many length or distance symbols",n.mode=br;break}n.have=0,n.mode=16197;case 16197:for(;n.have<n.ncode;){for(;p<3;){if(c===0)break e;c--,h+=r[s++]<<p,p+=8}n.lens[wt[n.have++]]=7&h,h>>>=3,p-=3}for(;n.have<19;)n.lens[wt[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,ve={bits:n.lenbits},te=Rg(0,n.lens,0,19,n.lencode,0,n.work,ve),n.lenbits=ve.bits,te){e.msg="invalid code lengths set",n.mode=br;break}n.have=0,n.mode=16198;case 16198:for(;n.have<n.nlen+n.ndist;){for(;de=n.lencode[h&(1<<n.lenbits)-1],N=de>>>24,M=de>>>16&255,x=65535&de,!(N<=p);){if(c===0)break e;c--,h+=r[s++]<<p,p+=8}if(x<16)h>>>=N,p-=N,n.lens[n.have++]=x;else{if(x===16){for(St=N+2;p<St;){if(c===0)break e;c--,h+=r[s++]<<p,p+=8}if(h>>>=N,p-=N,n.have===0){e.msg="invalid bit length repeat",n.mode=br;break}z=n.lens[n.have-1],v=3+(3&h),h>>>=2,p-=2}else if(x===17){for(St=N+3;p<St;){if(c===0)break e;c--,h+=r[s++]<<p,p+=8}h>>>=N,p-=N,z=0,v=3+(7&h),h>>>=3,p-=3}else{for(St=N+7;p<St;){if(c===0)break e;c--,h+=r[s++]<<p,p+=8}h>>>=N,p-=N,z=0,v=11+(127&h),h>>>=7,p-=7}if(n.have+v>n.nlen+n.ndist){e.msg="invalid bit length repeat",n.mode=br;break}for(;v--;)n.lens[n.have++]=z}}if(n.mode===br)break;if(n.lens[256]===0){e.msg="invalid code -- missing end-of-block",n.mode=br;break}if(n.lenbits=9,ve={bits:n.lenbits},te=Rg(1,n.lens,0,n.nlen,n.lencode,0,n.work,ve),n.lenbits=ve.bits,te){e.msg="invalid literal/lengths set",n.mode=br;break}if(n.distbits=6,n.distcode=n.distdyn,ve={bits:n.distbits},te=Rg(2,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,ve),n.distbits=ve.bits,te){e.msg="invalid distances set",n.mode=br;break}if(n.mode=GT,t===FT)break e;case GT:n.mode=HT;case HT:if(c>=6&&l>=258){e.next_out=o,e.avail_out=l,e.next_in=s,e.avail_in=c,n.hold=h,n.bits=p,W7(e,g),o=e.next_out,i=e.output,l=e.avail_out,s=e.next_in,r=e.input,c=e.avail_in,h=n.hold,p=n.bits,n.mode===Rl&&(n.back=-1);break}for(n.back=0;de=n.lencode[h&(1<<n.lenbits)-1],N=de>>>24,M=de>>>16&255,x=65535&de,!(N<=p);){if(c===0)break e;c--,h+=r[s++]<<p,p+=8}if(M&&(240&M)==0){for(B=N,Z=M,Q=x;de=n.lencode[Q+((h&(1<<B+Z)-1)>>B)],N=de>>>24,M=de>>>16&255,x=65535&de,!(B+N<=p);){if(c===0)break e;c--,h+=r[s++]<<p,p+=8}h>>>=B,p-=B,n.back+=B}if(h>>>=N,p-=N,n.back+=N,n.length=x,M===0){n.mode=16205;break}if(32&M){n.back=-1,n.mode=Rl;break}if(64&M){e.msg="invalid literal/length code",n.mode=br;break}n.extra=15&M,n.mode=16201;case 16201:if(n.extra){for(St=n.extra;p<St;){if(c===0)break e;c--,h+=r[s++]<<p,p+=8}n.length+=h&(1<<n.extra)-1,h>>>=n.extra,p-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=16202;case 16202:for(;de=n.distcode[h&(1<<n.distbits)-1],N=de>>>24,M=de>>>16&255,x=65535&de,!(N<=p);){if(c===0)break e;c--,h+=r[s++]<<p,p+=8}if((240&M)==0){for(B=N,Z=M,Q=x;de=n.distcode[Q+((h&(1<<B+Z)-1)>>B)],N=de>>>24,M=de>>>16&255,x=65535&de,!(B+N<=p);){if(c===0)break e;c--,h+=r[s++]<<p,p+=8}h>>>=B,p-=B,n.back+=B}if(h>>>=N,p-=N,n.back+=N,64&M){e.msg="invalid distance code",n.mode=br;break}n.offset=x,n.extra=15&M,n.mode=16203;case 16203:if(n.extra){for(St=n.extra;p<St;){if(c===0)break e;c--,h+=r[s++]<<p,p+=8}n.offset+=h&(1<<n.extra)-1,h>>>=n.extra,p-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){e.msg="invalid distance too far back",n.mode=br;break}n.mode=16204;case 16204:if(l===0)break e;if(v=g-l,n.offset>v){if(v=n.offset-v,v>n.whave&&n.sane){e.msg="invalid distance too far back",n.mode=br;break}v>n.wnext?(v-=n.wnext,O=n.wsize-v):O=n.wnext-v,v>n.length&&(v=n.length),I=n.window}else I=i,O=o-n.offset,v=n.length;v>l&&(v=l),l-=v,n.length-=v;do i[o++]=I[O++];while(--v);n.length===0&&(n.mode=HT);break;case 16205:if(l===0)break e;i[o++]=n.length,l--,n.mode=HT;break;case jI:if(n.wrap){for(;p<32;){if(c===0)break e;c--,h|=r[s++]<<p,p+=8}if(g-=l,e.total_out+=g,n.total+=g,4&n.wrap&&g&&(e.adler=n.check=_i(n)?Ni(n.check,i,g,o-g):mg(n.check,i,g,o-g)),g=l,4&n.wrap&&(_i(n)?h:UV(h))!==n.check){e.msg="incorrect data check",n.mode=br;break}h=0,p=0}n.mode=16207;case 16207:if(n.wrap&&_i(n)){for(;p<32;){if(c===0)break e;c--,h+=r[s++]<<p,p+=8}if(4&n.wrap&&h!==(4294967295&n.total)){e.msg="incorrect length check",n.mode=br;break}h=0,p=0}n.mode=16208;case 16208:te=q7;break e;case br:te=LV;break e;case 16210:return xV;default:return Xo}return e.next_out=o,e.avail_out=l,e.next_in=s,e.avail_in=c,n.hold=h,n.bits=p,(n.wsize||g!==e.avail_out&&n.mode<br&&(n.mode<jI||t!==kV))&&GV(e,e.output,e.next_out,g-e.avail_out),E-=e.avail_in,g-=e.avail_out,e.total_in+=E,e.total_out+=g,n.total+=g,4&n.wrap&&g&&(e.adler=n.check=_i(n)?Ni(n.check,i,g,e.next_out-g):mg(n.check,i,g,e.next_out-g)),e.data_type=n.bits+(n.last?64:0)+(n.mode===Rl?128:0)+(n.mode===GT||n.mode===VI?256:0),(E===0&&g===0||t===kV)&&te===Lh&&(te=J7),te},Cl={inflateReset:jV,inflateReset2:FV,inflateResetKeep:VV,inflateInit:e=>BV(e,15),inflateInit2:BV,inflate:$7,inflateEnd:e=>{if(xh(e))return Xo;let t=e.state;return t.window&&(t.window=null),e.state=null,Lh},inflateGetHeader:(e,t)=>{if(xh(e))return Xo;const n=e.state;return(2&n.wrap)==0?Xo:(n.head=t,t.done=!1,Lh)},inflateSetDictionary:(e,t)=>{const n=t.length;let r,i,s;return xh(e)?Xo:(r=e.state,r.wrap!==0&&r.mode!==WT?Xo:r.mode===WT&&(i=1,i=mg(i,t,n,0),i!==r.check)?LV:(s=GV(e,t,n,n),s?(r.mode=16210,xV):(r.havedict=1,Lh)))},inflateInfo:"pako inflate (from Nodeca project)"},eq=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const HV=Object.prototype.toString,{Z_NO_FLUSH:tq,Z_FINISH:nq,Z_OK:Cg,Z_STREAM_END:WI,Z_NEED_DICT:GI,Z_STREAM_ERROR:rq,Z_DATA_ERROR:KV,Z_MEM_ERROR:iq}=DT;function KT(e){this.options=xT.assign({chunkSize:65536,windowBits:15,to:""},e||{});const t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,t.windowBits===0&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&(15&t.windowBits)==0&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new PV,this.strm.avail_out=0;let n=Cl.inflateInit2(this.strm,t.windowBits);if(n!==Cg)throw new Error(Oh[n]);if(this.header=new eq,Cl.inflateGetHeader(this.strm,this.header),t.dictionary&&(typeof t.dictionary=="string"?t.dictionary=Tg.string2buf(t.dictionary):HV.call(t.dictionary)==="[object ArrayBuffer]"&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(n=Cl.inflateSetDictionary(this.strm,t.dictionary),n!==Cg)))throw new Error(Oh[n])}function sq(e,t){const n=new KT(t);if(n.push(e),n.err)throw n.msg||Oh[n.err];return n.result}KT.prototype.push=function(e,t){const n=this.strm,r=this.options.chunkSize,i=this.options.dictionary;let s,o,c;if(this.ended)return!1;for(o=t===~~t?t:t===!0?nq:tq,HV.call(e)==="[object ArrayBuffer]"?n.input=new Uint8Array(e):n.input=e,n.next_in=0,n.avail_in=n.input.length;;){for(n.avail_out===0&&(n.output=new Uint8Array(r),n.next_out=0,n.avail_out=r),s=Cl.inflate(n,o),s===GI&&i&&(s=Cl.inflateSetDictionary(n,i),s===Cg?s=Cl.inflate(n,o):s===KV&&(s=GI));n.avail_in>0&&s===WI&&n.state.wrap>0&&e[n.next_in]!==0;)Cl.inflateReset(n),s=Cl.inflate(n,o);switch(s){case rq:case KV:case GI:case iq:return this.onEnd(s),this.ended=!0,!1}if(c=n.avail_out,n.next_out&&(n.avail_out===0||s===WI))if(this.options.to==="string"){let l=Tg.utf8border(n.output,n.next_out),h=n.next_out-l,p=Tg.buf2string(n.output,l);n.next_out=h,n.avail_out=r-h,h&&n.output.set(n.output.subarray(l,l+h),0),this.onData(p)}else this.onData(n.output.length===n.next_out?n.output:n.output.subarray(0,n.next_out));if(s!==Cg||c!==0){if(s===WI)return s=Cl.inflateEnd(this.strm),this.onEnd(s),this.ended=!0,!0;if(n.avail_in===0)break}}return!0},KT.prototype.onData=function(e){this.chunks.push(e)},KT.prototype.onEnd=function(e){e===Cg&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=xT.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var oq={inflate:sq};const{deflate:aq}=B7,{inflate:cq}=oq;var lq=aq,dq=cq,zV=(function(e){return e[e.ONE_BYTE=0]="ONE_BYTE",e[e.TWO_BYTE=1]="TWO_BYTE",e})(zV||{});class uq{constructor(){k(this,"_sequence",0),k(this,"_startTime",Date.now()),k(this,"isUseOneByte",!0)}get startTime(){const t=Date.now()-this._startTime;return t<Math.pow(2,16)?t:(this._startTime+=Math.pow(2,16),this.startTime)}get sequence(){return this._sequence<Math.pow(2,32)?this._sequence++:(this._sequence-=Math.pow(2,32),this.sequence)}serialize(t){const n={commonPacketHeader:{length:0,reserved:0,extension:0,sequence:this.sequence},commonStreamHeader:this.startTime,extension:void 0,payload:t};if(t.byteLength>128){const c=new Uint8Array(4);c.set([1,0,0,0]);const l={id:0,length:4,data:c.buffer},h={profile:this.isUseOneByte?0:1,length:this.isUseOneByte?5:6,datas:[l]};n.commonPacketHeader.extension=1,n.extension=h,n.payload=this.compress(t),n.commonPacketHeader.length=8+(n.extension.length+2)+n.payload.byteLength}else n.commonPacketHeader.length=8+n.payload.byteLength;F("SHOW_DATASTREAM2_LOG")&&R.debug("send data header: ".concat(JSON.stringify(n.commonPacketHeader)));const r=new ArrayBuffer(n.commonPacketHeader.length),i=new Uint8Array(r),s=new DataView(r);let o=0;if(s.setUint16(o,n.commonPacketHeader.extension<<15|n.commonPacketHeader.reserved<<14|n.commonPacketHeader.length,!0),o+=2,s.setUint32(o,n.commonPacketHeader.sequence,!0),o+=4,s.setUint16(o,n.commonStreamHeader,!0),o+=2,n.extension){const c=this.serializeExtension(n.extension);i.set(new Uint8Array(c),o),o+=c.byteLength}if(i.set(new Uint8Array(n.payload),o),o+=n.payload.byteLength,o!==n.commonPacketHeader.length)throw Error("serialize error!");return r}deserialize(t){if(t.byteLength<4)return new ArrayBuffer(0);const n=new DataView(t);let r=0;const i=n.getUint16(r,!0);r+=2;const s={length:16383&i,reserved:(16384&i)>>14,extension:(32768&i)>>15,sequence:n.getUint16(r+2,!0)<<16|n.getUint16(r,!0)};let o,c;if(r+=4,F("SHOW_DATASTREAM2_LOG")&&R.debug("receive data header: ".concat(JSON.stringify(s))),n.getUint16(r,!0),r+=2,s.extension){c=this.deserializeExtension(t.slice(r)),r+=2+c.length,o=t.slice(r);let l=!1;if(c.datas.length>0){const h=c.datas.find((p=>p.id===0));h&&(l=(1&new DataView(h.data).getUint32(0,!0))==1)}o=l?this.decompress(o):o}else o=t.slice(8);return o}serializeExtension(t){const{profile:n,length:r,datas:i}=t,s=new ArrayBuffer(r+2),o=new Uint8Array(s),c=new DataView(s);let l=0;if(c.setUint8(l++,n),c.setUint8(l++,r),i.forEach((h=>{n?(c.setUint8(l++,h.id),c.setUint8(l++,h.length),o.set(new Uint8Array(h.data),l),l+=h.data.byteLength):(c.setUint8(l++,h.id|h.length<<4),o.set(new Uint8Array(h.data),l),l+=h.data.byteLength)})),l!==r+2)throw Error("serialize extension error, is ".concat(l,"!==").concat(r+2));return s}deserializeExtension(t){const n=new DataView(t);let r=0;const i=n.getUint8(r);r++;const s=n.getUint8(r);r++;const o=i===zV.TWO_BYTE,c=[],l=new DataView(t,2);let h=0;for(;h<s;){let p=0,E=0,g=new ArrayBuffer(0);o?(p=l.getUint8(h),h++,E=l.getUint8(h),h++):(p=15&l.getUint8(h),E=l.getUint8(h)>>4,h++),E>0&&(g=l.buffer.slice(h+2,h+2+E),h+=g.byteLength),c.push({id:p,length:E,data:g})}if(h!==s)throw Error("parse error");return{profile:i,length:s,datas:c}}decompress(t){return dq(new Uint8Array(t))}compress(t){return lq(new Uint8Array(t))}}const hq={name:"DataStream",create:(e,t)=>{const n=t?new yY(e):new SY(e);return n.useDataStream(new uq),n}};class pq extends Pn{constructor(t,n,r){super(),k(this,"ws",void 0),k(this,"requestId",1),k(this,"heartBeatTimer",void 0),k(this,"joinInfo",void 0),k(this,"clientId",void 0),k(this,"onOpen",(()=>{this.emit("open"),this.startHeartBeatCheck()})),k(this,"onClose",(i=>{this.emit("close"),this.dispose()})),k(this,"onMessage",(i=>{const s=JSON.parse(i.data);if(!s||s.command!=="serverResponse"||!s.requestId)return s&&s.command==="serverStatus"&&s.serverStatus&&s.serverStatus.command?(this.emit("status",s.serverStatus),void this.emit(s.serverStatus.command,s.serverStatus)):void 0;this.emit("req_".concat(s.requestId),s)})),this.joinInfo=t,this.clientId=n,this.ws=new JE("cross-channel-".concat(this.clientId),r),this.ws.on(gt.RECONNECTING,(()=>{this.ws.reconnectMode="retry",this.emit("reconnecting")})),this.ws.on(gt.CONNECTED,this.onOpen),this.ws.on(gt.ON_MESSAGE,this.onMessage),this.ws.on(gt.CLOSED,this.onClose)}isConnect(){return this.ws.state==="connected"}sendMessage(t){const n=this.requestId++;return t.requestId=n,t.seq=n,this.ws.sendMessage(t),n}waitStatus(t){return new Pe(((n,r)=>{const i=window.setTimeout((()=>{r(new se(U.TIMEOUT,"wait status timeout, status: ".concat(t)))}),5e3);this.once(t,(s=>{window.clearTimeout(i),s.state&&s.state!==0?r(new se(U.CROSS_CHANNEL_WAIT_STATUS_ERROR,"wait status error, status: ".concat(t))):n(void 0)})),this.once("dispose",(()=>{window.clearTimeout(i),r(new se(U.WS_ABORT))}))}))}async request(t){if(this.ws.state==="closed")throw new se(U.WS_DISCONNECT);const n=()=>new Pe(((o,c)=>{this.ws.once(gt.CLOSED,(()=>c(new se(U.WS_ABORT)))),this.ws.once(gt.CONNECTED,o)}));this.ws.state!=="connected"&&await n();const r=this.sendMessage(t),i=new Pe(((o,c)=>{const l=()=>{c(new se(U.WS_ABORT))};this.ws.once(gt.RECONNECTING,l),this.ws.once(gt.CLOSED,l),this.once("req_".concat(r),o),Dr(3e3).then((()=>{this.removeAllListeners("req_".concat(r)),this.ws.off(gt.RECONNECTING,l),this.ws.off(gt.CLOSED,l),c(new se(U.TIMEOUT,"cross channel ws request timeout"))}))})),s=await i;if(!s||s.code!==200)throw new se(U.CROSS_CHANNEL_SERVER_ERROR_RESPONSE,"response: ".concat(JSON.stringify(s)));return s}async connect(t){this.ws.removeAllListeners(gt.REQUEST_NEW_URLS),this.ws.on(gt.REQUEST_NEW_URLS,(n=>{n(t)})),await this.ws.init(t)}dispose(){this.clearHeartBeatCheck(),this.emit("dispose"),this.removeAllListeners(),this.ws.close()}sendPing(t){const n=this.requestId++;return t.requestId=n,this.ws.sendMessage(t),n}startHeartBeatCheck(){this.heartBeatTimer&&window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=window.setInterval((()=>{this.sendPing({command:"ping",appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sid:this.joinInfo.sid,ts:+new Date,requestId:0})}),3e3)}clearHeartBeatCheck(){window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=void 0}}class fq extends Pn{set state(t){t!==this._state&&(t!==es.RELAY_STATE_FAILURE&&(this.errorCode=Ff.RELAY_OK),this.emit("state",t,this.errorCode),this._state=t)}get state(){return this._state}constructor(t,n,r,i,s){super(),k(this,"joinInfo",void 0),k(this,"sid",void 0),k(this,"clientId",void 0),k(this,"cancelToken",Mi.CancelToken.source()),k(this,"workerToken",void 0),k(this,"requestId",0),k(this,"signal",void 0),k(this,"prevChannelMediaConfig",void 0),k(this,"httpRetryConfig",void 0),k(this,"_resolution",void 0),k(this,"_state",es.RELAY_STATE_IDLE),k(this,"errorCode",Ff.RELAY_OK),k(this,"onStatus",(o=>{R.debug("[".concat(this.clientId,"] ChannelMediaStatus: ").concat(JSON.stringify(o))),o&&o.command&&(o.command==="onAudioPacketReceived"&&this.emit("event",gl.PACKET_RECEIVED_AUDIO_FROM_SRC),o.command==="onVideoPacketReceived"&&this.emit("event",gl.PACKET_RECEIVED_VIDEO_FROM_SRC),o.command==="onSrcTokenPrivilegeDidExpire"&&(this.errorCode=Ff.SRC_TOKEN_EXPIRED,this.state=es.RELAY_STATE_FAILURE),o.command==="onDestTokenPrivilegeDidExpire"&&(this.errorCode=Ff.DEST_TOKEN_EXPIRED,this.state=es.RELAY_STATE_FAILURE))})),k(this,"onReconnect",(async()=>{R.debug("[".concat(this.clientId,"] ChannelMediaSocket disconnect, reconnecting")),this.emit("event",gl.NETWORK_DISCONNECTED),this.state=es.RELAY_STATE_IDLE,this.prevChannelMediaConfig&&this.sendStartRelayMessage(this.prevChannelMediaConfig).catch((o=>{this.state!==es.RELAY_STATE_IDLE&&(R.error("auto restart channel media relay failed",o.toString()),this.errorCode=Ff.SERVER_CONNECTION_LOST,this.state=es.RELAY_STATE_FAILURE)}))})),this.joinInfo=t,this.clientId=n,this.sid=_h(),this.signal=new pq(this.joinInfo,this.clientId,r),this.httpRetryConfig=i,this._resolution=s}async startChannelMediaRelay(t){if(this.state!==es.RELAY_STATE_IDLE)throw new se(U.INVALID_OPERATION);this.state=es.RELAY_STATE_CONNECTING,await this.connect(),R.debug("[".concat(this.clientId,"] startChannelMediaRelay: connect success"));try{await this.sendStartRelayMessage(t)}catch(n){throw n.data&&n.data.serverResponse&&n.data.serverResponse.command==="SetSourceChannel"?new se(U.CROSS_CHANNEL_FAILED_JOIN_SRC):n.data&&n.data.serverResponse&&n.serverResponse.command==="SetDestChannelStatus"?new se(U.CROSS_CHANNEL_FAILED_JOIN_DEST):n.data&&n.data.serverResponse&&n.serverResponse.command==="StartPacketTransfer"?new se(U.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST):n}this.prevChannelMediaConfig=t}async updateChannelMediaRelay(t){if(this.state!==es.RELAY_STATE_RUNNING)throw new se(U.INVALID_OPERATION);await this.sendUpdateMessage(t),this.prevChannelMediaConfig=t}async setVideoProfile(t){if(this._resolution=t,this.state!==es.RELAY_STATE_RUNNING)throw new se(U.INVALID_OPERATION);const n=this.genMessage(Ai.SetVideoProfile);await this.signal.request(n),R.debug("[".concat(this.clientId,"] startChannelMediaRelay: setVideoProfile success"))}async stopChannelMediaRelay(){await this.sendStopRelayMessage(),R.debug("[".concat(this.clientId,"] stopChannelMediaRelay: send stop message success")),this.state=es.RELAY_STATE_IDLE,this.dispose()}dispose(){R.debug("[".concat(this.clientId,"] disposeChannelMediaRelay")),this.cancelToken.cancel(),this.cancelToken=Mi.CancelToken.source(),this.state=es.RELAY_STATE_IDLE,this.emit("dispose"),this.signal.dispose(),this.prevChannelMediaConfig=void 0}async connect(){const t=await b9(this.joinInfo,this.cancelToken.token,this.httpRetryConfig);this.workerToken=t.workerToken,await this.signal.connect(t.addressList),this.emit("event",gl.NETWORK_CONNECTED),this.signal.on("status",this.onStatus),this.signal.on("reconnecting",this.onReconnect)}async sendStartRelayMessage(t){const n=this.genMessage(Ai.StopPacketTransfer);await this.signal.request(n),await this.signal.waitStatus("Normal Quit"),R.debug("[".concat(this.clientId,"] startChannelMediaRelay: StopPacketTransfer success"));const r=this.genMessage(Ai.SetSdkProfile,t);await this.signal.request(r),R.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSdkProfile success"));const i=this.genMessage(Ai.SetSourceChannel,t);await this.signal.request(i),await this.signal.waitStatus("SetSourceChannelStatus"),this.emit("event",gl.PACKET_JOINED_SRC_CHANNEL),R.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceChannel success"));const s=this.genMessage(Ai.SetSourceUserId,t);await this.signal.request(s),R.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceUserId success"));const o=this.genMessage(Ai.SetDestChannel,t);await this.signal.request(o),await this.signal.waitStatus("SetDestChannelStatus"),this.emit("event",gl.PACKET_JOINED_DEST_CHANNEL),R.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetDestChannel success"));const c=this.genMessage(Ai.StartPacketTransfer,t);await this.signal.request(c),this.emit("event",gl.PACKET_SENT_TO_DEST_CHANNEL),this.state=es.RELAY_STATE_RUNNING,R.debug("[".concat(this.clientId,"] startChannelMediaRelay: StartPacketTransfer success")),this.setVideoProfile(this._resolution)}async sendUpdateMessage(t){const n=this.genMessage(Ai.UpdateDestChannel,t);await this.signal.request(n),this.emit("event",gl.PACKET_UPDATE_DEST_CHANNEL),R.debug("[".concat(this.clientId,"] sendUpdateMessage: UpdateDestChannel success"))}async sendStopRelayMessage(){const t=this.genMessage(Ai.StopPacketTransfer);await this.signal.request(t),R.debug("[".concat(this.clientId,"] sendStopRelayMessage: StopPacketTransfer success"))}genMessage(t,n){const r=[],i=[],s=[];this.requestId+=1;const o={appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sdkVersion:to,sid:this.sid,ts:Date.now(),requestId:this.requestId,seq:this.requestId,allocate:!0,clientRequest:{}};o.sdkVersion==="4.24.0"&&(o.sdkVersion="0.0.1");let c=null,l=null;switch(t){case Ai.SetSdkProfile:return o.clientRequest={command:"SetSdkProfile",type:"multi_channel"},o;case Ai.SetSourceChannel:if(l=n&&n.getSrcChannelMediaInfo(),!l)throw new se(U.UNEXPECTED_ERROR,"can not find source config");return o.clientRequest={command:"SetSourceChannel",uid:"0",channelName:l.channelName,token:l.token||this.joinInfo.appId},o;case Ai.SetSourceUserId:if(l=n&&n.getSrcChannelMediaInfo(),!l)throw new se(U.UNEXPECTED_ERROR,"can not find source config");return o.clientRequest={command:"SetSourceUserId",uid:l.uid+""},o;case Ai.SetDestChannel:if(c=n&&n.getDestChannelMediaInfo(),!c)throw new se(U.UNEXPECTED_ERROR,"can not find dest config");return c.forEach((h=>{r.push(h.channelName),i.push(h.uid+""),s.push(h.token||this.joinInfo.appId)})),o.clientRequest={command:"SetDestChannel",channelName:r,uid:i,token:s},o;case Ai.StartPacketTransfer:return o.clientRequest={command:"StartPacketTransfer"},o;case Ai.Reconnect:return o.clientRequest={command:"Reconnect"},o;case Ai.StopPacketTransfer:return o.clientRequest={command:"StopPacketTransfer"},o;case Ai.UpdateDestChannel:if(c=n&&n.getDestChannelMediaInfo(),!c)throw new se(U.UNEXPECTED_ERROR,"can not find dest config");return c.forEach((h=>{r.push(h.channelName),i.push(h.uid+""),s.push(h.token||this.joinInfo.appId)})),o.clientRequest={command:"UpdateDestChannel",channelName:r,uid:i,token:s},o;case Ai.SetVideoProfile:o.clientRequest={command:"SetVideoProfile",width:this._resolution.width,height:this._resolution.height}}return o}}const mq={name:"ChannelMediaRelay",create:function(e){return new fq(e.joinInfo,e.clientId,e.websocketRetryConfig||rr,e.httpRetryConfig||rr,e.resolution)}};function YV(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable}))),n.push.apply(n,r)}return n}function wg(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?YV(Object(n),!0).forEach((function(r){k(e,r,n[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):YV(Object(n)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))}))}return e}class _q extends Pn{constructor(t,n,r,i){super(),k(this,"spec",void 0),k(this,"token",void 0),k(this,"websocket",void 0),k(this,"pingpongTimer",void 0),k(this,"reconnectMode","retry"),k(this,"serviceMode",void 0),k(this,"reqId",0),k(this,"commandReqId",0),k(this,"handleWebSocketOpen",(()=>{this.reconnectMode="retry",this.startPingPong()})),k(this,"handleWebSocketMessage",(s=>{if(!s.data)return;const o=JSON.parse(s.data);o.requestId?this.emit("@".concat(o.requestId,"-").concat(o.sid),o):(We.workerEvent(this.spec.sid,{actionType:"status",serverCode:o.code,workerType:this.serviceMode===El.TRANSCODE?1:2}),this.emit(Nd.PUBLISH_STREAM_STATUS,o))})),this.spec=n,this.token=t,this.serviceMode=i,this.websocket=new JE("live-streaming",r),this.websocket.on(gt.CONNECTED,this.handleWebSocketOpen),this.websocket.on(gt.ON_MESSAGE,this.handleWebSocketMessage),this.websocket.on(gt.REQUEST_NEW_URLS,((s,o)=>{Fr(this,Nd.REQUEST_NEW_ADDRESS).then(s).catch(o)})),this.websocket.on(gt.RECONNECTING,(()=>{this.websocket.reconnectMode=this.reconnectMode}))}init(t){return this.websocket.init(t)}async request(t,n,r,i){this.reqId+=1,t==="request"&&(this.commandReqId+=1);const s=this.commandReqId,o=this.reqId;if(!o||!this.websocket)throw new se(U.UNEXPECTED_ERROR);const c=wg({command:t,sdkVersion:to==="4.24.0"?"0.0.1":to,seq:o,requestId:o,allocate:r,cname:this.spec.cname,appId:this.spec.appId,sid:this.spec.sid,uid:this.spec.uid.toString(),ts:Math.floor(Date.now()/1e3)},n);if(this.websocket.state==="closed")throw new se(U.WS_DISCONNECT);const l=()=>new Pe(((g,v)=>{this.websocket.once(gt.CLOSED,(()=>v(new se(U.WS_ABORT)))),this.websocket.once(gt.CONNECTED,g)}));this.websocket.state!=="connected"&&await l(),c.clientRequest&&(c.clientRequest.workerToken=this.token);const h=new Pe(((g,v)=>{const O=()=>{v(new se(U.WS_ABORT))};this.websocket.once(gt.RECONNECTING,O),this.websocket.once(gt.CLOSED,O),this.once("@".concat(o,"-").concat(this.spec.sid),(I=>{g(I)}))}));i&&We.workerEvent(this.spec.sid,wg(wg({},i),{},{requestId:s,actionType:"request",payload:JSON.stringify(n.clientRequest),serverCode:0,code:0}));const p=Date.now();this.websocket.sendMessage(c);let E=null;try{E=await h}catch(g){if(this.websocket.state==="closed")throw g;return await l(),await this.request(t,n,r)}return i&&We.workerEvent(this.spec.sid,wg(wg({},i),{},{requestId:s,actionType:"response",payload:JSON.stringify(E.serverResponse),serverCode:E.code,success:E.code===200,responseTime:Date.now()-p})),E.code!==200&&this.handleResponseError(E),E}tryNextAddress(){this.reconnectMode="tryNext",this.websocket.reconnect("tryNext")}close(){const t=to==="4.24.0"?"0.0.1":to;this.reqId+=1,this.websocket.state==="connected"?(this.websocket.sendMessage({command:"request",appId:this.spec.appId,cname:this.spec.cname,uid:this.spec.uid.toString(),sdkVersion:t,sid:this.spec.sid,seq:this.reqId,ts:Math.floor(Date.now()/1e3),requestId:this.reqId,clientRequest:{command:"DestroyWorker"}}),this.websocket.close(!1,!0)):this.websocket.close(!1),this.pingpongTimer&&(window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0)}handleResponseError(t){switch(t.code){case cr.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM:return void R.warning("live stream response already exists stream");case cr.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR:case cr.LIVE_STREAM_RESPONSE_BAD_STREAM:case cr.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR:return new se(U.LIVE_STREAMING_INVALID_ARGUMENT,"",{code:t.code}).throw();case cr.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST:if(t.serverResponse.command==="UnpublishStream")return;throw new se(U.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case cr.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED:return new se(U.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED,"",{code:t.code}).throw();case cr.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const n=new se(U.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE);return this.emit(Nd.WARNING,n,t.serverResponse.url)}case cr.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN:{const n=new se(U.LIVE_STREAMING_WARN_FREQUENT_REQUEST);return this.emit(Nd.WARNING,n,t.serverResponse.url)}case cr.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH:throw new se(U.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case cr.LIVE_STREAM_RESPONSE_NOT_SUPPORTED:return new se(U.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED,"",{code:t.code}).throw();case cr.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM:{const n=new se(U.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT);return this.emit(Nd.WARNING,n,t.serverResponse.url)}case cr.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR:return new se(U.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:t.code}).throw();case cr.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT:throw new se(U.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream resource limit",{retry:!0,changeAddress:!0});case cr.LIVE_STREAM_RESPONSE_WORKER_LOST:case cr.LIVE_STREAM_RESPONSE_WORKER_QUIT:if(t.serverResponse.command==="UnpublishStream")return;throw new se(U.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case cr.ERROR_FAIL_SEND_MESSAGE:if(t.serverResponse.command==="UnpublishStream")return;if(t.serverResponse.command==="UpdateTranscoding"||t.serverResponse.command==="ControlStream")return new se(U.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{code:t.code}).throw();throw new se(U.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case cr.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case cr.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case cr.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case cr.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:return new se(U.LIVE_STREAMING_CDN_ERROR,"",{code:t.code}).throw()}}startPingPong(){this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval((()=>{this.websocket.state==="connected"&&this.request("ping",{}).catch(OS)}),6e3)}}function qV(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable}))),n.push.apply(n,r)}return n}function ts(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?qV(Object(n),!0).forEach((function(r){k(e,r,n[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):qV(Object(n)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))}))}return e}class Eq extends Pn{constructor(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:rr,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:rr;super(),k(this,"onLiveStreamWarning",void 0),k(this,"onLiveStreamError",void 0),k(this,"spec",void 0),k(this,"retryTimeout",1e4),k(this,"connection",void 0),k(this,"httpRetryConfig",void 0),k(this,"wsRetryConfig",void 0),k(this,"streamingTasks",new Map),k(this,"isStartingStreamingTask",!1),k(this,"taskMutex",new Yr("live-streaming")),k(this,"cancelToken",Mi.CancelToken.source()),k(this,"transcodingConfig",void 0),k(this,"uapResponse",void 0),k(this,"lastTaskId",1),k(this,"statusError",new Map),this.spec=t,this.httpRetryConfig=r,this.wsRetryConfig=n}async setTranscodingConfig(t){const n=ts(ts({},i9),t);n.videoCodecProfile!==66&&n.videoCodecProfile!==77&&n.videoCodecProfile!==100&&(R.debug("[".concat(this.spec.clientId,"] set transcoding config, fix video codec profile: ").concat(n.videoCodecProfile," -> 100")),n.videoCodecProfile=100),n.transcodingUsers||(n.transcodingUsers=n.userConfigs),n.transcodingUsers&&(n.transcodingUsers=n.transcodingUsers.map((o=>ts(ts(ts({},r9),o),{},{zOrder:o.zOrder?o.zOrder+1:1})))),(function(o){Mn(o.width)||on(o.width,"config.width",0,1e4),Mn(o.height)||on(o.height,"config.height",0,1e4),Mn(o.videoBitrate)||on(o.videoBitrate,"config.videoBitrate",1,1e6),Mn(o.videoFrameRate)||on(o.videoFrameRate,"config.videoFrameRate"),Mn(o.lowLatency)||Sa(o.lowLatency,"config.lowLatency"),Mn(o.audioSampleRate)||hr(o.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),Mn(o.audioBitrate)||on(o.audioBitrate,"config.audioBitrate",1,128),Mn(o.audioChannels)||hr(o.audioChannels,"config.audioChannels",[1,2,3,4,5]),Mn(o.videoGop)||on(o.videoGop,"config.videoGop"),Mn(o.videoCodecProfile)||hr(o.videoCodecProfile,"config.videoCodecProfile",[66,77,100]),Mn(o.userCount)||on(o.userCount,"config.userCount",0,17),Mn(o.backgroundColor)||on(o.backgroundColor,"config.backgroundColor",0,16777215),Mn(o.userConfigExtraInfo)||Pr(o.userConfigExtraInfo,"config.userConfigExtraInfo",0,4096,!1),o.transcodingUsers&&!Mn(o.transcodingUsers)&&(_l(o.transcodingUsers,"config.transcodingUsers"),o.transcodingUsers.forEach(((c,l)=>{eT(c.uid),Mn(c.x)||on(c.x,"transcodingUser[".concat(l,"].x"),0,1e4),Mn(c.y)||on(c.y,"transcodingUser[".concat(l,"].y"),0,1e4),Mn(c.width)||on(c.width,"transcodingUser[".concat(l,"].width"),0,1e4),Mn(c.height)||on(c.height,"transcodingUser[".concat(l,"].height"),0,1e4),Mn(c.zOrder)||on(c.zOrder-1,"transcodingUser[".concat(l,"].zOrder"),0,100),Mn(c.alpha)||on(c.alpha,"transcodingUser[".concat(l,"].alpha"),0,1,!1)}))),Mn(o.watermark)||Wb(o.watermark,"watermark"),Mn(o.backgroundImage)||Wb(o.backgroundImage,"backgroundImage"),o.images&&!Mn(o.images)&&(_l(o.images,"config.images"),o.images.forEach(((c,l)=>{Wb(c,"images[".concat(l,"]"))})))})(n);const r=[];n.images&&r.push(...n.images.map((o=>ts(ts(ts({},Bb),o),{},{zOrder:255})))),n.backgroundImage&&(r.push(ts(ts(ts({},Bb),n.backgroundImage),{},{zOrder:0})),delete n.backgroundImage),n.watermark&&(r.push(ts(ts(ts({},Bb),n.watermark),{},{zOrder:255})),delete n.watermark),n.images=r,n.transcodingUsers&&(n.userConfigs=n.transcodingUsers.map((o=>ts({},o))),n.userCount=n.transcodingUsers.length,delete n.transcodingUsers);const i=(n.userConfigs||[]).map((o=>typeof o.uid=="number"?Pe.resolve(o.uid):v2(o.uid,this.spec,this.cancelToken.token,this.httpRetryConfig)));if((await Pe.all(i)).forEach(((o,c)=>{n.userConfigs&&n.userConfigs[c]&&(n.userConfigs[c].uid=o)})),this.transcodingConfig=n,this.connection)try{var s;const o=await this.connection.request("request",{clientRequest:{command:"UpdateTranscoding",transcodingConfig:this.transcodingConfig}},!1,{command:"UpdateTranscoding",workerType:1,requestByUser:!0,tid:Array.from(ps(s=this.streamingTasks).call(s)).map((c=>c.taskId)).join("#")});R.debug("[".concat(this.spec.clientId,"] update live transcoding config success, code: ").concat(o.code,", config:"),JSON.stringify(this.transcodingConfig))}catch(o){if(!o.data||!o.data.retry)throw o;o.data.changeAddress&&this.connection.tryNextAddress(),this.streamingTasks.forEach((c=>{R.warning("[".concat(this.spec.clientId,"] live streaming receive error"),o.toString(),"try to republish",c.url),this.startLiveStreamingTask(c.url,c.mode,o).then((()=>{R.debug("[".concat(this.spec.clientId,"] live streaming republish ").concat(c.url," success"))})).catch((l=>{R.error("[".concat(this.spec.clientId,"] live streaming republish failed"),c.url,l.toString()),this.onLiveStreamError&&this.onLiveStreamError(c.url,l)}))}))}}async startLiveStreamingTask(t,n,r){if(!this.transcodingConfig&&n===El.TRANSCODE)throw new se(U.INVALID_OPERATION,"[LiveStreaming] no transcoding config found, can not start transcoding streaming task");const i={command:"PublishStream",ts:Date.now(),url:t,uid:this.spec.uid.toString(),autoDestroyTime:100,acceptImageTimeout:!0};R.debug("[".concat(this.spec.clientId,"] start live streaming ").concat(t,", mode: ").concat(n));const s=await this.taskMutex.lock();if(!this.connection&&r)return void s();if(this.streamingTasks.get(t)&&!r)return s(),new se(U.LIVE_STREAMING_TASK_CONFLICT).throw();try{this.connection||(this.connection=await this.connect(n))}catch(c){throw s(),c}switch(n){case El.TRANSCODE:i.transcodingConfig=ts({},this.transcodingConfig)}this.uapResponse&&this.uapResponse.vid&&(i.vid=this.uapResponse.vid),this.isStartingStreamingTask=!0;const o=this.lastTaskId++;try{const c=new Pe(((h,p)=>{Dr(this.retryTimeout).then((()=>{if(r)return p(r);const E=this.statusError.get(t);return E?(this.statusError.delete(t),p(E)):void 0}))})),l=await Pe.race([this.connection.request("request",{clientRequest:i},!0,{url:t,command:"PublishStream",workerType:n===El.TRANSCODE?1:2,requestByUser:!r,tid:o.toString()}),c]);this.isStartingStreamingTask=!1,R.debug("[".concat(this.spec.clientId,"] live streaming started, code: ").concat(l.code)),this.streamingTasks.set(t,{clientRequest:i,mode:n,url:t,taskId:o}),s()}catch(c){if(s(),this.isStartingStreamingTask=!1,!c.data||!c.data.retry||r)throw c;return c.data.changeAddress?(this.connection.tryNextAddress(),await this.startLiveStreamingTask(t,n,c)):await this.startLiveStreamingTask(t,n,c)}}stopLiveStreamingTask(t){return new Pe(((n,r)=>{const i=this.streamingTasks.get(t);if(!i||!this.connection)return new se(U.UNEXPECTED_ERROR,"can not find streaming task to stop").throw();const s=i.mode;i.abortTask=()=>{R.debug("[".concat(this.spec.clientId,"] stop live streaming success(worker exception)")),this.streamingTasks.delete(t),n()},this.connection.request("request",{clientRequest:{command:"UnpublishStream",url:i.url}},!1,{url:t,command:"UnPublishStream",workerType:s===El.TRANSCODE?1:2,requestByUser:!0,tid:(this.lastTaskId++).toString()}).then((o=>{R.debug("[".concat(this.spec.clientId,"] stop live streaming success, code: ").concat(o.code)),this.streamingTasks.delete(t),this.streamingTasks.size===0&&(this.connection&&this.connection.close(),this.connection=void 0),n()})).catch(r)}))}resetAllTask(){var t;const n=Array.from(ps(t=this.streamingTasks).call(t));this.terminate();for(const r of n)this.startLiveStreamingTask(r.url,r.mode).catch((i=>{this.onLiveStreamError&&this.onLiveStreamError(r.url,i)}))}terminate(){this.cancelToken&&this.cancelToken.cancel(),this.streamingTasks=new Map,this.isStartingStreamingTask=!1,this.statusError=new Map,this.cancelToken=Mi.CancelToken.source(),this.uapResponse=void 0,this.connection&&this.connection.close(),this.connection=void 0}async connect(t){if(this.connection)throw new se(U.UNEXPECTED_ERROR,"live streaming connection has already connected");const n=await Fr(this,Gb.REQUEST_WORKER_MANAGER_LIST,t);return this.uapResponse=n,this.connection=new _q(n.workerToken,this.spec,this.wsRetryConfig,t),this.connection.on(Nd.WARNING,((r,i)=>this.onLiveStreamWarning&&this.onLiveStreamWarning(i,r))),this.connection.on(Nd.PUBLISH_STREAM_STATUS,(r=>this.handlePublishStreamServer(r))),this.connection.on(Nd.REQUEST_NEW_ADDRESS,((r,i)=>{if(!this.connection)return i(new se(U.UNEXPECTED_ERROR,"can not get new live streaming address list"));Fr(this,Gb.REQUEST_WORKER_MANAGER_LIST,t).then((s=>{this.uapResponse=s,r(s.addressList)})).catch(i)})),await this.connection.init(n.addressList),this.connection}handlePublishStreamServer(t){const n=t.serverStatus&&t.serverStatus.url||"empty_url",r=this.streamingTasks.get(n),i=t.reason;switch(t.code){case cr.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case cr.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case cr.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case cr.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:{const o=new se(U.LIVE_STREAMING_CDN_ERROR,"",{code:t.code});if(r)return R.error(o.toString()),this.onLiveStreamError&&this.onLiveStreamError(n,o);if(!this.isStartingStreamingTask)return;this.statusError.set(n,o)}case cr.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const o=new se(U.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE,i);return this.onLiveStreamWarning&&this.onLiveStreamWarning(n,o)}case cr.LIVE_STREAM_RESPONSE_WORKER_LOST:case cr.LIVE_STREAM_RESPONSE_WORKER_QUIT:{var s;if(!this.connection)return;this.connection.tryNextAddress();const o=Array.from(ps(s=this.streamingTasks).call(s));for(const c of o)c.abortTask?c.abortTask():(R.warning("[".concat(this.spec.clientId,"] publish stream status code"),t.code,"try to republish",c.url),this.startLiveStreamingTask(c.url,c.mode,new se(U.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:t.code})).then((()=>{R.debug("[".concat(this.spec.clientId,"] republish live stream success"),c.url)})).catch((l=>{R.error(l.toString()),this.onLiveStreamError&&this.onLiveStreamError(c.url,l)})));return}}}hasUrl(t){return this.streamingTasks.has(t)}}const gq={name:"LiveStreaming",create:function(e){return new Eq(e.joinInfo,e.websocketRetryConfig||rr,e.httpRetryConfig||rr)}};function vq(e){let t=QV();return(function(n,r){let i=n.appId;i!==void 0&&(tn(r,10),kc(r,i));let s=n.cid;s!==void 0&&(tn(r,16),tn(r,s));let o=n.cname;o!==void 0&&(tn(r,26),kc(r,o));let c=n.deviceId;c!==void 0&&(tn(r,34),kc(r,c));let l=n.elapse;l!==void 0&&(tn(r,40),Kd(r,l));let h=n.fileSize;h!==void 0&&(tn(r,48),Kd(r,rm(h)));let p=n.height;p!==void 0&&(tn(r,56),Kd(r,rm(p)));let E=n.jpg;E!==void 0&&(tn(r,66),tn(r,E.length),(function(Zr,fe){let we=im(Zr,fe.length);Zr.bytes.set(fe,we)})(r,E));let g=n.networkType;g!==void 0&&(tn(r,72),Kd(r,rm(g)));let v=n.osType;v!==void 0&&(tn(r,80),Kd(r,rm(v)));let O=n.requestId;O!==void 0&&(tn(r,90),kc(r,O));let I=n.sdkVersion;I!==void 0&&(tn(r,98),kc(r,I));let N=n.sequence;N!==void 0&&(tn(r,104),Kd(r,rm(N)));let M=n.sid;M!==void 0&&(tn(r,114),kc(r,M));let x=n.timestamp;x!==void 0&&(tn(r,120),Kd(r,x));let B=n.uid;B!==void 0&&(tn(r,128),tn(r,B));let Z=n.vid;Z!==void 0&&(tn(r,136),tn(r,Z));let Q=n.width;Q!==void 0&&(tn(r,144),Kd(r,rm(Q)));let z=n.service;z!==void 0&&(tn(r,152),tn(r,z));let te=n.callbackData;te!==void 0&&(tn(r,162),kc(r,te));let de=n.jpgEncryption;de!==void 0&&(tn(r,168),tn(r,de));let me=n.requestType;me!==void 0&&(tn(r,176),tn(r,me));let ve=n.scorePorn;ve!==void 0&&(tn(r,185),qI(r,ve));let St=n.scoreSexy;St!==void 0&&(tn(r,193),qI(r,St));let wt=n.scoreNeutral;wt!==void 0&&(tn(r,201),qI(r,wt));let ot=n.scene;ot!==void 0&&(tn(r,208),tn(r,ot));let Xt=n.ossFilePrefix;Xt!==void 0&&(tn(r,218),kc(r,Xt));let zt=n.serviceVendor;if(zt!==void 0)for(let Zr of zt){tn(r,226);let fe=QV();Tq(Zr,fe),tn(r,fe.limit),bq(r,fe),wq(fe)}})(e,t),(function(n){let r=n.bytes,i=n.limit;return r.length===i?r:r.subarray(0,i)})(t)}function yq(e){return(function(n){let r={};e:for(;!ZV(n);){let i=Lc(n);switch(i>>>3){case 0:break e;case 1:r.code=Lc(n);break;case 2:r.msg=$V(n,Lc(n));break;case 3:{let s=Rq(n);r.data=Sq(n),n.limit=s;break}default:XV(n,7&i)}}return r})({bytes:t=e,offset:0,limit:t.length});var t}function Sq(e){let t={};e:for(;!ZV(e);){let n=Lc(e);switch(n>>>3){case 0:break e;case 1:t.requestId=$V(e,Lc(e));break;case 2:t.requestType=Lc(e)>>>0;break;case 3:t.scorePorn=YI(e);break;case 4:t.scoreSexy=YI(e);break;case 5:t.scoreNeutral=YI(e);break;case 6:t.requestScene=Lc(e)>>>0;break;case 7:t.scene=Lc(e)>>>0;break;default:XV(e,7&n)}}return t}function Tq(e,t){let n=e.service;n!==void 0&&(tn(t,8),tn(t,n));let r=e.vendor;r!==void 0&&(tn(t,16),tn(t,r));let i=e.token;i!==void 0&&(tn(t,26),kc(t,i));let s=e.callbackUrl;s!==void 0&&(tn(t,34),kc(t,s))}function Rq(e){let t=Lc(e),n=e.limit;return e.limit=e.offset+t,n}function XV(e,t){switch(t){case 0:for(;128&ej(e););break;case 2:KI(e,Lc(e));break;case 5:KI(e,4);break;case 1:KI(e,8);break;default:throw new Error("Unimplemented type: "+t)}}let Cq=new Float32Array(1);new Uint8Array(Cq.buffer);let HI=new Float64Array(1),ns=new Uint8Array(HI.buffer);function rm(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}let JV=[];function QV(){const e=JV.pop();return e?(e.offset=e.limit=0,e):{bytes:new Uint8Array(64),offset:0,limit:0}}function wq(e){JV.push(e)}function KI(e,t){if(e.offset+t>e.limit)throw new Error("Skip past limit");e.offset+=t}function ZV(e){return e.offset>=e.limit}function im(e,t){let n=e.bytes,r=e.offset,i=e.limit,s=r+t;if(s>n.length){let o=new Uint8Array(2*s);o.set(n),e.bytes=o}return e.offset=s,s>i&&(e.limit=s),r}function zI(e,t){let n=e.offset;if(n+t>e.limit)throw new Error("Read past limit");return e.offset+=t,n}function $V(e,t){let n=zI(e,t),r=String.fromCharCode,i=e.bytes,s="",o="";for(let c=0;c<t;c++){let l,h,p,E,g=i[c+n];(128&g)==0?o+=r(g):(224&g)==192?c+1>=t?o+=s:(l=i[c+n+1],(192&l)!=128?o+=s:(E=(31&g)<<6|63&l,E<128?o+=s:(o+=r(E),c++))):(240&g)==224?c+2>=t?o+=s:(l=i[c+n+1],h=i[c+n+2],(49344&(l|h<<8))!=32896?o+=s:(E=(15&g)<<12|(63&l)<<6|63&h,E<2048||E>=55296&&E<=57343?o+=s:(o+=r(E),c+=2))):(248&g)==240?c+3>=t?o+=s:(l=i[c+n+1],h=i[c+n+2],p=i[c+n+3],(12632256&(l|h<<8|p<<16))!=8421504?o+=s:(E=(7&g)<<18|(63&l)<<12|(63&h)<<6|63&p,E<65536||E>1114111?o+=s:(E-=65536,o+=r(55296+(E>>10),56320+(1023&E)),c+=3))):o+=s}return o}function kc(e,t){let n=t.length,r=0;for(let o=0;o<n;o++){let c=t.charCodeAt(o);c>=55296&&c<=56319&&o+1<n&&(c=(c<<10)+t.charCodeAt(++o)-56613888),r+=c<128?1:c<2048?2:c<65536?3:4}tn(e,r);let i=im(e,r),s=e.bytes;for(let o=0;o<n;o++){let c=t.charCodeAt(o);c>=55296&&c<=56319&&o+1<n&&(c=(c<<10)+t.charCodeAt(++o)-56613888),c<128?s[i++]=c:(c<2048?s[i++]=c>>6&31|192:(c<65536?s[i++]=c>>12&15|224:(s[i++]=c>>18&7|240,s[i++]=c>>12&63|128),s[i++]=c>>6&63|128),s[i++]=63&c|128)}}function bq(e,t){let n=im(e,t.limit),r=e.bytes,i=t.bytes;for(let s=0,o=t.limit;s<o;s++)r[s+n]=i[s]}function ej(e){return e.bytes[zI(e,1)]}function tj(e,t){let n=im(e,1);e.bytes[n]=t}function YI(e){let t=zI(e,8),n=e.bytes;return ns[0]=n[t++],ns[1]=n[t++],ns[2]=n[t++],ns[3]=n[t++],ns[4]=n[t++],ns[5]=n[t++],ns[6]=n[t++],ns[7]=n[t++],HI[0]}function qI(e,t){let n=im(e,8),r=e.bytes;HI[0]=t,r[n++]=ns[0],r[n++]=ns[1],r[n++]=ns[2],r[n++]=ns[3],r[n++]=ns[4],r[n++]=ns[5],r[n++]=ns[6],r[n++]=ns[7]}function Lc(e){let t,n=0,r=0;do t=ej(e),n<32&&(r|=(127&t)<<n),n+=7;while(128&t);return r}function tn(e,t){for(t>>>=0;t>=128;)tj(e,127&t|128),t>>>=7;tj(e,t)}function Kd(e,t){let n=t.low>>>0,r=(t.low>>>28|t.high<<4)>>>0,i=t.high>>>24,s=i===0?r===0?n<16384?n<128?1:2:n<1<<21?3:4:r<16384?r<128?5:6:r<1<<21?7:8:i<128?9:10,o=im(e,s),c=e.bytes;switch(s){case 10:c[o+9]=i>>>7&1;case 9:c[o+8]=s!==9?128|i:127&i;case 8:c[o+7]=s!==8?r>>>21|128:r>>>21&127;case 7:c[o+6]=s!==7?r>>>14|128:r>>>14&127;case 6:c[o+5]=s!==6?r>>>7|128:r>>>7&127;case 5:c[o+4]=s!==5?128|r:127&r;case 4:c[o+3]=s!==4?n>>>21|128:n>>>21&127;case 3:c[o+2]=s!==3?n>>>14|128:n>>>14&127;case 2:c[o+1]=s!==2?n>>>7|128:n>>>7&127;case 1:c[o]=s!==1?128|n:127&n}}function nj(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable}))),n.push.apply(n,r)}return n}const Iq=new Map([["moderation",1],["supervise",2]]);class Aq extends Pn{get connectionState(){return this._connectionState}set connectionState(t){if(this._connectionState===t)return;const n=this._connectionState;this._connectionState=t,this.emit(wr.CONNECTION_STATE_CHANGE,n,t)}get inspectType(){return this._inspectType}set inspectType(t){var n;this._inspectMode=zi(n=t.map((r=>Iq.get(r)||0))).call(n,((r,i)=>r+i)),this._inspectType=t}get quality(){return this._quality}set quality(t){this._quality=t>1?1:t<.1?.1:t,this.qualityTimer&&(window.clearTimeout(this.qualityTimer),this.qualityTimer=null),this._quality>=1||(this.qualityTimer=window.setTimeout((()=>{this.quality=this._quality/this.qualityRatio}),6e4))}constructor(t){super(),k(this,"name","AgoraRTCVideoContentInspect"),k(this,"_connectionState",Go.CONNECTING),k(this,"_innerConnectionState",void 0),k(this,"sequence",0),k(this,"inspectStartTime",void 0),k(this,"workerManagerConnection",void 0),k(this,"workerConnection",void 0),k(this,"workerMessageLengthLimit",void 0),k(this,"inspectIntervalMinimum",void 0),k(this,"qualityRatio",void 0),k(this,"_connectInfo",void 0),k(this,"_cancelTokenSource",Mi.CancelToken.source()),k(this,"_retryConfig",void 0),k(this,"wmSequence",0),k(this,"inspectInterval",void 0),k(this,"inspectTimer",null),k(this,"ossFilePrefix",void 0),k(this,"extraInfo",void 0),k(this,"_inspectType",void 0),k(this,"_inspectMode",void 0),k(this,"_quality",1),k(this,"qualityTimer",null),k(this,"_inspectId",void 0),k(this,"_needWorkUrlOnly",!1),k(this,"inspectImage",(()=>{if(this.connectionState!==Go.CONNECTED)throw new se(U.OPERATION_ABORTED,"content inspect service connection status is ".concat(this.connectionState));this.inspectTimer&&(window.clearInterval(this.inspectTimer),this.inspectTimer=null),this.inspectTimer=window.setInterval((()=>{this.connectionState===Go.CONNECTED?this.requestToInspectImage():R.debug("[".concat(this._inspectId,"] Inspect State is not connected , "),this.connectionState)}),this.inspectInterval<this.inspectIntervalMinimum?this.inspectIntervalMinimum:this.inspectInterval),this.requestToInspectImage()})),this._inspectId=ln(5,"inspect-"),this.workerMessageLengthLimit=F("VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT"),this.inspectIntervalMinimum=F("VIDEO_INSPECT_INTERVAL_MINIMUM"),this.qualityRatio=F("VIDEO_INSPECT_QUALITY_RATIO"),this.inspectInterval=t.interval,this.ossFilePrefix=t.ossFilePrefix,this.extraInfo=t.extraInfo,this.inspectType=t.inspectType,this.inspectStartTime=Number(Date.now()),this.workerManagerConnection=new JE("worker-manager-"+this._inspectId,rr),this.on(wr.STATE_CHANGE,((n,r)=>{this._innerConnectionState=n,R.debug("[".concat(this._inspectId,"] Inspect operation :").concat(Ho[n]," ").concat(r||""))})),this.handleWorkerManagerEvents(),this.workerConnection=new JE("worker-"+this._inspectId,rr),this.handleWorkerEvents()}async init(t,n){this.emit(wr.STATE_CHANGE,Ho.CONNECT_AP),this._connectInfo=t;const r=this._cancelTokenSource.token;return this._retryConfig=n,new Pe(((i,s)=>{this.on(wr.CONNECTION_STATE_CHANGE,((o,c)=>{c===Go.CONNECTED&&i()})),this.requestAP(t,r,n).then((o=>{this.connectWorkerManager(o)})).catch((o=>{s(o)}))}))}async requestAP(t,n,r){const i=F("WEBCS_DOMAIN").map((c=>"https://".concat(c,"/api/v1"))),s=await(function(c,l,h,p){let{appId:E,areaCode:g,cname:v,sid:O,token:I,uid:N}=l;Yf++;const M="image_moderation_api",x={service_name:M,json_body:JSON.stringify({appId:E,areaCode:g,cname:v,command:"allocateEdge",requestId:Yf,seq:Yf,sid:O,token:I,ts:Date.now(),uid:N+""})};let B,Z,Q=c[0];return Ta((async()=>{B=Date.now();const z=await Ia(Q,{data:x,cancelToken:h,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(Z=Date.now()-B,z.code!==0){const ve=new se(U.UNEXPECTED_RESPONSE,"image inspect ap error, code"+z.code,{retry:!0,responseTime:Z});throw R.error(ve.toString()),ve}const te=JSON.parse(z.json_body);if(te.code!==200){const ve=new se(U.UNEXPECTED_RESPONSE,"image inspect ap error, code: ".concat(te.code,", reason: ").concat(te.reason),{code:te.code,responseTime:Z});throw R.error(ve.toString()),ve}if(!te.servers||!Array.isArray(te.servers)||te.servers.length===0){const ve=new se(U.UNEXPECTED_RESPONSE,"image inspect ap empty server",{code:te.code,responseTime:Z});throw R.error(ve.toString()),ve}const de=F("VIDEO_INSPECT_WORKER_MANAGER_HOST"),me=F("VIDEO_INSPECT_WORKER_MANAGER_PORT");return{addressList:te.servers.map((ve=>{let{address:St,wss:wt}=ve;if(St&&wt)return"wss://".concat(St.replace(/\./g,"-"),".").concat(de,":").concat(me||wt)})).filter((ve=>!!ve)),workerToken:te.workerToken,vid:te.vid,responseTime:Z}}),((z,te)=>(We.apworkerEvent(O,{success:!0,sc:200,serviceName:M,responseDetail:JSON.stringify(z.addressList),firstSuccess:te===0,responseTime:Z,serverIp:c[te%c.length]}),!1)),((z,te)=>(We.apworkerEvent(O,{success:!1,sc:z.data&&z.data.code||200,serviceName:M,responseTime:Z,serverIp:c[te%c.length]}),!!(z.code!==U.OPERATION_ABORTED&&z.code!==U.UNEXPECTED_RESPONSE||z.data&&z.data.retry)&&(Q=c[(te+1)%c.length],!0))),p)})(i,t,n,r);this.emit(wr.STATE_CHANGE,Ho.AP_CONNECTED);const{addressList:o}=s;return this.wmSequence++,o}async connectWorkerManager(t){let n=arguments.length>1&&arguments[1]!==void 0&&arguments[1];this._needWorkUrlOnly=n,this.emit(wr.STATE_CHANGE,Ho.CONNECT_WORKER_MANAGER),await this.workerManagerConnection.init(t,1e4)}async connectWorker(t){await this.workerConnection.init([t])}handleWorkerManagerEvents(){this.workerManagerConnection.on(gt.CONNECTED,(async()=>{this.emit(wr.STATE_CHANGE,Ho.WORKER_MANAGER_CONNECTED,this.workerManagerConnection.url),this.workerManagerConnection.sendMessage({appId:this._connectInfo.appId,cname:this._connectInfo.cname,uid:this._connectInfo.uid+"",sdkVersion:"4.24.0",sid:this._connectInfo.sid,seq:this.wmSequence,ts:Number(Date.now()),requestId:Math.floor(1e12*Math.random()),allocate:!0,clientRequest:{command:"join"}},!0)})),this.workerManagerConnection.on(gt.CLOSED,(()=>{this._innerConnectionState<Ho.GET_WORKER_MANAGER_RESPONSE&&R.debug("[".concat(this._inspectId,"] Inspect worker manager is closed before connecting worker"))})),this.workerManagerConnection.on(gt.FAILED,(()=>{this._innerConnectionState<Ho.GET_WORKER_MANAGER_RESPONSE&&R.debug("[".concat(this._inspectId,"] Connecting inspect worker manager is failed before connecting worker"))})),this.workerManagerConnection.on(gt.RECONNECTING,(()=>{this._innerConnectionState<Ho.GET_WORKER_MANAGER_RESPONSE&&R.debug("[".concat(this._inspectId,"] Inspect worker manager is reconnecting before connecting worker"))})),this.workerManagerConnection.on(gt.ON_MESSAGE,(async t=>{this.emit(wr.STATE_CHANGE,Ho.GET_WORKER_MANAGER_RESPONSE);const n=this.workerManagerConnection.url;this.workerManagerConnection.close();const r=JSON.parse(t.data);if(r.code!==200)throw R.error("[".concat(this._inspectId,"] Unexpected code ").concat(r.code," from worker manager")),new se(U.UNEXPECTED_RESPONSE,"response code of worker is unexpected",r);if(!(r.serverResponse&&r.serverResponse.portWss&&n))throw R.error("[".concat(this._inspectId,"] Unexpected content from worker manager : ").concat(JSON.stringify(r))),new se(U.UNEXPECTED_RESPONSE,"response content of worker is unexpected",r);{const i=F("VIDEO_INSPECT_WORKER_PORT")||r.serverResponse.portWss,s=n.replace(/:\d+\/?$/,":".concat(i));this.emit(wr.STATE_CHANGE,Ho.CONNECT_WORKER,s),this._needWorkUrlOnly?this.emit(wr.REQUEST_NEW_WORKER_URL,s):await this.connectWorker(s)}})),this.workerManagerConnection.on(gt.WILL_RECONNECT,((t,n,r)=>{r(t)})),this.workerManagerConnection.on(gt.REQUEST_NEW_URLS,((t,n)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(t).catch(n)}))}handleWorkerEvents(){this.workerConnection.on(gt.CONNECTED,(async()=>{this.emit(wr.STATE_CHANGE,Ho.WORKER_CONNECTED,this.workerConnection.url),this.connectionState=Go.CONNECTED})),this.workerConnection.on(gt.ON_MESSAGE,(async t=>{if(t.data instanceof ArrayBuffer){const r=yq(new Uint8Array(t.data));if(F("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")&&R.debug("[".concat(this._inspectId,"] Response message for worker of inspect content "),JSON.stringify(r)),r.code===200){if(Array.isArray(this.inspectType)&&this.inspectType.length===1&&this.inspectType[0]==="supervise")return void this.emit(wr.INSPECT_RESULT,void 0,void 0);if(r.data&&r.data.scorePorn&&r.data.scoreSexy&&r.data.scoreNeutral){var n;const i={porn:r.data.scorePorn,sexy:r.data.scoreSexy,neutral:r.data.scoreNeutral},s=zi(n=Object.keys(i)).call(n,((c,l)=>i[c]>i[l]?c:l),"porn"),o=Object.keys(i).find((c=>c===s));this.emit(wr.INSPECT_RESULT,o)}else this.emit(wr.INSPECT_RESULT,void 0,new se(U.UNEXPECTED_RESPONSE,r.code+"","There is an unexpected data on message"))}else this.emit(wr.INSPECT_RESULT,void 0,new se(U.UNEXPECTED_RESPONSE,r.code+"",r.msg))}else R.error("[".concat(this._inspectId,"] Unexpected message type from worker")),this.emit(wr.INSPECT_RESULT,void 0,new se(U.UNEXPECTED_RESPONSE,"invalid worker message type"))})),this.workerConnection.on(gt.CLOSED,(()=>{this.connectionState=Go.CLOSED})),this.workerConnection.on(gt.FAILED,(()=>{this.connectionState=Go.CLOSED})),this.workerConnection.on(gt.RECONNECTING,(()=>{this.connectionState=this.connectionState===Go.CONNECTED?Go.RECONNECTING:Go.CONNECTING})),this.workerConnection.on(gt.WILL_RECONNECT,((t,n,r)=>{t==="recover"&&r(t),r("tryNext")})),this.workerConnection.on(gt.REQUEST_NEW_URLS,((t,n)=>{this.workerManagerConnection.close(),this.once(wr.REQUEST_NEW_WORKER_URL,(r=>{t([r])})),this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then((r=>{this.connectWorkerManager(r,!0)})).catch((r=>{n(r)}))}))}async requestToInspectImage(){this.sequence++;const t=Is(this,wr.CLIENT_LOCAL_VIDEO_TRACK),n={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(t){if(!t.isPlaying)return void this.emit(wr.INSPECT_RESULT,void 0,new se(U.INVALID_OPERATION,"Only the track being played can be inspected"));const r=await this.generateRequestData(t,n);this.workerConnection.sendMessage(r,!0,!0)}else this.emit(wr.INSPECT_RESULT,void 0,new se(U.INVALID_OPERATION,"Only the track being published can be inspected"))}async generateRequestData(t,n){let{appId:r,cname:i,cid:s,vid:o,sid:c,uid:l}=n;const h=Date.now(),p=await t.getCurrentFrameImage("image/jpeg",this.quality),E=await ML(p,r,i),g=this.sequence+"-"+s+"-"+l+"-"+h+"-"+ln(12,""),v={appId:r,cid:s,cname:i,deviceId:"",elapse:(O=Number(h-this.inspectStartTime),{low:O|=0,high:O>>31,unsigned:O>=0}),fileSize:E.byteLength,jpgEncryption:2,height:p.height,width:p.width,jpg:E,networkType:6,osType:7,requestId:g,sdkVersion:"4.24.0",sequence:this.sequence,sid:c,timestamp:dU(h),uid:l,vid:o,service:this._inspectMode,callbackData:this.extraInfo,ossFilePrefix:this.ossFilePrefix};var O;this.extraInfo===void 0&&delete v.callbackData,this.ossFilePrefix===void 0&&delete v.ossFilePrefix;const I=vq(v);if(I.byteLength<this.workerMessageLengthLimit){if(F("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")){const N=(function(M){for(var x=1;x<arguments.length;x++){var B=arguments[x]!=null?arguments[x]:{};x%2?nj(Object(B),!0).forEach((function(Z){k(M,Z,B[Z])})):Object.getOwnPropertyDescriptors?Object.defineProperties(M,Object.getOwnPropertyDescriptors(B)):nj(Object(B)).forEach((function(Z){Object.defineProperty(M,Z,Object.getOwnPropertyDescriptor(B,Z))}))}return M})({},v);delete N.jpg,R.debug("[".concat(this._inspectId,"] Request message for worker of inspect content "),JSON.stringify(N))}return I}{const N=this.quality*this.qualityRatio;return this.quality=N,await this.generateRequestData(t,{appId:r,cname:i,cid:s,vid:o,sid:c,uid:l})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=Mi.CancelToken.source(),this.workerManagerConnection&&this.workerManagerConnection.close(),this.workerConnection&&this.workerConnection.close(),this.inspectTimer&&window.clearInterval(this.inspectTimer),this.inspectTimer=null,this.connectionState=Go.CLOSED,this.emit(wr.STATE_CHANGE,Ho.CLOSED)}}const Nq={name:"ContentInspect",create:function(e){let{config:t}=e;return(function(n){if(!n)throw new se(U.INVALID_PARAMS,"inspectConfig is necessary.");if(!n.inspectType||!Array.isArray(n.inspectType))throw new se(U.INVALID_PARAMS,"inspectConfig.inspectType is necessary and is an instance of Array.");{const r=[...new Set(n.inspectType)];r.forEach((i=>{var s;if(!Re(s=["supervise","moderation"]).call(s,i))throw new se(U.INVALID_PARAMS,"".concat(i," is not a valid inspect type."))})),n.inspectType=r}if(n&&n.extraInfo&&n.extraInfo.length>1024)throw new se(U.INVALID_PARAMS,"inspectConfig.extraInfo length cannot exceed 1024 bytes")})(t),new Aq(t)}};var rj=C(ai.Object.getOwnPropertySymbols),Oq=Jt,Pq=rp.indexOf,Dq=Su,XI=Et([].indexOf),ij=!!XI&&1/XI([1],1,-0)<0;Oq({target:"Array",proto:!0,forced:ij||!Dq("indexOf")},{indexOf:function(e){var t=arguments.length>1?arguments[1]:void 0;return ij?XI(this,e,t)||0:Pq(this,e,t)}});var kq=as("Array","indexOf"),Lq=ee,xq=kq,JI=Array.prototype,Mq=function(e){var t=e.indexOf;return e===JI||Lq(JI,e)&&t===JI.indexOf?xq:t},sj=C(Mq);function Uq(e,t){if(e==null)return{};var n,r,i=(function(o,c){if(o==null)return{};var l={};for(var h in o)if({}.hasOwnProperty.call(o,h)){if(sj(c).call(c,h)!==-1)continue;l[h]=o[h]}return l})(e,t);if(rj){var s=rj(e);for(r=0;r<s.length;r++)n=s[r],sj(t).call(t,n)===-1&&{}.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}let oj=class{get localCapabilities(){return An(this._localCapabilities)}get rtpCapabilities(){return An(this._rtpCapabilities)}get candidates(){return An(this._candidates)}get iceParameters(){return An(this._iceParameters)}get dtlsParameters(){return An(this._dtlsParameters)}constructor(e){k(this,"sessionDesc",void 0),k(this,"_localCapabilities",void 0),k(this,"_rtpCapabilities",void 0),k(this,"_candidates",void 0),k(this,"_iceParameters",void 0),k(this,"_dtlsParameters",void 0),k(this,"setup",void 0),k(this,"currentMidIndex",void 0),k(this,"cname","o/i14u9pJrxRKAsu"),k(this,"firefoxSsrcMidMap",new Map),e=An(e);const{remoteIceParameters:t,remoteDtlsParameters:n,candidates:r,remoteRTPCapabilities:i,localCapabilities:s,direction:o,setup:c,videoCodec:l,audioCodec:h}=e;let p;this.setup=c,p=o===Ii.RECEIVE_ONLY?Zi(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`):Zi(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`),this._rtpCapabilities=i,this._candidates=r,this._iceParameters=t,this._dtlsParameters=n,this._localCapabilities=s;const E=o===Ii.RECEIVE_ONLY?this.rtpCapabilities.send:this.rtpCapabilities.recv,g=o===Ii.RECEIVE_ONLY?this._localCapabilities.recv:this._localCapabilities.send,v=o===Ii.RECEIVE_ONLY?i.send.videoCodecs:eg(Le.VIDEO,E,g,l),O=o===Ii.RECEIVE_ONLY?i.send.audioCodecs:eg(Le.AUDIO,E,g,h);for(const I of p.mediaDescriptions)I.attributes.iceUfrag=t.iceUfrag,I.attributes.icePwd=t.icePwd,I.attributes.fingerprints=n.fingerprints,I.attributes.candidates=r,I.attributes.setup=this.setup,I.media.mediaType==="application"&&(I.attributes.sctpPort="5000"),I.media.mediaType==="video"&&(I.media.fmts=v.map((N=>N.payloadType.toString(10))),I.attributes.payloads=v,I.attributes.extmaps=E.videoExtensions),I.media.mediaType==="audio"&&(I.media.fmts=O.map((N=>N.payloadType.toString(10))),I.attributes.payloads=O,I.attributes.extmaps=E.audioExtensions,zf(I));this.sessionDesc=p,this.currentMidIndex=p.mediaDescriptions.length-1}toString(){return Id(this.sessionDesc)}hasMid(e){return Array.isArray(e)?e.every((t=>this.hasMid(t))):this.sessionDesc.mediaDescriptions.some((t=>t.attributes.mid===e))}send(e,t,n,r,i){n=n.replace(/ /g,"-");const{ssrcs:s,ssrcGroups:o}=$E(t,this.cname,F("SYNC_GROUP")?n:void 0),c=this.findPreloadMediaDesc(s);if(c){if(xn()&&this.firefoxSsrcMidMap.set(s[0].ssrcId,c.attributes.mid),i&&(i.twcc||i.remb)){const l=this.sessionDesc.mediaDescriptions.indexOf(c);return this.sessionDesc.mediaDescriptions[l]=this.mungSendMediaDesc(c,i),{mid:c.attributes.mid,needExchangeSDP:!0}}return{mid:c.attributes.mid,needExchangeSDP:!1}}{const l=this.findAvailableMediaIndex(e,s,r);let h;return l===-1?(h=this.createOrRecycleSendMedia(e,s,o,"sendonly",r,i),this.updateBundleMids()):(h=An(this.sessionDesc.mediaDescriptions[l]),h.attributes.direction="sendonly",h.attributes.ssrcs=s,h.attributes.ssrcGroups=o,this.sessionDesc.mediaDescriptions[l]=this.mungSendMediaDesc(h,i)),xn()&&this.firefoxSsrcMidMap.set(s[0].ssrcId,h.attributes.mid),{needExchangeSDP:!0,mid:h.attributes.mid}}}stopSending(e){const t=this.sessionDesc.mediaDescriptions.filter((n=>n.attributes.mid&&e.indexOf(n.attributes.mid)!==-1));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");t.forEach((n=>{n.attributes.ssrcs=[]})),this.updateBundleMids()}receive(e,t,n){const r=[];return e.forEach((i=>{const s=i._mediaStreamTrack.kind,o=this.findAvailableRecvMediaIndex(s);let c,l=!1;o===-1?(l=!0,c=this.createOrRecycleRecvMedia(i,[],"recvonly",t,n),this.updateBundleMids()):(c=An(this.sessionDesc.mediaDescriptions[o]),c.attributes.direction="recvonly"),r.push({mid:c.attributes.mid,needCreateTransceiver:l})})),r}stopReceiving(e){const t=this.sessionDesc.mediaDescriptions.filter((n=>e.indexOf(n.attributes.mid)!==-1));if(t.length!==e.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");t.forEach((n=>{n.media.port="0",n.attributes.direction="inactive"})),this.updateBundleMids()}addRemoteCandidate(e){const{foundation:t,protocol:n,address:r,port:i,type:s,relatedAddress:o,relatedPort:c,priority:l}=new RTCIceCandidate(e),h={foundation:t??"",componentId:"1",transport:n??"",priority:l?l+"":"",connectionAddress:r??"",port:i?i+"":"",type:s?s+"":"",relAddr:o??"",relPort:c?c+"":"",extension:{}};this.candidates.some((p=>p.priority===h.priority&&p.connectionAddress===h.connectionAddress&&p.port===h.port))||(this._candidates.push(h),this.sessionDesc.mediaDescriptions.forEach((p=>{p.attributes.candidates=this.candidates})))}clearRemoteCandidate(){this._candidates=[],this.sessionDesc.mediaDescriptions[0].attributes.candidates=this._candidates}createOrRecycleRecvMedia(e,t,n,r,i){const s=e._mediaStreamTrack.kind,o=this.rtpCapabilities.recv,c=eg(s,o,this.localCapabilities.send,s===Le.AUDIO?i:r),l=s===Le.VIDEO?o.videoExtensions:o.audioExtensions,h="".concat(++this.currentMidIndex);let p={media:{mediaType:s,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:c.map((g=>g.payloadType.toString(10)))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:l,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:c,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:n,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(h)}};p=this.mungRecvMediaDsec(p,e);const E=this.findFirstClosedMedia(s);if(E){const g=this.sessionDesc.mediaDescriptions.indexOf(E);this.sessionDesc.mediaDescriptions[g]=p}else this.sessionDesc.mediaDescriptions.push(p);return p}muteRemote(e){const t=this.sessionDesc.mediaDescriptions.filter((n=>Re(e).call(e,n.attributes.mid||"")));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach((n=>{n.attributes.direction="inactive"}))}unmuteRemote(e){const t=this.sessionDesc.mediaDescriptions.filter((n=>Re(e).call(e,n.attributes.mid||"")));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach((n=>{n.attributes.direction="recvonly"}))}findAvailableMediaIndex(e,t,n){return this.sessionDesc.mediaDescriptions.findIndex((r=>{const i=r.media.mediaType===e&&r.media.port!=="0"&&(r.attributes.direction==="sendonly"||r.attributes.direction==="sendrecv")&&r.attributes.ssrcs.length===0;if(xn()){if(i){const s=this.firefoxSsrcMidMap.get(t[0].ssrcId);return!(s||r.attributes.mid!=="0"&&r.attributes.mid!=="1")||!(!s||s!==r.attributes.mid)}return!1}return i&&r.attributes.mid===n}))}findAvailableRecvMediaIndex(e){return this.sessionDesc.mediaDescriptions.findIndex((t=>{const n=t.media.mediaType===e&&t.media.port!=="0"&&(t.attributes.direction==="recvonly"||t.attributes.direction==="sendrecv");return t.attributes.mid!=="0"&&t.attributes.mid!=="1"&&n}))}predictReceivingMids(e){const t=[];for(let n=0;n<e;n++)t.push((this.currentMidIndex+n+1).toString(10));return t}restartICE(e){e=An(e),this._iceParameters=e,this.sessionDesc.mediaDescriptions.forEach((t=>{t.attributes.iceUfrag=e.iceUfrag,t.attributes.icePwd=e.icePwd}))}createOrRecycleSendMedia(e,t,n,r,i,s){const o=this.rtpCapabilities.send,c=e===Le.VIDEO?o.videoCodecs:o.audioCodecs,l=e===Le.VIDEO?o.videoExtensions:o.audioExtensions;xn()&&(i="".concat(++this.currentMidIndex));let h={media:{mediaType:e,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:c.map((E=>E.payloadType.toString(10)))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:l,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:n,rtcpFeedbackWildcards:[],payloads:c,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:r,rtcpMux:!0,rtcpRsize:!0,mid:i}};h=this.mungSendMediaDesc(h,s);const p=this.findFirstClosedMedia(e);if(p){const E=this.sessionDesc.mediaDescriptions.indexOf(p);this.sessionDesc.mediaDescriptions[E]=h}else this.sessionDesc.mediaDescriptions.push(h);return h}mungRecvMediaDsec(e,t,n){const r=An(e);return Xb(r),Kf(r,t),Jb(r,t),$M(r),cT(r,n,this.localCapabilities.send),r}mungSendMediaDesc(e,t){const n=An(e);return cT(n,t,this.localCapabilities.recv),zf(n),n}updateRecvMedia(e,t){const n=this.sessionDesc.mediaDescriptions.findIndex((r=>r.attributes.mid===e));if(n!==-1){const r=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[n],t);this.sessionDesc.mediaDescriptions[n]=r}}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter((e=>e.media.port!=="0")).map((e=>e.attributes.mid))}findPreloadMediaDesc(e){return this.sessionDesc.mediaDescriptions.find((t=>{var n;return((n=t.attributes)===null||n===void 0||(n=n.ssrcs[0])===null||n===void 0?void 0:n.ssrcId)===e[0].ssrcId}))}findFirstClosedMedia(e){return this.sessionDesc.mediaDescriptions.find((t=>xn()?t.media.port==="0"&&t.media.mediaType===e:t.media.port==="0"))}};const Vq=["sdp"];var yn;function aj(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable}))),n.push.apply(n,r)}return n}function zd(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?aj(Object(n),!0).forEach((function(r){k(e,r,n[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):aj(Object(n)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))}))}return e}let cj=(yn=class lm extends xM{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var t,n;return(t=(n=this.peerConnection.getReceivers()[0])===null||n===void 0||(n=n.transport)===null||n===void 0?void 0:n.state)!==null&&t!==void 0?t:null}get localCodecs(){return[]}set isInRestartIce(t){this._isInRestartIce=t}get isInRestartIce(){return this._isInRestartIce}constructor(t,n,r){super(t,n),k(this,"direction",void 0),k(this,"name",void 0),k(this,"store",void 0),k(this,"spec",void 0),k(this,"peerConnection",void 0),k(this,"initialOffer",void 0),k(this,"transport",void 0),k(this,"statsFilter",void 0),k(this,"localCandidateCount",0),k(this,"_isInRestartIce",!1),k(this,"mutex",void 0),k(this,"onLocalCandidate",void 0),k(this,"remoteSDP",void 0),k(this,"pendingCandidates",[]),k(this,"localCapabilities",void 0),k(this,"isReady",!1),k(this,"restartCnt",0),k(this,"curTurnServerIndex",0),this.store=n,this.spec=t,this.mutex=new Yr("P2PConnection-mutex",n.clientId),this.peerConnection=new RTCPeerConnection(lm.resolvePCConfiguration(t,n.p2pTransport),{optional:[{googDscp:!0}]}),this.direction=r??Ii.SEND_ONLY,this.name=this.direction===Ii.SEND_ONLY?"sendP2PConnection":"recvP2PConnection",this.statsFilter=ib(this.peerConnection,F("STATS_UPDATE_INTERVAL"),void 0,xn()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1}async establish(t){try{const n=await t2();if(this.localCapabilities=lT(n),t){const{sdp:r}=t,i=Uq(t,Vq),s=(function(){const p={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},E=ZE(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"sendonly"),g={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},v={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},O={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(Ko(E,p,"videoExtensions",g,v,O),Ko(E,p,"videoCodecs",g,v,O),Ko(E,p,"audioExtensions",g,v,O),Ko(E,p,"audioCodecs",g,v,O),F("RAISE_H264_BASELINE_PRIORITY")){const I=O.videoCodecs.findIndex((N=>N.rtpMap&&N.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&N.fmtp&&N.fmtp.parameters["profile-level-id"]==="42001f"));if(I!==-1){const N=O.videoCodecs.findIndex((M=>M.rtpMap&&M.rtpMap.encodingName.toLocaleLowerCase()==="h264"));if(N<I){R.debug("raising H264 baseline profile priority");const M=O.videoCodecs[I];O.videoCodecs.splice(I,1),O.videoCodecs.splice(N,0,M)}N!==-1&&F("FILTER_SEND_H264_BASELINE")&&(g.videoCodecs=g.videoCodecs.filter((M=>!(M.rtpMap&&M.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&M.fmtp&&M.fmtp.parameters["profile-level-id"]!=="42001f"))))}}return{send:g,recv:v,sendrecv:O}})({},{},r);this.remoteSDP=new oj({remoteIceParameters:i.iceParameters,remoteDtlsParameters:i.dtlsParameters,candidates:[],remoteRTPCapabilities:s,localCapabilities:this.localCapabilities,direction:this.direction,setup:"actpass",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()}),this.isReady=!0;const o=await this.peerConnection.createAnswer();if(!o.sdp)throw new Error("Cannot get answer sdp when trying to establish PeerConnection.");const c=kd(o.sdp);await this.peerConnection.setLocalDescription(o);const l=await n2({},{},o.sdp);this.localCapabilities=lT(l);const h=this.peerConnection.getTransceivers()[0];return h!=null&&h.receiver&&h.receiver.transport&&this.tryBindTransportEvents(h.receiver.transport),zd(zd({},c),{},{sdp:o.sdp})}{this.peerConnection.addTransceiver("video",{direction:"sendonly"}),this.peerConnection.addTransceiver("audio",{direction:"sendonly"});const r=await this.peerConnection.createOffer();if(!r.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const i=kd(r.sdp);return this.initialOffer=r,zd(zd({},i),{},{sdp:r.sdp})}}catch(n){throw new ce(U.GET_LOCAL_CONNECTION_PARAMS_FAILED,n.toString())}}async connect(t){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");await this.peerConnection.setLocalDescription(this.initialOffer);const{sdp:n,iceParameters:r,dtlsParameters:i}=t,s=await n2({},{},n);this.remoteSDP=new oj({remoteIceParameters:r,remoteDtlsParameters:i,candidates:[],remoteRTPCapabilities:s,localCapabilities:this.localCapabilities,direction:this.direction,setup:"active",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()});const o=this.peerConnection.getTransceivers()[0];o!=null&&o.sender&&o.sender.transport&&this.tryBindTransportEvents(o.sender.transport)}catch(n){throw new ce(U.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(n.toString()))}}async addRemoteCandidate(t){try{t&&this.pendingCandidates.push(t),this.peerConnection.remoteDescription&&this.isReady&&(this.pendingCandidates.forEach((n=>{this.peerConnection.addIceCandidate(n)})),this.pendingCandidates=[])}catch(n){throw new ce(U.ADD_CANDIDATE_FAILED,"P2PConnection.addRemoteCandidate failed; ".concat(n.toString()))}}send(t,n,r){var i=this;return eo((function*(){const s=yield jt(i.mutex.lock("From P2PConnection.send"));try{if(!i.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const o=[],c=i.remoteSDP.receive(t,n,r);t.forEach(((N,M)=>{if(c[M].needCreateTransceiver){const x=i.peerConnection.addTransceiver(N._mediaStreamTrack,{direction:"sendonly"});o.push(x),N._updateRtpTransceiver(x)}else{const x=i.peerConnection.getTransceivers().find((B=>B.mid===c[M].mid));if(!x)throw new Error("cannot find transceiver when sendPeerconnection send, mid is ".concat(c[M].mid));o.push(x),N._updateRtpTransceiver(x)}})),xn()&&F("SIMULCAST")===!0&&(yield jt(i.applySimulcastForFirefox(o,t)));const l=c.map((N=>N.mid)),h=yield jt(i.peerConnection.createOffer()),p=i.mungSendOfferSDP(h.sdp,t,l),E=Zi(p),g=l.map((N=>{const M=E.mediaDescriptions.find((x=>x.attributes.mid===N));if(!M)throw new Error("Cannot extract ssrc from mediaDescription.");return JM(M,F("USE_PUB_RTX"))})),v=o.map(((N,M)=>{const x=l[M];return{localSSRC:g[M],id:x}}));yield jt(i.peerConnection.setLocalDescription({type:"offer",sdp:p}));try{yield v}catch(N){const M=i.remoteSDP.toString();throw yield jt(i.peerConnection.setLocalDescription({type:"offer",sdp:p})),yield jt(i.peerConnection.setRemoteDescription({type:"answer",sdp:M})),yield jt(i.stopSending(l,!0)),N}yield jt(i.applySimulcastEncodings(o,t)),yield jt(i.applySendEncodings(o,t));const O=i.remoteSDP.toString(),I=i.logSDPExchange(p,"offer","local","send");return I?.(O),yield jt(i.setRemoteDescription({type:"answer",sdp:O})),o.map(((N,M)=>{const x=l[M];return{localSSRC:g[M],id:x}}))}catch(o){throw o instanceof ce?o:new ce(U.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(o.toString()))}finally{s()}}))()}async stopSending(t,n){const r=n?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const i=this.peerConnection.getTransceivers().filter((l=>t.indexOf(l.mid)!==-1));if(i.length!==t.length)throw new Error("Transceivers' length (".concat(i.length,") doesn't match mids' length (").concat(t.length,") when trying to call P2PConnection.stopSending."));i.map((l=>{var h;l.direction="inactive",(h=l.stop)===null||h===void 0||h.call(l)}));const s=await this.peerConnection.createOffer(),o=this.logSDPExchange(s.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(s),this.remoteSDP.stopReceiving(t);const c=this.remoteSDP.toString();o?.(c),await this.setRemoteDescription({type:"answer",sdp:c})}catch(i){throw new ce(U.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(i.toString()))}finally{r&&r()}}async receive(t,n,r,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));const{mid:s,needExchangeSDP:o}=this.remoteSDP.send(t,n,r,i);if(o){const l=this.remoteSDP.toString(),h=this.logSDPExchange(l,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:l});const p=await this.peerConnection.createAnswer(),E=this.mungReceiveAnswerSDP(p.sdp,s,t);h?.(E||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:E}),R.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," by exchanging SDP."))}else R.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," no need to exchange SDP."));const c=this.peerConnection.getTransceivers().find((l=>l.mid===s));if(!c||c.mid===null)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:c.receiver.track,mid:c.mid,transceiver:c}}catch(s){throw new ce(U.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(s.toString()))}}async mockReceive(t,n,r,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));const{mid:s,needExchangeSDP:o}=this.remoteSDP.send(t,n,r,i);if(o){const c=this.remoteSDP.toString(),l=this.logSDPExchange(c,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:c});const h=await this.peerConnection.createAnswer(),p=this.mungReceiveAnswerSDP(h.sdp,s,t);l?.(p||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:p}),R.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," by exchanging SDP."))}else R.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," no need to exchange SDP."))}catch(s){throw new ce(U.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(s.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(t);const n=this.remoteSDP.toString(),r=this.logSDPExchange(n,"offer","remote","stopReceiving");await this.setRemoteDescription({type:"offer",sdp:n});const i=await this.peerConnection.createAnswer();r?.(i.sdp||""),await this.peerConnection.setLocalDescription(i)}catch(n){throw new ce(U.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n.toString()))}}async restartICE(t){try{if(this.store.p2pTransport===Eh.Auto&&(this.store.p2pTransport=Eh.SdRtn,Ft().supportPCSetConfiguration&&this.peerConnection.setConfiguration(lm.resolvePCConfiguration(this.spec,this.store.p2pTransport))),this.restartCnt>3&&(this.restartCnt=0,Ft().supportPCSetConfiguration&&this.peerConnection.setConfiguration(lm.resolvePCConfiguration(this.spec,this.store.p2pTransport,++this.curTurnServerIndex))),!t){this.restartCnt++,this.isReady=!1;const n=await this.peerConnection.createOffer({iceRestart:!0});if(!n.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const{iceParameters:r}=kd(n.sdp);return this.store.descriptionStart(),this.direction===Ii.SEND_ONLY&&await this.peerConnection.setLocalDescription(n),r}if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");if(this.remoteSDP.restartICE(t),this.store.descriptionStart(),this.direction===Ii.RECEIVE_ONLY){this.restartCnt++,await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()});const n=await this.peerConnection.createAnswer();if(!n.sdp)throw new Error("Cannot get answer sdp when trying to iceRestart.");const{iceParameters:r}=kd(n.sdp);return await this.peerConnection.setLocalDescription(n),r}await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()}),this.isReady=!0}catch(n){throw new ce(U.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n.toString()))}}close(){var t;this.peerConnection.close(),this.peerConnection.onicecandidate=null,(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.transport=void 0,this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const r=await this.peerConnection.createOffer(),i=this.mungSendOfferSDP(r.sdp,[n],[t]);this.remoteSDP.updateRecvMedia(t,n);const s=this.remoteSDP.toString(),o=this.logSDPExchange(i,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:i}),o?.(s),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(r){throw new ce(U.EXCHANGE_SDP_FAILED,r.toString())}}async updateSendParameters(t,n){const r=this.peerConnection.getTransceivers().filter((i=>i.mid===t));r.length===1&&(this.isVP8Simulcast(n)?xn()||await this.applySimulcastEncodings(r,[n]):await this.applySendEncodings(r,[n]))}setStatsRemoteVideoIsReady(t,n){this.statsFilter.setVideoIsReady2(t,n)}async replaceTrack(t,n){const r=this.peerConnection.getTransceivers().find((i=>i.mid===n));r&&await r.sender.replaceTrack(t._mediaStreamTrack)}async getSelectedCandidatePair(){const t=this.peerConnection.getReceivers();if(t.length>0&&t[0].transport&&t[0].transport.iceTransport&&t[0].transport.iceTransport.getSelectedCandidatePair&&t[0].transport.iceTransport.getSelectedCandidatePair()){const n=t[0].transport.iceTransport,{local:r,remote:i}=n.getSelectedCandidatePair();return{local:zd(zd({},Tc),{},{candidateType:r.type,protocol:r.protocol,address:r.address,port:r.port}),remote:zd(zd({},Tc),{},{candidateType:i.type,protocol:i.protocol,address:i.address,port:i.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t,n;Re(t=["connected","completed"]).call(t,this.peerConnection.iceConnectionState)&&(this.isReady=!1),(n=this.onICEConnectionStateChange)===null||n===void 0||n.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;this.peerConnection.connectionState==="connected"&&(this.restartCnt=0),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.startICECandidate()}startICECandidate(){this.peerConnection.onicecandidate||(this.localCandidateCount=0,this.peerConnection.onicecandidate=t=>{if(t.candidate){var n;t.candidate.candidate&&((n=this.onLocalCandidate)===null||n===void 0||n.call(this,t.candidate.toJSON())),this.localCandidateCount+=1}else R.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount)})}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const i={iceServers:[]};var s;return t.iceServers?i.iceServers=t.iceServers:t.turnServer&&t.turnServer.mode!=="off"&&(UE(t.turnServer.servers)?i.iceServers=t.turnServer.servers:(i.iceServers&&i.iceServers.push(...lm.turnServerConfigToIceServers(t.turnServer.servers,n,r)),F("USE_TURN_SERVER_OF_GATEWAY")&&i.iceServers&&t.turnServer.serversFromGateway&&i.iceServers.push(...lm.turnServerConfigToIceServers(t.turnServer.serversFromGateway,n,r)),Re(s=[Eh.Relay,Eh.SdRtn]).call(s,n)&&(i.iceTransportPolicy="relay"),F("FORCE_TURN_TCP")?i.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach((o=>{o.forceturn&&(i.iceTransportPolicy="relay")})))),F("ENABLE_ENCODED_TRANSFORM")&&Ft().supportWebRTCEncodedTransform&&(i.encodedInsertableStreams=!0),R.debug("P2PConnection p2pTransport is ".concat(n)),i}static turnServerConfigToIceServers(t,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const i=[],s=t.filter((c=>c.tcpport));R.debug("P2PConnection turnServers is ".concat(s,", current index is ").concat(r));const o=s.length>r?s[r]:s[0];switch(n){case Eh.SdRtn:const c=t.filter((h=>{var p;return Re(p=h.username).call(p,"glb:")&&h.turnServerURL==h.turnServerURL})),l=c.length>r?c[r]:c[0];l&&(i.push({username:l.username,credential:l.password,credentialType:"password",urls:"turn:".concat(Pd(l.turnServerURL),":").concat(l.tcpport,"?transport=udp")}),i.push({username:l.username,credential:l.password,credentialType:"password",urls:"turns:".concat(Pd(l.turnServerURL),":").concat(l.tcpport,"?transport=tcp")}));break;case Eh.Relay:o&&(i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":").concat(o.tcpport,"?transport=udp")}),i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turns:".concat(Pd(o.turnServerURL),":").concat(o.tcpport,"?transport=tcp")}));break;default:o&&(i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":").concat(o.tcpport,"?transport=udp")}),i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turns:".concat(Pd(o.turnServerURL),":").concat(o.tcpport,"?transport=tcp")}),i.push({username:o.username,credential:o.password,credentialType:"password",urls:"stun:".concat(o.turnServerURL,":").concat(o.tcpport)}))}return i}tryBindTransportEvents(t){if(t){this.transport=t,t.onstatechange=()=>{var r;t!=null&&t.state&&((r=this.onDTLSTransportStateChange)===null||r===void 0||r.call(this,t.state))},t.onerror=r=>{var i;(i=this.onDTLSTransportError)===null||i===void 0||i.call(this,"error"in r?r.error:r)};const n=t.iceTransport;n&&(n.onstatechange=()=>{const r=t?.iceTransport.state;var i;r&&((i=this.onICETransportStateChange)===null||i===void 0||i.call(this,r))},n.getSelectedCandidatePair&&(n.onselectedcandidatepairchange=()=>{if(n.getSelectedCandidatePair()){const{local:r,remote:i}=n.getSelectedCandidatePair()||{};if(r&&i){const s=r.address+":"+r.port,o=i.address+":"+i.port;R.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify(wh(s)),", remote ").concat(JSON.stringify(wh(o))))}}}))}}tryUnbindTransportEvents(){this.transport&&(this.transport.onstatechange=null,this.transport.onerror=null,this.transport.iceTransport&&(this.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(t,n){var r;if(n||(n=this.peerConnection.getSenders().find((p=>p.track===t._mediaStreamTrack))),!n)return R.warn("[".concat(t.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(t))return R.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!Ft().supportSetRtpSenderParameters)return R.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const i={},s={};switch(t._optimizationMode){case"motion":i.degradationPreference="maintain-framerate";break;case"detail":i.degradationPreference="maintain-resolution";break;default:i.degradationPreference="balanced"}if(t._encoderConfig){var o;const{bitrateMax:p,frameRate:E,scaleResolutionDownBy:g}=t._encoderConfig;p&&(s.maxBitrate=1e3*p),Re(o=t._hints).call(o,an.LOW_STREAM)&&(E&&(s.maxFramerate=Es(E)),g&&g>=1&&(s.scaleResolutionDownBy=g))}if(F("DSCP_TYPE")&&ml()){var c;const p=F("DSCP_TYPE");Re(c=["very-low","low","medium","high"]).call(c,p)&&(s.networkPriority=p)}const l=n.getParameters(),h=(r=l.encodings)===null||r===void 0?void 0:r[0];xn()&&!h&&(i.encodings=[s]),h&&Object.assign(h,s),Object.assign(l,i),R.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(l.encodings))),await n.setParameters(l)}async applySendEncodings(t,n){try{if(!Ft().supportSetRtpSenderParameters||t.length!==n.length)return;for(let r=0;r<t.length;r++){const i=t[r],s=n[r];s instanceof vn&&!this.isVP8Simulcast(s)&&await this.updateRtpSenderEncodings(s,i.sender)}}catch{R.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(t,n,r){const i=Zi(t);return n.forEach(((s,o)=>{const c=r[o],l=i.mediaDescriptions.find((h=>h.attributes.mid===c));l&&(Kf(l,s),e2(l,s,this.store.codec))})),Id(i)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var n;(n=this.onFirstAudioReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var n;(n=this.onFirstVideoReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var n;(n=this.onFirstAudioDecoded)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,n,r)=>{var i;(i=this.onFirstVideoDecoded)===null||i===void 0||i.call(this,t,n,r)},this.statsFilter.onSelectedLocalCandidateChanged=(t,n)=>{var r;(r=this.onSelectedLocalCandidateChanged)===null||r===void 0||r.call(this,t,n)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,n)=>{var r;(r=this.onSelectedRemoteCandidateChanged)===null||r===void 0||r.call(this,t,n)},this.statsFilter.onFirstVideoDecodedTimeout=t=>{var n;(n=this.onFirstVideoDecodedTimeout)===null||n===void 0||n.call(this,t)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(t,n){if(t.length===n.length)for(let l=0;l<t.length;l++){var r,i,s,o,c;const h=t[l],p=n[l];if(p instanceof vn&&!Re(r=p._hints).call(r,an.LOW_STREAM)&&(i=p._encoderConfig)!==null&&i!==void 0&&i.bitrateMax&&((s=p._encoderConfig)===null||s===void 0?void 0:s.bitrateMax)>200&&(o=p._scalabilityMode)!==null&&o!==void 0&&o.numSpatialLayers&&((c=p._scalabilityMode)===null||c===void 0?void 0:c.numSpatialLayers)>1&&this.store.codec==="vp8"){const E={},g={high:1e3*(p._encoderConfig.bitrateMax-50),medium:5e4};E.encodings=[{rid:"m",active:!0,maxBitrate:g.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:g.high}];const v=h.sender.getParameters();await h.sender.setParameters(Object.assign(v,E))}}}async applySimulcastEncodings(t,n){if(!xn()&&t.length===n.length)for(let r=0;r<t.length;r++){const i=n[r];if(i instanceof vn&&this.isVP8Simulcast(i)){const s=t[r],o={},c={high:1e3*(i._encoderConfig.bitrateMax-50),medium:5e4};o.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:c.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:c.medium,scaleResolutionDownBy:4}];const l=s.sender.getParameters();await s.sender.setParameters(Object.assign(l,o))}}}isVP8Simulcast(t){var n,r,i,s,o;return!!(t instanceof vn&&F("SIMULCAST")&&this.store.codec==="vp8"&&!Re(n=t._hints).call(n,an.LOW_STREAM)&&(r=t._encoderConfig)!==null&&r!==void 0&&r.bitrateMax&&((i=t._encoderConfig)===null||i===void 0?void 0:i.bitrateMax)>200&&(s=t._scalabilityMode)!==null&&s!==void 0&&s.numSpatialLayers&&((o=t._scalabilityMode)===null||o===void 0?void 0:o.numSpatialLayers)>1)}logSDPExchange(t,n,r,i){if(F("SDP_LOGGING"))return R.upload("[".concat(this.store.clientId,"] exchanging ").concat(r," ").concat(n," SDP during P2PConnection.").concat(i,`
`),t),n==="offer"?s=>{this.logSDPExchange(s,"answer",r==="local"?"remote":"local",i)}:void 0}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter((o=>o.mid&&t.indexOf(o.mid)!==-1));if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map((o=>{o.direction="inactive"}));const r=await this.peerConnection.createOffer(),i=this.logSDPExchange(r.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(r),this.remoteSDP.muteRemote(t);const s=this.remoteSDP.toString();i?.(s),await this.setRemoteDescription({type:"answer",sdp:s})}catch(n){throw new ce(U.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(n.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter((o=>o.mid&&t.indexOf(o.mid)!==-1));if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map((async o=>{o.direction="sendonly"}));const r=await this.peerConnection.createOffer(),i=this.logSDPExchange(r.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(r),this.remoteSDP.unmuteRemote(t);const s=this.remoteSDP.toString();i?.(s),await this.setRemoteDescription({type:"answer",sdp:s})}catch(n){throw new ce(U.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(n.toString()))}}async getRemoteSSRC(t,n){var r;if(n=n??((r=this.currentRemoteDescription)===null||r===void 0?void 0:r.sdp)){var i;const s=(i=Zi(n).mediaDescriptions.find((o=>o.attributes.mid===t)))===null||i===void 0?void 0:i.attributes.ssrcs;return s?.[0].ssrcId}}async setRemoteDescription(t){var n;await this.peerConnection.setRemoteDescription(t),Re(n=["connected","completed"]).call(n,this.peerConnection.iceConnectionState)||(this.isReady=!0,this.addRemoteCandidate())}mungReceiveAnswerSDP(t,n,r){const i=Zi(t),s=i.mediaDescriptions.find((o=>o.attributes.mid===n));return s&&r===Le.AUDIO&&s.media.mediaType==="audio"&&zf(s),Id(i)}},Be(yn.prototype,"establish",[Jo],Object.getOwnPropertyDescriptor(yn.prototype,"establish"),yn.prototype),Be(yn.prototype,"connect",[Jo],Object.getOwnPropertyDescriptor(yn.prototype,"connect"),yn.prototype),Be(yn.prototype,"receive",[Jo],Object.getOwnPropertyDescriptor(yn.prototype,"receive"),yn.prototype),Be(yn.prototype,"mockReceive",[Jo],Object.getOwnPropertyDescriptor(yn.prototype,"mockReceive"),yn.prototype),Be(yn.prototype,"stopReceiving",[Jo],Object.getOwnPropertyDescriptor(yn.prototype,"stopReceiving"),yn.prototype),Be(yn.prototype,"restartICE",[Jo],Object.getOwnPropertyDescriptor(yn.prototype,"restartICE"),yn.prototype),Be(yn.prototype,"close",[Jo],Object.getOwnPropertyDescriptor(yn.prototype,"close"),yn.prototype),Be(yn.prototype,"updateEncoderConfig",[Jo],Object.getOwnPropertyDescriptor(yn.prototype,"updateEncoderConfig"),yn.prototype),Be(yn.prototype,"updateSendParameters",[Jo],Object.getOwnPropertyDescriptor(yn.prototype,"updateSendParameters"),yn.prototype),Be(yn.prototype,"replaceTrack",[Jo],Object.getOwnPropertyDescriptor(yn.prototype,"replaceTrack"),yn.prototype),Be(yn.prototype,"muteLocal",[Jo],Object.getOwnPropertyDescriptor(yn.prototype,"muteLocal"),yn.prototype),Be(yn.prototype,"unmuteLocal",[Jo],Object.getOwnPropertyDescriptor(yn.prototype,"unmuteLocal"),yn.prototype),yn);function Jo(e,t,n){const r=e[t];if(typeof r!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const i=this.mutex,s=await i.lock("From P2PConnection.".concat(t));try{for(var o=arguments.length,c=new Array(o),l=0;l<o;l++)c[l]=arguments[l];return await r.apply(this,c)}finally{s()}},n}let Oa=(function(e){return e.SEND_ONLY="SEND_ONLY",e.RECEIVE_ONLY="RECEIVE_ONLY",e})({});var lj,dj,uj,hj,pj,fj,mj,_j,Ej,gj,vj,Nn;function yj(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable}))),n.push.apply(n,r)}return n}function zT(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?yj(Object(n),!0).forEach((function(r){k(e,r,n[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):yj(Object(n)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))}))}return e}let jq=(lj=Pa(Oa.SEND_ONLY),dj=Pa(Oa.SEND_ONLY),uj=Pa(),hj=Pa(Oa.RECEIVE_ONLY),pj=Pa(Oa.RECEIVE_ONLY),fj=Pa(Oa.RECEIVE_ONLY),mj=Pa(Oa.RECEIVE_ONLY),_j=Pa(Oa.RECEIVE_ONLY),Ej=Pa(Oa.RECEIVE_ONLY),gj=Pa(),vj=Pa(Oa.RECEIVE_ONLY),Nn=class extends Pn{get state(){return this._state}set state(e){const t=this._state;this._state=e,this.emit(Xe.StateChange,t,this._state)}constructor(e,t){super(),k(this,"isPlanB",!1),k(this,"store",void 0),k(this,"statsUploader",void 0),k(this,"sendConnection",void 0),k(this,"recvConnection",void 0),k(this,"localTrackMap",new Map),k(this,"remoteUserMap",new Map),k(this,"localDataChannels",[]),k(this,"pendingLocalTracks",[]),k(this,"pendingRemoteTracks",[]),k(this,"statsCollector",void 0),k(this,"dtlsFailedCount",0),k(this,"sendMutex",void 0),k(this,"recvMutex",void 0),k(this,"_state",Zt.Disconnected),k(this,"_restartStates",["disconnected","failed"]),k(this,"reconnectInterval",void 0),k(this,"uploadUnplinkStarted",!1),k(this,"uploadDownlinkStarted",!1),k(this,"uplinkStateUploadInterval",void 0),k(this,"downlinkStatsUploadInterval",void 0),k(this,"handleMuteLocalTrack",(async(n,r,i)=>{const s=await this.sendMutex.lock("Locking from P2PChannel2.handleMuteLocalTrack");try{if(!this.sendConnection||this.state!==Zt.Connected)return void i(new ce(U.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established."));const l=this.filterTobeMutedTracks(n);if(l.length===0)return void r();const h=l.find((v=>v[0]==="videoLowTrack"));h&&h[1].track._originMediaStreamTrack.stop(),await this.sendConnection.muteLocal(l.map((v=>{let[,{id:O}]=v;return O})));let p=!1;var o,c;n.trackMediaType==="video"?p=!((o=this.localTrackMap.get(Ee.LocalAudioTrack))===null||o===void 0||!o.track._muted):p=((c=this.localTrackMap.get(Ee.LocalVideoTrack))===null||c===void 0?void 0:c.id)===void 0;const E=this.createMuteMessage(l);await cn(this,Xe.RequestMuteLocal,E);const g=n.trackMediaType==="video"?Od.MUTE_LOCAL_VIDEO:Od.MUTE_LOCAL_AUDIO;await cn(this,Xe.RequestP2PMuteLocal,{action:g,message:E,isMuteAll:p}),r()}catch(l){i(l)}finally{s()}})),k(this,"handleUnmuteLocalTrack",(async(n,r,i)=>{const s=await this.sendMutex.lock("Locking from P2PChannel2.handleUnmuteLocalTrack");try{if(!this.sendConnection||this.state!==Zt.Connected)return void i(new ce(U.INVALID_OPERATION,"Cannot call P2PChannel2.handleUnmuteLocalTrack before sendConnection established."));const o=this.filterTobeUnmutedTracks(n);if(o.length===0)return void r();await this.sendConnection.unmuteLocal(o.map((h=>{let[,{id:p}]=h;return p})));const c=this.createUnmuteMessage(o),l=n.trackMediaType==="video"?Od.UNMUTE_LOCAL_VIDEO:Od.UNMUTE_LOCAL_AUDIO;await cn(this,Xe.RequestP2PMuteLocal,{action:l,message:c}),r()}catch(o){i(o)}finally{s()}})),k(this,"handleUpdateVideoEncoder",(async(n,r,i,s)=>{let o;typeof s=="boolean"&&s||(o=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoEncoder"));try{const l=this.localTrackMap.get(Ee.LocalVideoTrack);if(!this.sendConnection||!l||l.track!==n||this.state!==Zt.Connected)return void r();const{id:h,track:p}=l;h&&(await this.sendConnection.updateSendParameters(h,p),await this.sendConnection.updateEncoderConfig(h,p),this.emit(Xe.UpdateVideoEncoder,p)),r()}catch(l){i(l)}finally{var c;(c=o)===null||c===void 0||c()}})),k(this,"handleUpdateVideoSendParameters",(async(n,r,i)=>{const s=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoSendParameters");try{const o=this.localTrackMap.get(Ee.LocalVideoTrack);if(!this.sendConnection||!o||o.track!==n||this.state!==Zt.Connected)return void r();const{id:c,track:l}=o;c&&await this.sendConnection.updateSendParameters(c,l),r()}catch(o){i(o)}finally{s()}})),k(this,"handleReplaceTrack",(async(n,r,i,s)=>{let o;R.debug("[".concat(this.store.clientId,"] P2PChannel2 handleReplaceTrack for [track-id-").concat(n.getTrackId(),"]")),typeof s=="boolean"&&s||(o=await this.sendMutex.lock("From P2PChannel2.handleReplaceTrack"));try{var c;const h=Array.from(this.localTrackMap.entries()).find((p=>{let[,{track:E}]=p;return n===E}));if(!this.sendConnection||!h||h[1].id===void 0||this.state!==Zt.Connected)return void r();if(await((c=this.sendConnection)===null||c===void 0?void 0:c.replaceTrack(n,h[1].id)),h[0]===Ee.LocalVideoTrack&&Ft().supportDualStreamEncoding){const p=this.localTrackMap.get(Ee.LocalVideoLowTrack);if(p){const E=n._mediaStreamTrack.clone();p.track._originMediaStreamTrack.stop(),p.track._mediaStreamTrack=E,p.track._originMediaStreamTrack=E,await new Pe(((g,v)=>{this.handleReplaceTrack(p.track,g,v,!0)}))}}r()}catch(h){i(h)}finally{var l;(l=o)===null||l===void 0||l()}})),k(this,"handleGetLocalVideoStats",(n=>{n(this.statsCollector.getLocalVideoTrackStats())})),k(this,"handleGetLocalAudioStats",(n=>{n(this.statsCollector.getLocalAudioTrackStats())})),k(this,"handleGetRemoteVideoStats",(n=>this.statsCollector.getRemoteVideoTrackStats(n.uid)[n.uid])),k(this,"handleGetRemoteAudioStats",(n=>this.statsCollector.getRemoteAudioTrackStats(n.uid)[n.uid])),this.store=e,this.statsCollector=t,this.statsCollector.addP2PChannel(this),this.statsUploader=new U2(e),this.bindStatsUploaderEvents(),this.sendMutex=new Yr("P2PChannel2-send-mutex",e.clientId),this.recvMutex=new Yr("P2PChannel2-recv-mutex",e.clientId),this.reconnectInterval=window.setInterval((()=>{[this.sendConnection,this.recvConnection].forEach((n=>{n&&(n.iceConnectionState!=="disconnected"&&n.iceConnectionState!=="failed"||this.handleDisconnect(n.direction))}))}),F("ICE_RESTART_INTERVAL"))}async startP2PConnection(e,t){throw new ce(U.NOT_SUPPORTED,"p2p mode does not support startP2PConnection.")}async connect(e){throw new ce(U.NOT_SUPPORTED,"p2p mode does not support connect.")}async startP2P(e,t){let n;try{if(t){this.recvConnection&&(R.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset recvConnection.")),this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection)),n=await this.recvMutex.lock("From P2PChannel.startP2P"),this.recvConnection=new cj(e,this.store,Ii.RECEIVE_ONLY),this.bindConnectionEvents(this.recvConnection);const r=await this.recvConnection.establish(t);return{iceParameters:r.iceParameters,dtlsParameters:r.dtlsParameters,sdp:r.sdp}}{this.state=Zt.New,this.sendConnection&&(R.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset sendConnection.")),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection)),n=await this.sendMutex.lock("From P2PChannel.startP2P"),this.sendConnection=new cj(e,this.store),this.store.peerConnectionStart(),this.bindConnectionEvents(this.sendConnection);const r=await this.sendConnection.establish();return{iceParameters:r.iceParameters,dtlsParameters:r.dtlsParameters,sdp:r.sdp}}}finally{n&&n()}}async p2pConnect(e){if(!this.sendConnection)throw new ce(U.UNEXPECTED_ERROR,"Cannot P2PChannel2.p2pConnect before P2PChannel2.startP2PConnection .");this.store.peerConnectionStart(),await this.sendConnection.connect(e),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=Zt.Connected}async addRemoteCandidate(e,t){if(t===Ii.RECEIVE_ONLY){if(!this.sendConnection)throw new ce(U.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.sendConnection.addRemoteCandidate(e)}else{if(!this.recvConnection)throw new ce(U.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.recvConnection.addRemoteCandidate(e)}}publish(e,t,n){var r=this;return eo((function*(){const i=yield jt(r.sendMutex.lock("From P2PChannel.publish"));try{if(!r.sendConnection||r.state!==Zt.Connected){r.throwIfTrackTypeNotMatch(e);const h=e.filter((p=>r.pendingLocalTracks.indexOf(p)===-1));return void(r.pendingLocalTracks=r.pendingLocalTracks.concat(h))}r.store.pubId=r.store.pubId+1,Qr.markPublishStart(r.store.clientId,r.store.pubId);const s=r.filterTobePublishedTracks(e,t,n);if(s.length===0)return void(yield jt(r.tryToUnmuteAudio(e)));s.forEach((h=>{let{track:p,type:E}=h;const g=Date.now();r.store.publish(p.getTrackId(),E===Ee.LocalAudioTrack?"audio":"video",g)})),r.bindLocalTrackEvents(s);const o=yield jt(r.sendConnection.send(s.map((h=>{let{track:p}=h;return p})),r.store.codec,r.store.audioCodec)),c=(yield jt(o.next())).value,l=r.createGatewayPublishMessage(s,c);try{yield l}catch(h){throw o.throw(h),h?.code===U.WS_ABORT&&s.forEach((p=>{let{track:E}=p;r.pendingLocalTracks.indexOf(E)===-1&&r.pendingLocalTracks.push(E)})),r.unbindLocalTrackEvents(s),h}yield jt(o.next()),s.forEach((h=>{let{type:p}=h;r.statsCollector.addLocalStats(p)})),r.statsUploader.startUploadOutboundStats(),r.assignLocalTracks(s,c),s.forEach((h=>{let{track:p,type:E}=h;const g=Date.now();r.store.publish(p.getTrackId(),E===Ee.LocalAudioTrack?"audio":"video",void 0,g)})),r.startUploadUplinkState()}finally{i()}}))()}async unpublish(e){if(!this.sendConnection||this.state!==Zt.Connected)return void(e.length===0?this.pendingLocalTracks.length=0:this.pendingLocalTracks=this.pendingLocalTracks.filter((i=>!Re(e).call(e,i))));const t=this.filterTobeUnpublishedTracks(e);if(t.length===0)return;const n=t.find((i=>i[0]==="videoLowTrack"));n&&n[1].track.close();const r=this.createGatewayUnpublishMessage(t);if(await this.sendConnection.stopSending(t.map((i=>{let[,{id:s}]=i;return s}))),this.withdrawLocalTracks(t),this.unbindLocalTrackEvents(t.map((i=>{let[s,{track:o}]=i;return{type:s,track:o}}))),t.forEach((i=>{let[s]=i;this.statsCollector.removeLocalStats(s)})),this.localTrackMap.size===0&&(this.statsUploader.stopUploadOutboundStats(),this.stopUploadUplinkState()),this.sendConnection&&this.state===Zt.Connected)return n&&n[1].track.close(),r;e.forEach((i=>{const s=this.pendingLocalTracks.indexOf(i);s!==-1&&this.pendingLocalTracks.splice(s,1)}))}startUploadUplinkState(){if(this.uploadUnplinkStarted)return;this.uploadUnplinkStarted=!0,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval);const e=()=>{const t=[],n=[];Array.from(this.localTrackMap.entries()).forEach((r=>{let[i,{track:s,ssrcs:o}]=r;const c={stream_type:P9(s,i),ssrcs:o};s._muted||!s._enabled?t.push(c):n.push(c)})),t.length>0&&t.forEach((r=>{cn(this,Xe.RequestMuteLocal,[r])})),n.length>0&&n.forEach((r=>{cn(this,Xe.RequestUnmuteLocal,[r])}))};e(),this.uplinkStateUploadInterval=window.setInterval((()=>{e()}),3e3)}stopUploadUplinkState(){this.uploadUnplinkStarted&&(this.uploadUnplinkStarted=!1,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval))}publishLowStream(e){return eo((function*(){throw new ce(U.NOT_SUPPORTED,"p2p mode does not support publishLowStream.")}))()}async republish(){this.pendingLocalTracks.length>0&&(R.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await Fr(this,Xe.RequestRePublish,this.pendingLocalTracks),this.emit(Xe.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[])}async unpublishLowStream(){throw new ce(U.NOT_SUPPORTED,"p2p mode does not support unpublishLowStream.")}async subscribe(e,t,n,r){var i;if(!this.recvConnection)throw new ce(U.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");if((i=this.remoteUserMap.get(e))!==null&&i!==void 0&&i.has(t))return;const{track:s,mid:o,transceiver:c}=await this.recvConnection.receive(t,[{ssrcId:n}],String(e.uid),r);t===Le.AUDIO?(e._audioTrack?e._audioTrack._updateOriginMediaStreamTrack(s):(e._audioTrack=new Uf(s,e.uid,e._uintid,this.store),R.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(e._audioTrack.getTrackId()))),c&&e._audioTrack._updateRtpTransceiver(c),this.bindRemoteTrackEvents(e,e._audioTrack)):(e._videoSSRC=n,e._videoTrack?e._videoTrack._updateOriginMediaStreamTrack(s):(e._videoTrack=new Mf(s,e.uid,e._uintid,this.store),R.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(e._videoTrack.getTrackId()))),c&&e._videoTrack._updateRtpTransceiver(c),this.bindRemoteTrackEvents(e,e._videoTrack));const l=this.remoteUserMap.get(e);l?l.set(t,o):this.remoteUserMap.set(e,new Map([[t,o]])),this.statsCollector.addRemoteStats(e.uid),this.statsUploader.startUploadInboundStats(),this.startUploadDownlinkState();const h=this.pendingRemoteTracks.findIndex((p=>{let{user:E,kind:g}=p;return E.uid===e.uid&&t===g}));h!==-1&&(this.pendingRemoteTracks.splice(h,1),this.emit(Xe.MediaReconnectEnd,e.uid))}async mockSubscribe(e,t,n,r){if(!this.recvConnection)throw new ce(U.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");await this.recvConnection.mockReceive(t,[{ssrcId:n}],String(e.uid),r)}async unsubscribe(e,t,n){const r=this.pendingRemoteTracks.filter((s=>{let{user:o,kind:c}=s;return t!==void 0?o.uid===e.uid&&t===c:o.uid===e.uid}));if(r.forEach((s=>{const o=this.pendingRemoteTracks.indexOf(s);this.pendingRemoteTracks.splice(o,1)})),this.recvConnection||n||r.forEach((s=>{let{kind:o}=s;var c;if(o===Le.AUDIO)(c=e._audioTrack)===null||c===void 0||c._destroy(),e._audioTrack=void 0;else if(o===Le.VIDEO){var l;(l=e._videoTrack)===null||l===void 0||l._destroy(),e._videoTrack=void 0}})),!this.recvConnection)return;const i=this.filterTobeUnSubscribedTracks(e,t);i.length!==0&&(await this.recvConnection.stopReceiving(i.map((s=>{let[,{id:o}]=s;return o}))),this.withdrawRemoteTracks(i),this.remoteUserMap.size===0&&(this.statsUploader.stopUploadInboundStats(),this.stopUploadDownlinkState()),i.forEach((s=>{let[o,{kind:c}]=s;var l,h;if(c===Le.VIDEO&&o._videoSSRC&&((l=this.recvConnection)===null||l===void 0||l.setStatsRemoteVideoIsReady(o._videoSSRC,!1)),c===Le.VIDEO)this.unbindRemoteTrackEvents(o._videoTrack),n||((h=o._videoTrack)===null||h===void 0||h._destroy(),o._videoTrack=void 0);else if(c===Le.AUDIO){var p;this.unbindRemoteTrackEvents(o._audioTrack),!n&&((p=o._audioTrack)===null||p===void 0||p._destroy(),o._audioTrack=void 0)}})),i.forEach((s=>{let[,{kind:o}]=s;cn(this,Xe.RequestP2PMuteRemote,o)})))}startUploadDownlinkState(){if(this.uploadDownlinkStarted)return;this.uploadDownlinkStarted=!0,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval);const e=()=>Array.from(this.remoteUserMap.entries()).forEach((t=>{let[,n]=t;[Le.VIDEO,Le.AUDIO].forEach((r=>{n.has(r)?cn(this,Xe.RequestP2PUnmuteRemote,r):cn(this,Xe.RequestP2PMuteRemote,r)}))}));e(),this.downlinkStatsUploadInterval=window.setInterval((()=>{e()}),3e3)}stopUploadDownlinkState(){this.uploadDownlinkStarted&&(this.uploadDownlinkStarted=!1,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval))}getAllDataChannels(){return this.localDataChannels}async massSubscribe(e){throw new ce(U.NOT_SUPPORTED,"p2p mode does not support massSubscribe.")}async massSubscribeNoLock(e){throw new ce(U.NOT_SUPPORTED,"p2p mode does not support massSubscribeNoLock.")}async massUnsubscribe(e){throw new ce(U.NOT_SUPPORTED,"p2p mode does not support massUnsubscribe.")}async massUnsubscribeNoLock(e){throw new ce(U.NOT_SUPPORTED,"p2p mode does not support massUnsubscribeNoLock.")}async muteRemote(e,t){if(!this.recvConnection)return;const n=this.remoteUserMap.get(e);if(!n)return void R.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(e.uid,"."));if(!n.get(t))return void R.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."));const r=t===Le.VIDEO?e._videoSSRC:e._audioSSRC;r!==void 0&&this.recvConnection.setStatsRemoteVideoIsReady(r,!1)}async unmuteRemote(e,t){return this.unmuteRemoteNoLock(e,t)}async unmuteRemoteNoLock(e,t){if(!this.recvConnection)return;const n=this.remoteUserMap.get(e);if(!n)return void R.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(e.uid,"."));n.get(t)||R.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."))}getAllTracks(e){const t=this.localTrackMap.get(Ee.LocalAudioTrack);if(t?.track instanceof ar){const n=t.track;return Array.from(this.localTrackMap.entries()).filter((r=>{let[i]=r;return i!==Ee.LocalAudioTrack})).filter((r=>{let[i]=r;return!(e&&i===Ee.LocalVideoLowTrack)})).map((r=>{let[,{track:i}]=r;return i})).concat(n.trackList)}return Array.from(this.localTrackMap.entries()).filter((n=>{let[r]=n;return!(e&&r===Ee.LocalVideoLowTrack)})).map((n=>{let[,{track:r}]=n;return r}))}reportPublishEvent(e,t,n,r,i){if(e){const o=this.localTrackMap.get(Ee.LocalAudioTrack),c=r?this.localTrackMap.get(Ee.LocalVideoLowTrack):this.localTrackMap.get(Ee.LocalVideoTrack);We.publish(this.store.sessionId,{eventElapse:Qr.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:o?.track.getTrackLabel(),videoName:c?.track.getTrackLabel(),screenshare:c?.track._hints.indexOf(an.SCREEN_TRACK)!==-1,audio:!!o,video:!!c,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:i})}else{var s;n||(n=[]);const o=n.find((l=>l instanceof Fn)),c=r?(s=this.localTrackMap.get(Ee.LocalVideoTrack))===null||s===void 0?void 0:s.track:n.find((l=>l instanceof vn));We.publish(this.store.sessionId,{eventElapse:Qr.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:o?.getTrackLabel(),videoName:c?.getTrackLabel(),screenshare:c?._hints.indexOf(an.SCREEN_TRACK)!==-1,audio:!!o,video:!!c,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:i})}}reportSubscribeEvent(e,t,n,r){const i=r===Le.VIDEO?n._videoSSRC:n._audioSSRC;i&&We.subscribe(this.store.sessionId,{succ:e,ec:t,video:r===Le.VIDEO,audio:r===Le.AUDIO,peerid:n.uid,subscribeRequestid:r===Le.VIDEO?n._videoSSRC:n._audioSSRC,p2pid:this.store.p2pId,eventElapse:Qr.measureFromSubscribeStart(this.store.clientId,i)})}reset(){R.debug("[".concat(this.store.clientId,"] P2PChannel2.reset")),this.sendMutex=new Yr("P2PChannel2-send-mutex",this.store.clientId),this.sendMutex=new Yr("P2PChannel2-recv-mutex",this.store.clientId),this.sendConnection&&(this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0),this.recvConnection&&(this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const e=this.localTrackMap.get(Ee.LocalAudioTrack);if(e?.track instanceof ar){if(e.track.trackList.length>0){const t=e.track;e.track.trackList.forEach((n=>{t.removeAudioTrack(n)}))}e.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.reconnectInterval&&(window.clearInterval(this.reconnectInterval),this.reconnectInterval=void 0),this.state=Zt.Disconnected}getStats(e){var t,n;return e?(n=this.recvConnection)===null||n===void 0?void 0:n.getStats():(t=this.sendConnection)===null||t===void 0?void 0:t.getStats()}getRemoteVideoIsReady(e){var t;return((t=this.recvConnection)===null||t===void 0?void 0:t.getRemoteVideoIsReady(e))||!1}getLocalAudioVolume(){const e=this.localTrackMap.get(Ee.LocalAudioTrack);if(e)return e.track.getVolumeLevel()}getLocalVideoSize(){const e=this.localTrackMap.get(Ee.LocalVideoTrack);if(e)return{width:e.track.videoWidth||0,height:e.track.videoHeight||0}}getEncoderConfig(e){const t=this.localTrackMap.get(e);return t&&t.track instanceof vn||t&&t.track instanceof Fn?t.track._encoderConfig:void 0}getLocalMedia(e){return this.localTrackMap.get(e)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(e,t){if(!e)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(e);return!!n&&(!t||n.has(t))}async hasRemoteMediaWithLock(e,t){if(!e)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(e);return!!n&&(!t||n.has(t))}getRemoteMedia(e){var t;const n=Array.from($i(t=this.remoteUserMap).call(t)).find((r=>r.uid===e));return n?{audioTrack:n.audioTrack,audioSSRC:n._audioSSRC,videoTrack:n.videoTrack,videoSSRC:n._videoSSRC}:{}}getAudioLevels(){let e=Array.from(this.remoteUserMap.entries()).map((n=>{let[r]=n;return{uid:r.uid,level:r.audioTrack?100*r.audioTrack._source.getAccurateVolumeLevel():0}}));const t=this.localTrackMap.get(Ee.LocalAudioTrack);return t&&e.push({level:100*t.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e=sh(e).call(e,((n,r)=>n.level-r.level)),e}async disconnectForReconnect(){this.sendConnection&&this.recvConnection&&(R.debug("[".concat(this.store.clientId,"] P2PChannel2.disconnectForReconnect closing P2PConnection")),this.state=Zt.Reconnecting,F("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach((e=>{let[t]=e;var n;t._videoTrack&&t._videoTrack._player&&((n=t._videoTrack._player.getVideoElement())===null||n===void 0||n.pause(),t._videoTrack._player.isKeepLastFrame=!0,t._videoTrack._originMediaStreamTrack.stop())})),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0,this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0,this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach((e=>{var t;let[n,{track:r}]=e;switch(n){case Ee.LocalVideoTrack:Re(t=r._hints).call(t,an.LOW_STREAM)?r.close():this.pendingLocalTracks.push(r);break;case Ee.LocalAudioTrack:r instanceof ar?this.pendingLocalTracks=this.pendingLocalTracks.concat(r.trackList):this.pendingLocalTracks.push(r);case Ee.LocalVideoLowTrack:}})),this.emit(Xe.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach((e=>{let[t,n]=e;Array.from($i(n).call(n)).forEach((r=>{this.setPendingRemoteMedia(t,r)})),this.emit(Xe.MediaReconnectStart,t.uid)})),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),R.debug("[".concat(this.store.clientId,"] P2PChannel2 disconnected, waiting to reconnect.")))}hasPendingRemoteMedia(e,t){for(const n of this.pendingRemoteTracks){const{user:r,kind:i}=n;if((e instanceof Ud?e.uid:e)===r.uid&&t===i)return!0}return!1}setPendingRemoteMedia(e,t){this.hasPendingRemoteMedia(e,t)||this.pendingRemoteTracks.push({user:e,kind:t})}async restartICE(e,t){let n,r;if(e===Ii.SEND_ONLY){if(!this.sendConnection)throw new ce(U.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established.");n=await this.sendMutex.lock("From P2PChannel.restartICE"),r=this.sendConnection}else{if(!this.recvConnection)throw new ce(U.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before recvConnection established.");n=await this.recvMutex.lock("From P2PChannel.restartICE"),r=this.recvConnection}try{if(t){const i=await r.restartICE(t);return r.isInRestartIce=!1,i}{const i=await r.restartICE();if(i){const s=await Fr(this,Xe.RequestP2PRestartICE,{direction:Ii.RECEIVE_ONLY,iceParameter:i});await r.restartICE(s),r.isInRestartIce=!1}}}finally{n()}}getUplinkNetworkQuality(){if(!this.sendConnection)return 0;const e=this.sendConnection.getStats(),t=this.localTrackMap.get(Ee.LocalVideoTrack),n=this.localTrackMap.get(Ee.LocalAudioTrack),r=e.videoSend.find((v=>{var O;return v.ssrc===(t==null||(O=t.ssrcs)===null||O===void 0?void 0:O[0].ssrcId)})),i=e.audioSend.find((v=>{var O;return v.ssrc===(n==null||(O=n.ssrcs)===null||O===void 0?void 0:O[0].ssrcId)}));if(!r||!i)return 1;const s=Is(this,Xe.NeedSignalRTT),o=r?r.rttMs:void 0,c=i?i.rttMs:void 0,l=o&&c?(o+c)/2:o||c,h=(l&&s?(l+s)/2:l||s)||0,p=100*e.sendPacketLossRate*.7/50+.3*h/1500,E=p<.17?1:p<.36?2:p<.59?3:p<.1?4:5,g=t?.track;if(g&&g._encoderConfig&&g._hints.indexOf(an.SCREEN_TRACK)===-1){const v=g._encoderConfig.bitrateMax,O=e.bitrate.actualEncoded;if(v&&O){const I=(1e3*v-O)/(1e3*v);return IM[I<.15?0:I<.3?1:I<.45?2:I<.6?3:4][E]}}return E}getDownlinkNetworkQuality(){if(!this.recvConnection)return 0;const e=this.recvConnection.getStats();let t=0;return Array.from(this.remoteUserMap.entries()).forEach((n=>{let[r]=n;const i=r._audioSSRC,s=r._videoSSRC,o=e.audioRecv.find((O=>O.ssrc===i)),c=e.videoRecv.find((O=>O.ssrc===s));if(!o&&!c)return void(t+=1);const l=Is(this,Xe.NeedSignalRTT),h=e.rtt,p=(h&&l?(h+l)/2:h||l)||0,E=o?o.jitterMs:void 0,g=e.recvPacketLossRate;let v=.7*g*100/50+.3*p/1500;E&&(v=.6*g*100/50+.2*p/1500+.2*E/400),t+=v<.1?1:v<.17?2:v<.36?3:v<.59?4:5})),this.remoteUserMap.size>0?Math.round(t/this.remoteUserMap.size):t}async muteLocalTrack(e){return new Pe(((t,n)=>{this.handleMuteLocalTrack(e,t,n)}))}filterTobePublishedTracks(e,t,n){const r=[],i=Ft(),s=this.getAllTracks();e=Rf(e=e.filter((l=>s.indexOf(l)===-1)));let o=!1,c=!1;for(const l of e){if(l instanceof vn&&(this.localTrackMap.has(Ee.LocalVideoTrack)||o?new ce(U.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(r.push({track:l,type:Ee.LocalVideoTrack}),o=!0),t)){const h=this.getLowVideoTrack(l,n);r.push({track:h,type:Ee.LocalVideoLowTrack})}if(l instanceof Fn){const h=this.localTrackMap.get(Ee.LocalAudioTrack);if(h){if(!(h.track instanceof ar))throw new ce(U.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(l._bypassWebAudio)throw new ce(U.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");h.track.addAudioTrack(l),this.bindLocalAudioTrackEvents(l,!0)}else if(c){const p=r.find((E=>{let{type:g}=E;return g===Ee.LocalAudioTrack}));if(!(p.track instanceof ar))throw new ce(U.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(l._bypassWebAudio)throw new ce(U.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");p.track.addAudioTrack(l)}else{if(!i.webAudioMediaStreamDest||l instanceof ar||l._bypassWebAudio)r.push({track:l,type:Ee.LocalAudioTrack});else{const p=new ar;p.addAudioTrack(l),r.push({track:p,type:Ee.LocalAudioTrack})}c=!0}}}return r}filterTobeUnpublishedTracks(e){const t=[],n=this.getAllTracks();e=Rf(e=e.filter((r=>n.indexOf(r)!==-1)));for(const r of e){if(r instanceof Fn){const i=this.localTrackMap.get(Ee.LocalAudioTrack);if(!i)continue;i.track instanceof ar?(i.track.removeAudioTrack(r),this.unbindLocalAudioTrackEvents(r),i.track.trackList.length===0&&(t.push([Ee.LocalAudioTrack,i]),i.track.close())):t.push([Ee.LocalAudioTrack,i])}if(r instanceof vn){const i=this.localTrackMap.get(Ee.LocalVideoTrack);if(!i)continue;t.push([Ee.LocalVideoTrack,i]);const s=this.localTrackMap.get(Ee.LocalVideoLowTrack);s&&t.push([Ee.LocalVideoLowTrack,s])}}return t}bindLocalTrackEvents(e){e.forEach((t=>{let{track:n,type:r}=t;switch(r){case Ee.LocalVideoTrack:n.addListener(Ve.GET_STATS,this.handleGetLocalVideoStats),n.addListener(Ve.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(Ve.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(Ve.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n.addListener(Ve.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),n.addListener(Ve.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.addListener(Ve.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(Ve.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Ee.LocalAudioTrack:this.bindLocalAudioTrackEvents(n);case Ee.LocalVideoLowTrack:}}))}bindLocalAudioTrackEvents(e,t){e instanceof ar?e.trackList.forEach((n=>{n.addListener(Ve.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(Ve.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(Ve.GET_STATS,this.handleGetLocalAudioStats),n.addListener(Ve.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(Ve.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)})):(e.addListener(Ve.GET_STATS,this.handleGetLocalAudioStats),e.addListener(Ve.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(Ve.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(Ve.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(Ve.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),t||e.addListener(Ve.NEED_REPLACE_TRACK,this.handleReplaceTrack))}unbindLocalTrackEvents(e){e||(e=Array.from(this.localTrackMap.entries()).map((t=>{let[n,{track:r}]=t;return{track:r,type:n}}))),e.forEach((t=>{let{track:n,type:r}=t;switch(r){case Ee.LocalVideoTrack:n.off(Ve.GET_STATS,this.handleGetLocalVideoStats),n.off(Ve.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.off(Ve.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.off(Ve.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n.off(Ve.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),n.off(Ve.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.off(Ve.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.off(Ve.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Ee.LocalAudioTrack:this.unbindLocalAudioTrackEvents(n);case Ee.LocalVideoLowTrack:}}))}unbindLocalAudioTrackEvents(e){e instanceof ar?e.trackList.forEach((t=>{t.off(Ve.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(Ve.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(Ve.GET_STATS,this.handleGetLocalAudioStats),t.off(Ve.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(Ve.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)})):(e.off(Ve.GET_STATS,this.handleGetLocalAudioStats),e.off(Ve.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(Ve.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(Ve.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(Ve.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(Ve.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(e,t){t instanceof Mf&&t.addListener(Ve.GET_STATS,(n=>{n(this.handleGetRemoteVideoStats(e))})),t instanceof Uf&&t.addListener(Ve.GET_STATS,(n=>{n(this.handleGetRemoteAudioStats(e))}))}unbindRemoteTrackEvents(e){e&&e.removeAllListeners(Ve.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach((e=>{let[t,n]=e;n.has(Le.AUDIO)&&this.unbindRemoteTrackEvents(t._audioTrack),n.has(Le.VIDEO)&&this.unbindRemoteTrackEvents(t._videoTrack)}))}createGatewayPublishMessage(e,t){return e.map(((n,r)=>{var i;let s,{track:o,type:c}=n;switch(c){case Ee.LocalAudioTrack:s=en.Audio;break;case Ee.LocalVideoTrack:s=Re(i=o._hints).call(i,an.SCREEN_TRACK)?en.Screen:en.High;break;case Ee.LocalVideoLowTrack:s=en.Low}return{kind:c===Ee.LocalAudioTrack?Le.AUDIO:Le.VIDEO,stream_type:s,mid:t[r].id,ssrcs:t[r].localSSRC,isMuted:o.muted||!o.enabled}}))}createGatewayUnpublishMessage(e){return e.map((t=>{var n;let r,[i,{track:s,ssrcs:o,id:c}]=t;switch(i){case Ee.LocalVideoTrack:r=Re(n=s._hints).call(n,an.SCREEN_TRACK)?en.Screen:en.High;break;case Ee.LocalAudioTrack:r=en.Audio;break;case Ee.LocalVideoLowTrack:r=en.Low}return{stream_type:r,ssrcs:o,mid:c}}))}assignLocalTracks(e,t){e.forEach(((n,r)=>{let{track:i,type:s}=n;this.localTrackMap.set(s,{track:i,id:t[r].id,ssrcs:t[r].localSSRC})}))}withdrawLocalTracks(e){e.forEach((t=>{let[n]=t;this.localTrackMap.delete(n)}))}bindConnectionEvents(e){e.onConnectionStateChange=async t=>{var n;R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: ").concat(e.name,".onConnectionStateChange(").concat(t,")")),this.emit(Xe.PeerConnectionStateChange,t),t!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),t==="connected"&&(e.isInRestartIce=!1),Re(n=this._restartStates).call(n,t)&&!e.isInRestartIce&&(t==="disconnected"&&await Dr(800),e.iceConnectionState!=="disconnected"&&e.iceConnectionState!=="failed"||this.handleDisconnect(e.direction))},e.onICEConnectionStateChange=t=>{t!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(t,")")),We.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:t,tag:In.TRACER}).onSuccess(),this.emit(Xe.IceConnectionStateChange,t)},e.onICETransportStateChange=t=>{R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(t,")"))},e.onDTLSTransportStateChange=t=>{R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(t,")"))},e.onDTLSTransportError=t=>{R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(t,")"))},e.onFirstAudioDecoded=t=>{var n;const r=Array.from($i(n=this.remoteUserMap).call(n)).find((s=>s._audioSSRC===t));var i;r&&(this.store.subscribe(r.uid,"audio",void 0,void 0,void 0,Date.now()),(i=r.audioTrack)===null||i===void 0||i.emit(ro.FIRST_FRAME_DECODED),We.firstRemoteFrame(this.store.sessionId,pr.FIRST_AUDIO_DECODE,bn.FIRST_AUDIO_DECODE,{peer:r._uintid,subscribeElapse:Qr.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId}))},e.onFirstAudioReceived=t=>{var n;const r=Array.from($i(n=this.remoteUserMap).call(n)).find((i=>i._audioSSRC===t));r&&We.firstRemoteFrame(this.store.sessionId,pr.FIRST_AUDIO_RECEIVED,bn.FIRST_AUDIO_RECEIVED,{peer:r._uintid,subscribeElapse:Qr.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onFirstVideoDecoded=(t,n,r)=>{this.reportVideoFirstFrameDecoded(t,n,r)},e.onFirstVideoReceived=t=>{var n;const r=Array.from($i(n=this.remoteUserMap).call(n)).find((i=>i._videoSSRC===t));r&&We.firstRemoteFrame(this.store.sessionId,pr.FIRST_VIDEO_RECEIVED,bn.FIRST_VIDEO_RECEIVED,{peer:r._uintid,subscribeElapse:Qr.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onSelectedLocalCandidateChanged=(t,n)=>{const r=t.candidateType==="relay",i=n.candidateType==="relay";n.candidateType!=="unknown"&&r===i||this.emit(Xe.ConnectionTypeChange,r),R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(Dd(n))," -> ").concat(JSON.stringify(Dd(t)),")"))},e.onSelectedRemoteCandidateChanged=(t,n)=>{R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(Dd(n))," -> ").concat(JSON.stringify(Dd(t)),")"))},e.onFirstVideoDecodedTimeout=t=>{this.reportVideoFirstFrameDecoded(t,void 0,void 0,!0)},e.onLocalCandidate=t=>{this.emit(Xe.LocalCandidate,{candidate:t,direction:e.direction})}}unbindConnectionEvents(e){e.onConnectionStateChange=void 0,e.onICEConnectionStateChange=void 0,e.onICETransportStateChange=void 0,e.onDTLSTransportStateChange=void 0,e.onDTLSTransportError=void 0,e.onFirstAudioDecoded=void 0,e.onFirstAudioReceived=void 0,e.onFirstVideoDecoded=void 0,e.onFirstVideoReceived=void 0,e.onSelectedLocalCandidateChanged=void 0,e.onSelectedRemoteCandidateChanged=void 0,e.onFirstVideoDecodedTimeout=void 0,e.onLocalCandidate=void 0}async handleDisconnect(e){const t=e===Ii.SEND_ONLY?this.sendConnection:this.recvConnection;t&&!t.isInRestartIce&&(t.isInRestartIce=!0,R.debug("[".concat(this.store.clientId,"] [P2PChannel-").concat(t.name,"] start use restartICE")),e===Ii.SEND_ONLY?this.restartICE(e):Fr(this,Xe.RequestP2PRestartICE,{direction:Ii.SEND_ONLY}))}filterTobeMutedTracks(e){const t=[];if(this.getAllTracks().indexOf(e)===-1)return t;const n=this.localTrackMap.get(Ee.LocalAudioTrack);if(e instanceof Fn&&n?.track instanceof ar)return n.track.isActive||t.push([Ee.LocalAudioTrack,n]),t;const r=Array.from(this.localTrackMap.entries()).find((i=>{let[,{track:s}]=i;return e===s}));if(r&&(t.push(r),r[0]===Ee.LocalVideoTrack)){const i=this.localTrackMap.get(Ee.LocalVideoLowTrack);i&&t.push([Ee.LocalVideoLowTrack,i])}return t}filterTobeUnmutedTracks(e){const t=[],n=this.localTrackMap.get(Ee.LocalAudioTrack);if(e instanceof Fn&&n?.track instanceof ar)return n.track.isActive&&t.push([Ee.LocalAudioTrack,n]),t;const r=Array.from(this.localTrackMap.entries()).find((i=>{let[,{track:s}]=i;return e===s}));if(r)if(r[0]===Ee.LocalVideoTrack){t.push(r);const i=this.localTrackMap.get(Ee.LocalVideoLowTrack);i&&t.push([Ee.LocalVideoLowTrack,i])}else t.push(r);return t}createMuteMessage(e){return e.map((t=>{var n;let r,[i,{track:s,ssrcs:o,id:c}]=t;switch(i){case Ee.LocalAudioTrack:r=en.Audio;break;case Ee.LocalVideoTrack:r=Re(n=s._hints).call(n,an.SCREEN_TRACK)?en.Screen:en.High;break;case Ee.LocalVideoLowTrack:r=en.Low}return{stream_type:r,ssrcs:o,mid:c}}))}createUnmuteMessage(e){return e.map((t=>{var n;let r,[i,{track:s,ssrcs:o,id:c}]=t;switch(i){case Ee.LocalAudioTrack:r=en.Audio;break;case Ee.LocalVideoTrack:r=Re(n=s._hints).call(n,an.SCREEN_TRACK)?en.Screen:en.High;break;case Ee.LocalVideoLowTrack:r=en.Low}return{stream_type:r,ssrcs:o,mid:c}}))}filterTobeUnSubscribedTracks(e,t){const n=[],r=this.remoteUserMap.get(e);if(!r)return n;if(t){const i=r.get(t);if(!i)return n;n.push([e,{kind:t,id:i}])}else Array.from(r.entries()).forEach((i=>{let[s,o]=i;n.push([e,{kind:s,id:o}])}));return n}createUnsubscribeMessage(e){const t=[];return e.forEach((n=>{let[r,{kind:i,id:s}]=n;switch(i){case Le.VIDEO:return void(r._videoSSRC&&t.push({stream_type:Le.VIDEO,ssrcId:r._videoSSRC}));case Le.AUDIO:return void(r._audioSSRC&&t.push({stream_type:Le.AUDIO,ssrcId:r._audioSSRC}))}})),t}withdrawRemoteTracks(e){e.forEach((t=>{let[n,{kind:r}]=t;const i=this.remoteUserMap.get(n);i&&(i.delete(r),Array.from(i.entries()).length===0&&this.remoteUserMap.delete(n))}))}async updateBitrateLimit(e){const t=this.localTrackMap.get(Ee.LocalVideoTrack),n=this.localTrackMap.get(Ee.LocalVideoLowTrack);t&&(await t.track.setBitrateLimit(e.uplink),await new Pe(((r,i)=>{this.handleUpdateVideoEncoder(t.track,r,i,!0)}))),n&&e.low_stream_uplink&&(await n.track.setBitrateLimit({max_bitrate:e.low_stream_uplink.bitrate,min_bitrate:e.low_stream_uplink.bitrate||0}),await new Pe(((r,i)=>{this.handleUpdateVideoEncoder(n.track,r,i,!0)})))}isP2PDisconnected(){if(this.sendConnection&&this.recvConnection){const e=this.sendConnection.peerConnectionState,t=this.recvConnection.peerConnectionState;return e!=="connected"&&t!=="connected"}return!0}async tryToUnmuteAudio(e){for(let t=0;t<e.length;t++)if(e[t]instanceof Fn){const n=this.filterTobeUnmutedTracks(e[t]);if(n.length===0)continue;const r=this.createUnmuteMessage(n);return void await cn(this,Xe.RequestUnmuteLocal,r)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=e=>this.getStats(e),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()).filter((e=>{let[,{ssrcs:t}]=e;return!!t})),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=e=>{var t;return!((t=this.recvConnection)===null||t===void 0||!t.getRemoteVideoIsReady(e))},this.statsUploader.requestUpload=(e,t)=>this.emit(Xe.RequestUpload,e,t),this.statsUploader.requestUploadStats=e=>this.emit(Xe.RequestUploadStats,e),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await Dr(Z0(this.dtlsFailedCount,rr)),this.emit(Xe.RequestReconnect)}async reconnectP2P(){}canPublishLowStream(){return this.localTrackMap.has(Ee.LocalVideoTrack)||this.pendingLocalTracks.some((e=>e instanceof vn))}throwIfTrackTypeNotMatch(e){if(e.filter((t=>t instanceof vn)).length>1)throw new ce(U.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e.filter((t=>t instanceof Fn)).length>1&&(e.some((t=>t instanceof Fn&&t._bypassWebAudio))||!Ft().webAudioMediaStreamDest))throw new ce(U.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const t of e){if(t instanceof vn&&this.pendingLocalTracks.some((n=>n instanceof vn)))throw new ce(U.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t instanceof Fn&&this.pendingLocalTracks.some((n=>n instanceof Fn))&&(!Ft().webAudioMediaStreamDest||t._bypassWebAudio||this.pendingLocalTracks.some((n=>n instanceof Fn&&n._bypassWebAudio))))throw new ce(U.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(e,t){const n=!F("DISABLE_DUAL_STREAM_USE_ENCODING")&&Ft().supportDualStreamEncoding,r=zT(zT({},{width:160,height:120,framerate:15,bitrate:50}),t);let i;i=n?e._mediaStreamTrack.clone():fI(e,r);const s=ln(8,"track-low-"),o=new vn(i,zT(zT({},n&&{scaleResolutionDownBy:qb(r,e)}),{},{frameRate:r.framerate,bitrateMax:r.bitrate,bitrateMin:r.bitrate}),void 0,void 0,s);return o.on(gh.TRANSCEIVER_UPDATED,(c=>{e._updateRtpTransceiver(c,Of.LOW_STREAM)})),o._hints.push(an.LOW_STREAM),e.addListener(Ve.NEED_CLOSE,(()=>{o.close()})),o}async globalLock(){return this.recvMutex.lock("From P2PChannel2.globalLock")}reportVideoFirstFrameDecoded(e,t,n,r){var i;const s=Array.from($i(i=this.remoteUserMap).call(i)).find((o=>o._videoSSRC===e));if(s){r||this.store.subscribe(s.uid,"video",void 0,void 0,void 0,void 0,Date.now());const o=this.store.keyMetrics,c=o.subscribe.find((l=>l.userId===s.uid&&l.type==="video"));We.firstRemoteVideoDecode(this.store.sessionId,pr.FIRST_VIDEO_DECODE,bn.FIRST_VIDEO_DECODE,{peer:s._uintid,videowidth:t,videoheight:n,subscribeElapse:Qr.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId,apEnd:o.requestAPEnd||0,apStart:o.requestAPStart||0,joinGwEnd:o.joinGatewayEnd||0,joinGwStart:o.joinGatewayStart||0,pcEnd:o.peerConnectionEnd||0,pcStart:o.peerConnectionStart||0,subscriberEnd:c?.subscribeEnd||0,subscriberStart:c?.subscribeStart||0,videoAddNotify:c?.streamAdded||0,state:r?1:0})}}async remoteMediaSsrcChanged(e,t,n){if(!this.recvConnection)return!1;const r=this.remoteUserMap.get(e);if(!r)return!1;const i=r.get(t);if(!i)return!1;const s=await this.recvConnection.getRemoteSSRC(i);return s!==void 0&&s!==n}isPreSubScribe(e){return!1}async publishDataChannel(e){throw new ce(U.NOT_SUPPORTED)}async unpublishDataChannel(e){throw new ce(U.NOT_SUPPORTED)}async subscribeDataChannel(e,t){throw new ce(U.NOT_SUPPORTED)}async unsubscribeDataChannel(e,t){throw new ce(U.NOT_SUPPORTED)}hasPendingRemoteDataChannel(e,t){throw new ce(U.NOT_SUPPORTED)}setPendingRemoteDataChannel(e,t){throw new ce(U.NOT_SUPPORTED)}async preConnect(e){throw new ce(U.NOT_SUPPORTED)}getEstablishParams(){throw new ce(U.NOT_SUPPORTED)}async reSubscribe(e){throw new ce(U.NOT_SUPPORTED)}reportVideoFirstFrameRender(e){}async updateVideoStreamParameter(e,t){throw new ce(U.NOT_SUPPORTED)}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach((e=>{let[t,{track:n}]=e;t===Ee.LocalVideoLowTrack?n._updateRtpTransceiver(void 0,Of.LOW_STREAM):n._updateRtpTransceiver(void 0)}))}},Be(Nn.prototype,"p2pConnect",[lj],Object.getOwnPropertyDescriptor(Nn.prototype,"p2pConnect"),Nn.prototype),Be(Nn.prototype,"unpublish",[dj],Object.getOwnPropertyDescriptor(Nn.prototype,"unpublish"),Nn.prototype),Be(Nn.prototype,"unpublishLowStream",[uj],Object.getOwnPropertyDescriptor(Nn.prototype,"unpublishLowStream"),Nn.prototype),Be(Nn.prototype,"subscribe",[hj],Object.getOwnPropertyDescriptor(Nn.prototype,"subscribe"),Nn.prototype),Be(Nn.prototype,"mockSubscribe",[pj],Object.getOwnPropertyDescriptor(Nn.prototype,"mockSubscribe"),Nn.prototype),Be(Nn.prototype,"unsubscribe",[fj],Object.getOwnPropertyDescriptor(Nn.prototype,"unsubscribe"),Nn.prototype),Be(Nn.prototype,"muteRemote",[mj],Object.getOwnPropertyDescriptor(Nn.prototype,"muteRemote"),Nn.prototype),Be(Nn.prototype,"unmuteRemote",[_j],Object.getOwnPropertyDescriptor(Nn.prototype,"unmuteRemote"),Nn.prototype),Be(Nn.prototype,"hasRemoteMediaWithLock",[Ej],Object.getOwnPropertyDescriptor(Nn.prototype,"hasRemoteMediaWithLock"),Nn.prototype),Be(Nn.prototype,"disconnectForReconnect",[gj],Object.getOwnPropertyDescriptor(Nn.prototype,"disconnectForReconnect"),Nn.prototype),Be(Nn.prototype,"remoteMediaSsrcChanged",[vj],Object.getOwnPropertyDescriptor(Nn.prototype,"remoteMediaSsrcChanged"),Nn.prototype),Nn);function Pa(e){return function(t,n,r){const i=t[n];if(typeof i!="function")throw new Error("Cannot use mutex on object property.");return r.value=async function(){for(var s=arguments.length,o=new Array(s),c=0;c<s;c++)o[c]=arguments[c];switch(e){case Oa.SEND_ONLY:{const l=await this.sendMutex.lock("From P2PChannel2.".concat(n));try{return await i.apply(this,o)}finally{l()}}case Oa.RECEIVE_ONLY:{const l=await this.recvMutex.lock("From P2PChannel2.".concat(n));try{return await i.apply(this,o)}finally{l()}}default:{const l=await this.sendMutex.lock("From P2PChannel2.".concat(n)),h=await this.recvMutex.lock("From P2PChannel2.".concat(n));try{return await i.apply(this,o)}finally{l(),h()}}}},r}}class Mh extends Pn{constructor(t,n){super(),k(this,"signal",void 0),k(this,"token",void 0),k(this,"tokenTimeout",void 0),k(this,"tokenInterval",void 0),k(this,"_sequence",0),k(this,"userMap",new Map),k(this,"encoder",new TextEncoder),this.signal=t,this.token=n;const r=()=>{this.signal.connectionState===_n.CONNECTED&&this.check(),this.userMap.size===0?this.tokenInterval=window.setTimeout(r,1e3):this.tokenInterval=window.setTimeout(r,3*F("P2P_TOKEN_INTERVAL"))};r()}async send(t,n,r,i,s){var o;if(this.userMap.size===0)return;const c=Array.from(ps(o=this.userMap).call(o))[0].token;typeof n!="string"&&(n=JSON.stringify(n)),i=i??ln(6,""),s=s??this._sequence++;const l={_id:i,_type:t,_seq:s,_message:n,token:"".concat(this.token,"_").concat(c)};F("SHOW_P2P_LOG")&&R.debug("send message",l,"noNeedResponse : ".concat(r)),this.splitMessage(JSON.stringify(l)).forEach((p=>{this.signal.request(st.DATA_STREAM,{payload:bd(this.encoder.encode(p))})}));const h=new Pe(((p,E)=>{const g=window.setTimeout((()=>{this.off("res-@".concat(i,"_ack"),v),this.off("res-@".concat(i),I),this.off(Wf.ABORT,O),R.debug("[external-signal] request timeout, type: ".concat(t,", requestId: ").concat(i)),this.userMap.size===0?E(new ce(U.INVALID_REMOTE_USER)):E(new ce(U.TIMEOUT))}),F("EXTERNAL_SIGNAL_REQUEST_TIMEOUT")),v=()=>{g&&window.clearTimeout(g),this.off(Wf.ABORT,O),r&&p()},O=()=>{g&&window.clearTimeout(g),this.off("res-@".concat(i,"_ack"),v),this.off("res-@".concat(i),I),E(new ce(U.EXTERNAL_SIGNAL_ABORT,"type: ".concat(t,", requestId: ").concat(i)))};this.once(Wf.ABORT,O),this.once("res-@".concat(i,"_ack"),v);const I=(M,x)=>{N=!0,g&&window.clearTimeout(g),this.off("res-@".concat(i,"_ack"),v),this.off(Wf.ABORT,O),M==="success"?p(x):E(new ce(U.P2P_MESSAGE_FAILED,"request ".concat(t," failed, requestId: ").concat(i)))};let N=!1;r||(this.once("res-@".concat(i),I),Dr(F("SIGNAL_REQUEST_TIMEOUT")).then((()=>{N||R.warning("external_signal request timeout, type: ".concat(t,", requestId: ").concat(i,", ").concat(l))})))}));try{return await h}catch(p){if(p.code===U.TIMEOUT)return await this.send(t,n,r,i,s);throw p}}onMessage(t){var n;const{_uid:r}=t;let i,s=this.userMap.get(r);if(s)i=s.splitMessageMap;else{if(this.userMap.size>0||!("_type"in t)||t._type!==Hn.CHECK)return;const{token:h}=t;i=new Map,s={uid:r,isStart:!0,token:h,splitMessageMap:i,nextExpectedSequenceNumber:0,receivedMessagesMap:new Map},this.userMap.set(r,s),this.signal.emit(Pt.ON_USER_ONLINE,{uid:r}),this.handleUserOnline()}if("id"in t&&"total"in t){var o;const{id:h,total:p}=t,E=(o=i.get(h))!==null&&o!==void 0?o:[];if(E.push(t),i.has(h)||i.set(h,E),E.length!==p)return;{const g=sh(E).call(E,((v,O)=>v.index-O.index)).map((v=>v.payload)).join("");i.delete(h),(t=JSON.parse(g))._uid=r}}const{_type:c,token:l}=t;if(Re(n=[Hn.ACK,Hn.CHECK]).call(n,c))return c===Hn.CHECK&&this.handleCheckToken(s,l),void this.receiveMessage(t);l==="".concat(s.token,"_").concat(this.token)?this.handleReceivedMessage(t):R.debug('Receive unexpected message", '.concat(l,", cur_token: ").concat(s.token,"_").concat(this.token),t)}check(){const t={_id:ln(6,""),token:this.token,_type:Hn.CHECK};F("SHOW_P2P_LOG")&&R.debug("send message",t),this.signal.request(st.DATA_STREAM,{payload:bd(this.encoder.encode(JSON.stringify(t)))})}ack(t){const n={_id:t,_type:Hn.ACK,token:this.token};F("SHOW_P2P_LOG")&&R.debug("send message",n),this.signal.request(st.DATA_STREAM,{payload:bd(this.encoder.encode(JSON.stringify(n)))})}response(t,n,r){this.send(Hn.RESPONSE,JSON.stringify({success:!r,message:n}),!0,t)}handleReceivedMessage(t){const n=()=>{this.userMap.forEach((h=>{const{receivedMessagesMap:p,nextExpectedSequenceNumber:E}=h;for(;p.has(E);){const g=p.get(E);p.delete(E),this.receiveMessage(g),h.nextExpectedSequenceNumber++}}))};if(!t)return void n();const{_uid:r,_seq:i}=t,s=this.userMap.get(r),{receivedMessagesMap:o,isStart:c,nextExpectedSequenceNumber:l}=s;if(i<l)return this.ack(t._id),void R.debug("[external-signal] receive old message, seq: ".concat(i,", ").concat(t._message));o.set(i,t),c&&i===l&&(this.receiveMessage(t),o.delete(l),s.nextExpectedSequenceNumber++,n())}receiveMessage(t){const{_id:n,_type:r,_message:i,_uid:s}=t;if(F("SHOW_P2P_LOG")&&R.debug("receive message",t),n){let o;switch(t._type!==Hn.ACK&&(i&&(o=JSON.parse(i)),this.ack(t._id)),t._type){case Hn.CANDIDATE:case Hn.CONTROL:this.signal.emit(r,o,s);break;case Hn.PUBLISH:case Hn.UNPUBLISH:case Hn.RESTART_ICE:case Hn.CALL:o.uid=s,Fr(this.signal,r,o).then((c=>{this.response(t._id,c)})).catch((()=>{this.response(t._id,void 0,!0)}));break;case Hn.ACK:this.getListeners("res-@".concat(n,"_ack")).length>0&&this.emit("res-@".concat(n,"_ack"));break;case Hn.RESPONSE:{const{success:c,message:l}=o;this.emit("res-@".concat(n),c?"success":"failed",l);break}}}}splitMessage(t){if(t.length<Mh.MAX_MESSAGE_SIZE)return[t];const n=[],{remoteToken:r}=JSON.parse(t),i=ln(6,"");let s=0,o=800;const c=Math.ceil(t.length/o);for(;t.length>0;){s++;const l={id:i,index:s,total:c,payload:t.slice(0,o),token:"".concat(this.token,"_").concat(r)};JSON.stringify(l).length>Mh.MAX_MESSAGE_SIZE?o-=50:(n.push(l),t=t.slice(o))}return n.map((l=>JSON.stringify(l)))}handleCheckToken(t,n){return t.token!==n?(R.debug("token changed, from ".concat(t.token," to ").concat(n)),this.reset(t.uid,n),!1):(this.tokenTimeout&&(window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0),this.tokenTimeout=window.setTimeout((()=>{R.debug("token timeout, ".concat(n)),this.reset(t.uid)}),F("MAX_P2P_TIMEOUT")),!0)}async handleUserOnline(){const t=await Fr(this.signal,Hn.CALL,void 0),n=await this.send(Hn.CALL,t);this.signal.emit(at.P2P_CONNECTION,n,!0)}async reset(t,n){const r=this.userMap.get(t);r&&(this.emit(Wf.ABORT),this.signal.emit(Pt.ON_USER_OFFLINE,{uid:r.uid,reason:s9.P2P_TOKEN_CHANGED}),this._sequence=0,this.userMap.clear(),n||(R.debug("change local token from ".concat(n," to ").concat(n)),this.token=ln(6,"")))}clear(){this._sequence=0,this.userMap.clear(),this.tokenInterval&&window.clearTimeout(this.tokenInterval),this.tokenInterval=void 0,this.tokenTimeout&&window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0,this.emit(Wf.ABORT)}}k(Mh,"MAX_SIZE",1),k(Mh,"MAX_MESSAGE_SIZE",1024);class Fq extends Pn{get connectionState(){return this._connectionState}set connectionState(t){t!==this._connectionState&&(this._connectionState=t,t===_n.CONNECTED?this.emit(at.WS_CONNECTED):t===_n.RECONNECTING?this.emit(at.WS_RECONNECTING,this._websocketReconnectReason):t===_n.CLOSED&&this.emit(at.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(t,n){super(),k(this,"_disconnectedReason",void 0),k(this,"_websocketReconnectReason",void 0),k(this,"_connectionState",_n.CLOSED),k(this,"reconnectToken",void 0),k(this,"p2pToken",void 0),k(this,"websocket",void 0),k(this,"openConnectionTime",void 0),k(this,"clientId",void 0),k(this,"lastMsgTime",Date.now()),k(this,"uploadCache",[]),k(this,"uploadCacheInterval",void 0),k(this,"rttRolling",new X1(5)),k(this,"pingpongTimer",void 0),k(this,"pingpongTimeoutCount",0),k(this,"joinResponse",void 0),k(this,"multiIpOption",void 0),k(this,"initError",void 0),k(this,"spec",void 0),k(this,"store",void 0),k(this,"_external_signal",void 0),k(this,"onWebsocketMessage",(r=>{if(r.data instanceof ArrayBuffer)return void this.emit(at.ON_BINARY_DATA,r.data);const i=JSON.parse(r.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(i,"_id")){const s="res-@".concat(i._id);this.emit(s,i._result,i._message)}else if(Object.prototype.hasOwnProperty.call(i,"_type")){switch(i._type){case Pt.ON_DATA_STREAM:return void this.handleDataStream(i._message);case Pt.MUTE_AUDIO:case Pt.MUTE_VIDEO:case Pt.ON_P2P_LOST:case Pt.ON_USER_ONLINE:return;case Pt.ON_USER_OFFLINE:const{uid:s}=i._message;return R.debug("[".concat(this.clientId,"] user-offline uid: ").concat(s)),void this._external_signal.reset(s)}if(this.emit(i._type,i._message),i._type===Pt.ON_NOTIFICATION&&this.handleNotification(i._message),i._type===Pt.ON_USER_BANNED)switch(i._message.error_code){case 14:this.close(Qt.UID_BANNED);break;case 15:this.close(Qt.IP_BANNED);break;case 16:this.close(Qt.CHANNEL_BANNED)}if(i._type===Pt.ON_USER_LICENSE_BANNED)switch(i._message.error_code){case Ze.ERR_LICENSE_MISSING:this.close(Qt.LICENSE_MISSING);break;case Ze.ERR_LICENSE_EXPIRED:this.close(Qt.LICENSE_EXPIRED);break;case Ze.ERR_LICENSE_MINUTES_EXCEEDED:this.close(Qt.LICENSE_MINUTES_EXCEEDED);break;case Ze.ERR_LICENSE_PERIOD_INVALID:this.close(Qt.LICENSE_PERIOD_INVALID);break;case Ze.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(Qt.LICENSE_MULTIPLE_SDK_SERVICE);break;case Ze.ERR_LICENSE_ILLEGAL:this.close(Qt.LICENSE_ILLEGAL);break;default:this.close()}}})),this.clientId=t.clientId,this.spec=t,this.store=n,this.websocket=new zb("gateway-".concat(this.clientId),this.spec.retryConfig,!0,F("JOIN_GATEWAY_USE_DUAL_DOMAIN"),F("JOIN_GATEWAY_USE_443PORT_ONLY"),n),this.handleWebsocketEvents(),window.addEventListener("offline",(()=>{this.connectionState===_n.CONNECTED&&this.reconnect("retry",jr.OFFLINE)})),this.p2pToken=ln(6,""),this._external_signal=new Mh(this,this.p2pToken)}async request(t,n,r,i){const s=ln(6,""),o={_id:s,_type:t,_message:n},c=this.websocket.connectionID,l=()=>new Pe(((O,I)=>{if(this.connectionState===_n.CONNECTED)return O();const N=()=>{this.off(at.WS_CLOSED,M),O()},M=()=>{this.off(at.WS_CONNECTED,N),I(new ce(U.WS_ABORT))};this.once(at.WS_CONNECTED,N),this.once(at.WS_CLOSED,M)}));if(this.connectionState!==_n.CONNECTING&&this.connectionState!==_n.RECONNECTING||t===st.JOIN||t===st.REJOIN||await l(),this.websocket.sendMessage(o,!0),i)return;const h=new Pe(((O,I)=>{let N=!1;const M=(B,Z)=>{N=!0,O({isSuccess:B==="success",message:Z||{}}),this.off(at.WS_CLOSED,x),this.off(at.WS_RECONNECTING,x),this.emit(at.REQUEST_SUCCESS,t,n)};this.once("res-@".concat(s),M);const x=()=>{I(new ce(U.WS_ABORT,"type: ".concat(t))),this.off(at.WS_CLOSED,x),this.off(at.WS_RECONNECTING,x),this.off("res-@".concat(s),M)};this.once(at.WS_CLOSED,x),this.once(at.WS_RECONNECTING,x),Dr(F("SIGNAL_REQUEST_TIMEOUT")).then((()=>{this.websocket.connectionID!==c||N||(R.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(t)),this.emit(at.REQUEST_TIMEOUT,t,n))}))}));let p=null;try{p=await h}catch(O){if(this.connectionState===_n.CLOSED||t===st.LEAVE)throw new ce(U.WS_ABORT);return!this.spec.forceWaitGatewayResponse||r?O.throw():t===st.JOIN||t===st.REJOIN?null:(await l(),await this.request(t,n))}if(p.isSuccess)return p.message;const E=Number(p.message.error_code||p.message.code),g=XE(E),v=new ce(U.UNEXPECTED_RESPONSE,"".concat(g.desc,": ").concat(p.message.error_str),{code:E,data:p.message,desc:g.desc});return g.action==="success"?p.message:(R.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(t,", error_code: ").concat(E,", message: ").concat(g.desc,", action: ").concat(g.action)),E===Ze.ERR_TOO_MANY_BROADCASTERS?((t===st.JOIN||t===st.REJOIN)&&(this.initError=v,this.close()),v.throw()):g.action==="failed"?v.throw():g.action==="quit"?(this.initError=v,this.close(),v.throw()):(E===Ze.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=p.message.option,R.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",jr.MULTI_IP)):this.reconnect(g.action,jr.SERVER_ERROR),t===st.JOIN||t===st.REJOIN?null:await this.request(t,n)))}waitMessage(t,n){return new Pe((r=>{const i=s=>{(!n||n(s))&&(this.off(t,i),r(s))};this.on(t,i)}))}uploadWRTCStats(t){if(!this.store.sessionId)return void R.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const n={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:t};this.upload(YE.WRTC_STATS,n)}upload(t,n){const r={_type:t,_message:n};try{this.websocket.sendMessage(r)}catch{const s=F("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(r),this.uploadCache.length>s&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval((()=>{if(this.connectionState!==_n.CONNECTED)return;const o=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(o._type,o._message)}),F("UPLOAD_CACHE_INTERVAL")||2e3))}}send(t,n){const r={_type:t,_message:n};this.websocket.sendMessage(r)}async sendExtensionMessage(t,n,r){return await this._external_signal.send(t,n,r)}init(t){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new Pe(((n,r)=>{this.once(at.WS_CONNECTED,(()=>n(this.joinResponse))),this.once(at.WS_CLOSED,(()=>r(this.initError||new ce(U.WS_ABORT)))),this.connectionState=_n.CONNECTING,this.websocket.init(t).catch(r)}))}close(t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._external_signal.clear(),this._disconnectedReason=t||Qt.LEAVE,this.connectionState=_n.CLOSED,R.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),this.p2pToken=ln(6,""),this._external_signal.clear(),this._external_signal=new Mh(this,this.p2pToken)}async join(){if(!this.joinResponse){this.emit(at.ABORT_P2P_EXECUTION);const t=await Fr(this,at.REQUEST_JOIN_INFO),n=await this.request(st.JOIN,t);if(!n)return this.emit(at.REPORT_JOIN_GATEWAY,U.TIMEOUT,this.url||""),!1;this.joinResponse=n,this.emit(at.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=_n.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}reconnect(t,n){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(t,n)}async downgradeCodec(t){return!1}handleDataStream(t){try{var n;const r=mh(t.payload),i=new TextDecoder().decode(r),s=JSON.parse(i);"total"in s&&"id"in s||Re(n=Object.values(Hn)).call(n,s._type)?(s._uid=t.uid,this._external_signal.onMessage(s)):this.emit(Pt.ON_DATA_STREAM,t)}catch{this.emit(Pt.ON_DATA_STREAM,t)}}handleNotification(t){R.debug("[".concat(this.clientId,"] receive notification: "),t);const n=XE(t.code);if(n.action!=="success"){if(n.action!=="failed")return n.action==="quit"?(n.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(Qt.UID_BANNED),void this.close()):void this.reconnect(n.action,jr.SERVER_ERROR);R.error("[".concat(this.clientId,"] ignore error: "),n.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const t=F("PING_PONG_TIME_OUT"),n=Date.now();this.pingpongTimeoutCount>=t&&(R.warning("[".concat(this.clientId,"] PINGPONG Timeout. Last Socket Message: ").concat(n-this.lastMsgTime,"ms")),n-this.lastMsgTime>F("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",jr.TIMEOUT):this.request(st.PING,void 0,!0).then((()=>{this.pingpongTimeoutCount=0;const r=Date.now()-n;this.rttRolling.add(r),F("REPORT_STATS")&&this.send(st.PING_BACK,{pingpongElapse:r})})).catch((r=>{}))}handleWebsocketEvents(){this.websocket.on(gt.RECONNECT_CREATE_CONNECTION,(t=>{this.emit(at.WS_RECONNECT_CREATE_CONNECTION,t)})),this.websocket.on(gt.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(gt.CLOSED,(()=>{this.connectionState=_n.CLOSED})),this.websocket.on(gt.FAILED,(()=>{this._disconnectedReason=Qt.NETWORK_ERROR,this.connectionState=_n.CLOSED})),this.websocket.on(gt.RECONNECTING,(t=>{this._websocketReconnectReason=t,this.joinResponse=void 0,this.connectionState===_n.CONNECTED?this.connectionState=_n.RECONNECTING:this.connectionState=_n.CONNECTING})),this.websocket.on(gt.WILL_RECONNECT,((t,n,r)=>{t!=="retry"?(R.debug("".concat(this.clientId," websocket will_connect event, renewSession reconnectMode is ").concat(t)),this.reconnectToken=void 0):R.debug("".concat(this.clientId," reconnect mode is retry, no need to renew session")),r(t)})),this.websocket.on(gt.CONNECTED,(()=>{this.openConnectionTime=Date.now(),this.join().catch((t=>{if(this.emit(at.REPORT_JOIN_GATEWAY,t,this.url||""),t instanceof ce&&t.code===U.UNEXPECTED_RESPONSE&&t.data.code===Ze.ERR_NO_AUTHORIZED)return R.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",jr.SERVER_ERROR);R.error("[".concat(this.clientId,"] join gateway request failed"),t.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",jr.SERVER_ERROR):(this.initError=t,this.close())}))})),this.websocket.on(gt.REQUEST_NEW_URLS,((t,n)=>{Fr(this,at.REQUEST_RECOVER,this.multiIpOption).then(t).catch(n)})),this.websocket.on(gt.ON_TOKEN_PRIVILEGE_DID_EXPIRE,(()=>{this.emit(Pt.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}))}}const Bq={name:"P2PChannel",create:function(e){let{store:t,statsCollector:n}=e;return new jq(t,n)},createSubmodule:function(e){let{store:t,spec:n}=e;return new Fq(n,t)}};function Sj(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable}))),n.push.apply(n,r)}return n}function Tj(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Sj(Object(n),!0).forEach((function(r){k(e,r,n[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Sj(Object(n)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))}))}return e}class Wq{constructor(t){k(this,"sessionDesc",void 0),k(this,"localCapabilities",void 0),k(this,"rtpCapabilities",void 0),k(this,"candidates",void 0),k(this,"_originCandidates",void 0),k(this,"iceParameters",void 0),k(this,"dtlsParameters",void 0),k(this,"setup",void 0),k(this,"currentMidIndex",void 0),k(this,"cname",void 0),t=An(t);const{iceParameters:n,dtlsParameters:r,candidates:i,rtpCapabilities:s,setup:o,localCapabilities:c,sdkCodec:l,cname:h}=t,p=Zi(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE audio video
a=msid-semantic: WMS
a=ice-lite
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:audio
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:video
`);this.rtpCapabilities=s,this.candidates=i,this._originCandidates=An(i),this.iceParameters=n,this.dtlsParameters=r,this.setup=o,this.localCapabilities=c,this.cname=h;for(let E=0;E<p.mediaDescriptions.length;E++){const g=p.mediaDescriptions[E];if(g.attributes.iceUfrag=n.iceUfrag,g.attributes.icePwd=n.icePwd,g.attributes.fingerprints=r.fingerprints,g.attributes.candidates=i,g.attributes.setup=o,g.media.mediaType==="video"){g.media.fmts=s.videoCodecs.map((I=>I.payloadType.toString(10)));const v=s.videoCodecs.filter((I=>{var N,M;return(N=I.rtpMap)===null||N===void 0?void 0:Re(M=N.encodingName.toLowerCase()).call(M,l)})),O=s.videoCodecs.filter((I=>!Re(v).call(v,I)));g.attributes.payloads=[...v,...O],g.attributes.extmaps=s.videoExtensions}g.media.mediaType==="audio"&&(g.media.fmts=s.audioCodecs.map((v=>v.payloadType.toString(10))),g.attributes.payloads=s.audioCodecs,g.attributes.extmaps=s.audioExtensions),p.mediaDescriptions[E]=this.mungMediaDesc(g)}this.sessionDesc=p,this.currentMidIndex=p.mediaDescriptions.length-1}toString(){return Id(this.sessionDesc)}send(t,n,r){const{ssrcs:i,ssrcGroups:s}=$E(n,this.cname),o=this.sessionDesc.mediaDescriptions.find((h=>t===Le.VIDEO?h.media.mediaType==="video":h.media.mediaType==="audio")),c=i[0].attributes.label,l=i[0].attributes.mslabel;return o.attributes.ssrcs=o.attributes.ssrcs.concat(i),o.attributes.ssrcGroups=o.attributes.ssrcGroups.concat(s),{id:c,mslabel:l}}batchSend(t){return t.map((n=>{let{kind:r,ssrcMsg:i}=n;return this.send(r,i,void 0)}))}stopSending(t){this.sessionDesc.mediaDescriptions.forEach((n=>{const r=[],i=[],s=[];n.attributes.ssrcs.forEach((o=>{Re(t).call(t,o.attributes.label||"")?s.push(o):r.push(o)})),n.attributes.ssrcGroups.forEach((o=>{var c;Re(c=s.map((l=>l.ssrcId))).call(c,o.ssrcIds[0])||i.push(o)})),n.attributes.ssrcs=r,n.attributes.ssrcGroups=i}))}mute(t){const n=this.sessionDesc.mediaDescriptions.find((r=>r.attributes.mid===t));if(!n)throw new Error("mediaDescription not found with ".concat(t," in remote SDP when calling RemoteSDP.mute."));n.attributes.direction="inactive"}unmute(t){const n=this.sessionDesc.mediaDescriptions.find((r=>r.attributes.mid===t));if(!n)throw new Error("mediaDescription not found with ".concat(t," in remote SDP when calling RemoteSDP.unmute."));n.attributes.direction="sendonly"}receive(t,n,r){t.forEach(((i,s)=>{const o=i._mediaStreamTrack,c=this.sessionDesc.mediaDescriptions.findIndex((h=>h.attributes.mid===o.kind)),l=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[c],i);this.sessionDesc.mediaDescriptions[c]=l}))}stopReceiving(t){}updateCandidates(t){const n=this._originCandidates.filter((i=>i.transport==="udp")),r=[];if(n.forEach((i=>{r.push(Tj(Tj({},i),{},{foundation:"tcpcandidate",priority:Number(i.priority)-1+"",transport:"tcp",port:Number(i.port)+90+""}))})),n.length!==0){switch(t){case Jr.TCP_RELAY:this.candidates=r;break;case Jr.UDP_TCP_RELAY:case Jr.RELAY:this.candidates=[...n,...r];break;default:this.candidates=n}for(const i of this.sessionDesc.mediaDescriptions)i.attributes.candidates=this.candidates}}restartICE(t){t=An(t),this.iceParameters=t,this.sessionDesc.mediaDescriptions.forEach((n=>{n.attributes.iceUfrag=t.iceUfrag,n.attributes.icePwd=t.icePwd}))}predictReceivingMids(t){const n=[];for(let r=0;r<t;r++)n.push((this.currentMidIndex+r+1).toString(10));return n}mungRecvMediaDsec(t,n){const r=An(t);return Kf(r,n),Jb(r,n),r}updateRecvMedia(t,n){const r=this.sessionDesc.mediaDescriptions.findIndex((i=>i.attributes.mid===t));if(r!==-1){const i=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[r],n);this.sessionDesc.mediaDescriptions[r]=i}}bumpMid(t){this.currentMidIndex+=t}updateTrackLabel(t,n,r){const i=this.sessionDesc.mediaDescriptions.find((o=>t===Le.VIDEO?o.attributes.mid==="video":o.attributes.mid==="audio"));if(i){const o=i.attributes.ssrcs.find((c=>c.attributes.label===n));var s;o&&(o.attributes.label=r,(s=o.attributes.msid)===null||s===void 0||s.replace(n,r))}}mungMediaDesc(t){const n=An(t);return Xb(n),(function(r){const i=r.attributes.extmaps.find((s=>aT(s.extensionName)));i&&r.attributes.extmaps.splice(r.attributes.extmaps.indexOf(i),1),r.attributes.payloads.forEach((s=>{const o=s.rtcpFeedbacks.findIndex((c=>c.type==="transport-cc"));o!==-1&&s.rtcpFeedbacks.splice(o,1)}))})(n),n}getSSRC(t){for(const n of this.sessionDesc.mediaDescriptions)for(const r of n.attributes.ssrcs)if(r.attributes.label===t)return[r]}}var dn;function Rj(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable}))),n.push.apply(n,r)}return n}function YT(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Rj(Object(n),!0).forEach((function(r){k(e,r,n[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Rj(Object(n)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))}))}return e}let Gq=(dn=class Pg extends MM{get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.videoCodecs.map((t=>t.rtpMap&&t.rtpMap.encodingName.toLowerCase()||"")).filter((t=>{var n;return Re(n=Object.keys(WE)).call(n,t)})))]}constructor(t,n){super(t,n),k(this,"store",void 0),k(this,"peerConnection",void 0),k(this,"remoteSDP",void 0),k(this,"initialOffer",void 0),k(this,"statsFilter",void 0),k(this,"useRTX",!1),k(this,"localCapabilities",void 0),k(this,"localCandidateCount",0),k(this,"allCandidatesReceived",!1),k(this,"establishPromise",void 0),k(this,"mutex",void 0),this.store=n,this.mutex=new Yr("P2PConnection-mutex",n.clientId),this.peerConnection=new RTCPeerConnection(Pg.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.statsFilter=ib(this.peerConnection,F("STATS_UPDATE_INTERVAL"),void 0,xn()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(){try{const t=await this.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});if(!t.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const n=kd(t.sdp),r=ZE(t.sdp,{filterRTX:!this.useRTX,filterVideoFec:F("FILTER_VIDEO_FEC"),filterAudioFec:F("FILTER_AUDIO_FEC"),filterAudioCodec:["opus"]});return this.localCapabilities=r,this.initialOffer=t,YT(YT({},n),{},{rtpCapabilities:{send:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},recv:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},sendrecv:r},offerSDP:t.sdp})}catch(t){throw new ce(U.GET_LOCAL_CONNECTION_PARAMS_FAILED,t.toString())}}async updateRemoteConnect(){}async connect(t){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new Wq(YT(YT({},t),{},{rtpCapabilities:t.rtpCapabilities.send,localCapabilities:this.localCapabilities,sdkCodec:this.store.codec}));const n=this.remoteSDP.toString();await this.peerConnection.setLocalDescription(this.initialOffer),await this.peerConnection.setRemoteDescription({type:"answer",sdp:n})}catch(n){throw new ce(U.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(n.toString()))}}async updateRemoteRTPCapabilities(t,n){throw new ce(U.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}getPreMedia(t){}send(t,n){var r=this;return eo((function*(){const i=yield jt(r.mutex.lock());try{if(!r.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const s=t.map((g=>r.peerConnection.addTrack(g._mediaStreamTrack))),o=yield jt(r.peerConnection.createOffer()),c=Zi(o.sdp),l=t.map((g=>{const v=g._mediaStreamTrack,O=c.mediaDescriptions.find((I=>I.attributes.mid===v.kind));if(!O)throw new Error("Cannot extract ssrc from mediaDescription.");return(function(I,N,M){const x=I.attributes.ssrcs.filter((Z=>Z.attributes.label===N)),B=I.attributes.ssrcGroups;if(x.length===0)throw new Error("Cannot extract ssrc from plan-b SDP.");if(B&&x.length>1){const Z=B.find((Q=>Q.ssrcIds.indexOf(x[0].ssrcId)!==-1));return Z?[{ssrcId:Z.ssrcIds[0],rtx:M?Z.ssrcIds[1]:void 0}]:[{ssrcId:x[0].ssrcId}]}return[{ssrcId:x[0].ssrcId}]})(O,v.id,r.useRTX)}));let h;try{h=yield l}catch(g){throw s.forEach((v=>{Vr()&&v.replaceTrack(null),r.peerConnection.removeTrack(v)})),g}const p=r.mungSendOfferSDP(o.sdp,t);r.remoteSDP.receive(t,n,h);const E=r.remoteSDP.toString();return yield jt(r.peerConnection.setLocalDescription({type:"offer",sdp:p})),yield jt(r.applySendEncodings(s,t)),yield jt(r.peerConnection.setRemoteDescription({type:"answer",sdp:E})),t.map(((g,v)=>{const O=g._mediaStreamTrack.id;return{localSSRC:l[v],id:O}}))}catch(s){throw new ce(U.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(s.toString()))}finally{i()}}))()}async stopSending(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const n=this.peerConnection.getSenders().filter((s=>{var o;return t.indexOf(((o=s.track)===null||o===void 0?void 0:o.id)||"")!==-1}));if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");n.map((s=>{Vr()&&s.replaceTrack(null),this.peerConnection.removeTrack(s)}));const r=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(r),this.remoteSDP.stopReceiving(t);const i=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:i})}catch(n){throw new ce(U.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(n.toString()))}}async receive(t,n,r,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));const{id:s,mslabel:o}=this.remoteSDP.send(t,n,i),c=new Pe(((p,E)=>{const g=setTimeout((()=>{E(new Error("Cannot receive track, id: ".concat(s)))}),1e4),v=O=>{const I=xt();if((I.name==="Safari"&&Number(I.version)===11||ni())&&O.track.id!==s&&O.streams[0].id===o){var N;const M=O.streams[0].getTracks()[0];return(N=this.remoteSDP)===null||N===void 0||N.updateTrackLabel(t,s,O.track.id),this.peerConnection.removeEventListener("track",v),clearTimeout(g),void p(M)}if(O.track.id===s)return this.peerConnection.removeEventListener("track",v),clearTimeout(g),void p(O.track)};this.peerConnection.addEventListener("track",v)})),l=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:l});const h=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(h),{track:await c,id:s}}catch(s){throw new ce(U.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(s.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(t);const n=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const r=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(r)}catch(n){throw new ce(U.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n.toString()))}}async muteRemote(t){}async unmuteRemote(t){}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const n=this.peerConnection.getSenders().filter((r=>{var i;return t.indexOf(((i=r.track)===null||i===void 0?void 0:i.id)||"")!==-1}));if(n.length!==t.length)throw new Error("sender' length doesn't match mids' length.");n.map((r=>{if(Vr()&&r.track)r.track.enabled=!1;else{const i=r.getParameters();i.encodings.forEach((s=>s.active=!1)),r.setParameters(i)}}))}catch(n){throw new ce(U.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(n.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const n=this.peerConnection.getSenders().filter((s=>{var o;return t.indexOf(((o=s.track)===null||o===void 0?void 0:o.id)||"")!==-1}));if(n.length!==t.length)throw new Error("Senders' length doesn't match mids' length.");n.map((async s=>{if(Vr()&&s.track)s.track.enabled=!0;else{const o=s.getParameters();o.encodings.forEach((c=>c.active=!0)),await s.setParameters(o)}}));const r=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(r);const i=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:i})}catch(n){throw new ce(U.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(n.toString()))}}restartICE(t){var n=this;return eo((function*(){const r=yield jt(n.mutex.lock("From P2PConnection.restartICE"));try{if(!n.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const i=Ft().supportPCSetConfiguration;if(t===Jr.RELAY&&!i)return;if(i){const h=n.peerConnection.getConfiguration(),p=t===Jr.RELAY?"relay":"all";h.iceTransportPolicy!==p&&(R.debug("[".concat(n.store.clientId,"] restartICE change iceTransportPolicy from [").concat(h.iceTransportPolicy,"] to [").concat(p,"]")),h.iceTransportPolicy=p,n.peerConnection.setConfiguration(h))}t!==Jr.RELAY&&n.remoteSDP.updateCandidates(t);const s=yield jt(n.peerConnection.createOffer({iceRestart:!0}));if(!s.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const o=kd(s.sdp),{remoteIceParameters:c}=yield o.iceParameters;n.remoteSDP.restartICE(c);const l=n.remoteSDP.toString();yield jt(n.peerConnection.setLocalDescription(s)),yield jt(n.peerConnection.setRemoteDescription({type:"answer",sdp:l}))}catch(i){R.warning("[".concat(n.store.clientId,"] restart ICE failed, abort operation"),i)}finally{r()}}))()}close(){var t;this.peerConnection.close(),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const r=await this.peerConnection.createOffer(),i=this.mungSendOfferSDP(r.sdp,[n]);this.remoteSDP.updateRecvMedia(n._mediaStreamTrack.kind,n);const s=this.remoteSDP.toString();await this.peerConnection.setLocalDescription({type:"offer",sdp:i}),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(r){throw new ce(U.EXCHANGE_SDP_FAILED,r.toString())}}async updateSendParameters(t,n){const r=this.peerConnection.getSenders().filter((i=>{var s;return((s=i.track)===null||s===void 0?void 0:s.id)===t}));r.length===1&&await this.applySendEncodings(r,[n])}setStatsRemoteVideoIsReady(t,n){this.statsFilter.setVideoIsReady2(t,n)}async replaceTrack(t,n){const r=this.peerConnection.getSenders().find((i=>{var s;return((s=i.track)===null||s===void 0?void 0:s.id)===n}));r&&await r.replaceTrack(t._mediaStreamTrack)}createDataChannels(t,n){throw new ce(U.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}stopDataChannels(t){throw new ce(U.NOT_SUPPORTED,"Planb mode does not support stopDataChannels.")}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t;(t=this.onICEConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=t=>{t.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,R.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout((()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,R.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))}),F("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){const n={iceServers:[],sdpSemantics:"plan-b"};return t.iceServers?n.iceServers=t.iceServers:t.turnServer&&t.turnServer.mode!=="off"&&(UE(t.turnServer.servers)?n.iceServers=t.turnServer.servers:(n.iceServers&&n.iceServers.push(...Pg.turnServerConfigToIceServers(t.turnServer.servers)),F("USE_TURN_SERVER_OF_GATEWAY")&&n.iceServers&&t.turnServer.serversFromGateway&&n.iceServers.push(...Pg.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach((r=>{r.forceturn&&(n.iceTransportPolicy="relay")})))),n}static turnServerConfigToIceServers(t){const n=[];return t.forEach((r=>{r.security?r.tcpport&&n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turns:".concat(r.turnServerURL,":").concat(r.tcpport,"?transport=tcp")}):(r.udpport&&n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":").concat(r.udpport,"?transport=udp")}),r.tcpport&&n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":").concat(r.tcpport,"?transport=tcp")}))})),n}async updateRtpSenderEncodings(t,n){var r;if(n||(n=this.peerConnection.getSenders().find((h=>{var p;return((p=h.track)===null||p===void 0?void 0:p.id)===t._mediaStreamTrack.id}))),!n)return R.warn("[".concat(t.getTrackId(),"] no rtpSender found}"));if(!Ft().supportSetRtpSenderParameters)return R.warn("Browser not support set rtp-sender parameters");const i={},s={};if(t instanceof vn)switch(t._optimizationMode){case"motion":i.degradationPreference="maintain-framerate";break;case"detail":i.degradationPreference="maintain-resolution";break;default:i.degradationPreference="balanced"}if(F("DSCP_TYPE")&&ml()){var o;const h=F("DSCP_TYPE");Re(o=["very-low","low","medium","high"]).call(o,h)&&(s.networkPriority=h)}const c=n.getParameters(),l=(r=c.encodings)===null||r===void 0?void 0:r[0];l&&Object.assign(l,s),Object.assign(c,i),R.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(c.encodings))),await n.setParameters(c)}async applySendEncodings(t,n){try{if(!Ft().supportSetRtpSenderParameters||t.length!==n.length)return;for(let r=0;r<t.length;r++){const i=t[r],s=n[r];i&&s&&await this.updateRtpSenderEncodings(s,i)}}catch{R.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(t,n){const r=Zi(t);return n.forEach(((i,s)=>{const o=i._mediaStreamTrack,c=r.mediaDescriptions.find((l=>l.attributes.mid===o.kind));c&&Kf(c,i)})),Id(r)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var n;(n=this.onFirstAudioReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var n;(n=this.onFirstVideoReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var n;(n=this.onFirstAudioDecoded)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,n,r)=>{var i;(i=this.onFirstVideoDecoded)===null||i===void 0||i.call(this,t,n,r)},this.statsFilter.onSelectedLocalCandidateChanged=(t,n)=>{var r;(r=this.onSelectedLocalCandidateChanged)===null||r===void 0||r.call(this,t,n)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,n)=>{var r;(r=this.onSelectedRemoteCandidateChanged)===null||r===void 0||r.call(this,t,n)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0}async batchReceive(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const n=this.remoteSDP.batchSend(t).map(((s,o)=>{let{id:c,mslabel:l}=s;const{kind:h}=t[o];return new Pe(((p,E)=>{const g=setTimeout((()=>{E(new Error("Cannot receive track, id: ".concat(c)))}),1e4),v=O=>{const I=xt();if(I.name==="Safari"&&Number(I.version)===11&&O.track.id!==c&&O.streams[0].id===l){var N;const M=O.streams[0].getTracks()[0];return(N=this.remoteSDP)===null||N===void 0||N.updateTrackLabel(h,c,O.track.id),this.peerConnection.removeEventListener("track",v),clearTimeout(g),void p({track:M,id:c})}if(O.track.id===c)return this.peerConnection.removeEventListener("track",v),clearTimeout(g),void p({track:O.track,id:c})};this.peerConnection.addEventListener("track",v)}))})),r=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:r});const i=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(i),await Pe.all(n)}catch(n){throw new ce(U.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(n.toString()))}}async getRemoteSSRC(t){if(!this.remoteSDP)return;const n=this.remoteSDP.getSSRC(t);return n?.[0].ssrcId}setConfiguration(t){if(Ft().supportPCSetConfiguration){const n=Pg.resolvePCConfiguration(t);this.peerConnection.setConfiguration(n)}}},Be(dn.prototype,"connect",[lo],Object.getOwnPropertyDescriptor(dn.prototype,"connect"),dn.prototype),Be(dn.prototype,"stopSending",[lo],Object.getOwnPropertyDescriptor(dn.prototype,"stopSending"),dn.prototype),Be(dn.prototype,"receive",[lo],Object.getOwnPropertyDescriptor(dn.prototype,"receive"),dn.prototype),Be(dn.prototype,"stopReceiving",[lo],Object.getOwnPropertyDescriptor(dn.prototype,"stopReceiving"),dn.prototype),Be(dn.prototype,"muteRemote",[lo],Object.getOwnPropertyDescriptor(dn.prototype,"muteRemote"),dn.prototype),Be(dn.prototype,"unmuteRemote",[lo],Object.getOwnPropertyDescriptor(dn.prototype,"unmuteRemote"),dn.prototype),Be(dn.prototype,"muteLocal",[lo],Object.getOwnPropertyDescriptor(dn.prototype,"muteLocal"),dn.prototype),Be(dn.prototype,"unmuteLocal",[lo],Object.getOwnPropertyDescriptor(dn.prototype,"unmuteLocal"),dn.prototype),Be(dn.prototype,"close",[lo],Object.getOwnPropertyDescriptor(dn.prototype,"close"),dn.prototype),Be(dn.prototype,"updateEncoderConfig",[lo],Object.getOwnPropertyDescriptor(dn.prototype,"updateEncoderConfig"),dn.prototype),Be(dn.prototype,"updateSendParameters",[lo],Object.getOwnPropertyDescriptor(dn.prototype,"updateSendParameters"),dn.prototype),Be(dn.prototype,"replaceTrack",[lo],Object.getOwnPropertyDescriptor(dn.prototype,"replaceTrack"),dn.prototype),Be(dn.prototype,"getRemoteSSRC",[lo],Object.getOwnPropertyDescriptor(dn.prototype,"getRemoteSSRC"),dn.prototype),dn);function lo(e,t,n){const r=e[t];if(typeof r!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const i=this.mutex,s=await i.lock("Locking from P2PConnection.".concat(t));try{for(var o=arguments.length,c=new Array(o),l=0;l<o;l++)c[l]=arguments[l];return await r.apply(this,c)}finally{s()}},n}const Hq={name:"PlanBConnection",create:function(e){let{store:t,spec:n}=e;return new Gq(n,t)}},Kq={interceptLocalAudioFrame:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!Ft().supportWebRTCEncodedTransform)return void R.warning("browser not support audio encoded transform");if(HS.has(e)||!e.track)return;const n={track:e.track};if(fl()){if(!e.createEncodedStreams)return void R.warning("browser not support createEncodedStreams() API");let i=null;try{i=e.createEncodedStreams()}catch(o){return void R.error("create audio-encoded-streams error",o&&o.message)}const s=new TransformStream({transform(o,c){n.controller||(n.controller=c),e.track&&e.track.id!==n.track.id&&(R.debug("audio track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",r),n.track=e.track,n.track.addEventListener("ended",r));const l=t.metadata&&t.metadata();l?(function(h,p){const{chunk:E,controller:g}=p,v=Ad.METADATA;E.data=(function(O,I,N){const M=N.byteLength,x=M+Nb+vM,B=Ib+Ab+x,Z=new ArrayBuffer(O.byteLength+B),Q=new DataView(Z);Q.setUint8(0,gM),Q.setUint16(1,x),Q.setUint8(3,I),Q.setUint16(4,M);for(let te=0;te<M;te++)Q.setUint8(6+te,N[te]);const z=new Uint8Array(Q.buffer);return z.set(new Uint8Array(O),B),z.buffer})(E.data,v,h),g.enqueue(E)})(l,{chunk:o,controller:c}):c.enqueue(o)}});i.readable.pipeThrough(s).pipeTo(i.writable)}else if(Vr()){if(typeof RTCRtpScriptTransform>"u")return void R.warning("browser not support RTCRtpScriptTransform");const i=GS(),s=new MessageChannel;await new Pe((c=>i.onmessage=l=>{l.data==="registered"&&c(void 0)}));const o=new RTCRtpScriptTransform(i,{name:"audio-metadata-tx",port:s.port2},[s.port2]);e.transform=o,await new Pe((c=>i.onmessage=l=>{l.data==="started"&&c(void 0)})),s.port1.onmessage=c=>{var l;if(c.data.transformed&&e.track&&((l=e.track)===null||l===void 0?void 0:l.id)!==n.track.id)R.debug("audio track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",r),n.track=e.track,n.track.addEventListener("ended",r);else if(c.data.getMetadata){const h=t.metadata&&t.metadata();h&&s.port1.postMessage({metadata:h})}},n.worker=i}function r(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",r)}const i=HS.get(e);if(i){HS.delete(e);try{var s,o;(s=i.controller)===null||s===void 0||s.terminate(),(o=i.worker)===null||o===void 0||o.terminate()}catch(c){R.warning(c&&c.message)}}}HS.set(e,n),e.track.addEventListener("ended",r)},interceptRemoteAudioFrame:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!Ft().supportWebRTCEncodedTransform)return void R.warning("browser not support audio encoded transform");if(JS.has(e))return;const n={track:e.track,onMetadata:t.onMetadata,onPts:t.onPts};if(fl()&&!ni()){if(!e.createEncodedStreams)return void R.warning("browser not support createEncodedStreams() API");V0(Gt.CHROME,87,116)||(t.enableTopn=!1);let i=null;try{i=e.createEncodedStreams()}catch(o){return void R.error("create audio-encoded-streams error",o&&o.message)}const s=new TransformStream({transform(o,c){n.controller||(n.controller=c),e.track&&e.track.id!==n.track.id&&(R.debug("audio track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",r),n.track=e.track,n.track.addEventListener("ended",r)),t.enableTopn?(function(l,h,p){var E;const g=Ob(new DataView(h.data));if(!g)return p.enqueue(h);const v=l.track.id;bY.set(v,l.track);const O=(E=g.tlv.find((Z=>Z.tag===Ad.AUDIO_LEVEL)))===null||E===void 0?void 0:E.value;let I=0;typeof O=="number"&&(I=127-O);const N=Math.round(Math.pow(10,I/60)-1),{selected:M,speaker:x}=(function(Z,Q){let z=Vf.get(Z);if(z||(z=(function(te){const de=new SM;return Vf.set(te,de),Ca||(Ca=new CY(F("TOPN_SILENCE_THRESHOLD")||500),Ca.on("ActiveSpeakerChanged",(me=>{me!=null&&(YS=me)}))),Ca.addSpeakers([de]),de})(Z)),Vf.size<=TM)return{selected:!0,speaker:z};if(!Ca)throw new Error("no active speaker detector");return Ca.levelChanged(z.id,Q),Th=Ca.loudest.map((te=>te.id)),YS&&!Re(Th).call(Th,YS)&&Th.length>=TM&&Th.pop(),{selected:Re(Th).call(Th,z.id)||z.id===YS,speaker:z}})(l,N),B=(function(Z,Q,z){const te=wa.get(Z)||new wY(Z,Q);return te.score=z,wa.set(Z,te),(function(de){if(qS.set(de,!0),!XS)return void(XS=Date.now());const me=Date.now();me-XS>1e3&&(qS.get(de)?qS.set(de,!1):(RM(de),qS.delete(de)),XS=me)})(Z),te})(v,l.track,x.energyScore);B.addSample(M),B.active&&(h.data=g.frame.buffer,p.enqueue(h))})(e,o,c):t.enableMetadata||t.enablePts?(function(l,h,p,E){const g=new DataView(l.data),v=g.getUint8(0);let O;if((128&v)!=0&&v!==71){const M=(function(x){if(x.byteLength<=0)return[];const B=[];let Z=0;for(;Z<x.byteLength;){const z=(128&x.getUint8(Z))>>7,te=127&x.getUint8(Z);if(!(z&&Z+4<=x.byteLength)){Z++;break}{const de=x.getUint32(Z,!1),me=(16776192&de)>>10,ve=1023&de;B.push({pt:te,ts_offset:me,length:ve,data:new Uint8Array}),Z+=4}}let Q=x.byteLength-Z;for(const z of B){if(z.length>Q)return console.warn("Broken red payload"),[];z.length>0&&(z.data=new Uint8Array(x.buffer,x.byteOffset+Z,z.length),Z+=z.length,Q-=z.length)}if(Q>0){const z={pt:B.length>0?B[B.length-1].pt:0,ts_offset:0,length:Q,data:new Uint8Array(x.buffer,x.byteOffset+Z,Q)};B.push(z)}return B})(g);if(M.length>0){const x=(function(B){let Z=0;for(let te=0;te<B.length;te++)Z+=te<B.length-1?4:1,Z+=B[te].length;const Q=new Uint8Array(Z);let z=0;for(let te=0;te<B.length;te++)if(te<B.length-1){const de=(2147483648|(127&B[te].pt)<<24|(262143&B[te].ts_offset)<<10|1023&B[te].length)>>>0;Q[z++]=de>>24&255,Q[z++]=de>>16&255,Q[z++]=de>>8&255,Q[z++]=255&de}else Q[z++]=127&B[te].pt;for(const te of B)Q.set(te.data,z),z+=te.length;return Q})(M.map((B=>{const Z=new Uint8Array(B.length);Z.set(B.data);const Q=Ob(new DataView(Z.buffer));return Q!=null&&Q.frame&&(B.data=Q?.frame),O=Q,B})));l.data=x.buffer}}else O=Ob(g),O&&(l.data=O.frame.buffer);if(h.enqueue(l),!O)return;const I=O.tlv.find((M=>M.tag===Ad.METADATA));I&&p&&I.value instanceof Uint8Array&&p(I.value);const N=O.tlv.find((M=>M.tag===Ad.AUDIO_64_BIT_PTS));N&&E&&N.value instanceof Uint8Array&&N.value.length==8&&E(new DataView(N.value.buffer).getBigUint64(0,!0))})(o,c,t.onMetadata,t.onPts):c.enqueue(o)}});i.readable.pipeThrough(s).pipeTo(i.writable)}else{if(typeof RTCRtpScriptTransform>"u")return void R.warning("browser not support RTCRtpScriptTransform");const i=GS(),s=new MessageChannel;await new Pe((c=>i.onmessage=l=>{l.data==="registered"&&c(void 0)}));const o=new RTCRtpScriptTransform(i,{name:"audio-metadata-rx",port:s.port2},[s.port2]);e.transform=o,await new Pe((c=>i.onmessage=l=>{l.data==="started"&&c(void 0)})),s.port1.onmessage=c=>{var l;c.data.transformed&&e.track&&((l=e.track)===null||l===void 0?void 0:l.id)!==n.track.id?(R.debug("audio track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",r),n.track=e.track,n.track.addEventListener("ended",r)):c.data.metadata&&n.onMetadata?n.onMetadata(c.data.metadata):c.data.pts&&n.onPts&&n.onPts(c.data.pts)},n.worker=i}function r(){e.track.removeEventListener("ended",r),(function(i){const s=JS.get(i);if(s){(function(l){const h=Vf.get(l);h&&(Vf.delete(l),Ca&&(Ca.removeSpeakers([h]),Vf.size===0&&(Ca.destroy(),Ca=null)))})(i),RM(i.track.id),JS.delete(i);try{var o,c;(o=s.controller)===null||o===void 0||o.terminate(),(c=s.worker)===null||c===void 0||c.terminate()}catch(l){R.warning(l&&l.message)}}})(e)}JS.set(e,n),e.track.addEventListener("ended",r)},interceptLocalVideoFrame:async function(e,t){if(!Ft().supportWebRTCEncodedTransform)return void R.warning("browser not support video encoded transform");if(QS.has(e)||!e.track)return;const n={track:e.track};if(fl()){if(!e.createEncodedStreams)return void R.warning("browser not support createEncodedStreams() API");let i=null;try{i=e.createEncodedStreams()}catch(c){return void R.error("create video-encoded-streams error",c&&c.message)}const s=[];t.on("sei-to-send",(c=>{s.push(c)}));const o=new TransformStream({transform(c,l){n.controller||(n.controller=l),e.track&&e.track.id!==n.track.id&&(R.debug("video track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",r),n.track=e.track,n.track.addEventListener("ended",r));const h=bM(new Uint8Array(c.data)),p=s.shift();if(p){const E=(function(g,v,O){switch(O){case Lb:return(function(I,N){const M=wM(N),x=M.length,B=Math.floor(x/255),Z=x%255,Q=new Uint8Array(6+B+1+x+I.byteLength);Q[0]=0,Q[1]=0,Q[2]=0,Q[3]=1,Q[4]=6,Q[5]=101;let z=0;for(;z<B;)Q[6+z]=255,z++;return Q[6+z]=Z,z++,Q.set(M,6+z),Q.set(new Uint8Array(I),6+z+x),Q.buffer})(g,v);case xb:return(function(I,N){const M=wM(N),x=M.length,B=Math.floor(x/255),Z=x%255,Q=new Uint8Array(7+B+1+x+1+I.byteLength);Q[0]=0,Q[1]=0,Q[2]=0,Q[3]=1,Q[4]=78,Q[5]=1,Q[6]=101;let z=0;for(;z<B;)Q[7+z]=255,z++;return Q[7+z]=Z,z++,Q.set(M,7+z),z+=x,Q[7+z]=128,z++,Q.set(new Uint8Array(I),7+z),Q.buffer})(g,v);default:return null}})(c.data,p,h);E&&(c.data=E)}l.enqueue(c)}});i.readable.pipeThrough(o).pipeTo(i.writable)}else{if(!Vr())return;{if(typeof RTCRtpScriptTransform>"u")return void R.warning("browser not support RTCRtpScriptTransform");const i=GS(),s=new MessageChannel;await new Pe((c=>i.onmessage=l=>{l.data==="registered"&&c(void 0)}));const o=new RTCRtpScriptTransform(i,{name:"sei-tx",port:s.port2},[s.port2]);e.transform=o,await new Pe((c=>i.onmessage=l=>{l.data==="started"&&c(void 0)})),t.on("sei-to-send",(c=>{s.port1.postMessage({sei:c})})),s.port1.onmessage=c=>{var l;c.data.transformed&&e.track&&((l=e.track)===null||l===void 0?void 0:l.id)!==n.track.id&&(R.debug("video track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",r),n.track=e.track,n.track.addEventListener("ended",r))},n.worker=i}}function r(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",r)}const i=QS.get(e);if(i){QS.delete(e);try{var s,o;(s=i.controller)===null||s===void 0||s.terminate(),(o=i.worker)===null||o===void 0||o.terminate()}catch(c){R.warning(c&&c.message)}}}QS.set(e,n),e.track.addEventListener("ended",r)},interceptRemoteVideoFrame:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!Ft().supportWebRTCEncodedTransform)return void R.warning("browser not support video encoded transform");if(!e.track)return;if(zE.has(e)){const i=zE.get(e);return void(i&&(i.onSei=t.onSei))}const n={track:e.track,onSei:t.onSei};if(fl()){if(!e.createEncodedStreams)return void R.warning("browser not support createEncodedStreams() API");let i=null;try{i=e.createEncodedStreams()}catch(o){return void R.error("create video-encoded-streams error",o&&o.message)}const s=new TransformStream({transform(o,c){n.controller||(n.controller=c),e.track&&e.track.id!==n.track.id&&(R.debug("video track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",r),n.track=e.track,n.track.addEventListener("ended",r));const l=(function(h,p){switch(p){case Lb:return(function(E){const g=new DataView(E.data);let v=0;for(;v+4<E.data.byteLength;){if(g.getUint8(v+0)===0&&g.getUint8(v+1)===0&&g.getUint8(v+2)===0&&g.getUint8(v+3)===1&&g.getUint8(v+4)===6){let O=v+6,I=0,N=0;for(;(N=g.getUint8(O++))===255;)I+=255;I+=N;const M=CM(E.data,O,I);return new Uint8Array(M)}v++}return null})(h);case xb:return(function(E){const g=new DataView(E.data);let v=0;for(;v+5<E.data.byteLength;){if(g.getUint8(v+0)===0&&g.getUint8(v+1)===0&&g.getUint8(v+2)===0&&g.getUint8(v+3)===1&&g.getUint8(v+4)===78&&g.getUint8(v+5)===1&&g.getUint8(v+6)===101){let O=v+7,I=0,N=0;for(;(N=g.getUint8(O++))===255;)I+=255;I+=N;const M=CM(E.data,O,I);return new Uint8Array(M)}v++}return null})(h);default:return null}})(o,bM(new Uint8Array(o.data)));l&&n.onSei&&n.onSei(l),c.enqueue(o)}});i.readable.pipeThrough(s).pipeTo(i.writable)}else if(Vr()){if(typeof RTCRtpScriptTransform>"u")return void R.warning("browser not support RTCRtpScriptTransform");const i=GS(),s=new MessageChannel;await new Pe((c=>i.onmessage=l=>{l.data==="registered"&&c(void 0)}));const o=new RTCRtpScriptTransform(i,{name:"sei-rx",port:s.port2},[s.port2]);e.transform=o,await new Pe((c=>i.onmessage=l=>{l.data==="started"&&c(void 0)})),s.port1.onmessage=c=>{var l;c.data.transformed&&e.track&&((l=e.track)===null||l===void 0?void 0:l.id)!==n.track.id?(R.debug("video track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",r),n.track=e.track,n.track.addEventListener("ended",r)):c.data.sei&&n.onSei&&n.onSei(c.data.sei)},n.worker=i}function r(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",r)}(function(i){const s=zE.get(i);if(s){zE.delete(i);try{var o,c;(o=s.controller)===null||o===void 0||o.terminate(),(c=s.worker)===null||c===void 0||c.terminate()}catch(l){R.warning(l&&l.message)}}})(e)}zE.set(e,n),e.track.addEventListener("ended",r)}},zq={name:"InterceptFrame",create:()=>Kq};sb(),nn("PROCESS_ID","process-".concat(ln(8,""),"-").concat(ln(4,""),"-").concat(ln(4,""),"-").concat(ln(4,""),"-").concat(ln(12,""))),(function(){let e;try{e=window.localStorage.getItem("websdk_ng_global_parameter")}catch(t){return void R.error("Error loading sdk config",t.message)}if(e)try{const t=JSON.parse(window.atob(e)),n=Date.now();R.debug("Loading global parameters from cache",t),Object.keys(t).forEach((r=>{if(Object.prototype.hasOwnProperty.call(wn,r)){const{value:i,expires:s}=t[r];if(s&&s<=n)return;Ra[r]=i,wn[r]=i}}))}catch(t){R.error("Error loading mutableParamsCache: ".concat(e),t.message)}})(),Array.isArray(Ra.AREAS)&&Ra.AREAS.length>0&&eI(Ra.AREAS,!0);const Cj=(e,t,n)=>{R.debug("setParameter key:".concat(e,", value:").concat(JSON.stringify(t))),nn(e,t,n)};Md(mq,!1),Md(gq,!1),Md(Q9,!1),Md(Nq,!1),Md(hq,!1),Md(Bq,!1),Md(Hq,!1),Md(zq,!1);const ir=(function(e){const t=new Pn,n=e,r={getListeners:t.getListeners.bind(t),on:(i,s)=>((function(o,c){o===bc.SECURITY_POLICY_VIOLATION&&iV(c,!0)})(i,s),t.on.bind(t)(i,s)),addListener:t.addListener.bind(t),once:t.once.bind(t),off:t.off.bind(t),removeAllListeners:t.removeAllListeners.bind(t),emit:t.emit.bind(t),safeEmit:t.safeEmit.bind(t)};return rV(rV({},n),r)})({__TRACK_LIST__:Nf,VERSION:to,BUILD:cb,ESM_BUNDLER:!1,ESM:!1,UMD:!0,DEV:!1,setParameter:Cj,getParameter:F,getSupportedCodec:async function(){let e={audio:[],video:[]};try{let t=new RTCPeerConnection;const n=await(async function(r){let i;return Ft().supportUnifiedPlan?(r.addTransceiver("video",{direction:"recvonly"}),r.addTransceiver("audio",{direction:"recvonly"}),i=(await r.createOffer()).sdp):i=(await r.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0})).sdp,i})(t);if(!n)return e;t.close(),t=null,e=(function(r){const i={video:[],audio:[]};return r.match(/ VP8/i)&&i.video.push("VP8"),r.match(/ VP9/i)&&i.video.push("VP9"),r.match(/ AV1/i)&&i.video.push("AV1"),r.match(/ H264/i)&&i.video.push("H264"),r.match(/ H265/i)&&i.video.push("H265"),r.match(/ opus/i)&&i.audio.push("OPUS"),r.match(/ PCMU/i)&&i.audio.push("PCMU"),r.match(/ PCMA/i)&&i.audio.push("PCMA"),r.match(/ G722/i)&&i.audio.push("G722"),i})(n)}catch(t){throw new se(U.CREATE_OFFER_FAILED,t.toString&&t.toString()).print()}return e},checkSystemRequirements:function(){const e=We.reportApiInvoke(null,{name:Bn.CHECK_SYSTEM_REQUIREMENTS,options:[],tag:In.TRACER});let t=!1;try{const s=window.RTCPeerConnection,o=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,c=window.WebSocket;t=!!(s&&o&&c),t&&H0()&&C1(75)&&new s().close()}catch(s){return R.error("check system requirement failed: ",s),!1}let n=!1;const r=xt();r.name===Gt.CHROME&&Number(r.version)>=58&&(ya.engine.name!=="WebKit"||(function(){const s=xt();if(bS()){if(s.os===Er.MAC_OS)return!0;if(s.os===Er.IOS){const o=ya.os.version&&ya.os.version.split(".");if(o&&Number(o[0])===14&&o[1]&&Number(o[1])>=3||o&&Number(o[0])>14)return!0}}return!1})())&&(n=!0),(r.name===Gt.FIREFOX&&Number(r.version)>=56||r.name===Gt.OPERA&&Number(r.version)>=45||r.name===Gt.SAFARI&&Number(r.version)>=11||r.name==="WebKit"&&(ni()||Vo())&&r.osVersion&&Number(r.osVersion.split(".")[0])>=11||O1()||xt().name===Gt.QQ)&&(n=!0),R.debug("checkSystemRequirements, api:",t,"browser",n);const i=t&&n;return e.onSuccess(i),i},getDevices:function(e){return ks.enumerateDevices(!0,!0,e)},getMicrophones:function(e){return ks.getRecordingDevices(e)},getCameras:function(e){return ks.getCamerasDevices(e)},getElectronScreenSources:CL,getPlaybackDevices:function(e){return ks.getSpeakers(e)},createClient:function(){var e;let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{codec:"vp8",audioCodec:"opus",mode:"rtc"};const n=ln(5,"client-"),r=We.reportApiInvoke(null,{id:n,name:Bn.CREATE_CLIENT,options:[t],tag:In.TRACER});try{(function(i){hr(i.codec,"config.codec",["vp8","vp9","av1","h264","h265"]),hr(i.mode,"config.mode",["rtc","live","p2p"]),i.audioCodec!==void 0&&hr(i.audioCodec,"config.audioCodec",["opus","pcmu","pcma","g722"]),i.proxyServer!==void 0&&Pr(i.proxyServer,"config.proxyServer",1,1e4),i.turnServer!==void 0&&V1(i.turnServer),i.httpRetryConfig!==void 0&&U1(i.httpRetryConfig),i.websocketRetryConfig!==void 0&&U1(i.websocketRetryConfig)})(t)}catch(i){throw r.onError(i),i}return(I1(16,0)||B0(16,0,!0))&&(t.codec==="vp9"&&(t.codec="vp8",R.debug("browser not support vp9, force use vp8")),nn("UNSUPPORTED_VIDEO_CODEC",["vp9"])),t.audioCodec===void 0&&(t.audioCodec="opus"),r.onSuccess(),new Z9(Yo(Yo({forceWaitGatewayResponse:!0},t),{},{role:Re(e=["rtc","p2p"]).call(e,t.mode)?"host":t.role||"audience"}),n)},createCameraVideoTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=F("CAMERA_CAPTURE_CONFIG"),n=ln(8,"track-cam-"),r=We.reportApiInvoke(null,{id:n,tag:In.TRACER,name:Bn.CREATE_CAM_VIDEO_TRACK,options:[mn({},e),t]});t&&(e.encoderConfig=t);const i=BS(e);let s=null;R.info("start create camera video track with config",JSON.stringify(e),"trackId",n);try{s=(await Ds({video:i},n)).getVideoTracks()[0]||null}catch(c){throw r.onError(c),c}if(!s){const c=new ce(U.UNEXPECTED_ERROR,"can not find track in media stream");return r.onError(c),c.throw(R)}if(e.optimizationMode&&bb(n,s,e,Bo(e.encoderConfig)),F("USE_STANDARD_BITRATE_DEFAULT")){const c=Bo(e.encoderConfig);e.encoderConfig=c,delete c.bitrateMax,delete c.bitrateMin}const o=new WS(s,e,i,e.scalabiltyMode?US(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,n);return r.onSuccess(o.getTrackId()),R.info("create camera video success, trackId:",n),o},createCustomVideoTrack:function(e){const t=ln(8,"track-cus-"),n=We.reportApiInvoke(null,{id:t,tag:In.TRACER,name:Bn.CREATE_CUSTOM_VIDEO_TRACK,options:[e]});F("USE_STANDARD_BITRATE_DEFAULT")&&(delete e.bitrateMax,delete e.bitrateMin);const r=new vn(e.mediaStreamTrack,{width:e.width,height:e.height,frameRate:e.frameRate,bitrateMax:e.bitrateMax,bitrateMin:e.bitrateMin},e.scalabiltyMode?US(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,t,[an.CUSTOM_TRACK]);return n.onSuccess(r.getTrackId()),R.info("create custom video track success with config",e,"trackId",r.getTrackId()),r},createScreenVideoTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"disable";const n=typeof t=="object"?(function(g){return LL(g)})(t):void 0;n&&(t="auto");const r=ln(8,"track-scr-v-"),i=We.reportApiInvoke(null,{id:r,tag:In.TRACER,name:Bn.CREATE_SCREEN_VIDEO_TRACK,options:[mn({},e),t]});e.encoderConfig?typeof e.encoderConfig=="string"||e.encoderConfig.width&&e.encoderConfig.height||(e.encoderConfig.width={max:1920},e.encoderConfig.height={max:1080}):e.encoderConfig="1080p_2";const s=(function(g){const v={};g.screenSourceType&&(v.mediaSource=g.screenSourceType),g.extensionId&&fl()&&(v.extensionId=g.extensionId);const{displaySurface:O,selfBrowserSurface:I,surfaceSwitching:N,systemAudio:M,preferCurrentTab:x}=g;(yf(107)||j0(107)||W0(93))&&(O&&(hr(O,"displaySurface",["browser","window","monitor"]),v.displaySurface=O),I?(hr(I,"selfBrowserSurface",["exclude","include"]),v.selfBrowserSurface=I):v.selfBrowserSurface="include",N&&(hr(N,"surfaceSwitching",["exclude","include"]),v.surfaceSwitching=N)),(yf(105)||j0(105)||W0(91))&&M&&(hr(M,"systemAudio",["exclude","include"]),v.systemAudio=M),(yf(94)||j0(94)||W0(80))&&x&&(v.preferCurrentTab=!0),g.electronScreenSourceId&&(v.sourceId=g.electronScreenSourceId);const B=g.encoderConfig?fb(g.encoderConfig):null;return v.mandatory={chromeMediaSource:"desktop",maxWidth:B?B.width:void 0,maxHeight:B?B.height:void 0},B&&(B.frameRate&&(typeof B.frameRate=="number"?(v.mandatory.maxFrameRate=B.frameRate,v.mandatory.minFrameRate=B.frameRate):(v.mandatory.maxFrameRate=B.frameRate.max||B.frameRate.ideal||B.frameRate.exact||void 0,v.mandatory.minFrameRate=B.frameRate.min||B.frameRate.ideal||B.frameRate.exact||void 0),v.frameRate=B.frameRate),B.width&&(v.width=B.width),B.height&&(v.height=B.height)),v})(e);let o=null,c=null;const l=Ft();if(!l.supportShareAudio&&t==="enable"){const g=new ce(U.NOT_SUPPORTED,"your browser or platform is not support share-screen with audio");return i.onError(g),g.throw(R)}R.info("start create screen video track with config",e,"withAudio",t,"trackId",r);const h=l.supportShareAudio&&t!=="disable";try{const g=await Ds({screen:s,screenAudio:h?n||!0:void 0},r);o=g.getVideoTracks()[0]||null,c=g.getAudioTracks()[0]||null}catch(g){throw i.onError(g),g}if(!o){const g=new ce(U.UNEXPECTED_ERROR,"can not find track in media stream");return i.onError(g),g.throw(R)}if(!c&&t==="enable"){o&&o.stop();const g=new ce(U.SHARE_AUDIO_NOT_ALLOWED);return i.onError(g),g.throw(R)}e.optimizationMode||(e.optimizationMode="detail"),e.optimizationMode&&(bb(r,o,e,e.encoderConfig&&fb(e.encoderConfig)||void 0),e.encoderConfig&&typeof e.encoderConfig!="string"&&(e.encoderConfig.bitrateMin=e.encoderConfig.bitrateMax));const p=new vn(o,e.encoderConfig?fb(e.encoderConfig):{},e.scalabiltyMode?US(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,r,[an.SCREEN_TRACK]);if(!c)return i.onSuccess(p.getTrackId()),R.info("create screen video track success","video:",p.getTrackId()),p;const E=new Fn(c,void 0,ln(8,"track-scr-a-"),!1);return i.onSuccess([p.getTrackId(),E.getTrackId()]),R.info("create screen video track success","video:",p.getTrackId(),"audio:",E.getTrackId()),[p,E]},createMicrophoneAndCameraTracks:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=F("CAMERA_CAPTURE_CONFIG"),r=ln(8,"track-mic-"),i=ln(8,"track-cam-"),s=We.reportApiInvoke(null,{id:"".concat(r,"-").concat(i),tag:In.TRACER,name:Bn.CREATE_MIC_AND_CAM_TRACKS,options:[e,t,n]});n&&(t.encoderConfig=n);const o=BS(t),c=xL(e);let l=null,h=null;R.info("start create camera video track(".concat(i,") and microphone audio track(").concat(r,") with config, audio: ").concat(JSON.stringify(e),", video: ").concat(JSON.stringify(t)));try{const g=await Ds({audio:c,video:o},"".concat(r,"-").concat(i));l=g.getAudioTracks()[0],h=g.getVideoTracks()[0]}catch(g){throw s.onError(g),g}if(!l||!h){const g=new ce(U.UNEXPECTED_ERROR,"can not find tracks in media stream");return s.onError(g),g.throw(R)}if(t.optimizationMode&&bb(i,h,t,Bo(t.encoderConfig)),F("USE_STANDARD_BITRATE_DEFAULT")){const g=Bo(t.encoderConfig);t.encoderConfig=g,delete g.bitrateMax,delete g.bitrateMin}const p=new KE(l,e,c,r),E=new WS(h,t,o,t.scalabiltyMode?US(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,i);return s.onSuccess([p.getTrackId(),E.getTrackId()]),R.info("create camera video track(".concat(i,") and microphone audio track(").concat(r,") success")),[p,E]},createMicrophoneAudioTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=ln(8,"track-mic-"),n=We.reportApiInvoke(null,{id:t,tag:In.TRACER,name:Bn.CREATE_MIC_AUDIO_TRACK,options:[e]}),r=xL(e);let i=null;R.info("start create microphone audio track with config",JSON.stringify(e),"trackId",t);try{i=(await Ds({audio:r},t)).getAudioTracks()[0]||null}catch(o){throw n.onError(o),o}if(!i){const o=new ce(U.UNEXPECTED_ERROR,"can not find track in media stream");return n.onError(o),o.throw(R)}const s=new KE(i,e,r,t);return n.onSuccess(s.getTrackId()),R.info("create microphone audio track success, trackId:",t),s},createCustomAudioTrack:function(e){const t=ln(8,"track-cus-"),n=We.reportApiInvoke(null,{id:t,tag:In.TRACER,name:Bn.CREATE_CUSTOM_AUDIO_TRACK,options:[e]}),r=new Fn(e.mediaStreamTrack,e.encoderConfig?VS(e.encoderConfig):{},t,!1);return R.info("create custom audio track success with config",e,"trackId",r.getTrackId()),n.onSuccess(r.getTrackId()),r},createBufferSourceAudioTrack:async function(e){var t;const{cacheOnlineFile:n,encoderConfig:r}=e;let{source:i}=e;const s={source:i instanceof AudioBuffer?"AudioBuffer":i instanceof File?(t=File.name)!==null&&t!==void 0?t:"File":i,cacheOnlineFile:n,encoderConfig:r},o=ln(8,"track-buf-"),c=We.reportApiInvoke(null,{id:o,tag:In.TRACER,name:Bn.CREATE_BUFFER_AUDIO_TRACK,options:[s]});if(F("DISABLE_WEBAUDIO"))throw new ce(U.NOT_SUPPORTED,"can not create BufferSourceAudioTrack when WebAudio disabled");R.info("start create buffer source audio track with config",JSON.stringify(s),"trackId",o);const l=i;if(!(i instanceof AudioBuffer))try{i=await(async function(E,g){let v=null;if(typeof E=="string"){const I=Sx.get(E);if(I)return R.debug("use cached audio resource: ",E),I;try{v=(await Ta((()=>Mi.get(E,{responseType:"arraybuffer"})),void 0,void 0,{maxRetryCount:3})).data}catch(N){throw new ce(U.FETCH_AUDIO_FILE_FAILED,N.toString())}}else v=await new Pe(((N,M)=>{const x=new FileReader;x.onload=B=>{B.target?N(B.target.result):M(new ce(U.READ_LOCAL_AUDIO_FILE_ERROR))},x.onerror=()=>{M(new ce(U.READ_LOCAL_AUDIO_FILE_ERROR))},x.readAsArrayBuffer(E)}));const O=await(function(I){const N=Lf();return new Pe(((M,x)=>{N.decodeAudioData(I,(B=>{M(B)}),(B=>{x(new ce(U.DECODE_AUDIO_FILE_FAILED,B.toString()))}))}))})(v);return typeof E=="string"&&g&&Sx.set(E,O),O})(i,n)}catch(E){return c.onError(E),E.throw(R)}const h=new vY(i),p=new gY(l,h,r?VS(r):{},o);return R.info("create buffer source audio track success, trackId:",o),c.onSuccess(p.getTrackId()),p},setAppType:function(e){if(R.debug("setAppType: ".concat(e)),!(Number.isInteger(e)&&e>=0))throw R.debug("Invalid appType"),new se(U.INVALID_PARAMS,"invalid app type",e);nn("APP_TYPE",Math.floor(e))},setLogLevel:function(e){R.setLogLevel(e)},enableLogUpload:function(){F("USE_NEW_LOG")?nn("UPLOAD_LOG",!0):R.enableLogUpload()},disableLogUpload:function(){F("USE_NEW_LOG")?nn("UPLOAD_LOG",!1):R.disableLogUpload()},createChannelMediaRelayConfiguration:function(){return new C2},checkAudioTrackIsActive:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const n=We.reportApiInvoke(null,{tag:In.TRACER,name:Bn.CHECK_AUDIO_TRACK_IS_ACTIVE,options:[t]});if(!(e instanceof Fn||e instanceof Uf)){const l=new se(U.INVALID_TRACK,"the parameter is not a audio track");return n.onError(l),l.throw()}t&&t<1e3&&(t=1e3);const r=e instanceof Fn?e.getTrackLabel():"remote_track",i=e.getVolumeLevel();let s=i,o=i;const c=Date.now();return new Pe((l=>{const h=setInterval((()=>{const p=e.getVolumeLevel();s=p>s?p:s,o=p<o?p:o;const E=s-o>1e-4,g=Date.now()-c;if(E||g>t){clearInterval(h);const v=E,O={duration:g,deviceLabel:r,maxVolumeLevel:s,result:v};R.info("[track-".concat(e.getTrackId(),"] check audio track active completed. ").concat(JSON.stringify(O))),n.onSuccess(O),l(v)}}),200)}))},checkVideoTrackIsActive:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const n=We.reportApiInvoke(null,{tag:In.TRACER,name:Bn.CHECK_VIDEO_TRACK_IS_ACTIVE,options:[t]});if(!(e instanceof vn||e instanceof Mf)){const E=new se(U.INVALID_TRACK,"the parameter is not a video track");return n.onError(E),E.throw()}t&&t<1e3&&(t=1e3);const r=e instanceof vn?e.getTrackLabel():"remote_track",i=e.getMediaStreamTrack(!0),s=document.createElement("video");s.style.width="1px",s.style.height="1px",s.setAttribute("muted",""),s.muted=!0,s.setAttribute("playsinline",""),s.controls=!1,(Vr()||bS())&&(s.style.opacity="0.01",s.style.position="fixed",s.style.left="0",s.style.top="0",document.body.appendChild(s)),s.srcObject=new MediaStream([i]),s.play();const o=document.createElement("canvas");o.width=160,o.height=120;let c=0,l=0;try{const E=Date.now();c=await(function(g,v,O,I){let N,M=0,x=null;return new Pe(((B,Z)=>{function Q(){M>I&&N&&(N(),B(M));const z=O.getContext("2d");if(!z){const me=new se(U.UNEXPECTED_ERROR,"can not get canvas 2d context.");return R.error(me.toString()),void Z(me)}z.drawImage(g,0,0,160,120);const te=z.getImageData(0,0,O.width,O.height),de=Math.floor(te.data.length/3);if(x){for(let me=0;me<de;me+=3)if(te.data[me]!==x[me])return M+=1,void(x=te.data);x=te.data}else x=te.data}setTimeout((()=>{N&&(N(),B(M))}),v),N=vb((()=>{Q()}),30)}))})(s,t,o,4),l=Date.now()-E}catch(E){throw n.onError(E),E}V9===Gt.SAFARI&&(s.pause(),s.remove()),s.srcObject=null;const h=c>4,p={duration:l,changedPicNum:c,deviceLabel:r,result:h};return R.info("[track-".concat(e.getTrackId(),"] check video track active completed. ").concat(JSON.stringify(p))),n.onSuccess(p),h},setArea:eI,audioElementPlayCenter:Ui,resumeAudioContext:function(){Ui.autoResumeAfterInterruption(!0)},processExternalMediaAEC:function(e){e7.processExternalMediaAEC(e)},registerExtensions:function(e){const t=F("PLUGIN_INFO")||[];e.forEach((n=>{"name"in n&&!Re(t).call(t,n.name)&&t.push(n.name);const r=n;r.__registered__=!0,r.logger.hookLog=R.extLog,r.reporter.hookApiInvoke=We.extApiInvoke,r.parameters&&Object.keys(r.parameters).forEach((i=>{r.parameters[i]=F(i)}))})),Cj("PLUGIN_INFO",t)},ChannelMediaRelayError:Ff,ChannelMediaRelayEvent:gl,ChannelMediaRelayState:es,RemoteStreamFallbackType:uY,RemoteStreamType:dY,ConnectionDisconnectedReason:Qt,AudienceLatencyLevelType:Bz,AREAS:qt,preload:async function(e,t,n,r){return q2(e,t,n,r)}});return Object.defineProperties(ir,{onAudioAutoplayFailed:{get:()=>Ls.onAudioAutoplayFailed,set:e=>{Ls.onAudioAutoplayFailed=e}},onAutoplayFailed:{get:()=>Ls.onAutoplayFailed,set:e=>{Ls.onAutoplayFailed=e}},_onSecurityPolicyViolation:{value:void 0,writable:!0},_cspEventHandlerPointer:{value:void 0,writable:!0},onSecurityPolicyViolation:{get:()=>ir._onSecurityPolicyViolation,set(e){ir._onSecurityPolicyViolation=e,iV(e)}},__CLIENT_LIST__:{get:()=>F("SHOW_GLOBAL_CLIENT_LIST")?Rh:[]}}),ks.on(vh.CAMERA_DEVICE_CHANGED,(e=>{R.info("camera device changed",JSON.stringify(e)),ir.onCameraChanged&&ir.onCameraChanged(e),ir.safeEmit(bc.CAMERA_CHANGED,e)})),ks.on(vh.RECORDING_DEVICE_CHANGED,(e=>{R.info("microphone device changed",JSON.stringify(e)),ir.onMicrophoneChanged&&ir.onMicrophoneChanged(e),ir.safeEmit(bc.MICROPHONE_CHANGED,e)})),ks.on(vh.PLAYOUT_DEVICE_CHANGED,(e=>{R.debug("playout device changed",JSON.stringify(e)),ir.onPlaybackDeviceChanged&&ir.onPlaybackDeviceChanged(e),ir.safeEmit(bc.PLAYBACK_DEVICE_CHANGED,e)})),Ui.onAutoplayFailed=()=>{R.info("detect audio element autoplay failed"),Ls.onAudioAutoplayFailed&&Ls.onAudioAutoplayFailed()},rn.on("autoplay-failed",(()=>{R.info("detect webaudio autoplay failed"),Ls.onAudioAutoplayFailed&&Ls.onAudioAutoplayFailed(),ir.safeEmit(bc.AUTOPLAY_FAILED)})),rn.on(Lr.STATE_CHANGE,((e,t)=>{R.info("audio context state changed: ".concat(t," => ").concat(e)),ir.onAudioContextStateChanged&&ir.onAudioContextStateChanged(e,t),ir.safeEmit(bc.AUDIO_CONTEXT_STATE_CHANGED,e,t)})),Qn.on(Tf.NETWORK_STATE_CHANGE,((e,t)=>{R.info("[network-indicator] network state changed, ".concat(t," => ").concat(e))})),window&&(window.__ARTC__=ir),ir}))})(mR)),mR.exports}var Rre=Tre();const aR=KA(Rre);function Cre(){const u=j.useRef(null),f=j.useRef(null),_=j.useRef(null),y=j.useRef(null),[C,A]=j.useState([]),[D,L]=j.useState(""),[V,G]=j.useState(""),[W,K]=j.useState(""),[ee,X]=j.useState(""),[re,q]=j.useState(!1),[$,ae]=j.useState(!1),[oe,le]=j.useState(!1),{toast:Se}=Bg(),be=j.useMemo(()=>(u.current||(u.current=aR.createClient({mode:"rtc",codec:"vp8"})),u.current),[]);j.useEffect(()=>{const je=be,lt=async(pt,Fe)=>{await je.subscribe(pt,Fe),Fe==="audio"&&pt.audioTrack&&pt.audioTrack.play(),A(Array.from(je.remoteUsers))},Et=()=>{A(Array.from(je.remoteUsers))},ht=()=>A(Array.from(je.remoteUsers)),Ge=()=>A(Array.from(je.remoteUsers));return je.on("user-published",lt),je.on("user-unpublished",Et),je.on("user-joined",ht),je.on("user-left",Ge),()=>{je.off("user-published",lt),je.off("user-unpublished",Et),je.off("user-joined",ht),je.off("user-left",Ge)}},[be]);const Ue=async({appId:je,channel:lt,token:Et,uid:ht})=>{if(!je||!lt){Se({title:"Missing fields",description:"Please enter App ID and Channel",variant:"destructive"});return}const Ge=be;try{le(!0),aR.setLogLevel(2);let pt=Et?.trim()||"",Fe=ht&&ht!==""?ht:null;if(!pt)try{const Ct=await Ite({channel:lt.trim(),uid:Fe??0,role:"publisher",expireSeconds:3600});pt=Ct.token,Fe=Ct.uid}catch(Ct){throw console.error("Failed to fetch token:",Ct),new Error("Could not fetch token from server. Ensure server .env has AGORA_APP_ID and AGORA_APP_CERTIFICATE.")}await Ge.join(je.trim(),lt.trim(),pt||null,Fe),f.current=await aR.createMicrophoneAudioTrack(),_.current=await aR.createCameraVideoTrack(),ae(!0),await Ge.publish([f.current,_.current]),ae(!1),y.current&&_.current&&_.current.play(y.current),q(!0),Se({title:"Joined",description:`Channel "${lt}" joined successfully.`})}catch(pt){try{f.current&&(f.current.stop(),f.current.close(),f.current=null),_.current&&(_.current.stop(),_.current.close(),_.current=null)}catch(Ct){console.error("Error during cleanup after join failure:",Ct)}console.error("Failed to join/publish:",pt);const Fe=pt instanceof Error?pt.message:"Unknown error";Se({title:"Join failed",description:Fe,variant:"destructive"})}finally{le(!1),ae(!1)}},xe=async()=>{const je=be;try{f.current&&(f.current.stop(),f.current.close()),_.current&&(_.current.stop(),_.current.close()),f.current=null,_.current=null,A([]),je.connectionState!=="DISCONNECTED"&&await je.leave()}finally{q(!1)}};return T.jsx("div",{className:"container mx-auto pt-24 pb-8",children:T.jsxs(Gn,{children:[T.jsx($r,{children:T.jsx(Bi,{children:"Video Call"})}),T.jsxs(zn,{children:[T.jsxs("div",{className:"grid gap-4 md:grid-cols-4",children:[T.jsx(Vc,{placeholder:"App ID",value:D,onChange:je=>L(je.target.value)}),T.jsx(Vc,{placeholder:"Channel",value:V,onChange:je=>G(je.target.value)}),T.jsx(Vc,{placeholder:"Token (optional)",value:W,onChange:je=>K(je.target.value)}),T.jsx(Vc,{placeholder:"UID (optional)",value:ee,onChange:je=>X(je.target.value)})]}),T.jsx("div",{className:"mt-4 flex gap-3",children:re?T.jsx(Cn,{variant:"destructive",onClick:xe,disabled:$,children:"Leave"}):T.jsx(Cn,{onClick:()=>Ue({appId:D,channel:V,token:W||null,uid:ee||null}),disabled:!D||!V||oe,children:oe?"Joining...":"Join & Publish"})}),T.jsxs("div",{className:"mt-6 grid gap-4 md:grid-cols-2",children:[T.jsx("div",{className:"w-full aspect-video bg-muted rounded relative overflow-hidden",children:T.jsx("div",{ref:y,className:"w-full h-full"})}),T.jsxs("div",{className:"grid gap-4",children:[C.length===0&&T.jsx("div",{className:"p-4 text-sm text-muted-foreground border rounded",children:"No remote users yet. Share the channel name with others to join."}),C.map(je=>T.jsx("div",{className:"w-full aspect-video bg-muted rounded overflow-hidden",children:T.jsx("div",{id:`remote-player-${je.uid}`,className:"w-full h-full",ref:lt=>{lt&&je.videoTrack&&je.videoTrack.play(lt)}})},je.uid))]})]})]})]})})}const wre=new z$,bre=()=>T.jsx(q$,{client:wre,children:T.jsx(Jee,{attribute:"class",defaultTheme:"system",enableSystem:!0,disableTransitionOnChange:!0,children:T.jsxs(T$,{children:[T.jsx(eQ,{}),T.jsx(UQ,{}),T.jsx(zee,{children:T.jsxs(jee,{children:[T.jsx(xa,{path:"/",element:T.jsx(Zee,{})}),T.jsx(xa,{path:"/auth",element:T.jsx(mte,{})}),T.jsx(xa,{path:"/feed",element:T.jsx(Lte,{})}),T.jsx(xa,{path:"/create",element:T.jsx(Mte,{})}),T.jsx(xa,{path:"/rooms",element:T.jsx(Ute,{})}),T.jsx(xa,{path:"/profile",element:T.jsx(Fte,{})}),T.jsx(xa,{path:"/settings",element:T.jsx(gre,{})}),T.jsx(xa,{path:"/about",element:T.jsx(vre,{})}),T.jsx(xa,{path:"/video-call",element:T.jsx(Cre,{})}),T.jsx(xa,{path:"*",element:T.jsx(yre,{})})]})})]})})});tX.createRoot(document.getElementById("root")).render(T.jsx(bre,{}));
