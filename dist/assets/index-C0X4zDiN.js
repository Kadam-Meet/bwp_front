function KX(l,p){for(var m=0;m<p.length;m++){const y=p[m];if(typeof y!="string"&&!Array.isArray(y)){for(const R in y)if(R!=="default"&&!(R in l)){const C=Object.getOwnPropertyDescriptor(y,R);C&&Object.defineProperty(l,R,C.get?C:{enumerable:!0,get:()=>y[R]})}}}return Object.freeze(Object.defineProperty(l,Symbol.toStringTag,{value:"Module"}))}(function(){const p=document.createElement("link").relList;if(p&&p.supports&&p.supports("modulepreload"))return;for(const R of document.querySelectorAll('link[rel="modulepreload"]'))y(R);new MutationObserver(R=>{for(const C of R)if(C.type==="childList")for(const P of C.addedNodes)P.tagName==="LINK"&&P.rel==="modulepreload"&&y(P)}).observe(document,{childList:!0,subtree:!0});function m(R){const C={};return R.integrity&&(C.integrity=R.integrity),R.referrerPolicy&&(C.referrerPolicy=R.referrerPolicy),R.crossOrigin==="use-credentials"?C.credentials="include":R.crossOrigin==="anonymous"?C.credentials="omit":C.credentials="same-origin",C}function y(R){if(R.ep)return;R.ep=!0;const C=m(R);fetch(R.href,C)}})();var hA=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function cN(l){return l&&l.__esModule&&Object.prototype.hasOwnProperty.call(l,"default")?l.default:l}var pA={exports:{}},VE={},fA={exports:{}},wn={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var BV;function zX(){if(BV)return wn;BV=1;var l=Symbol.for("react.element"),p=Symbol.for("react.portal"),m=Symbol.for("react.fragment"),y=Symbol.for("react.strict_mode"),R=Symbol.for("react.profiler"),C=Symbol.for("react.provider"),P=Symbol.for("react.context"),k=Symbol.for("react.forward_ref"),M=Symbol.for("react.suspense"),F=Symbol.for("react.memo"),H=Symbol.for("react.lazy"),K=Symbol.iterator;function ee(fe){return fe===null||typeof fe!="object"?null:(fe=K&&fe[K]||fe["@@iterator"],typeof fe=="function"?fe:null)}var X={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},re=Object.assign,G={};function J(fe,Ne,st){this.props=fe,this.context=Ne,this.refs=G,this.updater=st||X}J.prototype.isReactComponent={},J.prototype.setState=function(fe,Ne){if(typeof fe!="object"&&typeof fe!="function"&&fe!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,fe,Ne,"setState")},J.prototype.forceUpdate=function(fe){this.updater.enqueueForceUpdate(this,fe,"forceUpdate")};function te(){}te.prototype=J.prototype;function ne(fe,Ne,st){this.props=fe,this.context=Ne,this.refs=G,this.updater=st||X}var se=ne.prototype=new te;se.constructor=ne,re(se,J.prototype),se.isPureReactComponent=!0;var ae=Array.isArray,pe=Object.prototype.hasOwnProperty,Se={current:null},Te={key:!0,ref:!0,__self:!0,__source:!0};function Ue(fe,Ne,st){var it,Pt={},zt=null,Ye=null;if(Ne!=null)for(it in Ne.ref!==void 0&&(Ye=Ne.ref),Ne.key!==void 0&&(zt=""+Ne.key),Ne)pe.call(Ne,it)&&!Te.hasOwnProperty(it)&&(Pt[it]=Ne[it]);var Nt=arguments.length-2;if(Nt===1)Pt.children=st;else if(1<Nt){for(var Gt=Array(Nt),Yt=0;Yt<Nt;Yt++)Gt[Yt]=arguments[Yt+2];Pt.children=Gt}if(fe&&fe.defaultProps)for(it in Nt=fe.defaultProps,Nt)Pt[it]===void 0&&(Pt[it]=Nt[it]);return{$$typeof:l,type:fe,key:zt,ref:Ye,props:Pt,_owner:Se.current}}function tt(fe,Ne){return{$$typeof:l,type:fe.type,key:Ne,ref:fe.ref,props:fe.props,_owner:fe._owner}}function gt(fe){return typeof fe=="object"&&fe!==null&&fe.$$typeof===l}function ht(fe){var Ne={"=":"=0",":":"=2"};return"$"+fe.replace(/[=:]/g,function(st){return Ne[st]})}var Ge=/\/+/g;function pt(fe,Ne){return typeof fe=="object"&&fe!==null&&fe.key!=null?ht(""+fe.key):Ne.toString(36)}function Fe(fe,Ne,st,it,Pt){var zt=typeof fe;(zt==="undefined"||zt==="boolean")&&(fe=null);var Ye=!1;if(fe===null)Ye=!0;else switch(zt){case"string":case"number":Ye=!0;break;case"object":switch(fe.$$typeof){case l:case p:Ye=!0}}if(Ye)return Ye=fe,Pt=Pt(Ye),fe=it===""?"."+pt(Ye,0):it,ae(Pt)?(st="",fe!=null&&(st=fe.replace(Ge,"$&/")+"/"),Fe(Pt,Ne,st,"",function(Yt){return Yt})):Pt!=null&&(gt(Pt)&&(Pt=tt(Pt,st+(!Pt.key||Ye&&Ye.key===Pt.key?"":(""+Pt.key).replace(Ge,"$&/")+"/")+fe)),Ne.push(Pt)),1;if(Ye=0,it=it===""?".":it+":",ae(fe))for(var Nt=0;Nt<fe.length;Nt++){zt=fe[Nt];var Gt=it+pt(zt,Nt);Ye+=Fe(zt,Ne,st,Gt,Pt)}else if(Gt=ee(fe),typeof Gt=="function")for(fe=Gt.call(fe),Nt=0;!(zt=fe.next()).done;)zt=zt.value,Gt=it+pt(zt,Nt++),Ye+=Fe(zt,Ne,st,Gt,Pt);else if(zt==="object")throw Ne=String(fe),Error("Objects are not valid as a React child (found: "+(Ne==="[object Object]"?"object with keys {"+Object.keys(fe).join(", ")+"}":Ne)+"). If you meant to render a collection of children, use an array instead.");return Ye}function wt(fe,Ne,st){if(fe==null)return fe;var it=[],Pt=0;return Fe(fe,it,"","",function(zt){return Ne.call(st,zt,Pt++)}),it}function rt(fe){if(fe._status===-1){var Ne=fe._result;Ne=Ne(),Ne.then(function(st){(fe._status===0||fe._status===-1)&&(fe._status=1,fe._result=st)},function(st){(fe._status===0||fe._status===-1)&&(fe._status=2,fe._result=st)}),fe._status===-1&&(fe._status=0,fe._result=Ne)}if(fe._status===1)return fe._result.default;throw fe._result}var Je={current:null},De={transition:null},Le={ReactCurrentDispatcher:Je,ReactCurrentBatchConfig:De,ReactCurrentOwner:Se};function ze(){throw Error("act(...) is not supported in production builds of React.")}return wn.Children={map:wt,forEach:function(fe,Ne,st){wt(fe,function(){Ne.apply(this,arguments)},st)},count:function(fe){var Ne=0;return wt(fe,function(){Ne++}),Ne},toArray:function(fe){return wt(fe,function(Ne){return Ne})||[]},only:function(fe){if(!gt(fe))throw Error("React.Children.only expected to receive a single React element child.");return fe}},wn.Component=J,wn.Fragment=m,wn.Profiler=R,wn.PureComponent=ne,wn.StrictMode=y,wn.Suspense=M,wn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Le,wn.act=ze,wn.cloneElement=function(fe,Ne,st){if(fe==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+fe+".");var it=re({},fe.props),Pt=fe.key,zt=fe.ref,Ye=fe._owner;if(Ne!=null){if(Ne.ref!==void 0&&(zt=Ne.ref,Ye=Se.current),Ne.key!==void 0&&(Pt=""+Ne.key),fe.type&&fe.type.defaultProps)var Nt=fe.type.defaultProps;for(Gt in Ne)pe.call(Ne,Gt)&&!Te.hasOwnProperty(Gt)&&(it[Gt]=Ne[Gt]===void 0&&Nt!==void 0?Nt[Gt]:Ne[Gt])}var Gt=arguments.length-2;if(Gt===1)it.children=st;else if(1<Gt){Nt=Array(Gt);for(var Yt=0;Yt<Gt;Yt++)Nt[Yt]=arguments[Yt+2];it.children=Nt}return{$$typeof:l,type:fe.type,key:Pt,ref:zt,props:it,_owner:Ye}},wn.createContext=function(fe){return fe={$$typeof:P,_currentValue:fe,_currentValue2:fe,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},fe.Provider={$$typeof:C,_context:fe},fe.Consumer=fe},wn.createElement=Ue,wn.createFactory=function(fe){var Ne=Ue.bind(null,fe);return Ne.type=fe,Ne},wn.createRef=function(){return{current:null}},wn.forwardRef=function(fe){return{$$typeof:k,render:fe}},wn.isValidElement=gt,wn.lazy=function(fe){return{$$typeof:H,_payload:{_status:-1,_result:fe},_init:rt}},wn.memo=function(fe,Ne){return{$$typeof:F,type:fe,compare:Ne===void 0?null:Ne}},wn.startTransition=function(fe){var Ne=De.transition;De.transition={};try{fe()}finally{De.transition=Ne}},wn.unstable_act=ze,wn.useCallback=function(fe,Ne){return Je.current.useCallback(fe,Ne)},wn.useContext=function(fe){return Je.current.useContext(fe)},wn.useDebugValue=function(){},wn.useDeferredValue=function(fe){return Je.current.useDeferredValue(fe)},wn.useEffect=function(fe,Ne){return Je.current.useEffect(fe,Ne)},wn.useId=function(){return Je.current.useId()},wn.useImperativeHandle=function(fe,Ne,st){return Je.current.useImperativeHandle(fe,Ne,st)},wn.useInsertionEffect=function(fe,Ne){return Je.current.useInsertionEffect(fe,Ne)},wn.useLayoutEffect=function(fe,Ne){return Je.current.useLayoutEffect(fe,Ne)},wn.useMemo=function(fe,Ne){return Je.current.useMemo(fe,Ne)},wn.useReducer=function(fe,Ne,st){return Je.current.useReducer(fe,Ne,st)},wn.useRef=function(fe){return Je.current.useRef(fe)},wn.useState=function(fe){return Je.current.useState(fe)},wn.useSyncExternalStore=function(fe,Ne,st){return Je.current.useSyncExternalStore(fe,Ne,st)},wn.useTransition=function(){return Je.current.useTransition()},wn.version="18.3.1",wn}var WV;function VR(){return WV||(WV=1,fA.exports=zX()),fA.exports}/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var GV;function YX(){if(GV)return VE;GV=1;var l=VR(),p=Symbol.for("react.element"),m=Symbol.for("react.fragment"),y=Object.prototype.hasOwnProperty,R=l.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,C={key:!0,ref:!0,__self:!0,__source:!0};function P(k,M,F){var H,K={},ee=null,X=null;F!==void 0&&(ee=""+F),M.key!==void 0&&(ee=""+M.key),M.ref!==void 0&&(X=M.ref);for(H in M)y.call(M,H)&&!C.hasOwnProperty(H)&&(K[H]=M[H]);if(k&&k.defaultProps)for(H in M=k.defaultProps,M)K[H]===void 0&&(K[H]=M[H]);return{$$typeof:p,type:k,key:ee,ref:X,props:K,_owner:R.current}}return VE.Fragment=m,VE.jsx=P,VE.jsxs=P,VE}var HV;function qX(){return HV||(HV=1,pA.exports=YX()),pA.exports}var v=qX(),hR={},mA={exports:{}},Vs={},_A={exports:{}},gA={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var KV;function XX(){return KV||(KV=1,(function(l){function p(De,Le){var ze=De.length;De.push(Le);e:for(;0<ze;){var fe=ze-1>>>1,Ne=De[fe];if(0<R(Ne,Le))De[fe]=Le,De[ze]=Ne,ze=fe;else break e}}function m(De){return De.length===0?null:De[0]}function y(De){if(De.length===0)return null;var Le=De[0],ze=De.pop();if(ze!==Le){De[0]=ze;e:for(var fe=0,Ne=De.length,st=Ne>>>1;fe<st;){var it=2*(fe+1)-1,Pt=De[it],zt=it+1,Ye=De[zt];if(0>R(Pt,ze))zt<Ne&&0>R(Ye,Pt)?(De[fe]=Ye,De[zt]=ze,fe=zt):(De[fe]=Pt,De[it]=ze,fe=it);else if(zt<Ne&&0>R(Ye,ze))De[fe]=Ye,De[zt]=ze,fe=zt;else break e}}return Le}function R(De,Le){var ze=De.sortIndex-Le.sortIndex;return ze!==0?ze:De.id-Le.id}if(typeof performance=="object"&&typeof performance.now=="function"){var C=performance;l.unstable_now=function(){return C.now()}}else{var P=Date,k=P.now();l.unstable_now=function(){return P.now()-k}}var M=[],F=[],H=1,K=null,ee=3,X=!1,re=!1,G=!1,J=typeof setTimeout=="function"?setTimeout:null,te=typeof clearTimeout=="function"?clearTimeout:null,ne=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function se(De){for(var Le=m(F);Le!==null;){if(Le.callback===null)y(F);else if(Le.startTime<=De)y(F),Le.sortIndex=Le.expirationTime,p(M,Le);else break;Le=m(F)}}function ae(De){if(G=!1,se(De),!re)if(m(M)!==null)re=!0,rt(pe);else{var Le=m(F);Le!==null&&Je(ae,Le.startTime-De)}}function pe(De,Le){re=!1,G&&(G=!1,te(Ue),Ue=-1),X=!0;var ze=ee;try{for(se(Le),K=m(M);K!==null&&(!(K.expirationTime>Le)||De&&!ht());){var fe=K.callback;if(typeof fe=="function"){K.callback=null,ee=K.priorityLevel;var Ne=fe(K.expirationTime<=Le);Le=l.unstable_now(),typeof Ne=="function"?K.callback=Ne:K===m(M)&&y(M),se(Le)}else y(M);K=m(M)}if(K!==null)var st=!0;else{var it=m(F);it!==null&&Je(ae,it.startTime-Le),st=!1}return st}finally{K=null,ee=ze,X=!1}}var Se=!1,Te=null,Ue=-1,tt=5,gt=-1;function ht(){return!(l.unstable_now()-gt<tt)}function Ge(){if(Te!==null){var De=l.unstable_now();gt=De;var Le=!0;try{Le=Te(!0,De)}finally{Le?pt():(Se=!1,Te=null)}}else Se=!1}var pt;if(typeof ne=="function")pt=function(){ne(Ge)};else if(typeof MessageChannel<"u"){var Fe=new MessageChannel,wt=Fe.port2;Fe.port1.onmessage=Ge,pt=function(){wt.postMessage(null)}}else pt=function(){J(Ge,0)};function rt(De){Te=De,Se||(Se=!0,pt())}function Je(De,Le){Ue=J(function(){De(l.unstable_now())},Le)}l.unstable_IdlePriority=5,l.unstable_ImmediatePriority=1,l.unstable_LowPriority=4,l.unstable_NormalPriority=3,l.unstable_Profiling=null,l.unstable_UserBlockingPriority=2,l.unstable_cancelCallback=function(De){De.callback=null},l.unstable_continueExecution=function(){re||X||(re=!0,rt(pe))},l.unstable_forceFrameRate=function(De){0>De||125<De?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):tt=0<De?Math.floor(1e3/De):5},l.unstable_getCurrentPriorityLevel=function(){return ee},l.unstable_getFirstCallbackNode=function(){return m(M)},l.unstable_next=function(De){switch(ee){case 1:case 2:case 3:var Le=3;break;default:Le=ee}var ze=ee;ee=Le;try{return De()}finally{ee=ze}},l.unstable_pauseExecution=function(){},l.unstable_requestPaint=function(){},l.unstable_runWithPriority=function(De,Le){switch(De){case 1:case 2:case 3:case 4:case 5:break;default:De=3}var ze=ee;ee=De;try{return Le()}finally{ee=ze}},l.unstable_scheduleCallback=function(De,Le,ze){var fe=l.unstable_now();switch(typeof ze=="object"&&ze!==null?(ze=ze.delay,ze=typeof ze=="number"&&0<ze?fe+ze:fe):ze=fe,De){case 1:var Ne=-1;break;case 2:Ne=250;break;case 5:Ne=1073741823;break;case 4:Ne=1e4;break;default:Ne=5e3}return Ne=ze+Ne,De={id:H++,callback:Le,priorityLevel:De,startTime:ze,expirationTime:Ne,sortIndex:-1},ze>fe?(De.sortIndex=ze,p(F,De),m(M)===null&&De===m(F)&&(G?(te(Ue),Ue=-1):G=!0,Je(ae,ze-fe))):(De.sortIndex=Ne,p(M,De),re||X||(re=!0,rt(pe))),De},l.unstable_shouldYield=ht,l.unstable_wrapCallback=function(De){var Le=ee;return function(){var ze=ee;ee=Le;try{return De.apply(this,arguments)}finally{ee=ze}}}})(gA)),gA}var zV;function JX(){return zV||(zV=1,_A.exports=XX()),_A.exports}/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var YV;function QX(){if(YV)return Vs;YV=1;var l=VR(),p=JX();function m(a){for(var u="https://reactjs.org/docs/error-decoder.html?invariant="+a,_=1;_<arguments.length;_++)u+="&args[]="+encodeURIComponent(arguments[_]);return"Minified React error #"+a+"; visit "+u+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var y=new Set,R={};function C(a,u){P(a,u),P(a+"Capture",u)}function P(a,u){for(R[a]=u,a=0;a<u.length;a++)y.add(u[a])}var k=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),M=Object.prototype.hasOwnProperty,F=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,H={},K={};function ee(a){return M.call(K,a)?!0:M.call(H,a)?!1:F.test(a)?K[a]=!0:(H[a]=!0,!1)}function X(a,u,_,T){if(_!==null&&_.type===0)return!1;switch(typeof u){case"function":case"symbol":return!0;case"boolean":return T?!1:_!==null?!_.acceptsBooleans:(a=a.toLowerCase().slice(0,5),a!=="data-"&&a!=="aria-");default:return!1}}function re(a,u,_,T){if(u===null||typeof u>"u"||X(a,u,_,T))return!0;if(T)return!1;if(_!==null)switch(_.type){case 3:return!u;case 4:return u===!1;case 5:return isNaN(u);case 6:return isNaN(u)||1>u}return!1}function G(a,u,_,T,I,D,q){this.acceptsBooleans=u===2||u===3||u===4,this.attributeName=T,this.attributeNamespace=I,this.mustUseProperty=_,this.propertyName=a,this.type=u,this.sanitizeURL=D,this.removeEmptyString=q}var J={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(a){J[a]=new G(a,0,!1,a,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(a){var u=a[0];J[u]=new G(u,1,!1,a[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(a){J[a]=new G(a,2,!1,a.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(a){J[a]=new G(a,2,!1,a,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(a){J[a]=new G(a,3,!1,a.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(a){J[a]=new G(a,3,!0,a,null,!1,!1)}),["capture","download"].forEach(function(a){J[a]=new G(a,4,!1,a,null,!1,!1)}),["cols","rows","size","span"].forEach(function(a){J[a]=new G(a,6,!1,a,null,!1,!1)}),["rowSpan","start"].forEach(function(a){J[a]=new G(a,5,!1,a.toLowerCase(),null,!1,!1)});var te=/[\-:]([a-z])/g;function ne(a){return a[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(a){var u=a.replace(te,ne);J[u]=new G(u,1,!1,a,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(a){var u=a.replace(te,ne);J[u]=new G(u,1,!1,a,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(a){var u=a.replace(te,ne);J[u]=new G(u,1,!1,a,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(a){J[a]=new G(a,1,!1,a.toLowerCase(),null,!1,!1)}),J.xlinkHref=new G("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(a){J[a]=new G(a,1,!1,a.toLowerCase(),null,!0,!0)});function se(a,u,_,T){var I=J.hasOwnProperty(u)?J[u]:null;(I!==null?I.type!==0:T||!(2<u.length)||u[0]!=="o"&&u[0]!=="O"||u[1]!=="n"&&u[1]!=="N")&&(re(u,_,I,T)&&(_=null),T||I===null?ee(u)&&(_===null?a.removeAttribute(u):a.setAttribute(u,""+_)):I.mustUseProperty?a[I.propertyName]=_===null?I.type===3?!1:"":_:(u=I.attributeName,T=I.attributeNamespace,_===null?a.removeAttribute(u):(I=I.type,_=I===3||I===4&&_===!0?"":""+_,T?a.setAttributeNS(T,u,_):a.setAttribute(u,_))))}var ae=l.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,pe=Symbol.for("react.element"),Se=Symbol.for("react.portal"),Te=Symbol.for("react.fragment"),Ue=Symbol.for("react.strict_mode"),tt=Symbol.for("react.profiler"),gt=Symbol.for("react.provider"),ht=Symbol.for("react.context"),Ge=Symbol.for("react.forward_ref"),pt=Symbol.for("react.suspense"),Fe=Symbol.for("react.suspense_list"),wt=Symbol.for("react.memo"),rt=Symbol.for("react.lazy"),Je=Symbol.for("react.offscreen"),De=Symbol.iterator;function Le(a){return a===null||typeof a!="object"?null:(a=De&&a[De]||a["@@iterator"],typeof a=="function"?a:null)}var ze=Object.assign,fe;function Ne(a){if(fe===void 0)try{throw Error()}catch(_){var u=_.stack.trim().match(/\n( *(at )?)/);fe=u&&u[1]||""}return`
`+fe+a}var st=!1;function it(a,u){if(!a||st)return"";st=!0;var _=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(u)if(u=function(){throw Error()},Object.defineProperty(u.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(u,[])}catch(Oe){var T=Oe}Reflect.construct(a,[],u)}else{try{u.call()}catch(Oe){T=Oe}a.call(u.prototype)}else{try{throw Error()}catch(Oe){T=Oe}a()}}catch(Oe){if(Oe&&T&&typeof Oe.stack=="string"){for(var I=Oe.stack.split(`
`),D=T.stack.split(`
`),q=I.length-1,ce=D.length-1;1<=q&&0<=ce&&I[q]!==D[ce];)ce--;for(;1<=q&&0<=ce;q--,ce--)if(I[q]!==D[ce]){if(q!==1||ce!==1)do if(q--,ce--,0>ce||I[q]!==D[ce]){var he=`
`+I[q].replace(" at new "," at ");return a.displayName&&he.includes("<anonymous>")&&(he=he.replace("<anonymous>",a.displayName)),he}while(1<=q&&0<=ce);break}}}finally{st=!1,Error.prepareStackTrace=_}return(a=a?a.displayName||a.name:"")?Ne(a):""}function Pt(a){switch(a.tag){case 5:return Ne(a.type);case 16:return Ne("Lazy");case 13:return Ne("Suspense");case 19:return Ne("SuspenseList");case 0:case 2:case 15:return a=it(a.type,!1),a;case 11:return a=it(a.type.render,!1),a;case 1:return a=it(a.type,!0),a;default:return""}}function zt(a){if(a==null)return null;if(typeof a=="function")return a.displayName||a.name||null;if(typeof a=="string")return a;switch(a){case Te:return"Fragment";case Se:return"Portal";case tt:return"Profiler";case Ue:return"StrictMode";case pt:return"Suspense";case Fe:return"SuspenseList"}if(typeof a=="object")switch(a.$$typeof){case ht:return(a.displayName||"Context")+".Consumer";case gt:return(a._context.displayName||"Context")+".Provider";case Ge:var u=a.render;return a=a.displayName,a||(a=u.displayName||u.name||"",a=a!==""?"ForwardRef("+a+")":"ForwardRef"),a;case wt:return u=a.displayName||null,u!==null?u:zt(a.type)||"Memo";case rt:u=a._payload,a=a._init;try{return zt(a(u))}catch{}}return null}function Ye(a){var u=a.type;switch(a.tag){case 24:return"Cache";case 9:return(u.displayName||"Context")+".Consumer";case 10:return(u._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return a=u.render,a=a.displayName||a.name||"",u.displayName||(a!==""?"ForwardRef("+a+")":"ForwardRef");case 7:return"Fragment";case 5:return u;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return zt(u);case 8:return u===Ue?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof u=="function")return u.displayName||u.name||null;if(typeof u=="string")return u}return null}function Nt(a){switch(typeof a){case"boolean":case"number":case"string":case"undefined":return a;case"object":return a;default:return""}}function Gt(a){var u=a.type;return(a=a.nodeName)&&a.toLowerCase()==="input"&&(u==="checkbox"||u==="radio")}function Yt(a){var u=Gt(a)?"checked":"value",_=Object.getOwnPropertyDescriptor(a.constructor.prototype,u),T=""+a[u];if(!a.hasOwnProperty(u)&&typeof _<"u"&&typeof _.get=="function"&&typeof _.set=="function"){var I=_.get,D=_.set;return Object.defineProperty(a,u,{configurable:!0,get:function(){return I.call(this)},set:function(q){T=""+q,D.call(this,q)}}),Object.defineProperty(a,u,{enumerable:_.enumerable}),{getValue:function(){return T},setValue:function(q){T=""+q},stopTracking:function(){a._valueTracker=null,delete a[u]}}}}function Cn(a){a._valueTracker||(a._valueTracker=Yt(a))}function Yn(a){if(!a)return!1;var u=a._valueTracker;if(!u)return!0;var _=u.getValue(),T="";return a&&(T=Gt(a)?a.checked?"true":"false":a.value),a=T,a!==_?(u.setValue(a),!0):!1}function er(a){if(a=a||(typeof document<"u"?document:void 0),typeof a>"u")return null;try{return a.activeElement||a.body}catch{return a.body}}function ss(a,u){var _=u.checked;return ze({},u,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:_??a._wrapperState.initialChecked})}function Ga(a,u){var _=u.defaultValue==null?"":u.defaultValue,T=u.checked!=null?u.checked:u.defaultChecked;_=Nt(u.value!=null?u.value:_),a._wrapperState={initialChecked:T,initialValue:_,controlled:u.type==="checkbox"||u.type==="radio"?u.checked!=null:u.value!=null}}function Ei(a,u){u=u.checked,u!=null&&se(a,"checked",u,!1)}function ta(a,u){Ei(a,u);var _=Nt(u.value),T=u.type;if(_!=null)T==="number"?(_===0&&a.value===""||a.value!=_)&&(a.value=""+_):a.value!==""+_&&(a.value=""+_);else if(T==="submit"||T==="reset"){a.removeAttribute("value");return}u.hasOwnProperty("value")?ci(a,u.type,_):u.hasOwnProperty("defaultValue")&&ci(a,u.type,Nt(u.defaultValue)),u.checked==null&&u.defaultChecked!=null&&(a.defaultChecked=!!u.defaultChecked)}function Sr(a,u,_){if(u.hasOwnProperty("value")||u.hasOwnProperty("defaultValue")){var T=u.type;if(!(T!=="submit"&&T!=="reset"||u.value!==void 0&&u.value!==null))return;u=""+a._wrapperState.initialValue,_||u===a.value||(a.value=u),a.defaultValue=u}_=a.name,_!==""&&(a.name=""),a.defaultChecked=!!a._wrapperState.initialChecked,_!==""&&(a.name=_)}function ci(a,u,_){(u!=="number"||er(a.ownerDocument)!==a)&&(_==null?a.defaultValue=""+a._wrapperState.initialValue:a.defaultValue!==""+_&&(a.defaultValue=""+_))}var Eo=Array.isArray;function Gi(a,u,_,T){if(a=a.options,u){u={};for(var I=0;I<_.length;I++)u["$"+_[I]]=!0;for(_=0;_<a.length;_++)I=u.hasOwnProperty("$"+a[_].value),a[_].selected!==I&&(a[_].selected=I),I&&T&&(a[_].defaultSelected=!0)}else{for(_=""+Nt(_),u=null,I=0;I<a.length;I++){if(a[I].value===_){a[I].selected=!0,T&&(a[I].defaultSelected=!0);return}u!==null||a[I].disabled||(u=a[I])}u!==null&&(u.selected=!0)}}function xl(a,u){if(u.dangerouslySetInnerHTML!=null)throw Error(m(91));return ze({},u,{value:void 0,defaultValue:void 0,children:""+a._wrapperState.initialValue})}function Ws(a,u){var _=u.value;if(_==null){if(_=u.children,u=u.defaultValue,_!=null){if(u!=null)throw Error(m(92));if(Eo(_)){if(1<_.length)throw Error(m(93));_=_[0]}u=_}u==null&&(u=""),_=u}a._wrapperState={initialValue:Nt(_)}}function Vr(a,u){var _=Nt(u.value),T=Nt(u.defaultValue);_!=null&&(_=""+_,_!==a.value&&(a.value=_),u.defaultValue==null&&a.defaultValue!==_&&(a.defaultValue=_)),T!=null&&(a.defaultValue=""+T)}function uu(a){var u=a.textContent;u===a._wrapperState.initialValue&&u!==""&&u!==null&&(a.value=u)}function vi(a){switch(a){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function ni(a,u){return a==null||a==="http://www.w3.org/1999/xhtml"?vi(u):a==="http://www.w3.org/2000/svg"&&u==="foreignObject"?"http://www.w3.org/1999/xhtml":a}var zc,Ll=(function(a){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(u,_,T,I){MSApp.execUnsafeLocalFunction(function(){return a(u,_,T,I)})}:a})(function(a,u){if(a.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in a)a.innerHTML=u;else{for(zc=zc||document.createElement("div"),zc.innerHTML="<svg>"+u.valueOf().toString()+"</svg>",u=zc.firstChild;a.firstChild;)a.removeChild(a.firstChild);for(;u.firstChild;)a.appendChild(u.firstChild)}});function Gs(a,u){if(u){var _=a.firstChild;if(_&&_===a.lastChild&&_.nodeType===3){_.nodeValue=u;return}}a.textContent=u}var Ha={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},hu=["Webkit","ms","Moz","O"];Object.keys(Ha).forEach(function(a){hu.forEach(function(u){u=u+a.charAt(0).toUpperCase()+a.substring(1),Ha[u]=Ha[a]})});function Yc(a,u,_){return u==null||typeof u=="boolean"||u===""?"":_||typeof u!="number"||u===0||Ha.hasOwnProperty(a)&&Ha[a]?(""+u).trim():u+"px"}function Di(a,u){a=a.style;for(var _ in u)if(u.hasOwnProperty(_)){var T=_.indexOf("--")===0,I=Yc(_,u[_],T);_==="float"&&(_="cssFloat"),T?a.setProperty(_,I):a[_]=I}}var pu=ze({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function vo(a,u){if(u){if(pu[a]&&(u.children!=null||u.dangerouslySetInnerHTML!=null))throw Error(m(137,a));if(u.dangerouslySetInnerHTML!=null){if(u.children!=null)throw Error(m(60));if(typeof u.dangerouslySetInnerHTML!="object"||!("__html"in u.dangerouslySetInnerHTML))throw Error(m(61))}if(u.style!=null&&typeof u.style!="object")throw Error(m(62))}}function fu(a,u){if(a.indexOf("-")===-1)return typeof u.is=="string";switch(a){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var yo=null;function qc(a){return a=a.target||a.srcElement||window,a.correspondingUseElement&&(a=a.correspondingUseElement),a.nodeType===3?a.parentNode:a}var Ml=null,Ka=null,So=null;function Hs(a){if(a=Mu(a)){if(typeof Ml!="function")throw Error(m(280));var u=a.stateNode;u&&(u=wp(u),Ml(a.stateNode,a.type,u))}}function za(a){Ka?So?So.push(a):So=[a]:Ka=a}function Xt(){if(Ka){var a=Ka,u=So;if(So=Ka=null,Hs(a),u)for(a=0;a<u.length;a++)Hs(u[a])}}function yn(a,u){return a(u)}function qn(){}var ki=!1;function Hi(a,u,_){if(ki)return a(u,_);ki=!0;try{return yn(a,u,_)}finally{ki=!1,(Ka!==null||So!==null)&&(qn(),Xt())}}function Xn(a,u){var _=a.stateNode;if(_===null)return null;var T=wp(_);if(T===null)return null;_=T[u];e:switch(u){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(T=!T.disabled)||(a=a.type,T=!(a==="button"||a==="input"||a==="select"||a==="textarea")),a=!T;break e;default:a=!1}if(a)return null;if(_&&typeof _!="function")throw Error(m(231,u,typeof _));return _}var Ks=!1;if(k)try{var li={};Object.defineProperty(li,"passive",{get:function(){Ks=!0}}),window.addEventListener("test",li,li),window.removeEventListener("test",li,li)}catch{Ks=!1}function os(a,u,_,T,I,D,q,ce,he){var Oe=Array.prototype.slice.call(arguments,3);try{u.apply(_,Oe)}catch(Ke){this.onError(Ke)}}var Ul=!1,mu=null,_u=!1,Um=null,cv={onError:function(a){Ul=!0,mu=a}};function lv(a,u,_,T,I,D,q,ce,he){Ul=!1,mu=null,os.apply(cv,arguments)}function cw(a,u,_,T,I,D,q,ce,he){if(lv.apply(this,arguments),Ul){if(Ul){var Oe=mu;Ul=!1,mu=null}else throw Error(m(198));_u||(_u=!0,Um=Oe)}}function Xc(a){var u=a,_=a;if(a.alternate)for(;u.return;)u=u.return;else{a=u;do u=a,(u.flags&4098)!==0&&(_=u.return),a=u.return;while(a)}return u.tag===3?_:null}function dv(a){if(a.tag===13){var u=a.memoizedState;if(u===null&&(a=a.alternate,a!==null&&(u=a.memoizedState)),u!==null)return u.dehydrated}return null}function jm(a){if(Xc(a)!==a)throw Error(m(188))}function uv(a){var u=a.alternate;if(!u){if(u=Xc(a),u===null)throw Error(m(188));return u!==a?null:a}for(var _=a,T=u;;){var I=_.return;if(I===null)break;var D=I.alternate;if(D===null){if(T=I.return,T!==null){_=T;continue}break}if(I.child===D.child){for(D=I.child;D;){if(D===_)return jm(I),a;if(D===T)return jm(I),u;D=D.sibling}throw Error(m(188))}if(_.return!==T.return)_=I,T=D;else{for(var q=!1,ce=I.child;ce;){if(ce===_){q=!0,_=I,T=D;break}if(ce===T){q=!0,T=I,_=D;break}ce=ce.sibling}if(!q){for(ce=D.child;ce;){if(ce===_){q=!0,_=D,T=I;break}if(ce===T){q=!0,T=D,_=I;break}ce=ce.sibling}if(!q)throw Error(m(189))}}if(_.alternate!==T)throw Error(m(190))}if(_.tag!==3)throw Error(m(188));return _.stateNode.current===_?a:u}function ip(a){return a=uv(a),a!==null?Vm(a):null}function Vm(a){if(a.tag===5||a.tag===6)return a;for(a=a.child;a!==null;){var u=Vm(a);if(u!==null)return u;a=a.sibling}return null}var Jc=p.unstable_scheduleCallback,hv=p.unstable_cancelCallback,lw=p.unstable_shouldYield,To=p.unstable_requestPaint,Nr=p.unstable_now,dw=p.unstable_getCurrentPriorityLevel,Tr=p.unstable_ImmediatePriority,pv=p.unstable_UserBlockingPriority,sp=p.unstable_NormalPriority,uw=p.unstable_LowPriority,fv=p.unstable_IdlePriority,jl=null,Ro=null;function mv(a){if(Ro&&typeof Ro.onCommitFiberRoot=="function")try{Ro.onCommitFiberRoot(jl,a,void 0,(a.current.flags&128)===128)}catch{}}var zs=Math.clz32?Math.clz32:Vl,hw=Math.log,pw=Math.LN2;function Vl(a){return a>>>=0,a===0?32:31-(hw(a)/pw|0)|0}var Fl=64,op=4194304;function Mn(a){switch(a&-a){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return a&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return a&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return a}}function ap(a,u){var _=a.pendingLanes;if(_===0)return 0;var T=0,I=a.suspendedLanes,D=a.pingedLanes,q=_&268435455;if(q!==0){var ce=q&~I;ce!==0?T=Mn(ce):(D&=q,D!==0&&(T=Mn(D)))}else q=_&~I,q!==0?T=Mn(q):D!==0&&(T=Mn(D));if(T===0)return 0;if(u!==0&&u!==T&&(u&I)===0&&(I=T&-T,D=u&-u,I>=D||I===16&&(D&4194240)!==0))return u;if((T&4)!==0&&(T|=_&16),u=a.entangledLanes,u!==0)for(a=a.entanglements,u&=T;0<u;)_=31-zs(u),I=1<<_,T|=a[_],u&=~I;return T}function _v(a,u){switch(a){case 1:case 2:case 4:return u+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return u+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function gv(a,u){for(var _=a.suspendedLanes,T=a.pingedLanes,I=a.expirationTimes,D=a.pendingLanes;0<D;){var q=31-zs(D),ce=1<<q,he=I[q];he===-1?((ce&_)===0||(ce&T)!==0)&&(I[q]=_v(ce,u)):he<=u&&(a.expiredLanes|=ce),D&=~ce}}function Fm(a){return a=a.pendingLanes&-1073741825,a!==0?a:a&1073741824?1073741824:0}function Ev(){var a=Fl;return Fl<<=1,(Fl&4194240)===0&&(Fl=64),a}function Bm(a){for(var u=[],_=0;31>_;_++)u.push(a);return u}function gu(a,u,_){a.pendingLanes|=u,u!==536870912&&(a.suspendedLanes=0,a.pingedLanes=0),a=a.eventTimes,u=31-zs(u),a[u]=_}function fw(a,u){var _=a.pendingLanes&~u;a.pendingLanes=u,a.suspendedLanes=0,a.pingedLanes=0,a.expiredLanes&=u,a.mutableReadLanes&=u,a.entangledLanes&=u,u=a.entanglements;var T=a.eventTimes;for(a=a.expirationTimes;0<_;){var I=31-zs(_),D=1<<I;u[I]=0,T[I]=-1,a[I]=-1,_&=~D}}function Wm(a,u){var _=a.entangledLanes|=u;for(a=a.entanglements;_;){var T=31-zs(_),I=1<<T;I&u|a[T]&u&&(a[T]|=u),_&=~I}}var Un=0;function Gm(a){return a&=-a,1<a?4<a?(a&268435455)!==0?16:536870912:4:1}var cp,Hm,lp,vv,Km,zm=!1,dp=[],Ya=null,qa=null,Xa=null,Eu=new Map,vu=new Map,Ja=[],yv="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Sv(a,u){switch(a){case"focusin":case"focusout":Ya=null;break;case"dragenter":case"dragleave":qa=null;break;case"mouseover":case"mouseout":Xa=null;break;case"pointerover":case"pointerout":Eu.delete(u.pointerId);break;case"gotpointercapture":case"lostpointercapture":vu.delete(u.pointerId)}}function yu(a,u,_,T,I,D){return a===null||a.nativeEvent!==D?(a={blockedOn:u,domEventName:_,eventSystemFlags:T,nativeEvent:D,targetContainers:[I]},u!==null&&(u=Mu(u),u!==null&&Hm(u)),a):(a.eventSystemFlags|=T,u=a.targetContainers,I!==null&&u.indexOf(I)===-1&&u.push(I),a)}function mw(a,u,_,T,I){switch(u){case"focusin":return Ya=yu(Ya,a,u,_,T,I),!0;case"dragenter":return qa=yu(qa,a,u,_,T,I),!0;case"mouseover":return Xa=yu(Xa,a,u,_,T,I),!0;case"pointerover":var D=I.pointerId;return Eu.set(D,yu(Eu.get(D)||null,a,u,_,T,I)),!0;case"gotpointercapture":return D=I.pointerId,vu.set(D,yu(vu.get(D)||null,a,u,_,T,I)),!0}return!1}function Bl(a){var u=$c(a.target);if(u!==null){var _=Xc(u);if(_!==null){if(u=_.tag,u===13){if(u=dv(_),u!==null){a.blockedOn=u,Km(a.priority,function(){lp(_)});return}}else if(u===3&&_.stateNode.current.memoizedState.isDehydrated){a.blockedOn=_.tag===3?_.stateNode.containerInfo:null;return}}}a.blockedOn=null}function up(a){if(a.blockedOn!==null)return!1;for(var u=a.targetContainers;0<u.length;){var _=Ym(a.domEventName,a.eventSystemFlags,u[0],a.nativeEvent);if(_===null){_=a.nativeEvent;var T=new _.constructor(_.type,_);yo=T,_.target.dispatchEvent(T),yo=null}else return u=Mu(_),u!==null&&Hm(u),a.blockedOn=_,!1;u.shift()}return!0}function Tv(a,u,_){up(a)&&_.delete(u)}function _w(){zm=!1,Ya!==null&&up(Ya)&&(Ya=null),qa!==null&&up(qa)&&(qa=null),Xa!==null&&up(Xa)&&(Xa=null),Eu.forEach(Tv),vu.forEach(Tv)}function Su(a,u){a.blockedOn===u&&(a.blockedOn=null,zm||(zm=!0,p.unstable_scheduleCallback(p.unstable_NormalPriority,_w)))}function Wl(a){function u(I){return Su(I,a)}if(0<dp.length){Su(dp[0],a);for(var _=1;_<dp.length;_++){var T=dp[_];T.blockedOn===a&&(T.blockedOn=null)}}for(Ya!==null&&Su(Ya,a),qa!==null&&Su(qa,a),Xa!==null&&Su(Xa,a),Eu.forEach(u),vu.forEach(u),_=0;_<Ja.length;_++)T=Ja[_],T.blockedOn===a&&(T.blockedOn=null);for(;0<Ja.length&&(_=Ja[0],_.blockedOn===null);)Bl(_),_.blockedOn===null&&Ja.shift()}var Gl=ae.ReactCurrentBatchConfig,hp=!0;function gw(a,u,_,T){var I=Un,D=Gl.transition;Gl.transition=null;try{Un=1,Ki(a,u,_,T)}finally{Un=I,Gl.transition=D}}function Qa(a,u,_,T){var I=Un,D=Gl.transition;Gl.transition=null;try{Un=4,Ki(a,u,_,T)}finally{Un=I,Gl.transition=D}}function Ki(a,u,_,T){if(hp){var I=Ym(a,u,_,T);if(I===null)p_(a,u,T,Tu,_),Sv(a,T);else if(mw(I,a,u,_,T))T.stopPropagation();else if(Sv(a,T),u&4&&-1<yv.indexOf(a)){for(;I!==null;){var D=Mu(I);if(D!==null&&cp(D),D=Ym(a,u,_,T),D===null&&p_(a,u,T,Tu,_),D===I)break;I=D}I!==null&&T.stopPropagation()}else p_(a,u,T,null,_)}}var Tu=null;function Ym(a,u,_,T){if(Tu=null,a=qc(T),a=$c(a),a!==null)if(u=Xc(a),u===null)a=null;else if(_=u.tag,_===13){if(a=dv(u),a!==null)return a;a=null}else if(_===3){if(u.stateNode.current.memoizedState.isDehydrated)return u.tag===3?u.stateNode.containerInfo:null;a=null}else u!==a&&(a=null);return Tu=a,null}function Rv(a){switch(a){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(dw()){case Tr:return 1;case pv:return 4;case sp:case uw:return 16;case fv:return 536870912;default:return 16}default:return 16}}var Za=null,di=null,pp=null;function wv(){if(pp)return pp;var a,u=di,_=u.length,T,I="value"in Za?Za.value:Za.textContent,D=I.length;for(a=0;a<_&&u[a]===I[a];a++);var q=_-a;for(T=1;T<=q&&u[_-T]===I[D-T];T++);return pp=I.slice(a,1<T?1-T:void 0)}function fp(a){var u=a.keyCode;return"charCode"in a?(a=a.charCode,a===0&&u===13&&(a=13)):a=u,a===10&&(a=13),32<=a||a===13?a:0}function Qc(){return!0}function qm(){return!1}function as(a){function u(_,T,I,D,q){this._reactName=_,this._targetInst=I,this.type=T,this.nativeEvent=D,this.target=q,this.currentTarget=null;for(var ce in a)a.hasOwnProperty(ce)&&(_=a[ce],this[ce]=_?_(D):D[ce]);return this.isDefaultPrevented=(D.defaultPrevented!=null?D.defaultPrevented:D.returnValue===!1)?Qc:qm,this.isPropagationStopped=qm,this}return ze(u.prototype,{preventDefault:function(){this.defaultPrevented=!0;var _=this.nativeEvent;_&&(_.preventDefault?_.preventDefault():typeof _.returnValue!="unknown"&&(_.returnValue=!1),this.isDefaultPrevented=Qc)},stopPropagation:function(){var _=this.nativeEvent;_&&(_.stopPropagation?_.stopPropagation():typeof _.cancelBubble!="unknown"&&(_.cancelBubble=!0),this.isPropagationStopped=Qc)},persist:function(){},isPersistent:Qc}),u}var $a={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(a){return a.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Xm=as($a),Zc=ze({},$a,{view:0,detail:0}),Jm=as(Zc),Ru,Qm,wu,wo=ze({},Zc,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:$m,button:0,buttons:0,relatedTarget:function(a){return a.relatedTarget===void 0?a.fromElement===a.srcElement?a.toElement:a.fromElement:a.relatedTarget},movementX:function(a){return"movementX"in a?a.movementX:(a!==wu&&(wu&&a.type==="mousemove"?(Ru=a.screenX-wu.screenX,Qm=a.screenY-wu.screenY):Qm=Ru=0,wu=a),Ru)},movementY:function(a){return"movementY"in a?a.movementY:Qm}}),Hl=as(wo),Ew=ze({},wo,{dataTransfer:0}),vw=as(Ew),yw=ze({},Zc,{relatedTarget:0}),Zm=as(yw),Sw=ze({},$a,{animationName:0,elapsedTime:0,pseudoElement:0}),Kl=as(Sw),Tw=ze({},$a,{clipboardData:function(a){return"clipboardData"in a?a.clipboardData:window.clipboardData}}),zl=as(Tw),Cv=ze({},$a,{data:0}),bv=as(Cv),Zt={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Rw={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},ww={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Cw(a){var u=this.nativeEvent;return u.getModifierState?u.getModifierState(a):(a=ww[a])?!!u[a]:!1}function $m(){return Cw}var e_=ze({},Zc,{key:function(a){if(a.key){var u=Zt[a.key]||a.key;if(u!=="Unidentified")return u}return a.type==="keypress"?(a=fp(a),a===13?"Enter":String.fromCharCode(a)):a.type==="keydown"||a.type==="keyup"?Rw[a.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:$m,charCode:function(a){return a.type==="keypress"?fp(a):0},keyCode:function(a){return a.type==="keydown"||a.type==="keyup"?a.keyCode:0},which:function(a){return a.type==="keypress"?fp(a):a.type==="keydown"||a.type==="keyup"?a.keyCode:0}}),bw=as(e_),Iw=ze({},wo,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Iv=as(Iw),t_=ze({},Zc,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:$m}),Aw=as(t_),Nw=ze({},$a,{propertyName:0,elapsedTime:0,pseudoElement:0}),Av=as(Nw),Ow=ze({},wo,{deltaX:function(a){return"deltaX"in a?a.deltaX:"wheelDeltaX"in a?-a.wheelDeltaX:0},deltaY:function(a){return"deltaY"in a?a.deltaY:"wheelDeltaY"in a?-a.wheelDeltaY:"wheelDelta"in a?-a.wheelDelta:0},deltaZ:0,deltaMode:0}),ec=as(Ow),Pw=[9,13,27,32],n_=k&&"CompositionEvent"in window,Cu=null;k&&"documentMode"in document&&(Cu=document.documentMode);var Nv=k&&"TextEvent"in window&&!Cu,mp=k&&(!n_||Cu&&8<Cu&&11>=Cu),Ov=" ",Pv=!1;function Dv(a,u){switch(a){case"keyup":return Pw.indexOf(u.keyCode)!==-1;case"keydown":return u.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function cs(a){return a=a.detail,typeof a=="object"&&"data"in a?a.data:null}var Yl=!1;function Dw(a,u){switch(a){case"compositionend":return cs(u);case"keypress":return u.which!==32?null:(Pv=!0,Ov);case"textInput":return a=u.data,a===Ov&&Pv?null:a;default:return null}}function kw(a,u){if(Yl)return a==="compositionend"||!n_&&Dv(a,u)?(a=wv(),pp=di=Za=null,Yl=!1,a):null;switch(a){case"paste":return null;case"keypress":if(!(u.ctrlKey||u.altKey||u.metaKey)||u.ctrlKey&&u.altKey){if(u.char&&1<u.char.length)return u.char;if(u.which)return String.fromCharCode(u.which)}return null;case"compositionend":return mp&&u.locale!=="ko"?null:u.data;default:return null}}var xw={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function r_(a){var u=a&&a.nodeName&&a.nodeName.toLowerCase();return u==="input"?!!xw[a.type]:u==="textarea"}function kv(a,u,_,T){za(T),u=Du(u,"onChange"),0<u.length&&(_=new Xm("onChange","change",null,_,T),a.push({event:_,listeners:u}))}var bu=null,ql=null;function i_(a){Hv(a,0)}function _p(a){var u=td(a);if(Yn(u))return a}function Lw(a,u){if(a==="change")return u}var Iu=!1;if(k){var s_;if(k){var o_="oninput"in document;if(!o_){var xv=document.createElement("div");xv.setAttribute("oninput","return;"),o_=typeof xv.oninput=="function"}s_=o_}else s_=!1;Iu=s_&&(!document.documentMode||9<document.documentMode)}function na(){bu&&(bu.detachEvent("onpropertychange",Lv),ql=bu=null)}function Lv(a){if(a.propertyName==="value"&&_p(ql)){var u=[];kv(u,ql,a,qc(a)),Hi(i_,u)}}function Mw(a,u,_){a==="focusin"?(na(),bu=u,ql=_,bu.attachEvent("onpropertychange",Lv)):a==="focusout"&&na()}function zi(a){if(a==="selectionchange"||a==="keyup"||a==="keydown")return _p(ql)}function Uw(a,u){if(a==="click")return _p(u)}function jw(a,u){if(a==="input"||a==="change")return _p(u)}function Vw(a,u){return a===u&&(a!==0||1/a===1/u)||a!==a&&u!==u}var Ys=typeof Object.is=="function"?Object.is:Vw;function Xl(a,u){if(Ys(a,u))return!0;if(typeof a!="object"||a===null||typeof u!="object"||u===null)return!1;var _=Object.keys(a),T=Object.keys(u);if(_.length!==T.length)return!1;for(T=0;T<_.length;T++){var I=_[T];if(!M.call(u,I)||!Ys(a[I],u[I]))return!1}return!0}function Mv(a){for(;a&&a.firstChild;)a=a.firstChild;return a}function Uv(a,u){var _=Mv(a);a=0;for(var T;_;){if(_.nodeType===3){if(T=a+_.textContent.length,a<=u&&T>=u)return{node:_,offset:u-a};a=T}e:{for(;_;){if(_.nextSibling){_=_.nextSibling;break e}_=_.parentNode}_=void 0}_=Mv(_)}}function jv(a,u){return a&&u?a===u?!0:a&&a.nodeType===3?!1:u&&u.nodeType===3?jv(a,u.parentNode):"contains"in a?a.contains(u):a.compareDocumentPosition?!!(a.compareDocumentPosition(u)&16):!1:!1}function a_(){for(var a=window,u=er();u instanceof a.HTMLIFrameElement;){try{var _=typeof u.contentWindow.location.href=="string"}catch{_=!1}if(_)a=u.contentWindow;else break;u=er(a.document)}return u}function c_(a){var u=a&&a.nodeName&&a.nodeName.toLowerCase();return u&&(u==="input"&&(a.type==="text"||a.type==="search"||a.type==="tel"||a.type==="url"||a.type==="password")||u==="textarea"||a.contentEditable==="true")}function Fw(a){var u=a_(),_=a.focusedElem,T=a.selectionRange;if(u!==_&&_&&_.ownerDocument&&jv(_.ownerDocument.documentElement,_)){if(T!==null&&c_(_)){if(u=T.start,a=T.end,a===void 0&&(a=u),"selectionStart"in _)_.selectionStart=u,_.selectionEnd=Math.min(a,_.value.length);else if(a=(u=_.ownerDocument||document)&&u.defaultView||window,a.getSelection){a=a.getSelection();var I=_.textContent.length,D=Math.min(T.start,I);T=T.end===void 0?D:Math.min(T.end,I),!a.extend&&D>T&&(I=T,T=D,D=I),I=Uv(_,D);var q=Uv(_,T);I&&q&&(a.rangeCount!==1||a.anchorNode!==I.node||a.anchorOffset!==I.offset||a.focusNode!==q.node||a.focusOffset!==q.offset)&&(u=u.createRange(),u.setStart(I.node,I.offset),a.removeAllRanges(),D>T?(a.addRange(u),a.extend(q.node,q.offset)):(u.setEnd(q.node,q.offset),a.addRange(u)))}}for(u=[],a=_;a=a.parentNode;)a.nodeType===1&&u.push({element:a,left:a.scrollLeft,top:a.scrollTop});for(typeof _.focus=="function"&&_.focus(),_=0;_<u.length;_++)a=u[_],a.element.scrollLeft=a.left,a.element.scrollTop=a.top}}var l_=k&&"documentMode"in document&&11>=document.documentMode,tc=null,d_=null,be=null,u_=!1;function Vv(a,u,_){var T=_.window===_?_.document:_.nodeType===9?_:_.ownerDocument;u_||tc==null||tc!==er(T)||(T=tc,"selectionStart"in T&&c_(T)?T={start:T.selectionStart,end:T.selectionEnd}:(T=(T.ownerDocument&&T.ownerDocument.defaultView||window).getSelection(),T={anchorNode:T.anchorNode,anchorOffset:T.anchorOffset,focusNode:T.focusNode,focusOffset:T.focusOffset}),be&&Xl(be,T)||(be=T,T=Du(d_,"onSelect"),0<T.length&&(u=new Xm("onSelect","select",null,u,_),a.push({event:u,listeners:T}),u.target=tc)))}function gp(a,u){var _={};return _[a.toLowerCase()]=u.toLowerCase(),_["Webkit"+a]="webkit"+u,_["Moz"+a]="moz"+u,_}var Jl={animationend:gp("Animation","AnimationEnd"),animationiteration:gp("Animation","AnimationIteration"),animationstart:gp("Animation","AnimationStart"),transitionend:gp("Transition","TransitionEnd")},Ep={},h_={};k&&(h_=document.createElement("div").style,"AnimationEvent"in window||(delete Jl.animationend.animation,delete Jl.animationiteration.animation,delete Jl.animationstart.animation),"TransitionEvent"in window||delete Jl.transitionend.transition);function vp(a){if(Ep[a])return Ep[a];if(!Jl[a])return a;var u=Jl[a],_;for(_ in u)if(u.hasOwnProperty(_)&&_ in h_)return Ep[a]=u[_];return a}var Fv=vp("animationend"),Bv=vp("animationiteration"),Au=vp("animationstart"),Ql=vp("transitionend"),Wv=new Map,Gv="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function qs(a,u){Wv.set(a,u),C(u,[a])}for(var Nu=0;Nu<Gv.length;Nu++){var Zl=Gv[Nu],Bw=Zl.toLowerCase(),Ww=Zl[0].toUpperCase()+Zl.slice(1);qs(Bw,"on"+Ww)}qs(Fv,"onAnimationEnd"),qs(Bv,"onAnimationIteration"),qs(Au,"onAnimationStart"),qs("dblclick","onDoubleClick"),qs("focusin","onFocus"),qs("focusout","onBlur"),qs(Ql,"onTransitionEnd"),P("onMouseEnter",["mouseout","mouseover"]),P("onMouseLeave",["mouseout","mouseover"]),P("onPointerEnter",["pointerout","pointerover"]),P("onPointerLeave",["pointerout","pointerover"]),C("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),C("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),C("onBeforeInput",["compositionend","keypress","textInput","paste"]),C("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),C("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),C("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Ou="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Gw=new Set("cancel close invalid load scroll toggle".split(" ").concat(Ou));function yp(a,u,_){var T=a.type||"unknown-event";a.currentTarget=_,cw(T,u,void 0,a),a.currentTarget=null}function Hv(a,u){u=(u&4)!==0;for(var _=0;_<a.length;_++){var T=a[_],I=T.event;T=T.listeners;e:{var D=void 0;if(u)for(var q=T.length-1;0<=q;q--){var ce=T[q],he=ce.instance,Oe=ce.currentTarget;if(ce=ce.listener,he!==D&&I.isPropagationStopped())break e;yp(I,ce,Oe),D=he}else for(q=0;q<T.length;q++){if(ce=T[q],he=ce.instance,Oe=ce.currentTarget,ce=ce.listener,he!==D&&I.isPropagationStopped())break e;yp(I,ce,Oe),D=he}}}if(_u)throw a=Um,_u=!1,Um=null,a}function tr(a,u){var _=u[g_];_===void 0&&(_=u[g_]=new Set);var T=a+"__bubble";_.has(T)||(Kv(u,a,2,!1),_.add(T))}function Yi(a,u,_){var T=0;u&&(T|=4),Kv(_,a,T,u)}var Sp="_reactListening"+Math.random().toString(36).slice(2);function ra(a){if(!a[Sp]){a[Sp]=!0,y.forEach(function(_){_!=="selectionchange"&&(Gw.has(_)||Yi(_,!1,a),Yi(_,!0,a))});var u=a.nodeType===9?a:a.ownerDocument;u===null||u[Sp]||(u[Sp]=!0,Yi("selectionchange",!1,u))}}function Kv(a,u,_,T){switch(Rv(u)){case 1:var I=gw;break;case 4:I=Qa;break;default:I=Ki}_=I.bind(null,u,_,a),I=void 0,!Ks||u!=="touchstart"&&u!=="touchmove"&&u!=="wheel"||(I=!0),T?I!==void 0?a.addEventListener(u,_,{capture:!0,passive:I}):a.addEventListener(u,_,!0):I!==void 0?a.addEventListener(u,_,{passive:I}):a.addEventListener(u,_,!1)}function p_(a,u,_,T,I){var D=T;if((u&1)===0&&(u&2)===0&&T!==null)e:for(;;){if(T===null)return;var q=T.tag;if(q===3||q===4){var ce=T.stateNode.containerInfo;if(ce===I||ce.nodeType===8&&ce.parentNode===I)break;if(q===4)for(q=T.return;q!==null;){var he=q.tag;if((he===3||he===4)&&(he=q.stateNode.containerInfo,he===I||he.nodeType===8&&he.parentNode===I))return;q=q.return}for(;ce!==null;){if(q=$c(ce),q===null)return;if(he=q.tag,he===5||he===6){T=D=q;continue e}ce=ce.parentNode}}T=T.return}Hi(function(){var Oe=D,Ke=qc(_),qe=[];e:{var He=Wv.get(a);if(He!==void 0){var ft=Xm,yt=a;switch(a){case"keypress":if(fp(_)===0)break e;case"keydown":case"keyup":ft=bw;break;case"focusin":yt="focus",ft=Zm;break;case"focusout":yt="blur",ft=Zm;break;case"beforeblur":case"afterblur":ft=Zm;break;case"click":if(_.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":ft=Hl;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":ft=vw;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":ft=Aw;break;case Fv:case Bv:case Au:ft=Kl;break;case Ql:ft=Av;break;case"scroll":ft=Jm;break;case"wheel":ft=ec;break;case"copy":case"cut":case"paste":ft=zl;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":ft=Iv}var Tt=(u&4)!==0,gr=!Tt&&a==="scroll",ye=Tt?He!==null?He+"Capture":null:He;Tt=[];for(var me=Oe,Ie;me!==null;){Ie=me;var Qe=Ie.stateNode;if(Ie.tag===5&&Qe!==null&&(Ie=Qe,ye!==null&&(Qe=Xn(me,ye),Qe!=null&&Tt.push(Pu(me,Qe,Ie)))),gr)break;me=me.return}0<Tt.length&&(He=new ft(He,yt,null,_,Ke),qe.push({event:He,listeners:Tt}))}}if((u&7)===0){e:{if(He=a==="mouseover"||a==="pointerover",ft=a==="mouseout"||a==="pointerout",He&&_!==yo&&(yt=_.relatedTarget||_.fromElement)&&($c(yt)||yt[ia]))break e;if((ft||He)&&(He=Ke.window===Ke?Ke:(He=Ke.ownerDocument)?He.defaultView||He.parentWindow:window,ft?(yt=_.relatedTarget||_.toElement,ft=Oe,yt=yt?$c(yt):null,yt!==null&&(gr=Xc(yt),yt!==gr||yt.tag!==5&&yt.tag!==6)&&(yt=null)):(ft=null,yt=Oe),ft!==yt)){if(Tt=Hl,Qe="onMouseLeave",ye="onMouseEnter",me="mouse",(a==="pointerout"||a==="pointerover")&&(Tt=Iv,Qe="onPointerLeave",ye="onPointerEnter",me="pointer"),gr=ft==null?He:td(ft),Ie=yt==null?He:td(yt),He=new Tt(Qe,me+"leave",ft,_,Ke),He.target=gr,He.relatedTarget=Ie,Qe=null,$c(Ke)===Oe&&(Tt=new Tt(ye,me+"enter",yt,_,Ke),Tt.target=Ie,Tt.relatedTarget=gr,Qe=Tt),gr=Qe,ft&&yt)t:{for(Tt=ft,ye=yt,me=0,Ie=Tt;Ie;Ie=$l(Ie))me++;for(Ie=0,Qe=ye;Qe;Qe=$l(Qe))Ie++;for(;0<me-Ie;)Tt=$l(Tt),me--;for(;0<Ie-me;)ye=$l(ye),Ie--;for(;me--;){if(Tt===ye||ye!==null&&Tt===ye.alternate)break t;Tt=$l(Tt),ye=$l(ye)}Tt=null}else Tt=null;ft!==null&&zv(qe,He,ft,Tt,!1),yt!==null&&gr!==null&&zv(qe,gr,yt,Tt,!0)}}e:{if(He=Oe?td(Oe):window,ft=He.nodeName&&He.nodeName.toLowerCase(),ft==="select"||ft==="input"&&He.type==="file")var Rt=Lw;else if(r_(He))if(Iu)Rt=jw;else{Rt=zi;var kt=Mw}else(ft=He.nodeName)&&ft.toLowerCase()==="input"&&(He.type==="checkbox"||He.type==="radio")&&(Rt=Uw);if(Rt&&(Rt=Rt(a,Oe))){kv(qe,Rt,_,Ke);break e}kt&&kt(a,He,Oe),a==="focusout"&&(kt=He._wrapperState)&&kt.controlled&&He.type==="number"&&ci(He,"number",He.value)}switch(kt=Oe?td(Oe):window,a){case"focusin":(r_(kt)||kt.contentEditable==="true")&&(tc=kt,d_=Oe,be=null);break;case"focusout":be=d_=tc=null;break;case"mousedown":u_=!0;break;case"contextmenu":case"mouseup":case"dragend":u_=!1,Vv(qe,_,Ke);break;case"selectionchange":if(l_)break;case"keydown":case"keyup":Vv(qe,_,Ke)}var xt;if(n_)e:{switch(a){case"compositionstart":var Vt="onCompositionStart";break e;case"compositionend":Vt="onCompositionEnd";break e;case"compositionupdate":Vt="onCompositionUpdate";break e}Vt=void 0}else Yl?Dv(a,_)&&(Vt="onCompositionEnd"):a==="keydown"&&_.keyCode===229&&(Vt="onCompositionStart");Vt&&(mp&&_.locale!=="ko"&&(Yl||Vt!=="onCompositionStart"?Vt==="onCompositionEnd"&&Yl&&(xt=wv()):(Za=Ke,di="value"in Za?Za.value:Za.textContent,Yl=!0)),kt=Du(Oe,Vt),0<kt.length&&(Vt=new bv(Vt,a,null,_,Ke),qe.push({event:Vt,listeners:kt}),xt?Vt.data=xt:(xt=cs(_),xt!==null&&(Vt.data=xt)))),(xt=Nv?Dw(a,_):kw(a,_))&&(Oe=Du(Oe,"onBeforeInput"),0<Oe.length&&(Ke=new bv("onBeforeInput","beforeinput",null,_,Ke),qe.push({event:Ke,listeners:Oe}),Ke.data=xt))}Hv(qe,u)})}function Pu(a,u,_){return{instance:a,listener:u,currentTarget:_}}function Du(a,u){for(var _=u+"Capture",T=[];a!==null;){var I=a,D=I.stateNode;I.tag===5&&D!==null&&(I=D,D=Xn(a,_),D!=null&&T.unshift(Pu(a,D,I)),D=Xn(a,u),D!=null&&T.push(Pu(a,D,I))),a=a.return}return T}function $l(a){if(a===null)return null;do a=a.return;while(a&&a.tag!==5);return a||null}function zv(a,u,_,T,I){for(var D=u._reactName,q=[];_!==null&&_!==T;){var ce=_,he=ce.alternate,Oe=ce.stateNode;if(he!==null&&he===T)break;ce.tag===5&&Oe!==null&&(ce=Oe,I?(he=Xn(_,D),he!=null&&q.unshift(Pu(_,he,ce))):I||(he=Xn(_,D),he!=null&&q.push(Pu(_,he,ce)))),_=_.return}q.length!==0&&a.push({event:u,listeners:q})}var Hw=/\r\n?/g,f_=/\u0000|\uFFFD/g;function Yv(a){return(typeof a=="string"?a:""+a).replace(Hw,`
`).replace(f_,"")}function ku(a,u,_){if(u=Yv(u),Yv(a)!==u&&_)throw Error(m(425))}function xu(){}var m_=null,Tp=null;function ed(a,u){return a==="textarea"||a==="noscript"||typeof u.children=="string"||typeof u.children=="number"||typeof u.dangerouslySetInnerHTML=="object"&&u.dangerouslySetInnerHTML!==null&&u.dangerouslySetInnerHTML.__html!=null}var __=typeof setTimeout=="function"?setTimeout:void 0,Kw=typeof clearTimeout=="function"?clearTimeout:void 0,qv=typeof Promise=="function"?Promise:void 0,zw=typeof queueMicrotask=="function"?queueMicrotask:typeof qv<"u"?function(a){return qv.resolve(null).then(a).catch(Yw)}:__;function Yw(a){setTimeout(function(){throw a})}function Rp(a,u){var _=u,T=0;do{var I=_.nextSibling;if(a.removeChild(_),I&&I.nodeType===8)if(_=I.data,_==="/$"){if(T===0){a.removeChild(I),Wl(u);return}T--}else _!=="$"&&_!=="$?"&&_!=="$!"||T++;_=I}while(_);Wl(u)}function Co(a){for(;a!=null;a=a.nextSibling){var u=a.nodeType;if(u===1||u===3)break;if(u===8){if(u=a.data,u==="$"||u==="$!"||u==="$?")break;if(u==="/$")return null}}return a}function Xv(a){a=a.previousSibling;for(var u=0;a;){if(a.nodeType===8){var _=a.data;if(_==="$"||_==="$!"||_==="$?"){if(u===0)return a;u--}else _==="/$"&&u++}a=a.previousSibling}return null}var nc=Math.random().toString(36).slice(2),bo="__reactFiber$"+nc,Lu="__reactProps$"+nc,ia="__reactContainer$"+nc,g_="__reactEvents$"+nc,qw="__reactListeners$"+nc,Xw="__reactHandles$"+nc;function $c(a){var u=a[bo];if(u)return u;for(var _=a.parentNode;_;){if(u=_[ia]||_[bo]){if(_=u.alternate,u.child!==null||_!==null&&_.child!==null)for(a=Xv(a);a!==null;){if(_=a[bo])return _;a=Xv(a)}return u}a=_,_=a.parentNode}return null}function Mu(a){return a=a[bo]||a[ia],!a||a.tag!==5&&a.tag!==6&&a.tag!==13&&a.tag!==3?null:a}function td(a){if(a.tag===5||a.tag===6)return a.stateNode;throw Error(m(33))}function wp(a){return a[Lu]||null}var E_=[],sa=-1;function Xs(a){return{current:a}}function Jn(a){0>sa||(a.current=E_[sa],E_[sa]=null,sa--)}function nr(a,u){sa++,E_[sa]=a.current,a.current=u}var rc={},yi=Xs(rc),xi=Xs(!1),ic=rc;function sc(a,u){var _=a.type.contextTypes;if(!_)return rc;var T=a.stateNode;if(T&&T.__reactInternalMemoizedUnmaskedChildContext===u)return T.__reactInternalMemoizedMaskedChildContext;var I={},D;for(D in _)I[D]=u[D];return T&&(a=a.stateNode,a.__reactInternalMemoizedUnmaskedChildContext=u,a.__reactInternalMemoizedMaskedChildContext=I),I}function qi(a){return a=a.childContextTypes,a!=null}function Cp(){Jn(xi),Jn(yi)}function nd(a,u,_){if(yi.current!==rc)throw Error(m(168));nr(yi,u),nr(xi,_)}function Jv(a,u,_){var T=a.stateNode;if(u=u.childContextTypes,typeof T.getChildContext!="function")return _;T=T.getChildContext();for(var I in T)if(!(I in u))throw Error(m(108,Ye(a)||"Unknown",I));return ze({},_,T)}function bp(a){return a=(a=a.stateNode)&&a.__reactInternalMemoizedMergedChildContext||rc,ic=yi.current,nr(yi,a),nr(xi,xi.current),!0}function Qv(a,u,_){var T=a.stateNode;if(!T)throw Error(m(169));_?(a=Jv(a,u,ic),T.__reactInternalMemoizedMergedChildContext=a,Jn(xi),Jn(yi),nr(yi,a)):Jn(xi),nr(xi,_)}var oa=null,Ip=!1,v_=!1;function y_(a){oa===null?oa=[a]:oa.push(a)}function Jw(a){Ip=!0,y_(a)}function oc(){if(!v_&&oa!==null){v_=!0;var a=0,u=Un;try{var _=oa;for(Un=1;a<_.length;a++){var T=_[a];do T=T(!0);while(T!==null)}oa=null,Ip=!1}catch(I){throw oa!==null&&(oa=oa.slice(a+1)),Jc(Tr,oc),I}finally{Un=u,v_=!1}}return null}var rd=[],ac=0,Ap=null,Np=0,Li=[],ys=0,el=null,aa=1,ca="";function tl(a,u){rd[ac++]=Np,rd[ac++]=Ap,Ap=a,Np=u}function Zv(a,u,_){Li[ys++]=aa,Li[ys++]=ca,Li[ys++]=el,el=a;var T=aa;a=ca;var I=32-zs(T)-1;T&=~(1<<I),_+=1;var D=32-zs(u)+I;if(30<D){var q=I-I%5;D=(T&(1<<q)-1).toString(32),T>>=q,I-=q,aa=1<<32-zs(u)+I|_<<I|T,ca=D+a}else aa=1<<D|_<<I|T,ca=a}function id(a){a.return!==null&&(tl(a,1),Zv(a,1,0))}function Op(a){for(;a===Ap;)Ap=rd[--ac],rd[ac]=null,Np=rd[--ac],rd[ac]=null;for(;a===el;)el=Li[--ys],Li[ys]=null,ca=Li[--ys],Li[ys]=null,aa=Li[--ys],Li[ys]=null}var ls=null,ds=null,ar=!1,Js=null;function $v(a,u){var _=Cs(5,null,null,0);_.elementType="DELETED",_.stateNode=u,_.return=a,u=a.deletions,u===null?(a.deletions=[_],a.flags|=16):u.push(_)}function ey(a,u){switch(a.tag){case 5:var _=a.type;return u=u.nodeType!==1||_.toLowerCase()!==u.nodeName.toLowerCase()?null:u,u!==null?(a.stateNode=u,ls=a,ds=Co(u.firstChild),!0):!1;case 6:return u=a.pendingProps===""||u.nodeType!==3?null:u,u!==null?(a.stateNode=u,ls=a,ds=null,!0):!1;case 13:return u=u.nodeType!==8?null:u,u!==null?(_=el!==null?{id:aa,overflow:ca}:null,a.memoizedState={dehydrated:u,treeContext:_,retryLane:1073741824},_=Cs(18,null,null,0),_.stateNode=u,_.return=a,a.child=_,ls=a,ds=null,!0):!1;default:return!1}}function Uu(a){return(a.mode&1)!==0&&(a.flags&128)===0}function ju(a){if(ar){var u=ds;if(u){var _=u;if(!ey(a,u)){if(Uu(a))throw Error(m(418));u=Co(_.nextSibling);var T=ls;u&&ey(a,u)?$v(T,_):(a.flags=a.flags&-4097|2,ar=!1,ls=a)}}else{if(Uu(a))throw Error(m(418));a.flags=a.flags&-4097|2,ar=!1,ls=a}}}function S_(a){for(a=a.return;a!==null&&a.tag!==5&&a.tag!==3&&a.tag!==13;)a=a.return;ls=a}function sd(a){if(a!==ls)return!1;if(!ar)return S_(a),ar=!0,!1;var u;if((u=a.tag!==3)&&!(u=a.tag!==5)&&(u=a.type,u=u!=="head"&&u!=="body"&&!ed(a.type,a.memoizedProps)),u&&(u=ds)){if(Uu(a))throw T_(),Error(m(418));for(;u;)$v(a,u),u=Co(u.nextSibling)}if(S_(a),a.tag===13){if(a=a.memoizedState,a=a!==null?a.dehydrated:null,!a)throw Error(m(317));e:{for(a=a.nextSibling,u=0;a;){if(a.nodeType===8){var _=a.data;if(_==="/$"){if(u===0){ds=Co(a.nextSibling);break e}u--}else _!=="$"&&_!=="$!"&&_!=="$?"||u++}a=a.nextSibling}ds=null}}else ds=ls?Co(a.stateNode.nextSibling):null;return!0}function T_(){for(var a=ds;a;)a=Co(a.nextSibling)}function nl(){ds=ls=null,ar=!1}function od(a){Js===null?Js=[a]:Js.push(a)}var Vu=ae.ReactCurrentBatchConfig;function Fu(a,u,_){if(a=_.ref,a!==null&&typeof a!="function"&&typeof a!="object"){if(_._owner){if(_=_._owner,_){if(_.tag!==1)throw Error(m(309));var T=_.stateNode}if(!T)throw Error(m(147,a));var I=T,D=""+a;return u!==null&&u.ref!==null&&typeof u.ref=="function"&&u.ref._stringRef===D?u.ref:(u=function(q){var ce=I.refs;q===null?delete ce[D]:ce[D]=q},u._stringRef=D,u)}if(typeof a!="string")throw Error(m(284));if(!_._owner)throw Error(m(290,a))}return a}function Pp(a,u){throw a=Object.prototype.toString.call(u),Error(m(31,a==="[object Object]"?"object with keys {"+Object.keys(u).join(", ")+"}":a))}function R_(a){var u=a._init;return u(a._payload)}function ty(a){function u(ye,me){if(a){var Ie=ye.deletions;Ie===null?(ye.deletions=[me],ye.flags|=16):Ie.push(me)}}function _(ye,me){if(!a)return null;for(;me!==null;)u(ye,me),me=me.sibling;return null}function T(ye,me){for(ye=new Map;me!==null;)me.key!==null?ye.set(me.key,me):ye.set(me.index,me),me=me.sibling;return ye}function I(ye,me){return ye=vc(ye,me),ye.index=0,ye.sibling=null,ye}function D(ye,me,Ie){return ye.index=Ie,a?(Ie=ye.alternate,Ie!==null?(Ie=Ie.index,Ie<me?(ye.flags|=2,me):Ie):(ye.flags|=2,me)):(ye.flags|=1048576,me)}function q(ye){return a&&ye.alternate===null&&(ye.flags|=2),ye}function ce(ye,me,Ie,Qe){return me===null||me.tag!==6?(me=cf(Ie,ye.mode,Qe),me.return=ye,me):(me=I(me,Ie),me.return=ye,me)}function he(ye,me,Ie,Qe){var Rt=Ie.type;return Rt===Te?Ke(ye,me,Ie.props.children,Qe,Ie.key):me!==null&&(me.elementType===Rt||typeof Rt=="object"&&Rt!==null&&Rt.$$typeof===rt&&R_(Rt)===me.type)?(Qe=I(me,Ie.props),Qe.ref=Fu(ye,me,Ie),Qe.return=ye,Qe):(Qe=Ed(Ie.type,Ie.key,Ie.props,null,ye.mode,Qe),Qe.ref=Fu(ye,me,Ie),Qe.return=ye,Qe)}function Oe(ye,me,Ie,Qe){return me===null||me.tag!==4||me.stateNode.containerInfo!==Ie.containerInfo||me.stateNode.implementation!==Ie.implementation?(me=vd(Ie,ye.mode,Qe),me.return=ye,me):(me=I(me,Ie.children||[]),me.return=ye,me)}function Ke(ye,me,Ie,Qe,Rt){return me===null||me.tag!==7?(me=yc(Ie,ye.mode,Qe,Rt),me.return=ye,me):(me=I(me,Ie),me.return=ye,me)}function qe(ye,me,Ie){if(typeof me=="string"&&me!==""||typeof me=="number")return me=cf(""+me,ye.mode,Ie),me.return=ye,me;if(typeof me=="object"&&me!==null){switch(me.$$typeof){case pe:return Ie=Ed(me.type,me.key,me.props,null,ye.mode,Ie),Ie.ref=Fu(ye,null,me),Ie.return=ye,Ie;case Se:return me=vd(me,ye.mode,Ie),me.return=ye,me;case rt:var Qe=me._init;return qe(ye,Qe(me._payload),Ie)}if(Eo(me)||Le(me))return me=yc(me,ye.mode,Ie,null),me.return=ye,me;Pp(ye,me)}return null}function He(ye,me,Ie,Qe){var Rt=me!==null?me.key:null;if(typeof Ie=="string"&&Ie!==""||typeof Ie=="number")return Rt!==null?null:ce(ye,me,""+Ie,Qe);if(typeof Ie=="object"&&Ie!==null){switch(Ie.$$typeof){case pe:return Ie.key===Rt?he(ye,me,Ie,Qe):null;case Se:return Ie.key===Rt?Oe(ye,me,Ie,Qe):null;case rt:return Rt=Ie._init,He(ye,me,Rt(Ie._payload),Qe)}if(Eo(Ie)||Le(Ie))return Rt!==null?null:Ke(ye,me,Ie,Qe,null);Pp(ye,Ie)}return null}function ft(ye,me,Ie,Qe,Rt){if(typeof Qe=="string"&&Qe!==""||typeof Qe=="number")return ye=ye.get(Ie)||null,ce(me,ye,""+Qe,Rt);if(typeof Qe=="object"&&Qe!==null){switch(Qe.$$typeof){case pe:return ye=ye.get(Qe.key===null?Ie:Qe.key)||null,he(me,ye,Qe,Rt);case Se:return ye=ye.get(Qe.key===null?Ie:Qe.key)||null,Oe(me,ye,Qe,Rt);case rt:var kt=Qe._init;return ft(ye,me,Ie,kt(Qe._payload),Rt)}if(Eo(Qe)||Le(Qe))return ye=ye.get(Ie)||null,Ke(me,ye,Qe,Rt,null);Pp(me,Qe)}return null}function yt(ye,me,Ie,Qe){for(var Rt=null,kt=null,xt=me,Vt=me=0,Xr=null;xt!==null&&Vt<Ie.length;Vt++){xt.index>Vt?(Xr=xt,xt=null):Xr=xt.sibling;var kn=He(ye,xt,Ie[Vt],Qe);if(kn===null){xt===null&&(xt=Xr);break}a&&xt&&kn.alternate===null&&u(ye,xt),me=D(kn,me,Vt),kt===null?Rt=kn:kt.sibling=kn,kt=kn,xt=Xr}if(Vt===Ie.length)return _(ye,xt),ar&&tl(ye,Vt),Rt;if(xt===null){for(;Vt<Ie.length;Vt++)xt=qe(ye,Ie[Vt],Qe),xt!==null&&(me=D(xt,me,Vt),kt===null?Rt=xt:kt.sibling=xt,kt=xt);return ar&&tl(ye,Vt),Rt}for(xt=T(ye,xt);Vt<Ie.length;Vt++)Xr=ft(xt,ye,Vt,Ie[Vt],Qe),Xr!==null&&(a&&Xr.alternate!==null&&xt.delete(Xr.key===null?Vt:Xr.key),me=D(Xr,me,Vt),kt===null?Rt=Xr:kt.sibling=Xr,kt=Xr);return a&&xt.forEach(function(Do){return u(ye,Do)}),ar&&tl(ye,Vt),Rt}function Tt(ye,me,Ie,Qe){var Rt=Le(Ie);if(typeof Rt!="function")throw Error(m(150));if(Ie=Rt.call(Ie),Ie==null)throw Error(m(151));for(var kt=Rt=null,xt=me,Vt=me=0,Xr=null,kn=Ie.next();xt!==null&&!kn.done;Vt++,kn=Ie.next()){xt.index>Vt?(Xr=xt,xt=null):Xr=xt.sibling;var Do=He(ye,xt,kn.value,Qe);if(Do===null){xt===null&&(xt=Xr);break}a&&xt&&Do.alternate===null&&u(ye,xt),me=D(Do,me,Vt),kt===null?Rt=Do:kt.sibling=Do,kt=Do,xt=Xr}if(kn.done)return _(ye,xt),ar&&tl(ye,Vt),Rt;if(xt===null){for(;!kn.done;Vt++,kn=Ie.next())kn=qe(ye,kn.value,Qe),kn!==null&&(me=D(kn,me,Vt),kt===null?Rt=kn:kt.sibling=kn,kt=kn);return ar&&tl(ye,Vt),Rt}for(xt=T(ye,xt);!kn.done;Vt++,kn=Ie.next())kn=ft(xt,ye,Vt,kn.value,Qe),kn!==null&&(a&&kn.alternate!==null&&xt.delete(kn.key===null?Vt:kn.key),me=D(kn,me,Vt),kt===null?Rt=kn:kt.sibling=kn,kt=kn);return a&&xt.forEach(function(pC){return u(ye,pC)}),ar&&tl(ye,Vt),Rt}function gr(ye,me,Ie,Qe){if(typeof Ie=="object"&&Ie!==null&&Ie.type===Te&&Ie.key===null&&(Ie=Ie.props.children),typeof Ie=="object"&&Ie!==null){switch(Ie.$$typeof){case pe:e:{for(var Rt=Ie.key,kt=me;kt!==null;){if(kt.key===Rt){if(Rt=Ie.type,Rt===Te){if(kt.tag===7){_(ye,kt.sibling),me=I(kt,Ie.props.children),me.return=ye,ye=me;break e}}else if(kt.elementType===Rt||typeof Rt=="object"&&Rt!==null&&Rt.$$typeof===rt&&R_(Rt)===kt.type){_(ye,kt.sibling),me=I(kt,Ie.props),me.ref=Fu(ye,kt,Ie),me.return=ye,ye=me;break e}_(ye,kt);break}else u(ye,kt);kt=kt.sibling}Ie.type===Te?(me=yc(Ie.props.children,ye.mode,Qe,Ie.key),me.return=ye,ye=me):(Qe=Ed(Ie.type,Ie.key,Ie.props,null,ye.mode,Qe),Qe.ref=Fu(ye,me,Ie),Qe.return=ye,ye=Qe)}return q(ye);case Se:e:{for(kt=Ie.key;me!==null;){if(me.key===kt)if(me.tag===4&&me.stateNode.containerInfo===Ie.containerInfo&&me.stateNode.implementation===Ie.implementation){_(ye,me.sibling),me=I(me,Ie.children||[]),me.return=ye,ye=me;break e}else{_(ye,me);break}else u(ye,me);me=me.sibling}me=vd(Ie,ye.mode,Qe),me.return=ye,ye=me}return q(ye);case rt:return kt=Ie._init,gr(ye,me,kt(Ie._payload),Qe)}if(Eo(Ie))return yt(ye,me,Ie,Qe);if(Le(Ie))return Tt(ye,me,Ie,Qe);Pp(ye,Ie)}return typeof Ie=="string"&&Ie!==""||typeof Ie=="number"?(Ie=""+Ie,me!==null&&me.tag===6?(_(ye,me.sibling),me=I(me,Ie),me.return=ye,ye=me):(_(ye,me),me=cf(Ie,ye.mode,Qe),me.return=ye,ye=me),q(ye)):_(ye,me)}return gr}var ad=ty(!0),w_=ty(!1),Dp=Xs(null),kp=null,cd=null,C_=null;function b_(){C_=cd=kp=null}function I_(a){var u=Dp.current;Jn(Dp),a._currentValue=u}function xp(a,u,_){for(;a!==null;){var T=a.alternate;if((a.childLanes&u)!==u?(a.childLanes|=u,T!==null&&(T.childLanes|=u)):T!==null&&(T.childLanes&u)!==u&&(T.childLanes|=u),a===_)break;a=a.return}}function Qs(a,u){kp=a,C_=cd=null,a=a.dependencies,a!==null&&a.firstContext!==null&&((a.lanes&u)!==0&&(Ji=!0),a.firstContext=null)}function Ss(a){var u=a._currentValue;if(C_!==a)if(a={context:a,memoizedValue:u,next:null},cd===null){if(kp===null)throw Error(m(308));cd=a,kp.dependencies={lanes:0,firstContext:a}}else cd=cd.next=a;return u}var rl=null;function A_(a){rl===null?rl=[a]:rl.push(a)}function N_(a,u,_,T){var I=u.interleaved;return I===null?(_.next=_,A_(u)):(_.next=I.next,I.next=_),u.interleaved=_,la(a,T)}function la(a,u){a.lanes|=u;var _=a.alternate;for(_!==null&&(_.lanes|=u),_=a,a=a.return;a!==null;)a.childLanes|=u,_=a.alternate,_!==null&&(_.childLanes|=u),_=a,a=a.return;return _.tag===3?_.stateNode:null}var da=!1;function O_(a){a.updateQueue={baseState:a.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function ny(a,u){a=a.updateQueue,u.updateQueue===a&&(u.updateQueue={baseState:a.baseState,firstBaseUpdate:a.firstBaseUpdate,lastBaseUpdate:a.lastBaseUpdate,shared:a.shared,effects:a.effects})}function ua(a,u){return{eventTime:a,lane:u,tag:0,payload:null,callback:null,next:null}}function Zs(a,u,_){var T=a.updateQueue;if(T===null)return null;if(T=T.shared,(mn&2)!==0){var I=T.pending;return I===null?u.next=u:(u.next=I.next,I.next=u),T.pending=u,la(a,_)}return I=T.interleaved,I===null?(u.next=u,A_(T)):(u.next=I.next,I.next=u),T.interleaved=u,la(a,_)}function Lp(a,u,_){if(u=u.updateQueue,u!==null&&(u=u.shared,(_&4194240)!==0)){var T=u.lanes;T&=a.pendingLanes,_|=T,u.lanes=_,Wm(a,_)}}function ry(a,u){var _=a.updateQueue,T=a.alternate;if(T!==null&&(T=T.updateQueue,_===T)){var I=null,D=null;if(_=_.firstBaseUpdate,_!==null){do{var q={eventTime:_.eventTime,lane:_.lane,tag:_.tag,payload:_.payload,callback:_.callback,next:null};D===null?I=D=q:D=D.next=q,_=_.next}while(_!==null);D===null?I=D=u:D=D.next=u}else I=D=u;_={baseState:T.baseState,firstBaseUpdate:I,lastBaseUpdate:D,shared:T.shared,effects:T.effects},a.updateQueue=_;return}a=_.lastBaseUpdate,a===null?_.firstBaseUpdate=u:a.next=u,_.lastBaseUpdate=u}function Mp(a,u,_,T){var I=a.updateQueue;da=!1;var D=I.firstBaseUpdate,q=I.lastBaseUpdate,ce=I.shared.pending;if(ce!==null){I.shared.pending=null;var he=ce,Oe=he.next;he.next=null,q===null?D=Oe:q.next=Oe,q=he;var Ke=a.alternate;Ke!==null&&(Ke=Ke.updateQueue,ce=Ke.lastBaseUpdate,ce!==q&&(ce===null?Ke.firstBaseUpdate=Oe:ce.next=Oe,Ke.lastBaseUpdate=he))}if(D!==null){var qe=I.baseState;q=0,Ke=Oe=he=null,ce=D;do{var He=ce.lane,ft=ce.eventTime;if((T&He)===He){Ke!==null&&(Ke=Ke.next={eventTime:ft,lane:0,tag:ce.tag,payload:ce.payload,callback:ce.callback,next:null});e:{var yt=a,Tt=ce;switch(He=u,ft=_,Tt.tag){case 1:if(yt=Tt.payload,typeof yt=="function"){qe=yt.call(ft,qe,He);break e}qe=yt;break e;case 3:yt.flags=yt.flags&-65537|128;case 0:if(yt=Tt.payload,He=typeof yt=="function"?yt.call(ft,qe,He):yt,He==null)break e;qe=ze({},qe,He);break e;case 2:da=!0}}ce.callback!==null&&ce.lane!==0&&(a.flags|=64,He=I.effects,He===null?I.effects=[ce]:He.push(ce))}else ft={eventTime:ft,lane:He,tag:ce.tag,payload:ce.payload,callback:ce.callback,next:null},Ke===null?(Oe=Ke=ft,he=qe):Ke=Ke.next=ft,q|=He;if(ce=ce.next,ce===null){if(ce=I.shared.pending,ce===null)break;He=ce,ce=He.next,He.next=null,I.lastBaseUpdate=He,I.shared.pending=null}}while(!0);if(Ke===null&&(he=qe),I.baseState=he,I.firstBaseUpdate=Oe,I.lastBaseUpdate=Ke,u=I.shared.interleaved,u!==null){I=u;do q|=I.lane,I=I.next;while(I!==u)}else D===null&&(I.shared.lanes=0);ul|=q,a.lanes=q,a.memoizedState=qe}}function iy(a,u,_){if(a=u.effects,u.effects=null,a!==null)for(u=0;u<a.length;u++){var T=a[u],I=T.callback;if(I!==null){if(T.callback=null,T=_,typeof I!="function")throw Error(m(191,I));I.call(T)}}}var Bu={},Io=Xs(Bu),il=Xs(Bu),Wu=Xs(Bu);function cc(a){if(a===Bu)throw Error(m(174));return a}function P_(a,u){switch(nr(Wu,u),nr(il,a),nr(Io,Bu),a=u.nodeType,a){case 9:case 11:u=(u=u.documentElement)?u.namespaceURI:ni(null,"");break;default:a=a===8?u.parentNode:u,u=a.namespaceURI||null,a=a.tagName,u=ni(u,a)}Jn(Io),nr(Io,u)}function sl(){Jn(Io),Jn(il),Jn(Wu)}function sy(a){cc(Wu.current);var u=cc(Io.current),_=ni(u,a.type);u!==_&&(nr(il,a),nr(Io,_))}function D_(a){il.current===a&&(Jn(Io),Jn(il))}var mr=Xs(0);function Up(a){for(var u=a;u!==null;){if(u.tag===13){var _=u.memoizedState;if(_!==null&&(_=_.dehydrated,_===null||_.data==="$?"||_.data==="$!"))return u}else if(u.tag===19&&u.memoizedProps.revealOrder!==void 0){if((u.flags&128)!==0)return u}else if(u.child!==null){u.child.return=u,u=u.child;continue}if(u===a)break;for(;u.sibling===null;){if(u.return===null||u.return===a)return null;u=u.return}u.sibling.return=u.return,u=u.sibling}return null}var k_=[];function x_(){for(var a=0;a<k_.length;a++)k_[a]._workInProgressVersionPrimary=null;k_.length=0}var Gu=ae.ReactCurrentDispatcher,L_=ae.ReactCurrentBatchConfig,ol=0,hr=null,zr=null,Or=null,Hu=!1,ha=!1,Ku=0,Qw=0;function Si(){throw Error(m(321))}function M_(a,u){if(u===null)return!1;for(var _=0;_<u.length&&_<a.length;_++)if(!Ys(a[_],u[_]))return!1;return!0}function ld(a,u,_,T,I,D){if(ol=D,hr=u,u.memoizedState=null,u.updateQueue=null,u.lanes=0,Gu.current=a===null||a.memoizedState===null?$w:fy,a=_(T,I),ha){D=0;do{if(ha=!1,Ku=0,25<=D)throw Error(m(301));D+=1,Or=zr=null,u.updateQueue=null,Gu.current=eC,a=_(T,I)}while(ha)}if(Gu.current=ud,u=zr!==null&&zr.next!==null,ol=0,Or=zr=hr=null,Hu=!1,u)throw Error(m(300));return a}function U_(){var a=Ku!==0;return Ku=0,a}function $s(){var a={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Or===null?hr.memoizedState=Or=a:Or=Or.next=a,Or}function Xi(){if(zr===null){var a=hr.alternate;a=a!==null?a.memoizedState:null}else a=zr.next;var u=Or===null?hr.memoizedState:Or.next;if(u!==null)Or=u,zr=a;else{if(a===null)throw Error(m(310));zr=a,a={memoizedState:zr.memoizedState,baseState:zr.baseState,baseQueue:zr.baseQueue,queue:zr.queue,next:null},Or===null?hr.memoizedState=Or=a:Or=Or.next=a}return Or}function al(a,u){return typeof u=="function"?u(a):u}function j_(a){var u=Xi(),_=u.queue;if(_===null)throw Error(m(311));_.lastRenderedReducer=a;var T=zr,I=T.baseQueue,D=_.pending;if(D!==null){if(I!==null){var q=I.next;I.next=D.next,D.next=q}T.baseQueue=I=D,_.pending=null}if(I!==null){D=I.next,T=T.baseState;var ce=q=null,he=null,Oe=D;do{var Ke=Oe.lane;if((ol&Ke)===Ke)he!==null&&(he=he.next={lane:0,action:Oe.action,hasEagerState:Oe.hasEagerState,eagerState:Oe.eagerState,next:null}),T=Oe.hasEagerState?Oe.eagerState:a(T,Oe.action);else{var qe={lane:Ke,action:Oe.action,hasEagerState:Oe.hasEagerState,eagerState:Oe.eagerState,next:null};he===null?(ce=he=qe,q=T):he=he.next=qe,hr.lanes|=Ke,ul|=Ke}Oe=Oe.next}while(Oe!==null&&Oe!==D);he===null?q=T:he.next=ce,Ys(T,u.memoizedState)||(Ji=!0),u.memoizedState=T,u.baseState=q,u.baseQueue=he,_.lastRenderedState=T}if(a=_.interleaved,a!==null){I=a;do D=I.lane,hr.lanes|=D,ul|=D,I=I.next;while(I!==a)}else I===null&&(_.lanes=0);return[u.memoizedState,_.dispatch]}function V_(a){var u=Xi(),_=u.queue;if(_===null)throw Error(m(311));_.lastRenderedReducer=a;var T=_.dispatch,I=_.pending,D=u.memoizedState;if(I!==null){_.pending=null;var q=I=I.next;do D=a(D,q.action),q=q.next;while(q!==I);Ys(D,u.memoizedState)||(Ji=!0),u.memoizedState=D,u.baseQueue===null&&(u.baseState=D),_.lastRenderedState=D}return[D,T]}function oy(){}function ay(a,u){var _=hr,T=Xi(),I=u(),D=!Ys(T.memoizedState,I);if(D&&(T.memoizedState=I,Ji=!0),T=T.queue,Fp(ly.bind(null,_,T,a),[a]),T.getSnapshot!==u||D||Or!==null&&Or.memoizedState.tag&1){if(_.flags|=2048,pa(9,zu.bind(null,_,T,I,u),void 0,null),Yr===null)throw Error(m(349));(ol&30)!==0||cy(_,u,I)}return I}function cy(a,u,_){a.flags|=16384,a={getSnapshot:u,value:_},u=hr.updateQueue,u===null?(u={lastEffect:null,stores:null},hr.updateQueue=u,u.stores=[a]):(_=u.stores,_===null?u.stores=[a]:_.push(a))}function zu(a,u,_,T){u.value=_,u.getSnapshot=T,cl(u)&&jp(a)}function ly(a,u,_){return _(function(){cl(u)&&jp(a)})}function cl(a){var u=a.getSnapshot;a=a.value;try{var _=u();return!Ys(a,_)}catch{return!0}}function jp(a){var u=la(a,1);u!==null&&ps(u,a,1,-1)}function Yu(a){var u=$s();return typeof a=="function"&&(a=a()),u.memoizedState=u.baseState=a,a={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:al,lastRenderedState:a},u.queue=a,a=a.dispatch=ll.bind(null,hr,a),[u.memoizedState,a]}function pa(a,u,_,T){return a={tag:a,create:u,destroy:_,deps:T,next:null},u=hr.updateQueue,u===null?(u={lastEffect:null,stores:null},hr.updateQueue=u,u.lastEffect=a.next=a):(_=u.lastEffect,_===null?u.lastEffect=a.next=a:(T=_.next,_.next=a,a.next=T,u.lastEffect=a)),a}function qu(){return Xi().memoizedState}function Vp(a,u,_,T){var I=$s();hr.flags|=a,I.memoizedState=pa(1|u,_,void 0,T===void 0?null:T)}function Xu(a,u,_,T){var I=Xi();T=T===void 0?null:T;var D=void 0;if(zr!==null){var q=zr.memoizedState;if(D=q.destroy,T!==null&&M_(T,q.deps)){I.memoizedState=pa(u,_,D,T);return}}hr.flags|=a,I.memoizedState=pa(1|u,_,D,T)}function dy(a,u){return Vp(8390656,8,a,u)}function Fp(a,u){return Xu(2048,8,a,u)}function uy(a,u){return Xu(4,2,a,u)}function hy(a,u){return Xu(4,4,a,u)}function Bp(a,u){if(typeof u=="function")return a=a(),u(a),function(){u(null)};if(u!=null)return a=a(),u.current=a,function(){u.current=null}}function Wp(a,u,_){return _=_!=null?_.concat([a]):null,Xu(4,4,Bp.bind(null,u,a),_)}function F_(){}function py(a,u){var _=Xi();u=u===void 0?null:u;var T=_.memoizedState;return T!==null&&u!==null&&M_(u,T[1])?T[0]:(_.memoizedState=[a,u],a)}function B_(a,u){var _=Xi();u=u===void 0?null:u;var T=_.memoizedState;return T!==null&&u!==null&&M_(u,T[1])?T[0]:(a=a(),_.memoizedState=[a,u],a)}function Gp(a,u,_){return(ol&21)===0?(a.baseState&&(a.baseState=!1,Ji=!0),a.memoizedState=_):(Ys(_,u)||(_=Ev(),hr.lanes|=_,ul|=_,a.baseState=!0),u)}function Zw(a,u){var _=Un;Un=_!==0&&4>_?_:4,a(!0);var T=L_.transition;L_.transition={};try{a(!1),u()}finally{Un=_,L_.transition=T}}function eo(){return Xi().memoizedState}function dd(a,u,_){var T=mc(a);if(_={lane:T,action:_,hasEagerState:!1,eagerState:null,next:null},W_(a))G_(u,_);else if(_=N_(a,u,_,T),_!==null){var I=Ui();ps(_,a,T,I),lc(_,u,T)}}function ll(a,u,_){var T=mc(a),I={lane:T,action:_,hasEagerState:!1,eagerState:null,next:null};if(W_(a))G_(u,I);else{var D=a.alternate;if(a.lanes===0&&(D===null||D.lanes===0)&&(D=u.lastRenderedReducer,D!==null))try{var q=u.lastRenderedState,ce=D(q,_);if(I.hasEagerState=!0,I.eagerState=ce,Ys(ce,q)){var he=u.interleaved;he===null?(I.next=I,A_(u)):(I.next=he.next,he.next=I),u.interleaved=I;return}}catch{}finally{}_=N_(a,u,I,T),_!==null&&(I=Ui(),ps(_,a,T,I),lc(_,u,T))}}function W_(a){var u=a.alternate;return a===hr||u!==null&&u===hr}function G_(a,u){ha=Hu=!0;var _=a.pending;_===null?u.next=u:(u.next=_.next,_.next=u),a.pending=u}function lc(a,u,_){if((_&4194240)!==0){var T=u.lanes;T&=a.pendingLanes,_|=T,u.lanes=_,Wm(a,_)}}var ud={readContext:Ss,useCallback:Si,useContext:Si,useEffect:Si,useImperativeHandle:Si,useInsertionEffect:Si,useLayoutEffect:Si,useMemo:Si,useReducer:Si,useRef:Si,useState:Si,useDebugValue:Si,useDeferredValue:Si,useTransition:Si,useMutableSource:Si,useSyncExternalStore:Si,useId:Si,unstable_isNewReconciler:!1},$w={readContext:Ss,useCallback:function(a,u){return $s().memoizedState=[a,u===void 0?null:u],a},useContext:Ss,useEffect:dy,useImperativeHandle:function(a,u,_){return _=_!=null?_.concat([a]):null,Vp(4194308,4,Bp.bind(null,u,a),_)},useLayoutEffect:function(a,u){return Vp(4194308,4,a,u)},useInsertionEffect:function(a,u){return Vp(4,2,a,u)},useMemo:function(a,u){var _=$s();return u=u===void 0?null:u,a=a(),_.memoizedState=[a,u],a},useReducer:function(a,u,_){var T=$s();return u=_!==void 0?_(u):u,T.memoizedState=T.baseState=u,a={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:a,lastRenderedState:u},T.queue=a,a=a.dispatch=dd.bind(null,hr,a),[T.memoizedState,a]},useRef:function(a){var u=$s();return a={current:a},u.memoizedState=a},useState:Yu,useDebugValue:F_,useDeferredValue:function(a){return $s().memoizedState=a},useTransition:function(){var a=Yu(!1),u=a[0];return a=Zw.bind(null,a[1]),$s().memoizedState=a,[u,a]},useMutableSource:function(){},useSyncExternalStore:function(a,u,_){var T=hr,I=$s();if(ar){if(_===void 0)throw Error(m(407));_=_()}else{if(_=u(),Yr===null)throw Error(m(349));(ol&30)!==0||cy(T,u,_)}I.memoizedState=_;var D={value:_,getSnapshot:u};return I.queue=D,dy(ly.bind(null,T,D,a),[a]),T.flags|=2048,pa(9,zu.bind(null,T,D,_,u),void 0,null),_},useId:function(){var a=$s(),u=Yr.identifierPrefix;if(ar){var _=ca,T=aa;_=(T&~(1<<32-zs(T)-1)).toString(32)+_,u=":"+u+"R"+_,_=Ku++,0<_&&(u+="H"+_.toString(32)),u+=":"}else _=Qw++,u=":"+u+"r"+_.toString(32)+":";return a.memoizedState=u},unstable_isNewReconciler:!1},fy={readContext:Ss,useCallback:py,useContext:Ss,useEffect:Fp,useImperativeHandle:Wp,useInsertionEffect:uy,useLayoutEffect:hy,useMemo:B_,useReducer:j_,useRef:qu,useState:function(){return j_(al)},useDebugValue:F_,useDeferredValue:function(a){var u=Xi();return Gp(u,zr.memoizedState,a)},useTransition:function(){var a=j_(al)[0],u=Xi().memoizedState;return[a,u]},useMutableSource:oy,useSyncExternalStore:ay,useId:eo,unstable_isNewReconciler:!1},eC={readContext:Ss,useCallback:py,useContext:Ss,useEffect:Fp,useImperativeHandle:Wp,useInsertionEffect:uy,useLayoutEffect:hy,useMemo:B_,useReducer:V_,useRef:qu,useState:function(){return V_(al)},useDebugValue:F_,useDeferredValue:function(a){var u=Xi();return zr===null?u.memoizedState=a:Gp(u,zr.memoizedState,a)},useTransition:function(){var a=V_(al)[0],u=Xi().memoizedState;return[a,u]},useMutableSource:oy,useSyncExternalStore:ay,useId:eo,unstable_isNewReconciler:!1};function Ts(a,u){if(a&&a.defaultProps){u=ze({},u),a=a.defaultProps;for(var _ in a)u[_]===void 0&&(u[_]=a[_]);return u}return u}function Hp(a,u,_,T){u=a.memoizedState,_=_(T,u),_=_==null?u:ze({},u,_),a.memoizedState=_,a.lanes===0&&(a.updateQueue.baseState=_)}var Kp={isMounted:function(a){return(a=a._reactInternals)?Xc(a)===a:!1},enqueueSetState:function(a,u,_){a=a._reactInternals;var T=Ui(),I=mc(a),D=ua(T,I);D.payload=u,_!=null&&(D.callback=_),u=Zs(a,D,I),u!==null&&(ps(u,a,I,T),Lp(u,a,I))},enqueueReplaceState:function(a,u,_){a=a._reactInternals;var T=Ui(),I=mc(a),D=ua(T,I);D.tag=1,D.payload=u,_!=null&&(D.callback=_),u=Zs(a,D,I),u!==null&&(ps(u,a,I,T),Lp(u,a,I))},enqueueForceUpdate:function(a,u){a=a._reactInternals;var _=Ui(),T=mc(a),I=ua(_,T);I.tag=2,u!=null&&(I.callback=u),u=Zs(a,I,T),u!==null&&(ps(u,a,T,_),Lp(u,a,T))}};function fa(a,u,_,T,I,D,q){return a=a.stateNode,typeof a.shouldComponentUpdate=="function"?a.shouldComponentUpdate(T,D,q):u.prototype&&u.prototype.isPureReactComponent?!Xl(_,T)||!Xl(I,D):!0}function my(a,u,_){var T=!1,I=rc,D=u.contextType;return typeof D=="object"&&D!==null?D=Ss(D):(I=qi(u)?ic:yi.current,T=u.contextTypes,D=(T=T!=null)?sc(a,I):rc),u=new u(_,D),a.memoizedState=u.state!==null&&u.state!==void 0?u.state:null,u.updater=Kp,a.stateNode=u,u._reactInternals=a,T&&(a=a.stateNode,a.__reactInternalMemoizedUnmaskedChildContext=I,a.__reactInternalMemoizedMaskedChildContext=D),u}function _y(a,u,_,T){a=u.state,typeof u.componentWillReceiveProps=="function"&&u.componentWillReceiveProps(_,T),typeof u.UNSAFE_componentWillReceiveProps=="function"&&u.UNSAFE_componentWillReceiveProps(_,T),u.state!==a&&Kp.enqueueReplaceState(u,u.state,null)}function H_(a,u,_,T){var I=a.stateNode;I.props=_,I.state=a.memoizedState,I.refs={},O_(a);var D=u.contextType;typeof D=="object"&&D!==null?I.context=Ss(D):(D=qi(u)?ic:yi.current,I.context=sc(a,D)),I.state=a.memoizedState,D=u.getDerivedStateFromProps,typeof D=="function"&&(Hp(a,u,D,_),I.state=a.memoizedState),typeof u.getDerivedStateFromProps=="function"||typeof I.getSnapshotBeforeUpdate=="function"||typeof I.UNSAFE_componentWillMount!="function"&&typeof I.componentWillMount!="function"||(u=I.state,typeof I.componentWillMount=="function"&&I.componentWillMount(),typeof I.UNSAFE_componentWillMount=="function"&&I.UNSAFE_componentWillMount(),u!==I.state&&Kp.enqueueReplaceState(I,I.state,null),Mp(a,_,I,T),I.state=a.memoizedState),typeof I.componentDidMount=="function"&&(a.flags|=4194308)}function hd(a,u){try{var _="",T=u;do _+=Pt(T),T=T.return;while(T);var I=_}catch(D){I=`
Error generating stack: `+D.message+`
`+D.stack}return{value:a,source:u,stack:I,digest:null}}function zp(a,u,_){return{value:a,source:null,stack:_??null,digest:u??null}}function K_(a,u){try{console.error(u.value)}catch(_){setTimeout(function(){throw _})}}var z_=typeof WeakMap=="function"?WeakMap:Map;function Y_(a,u,_){_=ua(-1,_),_.tag=3,_.payload={element:null};var T=u.value;return _.callback=function(){Ri||(Ri=!0,hg=T),K_(a,u)},_}function gy(a,u,_){_=ua(-1,_),_.tag=3;var T=a.type.getDerivedStateFromError;if(typeof T=="function"){var I=u.value;_.payload=function(){return T(I)},_.callback=function(){K_(a,u)}}var D=a.stateNode;return D!==null&&typeof D.componentDidCatch=="function"&&(_.callback=function(){K_(a,u),typeof T!="function"&&(pc===null?pc=new Set([this]):pc.add(this));var q=u.stack;this.componentDidCatch(u.value,{componentStack:q!==null?q:""})}),_}function q_(a,u,_){var T=a.pingCache;if(T===null){T=a.pingCache=new z_;var I=new Set;T.set(u,I)}else I=T.get(u),I===void 0&&(I=new Set,T.set(u,I));I.has(_)||(I.add(_),a=Ly.bind(null,a,u,_),u.then(a,a))}function Ey(a){do{var u;if((u=a.tag===13)&&(u=a.memoizedState,u=u!==null?u.dehydrated!==null:!0),u)return a;a=a.return}while(a!==null);return null}function vy(a,u,_,T,I){return(a.mode&1)===0?(a===u?a.flags|=65536:(a.flags|=128,_.flags|=131072,_.flags&=-52805,_.tag===1&&(_.alternate===null?_.tag=17:(u=ua(-1,1),u.tag=2,Zs(_,u,1))),_.lanes|=1),a):(a.flags|=65536,a.lanes=I,a)}var tC=ae.ReactCurrentOwner,Ji=!1;function Mi(a,u,_,T){u.child=a===null?w_(u,null,_,T):ad(u,a.child,_,T)}function yy(a,u,_,T,I){_=_.render;var D=u.ref;return Qs(u,I),T=ld(a,u,_,T,D,I),_=U_(),a!==null&&!Ji?(u.updateQueue=a.updateQueue,u.flags&=-2053,a.lanes&=~I,ma(a,u,I)):(ar&&_&&id(u),u.flags|=1,Mi(a,u,T,I),u.child)}function Sy(a,u,_,T,I){if(a===null){var D=_.type;return typeof D=="function"&&!Tg(D)&&D.defaultProps===void 0&&_.compare===null&&_.defaultProps===void 0?(u.tag=15,u.type=D,X_(a,u,D,T,I)):(a=Ed(_.type,null,T,u,u.mode,I),a.ref=u.ref,a.return=u,u.child=a)}if(D=a.child,(a.lanes&I)===0){var q=D.memoizedProps;if(_=_.compare,_=_!==null?_:Xl,_(q,T)&&a.ref===u.ref)return ma(a,u,I)}return u.flags|=1,a=vc(D,T),a.ref=u.ref,a.return=u,u.child=a}function X_(a,u,_,T,I){if(a!==null){var D=a.memoizedProps;if(Xl(D,T)&&a.ref===u.ref)if(Ji=!1,u.pendingProps=T=D,(a.lanes&I)!==0)(a.flags&131072)!==0&&(Ji=!0);else return u.lanes=a.lanes,ma(a,u,I)}return J_(a,u,_,T,I)}function Ao(a,u,_){var T=u.pendingProps,I=T.children,D=a!==null?a.memoizedState:null;if(T.mode==="hidden")if((u.mode&1)===0)u.memoizedState={baseLanes:0,cachePool:null,transitions:null},nr(pd,hs),hs|=_;else{if((_&1073741824)===0)return a=D!==null?D.baseLanes|_:_,u.lanes=u.childLanes=1073741824,u.memoizedState={baseLanes:a,cachePool:null,transitions:null},u.updateQueue=null,nr(pd,hs),hs|=a,null;u.memoizedState={baseLanes:0,cachePool:null,transitions:null},T=D!==null?D.baseLanes:_,nr(pd,hs),hs|=T}else D!==null?(T=D.baseLanes|_,u.memoizedState=null):T=_,nr(pd,hs),hs|=T;return Mi(a,u,I,_),u.child}function Ty(a,u){var _=u.ref;(a===null&&_!==null||a!==null&&a.ref!==_)&&(u.flags|=512,u.flags|=2097152)}function J_(a,u,_,T,I){var D=qi(_)?ic:yi.current;return D=sc(u,D),Qs(u,I),_=ld(a,u,_,T,D,I),T=U_(),a!==null&&!Ji?(u.updateQueue=a.updateQueue,u.flags&=-2053,a.lanes&=~I,ma(a,u,I)):(ar&&T&&id(u),u.flags|=1,Mi(a,u,_,I),u.child)}function Ry(a,u,_,T,I){if(qi(_)){var D=!0;bp(u)}else D=!1;if(Qs(u,I),u.stateNode===null)Xp(a,u),my(u,_,T),H_(u,_,T,I),T=!0;else if(a===null){var q=u.stateNode,ce=u.memoizedProps;q.props=ce;var he=q.context,Oe=_.contextType;typeof Oe=="object"&&Oe!==null?Oe=Ss(Oe):(Oe=qi(_)?ic:yi.current,Oe=sc(u,Oe));var Ke=_.getDerivedStateFromProps,qe=typeof Ke=="function"||typeof q.getSnapshotBeforeUpdate=="function";qe||typeof q.UNSAFE_componentWillReceiveProps!="function"&&typeof q.componentWillReceiveProps!="function"||(ce!==T||he!==Oe)&&_y(u,q,T,Oe),da=!1;var He=u.memoizedState;q.state=He,Mp(u,T,q,I),he=u.memoizedState,ce!==T||He!==he||xi.current||da?(typeof Ke=="function"&&(Hp(u,_,Ke,T),he=u.memoizedState),(ce=da||fa(u,_,ce,T,He,he,Oe))?(qe||typeof q.UNSAFE_componentWillMount!="function"&&typeof q.componentWillMount!="function"||(typeof q.componentWillMount=="function"&&q.componentWillMount(),typeof q.UNSAFE_componentWillMount=="function"&&q.UNSAFE_componentWillMount()),typeof q.componentDidMount=="function"&&(u.flags|=4194308)):(typeof q.componentDidMount=="function"&&(u.flags|=4194308),u.memoizedProps=T,u.memoizedState=he),q.props=T,q.state=he,q.context=Oe,T=ce):(typeof q.componentDidMount=="function"&&(u.flags|=4194308),T=!1)}else{q=u.stateNode,ny(a,u),ce=u.memoizedProps,Oe=u.type===u.elementType?ce:Ts(u.type,ce),q.props=Oe,qe=u.pendingProps,He=q.context,he=_.contextType,typeof he=="object"&&he!==null?he=Ss(he):(he=qi(_)?ic:yi.current,he=sc(u,he));var ft=_.getDerivedStateFromProps;(Ke=typeof ft=="function"||typeof q.getSnapshotBeforeUpdate=="function")||typeof q.UNSAFE_componentWillReceiveProps!="function"&&typeof q.componentWillReceiveProps!="function"||(ce!==qe||He!==he)&&_y(u,q,T,he),da=!1,He=u.memoizedState,q.state=He,Mp(u,T,q,I);var yt=u.memoizedState;ce!==qe||He!==yt||xi.current||da?(typeof ft=="function"&&(Hp(u,_,ft,T),yt=u.memoizedState),(Oe=da||fa(u,_,Oe,T,He,yt,he)||!1)?(Ke||typeof q.UNSAFE_componentWillUpdate!="function"&&typeof q.componentWillUpdate!="function"||(typeof q.componentWillUpdate=="function"&&q.componentWillUpdate(T,yt,he),typeof q.UNSAFE_componentWillUpdate=="function"&&q.UNSAFE_componentWillUpdate(T,yt,he)),typeof q.componentDidUpdate=="function"&&(u.flags|=4),typeof q.getSnapshotBeforeUpdate=="function"&&(u.flags|=1024)):(typeof q.componentDidUpdate!="function"||ce===a.memoizedProps&&He===a.memoizedState||(u.flags|=4),typeof q.getSnapshotBeforeUpdate!="function"||ce===a.memoizedProps&&He===a.memoizedState||(u.flags|=1024),u.memoizedProps=T,u.memoizedState=yt),q.props=T,q.state=yt,q.context=he,T=Oe):(typeof q.componentDidUpdate!="function"||ce===a.memoizedProps&&He===a.memoizedState||(u.flags|=4),typeof q.getSnapshotBeforeUpdate!="function"||ce===a.memoizedProps&&He===a.memoizedState||(u.flags|=1024),T=!1)}return Q_(a,u,_,T,D,I)}function Q_(a,u,_,T,I,D){Ty(a,u);var q=(u.flags&128)!==0;if(!T&&!q)return I&&Qv(u,_,!1),ma(a,u,D);T=u.stateNode,tC.current=u;var ce=q&&typeof _.getDerivedStateFromError!="function"?null:T.render();return u.flags|=1,a!==null&&q?(u.child=ad(u,a.child,null,D),u.child=ad(u,null,ce,D)):Mi(a,u,ce,D),u.memoizedState=T.state,I&&Qv(u,_,!0),u.child}function wy(a){var u=a.stateNode;u.pendingContext?nd(a,u.pendingContext,u.pendingContext!==u.context):u.context&&nd(a,u.context,!1),P_(a,u.containerInfo)}function Cy(a,u,_,T,I){return nl(),od(I),u.flags|=256,Mi(a,u,_,T),u.child}var Ju={dehydrated:null,treeContext:null,retryLane:0};function Z_(a){return{baseLanes:a,cachePool:null,transitions:null}}function by(a,u,_){var T=u.pendingProps,I=mr.current,D=!1,q=(u.flags&128)!==0,ce;if((ce=q)||(ce=a!==null&&a.memoizedState===null?!1:(I&2)!==0),ce?(D=!0,u.flags&=-129):(a===null||a.memoizedState!==null)&&(I|=1),nr(mr,I&1),a===null)return ju(u),a=u.memoizedState,a!==null&&(a=a.dehydrated,a!==null)?((u.mode&1)===0?u.lanes=1:a.data==="$!"?u.lanes=8:u.lanes=1073741824,null):(q=T.children,a=T.fallback,D?(T=u.mode,D=u.child,q={mode:"hidden",children:q},(T&1)===0&&D!==null?(D.childLanes=0,D.pendingProps=q):D=ah(q,T,0,null),a=yc(a,T,_,null),D.return=u,a.return=u,D.sibling=a,u.child=D,u.child.memoizedState=Z_(_),u.memoizedState=Ju,a):$_(u,q));if(I=a.memoizedState,I!==null&&(ce=I.dehydrated,ce!==null))return nC(a,u,q,T,ce,I,_);if(D){D=T.fallback,q=u.mode,I=a.child,ce=I.sibling;var he={mode:"hidden",children:T.children};return(q&1)===0&&u.child!==I?(T=u.child,T.childLanes=0,T.pendingProps=he,u.deletions=null):(T=vc(I,he),T.subtreeFlags=I.subtreeFlags&14680064),ce!==null?D=vc(ce,D):(D=yc(D,q,_,null),D.flags|=2),D.return=u,T.return=u,T.sibling=D,u.child=T,T=D,D=u.child,q=a.child.memoizedState,q=q===null?Z_(_):{baseLanes:q.baseLanes|_,cachePool:null,transitions:q.transitions},D.memoizedState=q,D.childLanes=a.childLanes&~_,u.memoizedState=Ju,T}return D=a.child,a=D.sibling,T=vc(D,{mode:"visible",children:T.children}),(u.mode&1)===0&&(T.lanes=_),T.return=u,T.sibling=null,a!==null&&(_=u.deletions,_===null?(u.deletions=[a],u.flags|=16):_.push(a)),u.child=T,u.memoizedState=null,T}function $_(a,u){return u=ah({mode:"visible",children:u},a.mode,0,null),u.return=a,a.child=u}function Yp(a,u,_,T){return T!==null&&od(T),ad(u,a.child,null,_),a=$_(u,u.pendingProps.children),a.flags|=2,u.memoizedState=null,a}function nC(a,u,_,T,I,D,q){if(_)return u.flags&256?(u.flags&=-257,T=zp(Error(m(422))),Yp(a,u,q,T)):u.memoizedState!==null?(u.child=a.child,u.flags|=128,null):(D=T.fallback,I=u.mode,T=ah({mode:"visible",children:T.children},I,0,null),D=yc(D,I,q,null),D.flags|=2,T.return=u,D.return=u,T.sibling=D,u.child=T,(u.mode&1)!==0&&ad(u,a.child,null,q),u.child.memoizedState=Z_(q),u.memoizedState=Ju,D);if((u.mode&1)===0)return Yp(a,u,q,null);if(I.data==="$!"){if(T=I.nextSibling&&I.nextSibling.dataset,T)var ce=T.dgst;return T=ce,D=Error(m(419)),T=zp(D,T,void 0),Yp(a,u,q,T)}if(ce=(q&a.childLanes)!==0,Ji||ce){if(T=Yr,T!==null){switch(q&-q){case 4:I=2;break;case 16:I=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:I=32;break;case 536870912:I=268435456;break;default:I=0}I=(I&(T.suspendedLanes|q))!==0?0:I,I!==0&&I!==D.retryLane&&(D.retryLane=I,la(a,I),ps(T,a,I,-1))}return _d(),T=zp(Error(m(421))),Yp(a,u,q,T)}return I.data==="$?"?(u.flags|=128,u.child=a.child,u=dC.bind(null,a),I._reactRetry=u,null):(a=D.treeContext,ds=Co(I.nextSibling),ls=u,ar=!0,Js=null,a!==null&&(Li[ys++]=aa,Li[ys++]=ca,Li[ys++]=el,aa=a.id,ca=a.overflow,el=u),u=$_(u,T.children),u.flags|=4096,u)}function Iy(a,u,_){a.lanes|=u;var T=a.alternate;T!==null&&(T.lanes|=u),xp(a.return,u,_)}function qp(a,u,_,T,I){var D=a.memoizedState;D===null?a.memoizedState={isBackwards:u,rendering:null,renderingStartTime:0,last:T,tail:_,tailMode:I}:(D.isBackwards=u,D.rendering=null,D.renderingStartTime=0,D.last=T,D.tail=_,D.tailMode=I)}function eg(a,u,_){var T=u.pendingProps,I=T.revealOrder,D=T.tail;if(Mi(a,u,T.children,_),T=mr.current,(T&2)!==0)T=T&1|2,u.flags|=128;else{if(a!==null&&(a.flags&128)!==0)e:for(a=u.child;a!==null;){if(a.tag===13)a.memoizedState!==null&&Iy(a,_,u);else if(a.tag===19)Iy(a,_,u);else if(a.child!==null){a.child.return=a,a=a.child;continue}if(a===u)break e;for(;a.sibling===null;){if(a.return===null||a.return===u)break e;a=a.return}a.sibling.return=a.return,a=a.sibling}T&=1}if(nr(mr,T),(u.mode&1)===0)u.memoizedState=null;else switch(I){case"forwards":for(_=u.child,I=null;_!==null;)a=_.alternate,a!==null&&Up(a)===null&&(I=_),_=_.sibling;_=I,_===null?(I=u.child,u.child=null):(I=_.sibling,_.sibling=null),qp(u,!1,I,_,D);break;case"backwards":for(_=null,I=u.child,u.child=null;I!==null;){if(a=I.alternate,a!==null&&Up(a)===null){u.child=I;break}a=I.sibling,I.sibling=_,_=I,I=a}qp(u,!0,_,null,D);break;case"together":qp(u,!1,null,null,void 0);break;default:u.memoizedState=null}return u.child}function Xp(a,u){(u.mode&1)===0&&a!==null&&(a.alternate=null,u.alternate=null,u.flags|=2)}function ma(a,u,_){if(a!==null&&(u.dependencies=a.dependencies),ul|=u.lanes,(_&u.childLanes)===0)return null;if(a!==null&&u.child!==a.child)throw Error(m(153));if(u.child!==null){for(a=u.child,_=vc(a,a.pendingProps),u.child=_,_.return=u;a.sibling!==null;)a=a.sibling,_=_.sibling=vc(a,a.pendingProps),_.return=u;_.sibling=null}return u.child}function Jp(a,u,_){switch(u.tag){case 3:wy(u),nl();break;case 5:sy(u);break;case 1:qi(u.type)&&bp(u);break;case 4:P_(u,u.stateNode.containerInfo);break;case 10:var T=u.type._context,I=u.memoizedProps.value;nr(Dp,T._currentValue),T._currentValue=I;break;case 13:if(T=u.memoizedState,T!==null)return T.dehydrated!==null?(nr(mr,mr.current&1),u.flags|=128,null):(_&u.child.childLanes)!==0?by(a,u,_):(nr(mr,mr.current&1),a=ma(a,u,_),a!==null?a.sibling:null);nr(mr,mr.current&1);break;case 19:if(T=(_&u.childLanes)!==0,(a.flags&128)!==0){if(T)return eg(a,u,_);u.flags|=128}if(I=u.memoizedState,I!==null&&(I.rendering=null,I.tail=null,I.lastEffect=null),nr(mr,mr.current),T)break;return null;case 22:case 23:return u.lanes=0,Ao(a,u,_)}return ma(a,u,_)}var Qp,Zp,Qu,tg;Qp=function(a,u){for(var _=u.child;_!==null;){if(_.tag===5||_.tag===6)a.appendChild(_.stateNode);else if(_.tag!==4&&_.child!==null){_.child.return=_,_=_.child;continue}if(_===u)break;for(;_.sibling===null;){if(_.return===null||_.return===u)return;_=_.return}_.sibling.return=_.return,_=_.sibling}},Zp=function(){},Qu=function(a,u,_,T){var I=a.memoizedProps;if(I!==T){a=u.stateNode,cc(Io.current);var D=null;switch(_){case"input":I=ss(a,I),T=ss(a,T),D=[];break;case"select":I=ze({},I,{value:void 0}),T=ze({},T,{value:void 0}),D=[];break;case"textarea":I=xl(a,I),T=xl(a,T),D=[];break;default:typeof I.onClick!="function"&&typeof T.onClick=="function"&&(a.onclick=xu)}vo(_,T);var q;_=null;for(Oe in I)if(!T.hasOwnProperty(Oe)&&I.hasOwnProperty(Oe)&&I[Oe]!=null)if(Oe==="style"){var ce=I[Oe];for(q in ce)ce.hasOwnProperty(q)&&(_||(_={}),_[q]="")}else Oe!=="dangerouslySetInnerHTML"&&Oe!=="children"&&Oe!=="suppressContentEditableWarning"&&Oe!=="suppressHydrationWarning"&&Oe!=="autoFocus"&&(R.hasOwnProperty(Oe)?D||(D=[]):(D=D||[]).push(Oe,null));for(Oe in T){var he=T[Oe];if(ce=I?.[Oe],T.hasOwnProperty(Oe)&&he!==ce&&(he!=null||ce!=null))if(Oe==="style")if(ce){for(q in ce)!ce.hasOwnProperty(q)||he&&he.hasOwnProperty(q)||(_||(_={}),_[q]="");for(q in he)he.hasOwnProperty(q)&&ce[q]!==he[q]&&(_||(_={}),_[q]=he[q])}else _||(D||(D=[]),D.push(Oe,_)),_=he;else Oe==="dangerouslySetInnerHTML"?(he=he?he.__html:void 0,ce=ce?ce.__html:void 0,he!=null&&ce!==he&&(D=D||[]).push(Oe,he)):Oe==="children"?typeof he!="string"&&typeof he!="number"||(D=D||[]).push(Oe,""+he):Oe!=="suppressContentEditableWarning"&&Oe!=="suppressHydrationWarning"&&(R.hasOwnProperty(Oe)?(he!=null&&Oe==="onScroll"&&tr("scroll",a),D||ce===he||(D=[])):(D=D||[]).push(Oe,he))}_&&(D=D||[]).push("style",_);var Oe=D;(u.updateQueue=Oe)&&(u.flags|=4)}},tg=function(a,u,_,T){_!==T&&(u.flags|=4)};function Zu(a,u){if(!ar)switch(a.tailMode){case"hidden":u=a.tail;for(var _=null;u!==null;)u.alternate!==null&&(_=u),u=u.sibling;_===null?a.tail=null:_.sibling=null;break;case"collapsed":_=a.tail;for(var T=null;_!==null;)_.alternate!==null&&(T=_),_=_.sibling;T===null?u||a.tail===null?a.tail=null:a.tail.sibling=null:T.sibling=null}}function ui(a){var u=a.alternate!==null&&a.alternate.child===a.child,_=0,T=0;if(u)for(var I=a.child;I!==null;)_|=I.lanes|I.childLanes,T|=I.subtreeFlags&14680064,T|=I.flags&14680064,I.return=a,I=I.sibling;else for(I=a.child;I!==null;)_|=I.lanes|I.childLanes,T|=I.subtreeFlags,T|=I.flags,I.return=a,I=I.sibling;return a.subtreeFlags|=T,a.childLanes=_,u}function $p(a,u,_){var T=u.pendingProps;switch(Op(u),u.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return ui(u),null;case 1:return qi(u.type)&&Cp(),ui(u),null;case 3:return T=u.stateNode,sl(),Jn(xi),Jn(yi),x_(),T.pendingContext&&(T.context=T.pendingContext,T.pendingContext=null),(a===null||a.child===null)&&(sd(u)?u.flags|=4:a===null||a.memoizedState.isDehydrated&&(u.flags&256)===0||(u.flags|=1024,Js!==null&&(fg(Js),Js=null))),Zp(a,u),ui(u),null;case 5:D_(u);var I=cc(Wu.current);if(_=u.type,a!==null&&u.stateNode!=null)Qu(a,u,_,T,I),a.ref!==u.ref&&(u.flags|=512,u.flags|=2097152);else{if(!T){if(u.stateNode===null)throw Error(m(166));return ui(u),null}if(a=cc(Io.current),sd(u)){T=u.stateNode,_=u.type;var D=u.memoizedProps;switch(T[bo]=u,T[Lu]=D,a=(u.mode&1)!==0,_){case"dialog":tr("cancel",T),tr("close",T);break;case"iframe":case"object":case"embed":tr("load",T);break;case"video":case"audio":for(I=0;I<Ou.length;I++)tr(Ou[I],T);break;case"source":tr("error",T);break;case"img":case"image":case"link":tr("error",T),tr("load",T);break;case"details":tr("toggle",T);break;case"input":Ga(T,D),tr("invalid",T);break;case"select":T._wrapperState={wasMultiple:!!D.multiple},tr("invalid",T);break;case"textarea":Ws(T,D),tr("invalid",T)}vo(_,D),I=null;for(var q in D)if(D.hasOwnProperty(q)){var ce=D[q];q==="children"?typeof ce=="string"?T.textContent!==ce&&(D.suppressHydrationWarning!==!0&&ku(T.textContent,ce,a),I=["children",ce]):typeof ce=="number"&&T.textContent!==""+ce&&(D.suppressHydrationWarning!==!0&&ku(T.textContent,ce,a),I=["children",""+ce]):R.hasOwnProperty(q)&&ce!=null&&q==="onScroll"&&tr("scroll",T)}switch(_){case"input":Cn(T),Sr(T,D,!0);break;case"textarea":Cn(T),uu(T);break;case"select":case"option":break;default:typeof D.onClick=="function"&&(T.onclick=xu)}T=I,u.updateQueue=T,T!==null&&(u.flags|=4)}else{q=I.nodeType===9?I:I.ownerDocument,a==="http://www.w3.org/1999/xhtml"&&(a=vi(_)),a==="http://www.w3.org/1999/xhtml"?_==="script"?(a=q.createElement("div"),a.innerHTML="<script><\/script>",a=a.removeChild(a.firstChild)):typeof T.is=="string"?a=q.createElement(_,{is:T.is}):(a=q.createElement(_),_==="select"&&(q=a,T.multiple?q.multiple=!0:T.size&&(q.size=T.size))):a=q.createElementNS(a,_),a[bo]=u,a[Lu]=T,Qp(a,u,!1,!1),u.stateNode=a;e:{switch(q=fu(_,T),_){case"dialog":tr("cancel",a),tr("close",a),I=T;break;case"iframe":case"object":case"embed":tr("load",a),I=T;break;case"video":case"audio":for(I=0;I<Ou.length;I++)tr(Ou[I],a);I=T;break;case"source":tr("error",a),I=T;break;case"img":case"image":case"link":tr("error",a),tr("load",a),I=T;break;case"details":tr("toggle",a),I=T;break;case"input":Ga(a,T),I=ss(a,T),tr("invalid",a);break;case"option":I=T;break;case"select":a._wrapperState={wasMultiple:!!T.multiple},I=ze({},T,{value:void 0}),tr("invalid",a);break;case"textarea":Ws(a,T),I=xl(a,T),tr("invalid",a);break;default:I=T}vo(_,I),ce=I;for(D in ce)if(ce.hasOwnProperty(D)){var he=ce[D];D==="style"?Di(a,he):D==="dangerouslySetInnerHTML"?(he=he?he.__html:void 0,he!=null&&Ll(a,he)):D==="children"?typeof he=="string"?(_!=="textarea"||he!=="")&&Gs(a,he):typeof he=="number"&&Gs(a,""+he):D!=="suppressContentEditableWarning"&&D!=="suppressHydrationWarning"&&D!=="autoFocus"&&(R.hasOwnProperty(D)?he!=null&&D==="onScroll"&&tr("scroll",a):he!=null&&se(a,D,he,q))}switch(_){case"input":Cn(a),Sr(a,T,!1);break;case"textarea":Cn(a),uu(a);break;case"option":T.value!=null&&a.setAttribute("value",""+Nt(T.value));break;case"select":a.multiple=!!T.multiple,D=T.value,D!=null?Gi(a,!!T.multiple,D,!1):T.defaultValue!=null&&Gi(a,!!T.multiple,T.defaultValue,!0);break;default:typeof I.onClick=="function"&&(a.onclick=xu)}switch(_){case"button":case"input":case"select":case"textarea":T=!!T.autoFocus;break e;case"img":T=!0;break e;default:T=!1}}T&&(u.flags|=4)}u.ref!==null&&(u.flags|=512,u.flags|=2097152)}return ui(u),null;case 6:if(a&&u.stateNode!=null)tg(a,u,a.memoizedProps,T);else{if(typeof T!="string"&&u.stateNode===null)throw Error(m(166));if(_=cc(Wu.current),cc(Io.current),sd(u)){if(T=u.stateNode,_=u.memoizedProps,T[bo]=u,(D=T.nodeValue!==_)&&(a=ls,a!==null))switch(a.tag){case 3:ku(T.nodeValue,_,(a.mode&1)!==0);break;case 5:a.memoizedProps.suppressHydrationWarning!==!0&&ku(T.nodeValue,_,(a.mode&1)!==0)}D&&(u.flags|=4)}else T=(_.nodeType===9?_:_.ownerDocument).createTextNode(T),T[bo]=u,u.stateNode=T}return ui(u),null;case 13:if(Jn(mr),T=u.memoizedState,a===null||a.memoizedState!==null&&a.memoizedState.dehydrated!==null){if(ar&&ds!==null&&(u.mode&1)!==0&&(u.flags&128)===0)T_(),nl(),u.flags|=98560,D=!1;else if(D=sd(u),T!==null&&T.dehydrated!==null){if(a===null){if(!D)throw Error(m(318));if(D=u.memoizedState,D=D!==null?D.dehydrated:null,!D)throw Error(m(317));D[bo]=u}else nl(),(u.flags&128)===0&&(u.memoizedState=null),u.flags|=4;ui(u),D=!1}else Js!==null&&(fg(Js),Js=null),D=!0;if(!D)return u.flags&65536?u:null}return(u.flags&128)!==0?(u.lanes=_,u):(T=T!==null,T!==(a!==null&&a.memoizedState!==null)&&T&&(u.child.flags|=8192,(u.mode&1)!==0&&(a===null||(mr.current&1)!==0?qr===0&&(qr=3):_d())),u.updateQueue!==null&&(u.flags|=4),ui(u),null);case 4:return sl(),Zp(a,u),a===null&&ra(u.stateNode.containerInfo),ui(u),null;case 10:return I_(u.type._context),ui(u),null;case 17:return qi(u.type)&&Cp(),ui(u),null;case 19:if(Jn(mr),D=u.memoizedState,D===null)return ui(u),null;if(T=(u.flags&128)!==0,q=D.rendering,q===null)if(T)Zu(D,!1);else{if(qr!==0||a!==null&&(a.flags&128)!==0)for(a=u.child;a!==null;){if(q=Up(a),q!==null){for(u.flags|=128,Zu(D,!1),T=q.updateQueue,T!==null&&(u.updateQueue=T,u.flags|=4),u.subtreeFlags=0,T=_,_=u.child;_!==null;)D=_,a=T,D.flags&=14680066,q=D.alternate,q===null?(D.childLanes=0,D.lanes=a,D.child=null,D.subtreeFlags=0,D.memoizedProps=null,D.memoizedState=null,D.updateQueue=null,D.dependencies=null,D.stateNode=null):(D.childLanes=q.childLanes,D.lanes=q.lanes,D.child=q.child,D.subtreeFlags=0,D.deletions=null,D.memoizedProps=q.memoizedProps,D.memoizedState=q.memoizedState,D.updateQueue=q.updateQueue,D.type=q.type,a=q.dependencies,D.dependencies=a===null?null:{lanes:a.lanes,firstContext:a.firstContext}),_=_.sibling;return nr(mr,mr.current&1|2),u.child}a=a.sibling}D.tail!==null&&Nr()>Rs&&(u.flags|=128,T=!0,Zu(D,!1),u.lanes=4194304)}else{if(!T)if(a=Up(q),a!==null){if(u.flags|=128,T=!0,_=a.updateQueue,_!==null&&(u.updateQueue=_,u.flags|=4),Zu(D,!0),D.tail===null&&D.tailMode==="hidden"&&!q.alternate&&!ar)return ui(u),null}else 2*Nr()-D.renderingStartTime>Rs&&_!==1073741824&&(u.flags|=128,T=!0,Zu(D,!1),u.lanes=4194304);D.isBackwards?(q.sibling=u.child,u.child=q):(_=D.last,_!==null?_.sibling=q:u.child=q,D.last=q)}return D.tail!==null?(u=D.tail,D.rendering=u,D.tail=u.sibling,D.renderingStartTime=Nr(),u.sibling=null,_=mr.current,nr(mr,T?_&1|2:_&1),u):(ui(u),null);case 22:case 23:return sh(),T=u.memoizedState!==null,a!==null&&a.memoizedState!==null!==T&&(u.flags|=8192),T&&(u.mode&1)!==0?(hs&1073741824)!==0&&(ui(u),u.subtreeFlags&6&&(u.flags|=8192)):ui(u),null;case 24:return null;case 25:return null}throw Error(m(156,u.tag))}function rC(a,u){switch(Op(u),u.tag){case 1:return qi(u.type)&&Cp(),a=u.flags,a&65536?(u.flags=a&-65537|128,u):null;case 3:return sl(),Jn(xi),Jn(yi),x_(),a=u.flags,(a&65536)!==0&&(a&128)===0?(u.flags=a&-65537|128,u):null;case 5:return D_(u),null;case 13:if(Jn(mr),a=u.memoizedState,a!==null&&a.dehydrated!==null){if(u.alternate===null)throw Error(m(340));nl()}return a=u.flags,a&65536?(u.flags=a&-65537|128,u):null;case 19:return Jn(mr),null;case 4:return sl(),null;case 10:return I_(u.type._context),null;case 22:case 23:return sh(),null;case 24:return null;default:return null}}var $u=!1,hi=!1,iC=typeof WeakSet=="function"?WeakSet:Set,_t=null;function dl(a,u){var _=a.ref;if(_!==null)if(typeof _=="function")try{_(null)}catch(T){_r(a,u,T)}else _.current=null}function ng(a,u,_){try{_()}catch(T){_r(a,u,T)}}var Ay=!1;function sC(a,u){if(m_=hp,a=a_(),c_(a)){if("selectionStart"in a)var _={start:a.selectionStart,end:a.selectionEnd};else e:{_=(_=a.ownerDocument)&&_.defaultView||window;var T=_.getSelection&&_.getSelection();if(T&&T.rangeCount!==0){_=T.anchorNode;var I=T.anchorOffset,D=T.focusNode;T=T.focusOffset;try{_.nodeType,D.nodeType}catch{_=null;break e}var q=0,ce=-1,he=-1,Oe=0,Ke=0,qe=a,He=null;t:for(;;){for(var ft;qe!==_||I!==0&&qe.nodeType!==3||(ce=q+I),qe!==D||T!==0&&qe.nodeType!==3||(he=q+T),qe.nodeType===3&&(q+=qe.nodeValue.length),(ft=qe.firstChild)!==null;)He=qe,qe=ft;for(;;){if(qe===a)break t;if(He===_&&++Oe===I&&(ce=q),He===D&&++Ke===T&&(he=q),(ft=qe.nextSibling)!==null)break;qe=He,He=qe.parentNode}qe=ft}_=ce===-1||he===-1?null:{start:ce,end:he}}else _=null}_=_||{start:0,end:0}}else _=null;for(Tp={focusedElem:a,selectionRange:_},hp=!1,_t=u;_t!==null;)if(u=_t,a=u.child,(u.subtreeFlags&1028)!==0&&a!==null)a.return=u,_t=a;else for(;_t!==null;){u=_t;try{var yt=u.alternate;if((u.flags&1024)!==0)switch(u.tag){case 0:case 11:case 15:break;case 1:if(yt!==null){var Tt=yt.memoizedProps,gr=yt.memoizedState,ye=u.stateNode,me=ye.getSnapshotBeforeUpdate(u.elementType===u.type?Tt:Ts(u.type,Tt),gr);ye.__reactInternalSnapshotBeforeUpdate=me}break;case 3:var Ie=u.stateNode.containerInfo;Ie.nodeType===1?Ie.textContent="":Ie.nodeType===9&&Ie.documentElement&&Ie.removeChild(Ie.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(m(163))}}catch(Qe){_r(u,u.return,Qe)}if(a=u.sibling,a!==null){a.return=u.return,_t=a;break}_t=u.return}return yt=Ay,Ay=!1,yt}function dc(a,u,_){var T=u.updateQueue;if(T=T!==null?T.lastEffect:null,T!==null){var I=T=T.next;do{if((I.tag&a)===a){var D=I.destroy;I.destroy=void 0,D!==void 0&&ng(u,_,D)}I=I.next}while(I!==T)}}function ef(a,u){if(u=u.updateQueue,u=u!==null?u.lastEffect:null,u!==null){var _=u=u.next;do{if((_.tag&a)===a){var T=_.create;_.destroy=T()}_=_.next}while(_!==u)}}function rg(a){var u=a.ref;if(u!==null){var _=a.stateNode;switch(a.tag){case 5:a=_;break;default:a=_}typeof u=="function"?u(a):u.current=a}}function Ny(a){var u=a.alternate;u!==null&&(a.alternate=null,Ny(u)),a.child=null,a.deletions=null,a.sibling=null,a.tag===5&&(u=a.stateNode,u!==null&&(delete u[bo],delete u[Lu],delete u[g_],delete u[qw],delete u[Xw])),a.stateNode=null,a.return=null,a.dependencies=null,a.memoizedProps=null,a.memoizedState=null,a.pendingProps=null,a.stateNode=null,a.updateQueue=null}function ig(a){return a.tag===5||a.tag===3||a.tag===4}function Oy(a){e:for(;;){for(;a.sibling===null;){if(a.return===null||ig(a.return))return null;a=a.return}for(a.sibling.return=a.return,a=a.sibling;a.tag!==5&&a.tag!==6&&a.tag!==18;){if(a.flags&2||a.child===null||a.tag===4)continue e;a.child.return=a,a=a.child}if(!(a.flags&2))return a.stateNode}}function sg(a,u,_){var T=a.tag;if(T===5||T===6)a=a.stateNode,u?_.nodeType===8?_.parentNode.insertBefore(a,u):_.insertBefore(a,u):(_.nodeType===8?(u=_.parentNode,u.insertBefore(a,_)):(u=_,u.appendChild(a)),_=_._reactRootContainer,_!=null||u.onclick!==null||(u.onclick=xu));else if(T!==4&&(a=a.child,a!==null))for(sg(a,u,_),a=a.sibling;a!==null;)sg(a,u,_),a=a.sibling}function eh(a,u,_){var T=a.tag;if(T===5||T===6)a=a.stateNode,u?_.insertBefore(a,u):_.appendChild(a);else if(T!==4&&(a=a.child,a!==null))for(eh(a,u,_),a=a.sibling;a!==null;)eh(a,u,_),a=a.sibling}var pi=null,us=!1;function uc(a,u,_){for(_=_.child;_!==null;)og(a,u,_),_=_.sibling}function og(a,u,_){if(Ro&&typeof Ro.onCommitFiberUnmount=="function")try{Ro.onCommitFiberUnmount(jl,_)}catch{}switch(_.tag){case 5:hi||dl(_,u);case 6:var T=pi,I=us;pi=null,uc(a,u,_),pi=T,us=I,pi!==null&&(us?(a=pi,_=_.stateNode,a.nodeType===8?a.parentNode.removeChild(_):a.removeChild(_)):pi.removeChild(_.stateNode));break;case 18:pi!==null&&(us?(a=pi,_=_.stateNode,a.nodeType===8?Rp(a.parentNode,_):a.nodeType===1&&Rp(a,_),Wl(a)):Rp(pi,_.stateNode));break;case 4:T=pi,I=us,pi=_.stateNode.containerInfo,us=!0,uc(a,u,_),pi=T,us=I;break;case 0:case 11:case 14:case 15:if(!hi&&(T=_.updateQueue,T!==null&&(T=T.lastEffect,T!==null))){I=T=T.next;do{var D=I,q=D.destroy;D=D.tag,q!==void 0&&((D&2)!==0||(D&4)!==0)&&ng(_,u,q),I=I.next}while(I!==T)}uc(a,u,_);break;case 1:if(!hi&&(dl(_,u),T=_.stateNode,typeof T.componentWillUnmount=="function"))try{T.props=_.memoizedProps,T.state=_.memoizedState,T.componentWillUnmount()}catch(ce){_r(_,u,ce)}uc(a,u,_);break;case 21:uc(a,u,_);break;case 22:_.mode&1?(hi=(T=hi)||_.memoizedState!==null,uc(a,u,_),hi=T):uc(a,u,_);break;default:uc(a,u,_)}}function Py(a){var u=a.updateQueue;if(u!==null){a.updateQueue=null;var _=a.stateNode;_===null&&(_=a.stateNode=new iC),u.forEach(function(T){var I=gd.bind(null,a,T);_.has(T)||(_.add(T),T.then(I,I))})}}function to(a,u){var _=u.deletions;if(_!==null)for(var T=0;T<_.length;T++){var I=_[T];try{var D=a,q=u,ce=q;e:for(;ce!==null;){switch(ce.tag){case 5:pi=ce.stateNode,us=!1;break e;case 3:pi=ce.stateNode.containerInfo,us=!0;break e;case 4:pi=ce.stateNode.containerInfo,us=!0;break e}ce=ce.return}if(pi===null)throw Error(m(160));og(D,q,I),pi=null,us=!1;var he=I.alternate;he!==null&&(he.return=null),I.return=null}catch(Oe){_r(I,u,Oe)}}if(u.subtreeFlags&12854)for(u=u.child;u!==null;)ag(u,a),u=u.sibling}function ag(a,u){var _=a.alternate,T=a.flags;switch(a.tag){case 0:case 11:case 14:case 15:if(to(u,a),No(a),T&4){try{dc(3,a,a.return),ef(3,a)}catch(Tt){_r(a,a.return,Tt)}try{dc(5,a,a.return)}catch(Tt){_r(a,a.return,Tt)}}break;case 1:to(u,a),No(a),T&512&&_!==null&&dl(_,_.return);break;case 5:if(to(u,a),No(a),T&512&&_!==null&&dl(_,_.return),a.flags&32){var I=a.stateNode;try{Gs(I,"")}catch(Tt){_r(a,a.return,Tt)}}if(T&4&&(I=a.stateNode,I!=null)){var D=a.memoizedProps,q=_!==null?_.memoizedProps:D,ce=a.type,he=a.updateQueue;if(a.updateQueue=null,he!==null)try{ce==="input"&&D.type==="radio"&&D.name!=null&&Ei(I,D),fu(ce,q);var Oe=fu(ce,D);for(q=0;q<he.length;q+=2){var Ke=he[q],qe=he[q+1];Ke==="style"?Di(I,qe):Ke==="dangerouslySetInnerHTML"?Ll(I,qe):Ke==="children"?Gs(I,qe):se(I,Ke,qe,Oe)}switch(ce){case"input":ta(I,D);break;case"textarea":Vr(I,D);break;case"select":var He=I._wrapperState.wasMultiple;I._wrapperState.wasMultiple=!!D.multiple;var ft=D.value;ft!=null?Gi(I,!!D.multiple,ft,!1):He!==!!D.multiple&&(D.defaultValue!=null?Gi(I,!!D.multiple,D.defaultValue,!0):Gi(I,!!D.multiple,D.multiple?[]:"",!1))}I[Lu]=D}catch(Tt){_r(a,a.return,Tt)}}break;case 6:if(to(u,a),No(a),T&4){if(a.stateNode===null)throw Error(m(162));I=a.stateNode,D=a.memoizedProps;try{I.nodeValue=D}catch(Tt){_r(a,a.return,Tt)}}break;case 3:if(to(u,a),No(a),T&4&&_!==null&&_.memoizedState.isDehydrated)try{Wl(u.containerInfo)}catch(Tt){_r(a,a.return,Tt)}break;case 4:to(u,a),No(a);break;case 13:to(u,a),No(a),I=a.child,I.flags&8192&&(D=I.memoizedState!==null,I.stateNode.isHidden=D,!D||I.alternate!==null&&I.alternate.memoizedState!==null||(ug=Nr())),T&4&&Py(a);break;case 22:if(Ke=_!==null&&_.memoizedState!==null,a.mode&1?(hi=(Oe=hi)||Ke,to(u,a),hi=Oe):to(u,a),No(a),T&8192){if(Oe=a.memoizedState!==null,(a.stateNode.isHidden=Oe)&&!Ke&&(a.mode&1)!==0)for(_t=a,Ke=a.child;Ke!==null;){for(qe=_t=Ke;_t!==null;){switch(He=_t,ft=He.child,He.tag){case 0:case 11:case 14:case 15:dc(4,He,He.return);break;case 1:dl(He,He.return);var yt=He.stateNode;if(typeof yt.componentWillUnmount=="function"){T=He,_=He.return;try{u=T,yt.props=u.memoizedProps,yt.state=u.memoizedState,yt.componentWillUnmount()}catch(Tt){_r(T,_,Tt)}}break;case 5:dl(He,He.return);break;case 22:if(He.memoizedState!==null){tf(qe);continue}}ft!==null?(ft.return=He,_t=ft):tf(qe)}Ke=Ke.sibling}e:for(Ke=null,qe=a;;){if(qe.tag===5){if(Ke===null){Ke=qe;try{I=qe.stateNode,Oe?(D=I.style,typeof D.setProperty=="function"?D.setProperty("display","none","important"):D.display="none"):(ce=qe.stateNode,he=qe.memoizedProps.style,q=he!=null&&he.hasOwnProperty("display")?he.display:null,ce.style.display=Yc("display",q))}catch(Tt){_r(a,a.return,Tt)}}}else if(qe.tag===6){if(Ke===null)try{qe.stateNode.nodeValue=Oe?"":qe.memoizedProps}catch(Tt){_r(a,a.return,Tt)}}else if((qe.tag!==22&&qe.tag!==23||qe.memoizedState===null||qe===a)&&qe.child!==null){qe.child.return=qe,qe=qe.child;continue}if(qe===a)break e;for(;qe.sibling===null;){if(qe.return===null||qe.return===a)break e;Ke===qe&&(Ke=null),qe=qe.return}Ke===qe&&(Ke=null),qe.sibling.return=qe.return,qe=qe.sibling}}break;case 19:to(u,a),No(a),T&4&&Py(a);break;case 21:break;default:to(u,a),No(a)}}function No(a){var u=a.flags;if(u&2){try{e:{for(var _=a.return;_!==null;){if(ig(_)){var T=_;break e}_=_.return}throw Error(m(160))}switch(T.tag){case 5:var I=T.stateNode;T.flags&32&&(Gs(I,""),T.flags&=-33);var D=Oy(a);eh(a,D,I);break;case 3:case 4:var q=T.stateNode.containerInfo,ce=Oy(a);sg(a,ce,q);break;default:throw Error(m(161))}}catch(he){_r(a,a.return,he)}a.flags&=-3}u&4096&&(a.flags&=-4097)}function oC(a,u,_){_t=a,cg(a)}function cg(a,u,_){for(var T=(a.mode&1)!==0;_t!==null;){var I=_t,D=I.child;if(I.tag===22&&T){var q=I.memoizedState!==null||$u;if(!q){var ce=I.alternate,he=ce!==null&&ce.memoizedState!==null||hi;ce=$u;var Oe=hi;if($u=q,(hi=he)&&!Oe)for(_t=I;_t!==null;)q=_t,he=q.child,q.tag===22&&q.memoizedState!==null?Dy(I):he!==null?(he.return=q,_t=he):Dy(I);for(;D!==null;)_t=D,cg(D),D=D.sibling;_t=I,$u=ce,hi=Oe}lg(a)}else(I.subtreeFlags&8772)!==0&&D!==null?(D.return=I,_t=D):lg(a)}}function lg(a){for(;_t!==null;){var u=_t;if((u.flags&8772)!==0){var _=u.alternate;try{if((u.flags&8772)!==0)switch(u.tag){case 0:case 11:case 15:hi||ef(5,u);break;case 1:var T=u.stateNode;if(u.flags&4&&!hi)if(_===null)T.componentDidMount();else{var I=u.elementType===u.type?_.memoizedProps:Ts(u.type,_.memoizedProps);T.componentDidUpdate(I,_.memoizedState,T.__reactInternalSnapshotBeforeUpdate)}var D=u.updateQueue;D!==null&&iy(u,D,T);break;case 3:var q=u.updateQueue;if(q!==null){if(_=null,u.child!==null)switch(u.child.tag){case 5:_=u.child.stateNode;break;case 1:_=u.child.stateNode}iy(u,q,_)}break;case 5:var ce=u.stateNode;if(_===null&&u.flags&4){_=ce;var he=u.memoizedProps;switch(u.type){case"button":case"input":case"select":case"textarea":he.autoFocus&&_.focus();break;case"img":he.src&&(_.src=he.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(u.memoizedState===null){var Oe=u.alternate;if(Oe!==null){var Ke=Oe.memoizedState;if(Ke!==null){var qe=Ke.dehydrated;qe!==null&&Wl(qe)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(m(163))}hi||u.flags&512&&rg(u)}catch(He){_r(u,u.return,He)}}if(u===a){_t=null;break}if(_=u.sibling,_!==null){_.return=u.return,_t=_;break}_t=u.return}}function tf(a){for(;_t!==null;){var u=_t;if(u===a){_t=null;break}var _=u.sibling;if(_!==null){_.return=u.return,_t=_;break}_t=u.return}}function Dy(a){for(;_t!==null;){var u=_t;try{switch(u.tag){case 0:case 11:case 15:var _=u.return;try{ef(4,u)}catch(he){_r(u,_,he)}break;case 1:var T=u.stateNode;if(typeof T.componentDidMount=="function"){var I=u.return;try{T.componentDidMount()}catch(he){_r(u,I,he)}}var D=u.return;try{rg(u)}catch(he){_r(u,D,he)}break;case 5:var q=u.return;try{rg(u)}catch(he){_r(u,q,he)}}}catch(he){_r(u,u.return,he)}if(u===a){_t=null;break}var ce=u.sibling;if(ce!==null){ce.return=u.return,_t=ce;break}_t=u.return}}var aC=Math.ceil,hc=ae.ReactCurrentDispatcher,nf=ae.ReactCurrentOwner,Ti=ae.ReactCurrentBatchConfig,mn=0,Yr=null,Rr=null,Fr=0,hs=0,pd=Xs(0),qr=0,fd=null,ul=0,rf=0,dg=0,hl=null,Pr=null,ug=0,Rs=1/0,Oo=null,Ri=!1,hg=null,pc=null,th=!1,fc=null,nh=0,md=0,pg=null,rh=-1,sf=0;function Ui(){return(mn&6)!==0?Nr():rh!==-1?rh:rh=Nr()}function mc(a){return(a.mode&1)===0?1:(mn&2)!==0&&Fr!==0?Fr&-Fr:Vu.transition!==null?(sf===0&&(sf=Ev()),sf):(a=Un,a!==0||(a=window.event,a=a===void 0?16:Rv(a.type)),a)}function ps(a,u,_,T){if(50<md)throw md=0,pg=null,Error(m(185));gu(a,_,T),((mn&2)===0||a!==Yr)&&(a===Yr&&((mn&2)===0&&(rf|=_),qr===4&&_c(a,Fr)),wi(a,T),_===1&&mn===0&&(u.mode&1)===0&&(Rs=Nr()+500,Ip&&oc()))}function wi(a,u){var _=a.callbackNode;gv(a,u);var T=ap(a,a===Yr?Fr:0);if(T===0)_!==null&&hv(_),a.callbackNode=null,a.callbackPriority=0;else if(u=T&-T,a.callbackPriority!==u){if(_!=null&&hv(_),u===1)a.tag===0?Jw(of.bind(null,a)):y_(of.bind(null,a)),zw(function(){(mn&6)===0&&oc()}),_=null;else{switch(Gm(T)){case 1:_=Tr;break;case 4:_=pv;break;case 16:_=sp;break;case 536870912:_=fv;break;default:_=sp}_=yg(_,ky.bind(null,a))}a.callbackPriority=u,a.callbackNode=_}}function ky(a,u){if(rh=-1,sf=0,(mn&6)!==0)throw Error(m(327));var _=a.callbackNode;if(Ec()&&a.callbackNode!==_)return null;var T=ap(a,a===Yr?Fr:0);if(T===0)return null;if((T&30)!==0||(T&a.expiredLanes)!==0||u)u=oh(a,T);else{u=T;var I=mn;mn|=2;var D=_g();(Yr!==a||Fr!==u)&&(Oo=null,Rs=Nr()+500,_a(a,u));do try{lC();break}catch(ce){mg(a,ce)}while(!0);b_(),hc.current=D,mn=I,Rr!==null?u=0:(Yr=null,Fr=0,u=qr)}if(u!==0){if(u===2&&(I=Fm(a),I!==0&&(T=I,u=ih(a,I))),u===1)throw _=fd,_a(a,0),_c(a,T),wi(a,Nr()),_;if(u===6)_c(a,T);else{if(I=a.current.alternate,(T&30)===0&&!xy(I)&&(u=oh(a,T),u===2&&(D=Fm(a),D!==0&&(T=D,u=ih(a,D))),u===1))throw _=fd,_a(a,0),_c(a,T),wi(a,Nr()),_;switch(a.finishedWork=I,a.finishedLanes=T,u){case 0:case 1:throw Error(m(345));case 2:ws(a,Pr,Oo);break;case 3:if(_c(a,T),(T&130023424)===T&&(u=ug+500-Nr(),10<u)){if(ap(a,0)!==0)break;if(I=a.suspendedLanes,(I&T)!==T){Ui(),a.pingedLanes|=a.suspendedLanes&I;break}a.timeoutHandle=__(ws.bind(null,a,Pr,Oo),u);break}ws(a,Pr,Oo);break;case 4:if(_c(a,T),(T&4194240)===T)break;for(u=a.eventTimes,I=-1;0<T;){var q=31-zs(T);D=1<<q,q=u[q],q>I&&(I=q),T&=~D}if(T=I,T=Nr()-T,T=(120>T?120:480>T?480:1080>T?1080:1920>T?1920:3e3>T?3e3:4320>T?4320:1960*aC(T/1960))-T,10<T){a.timeoutHandle=__(ws.bind(null,a,Pr,Oo),T);break}ws(a,Pr,Oo);break;case 5:ws(a,Pr,Oo);break;default:throw Error(m(329))}}}return wi(a,Nr()),a.callbackNode===_?ky.bind(null,a):null}function ih(a,u){var _=hl;return a.current.memoizedState.isDehydrated&&(_a(a,u).flags|=256),a=oh(a,u),a!==2&&(u=Pr,Pr=_,u!==null&&fg(u)),a}function fg(a){Pr===null?Pr=a:Pr.push.apply(Pr,a)}function xy(a){for(var u=a;;){if(u.flags&16384){var _=u.updateQueue;if(_!==null&&(_=_.stores,_!==null))for(var T=0;T<_.length;T++){var I=_[T],D=I.getSnapshot;I=I.value;try{if(!Ys(D(),I))return!1}catch{return!1}}}if(_=u.child,u.subtreeFlags&16384&&_!==null)_.return=u,u=_;else{if(u===a)break;for(;u.sibling===null;){if(u.return===null||u.return===a)return!0;u=u.return}u.sibling.return=u.return,u=u.sibling}}return!0}function _c(a,u){for(u&=~dg,u&=~rf,a.suspendedLanes|=u,a.pingedLanes&=~u,a=a.expirationTimes;0<u;){var _=31-zs(u),T=1<<_;a[_]=-1,u&=~T}}function of(a){if((mn&6)!==0)throw Error(m(327));Ec();var u=ap(a,0);if((u&1)===0)return wi(a,Nr()),null;var _=oh(a,u);if(a.tag!==0&&_===2){var T=Fm(a);T!==0&&(u=T,_=ih(a,T))}if(_===1)throw _=fd,_a(a,0),_c(a,u),wi(a,Nr()),_;if(_===6)throw Error(m(345));return a.finishedWork=a.current.alternate,a.finishedLanes=u,ws(a,Pr,Oo),wi(a,Nr()),null}function pl(a,u){var _=mn;mn|=1;try{return a(u)}finally{mn=_,mn===0&&(Rs=Nr()+500,Ip&&oc())}}function gc(a){fc!==null&&fc.tag===0&&(mn&6)===0&&Ec();var u=mn;mn|=1;var _=Ti.transition,T=Un;try{if(Ti.transition=null,Un=1,a)return a()}finally{Un=T,Ti.transition=_,mn=u,(mn&6)===0&&oc()}}function sh(){hs=pd.current,Jn(pd)}function _a(a,u){a.finishedWork=null,a.finishedLanes=0;var _=a.timeoutHandle;if(_!==-1&&(a.timeoutHandle=-1,Kw(_)),Rr!==null)for(_=Rr.return;_!==null;){var T=_;switch(Op(T),T.tag){case 1:T=T.type.childContextTypes,T!=null&&Cp();break;case 3:sl(),Jn(xi),Jn(yi),x_();break;case 5:D_(T);break;case 4:sl();break;case 13:Jn(mr);break;case 19:Jn(mr);break;case 10:I_(T.type._context);break;case 22:case 23:sh()}_=_.return}if(Yr=a,Rr=a=vc(a.current,null),Fr=hs=u,qr=0,fd=null,dg=rf=ul=0,Pr=hl=null,rl!==null){for(u=0;u<rl.length;u++)if(_=rl[u],T=_.interleaved,T!==null){_.interleaved=null;var I=T.next,D=_.pending;if(D!==null){var q=D.next;D.next=I,T.next=q}_.pending=T}rl=null}return a}function mg(a,u){do{var _=Rr;try{if(b_(),Gu.current=ud,Hu){for(var T=hr.memoizedState;T!==null;){var I=T.queue;I!==null&&(I.pending=null),T=T.next}Hu=!1}if(ol=0,Or=zr=hr=null,ha=!1,Ku=0,nf.current=null,_===null||_.return===null){qr=1,fd=u,Rr=null;break}e:{var D=a,q=_.return,ce=_,he=u;if(u=Fr,ce.flags|=32768,he!==null&&typeof he=="object"&&typeof he.then=="function"){var Oe=he,Ke=ce,qe=Ke.tag;if((Ke.mode&1)===0&&(qe===0||qe===11||qe===15)){var He=Ke.alternate;He?(Ke.updateQueue=He.updateQueue,Ke.memoizedState=He.memoizedState,Ke.lanes=He.lanes):(Ke.updateQueue=null,Ke.memoizedState=null)}var ft=Ey(q);if(ft!==null){ft.flags&=-257,vy(ft,q,ce,D,u),ft.mode&1&&q_(D,Oe,u),u=ft,he=Oe;var yt=u.updateQueue;if(yt===null){var Tt=new Set;Tt.add(he),u.updateQueue=Tt}else yt.add(he);break e}else{if((u&1)===0){q_(D,Oe,u),_d();break e}he=Error(m(426))}}else if(ar&&ce.mode&1){var gr=Ey(q);if(gr!==null){(gr.flags&65536)===0&&(gr.flags|=256),vy(gr,q,ce,D,u),od(hd(he,ce));break e}}D=he=hd(he,ce),qr!==4&&(qr=2),hl===null?hl=[D]:hl.push(D),D=q;do{switch(D.tag){case 3:D.flags|=65536,u&=-u,D.lanes|=u;var ye=Y_(D,he,u);ry(D,ye);break e;case 1:ce=he;var me=D.type,Ie=D.stateNode;if((D.flags&128)===0&&(typeof me.getDerivedStateFromError=="function"||Ie!==null&&typeof Ie.componentDidCatch=="function"&&(pc===null||!pc.has(Ie)))){D.flags|=65536,u&=-u,D.lanes|=u;var Qe=gy(D,ce,u);ry(D,Qe);break e}}D=D.return}while(D!==null)}Eg(_)}catch(Rt){u=Rt,Rr===_&&_!==null&&(Rr=_=_.return);continue}break}while(!0)}function _g(){var a=hc.current;return hc.current=ud,a===null?ud:a}function _d(){(qr===0||qr===3||qr===2)&&(qr=4),Yr===null||(ul&268435455)===0&&(rf&268435455)===0||_c(Yr,Fr)}function oh(a,u){var _=mn;mn|=2;var T=_g();(Yr!==a||Fr!==u)&&(Oo=null,_a(a,u));do try{cC();break}catch(I){mg(a,I)}while(!0);if(b_(),mn=_,hc.current=T,Rr!==null)throw Error(m(261));return Yr=null,Fr=0,qr}function cC(){for(;Rr!==null;)gg(Rr)}function lC(){for(;Rr!==null&&!lw();)gg(Rr)}function gg(a){var u=Uy(a.alternate,a,hs);a.memoizedProps=a.pendingProps,u===null?Eg(a):Rr=u,nf.current=null}function Eg(a){var u=a;do{var _=u.alternate;if(a=u.return,(u.flags&32768)===0){if(_=$p(_,u,hs),_!==null){Rr=_;return}}else{if(_=rC(_,u),_!==null){_.flags&=32767,Rr=_;return}if(a!==null)a.flags|=32768,a.subtreeFlags=0,a.deletions=null;else{qr=6,Rr=null;return}}if(u=u.sibling,u!==null){Rr=u;return}Rr=u=a}while(u!==null);qr===0&&(qr=5)}function ws(a,u,_){var T=Un,I=Ti.transition;try{Ti.transition=null,Un=1,vg(a,u,_,T)}finally{Ti.transition=I,Un=T}return null}function vg(a,u,_,T){do Ec();while(fc!==null);if((mn&6)!==0)throw Error(m(327));_=a.finishedWork;var I=a.finishedLanes;if(_===null)return null;if(a.finishedWork=null,a.finishedLanes=0,_===a.current)throw Error(m(177));a.callbackNode=null,a.callbackPriority=0;var D=_.lanes|_.childLanes;if(fw(a,D),a===Yr&&(Rr=Yr=null,Fr=0),(_.subtreeFlags&2064)===0&&(_.flags&2064)===0||th||(th=!0,yg(sp,function(){return Ec(),null})),D=(_.flags&15990)!==0,(_.subtreeFlags&15990)!==0||D){D=Ti.transition,Ti.transition=null;var q=Un;Un=1;var ce=mn;mn|=4,nf.current=null,sC(a,_),ag(_,a),Fw(Tp),hp=!!m_,Tp=m_=null,a.current=_,oC(_),To(),mn=ce,Un=q,Ti.transition=D}else a.current=_;if(th&&(th=!1,fc=a,nh=I),D=a.pendingLanes,D===0&&(pc=null),mv(_.stateNode),wi(a,Nr()),u!==null)for(T=a.onRecoverableError,_=0;_<u.length;_++)I=u[_],T(I.value,{componentStack:I.stack,digest:I.digest});if(Ri)throw Ri=!1,a=hg,hg=null,a;return(nh&1)!==0&&a.tag!==0&&Ec(),D=a.pendingLanes,(D&1)!==0?a===pg?md++:(md=0,pg=a):md=0,oc(),null}function Ec(){if(fc!==null){var a=Gm(nh),u=Ti.transition,_=Un;try{if(Ti.transition=null,Un=16>a?16:a,fc===null)var T=!1;else{if(a=fc,fc=null,nh=0,(mn&6)!==0)throw Error(m(331));var I=mn;for(mn|=4,_t=a.current;_t!==null;){var D=_t,q=D.child;if((_t.flags&16)!==0){var ce=D.deletions;if(ce!==null){for(var he=0;he<ce.length;he++){var Oe=ce[he];for(_t=Oe;_t!==null;){var Ke=_t;switch(Ke.tag){case 0:case 11:case 15:dc(8,Ke,D)}var qe=Ke.child;if(qe!==null)qe.return=Ke,_t=qe;else for(;_t!==null;){Ke=_t;var He=Ke.sibling,ft=Ke.return;if(Ny(Ke),Ke===Oe){_t=null;break}if(He!==null){He.return=ft,_t=He;break}_t=ft}}}var yt=D.alternate;if(yt!==null){var Tt=yt.child;if(Tt!==null){yt.child=null;do{var gr=Tt.sibling;Tt.sibling=null,Tt=gr}while(Tt!==null)}}_t=D}}if((D.subtreeFlags&2064)!==0&&q!==null)q.return=D,_t=q;else e:for(;_t!==null;){if(D=_t,(D.flags&2048)!==0)switch(D.tag){case 0:case 11:case 15:dc(9,D,D.return)}var ye=D.sibling;if(ye!==null){ye.return=D.return,_t=ye;break e}_t=D.return}}var me=a.current;for(_t=me;_t!==null;){q=_t;var Ie=q.child;if((q.subtreeFlags&2064)!==0&&Ie!==null)Ie.return=q,_t=Ie;else e:for(q=me;_t!==null;){if(ce=_t,(ce.flags&2048)!==0)try{switch(ce.tag){case 0:case 11:case 15:ef(9,ce)}}catch(Rt){_r(ce,ce.return,Rt)}if(ce===q){_t=null;break e}var Qe=ce.sibling;if(Qe!==null){Qe.return=ce.return,_t=Qe;break e}_t=ce.return}}if(mn=I,oc(),Ro&&typeof Ro.onPostCommitFiberRoot=="function")try{Ro.onPostCommitFiberRoot(jl,a)}catch{}T=!0}return T}finally{Un=_,Ti.transition=u}}return!1}function af(a,u,_){u=hd(_,u),u=Y_(a,u,1),a=Zs(a,u,1),u=Ui(),a!==null&&(gu(a,1,u),wi(a,u))}function _r(a,u,_){if(a.tag===3)af(a,a,_);else for(;u!==null;){if(u.tag===3){af(u,a,_);break}else if(u.tag===1){var T=u.stateNode;if(typeof u.type.getDerivedStateFromError=="function"||typeof T.componentDidCatch=="function"&&(pc===null||!pc.has(T))){a=hd(_,a),a=gy(u,a,1),u=Zs(u,a,1),a=Ui(),u!==null&&(gu(u,1,a),wi(u,a));break}}u=u.return}}function Ly(a,u,_){var T=a.pingCache;T!==null&&T.delete(u),u=Ui(),a.pingedLanes|=a.suspendedLanes&_,Yr===a&&(Fr&_)===_&&(qr===4||qr===3&&(Fr&130023424)===Fr&&500>Nr()-ug?_a(a,0):dg|=_),wi(a,u)}function My(a,u){u===0&&((a.mode&1)===0?u=1:(u=op,op<<=1,(op&130023424)===0&&(op=4194304)));var _=Ui();a=la(a,u),a!==null&&(gu(a,u,_),wi(a,_))}function dC(a){var u=a.memoizedState,_=0;u!==null&&(_=u.retryLane),My(a,_)}function gd(a,u){var _=0;switch(a.tag){case 13:var T=a.stateNode,I=a.memoizedState;I!==null&&(_=I.retryLane);break;case 19:T=a.stateNode;break;default:throw Error(m(314))}T!==null&&T.delete(u),My(a,_)}var Uy;Uy=function(a,u,_){if(a!==null)if(a.memoizedProps!==u.pendingProps||xi.current)Ji=!0;else{if((a.lanes&_)===0&&(u.flags&128)===0)return Ji=!1,Jp(a,u,_);Ji=(a.flags&131072)!==0}else Ji=!1,ar&&(u.flags&1048576)!==0&&Zv(u,Np,u.index);switch(u.lanes=0,u.tag){case 2:var T=u.type;Xp(a,u),a=u.pendingProps;var I=sc(u,yi.current);Qs(u,_),I=ld(null,u,T,a,I,_);var D=U_();return u.flags|=1,typeof I=="object"&&I!==null&&typeof I.render=="function"&&I.$$typeof===void 0?(u.tag=1,u.memoizedState=null,u.updateQueue=null,qi(T)?(D=!0,bp(u)):D=!1,u.memoizedState=I.state!==null&&I.state!==void 0?I.state:null,O_(u),I.updater=Kp,u.stateNode=I,I._reactInternals=u,H_(u,T,a,_),u=Q_(null,u,T,!0,D,_)):(u.tag=0,ar&&D&&id(u),Mi(null,u,I,_),u=u.child),u;case 16:T=u.elementType;e:{switch(Xp(a,u),a=u.pendingProps,I=T._init,T=I(T._payload),u.type=T,I=u.tag=uC(T),a=Ts(T,a),I){case 0:u=J_(null,u,T,a,_);break e;case 1:u=Ry(null,u,T,a,_);break e;case 11:u=yy(null,u,T,a,_);break e;case 14:u=Sy(null,u,T,Ts(T.type,a),_);break e}throw Error(m(306,T,""))}return u;case 0:return T=u.type,I=u.pendingProps,I=u.elementType===T?I:Ts(T,I),J_(a,u,T,I,_);case 1:return T=u.type,I=u.pendingProps,I=u.elementType===T?I:Ts(T,I),Ry(a,u,T,I,_);case 3:e:{if(wy(u),a===null)throw Error(m(387));T=u.pendingProps,D=u.memoizedState,I=D.element,ny(a,u),Mp(u,T,null,_);var q=u.memoizedState;if(T=q.element,D.isDehydrated)if(D={element:T,isDehydrated:!1,cache:q.cache,pendingSuspenseBoundaries:q.pendingSuspenseBoundaries,transitions:q.transitions},u.updateQueue.baseState=D,u.memoizedState=D,u.flags&256){I=hd(Error(m(423)),u),u=Cy(a,u,T,_,I);break e}else if(T!==I){I=hd(Error(m(424)),u),u=Cy(a,u,T,_,I);break e}else for(ds=Co(u.stateNode.containerInfo.firstChild),ls=u,ar=!0,Js=null,_=w_(u,null,T,_),u.child=_;_;)_.flags=_.flags&-3|4096,_=_.sibling;else{if(nl(),T===I){u=ma(a,u,_);break e}Mi(a,u,T,_)}u=u.child}return u;case 5:return sy(u),a===null&&ju(u),T=u.type,I=u.pendingProps,D=a!==null?a.memoizedProps:null,q=I.children,ed(T,I)?q=null:D!==null&&ed(T,D)&&(u.flags|=32),Ty(a,u),Mi(a,u,q,_),u.child;case 6:return a===null&&ju(u),null;case 13:return by(a,u,_);case 4:return P_(u,u.stateNode.containerInfo),T=u.pendingProps,a===null?u.child=ad(u,null,T,_):Mi(a,u,T,_),u.child;case 11:return T=u.type,I=u.pendingProps,I=u.elementType===T?I:Ts(T,I),yy(a,u,T,I,_);case 7:return Mi(a,u,u.pendingProps,_),u.child;case 8:return Mi(a,u,u.pendingProps.children,_),u.child;case 12:return Mi(a,u,u.pendingProps.children,_),u.child;case 10:e:{if(T=u.type._context,I=u.pendingProps,D=u.memoizedProps,q=I.value,nr(Dp,T._currentValue),T._currentValue=q,D!==null)if(Ys(D.value,q)){if(D.children===I.children&&!xi.current){u=ma(a,u,_);break e}}else for(D=u.child,D!==null&&(D.return=u);D!==null;){var ce=D.dependencies;if(ce!==null){q=D.child;for(var he=ce.firstContext;he!==null;){if(he.context===T){if(D.tag===1){he=ua(-1,_&-_),he.tag=2;var Oe=D.updateQueue;if(Oe!==null){Oe=Oe.shared;var Ke=Oe.pending;Ke===null?he.next=he:(he.next=Ke.next,Ke.next=he),Oe.pending=he}}D.lanes|=_,he=D.alternate,he!==null&&(he.lanes|=_),xp(D.return,_,u),ce.lanes|=_;break}he=he.next}}else if(D.tag===10)q=D.type===u.type?null:D.child;else if(D.tag===18){if(q=D.return,q===null)throw Error(m(341));q.lanes|=_,ce=q.alternate,ce!==null&&(ce.lanes|=_),xp(q,_,u),q=D.sibling}else q=D.child;if(q!==null)q.return=D;else for(q=D;q!==null;){if(q===u){q=null;break}if(D=q.sibling,D!==null){D.return=q.return,q=D;break}q=q.return}D=q}Mi(a,u,I.children,_),u=u.child}return u;case 9:return I=u.type,T=u.pendingProps.children,Qs(u,_),I=Ss(I),T=T(I),u.flags|=1,Mi(a,u,T,_),u.child;case 14:return T=u.type,I=Ts(T,u.pendingProps),I=Ts(T.type,I),Sy(a,u,T,I,_);case 15:return X_(a,u,u.type,u.pendingProps,_);case 17:return T=u.type,I=u.pendingProps,I=u.elementType===T?I:Ts(T,I),Xp(a,u),u.tag=1,qi(T)?(a=!0,bp(u)):a=!1,Qs(u,_),my(u,T,I),H_(u,T,I,_),Q_(null,u,T,!0,a,_);case 19:return eg(a,u,_);case 22:return Ao(a,u,_)}throw Error(m(156,u.tag))};function yg(a,u){return Jc(a,u)}function Sg(a,u,_,T){this.tag=a,this.key=_,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=u,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=T,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Cs(a,u,_,T){return new Sg(a,u,_,T)}function Tg(a){return a=a.prototype,!(!a||!a.isReactComponent)}function uC(a){if(typeof a=="function")return Tg(a)?1:0;if(a!=null){if(a=a.$$typeof,a===Ge)return 11;if(a===wt)return 14}return 2}function vc(a,u){var _=a.alternate;return _===null?(_=Cs(a.tag,u,a.key,a.mode),_.elementType=a.elementType,_.type=a.type,_.stateNode=a.stateNode,_.alternate=a,a.alternate=_):(_.pendingProps=u,_.type=a.type,_.flags=0,_.subtreeFlags=0,_.deletions=null),_.flags=a.flags&14680064,_.childLanes=a.childLanes,_.lanes=a.lanes,_.child=a.child,_.memoizedProps=a.memoizedProps,_.memoizedState=a.memoizedState,_.updateQueue=a.updateQueue,u=a.dependencies,_.dependencies=u===null?null:{lanes:u.lanes,firstContext:u.firstContext},_.sibling=a.sibling,_.index=a.index,_.ref=a.ref,_}function Ed(a,u,_,T,I,D){var q=2;if(T=a,typeof a=="function")Tg(a)&&(q=1);else if(typeof a=="string")q=5;else e:switch(a){case Te:return yc(_.children,I,D,u);case Ue:q=8,I|=8;break;case tt:return a=Cs(12,_,u,I|2),a.elementType=tt,a.lanes=D,a;case pt:return a=Cs(13,_,u,I),a.elementType=pt,a.lanes=D,a;case Fe:return a=Cs(19,_,u,I),a.elementType=Fe,a.lanes=D,a;case Je:return ah(_,I,D,u);default:if(typeof a=="object"&&a!==null)switch(a.$$typeof){case gt:q=10;break e;case ht:q=9;break e;case Ge:q=11;break e;case wt:q=14;break e;case rt:q=16,T=null;break e}throw Error(m(130,a==null?a:typeof a,""))}return u=Cs(q,_,u,I),u.elementType=a,u.type=T,u.lanes=D,u}function yc(a,u,_,T){return a=Cs(7,a,T,u),a.lanes=_,a}function ah(a,u,_,T){return a=Cs(22,a,T,u),a.elementType=Je,a.lanes=_,a.stateNode={isHidden:!1},a}function cf(a,u,_){return a=Cs(6,a,null,u),a.lanes=_,a}function vd(a,u,_){return u=Cs(4,a.children!==null?a.children:[],a.key,u),u.lanes=_,u.stateNode={containerInfo:a.containerInfo,pendingChildren:null,implementation:a.implementation},u}function Rg(a,u,_,T,I){this.tag=u,this.containerInfo=a,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Bm(0),this.expirationTimes=Bm(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Bm(0),this.identifierPrefix=T,this.onRecoverableError=I,this.mutableSourceEagerHydrationData=null}function yd(a,u,_,T,I,D,q,ce,he){return a=new Rg(a,u,_,ce,he),u===1?(u=1,D===!0&&(u|=8)):u=0,D=Cs(3,null,null,u),a.current=D,D.stateNode=a,D.memoizedState={element:T,isDehydrated:_,cache:null,transitions:null,pendingSuspenseBoundaries:null},O_(D),a}function lf(a,u,_){var T=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Se,key:T==null?null:""+T,children:a,containerInfo:u,implementation:_}}function wg(a){if(!a)return rc;a=a._reactInternals;e:{if(Xc(a)!==a||a.tag!==1)throw Error(m(170));var u=a;do{switch(u.tag){case 3:u=u.stateNode.context;break e;case 1:if(qi(u.type)){u=u.stateNode.__reactInternalMemoizedMergedChildContext;break e}}u=u.return}while(u!==null);throw Error(m(171))}if(a.tag===1){var _=a.type;if(qi(_))return Jv(a,_,u)}return u}function fl(a,u,_,T,I,D,q,ce,he){return a=yd(_,T,!0,a,I,D,q,ce,he),a.context=wg(null),_=a.current,T=Ui(),I=mc(_),D=ua(T,I),D.callback=u??null,Zs(_,D,I),a.current.lanes=I,gu(a,I,T),wi(a,T),a}function Po(a,u,_,T){var I=u.current,D=Ui(),q=mc(I);return _=wg(_),u.context===null?u.context=_:u.pendingContext=_,u=ua(D,q),u.payload={element:a},T=T===void 0?null:T,T!==null&&(u.callback=T),a=Zs(I,u,q),a!==null&&(ps(a,I,q,D),Lp(a,I,q)),q}function df(a){if(a=a.current,!a.child)return null;switch(a.child.tag){case 5:return a.child.stateNode;default:return a.child.stateNode}}function Sd(a,u){if(a=a.memoizedState,a!==null&&a.dehydrated!==null){var _=a.retryLane;a.retryLane=_!==0&&_<u?_:u}}function Cg(a,u){Sd(a,u),(a=a.alternate)&&Sd(a,u)}function hC(){return null}var jy=typeof reportError=="function"?reportError:function(a){console.error(a)};function bg(a){this._internalRoot=a}ch.prototype.render=bg.prototype.render=function(a){var u=this._internalRoot;if(u===null)throw Error(m(409));Po(a,u,null,null)},ch.prototype.unmount=bg.prototype.unmount=function(){var a=this._internalRoot;if(a!==null){this._internalRoot=null;var u=a.containerInfo;gc(function(){Po(null,a,null,null)}),u[ia]=null}};function ch(a){this._internalRoot=a}ch.prototype.unstable_scheduleHydration=function(a){if(a){var u=vv();a={blockedOn:null,target:a,priority:u};for(var _=0;_<Ja.length&&u!==0&&u<Ja[_].priority;_++);Ja.splice(_,0,a),_===0&&Bl(a)}};function lh(a){return!(!a||a.nodeType!==1&&a.nodeType!==9&&a.nodeType!==11)}function dh(a){return!(!a||a.nodeType!==1&&a.nodeType!==9&&a.nodeType!==11&&(a.nodeType!==8||a.nodeValue!==" react-mount-point-unstable "))}function Vy(){}function Fy(a,u,_,T,I){if(I){if(typeof T=="function"){var D=T;T=function(){var Oe=df(q);D.call(Oe)}}var q=fl(u,T,a,0,null,!1,!1,"",Vy);return a._reactRootContainer=q,a[ia]=q.current,ra(a.nodeType===8?a.parentNode:a),gc(),q}for(;I=a.lastChild;)a.removeChild(I);if(typeof T=="function"){var ce=T;T=function(){var Oe=df(he);ce.call(Oe)}}var he=yd(a,0,!1,null,null,!1,!1,"",Vy);return a._reactRootContainer=he,a[ia]=he.current,ra(a.nodeType===8?a.parentNode:a),gc(function(){Po(u,he,_,T)}),he}function uf(a,u,_,T,I){var D=_._reactRootContainer;if(D){var q=D;if(typeof I=="function"){var ce=I;I=function(){var he=df(q);ce.call(he)}}Po(u,q,a,I)}else q=Fy(_,u,a,I,T);return df(q)}cp=function(a){switch(a.tag){case 3:var u=a.stateNode;if(u.current.memoizedState.isDehydrated){var _=Mn(u.pendingLanes);_!==0&&(Wm(u,_|1),wi(u,Nr()),(mn&6)===0&&(Rs=Nr()+500,oc()))}break;case 13:gc(function(){var T=la(a,1);if(T!==null){var I=Ui();ps(T,a,1,I)}}),Cg(a,1)}},Hm=function(a){if(a.tag===13){var u=la(a,134217728);if(u!==null){var _=Ui();ps(u,a,134217728,_)}Cg(a,134217728)}},lp=function(a){if(a.tag===13){var u=mc(a),_=la(a,u);if(_!==null){var T=Ui();ps(_,a,u,T)}Cg(a,u)}},vv=function(){return Un},Km=function(a,u){var _=Un;try{return Un=a,u()}finally{Un=_}},Ml=function(a,u,_){switch(u){case"input":if(ta(a,_),u=_.name,_.type==="radio"&&u!=null){for(_=a;_.parentNode;)_=_.parentNode;for(_=_.querySelectorAll("input[name="+JSON.stringify(""+u)+'][type="radio"]'),u=0;u<_.length;u++){var T=_[u];if(T!==a&&T.form===a.form){var I=wp(T);if(!I)throw Error(m(90));Yn(T),ta(T,I)}}}break;case"textarea":Vr(a,_);break;case"select":u=_.value,u!=null&&Gi(a,!!_.multiple,u,!1)}},yn=pl,qn=gc;var uh={usingClientEntryPoint:!1,Events:[Mu,td,wp,za,Xt,pl]},Qi={findFiberByHostInstance:$c,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},By={bundleType:Qi.bundleType,version:Qi.version,rendererPackageName:Qi.rendererPackageName,rendererConfig:Qi.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:ae.ReactCurrentDispatcher,findHostInstanceByFiber:function(a){return a=ip(a),a===null?null:a.stateNode},findFiberByHostInstance:Qi.findFiberByHostInstance||hC,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var hf=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!hf.isDisabled&&hf.supportsFiber)try{jl=hf.inject(By),Ro=hf}catch{}}return Vs.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=uh,Vs.createPortal=function(a,u){var _=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!lh(u))throw Error(m(200));return lf(a,u,null,_)},Vs.createRoot=function(a,u){if(!lh(a))throw Error(m(299));var _=!1,T="",I=jy;return u!=null&&(u.unstable_strictMode===!0&&(_=!0),u.identifierPrefix!==void 0&&(T=u.identifierPrefix),u.onRecoverableError!==void 0&&(I=u.onRecoverableError)),u=yd(a,1,!1,null,null,_,!1,T,I),a[ia]=u.current,ra(a.nodeType===8?a.parentNode:a),new bg(u)},Vs.findDOMNode=function(a){if(a==null)return null;if(a.nodeType===1)return a;var u=a._reactInternals;if(u===void 0)throw typeof a.render=="function"?Error(m(188)):(a=Object.keys(a).join(","),Error(m(268,a)));return a=ip(u),a=a===null?null:a.stateNode,a},Vs.flushSync=function(a){return gc(a)},Vs.hydrate=function(a,u,_){if(!dh(u))throw Error(m(200));return uf(null,a,u,!0,_)},Vs.hydrateRoot=function(a,u,_){if(!lh(a))throw Error(m(405));var T=_!=null&&_.hydratedSources||null,I=!1,D="",q=jy;if(_!=null&&(_.unstable_strictMode===!0&&(I=!0),_.identifierPrefix!==void 0&&(D=_.identifierPrefix),_.onRecoverableError!==void 0&&(q=_.onRecoverableError)),u=fl(u,null,a,1,_??null,I,!1,D,q),a[ia]=u.current,ra(a),T)for(a=0;a<T.length;a++)_=T[a],I=_._getVersion,I=I(_._source),u.mutableSourceEagerHydrationData==null?u.mutableSourceEagerHydrationData=[_,I]:u.mutableSourceEagerHydrationData.push(_,I);return new ch(u)},Vs.render=function(a,u,_){if(!dh(u))throw Error(m(200));return uf(null,a,u,!1,_)},Vs.unmountComponentAtNode=function(a){if(!dh(a))throw Error(m(40));return a._reactRootContainer?(gc(function(){uf(null,null,a,!1,function(){a._reactRootContainer=null,a[ia]=null})}),!0):!1},Vs.unstable_batchedUpdates=pl,Vs.unstable_renderSubtreeIntoContainer=function(a,u,_,T){if(!dh(_))throw Error(m(200));if(a==null||a._reactInternals===void 0)throw Error(m(38));return uf(a,u,_,!1,T)},Vs.version="18.3.1-next-f1338f8080-20240426",Vs}var qV;function iB(){if(qV)return mA.exports;qV=1;function l(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(l)}catch(p){console.error(p)}}return l(),mA.exports=QX(),mA.exports}var XV;function ZX(){if(XV)return hR;XV=1;var l=iB();return hR.createRoot=l.createRoot,hR.hydrateRoot=l.hydrateRoot,hR}var $X=ZX(),L=VR();const nt=cN(L),lN=KX({__proto__:null,default:nt},[L]),eJ=1,tJ=1e6;let EA=0;function nJ(){return EA=(EA+1)%Number.MAX_SAFE_INTEGER,EA.toString()}const vA=new Map,JV=l=>{if(vA.has(l))return;const p=setTimeout(()=>{vA.delete(l),KE({type:"REMOVE_TOAST",toastId:l})},tJ);vA.set(l,p)},rJ=(l,p)=>{switch(p.type){case"ADD_TOAST":return{...l,toasts:[p.toast,...l.toasts].slice(0,eJ)};case"UPDATE_TOAST":return{...l,toasts:l.toasts.map(m=>m.id===p.toast.id?{...m,...p.toast}:m)};case"DISMISS_TOAST":{const{toastId:m}=p;return m?JV(m):l.toasts.forEach(y=>{JV(y.id)}),{...l,toasts:l.toasts.map(y=>y.id===m||m===void 0?{...y,open:!1}:y)}}case"REMOVE_TOAST":return p.toastId===void 0?{...l,toasts:[]}:{...l,toasts:l.toasts.filter(m=>m.id!==p.toastId)}}},RR=[];let wR={toasts:[]};function KE(l){wR=rJ(wR,l),RR.forEach(p=>{p(wR)})}function iJ({...l}){const p=nJ(),m=R=>KE({type:"UPDATE_TOAST",toast:{...R,id:p}}),y=()=>KE({type:"DISMISS_TOAST",toastId:p});return KE({type:"ADD_TOAST",toast:{...l,id:p,open:!0,onOpenChange:R=>{R||y()}}}),{id:p,dismiss:y,update:m}}function Gc(){const[l,p]=L.useState(wR);return L.useEffect(()=>(RR.push(p),()=>{const m=RR.indexOf(p);m>-1&&RR.splice(m,1)}),[l]),{...l,toast:iJ,dismiss:m=>KE({type:"DISMISS_TOAST",toastId:m})}}var Om=iB();const sB=cN(Om);function Ht(l,p,{checkForDefaultPrevented:m=!0}={}){return function(R){if(l?.(R),m===!1||!R.defaultPrevented)return p?.(R)}}function QV(l,p){if(typeof l=="function")return l(p);l!=null&&(l.current=p)}function oB(...l){return p=>{let m=!1;const y=l.map(R=>{const C=QV(R,p);return!m&&typeof C=="function"&&(m=!0),C});if(m)return()=>{for(let R=0;R<y.length;R++){const C=y[R];typeof C=="function"?C():QV(l[R],null)}}}}function or(...l){return L.useCallback(oB(...l),l)}function sJ(l,p){const m=L.createContext(p),y=C=>{const{children:P,...k}=C,M=L.useMemo(()=>k,Object.values(k));return v.jsx(m.Provider,{value:M,children:P})};y.displayName=l+"Provider";function R(C){const P=L.useContext(m);if(P)return P;if(p!==void 0)return p;throw new Error(`\`${C}\` must be used within \`${l}\``)}return[y,R]}function Hc(l,p=[]){let m=[];function y(C,P){const k=L.createContext(P),M=m.length;m=[...m,P];const F=K=>{const{scope:ee,children:X,...re}=K,G=ee?.[l]?.[M]||k,J=L.useMemo(()=>re,Object.values(re));return v.jsx(G.Provider,{value:J,children:X})};F.displayName=C+"Provider";function H(K,ee){const X=ee?.[l]?.[M]||k,re=L.useContext(X);if(re)return re;if(P!==void 0)return P;throw new Error(`\`${K}\` must be used within \`${C}\``)}return[F,H]}const R=()=>{const C=m.map(P=>L.createContext(P));return function(k){const M=k?.[l]||C;return L.useMemo(()=>({[`__scope${l}`]:{...k,[l]:M}}),[k,M])}};return R.scopeName=l,[y,oJ(R,...p)]}function oJ(...l){const p=l[0];if(l.length===1)return p;const m=()=>{const y=l.map(R=>({useScope:R(),scopeName:R.scopeName}));return function(C){const P=y.reduce((k,{useScope:M,scopeName:F})=>{const K=M(C)[`__scope${F}`];return{...k,...K}},{});return L.useMemo(()=>({[`__scope${p.scopeName}`]:P}),[P])}};return m.scopeName=p.scopeName,m}function Cm(l){const p=cJ(l),m=L.forwardRef((y,R)=>{const{children:C,...P}=y,k=L.Children.toArray(C),M=k.find(dJ);if(M){const F=M.props.children,H=k.map(K=>K===M?L.Children.count(F)>1?L.Children.only(null):L.isValidElement(F)?F.props.children:null:K);return v.jsx(p,{...P,ref:R,children:L.isValidElement(F)?L.cloneElement(F,void 0,H):null})}return v.jsx(p,{...P,ref:R,children:C})});return m.displayName=`${l}.Slot`,m}var aJ=Cm("Slot");function cJ(l){const p=L.forwardRef((m,y)=>{const{children:R,...C}=m;if(L.isValidElement(R)){const P=hJ(R),k=uJ(C,R.props);return R.type!==L.Fragment&&(k.ref=y?oB(y,P):P),L.cloneElement(R,k)}return L.Children.count(R)>1?L.Children.only(null):null});return p.displayName=`${l}.SlotClone`,p}var aB=Symbol("radix.slottable");function lJ(l){const p=({children:m})=>v.jsx(v.Fragment,{children:m});return p.displayName=`${l}.Slottable`,p.__radixId=aB,p}function dJ(l){return L.isValidElement(l)&&typeof l.type=="function"&&"__radixId"in l.type&&l.type.__radixId===aB}function uJ(l,p){const m={...p};for(const y in p){const R=l[y],C=p[y];/^on[A-Z]/.test(y)?R&&C?m[y]=(...k)=>{const M=C(...k);return R(...k),M}:R&&(m[y]=R):y==="style"?m[y]={...R,...C}:y==="className"&&(m[y]=[R,C].filter(Boolean).join(" "))}return{...l,...m}}function hJ(l){let p=Object.getOwnPropertyDescriptor(l.props,"ref")?.get,m=p&&"isReactWarning"in p&&p.isReactWarning;return m?l.ref:(p=Object.getOwnPropertyDescriptor(l,"ref")?.get,m=p&&"isReactWarning"in p&&p.isReactWarning,m?l.props.ref:l.props.ref||l.ref)}function dN(l){const p=l+"CollectionProvider",[m,y]=Hc(p),[R,C]=m(p,{collectionRef:{current:null},itemMap:new Map}),P=G=>{const{scope:J,children:te}=G,ne=nt.useRef(null),se=nt.useRef(new Map).current;return v.jsx(R,{scope:J,itemMap:se,collectionRef:ne,children:te})};P.displayName=p;const k=l+"CollectionSlot",M=Cm(k),F=nt.forwardRef((G,J)=>{const{scope:te,children:ne}=G,se=C(k,te),ae=or(J,se.collectionRef);return v.jsx(M,{ref:ae,children:ne})});F.displayName=k;const H=l+"CollectionItemSlot",K="data-radix-collection-item",ee=Cm(H),X=nt.forwardRef((G,J)=>{const{scope:te,children:ne,...se}=G,ae=nt.useRef(null),pe=or(J,ae),Se=C(H,te);return nt.useEffect(()=>(Se.itemMap.set(ae,{ref:ae,...se}),()=>void Se.itemMap.delete(ae))),v.jsx(ee,{[K]:"",ref:pe,children:ne})});X.displayName=H;function re(G){const J=C(l+"CollectionConsumer",G);return nt.useCallback(()=>{const ne=J.collectionRef.current;if(!ne)return[];const se=Array.from(ne.querySelectorAll(`[${K}]`));return Array.from(J.itemMap.values()).sort((Se,Te)=>se.indexOf(Se.ref.current)-se.indexOf(Te.ref.current))},[J.collectionRef,J.itemMap])}return[{Provider:P,Slot:F,ItemSlot:X},re,y]}var pJ=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],nn=pJ.reduce((l,p)=>{const m=Cm(`Primitive.${p}`),y=L.forwardRef((R,C)=>{const{asChild:P,...k}=R,M=P?m:p;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),v.jsx(M,{...k,ref:C})});return y.displayName=`Primitive.${p}`,{...l,[p]:y}},{});function cB(l,p){l&&Om.flushSync(()=>l.dispatchEvent(p))}function go(l){const p=L.useRef(l);return L.useEffect(()=>{p.current=l}),L.useMemo(()=>(...m)=>p.current?.(...m),[])}function fJ(l,p=globalThis?.document){const m=go(l);L.useEffect(()=>{const y=R=>{R.key==="Escape"&&m(R)};return p.addEventListener("keydown",y,{capture:!0}),()=>p.removeEventListener("keydown",y,{capture:!0})},[m,p])}var mJ="DismissableLayer",UA="dismissableLayer.update",_J="dismissableLayer.pointerDownOutside",gJ="dismissableLayer.focusOutside",ZV,lB=L.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),rv=L.forwardRef((l,p)=>{const{disableOutsidePointerEvents:m=!1,onEscapeKeyDown:y,onPointerDownOutside:R,onFocusOutside:C,onInteractOutside:P,onDismiss:k,...M}=l,F=L.useContext(lB),[H,K]=L.useState(null),ee=H?.ownerDocument??globalThis?.document,[,X]=L.useState({}),re=or(p,Te=>K(Te)),G=Array.from(F.layers),[J]=[...F.layersWithOutsidePointerEventsDisabled].slice(-1),te=G.indexOf(J),ne=H?G.indexOf(H):-1,se=F.layersWithOutsidePointerEventsDisabled.size>0,ae=ne>=te,pe=vJ(Te=>{const Ue=Te.target,tt=[...F.branches].some(gt=>gt.contains(Ue));!ae||tt||(R?.(Te),P?.(Te),Te.defaultPrevented||k?.())},ee),Se=yJ(Te=>{const Ue=Te.target;[...F.branches].some(gt=>gt.contains(Ue))||(C?.(Te),P?.(Te),Te.defaultPrevented||k?.())},ee);return fJ(Te=>{ne===F.layers.size-1&&(y?.(Te),!Te.defaultPrevented&&k&&(Te.preventDefault(),k()))},ee),L.useEffect(()=>{if(H)return m&&(F.layersWithOutsidePointerEventsDisabled.size===0&&(ZV=ee.body.style.pointerEvents,ee.body.style.pointerEvents="none"),F.layersWithOutsidePointerEventsDisabled.add(H)),F.layers.add(H),$V(),()=>{m&&F.layersWithOutsidePointerEventsDisabled.size===1&&(ee.body.style.pointerEvents=ZV)}},[H,ee,m,F]),L.useEffect(()=>()=>{H&&(F.layers.delete(H),F.layersWithOutsidePointerEventsDisabled.delete(H),$V())},[H,F]),L.useEffect(()=>{const Te=()=>X({});return document.addEventListener(UA,Te),()=>document.removeEventListener(UA,Te)},[]),v.jsx(nn.div,{...M,ref:re,style:{pointerEvents:se?ae?"auto":"none":void 0,...l.style},onFocusCapture:Ht(l.onFocusCapture,Se.onFocusCapture),onBlurCapture:Ht(l.onBlurCapture,Se.onBlurCapture),onPointerDownCapture:Ht(l.onPointerDownCapture,pe.onPointerDownCapture)})});rv.displayName=mJ;var EJ="DismissableLayerBranch",dB=L.forwardRef((l,p)=>{const m=L.useContext(lB),y=L.useRef(null),R=or(p,y);return L.useEffect(()=>{const C=y.current;if(C)return m.branches.add(C),()=>{m.branches.delete(C)}},[m.branches]),v.jsx(nn.div,{...l,ref:R})});dB.displayName=EJ;function vJ(l,p=globalThis?.document){const m=go(l),y=L.useRef(!1),R=L.useRef(()=>{});return L.useEffect(()=>{const C=k=>{if(k.target&&!y.current){let M=function(){uB(_J,m,F,{discrete:!0})};const F={originalEvent:k};k.pointerType==="touch"?(p.removeEventListener("click",R.current),R.current=M,p.addEventListener("click",R.current,{once:!0})):M()}else p.removeEventListener("click",R.current);y.current=!1},P=window.setTimeout(()=>{p.addEventListener("pointerdown",C)},0);return()=>{window.clearTimeout(P),p.removeEventListener("pointerdown",C),p.removeEventListener("click",R.current)}},[p,m]),{onPointerDownCapture:()=>y.current=!0}}function yJ(l,p=globalThis?.document){const m=go(l),y=L.useRef(!1);return L.useEffect(()=>{const R=C=>{C.target&&!y.current&&uB(gJ,m,{originalEvent:C},{discrete:!1})};return p.addEventListener("focusin",R),()=>p.removeEventListener("focusin",R)},[p,m]),{onFocusCapture:()=>y.current=!0,onBlurCapture:()=>y.current=!1}}function $V(){const l=new CustomEvent(UA);document.dispatchEvent(l)}function uB(l,p,m,{discrete:y}){const R=m.originalEvent.target,C=new CustomEvent(l,{bubbles:!1,cancelable:!0,detail:m});p&&R.addEventListener(l,p,{once:!0}),y?cB(R,C):R.dispatchEvent(C)}var SJ=rv,TJ=dB,ai=globalThis?.document?L.useLayoutEffect:()=>{},RJ="Portal",FR=L.forwardRef((l,p)=>{const{container:m,...y}=l,[R,C]=L.useState(!1);ai(()=>C(!0),[]);const P=m||R&&globalThis?.document?.body;return P?sB.createPortal(v.jsx(nn.div,{...y,ref:p}),P):null});FR.displayName=RJ;function wJ(l,p){return L.useReducer((m,y)=>p[m][y]??m,l)}var tp=l=>{const{present:p,children:m}=l,y=CJ(p),R=typeof m=="function"?m({present:y.isPresent}):L.Children.only(m),C=or(y.ref,bJ(R));return typeof m=="function"||y.isPresent?L.cloneElement(R,{ref:C}):null};tp.displayName="Presence";function CJ(l){const[p,m]=L.useState(),y=L.useRef(null),R=L.useRef(l),C=L.useRef("none"),P=l?"mounted":"unmounted",[k,M]=wJ(P,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return L.useEffect(()=>{const F=pR(y.current);C.current=k==="mounted"?F:"none"},[k]),ai(()=>{const F=y.current,H=R.current;if(H!==l){const ee=C.current,X=pR(F);l?M("MOUNT"):X==="none"||F?.display==="none"?M("UNMOUNT"):M(H&&ee!==X?"ANIMATION_OUT":"UNMOUNT"),R.current=l}},[l,M]),ai(()=>{if(p){let F;const H=p.ownerDocument.defaultView??window,K=X=>{const G=pR(y.current).includes(X.animationName);if(X.target===p&&G&&(M("ANIMATION_END"),!R.current)){const J=p.style.animationFillMode;p.style.animationFillMode="forwards",F=H.setTimeout(()=>{p.style.animationFillMode==="forwards"&&(p.style.animationFillMode=J)})}},ee=X=>{X.target===p&&(C.current=pR(y.current))};return p.addEventListener("animationstart",ee),p.addEventListener("animationcancel",K),p.addEventListener("animationend",K),()=>{H.clearTimeout(F),p.removeEventListener("animationstart",ee),p.removeEventListener("animationcancel",K),p.removeEventListener("animationend",K)}}else M("ANIMATION_END")},[p,M]),{isPresent:["mounted","unmountSuspended"].includes(k),ref:L.useCallback(F=>{y.current=F?getComputedStyle(F):null,m(F)},[])}}function pR(l){return l?.animationName||"none"}function bJ(l){let p=Object.getOwnPropertyDescriptor(l.props,"ref")?.get,m=p&&"isReactWarning"in p&&p.isReactWarning;return m?l.ref:(p=Object.getOwnPropertyDescriptor(l,"ref")?.get,m=p&&"isReactWarning"in p&&p.isReactWarning,m?l.props.ref:l.props.ref||l.ref)}var IJ=lN[" useInsertionEffect ".trim().toString()]||ai;function Jh({prop:l,defaultProp:p,onChange:m=()=>{},caller:y}){const[R,C,P]=AJ({defaultProp:p,onChange:m}),k=l!==void 0,M=k?l:R;{const H=L.useRef(l!==void 0);L.useEffect(()=>{const K=H.current;K!==k&&console.warn(`${y} is changing from ${K?"controlled":"uncontrolled"} to ${k?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),H.current=k},[k,y])}const F=L.useCallback(H=>{if(k){const K=NJ(H)?H(l):H;K!==l&&P.current?.(K)}else C(H)},[k,l,C,P]);return[M,F]}function AJ({defaultProp:l,onChange:p}){const[m,y]=L.useState(l),R=L.useRef(m),C=L.useRef(p);return IJ(()=>{C.current=p},[p]),L.useEffect(()=>{R.current!==m&&(C.current?.(m),R.current=m)},[m,R]),[m,y,C]}function NJ(l){return typeof l=="function"}var hB=Object.freeze({position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal"}),OJ="VisuallyHidden",BR=L.forwardRef((l,p)=>v.jsx(nn.span,{...l,ref:p,style:{...hB,...l.style}}));BR.displayName=OJ;var PJ=BR,uN="ToastProvider",[hN,DJ,kJ]=dN("Toast"),[pB]=Hc("Toast",[kJ]),[xJ,WR]=pB(uN),fB=l=>{const{__scopeToast:p,label:m="Notification",duration:y=5e3,swipeDirection:R="right",swipeThreshold:C=50,children:P}=l,[k,M]=L.useState(null),[F,H]=L.useState(0),K=L.useRef(!1),ee=L.useRef(!1);return m.trim()||console.error(`Invalid prop \`label\` supplied to \`${uN}\`. Expected non-empty \`string\`.`),v.jsx(hN.Provider,{scope:p,children:v.jsx(xJ,{scope:p,label:m,duration:y,swipeDirection:R,swipeThreshold:C,toastCount:F,viewport:k,onViewportChange:M,onToastAdd:L.useCallback(()=>H(X=>X+1),[]),onToastRemove:L.useCallback(()=>H(X=>X-1),[]),isFocusedToastEscapeKeyDownRef:K,isClosePausedRef:ee,children:P})})};fB.displayName=uN;var mB="ToastViewport",LJ=["F8"],jA="toast.viewportPause",VA="toast.viewportResume",_B=L.forwardRef((l,p)=>{const{__scopeToast:m,hotkey:y=LJ,label:R="Notifications ({hotkey})",...C}=l,P=WR(mB,m),k=DJ(m),M=L.useRef(null),F=L.useRef(null),H=L.useRef(null),K=L.useRef(null),ee=or(p,K,P.onViewportChange),X=y.join("+").replace(/Key/g,"").replace(/Digit/g,""),re=P.toastCount>0;L.useEffect(()=>{const J=te=>{y.length!==0&&y.every(se=>te[se]||te.code===se)&&K.current?.focus()};return document.addEventListener("keydown",J),()=>document.removeEventListener("keydown",J)},[y]),L.useEffect(()=>{const J=M.current,te=K.current;if(re&&J&&te){const ne=()=>{if(!P.isClosePausedRef.current){const Se=new CustomEvent(jA);te.dispatchEvent(Se),P.isClosePausedRef.current=!0}},se=()=>{if(P.isClosePausedRef.current){const Se=new CustomEvent(VA);te.dispatchEvent(Se),P.isClosePausedRef.current=!1}},ae=Se=>{!J.contains(Se.relatedTarget)&&se()},pe=()=>{J.contains(document.activeElement)||se()};return J.addEventListener("focusin",ne),J.addEventListener("focusout",ae),J.addEventListener("pointermove",ne),J.addEventListener("pointerleave",pe),window.addEventListener("blur",ne),window.addEventListener("focus",se),()=>{J.removeEventListener("focusin",ne),J.removeEventListener("focusout",ae),J.removeEventListener("pointermove",ne),J.removeEventListener("pointerleave",pe),window.removeEventListener("blur",ne),window.removeEventListener("focus",se)}}},[re,P.isClosePausedRef]);const G=L.useCallback(({tabbingDirection:J})=>{const ne=k().map(se=>{const ae=se.ref.current,pe=[ae,...qJ(ae)];return J==="forwards"?pe:pe.reverse()});return(J==="forwards"?ne.reverse():ne).flat()},[k]);return L.useEffect(()=>{const J=K.current;if(J){const te=ne=>{const se=ne.altKey||ne.ctrlKey||ne.metaKey;if(ne.key==="Tab"&&!se){const pe=document.activeElement,Se=ne.shiftKey;if(ne.target===J&&Se){F.current?.focus();return}const tt=G({tabbingDirection:Se?"backwards":"forwards"}),gt=tt.findIndex(ht=>ht===pe);yA(tt.slice(gt+1))?ne.preventDefault():Se?F.current?.focus():H.current?.focus()}};return J.addEventListener("keydown",te),()=>J.removeEventListener("keydown",te)}},[k,G]),v.jsxs(TJ,{ref:M,role:"region","aria-label":R.replace("{hotkey}",X),tabIndex:-1,style:{pointerEvents:re?void 0:"none"},children:[re&&v.jsx(FA,{ref:F,onFocusFromOutsideViewport:()=>{const J=G({tabbingDirection:"forwards"});yA(J)}}),v.jsx(hN.Slot,{scope:m,children:v.jsx(nn.ol,{tabIndex:-1,...C,ref:ee})}),re&&v.jsx(FA,{ref:H,onFocusFromOutsideViewport:()=>{const J=G({tabbingDirection:"backwards"});yA(J)}})]})});_B.displayName=mB;var gB="ToastFocusProxy",FA=L.forwardRef((l,p)=>{const{__scopeToast:m,onFocusFromOutsideViewport:y,...R}=l,C=WR(gB,m);return v.jsx(BR,{"aria-hidden":!0,tabIndex:0,...R,ref:p,style:{position:"fixed"},onFocus:P=>{const k=P.relatedTarget;!C.viewport?.contains(k)&&y()}})});FA.displayName=gB;var iv="Toast",MJ="toast.swipeStart",UJ="toast.swipeMove",jJ="toast.swipeCancel",VJ="toast.swipeEnd",EB=L.forwardRef((l,p)=>{const{forceMount:m,open:y,defaultOpen:R,onOpenChange:C,...P}=l,[k,M]=Jh({prop:y,defaultProp:R??!0,onChange:C,caller:iv});return v.jsx(tp,{present:m||k,children:v.jsx(WJ,{open:k,...P,ref:p,onClose:()=>M(!1),onPause:go(l.onPause),onResume:go(l.onResume),onSwipeStart:Ht(l.onSwipeStart,F=>{F.currentTarget.setAttribute("data-swipe","start")}),onSwipeMove:Ht(l.onSwipeMove,F=>{const{x:H,y:K}=F.detail.delta;F.currentTarget.setAttribute("data-swipe","move"),F.currentTarget.style.setProperty("--radix-toast-swipe-move-x",`${H}px`),F.currentTarget.style.setProperty("--radix-toast-swipe-move-y",`${K}px`)}),onSwipeCancel:Ht(l.onSwipeCancel,F=>{F.currentTarget.setAttribute("data-swipe","cancel"),F.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),F.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),F.currentTarget.style.removeProperty("--radix-toast-swipe-end-x"),F.currentTarget.style.removeProperty("--radix-toast-swipe-end-y")}),onSwipeEnd:Ht(l.onSwipeEnd,F=>{const{x:H,y:K}=F.detail.delta;F.currentTarget.setAttribute("data-swipe","end"),F.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),F.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),F.currentTarget.style.setProperty("--radix-toast-swipe-end-x",`${H}px`),F.currentTarget.style.setProperty("--radix-toast-swipe-end-y",`${K}px`),M(!1)})})})});EB.displayName=iv;var[FJ,BJ]=pB(iv,{onClose(){}}),WJ=L.forwardRef((l,p)=>{const{__scopeToast:m,type:y="foreground",duration:R,open:C,onClose:P,onEscapeKeyDown:k,onPause:M,onResume:F,onSwipeStart:H,onSwipeMove:K,onSwipeCancel:ee,onSwipeEnd:X,...re}=l,G=WR(iv,m),[J,te]=L.useState(null),ne=or(p,Fe=>te(Fe)),se=L.useRef(null),ae=L.useRef(null),pe=R||G.duration,Se=L.useRef(0),Te=L.useRef(pe),Ue=L.useRef(0),{onToastAdd:tt,onToastRemove:gt}=G,ht=go(()=>{J?.contains(document.activeElement)&&G.viewport?.focus(),P()}),Ge=L.useCallback(Fe=>{!Fe||Fe===1/0||(window.clearTimeout(Ue.current),Se.current=new Date().getTime(),Ue.current=window.setTimeout(ht,Fe))},[ht]);L.useEffect(()=>{const Fe=G.viewport;if(Fe){const wt=()=>{Ge(Te.current),F?.()},rt=()=>{const Je=new Date().getTime()-Se.current;Te.current=Te.current-Je,window.clearTimeout(Ue.current),M?.()};return Fe.addEventListener(jA,rt),Fe.addEventListener(VA,wt),()=>{Fe.removeEventListener(jA,rt),Fe.removeEventListener(VA,wt)}}},[G.viewport,pe,M,F,Ge]),L.useEffect(()=>{C&&!G.isClosePausedRef.current&&Ge(pe)},[C,pe,G.isClosePausedRef,Ge]),L.useEffect(()=>(tt(),()=>gt()),[tt,gt]);const pt=L.useMemo(()=>J?CB(J):null,[J]);return G.viewport?v.jsxs(v.Fragment,{children:[pt&&v.jsx(GJ,{__scopeToast:m,role:"status","aria-live":y==="foreground"?"assertive":"polite","aria-atomic":!0,children:pt}),v.jsx(FJ,{scope:m,onClose:ht,children:Om.createPortal(v.jsx(hN.ItemSlot,{scope:m,children:v.jsx(SJ,{asChild:!0,onEscapeKeyDown:Ht(k,()=>{G.isFocusedToastEscapeKeyDownRef.current||ht(),G.isFocusedToastEscapeKeyDownRef.current=!1}),children:v.jsx(nn.li,{role:"status","aria-live":"off","aria-atomic":!0,tabIndex:0,"data-state":C?"open":"closed","data-swipe-direction":G.swipeDirection,...re,ref:ne,style:{userSelect:"none",touchAction:"none",...l.style},onKeyDown:Ht(l.onKeyDown,Fe=>{Fe.key==="Escape"&&(k?.(Fe.nativeEvent),Fe.nativeEvent.defaultPrevented||(G.isFocusedToastEscapeKeyDownRef.current=!0,ht()))}),onPointerDown:Ht(l.onPointerDown,Fe=>{Fe.button===0&&(se.current={x:Fe.clientX,y:Fe.clientY})}),onPointerMove:Ht(l.onPointerMove,Fe=>{if(!se.current)return;const wt=Fe.clientX-se.current.x,rt=Fe.clientY-se.current.y,Je=!!ae.current,De=["left","right"].includes(G.swipeDirection),Le=["left","up"].includes(G.swipeDirection)?Math.min:Math.max,ze=De?Le(0,wt):0,fe=De?0:Le(0,rt),Ne=Fe.pointerType==="touch"?10:2,st={x:ze,y:fe},it={originalEvent:Fe,delta:st};Je?(ae.current=st,fR(UJ,K,it,{discrete:!1})):eF(st,G.swipeDirection,Ne)?(ae.current=st,fR(MJ,H,it,{discrete:!1}),Fe.target.setPointerCapture(Fe.pointerId)):(Math.abs(wt)>Ne||Math.abs(rt)>Ne)&&(se.current=null)}),onPointerUp:Ht(l.onPointerUp,Fe=>{const wt=ae.current,rt=Fe.target;if(rt.hasPointerCapture(Fe.pointerId)&&rt.releasePointerCapture(Fe.pointerId),ae.current=null,se.current=null,wt){const Je=Fe.currentTarget,De={originalEvent:Fe,delta:wt};eF(wt,G.swipeDirection,G.swipeThreshold)?fR(VJ,X,De,{discrete:!0}):fR(jJ,ee,De,{discrete:!0}),Je.addEventListener("click",Le=>Le.preventDefault(),{once:!0})}})})})}),G.viewport)})]}):null}),GJ=l=>{const{__scopeToast:p,children:m,...y}=l,R=WR(iv,p),[C,P]=L.useState(!1),[k,M]=L.useState(!1);return zJ(()=>P(!0)),L.useEffect(()=>{const F=window.setTimeout(()=>M(!0),1e3);return()=>window.clearTimeout(F)},[]),k?null:v.jsx(FR,{asChild:!0,children:v.jsx(BR,{...y,children:C&&v.jsxs(v.Fragment,{children:[R.label," ",m]})})})},HJ="ToastTitle",vB=L.forwardRef((l,p)=>{const{__scopeToast:m,...y}=l;return v.jsx(nn.div,{...y,ref:p})});vB.displayName=HJ;var KJ="ToastDescription",yB=L.forwardRef((l,p)=>{const{__scopeToast:m,...y}=l;return v.jsx(nn.div,{...y,ref:p})});yB.displayName=KJ;var SB="ToastAction",TB=L.forwardRef((l,p)=>{const{altText:m,...y}=l;return m.trim()?v.jsx(wB,{altText:m,asChild:!0,children:v.jsx(pN,{...y,ref:p})}):(console.error(`Invalid prop \`altText\` supplied to \`${SB}\`. Expected non-empty \`string\`.`),null)});TB.displayName=SB;var RB="ToastClose",pN=L.forwardRef((l,p)=>{const{__scopeToast:m,...y}=l,R=BJ(RB,m);return v.jsx(wB,{asChild:!0,children:v.jsx(nn.button,{type:"button",...y,ref:p,onClick:Ht(l.onClick,R.onClose)})})});pN.displayName=RB;var wB=L.forwardRef((l,p)=>{const{__scopeToast:m,altText:y,...R}=l;return v.jsx(nn.div,{"data-radix-toast-announce-exclude":"","data-radix-toast-announce-alt":y||void 0,...R,ref:p})});function CB(l){const p=[];return Array.from(l.childNodes).forEach(y=>{if(y.nodeType===y.TEXT_NODE&&y.textContent&&p.push(y.textContent),YJ(y)){const R=y.ariaHidden||y.hidden||y.style.display==="none",C=y.dataset.radixToastAnnounceExclude==="";if(!R)if(C){const P=y.dataset.radixToastAnnounceAlt;P&&p.push(P)}else p.push(...CB(y))}}),p}function fR(l,p,m,{discrete:y}){const R=m.originalEvent.currentTarget,C=new CustomEvent(l,{bubbles:!0,cancelable:!0,detail:m});p&&R.addEventListener(l,p,{once:!0}),y?cB(R,C):R.dispatchEvent(C)}var eF=(l,p,m=0)=>{const y=Math.abs(l.x),R=Math.abs(l.y),C=y>R;return p==="left"||p==="right"?C&&y>m:!C&&R>m};function zJ(l=()=>{}){const p=go(l);ai(()=>{let m=0,y=0;return m=window.requestAnimationFrame(()=>y=window.requestAnimationFrame(p)),()=>{window.cancelAnimationFrame(m),window.cancelAnimationFrame(y)}},[p])}function YJ(l){return l.nodeType===l.ELEMENT_NODE}function qJ(l){const p=[],m=document.createTreeWalker(l,NodeFilter.SHOW_ELEMENT,{acceptNode:y=>{const R=y.tagName==="INPUT"&&y.type==="hidden";return y.disabled||y.hidden||R?NodeFilter.FILTER_SKIP:y.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;m.nextNode();)p.push(m.currentNode);return p}function yA(l){const p=document.activeElement;return l.some(m=>m===p?!0:(m.focus(),document.activeElement!==p))}var XJ=fB,bB=_B,IB=EB,AB=vB,NB=yB,OB=TB,PB=pN;function DB(l){var p,m,y="";if(typeof l=="string"||typeof l=="number")y+=l;else if(typeof l=="object")if(Array.isArray(l)){var R=l.length;for(p=0;p<R;p++)l[p]&&(m=DB(l[p]))&&(y&&(y+=" "),y+=m)}else for(m in l)l[m]&&(y&&(y+=" "),y+=m);return y}function kB(){for(var l,p,m=0,y="",R=arguments.length;m<R;m++)(l=arguments[m])&&(p=DB(l))&&(y&&(y+=" "),y+=p);return y}const tF=l=>typeof l=="boolean"?`${l}`:l===0?"0":l,nF=kB,GR=(l,p)=>m=>{var y;if(p?.variants==null)return nF(l,m?.class,m?.className);const{variants:R,defaultVariants:C}=p,P=Object.keys(R).map(F=>{const H=m?.[F],K=C?.[F];if(H===null)return null;const ee=tF(H)||tF(K);return R[F][ee]}),k=m&&Object.entries(m).reduce((F,H)=>{let[K,ee]=H;return ee===void 0||(F[K]=ee),F},{}),M=p==null||(y=p.compoundVariants)===null||y===void 0?void 0:y.reduce((F,H)=>{let{class:K,className:ee,...X}=H;return Object.entries(X).every(re=>{let[G,J]=re;return Array.isArray(J)?J.includes({...C,...k}[G]):{...C,...k}[G]===J})?[...F,K,ee]:F},[]);return nF(l,P,M,m?.class,m?.className)};/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const JJ=l=>l.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),xB=(...l)=>l.filter((p,m,y)=>!!p&&p.trim()!==""&&y.indexOf(p)===m).join(" ").trim();/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var QJ={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ZJ=L.forwardRef(({color:l="currentColor",size:p=24,strokeWidth:m=2,absoluteStrokeWidth:y,className:R="",children:C,iconNode:P,...k},M)=>L.createElement("svg",{ref:M,...QJ,width:p,height:p,stroke:l,strokeWidth:y?Number(m)*24/Number(p):m,className:xB("lucide",R),...k},[...P.map(([F,H])=>L.createElement(F,H)),...Array.isArray(C)?C:[C]]));/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dn=(l,p)=>{const m=L.forwardRef(({className:y,...R},C)=>L.createElement(ZJ,{ref:C,iconNode:p,className:xB(`lucide-${JJ(l)}`,y),...R}));return m.displayName=`${l}`,m};/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qE=dn("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const BA=dn("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $J=dn("Award",[["path",{d:"m15.477 12.89 1.515 8.526a.5.5 0 0 1-.81.47l-3.58-2.687a1 1 0 0 0-1.197 0l-3.586 2.686a.5.5 0 0 1-.81-.469l1.514-8.526",key:"1yiouv"}],["circle",{cx:"12",cy:"8",r:"6",key:"1vp47v"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const eQ=dn("Bell",[["path",{d:"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9",key:"1qo2s2"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const LB=dn("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tQ=dn("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const MB=dn("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nQ=dn("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bm=dn("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const UB=dn("Coffee",[["path",{d:"M10 2v2",key:"7u0qdc"}],["path",{d:"M14 2v2",key:"6buw04"}],["path",{d:"M16 8a1 1 0 0 1 1 1v8a4 4 0 0 1-4 4H7a4 4 0 0 1-4-4V9a1 1 0 0 1 1-1h14a4 4 0 1 1 0 8h-1",key:"pwadti"}],["path",{d:"M6 2v2",key:"colzsn"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rF=dn("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const iF=dn("EyeOff",[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sF=dn("Eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rQ=dn("Flag",[["path",{d:"M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z",key:"i9b6wo"}],["line",{x1:"4",x2:"4",y1:"22",y2:"15",key:"1cm3nv"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const iQ=dn("Flame",[["path",{d:"M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z",key:"96xj49"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oF=dn("Ghost",[["path",{d:"M9 10h.01",key:"qbtxuw"}],["path",{d:"M15 10h.01",key:"1qmjsl"}],["path",{d:"M12 2a8 8 0 0 0-8 8v12l3-3 2.5 2.5L12 19l2.5 2.5L17 19l3 3V10a8 8 0 0 0-8-8z",key:"uwwb07"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sQ=dn("Globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const aF=dn("Hash",[["line",{x1:"4",x2:"20",y1:"9",y2:"9",key:"4lhtct"}],["line",{x1:"4",x2:"20",y1:"15",y2:"15",key:"vyu0kd"}],["line",{x1:"10",x2:"8",y1:"3",y2:"21",key:"1ggp8o"}],["line",{x1:"16",x2:"14",y1:"3",y2:"21",key:"weycgp"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oQ=dn("Heart",[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const aQ=dn("House",[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8",key:"5wwlr5"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-5.999a2 2 0 0 1 2.582 0l7 5.999A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"1d0kgt"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cF=dn("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lF=dn("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dF=dn("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Im=dn("MessageCircle",[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z",key:"vv11sd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const uF=dn("Mic",[["path",{d:"M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z",key:"131961"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cQ=dn("Moon",[["path",{d:"M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z",key:"a7tn18"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lQ=dn("Pen",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const WA=dn("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dQ=dn("Reply",[["polyline",{points:"9 17 4 12 9 7",key:"hvgpf2"}],["path",{d:"M20 18v-2a4 4 0 0 0-4-4H4",key:"5vmcpk"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jB=dn("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const uQ=dn("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const VB=dn("Share2",[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const HR=dn("Shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const FB=dn("Sun",[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"m17.66 17.66 1.41 1.41",key:"ptbguv"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m6.34 17.66-1.41 1.41",key:"1m8zz5"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const XE=dn("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zE=dn("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hQ=dn("TriangleAlert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const BB=dn("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const WB=dn("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pQ=dn("Video",[["path",{d:"m16 13 5.223 3.482a.5.5 0 0 0 .777-.416V7.87a.5.5 0 0 0-.752-.432L16 10.5",key:"ftymec"}],["rect",{x:"2",y:"6",width:"14",height:"12",rx:"2",key:"158x01"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const GB=dn("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const HB=dn("Zap",[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]]),fN="-",fQ=l=>{const p=_Q(l),{conflictingClassGroups:m,conflictingClassGroupModifiers:y}=l;return{getClassGroupId:P=>{const k=P.split(fN);return k[0]===""&&k.length!==1&&k.shift(),KB(k,p)||mQ(P)},getConflictingClassGroupIds:(P,k)=>{const M=m[P]||[];return k&&y[P]?[...M,...y[P]]:M}}},KB=(l,p)=>{if(l.length===0)return p.classGroupId;const m=l[0],y=p.nextPart.get(m),R=y?KB(l.slice(1),y):void 0;if(R)return R;if(p.validators.length===0)return;const C=l.join(fN);return p.validators.find(({validator:P})=>P(C))?.classGroupId},hF=/^\[(.+)\]$/,mQ=l=>{if(hF.test(l)){const p=hF.exec(l)[1],m=p?.substring(0,p.indexOf(":"));if(m)return"arbitrary.."+m}},_Q=l=>{const{theme:p,prefix:m}=l,y={nextPart:new Map,validators:[]};return EQ(Object.entries(l.classGroups),m).forEach(([C,P])=>{GA(P,y,C,p)}),y},GA=(l,p,m,y)=>{l.forEach(R=>{if(typeof R=="string"){const C=R===""?p:pF(p,R);C.classGroupId=m;return}if(typeof R=="function"){if(gQ(R)){GA(R(y),p,m,y);return}p.validators.push({validator:R,classGroupId:m});return}Object.entries(R).forEach(([C,P])=>{GA(P,pF(p,C),m,y)})})},pF=(l,p)=>{let m=l;return p.split(fN).forEach(y=>{m.nextPart.has(y)||m.nextPart.set(y,{nextPart:new Map,validators:[]}),m=m.nextPart.get(y)}),m},gQ=l=>l.isThemeGetter,EQ=(l,p)=>p?l.map(([m,y])=>{const R=y.map(C=>typeof C=="string"?p+C:typeof C=="object"?Object.fromEntries(Object.entries(C).map(([P,k])=>[p+P,k])):C);return[m,R]}):l,vQ=l=>{if(l<1)return{get:()=>{},set:()=>{}};let p=0,m=new Map,y=new Map;const R=(C,P)=>{m.set(C,P),p++,p>l&&(p=0,y=m,m=new Map)};return{get(C){let P=m.get(C);if(P!==void 0)return P;if((P=y.get(C))!==void 0)return R(C,P),P},set(C,P){m.has(C)?m.set(C,P):R(C,P)}}},zB="!",yQ=l=>{const{separator:p,experimentalParseClassName:m}=l,y=p.length===1,R=p[0],C=p.length,P=k=>{const M=[];let F=0,H=0,K;for(let J=0;J<k.length;J++){let te=k[J];if(F===0){if(te===R&&(y||k.slice(J,J+C)===p)){M.push(k.slice(H,J)),H=J+C;continue}if(te==="/"){K=J;continue}}te==="["?F++:te==="]"&&F--}const ee=M.length===0?k:k.substring(H),X=ee.startsWith(zB),re=X?ee.substring(1):ee,G=K&&K>H?K-H:void 0;return{modifiers:M,hasImportantModifier:X,baseClassName:re,maybePostfixModifierPosition:G}};return m?k=>m({className:k,parseClassName:P}):P},SQ=l=>{if(l.length<=1)return l;const p=[];let m=[];return l.forEach(y=>{y[0]==="["?(p.push(...m.sort(),y),m=[]):m.push(y)}),p.push(...m.sort()),p},TQ=l=>({cache:vQ(l.cacheSize),parseClassName:yQ(l),...fQ(l)}),RQ=/\s+/,wQ=(l,p)=>{const{parseClassName:m,getClassGroupId:y,getConflictingClassGroupIds:R}=p,C=[],P=l.trim().split(RQ);let k="";for(let M=P.length-1;M>=0;M-=1){const F=P[M],{modifiers:H,hasImportantModifier:K,baseClassName:ee,maybePostfixModifierPosition:X}=m(F);let re=!!X,G=y(re?ee.substring(0,X):ee);if(!G){if(!re){k=F+(k.length>0?" "+k:k);continue}if(G=y(ee),!G){k=F+(k.length>0?" "+k:k);continue}re=!1}const J=SQ(H).join(":"),te=K?J+zB:J,ne=te+G;if(C.includes(ne))continue;C.push(ne);const se=R(G,re);for(let ae=0;ae<se.length;++ae){const pe=se[ae];C.push(te+pe)}k=F+(k.length>0?" "+k:k)}return k};function CQ(){let l=0,p,m,y="";for(;l<arguments.length;)(p=arguments[l++])&&(m=YB(p))&&(y&&(y+=" "),y+=m);return y}const YB=l=>{if(typeof l=="string")return l;let p,m="";for(let y=0;y<l.length;y++)l[y]&&(p=YB(l[y]))&&(m&&(m+=" "),m+=p);return m};function bQ(l,...p){let m,y,R,C=P;function P(M){const F=p.reduce((H,K)=>K(H),l());return m=TQ(F),y=m.cache.get,R=m.cache.set,C=k,k(M)}function k(M){const F=y(M);if(F)return F;const H=wQ(M,m);return R(M,H),H}return function(){return C(CQ.apply(null,arguments))}}const yr=l=>{const p=m=>m[l]||[];return p.isThemeGetter=!0,p},qB=/^\[(?:([a-z-]+):)?(.+)\]$/i,IQ=/^\d+\/\d+$/,AQ=new Set(["px","full","screen"]),NQ=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,OQ=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,PQ=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,DQ=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,kQ=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,Pl=l=>Tm(l)||AQ.has(l)||IQ.test(l),Xd=l=>Pm(l,"length",BQ),Tm=l=>!!l&&!Number.isNaN(Number(l)),SA=l=>Pm(l,"number",Tm),FE=l=>!!l&&Number.isInteger(Number(l)),xQ=l=>l.endsWith("%")&&Tm(l.slice(0,-1)),fn=l=>qB.test(l),Jd=l=>NQ.test(l),LQ=new Set(["length","size","percentage"]),MQ=l=>Pm(l,LQ,XB),UQ=l=>Pm(l,"position",XB),jQ=new Set(["image","url"]),VQ=l=>Pm(l,jQ,GQ),FQ=l=>Pm(l,"",WQ),BE=()=>!0,Pm=(l,p,m)=>{const y=qB.exec(l);return y?y[1]?typeof p=="string"?y[1]===p:p.has(y[1]):m(y[2]):!1},BQ=l=>OQ.test(l)&&!PQ.test(l),XB=()=>!1,WQ=l=>DQ.test(l),GQ=l=>kQ.test(l),HQ=()=>{const l=yr("colors"),p=yr("spacing"),m=yr("blur"),y=yr("brightness"),R=yr("borderColor"),C=yr("borderRadius"),P=yr("borderSpacing"),k=yr("borderWidth"),M=yr("contrast"),F=yr("grayscale"),H=yr("hueRotate"),K=yr("invert"),ee=yr("gap"),X=yr("gradientColorStops"),re=yr("gradientColorStopPositions"),G=yr("inset"),J=yr("margin"),te=yr("opacity"),ne=yr("padding"),se=yr("saturate"),ae=yr("scale"),pe=yr("sepia"),Se=yr("skew"),Te=yr("space"),Ue=yr("translate"),tt=()=>["auto","contain","none"],gt=()=>["auto","hidden","clip","visible","scroll"],ht=()=>["auto",fn,p],Ge=()=>[fn,p],pt=()=>["",Pl,Xd],Fe=()=>["auto",Tm,fn],wt=()=>["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top"],rt=()=>["solid","dashed","dotted","double","none"],Je=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],De=()=>["start","end","center","between","around","evenly","stretch"],Le=()=>["","0",fn],ze=()=>["auto","avoid","all","avoid-page","page","left","right","column"],fe=()=>[Tm,fn];return{cacheSize:500,separator:":",theme:{colors:[BE],spacing:[Pl,Xd],blur:["none","",Jd,fn],brightness:fe(),borderColor:[l],borderRadius:["none","","full",Jd,fn],borderSpacing:Ge(),borderWidth:pt(),contrast:fe(),grayscale:Le(),hueRotate:fe(),invert:Le(),gap:Ge(),gradientColorStops:[l],gradientColorStopPositions:[xQ,Xd],inset:ht(),margin:ht(),opacity:fe(),padding:Ge(),saturate:fe(),scale:fe(),sepia:Le(),skew:fe(),space:Ge(),translate:Ge()},classGroups:{aspect:[{aspect:["auto","square","video",fn]}],container:["container"],columns:[{columns:[Jd]}],"break-after":[{"break-after":ze()}],"break-before":[{"break-before":ze()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:[...wt(),fn]}],overflow:[{overflow:gt()}],"overflow-x":[{"overflow-x":gt()}],"overflow-y":[{"overflow-y":gt()}],overscroll:[{overscroll:tt()}],"overscroll-x":[{"overscroll-x":tt()}],"overscroll-y":[{"overscroll-y":tt()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:[G]}],"inset-x":[{"inset-x":[G]}],"inset-y":[{"inset-y":[G]}],start:[{start:[G]}],end:[{end:[G]}],top:[{top:[G]}],right:[{right:[G]}],bottom:[{bottom:[G]}],left:[{left:[G]}],visibility:["visible","invisible","collapse"],z:[{z:["auto",FE,fn]}],basis:[{basis:ht()}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["wrap","wrap-reverse","nowrap"]}],flex:[{flex:["1","auto","initial","none",fn]}],grow:[{grow:Le()}],shrink:[{shrink:Le()}],order:[{order:["first","last","none",FE,fn]}],"grid-cols":[{"grid-cols":[BE]}],"col-start-end":[{col:["auto",{span:["full",FE,fn]},fn]}],"col-start":[{"col-start":Fe()}],"col-end":[{"col-end":Fe()}],"grid-rows":[{"grid-rows":[BE]}],"row-start-end":[{row:["auto",{span:[FE,fn]},fn]}],"row-start":[{"row-start":Fe()}],"row-end":[{"row-end":Fe()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":["auto","min","max","fr",fn]}],"auto-rows":[{"auto-rows":["auto","min","max","fr",fn]}],gap:[{gap:[ee]}],"gap-x":[{"gap-x":[ee]}],"gap-y":[{"gap-y":[ee]}],"justify-content":[{justify:["normal",...De()]}],"justify-items":[{"justify-items":["start","end","center","stretch"]}],"justify-self":[{"justify-self":["auto","start","end","center","stretch"]}],"align-content":[{content:["normal",...De(),"baseline"]}],"align-items":[{items:["start","end","center","baseline","stretch"]}],"align-self":[{self:["auto","start","end","center","stretch","baseline"]}],"place-content":[{"place-content":[...De(),"baseline"]}],"place-items":[{"place-items":["start","end","center","baseline","stretch"]}],"place-self":[{"place-self":["auto","start","end","center","stretch"]}],p:[{p:[ne]}],px:[{px:[ne]}],py:[{py:[ne]}],ps:[{ps:[ne]}],pe:[{pe:[ne]}],pt:[{pt:[ne]}],pr:[{pr:[ne]}],pb:[{pb:[ne]}],pl:[{pl:[ne]}],m:[{m:[J]}],mx:[{mx:[J]}],my:[{my:[J]}],ms:[{ms:[J]}],me:[{me:[J]}],mt:[{mt:[J]}],mr:[{mr:[J]}],mb:[{mb:[J]}],ml:[{ml:[J]}],"space-x":[{"space-x":[Te]}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":[Te]}],"space-y-reverse":["space-y-reverse"],w:[{w:["auto","min","max","fit","svw","lvw","dvw",fn,p]}],"min-w":[{"min-w":[fn,p,"min","max","fit"]}],"max-w":[{"max-w":[fn,p,"none","full","min","max","fit","prose",{screen:[Jd]},Jd]}],h:[{h:[fn,p,"auto","min","max","fit","svh","lvh","dvh"]}],"min-h":[{"min-h":[fn,p,"min","max","fit","svh","lvh","dvh"]}],"max-h":[{"max-h":[fn,p,"min","max","fit","svh","lvh","dvh"]}],size:[{size:[fn,p,"auto","min","max","fit"]}],"font-size":[{text:["base",Jd,Xd]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:["thin","extralight","light","normal","medium","semibold","bold","extrabold","black",SA]}],"font-family":[{font:[BE]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:["tighter","tight","normal","wide","wider","widest",fn]}],"line-clamp":[{"line-clamp":["none",Tm,SA]}],leading:[{leading:["none","tight","snug","normal","relaxed","loose",Pl,fn]}],"list-image":[{"list-image":["none",fn]}],"list-style-type":[{list:["none","disc","decimal",fn]}],"list-style-position":[{list:["inside","outside"]}],"placeholder-color":[{placeholder:[l]}],"placeholder-opacity":[{"placeholder-opacity":[te]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"text-color":[{text:[l]}],"text-opacity":[{"text-opacity":[te]}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...rt(),"wavy"]}],"text-decoration-thickness":[{decoration:["auto","from-font",Pl,Xd]}],"underline-offset":[{"underline-offset":["auto",Pl,fn]}],"text-decoration-color":[{decoration:[l]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:Ge()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",fn]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",fn]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-opacity":[{"bg-opacity":[te]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:[...wt(),UQ]}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","round","space"]}]}],"bg-size":[{bg:["auto","cover","contain",MQ]}],"bg-image":[{bg:["none",{"gradient-to":["t","tr","r","br","b","bl","l","tl"]},VQ]}],"bg-color":[{bg:[l]}],"gradient-from-pos":[{from:[re]}],"gradient-via-pos":[{via:[re]}],"gradient-to-pos":[{to:[re]}],"gradient-from":[{from:[X]}],"gradient-via":[{via:[X]}],"gradient-to":[{to:[X]}],rounded:[{rounded:[C]}],"rounded-s":[{"rounded-s":[C]}],"rounded-e":[{"rounded-e":[C]}],"rounded-t":[{"rounded-t":[C]}],"rounded-r":[{"rounded-r":[C]}],"rounded-b":[{"rounded-b":[C]}],"rounded-l":[{"rounded-l":[C]}],"rounded-ss":[{"rounded-ss":[C]}],"rounded-se":[{"rounded-se":[C]}],"rounded-ee":[{"rounded-ee":[C]}],"rounded-es":[{"rounded-es":[C]}],"rounded-tl":[{"rounded-tl":[C]}],"rounded-tr":[{"rounded-tr":[C]}],"rounded-br":[{"rounded-br":[C]}],"rounded-bl":[{"rounded-bl":[C]}],"border-w":[{border:[k]}],"border-w-x":[{"border-x":[k]}],"border-w-y":[{"border-y":[k]}],"border-w-s":[{"border-s":[k]}],"border-w-e":[{"border-e":[k]}],"border-w-t":[{"border-t":[k]}],"border-w-r":[{"border-r":[k]}],"border-w-b":[{"border-b":[k]}],"border-w-l":[{"border-l":[k]}],"border-opacity":[{"border-opacity":[te]}],"border-style":[{border:[...rt(),"hidden"]}],"divide-x":[{"divide-x":[k]}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":[k]}],"divide-y-reverse":["divide-y-reverse"],"divide-opacity":[{"divide-opacity":[te]}],"divide-style":[{divide:rt()}],"border-color":[{border:[R]}],"border-color-x":[{"border-x":[R]}],"border-color-y":[{"border-y":[R]}],"border-color-s":[{"border-s":[R]}],"border-color-e":[{"border-e":[R]}],"border-color-t":[{"border-t":[R]}],"border-color-r":[{"border-r":[R]}],"border-color-b":[{"border-b":[R]}],"border-color-l":[{"border-l":[R]}],"divide-color":[{divide:[R]}],"outline-style":[{outline:["",...rt()]}],"outline-offset":[{"outline-offset":[Pl,fn]}],"outline-w":[{outline:[Pl,Xd]}],"outline-color":[{outline:[l]}],"ring-w":[{ring:pt()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:[l]}],"ring-opacity":[{"ring-opacity":[te]}],"ring-offset-w":[{"ring-offset":[Pl,Xd]}],"ring-offset-color":[{"ring-offset":[l]}],shadow:[{shadow:["","inner","none",Jd,FQ]}],"shadow-color":[{shadow:[BE]}],opacity:[{opacity:[te]}],"mix-blend":[{"mix-blend":[...Je(),"plus-lighter","plus-darker"]}],"bg-blend":[{"bg-blend":Je()}],filter:[{filter:["","none"]}],blur:[{blur:[m]}],brightness:[{brightness:[y]}],contrast:[{contrast:[M]}],"drop-shadow":[{"drop-shadow":["","none",Jd,fn]}],grayscale:[{grayscale:[F]}],"hue-rotate":[{"hue-rotate":[H]}],invert:[{invert:[K]}],saturate:[{saturate:[se]}],sepia:[{sepia:[pe]}],"backdrop-filter":[{"backdrop-filter":["","none"]}],"backdrop-blur":[{"backdrop-blur":[m]}],"backdrop-brightness":[{"backdrop-brightness":[y]}],"backdrop-contrast":[{"backdrop-contrast":[M]}],"backdrop-grayscale":[{"backdrop-grayscale":[F]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[H]}],"backdrop-invert":[{"backdrop-invert":[K]}],"backdrop-opacity":[{"backdrop-opacity":[te]}],"backdrop-saturate":[{"backdrop-saturate":[se]}],"backdrop-sepia":[{"backdrop-sepia":[pe]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":[P]}],"border-spacing-x":[{"border-spacing-x":[P]}],"border-spacing-y":[{"border-spacing-y":[P]}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["none","all","","colors","opacity","shadow","transform",fn]}],duration:[{duration:fe()}],ease:[{ease:["linear","in","out","in-out",fn]}],delay:[{delay:fe()}],animate:[{animate:["none","spin","ping","pulse","bounce",fn]}],transform:[{transform:["","gpu","none"]}],scale:[{scale:[ae]}],"scale-x":[{"scale-x":[ae]}],"scale-y":[{"scale-y":[ae]}],rotate:[{rotate:[FE,fn]}],"translate-x":[{"translate-x":[Ue]}],"translate-y":[{"translate-y":[Ue]}],"skew-x":[{"skew-x":[Se]}],"skew-y":[{"skew-y":[Se]}],"transform-origin":[{origin:["center","top","top-right","right","bottom-right","bottom","bottom-left","left","top-left",fn]}],accent:[{accent:["auto",l]}],appearance:[{appearance:["none","auto"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",fn]}],"caret-color":[{caret:[l]}],"pointer-events":[{"pointer-events":["none","auto"]}],resize:[{resize:["none","y","x",""]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":Ge()}],"scroll-mx":[{"scroll-mx":Ge()}],"scroll-my":[{"scroll-my":Ge()}],"scroll-ms":[{"scroll-ms":Ge()}],"scroll-me":[{"scroll-me":Ge()}],"scroll-mt":[{"scroll-mt":Ge()}],"scroll-mr":[{"scroll-mr":Ge()}],"scroll-mb":[{"scroll-mb":Ge()}],"scroll-ml":[{"scroll-ml":Ge()}],"scroll-p":[{"scroll-p":Ge()}],"scroll-px":[{"scroll-px":Ge()}],"scroll-py":[{"scroll-py":Ge()}],"scroll-ps":[{"scroll-ps":Ge()}],"scroll-pe":[{"scroll-pe":Ge()}],"scroll-pt":[{"scroll-pt":Ge()}],"scroll-pr":[{"scroll-pr":Ge()}],"scroll-pb":[{"scroll-pb":Ge()}],"scroll-pl":[{"scroll-pl":Ge()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",fn]}],fill:[{fill:[l,"none"]}],"stroke-w":[{stroke:[Pl,Xd,SA]}],stroke:[{stroke:[l,"none"]}],sr:["sr-only","not-sr-only"],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]}}},KQ=bQ(HQ);function gn(...l){return KQ(kB(l))}const zQ=XJ,JB=L.forwardRef(({className:l,...p},m)=>v.jsx(bB,{ref:m,className:gn("fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",l),...p}));JB.displayName=bB.displayName;const YQ=GR("group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full",{variants:{variant:{default:"border bg-background text-foreground",destructive:"destructive group border-destructive bg-destructive text-destructive-foreground"}},defaultVariants:{variant:"default"}}),QB=L.forwardRef(({className:l,variant:p,...m},y)=>v.jsx(IB,{ref:y,className:gn(YQ({variant:p}),l),...m}));QB.displayName=IB.displayName;const qQ=L.forwardRef(({className:l,...p},m)=>v.jsx(OB,{ref:m,className:gn("inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors group-[.destructive]:border-muted/40 hover:bg-secondary group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 group-[.destructive]:focus:ring-destructive disabled:pointer-events-none disabled:opacity-50",l),...p}));qQ.displayName=OB.displayName;const ZB=L.forwardRef(({className:l,...p},m)=>v.jsx(PB,{ref:m,className:gn("absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity group-hover:opacity-100 group-[.destructive]:text-red-300 hover:text-foreground group-[.destructive]:hover:text-red-50 focus:opacity-100 focus:outline-none focus:ring-2 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",l),"toast-close":"",...p,children:v.jsx(GB,{className:"h-4 w-4"})}));ZB.displayName=PB.displayName;const $B=L.forwardRef(({className:l,...p},m)=>v.jsx(AB,{ref:m,className:gn("text-sm font-semibold",l),...p}));$B.displayName=AB.displayName;const e3=L.forwardRef(({className:l,...p},m)=>v.jsx(NB,{ref:m,className:gn("text-sm opacity-90",l),...p}));e3.displayName=NB.displayName;function XQ(){const{toasts:l}=Gc();return v.jsxs(zQ,{children:[l.map(function({id:p,title:m,description:y,action:R,...C}){return v.jsxs(QB,{...C,children:[v.jsxs("div",{className:"grid gap-1",children:[m&&v.jsx($B,{children:m}),y&&v.jsx(e3,{children:y})]}),R,v.jsx(ZB,{})]},p)}),v.jsx(JB,{})]})}var JQ=(l,p,m,y,R,C,P,k)=>{let M=document.documentElement,F=["light","dark"];function H(X){(Array.isArray(l)?l:[l]).forEach(re=>{let G=re==="class",J=G&&C?R.map(te=>C[te]||te):R;G?(M.classList.remove(...J),M.classList.add(C&&C[X]?C[X]:X)):M.setAttribute(re,X)}),K(X)}function K(X){k&&F.includes(X)&&(M.style.colorScheme=X)}function ee(){return window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"}if(y)H(y);else try{let X=localStorage.getItem(p)||m,re=P&&X==="system"?ee():X;H(re)}catch{}},fF=["light","dark"],t3="(prefers-color-scheme: dark)",QQ=typeof window>"u",mN=L.createContext(void 0),ZQ={setTheme:l=>{},themes:[]},n3=()=>{var l;return(l=L.useContext(mN))!=null?l:ZQ},$Q=l=>L.useContext(mN)?L.createElement(L.Fragment,null,l.children):L.createElement(tZ,{...l}),eZ=["light","dark"],tZ=({forcedTheme:l,disableTransitionOnChange:p=!1,enableSystem:m=!0,enableColorScheme:y=!0,storageKey:R="theme",themes:C=eZ,defaultTheme:P=m?"system":"light",attribute:k="data-theme",value:M,children:F,nonce:H,scriptProps:K})=>{let[ee,X]=L.useState(()=>rZ(R,P)),[re,G]=L.useState(()=>ee==="system"?TA():ee),J=M?Object.values(M):C,te=L.useCallback(pe=>{let Se=pe;if(!Se)return;pe==="system"&&m&&(Se=TA());let Te=M?M[Se]:Se,Ue=p?iZ(H):null,tt=document.documentElement,gt=ht=>{ht==="class"?(tt.classList.remove(...J),Te&&tt.classList.add(Te)):ht.startsWith("data-")&&(Te?tt.setAttribute(ht,Te):tt.removeAttribute(ht))};if(Array.isArray(k)?k.forEach(gt):gt(k),y){let ht=fF.includes(P)?P:null,Ge=fF.includes(Se)?Se:ht;tt.style.colorScheme=Ge}Ue?.()},[H]),ne=L.useCallback(pe=>{let Se=typeof pe=="function"?pe(ee):pe;X(Se);try{localStorage.setItem(R,Se)}catch{}},[ee]),se=L.useCallback(pe=>{let Se=TA(pe);G(Se),ee==="system"&&m&&!l&&te("system")},[ee,l]);L.useEffect(()=>{let pe=window.matchMedia(t3);return pe.addListener(se),se(pe),()=>pe.removeListener(se)},[se]),L.useEffect(()=>{let pe=Se=>{Se.key===R&&(Se.newValue?X(Se.newValue):ne(P))};return window.addEventListener("storage",pe),()=>window.removeEventListener("storage",pe)},[ne]),L.useEffect(()=>{te(l??ee)},[l,ee]);let ae=L.useMemo(()=>({theme:ee,setTheme:ne,forcedTheme:l,resolvedTheme:ee==="system"?re:ee,themes:m?[...C,"system"]:C,systemTheme:m?re:void 0}),[ee,ne,l,re,m,C]);return L.createElement(mN.Provider,{value:ae},L.createElement(nZ,{forcedTheme:l,storageKey:R,attribute:k,enableSystem:m,enableColorScheme:y,defaultTheme:P,value:M,themes:C,nonce:H,scriptProps:K}),F)},nZ=L.memo(({forcedTheme:l,storageKey:p,attribute:m,enableSystem:y,enableColorScheme:R,defaultTheme:C,value:P,themes:k,nonce:M,scriptProps:F})=>{let H=JSON.stringify([m,p,C,l,k,P,y,R]).slice(1,-1);return L.createElement("script",{...F,suppressHydrationWarning:!0,nonce:typeof window>"u"?M:"",dangerouslySetInnerHTML:{__html:`(${JQ.toString()})(${H})`}})}),rZ=(l,p)=>{if(QQ)return;let m;try{m=localStorage.getItem(l)||void 0}catch{}return m||p},iZ=l=>{let p=document.createElement("style");return l&&p.setAttribute("nonce",l),p.appendChild(document.createTextNode("*,*::before,*::after{-webkit-transition:none!important;-moz-transition:none!important;-o-transition:none!important;-ms-transition:none!important;transition:none!important}")),document.head.appendChild(p),()=>{window.getComputedStyle(document.body),setTimeout(()=>{document.head.removeChild(p)},1)}},TA=l=>(l||(l=window.matchMedia(t3)),l.matches?"dark":"light"),sZ=l=>{switch(l){case"success":return cZ;case"info":return dZ;case"warning":return lZ;case"error":return uZ;default:return null}},oZ=Array(12).fill(0),aZ=({visible:l,className:p})=>nt.createElement("div",{className:["sonner-loading-wrapper",p].filter(Boolean).join(" "),"data-visible":l},nt.createElement("div",{className:"sonner-spinner"},oZ.map((m,y)=>nt.createElement("div",{className:"sonner-loading-bar",key:`spinner-bar-${y}`})))),cZ=nt.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},nt.createElement("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.809a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z",clipRule:"evenodd"})),lZ=nt.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",height:"20",width:"20"},nt.createElement("path",{fillRule:"evenodd",d:"M9.401 3.003c1.155-2 4.043-2 5.197 0l7.355 12.748c1.154 2-.29 4.5-2.599 4.5H4.645c-2.309 0-3.752-2.5-2.598-4.5L9.4 3.003zM12 8.25a.75.75 0 01.75.75v3.75a.75.75 0 01-1.5 0V9a.75.75 0 01.75-.75zm0 8.25a.75.75 0 100-1.5.75.75 0 000 1.5z",clipRule:"evenodd"})),dZ=nt.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},nt.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a.75.75 0 000 1.5h.253a.25.25 0 01.244.304l-.459 2.066A1.75 1.75 0 0010.747 15H11a.75.75 0 000-1.5h-.253a.25.25 0 01-.244-.304l.459-2.066A1.75 1.75 0 009.253 9H9z",clipRule:"evenodd"})),uZ=nt.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},nt.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-5a.75.75 0 01.75.75v4.5a.75.75 0 01-1.5 0v-4.5A.75.75 0 0110 5zm0 10a1 1 0 100-2 1 1 0 000 2z",clipRule:"evenodd"})),hZ=nt.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"},nt.createElement("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),nt.createElement("line",{x1:"6",y1:"6",x2:"18",y2:"18"})),pZ=()=>{let[l,p]=nt.useState(document.hidden);return nt.useEffect(()=>{let m=()=>{p(document.hidden)};return document.addEventListener("visibilitychange",m),()=>window.removeEventListener("visibilitychange",m)},[]),l},HA=1,fZ=class{constructor(){this.subscribe=l=>(this.subscribers.push(l),()=>{let p=this.subscribers.indexOf(l);this.subscribers.splice(p,1)}),this.publish=l=>{this.subscribers.forEach(p=>p(l))},this.addToast=l=>{this.publish(l),this.toasts=[...this.toasts,l]},this.create=l=>{var p;let{message:m,...y}=l,R=typeof l?.id=="number"||((p=l.id)==null?void 0:p.length)>0?l.id:HA++,C=this.toasts.find(k=>k.id===R),P=l.dismissible===void 0?!0:l.dismissible;return this.dismissedToasts.has(R)&&this.dismissedToasts.delete(R),C?this.toasts=this.toasts.map(k=>k.id===R?(this.publish({...k,...l,id:R,title:m}),{...k,...l,id:R,dismissible:P,title:m}):k):this.addToast({title:m,...y,dismissible:P,id:R}),R},this.dismiss=l=>(this.dismissedToasts.add(l),l||this.toasts.forEach(p=>{this.subscribers.forEach(m=>m({id:p.id,dismiss:!0}))}),this.subscribers.forEach(p=>p({id:l,dismiss:!0})),l),this.message=(l,p)=>this.create({...p,message:l}),this.error=(l,p)=>this.create({...p,message:l,type:"error"}),this.success=(l,p)=>this.create({...p,type:"success",message:l}),this.info=(l,p)=>this.create({...p,type:"info",message:l}),this.warning=(l,p)=>this.create({...p,type:"warning",message:l}),this.loading=(l,p)=>this.create({...p,type:"loading",message:l}),this.promise=(l,p)=>{if(!p)return;let m;p.loading!==void 0&&(m=this.create({...p,promise:l,type:"loading",message:p.loading,description:typeof p.description!="function"?p.description:void 0}));let y=l instanceof Promise?l:l(),R=m!==void 0,C,P=y.then(async M=>{if(C=["resolve",M],nt.isValidElement(M))R=!1,this.create({id:m,type:"default",message:M});else if(_Z(M)&&!M.ok){R=!1;let F=typeof p.error=="function"?await p.error(`HTTP error! status: ${M.status}`):p.error,H=typeof p.description=="function"?await p.description(`HTTP error! status: ${M.status}`):p.description;this.create({id:m,type:"error",message:F,description:H})}else if(p.success!==void 0){R=!1;let F=typeof p.success=="function"?await p.success(M):p.success,H=typeof p.description=="function"?await p.description(M):p.description;this.create({id:m,type:"success",message:F,description:H})}}).catch(async M=>{if(C=["reject",M],p.error!==void 0){R=!1;let F=typeof p.error=="function"?await p.error(M):p.error,H=typeof p.description=="function"?await p.description(M):p.description;this.create({id:m,type:"error",message:F,description:H})}}).finally(()=>{var M;R&&(this.dismiss(m),m=void 0),(M=p.finally)==null||M.call(p)}),k=()=>new Promise((M,F)=>P.then(()=>C[0]==="reject"?F(C[1]):M(C[1])).catch(F));return typeof m!="string"&&typeof m!="number"?{unwrap:k}:Object.assign(m,{unwrap:k})},this.custom=(l,p)=>{let m=p?.id||HA++;return this.create({jsx:l(m),id:m,...p}),m},this.getActiveToasts=()=>this.toasts.filter(l=>!this.dismissedToasts.has(l.id)),this.subscribers=[],this.toasts=[],this.dismissedToasts=new Set}},Fs=new fZ,mZ=(l,p)=>{let m=p?.id||HA++;return Fs.addToast({title:l,...p,id:m}),m},_Z=l=>l&&typeof l=="object"&&"ok"in l&&typeof l.ok=="boolean"&&"status"in l&&typeof l.status=="number",gZ=mZ,EZ=()=>Fs.toasts,vZ=()=>Fs.getActiveToasts();Object.assign(gZ,{success:Fs.success,info:Fs.info,warning:Fs.warning,error:Fs.error,custom:Fs.custom,message:Fs.message,promise:Fs.promise,dismiss:Fs.dismiss,loading:Fs.loading},{getHistory:EZ,getToasts:vZ});function yZ(l,{insertAt:p}={}){if(typeof document>"u")return;let m=document.head||document.getElementsByTagName("head")[0],y=document.createElement("style");y.type="text/css",p==="top"&&m.firstChild?m.insertBefore(y,m.firstChild):m.appendChild(y),y.styleSheet?y.styleSheet.cssText=l:y.appendChild(document.createTextNode(l))}yZ(`:where(html[dir="ltr"]),:where([data-sonner-toaster][dir="ltr"]){--toast-icon-margin-start: -3px;--toast-icon-margin-end: 4px;--toast-svg-margin-start: -1px;--toast-svg-margin-end: 0px;--toast-button-margin-start: auto;--toast-button-margin-end: 0;--toast-close-button-start: 0;--toast-close-button-end: unset;--toast-close-button-transform: translate(-35%, -35%)}:where(html[dir="rtl"]),:where([data-sonner-toaster][dir="rtl"]){--toast-icon-margin-start: 4px;--toast-icon-margin-end: -3px;--toast-svg-margin-start: 0px;--toast-svg-margin-end: -1px;--toast-button-margin-start: 0;--toast-button-margin-end: auto;--toast-close-button-start: unset;--toast-close-button-end: 0;--toast-close-button-transform: translate(35%, -35%)}:where([data-sonner-toaster]){position:fixed;width:var(--width);font-family:ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;--gray1: hsl(0, 0%, 99%);--gray2: hsl(0, 0%, 97.3%);--gray3: hsl(0, 0%, 95.1%);--gray4: hsl(0, 0%, 93%);--gray5: hsl(0, 0%, 90.9%);--gray6: hsl(0, 0%, 88.7%);--gray7: hsl(0, 0%, 85.8%);--gray8: hsl(0, 0%, 78%);--gray9: hsl(0, 0%, 56.1%);--gray10: hsl(0, 0%, 52.3%);--gray11: hsl(0, 0%, 43.5%);--gray12: hsl(0, 0%, 9%);--border-radius: 8px;box-sizing:border-box;padding:0;margin:0;list-style:none;outline:none;z-index:999999999;transition:transform .4s ease}:where([data-sonner-toaster][data-lifted="true"]){transform:translateY(-10px)}@media (hover: none) and (pointer: coarse){:where([data-sonner-toaster][data-lifted="true"]){transform:none}}:where([data-sonner-toaster][data-x-position="right"]){right:var(--offset-right)}:where([data-sonner-toaster][data-x-position="left"]){left:var(--offset-left)}:where([data-sonner-toaster][data-x-position="center"]){left:50%;transform:translate(-50%)}:where([data-sonner-toaster][data-y-position="top"]){top:var(--offset-top)}:where([data-sonner-toaster][data-y-position="bottom"]){bottom:var(--offset-bottom)}:where([data-sonner-toast]){--y: translateY(100%);--lift-amount: calc(var(--lift) * var(--gap));z-index:var(--z-index);position:absolute;opacity:0;transform:var(--y);filter:blur(0);touch-action:none;transition:transform .4s,opacity .4s,height .4s,box-shadow .2s;box-sizing:border-box;outline:none;overflow-wrap:anywhere}:where([data-sonner-toast][data-styled="true"]){padding:16px;background:var(--normal-bg);border:1px solid var(--normal-border);color:var(--normal-text);border-radius:var(--border-radius);box-shadow:0 4px 12px #0000001a;width:var(--width);font-size:13px;display:flex;align-items:center;gap:6px}:where([data-sonner-toast]:focus-visible){box-shadow:0 4px 12px #0000001a,0 0 0 2px #0003}:where([data-sonner-toast][data-y-position="top"]){top:0;--y: translateY(-100%);--lift: 1;--lift-amount: calc(1 * var(--gap))}:where([data-sonner-toast][data-y-position="bottom"]){bottom:0;--y: translateY(100%);--lift: -1;--lift-amount: calc(var(--lift) * var(--gap))}:where([data-sonner-toast]) :where([data-description]){font-weight:400;line-height:1.4;color:inherit}:where([data-sonner-toast]) :where([data-title]){font-weight:500;line-height:1.5;color:inherit}:where([data-sonner-toast]) :where([data-icon]){display:flex;height:16px;width:16px;position:relative;justify-content:flex-start;align-items:center;flex-shrink:0;margin-left:var(--toast-icon-margin-start);margin-right:var(--toast-icon-margin-end)}:where([data-sonner-toast][data-promise="true"]) :where([data-icon])>svg{opacity:0;transform:scale(.8);transform-origin:center;animation:sonner-fade-in .3s ease forwards}:where([data-sonner-toast]) :where([data-icon])>*{flex-shrink:0}:where([data-sonner-toast]) :where([data-icon]) svg{margin-left:var(--toast-svg-margin-start);margin-right:var(--toast-svg-margin-end)}:where([data-sonner-toast]) :where([data-content]){display:flex;flex-direction:column;gap:2px}[data-sonner-toast][data-styled=true] [data-button]{border-radius:4px;padding-left:8px;padding-right:8px;height:24px;font-size:12px;color:var(--normal-bg);background:var(--normal-text);margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end);border:none;cursor:pointer;outline:none;display:flex;align-items:center;flex-shrink:0;transition:opacity .4s,box-shadow .2s}:where([data-sonner-toast]) :where([data-button]):focus-visible{box-shadow:0 0 0 2px #0006}:where([data-sonner-toast]) :where([data-button]):first-of-type{margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end)}:where([data-sonner-toast]) :where([data-cancel]){color:var(--normal-text);background:rgba(0,0,0,.08)}:where([data-sonner-toast][data-theme="dark"]) :where([data-cancel]){background:rgba(255,255,255,.3)}:where([data-sonner-toast]) :where([data-close-button]){position:absolute;left:var(--toast-close-button-start);right:var(--toast-close-button-end);top:0;height:20px;width:20px;display:flex;justify-content:center;align-items:center;padding:0;color:var(--gray12);border:1px solid var(--gray4);transform:var(--toast-close-button-transform);border-radius:50%;cursor:pointer;z-index:1;transition:opacity .1s,background .2s,border-color .2s}[data-sonner-toast] [data-close-button]{background:var(--gray1)}:where([data-sonner-toast]) :where([data-close-button]):focus-visible{box-shadow:0 4px 12px #0000001a,0 0 0 2px #0003}:where([data-sonner-toast]) :where([data-disabled="true"]){cursor:not-allowed}:where([data-sonner-toast]):hover :where([data-close-button]):hover{background:var(--gray2);border-color:var(--gray5)}:where([data-sonner-toast][data-swiping="true"]):before{content:"";position:absolute;left:-50%;right:-50%;height:100%;z-index:-1}:where([data-sonner-toast][data-y-position="top"][data-swiping="true"]):before{bottom:50%;transform:scaleY(3) translateY(50%)}:where([data-sonner-toast][data-y-position="bottom"][data-swiping="true"]):before{top:50%;transform:scaleY(3) translateY(-50%)}:where([data-sonner-toast][data-swiping="false"][data-removed="true"]):before{content:"";position:absolute;inset:0;transform:scaleY(2)}:where([data-sonner-toast]):after{content:"";position:absolute;left:0;height:calc(var(--gap) + 1px);bottom:100%;width:100%}:where([data-sonner-toast][data-mounted="true"]){--y: translateY(0);opacity:1}:where([data-sonner-toast][data-expanded="false"][data-front="false"]){--scale: var(--toasts-before) * .05 + 1;--y: translateY(calc(var(--lift-amount) * var(--toasts-before))) scale(calc(-1 * var(--scale)));height:var(--front-toast-height)}:where([data-sonner-toast])>*{transition:opacity .4s}:where([data-sonner-toast][data-expanded="false"][data-front="false"][data-styled="true"])>*{opacity:0}:where([data-sonner-toast][data-visible="false"]){opacity:0;pointer-events:none}:where([data-sonner-toast][data-mounted="true"][data-expanded="true"]){--y: translateY(calc(var(--lift) * var(--offset)));height:var(--initial-height)}:where([data-sonner-toast][data-removed="true"][data-front="true"][data-swipe-out="false"]){--y: translateY(calc(var(--lift) * -100%));opacity:0}:where([data-sonner-toast][data-removed="true"][data-front="false"][data-swipe-out="false"][data-expanded="true"]){--y: translateY(calc(var(--lift) * var(--offset) + var(--lift) * -100%));opacity:0}:where([data-sonner-toast][data-removed="true"][data-front="false"][data-swipe-out="false"][data-expanded="false"]){--y: translateY(40%);opacity:0;transition:transform .5s,opacity .2s}:where([data-sonner-toast][data-removed="true"][data-front="false"]):before{height:calc(var(--initial-height) + 20%)}[data-sonner-toast][data-swiping=true]{transform:var(--y) translateY(var(--swipe-amount-y, 0px)) translate(var(--swipe-amount-x, 0px));transition:none}[data-sonner-toast][data-swiped=true]{user-select:none}[data-sonner-toast][data-swipe-out=true][data-y-position=bottom],[data-sonner-toast][data-swipe-out=true][data-y-position=top]{animation-duration:.2s;animation-timing-function:ease-out;animation-fill-mode:forwards}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=left]{animation-name:swipe-out-left}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=right]{animation-name:swipe-out-right}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=up]{animation-name:swipe-out-up}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=down]{animation-name:swipe-out-down}@keyframes swipe-out-left{0%{transform:var(--y) translate(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translate(calc(var(--swipe-amount-x) - 100%));opacity:0}}@keyframes swipe-out-right{0%{transform:var(--y) translate(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translate(calc(var(--swipe-amount-x) + 100%));opacity:0}}@keyframes swipe-out-up{0%{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) - 100%));opacity:0}}@keyframes swipe-out-down{0%{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) + 100%));opacity:0}}@media (max-width: 600px){[data-sonner-toaster]{position:fixed;right:var(--mobile-offset-right);left:var(--mobile-offset-left);width:100%}[data-sonner-toaster][dir=rtl]{left:calc(var(--mobile-offset-left) * -1)}[data-sonner-toaster] [data-sonner-toast]{left:0;right:0;width:calc(100% - var(--mobile-offset-left) * 2)}[data-sonner-toaster][data-x-position=left]{left:var(--mobile-offset-left)}[data-sonner-toaster][data-y-position=bottom]{bottom:var(--mobile-offset-bottom)}[data-sonner-toaster][data-y-position=top]{top:var(--mobile-offset-top)}[data-sonner-toaster][data-x-position=center]{left:var(--mobile-offset-left);right:var(--mobile-offset-right);transform:none}}[data-sonner-toaster][data-theme=light]{--normal-bg: #fff;--normal-border: var(--gray4);--normal-text: var(--gray12);--success-bg: hsl(143, 85%, 96%);--success-border: hsl(145, 92%, 91%);--success-text: hsl(140, 100%, 27%);--info-bg: hsl(208, 100%, 97%);--info-border: hsl(221, 91%, 91%);--info-text: hsl(210, 92%, 45%);--warning-bg: hsl(49, 100%, 97%);--warning-border: hsl(49, 91%, 91%);--warning-text: hsl(31, 92%, 45%);--error-bg: hsl(359, 100%, 97%);--error-border: hsl(359, 100%, 94%);--error-text: hsl(360, 100%, 45%)}[data-sonner-toaster][data-theme=light] [data-sonner-toast][data-invert=true]{--normal-bg: #000;--normal-border: hsl(0, 0%, 20%);--normal-text: var(--gray1)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast][data-invert=true]{--normal-bg: #fff;--normal-border: var(--gray3);--normal-text: var(--gray12)}[data-sonner-toaster][data-theme=dark]{--normal-bg: #000;--normal-bg-hover: hsl(0, 0%, 12%);--normal-border: hsl(0, 0%, 20%);--normal-border-hover: hsl(0, 0%, 25%);--normal-text: var(--gray1);--success-bg: hsl(150, 100%, 6%);--success-border: hsl(147, 100%, 12%);--success-text: hsl(150, 86%, 65%);--info-bg: hsl(215, 100%, 6%);--info-border: hsl(223, 100%, 12%);--info-text: hsl(216, 87%, 65%);--warning-bg: hsl(64, 100%, 6%);--warning-border: hsl(60, 100%, 12%);--warning-text: hsl(46, 87%, 65%);--error-bg: hsl(358, 76%, 10%);--error-border: hsl(357, 89%, 16%);--error-text: hsl(358, 100%, 81%)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast] [data-close-button]{background:var(--normal-bg);border-color:var(--normal-border);color:var(--normal-text)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast] [data-close-button]:hover{background:var(--normal-bg-hover);border-color:var(--normal-border-hover)}[data-rich-colors=true][data-sonner-toast][data-type=success],[data-rich-colors=true][data-sonner-toast][data-type=success] [data-close-button]{background:var(--success-bg);border-color:var(--success-border);color:var(--success-text)}[data-rich-colors=true][data-sonner-toast][data-type=info],[data-rich-colors=true][data-sonner-toast][data-type=info] [data-close-button]{background:var(--info-bg);border-color:var(--info-border);color:var(--info-text)}[data-rich-colors=true][data-sonner-toast][data-type=warning],[data-rich-colors=true][data-sonner-toast][data-type=warning] [data-close-button]{background:var(--warning-bg);border-color:var(--warning-border);color:var(--warning-text)}[data-rich-colors=true][data-sonner-toast][data-type=error],[data-rich-colors=true][data-sonner-toast][data-type=error] [data-close-button]{background:var(--error-bg);border-color:var(--error-border);color:var(--error-text)}.sonner-loading-wrapper{--size: 16px;height:var(--size);width:var(--size);position:absolute;inset:0;z-index:10}.sonner-loading-wrapper[data-visible=false]{transform-origin:center;animation:sonner-fade-out .2s ease forwards}.sonner-spinner{position:relative;top:50%;left:50%;height:var(--size);width:var(--size)}.sonner-loading-bar{animation:sonner-spin 1.2s linear infinite;background:var(--gray11);border-radius:6px;height:8%;left:-10%;position:absolute;top:-3.9%;width:24%}.sonner-loading-bar:nth-child(1){animation-delay:-1.2s;transform:rotate(.0001deg) translate(146%)}.sonner-loading-bar:nth-child(2){animation-delay:-1.1s;transform:rotate(30deg) translate(146%)}.sonner-loading-bar:nth-child(3){animation-delay:-1s;transform:rotate(60deg) translate(146%)}.sonner-loading-bar:nth-child(4){animation-delay:-.9s;transform:rotate(90deg) translate(146%)}.sonner-loading-bar:nth-child(5){animation-delay:-.8s;transform:rotate(120deg) translate(146%)}.sonner-loading-bar:nth-child(6){animation-delay:-.7s;transform:rotate(150deg) translate(146%)}.sonner-loading-bar:nth-child(7){animation-delay:-.6s;transform:rotate(180deg) translate(146%)}.sonner-loading-bar:nth-child(8){animation-delay:-.5s;transform:rotate(210deg) translate(146%)}.sonner-loading-bar:nth-child(9){animation-delay:-.4s;transform:rotate(240deg) translate(146%)}.sonner-loading-bar:nth-child(10){animation-delay:-.3s;transform:rotate(270deg) translate(146%)}.sonner-loading-bar:nth-child(11){animation-delay:-.2s;transform:rotate(300deg) translate(146%)}.sonner-loading-bar:nth-child(12){animation-delay:-.1s;transform:rotate(330deg) translate(146%)}@keyframes sonner-fade-in{0%{opacity:0;transform:scale(.8)}to{opacity:1;transform:scale(1)}}@keyframes sonner-fade-out{0%{opacity:1;transform:scale(1)}to{opacity:0;transform:scale(.8)}}@keyframes sonner-spin{0%{opacity:1}to{opacity:.15}}@media (prefers-reduced-motion){[data-sonner-toast],[data-sonner-toast]>*,.sonner-loading-bar{transition:none!important;animation:none!important}}.sonner-loader{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);transform-origin:center;transition:opacity .2s,transform .2s}.sonner-loader[data-visible=false]{opacity:0;transform:scale(.8) translate(-50%,-50%)}
`);function mR(l){return l.label!==void 0}var SZ=3,TZ="32px",RZ="16px",mF=4e3,wZ=356,CZ=14,bZ=20,IZ=200;function Ua(...l){return l.filter(Boolean).join(" ")}function AZ(l){let[p,m]=l.split("-"),y=[];return p&&y.push(p),m&&y.push(m),y}var NZ=l=>{var p,m,y,R,C,P,k,M,F,H,K;let{invert:ee,toast:X,unstyled:re,interacting:G,setHeights:J,visibleToasts:te,heights:ne,index:se,toasts:ae,expanded:pe,removeToast:Se,defaultRichColors:Te,closeButton:Ue,style:tt,cancelButtonStyle:gt,actionButtonStyle:ht,className:Ge="",descriptionClassName:pt="",duration:Fe,position:wt,gap:rt,loadingIcon:Je,expandByDefault:De,classNames:Le,icons:ze,closeButtonAriaLabel:fe="Close toast",pauseWhenPageIsHidden:Ne}=l,[st,it]=nt.useState(null),[Pt,zt]=nt.useState(null),[Ye,Nt]=nt.useState(!1),[Gt,Yt]=nt.useState(!1),[Cn,Yn]=nt.useState(!1),[er,ss]=nt.useState(!1),[Ga,Ei]=nt.useState(!1),[ta,Sr]=nt.useState(0),[ci,Eo]=nt.useState(0),Gi=nt.useRef(X.duration||Fe||mF),xl=nt.useRef(null),Ws=nt.useRef(null),Vr=se===0,uu=se+1<=te,vi=X.type,ni=X.dismissible!==!1,zc=X.className||"",Ll=X.descriptionClassName||"",Gs=nt.useMemo(()=>ne.findIndex(Xt=>Xt.toastId===X.id)||0,[ne,X.id]),Ha=nt.useMemo(()=>{var Xt;return(Xt=X.closeButton)!=null?Xt:Ue},[X.closeButton,Ue]),hu=nt.useMemo(()=>X.duration||Fe||mF,[X.duration,Fe]),Yc=nt.useRef(0),Di=nt.useRef(0),pu=nt.useRef(0),vo=nt.useRef(null),[fu,yo]=wt.split("-"),qc=nt.useMemo(()=>ne.reduce((Xt,yn,qn)=>qn>=Gs?Xt:Xt+yn.height,0),[ne,Gs]),Ml=pZ(),Ka=X.invert||ee,So=vi==="loading";Di.current=nt.useMemo(()=>Gs*rt+qc,[Gs,qc]),nt.useEffect(()=>{Gi.current=hu},[hu]),nt.useEffect(()=>{Nt(!0)},[]),nt.useEffect(()=>{let Xt=Ws.current;if(Xt){let yn=Xt.getBoundingClientRect().height;return Eo(yn),J(qn=>[{toastId:X.id,height:yn,position:X.position},...qn]),()=>J(qn=>qn.filter(ki=>ki.toastId!==X.id))}},[J,X.id]),nt.useLayoutEffect(()=>{if(!Ye)return;let Xt=Ws.current,yn=Xt.style.height;Xt.style.height="auto";let qn=Xt.getBoundingClientRect().height;Xt.style.height=yn,Eo(qn),J(ki=>ki.find(Hi=>Hi.toastId===X.id)?ki.map(Hi=>Hi.toastId===X.id?{...Hi,height:qn}:Hi):[{toastId:X.id,height:qn,position:X.position},...ki])},[Ye,X.title,X.description,J,X.id]);let Hs=nt.useCallback(()=>{Yt(!0),Sr(Di.current),J(Xt=>Xt.filter(yn=>yn.toastId!==X.id)),setTimeout(()=>{Se(X)},IZ)},[X,Se,J,Di]);nt.useEffect(()=>{if(X.promise&&vi==="loading"||X.duration===1/0||X.type==="loading")return;let Xt;return pe||G||Ne&&Ml?(()=>{if(pu.current<Yc.current){let yn=new Date().getTime()-Yc.current;Gi.current=Gi.current-yn}pu.current=new Date().getTime()})():Gi.current!==1/0&&(Yc.current=new Date().getTime(),Xt=setTimeout(()=>{var yn;(yn=X.onAutoClose)==null||yn.call(X,X),Hs()},Gi.current)),()=>clearTimeout(Xt)},[pe,G,X,vi,Ne,Ml,Hs]),nt.useEffect(()=>{X.delete&&Hs()},[Hs,X.delete]);function za(){var Xt,yn,qn;return ze!=null&&ze.loading?nt.createElement("div",{className:Ua(Le?.loader,(Xt=X?.classNames)==null?void 0:Xt.loader,"sonner-loader"),"data-visible":vi==="loading"},ze.loading):Je?nt.createElement("div",{className:Ua(Le?.loader,(yn=X?.classNames)==null?void 0:yn.loader,"sonner-loader"),"data-visible":vi==="loading"},Je):nt.createElement(aZ,{className:Ua(Le?.loader,(qn=X?.classNames)==null?void 0:qn.loader),visible:vi==="loading"})}return nt.createElement("li",{tabIndex:0,ref:Ws,className:Ua(Ge,zc,Le?.toast,(p=X?.classNames)==null?void 0:p.toast,Le?.default,Le?.[vi],(m=X?.classNames)==null?void 0:m[vi]),"data-sonner-toast":"","data-rich-colors":(y=X.richColors)!=null?y:Te,"data-styled":!(X.jsx||X.unstyled||re),"data-mounted":Ye,"data-promise":!!X.promise,"data-swiped":Ga,"data-removed":Gt,"data-visible":uu,"data-y-position":fu,"data-x-position":yo,"data-index":se,"data-front":Vr,"data-swiping":Cn,"data-dismissible":ni,"data-type":vi,"data-invert":Ka,"data-swipe-out":er,"data-swipe-direction":Pt,"data-expanded":!!(pe||De&&Ye),style:{"--index":se,"--toasts-before":se,"--z-index":ae.length-se,"--offset":`${Gt?ta:Di.current}px`,"--initial-height":De?"auto":`${ci}px`,...tt,...X.style},onDragEnd:()=>{Yn(!1),it(null),vo.current=null},onPointerDown:Xt=>{So||!ni||(xl.current=new Date,Sr(Di.current),Xt.target.setPointerCapture(Xt.pointerId),Xt.target.tagName!=="BUTTON"&&(Yn(!0),vo.current={x:Xt.clientX,y:Xt.clientY}))},onPointerUp:()=>{var Xt,yn,qn,ki;if(er||!ni)return;vo.current=null;let Hi=Number(((Xt=Ws.current)==null?void 0:Xt.style.getPropertyValue("--swipe-amount-x").replace("px",""))||0),Xn=Number(((yn=Ws.current)==null?void 0:yn.style.getPropertyValue("--swipe-amount-y").replace("px",""))||0),Ks=new Date().getTime()-((qn=xl.current)==null?void 0:qn.getTime()),li=st==="x"?Hi:Xn,os=Math.abs(li)/Ks;if(Math.abs(li)>=bZ||os>.11){Sr(Di.current),(ki=X.onDismiss)==null||ki.call(X,X),zt(st==="x"?Hi>0?"right":"left":Xn>0?"down":"up"),Hs(),ss(!0),Ei(!1);return}Yn(!1),it(null)},onPointerMove:Xt=>{var yn,qn,ki,Hi;if(!vo.current||!ni||((yn=window.getSelection())==null?void 0:yn.toString().length)>0)return;let Xn=Xt.clientY-vo.current.y,Ks=Xt.clientX-vo.current.x,li=(qn=l.swipeDirections)!=null?qn:AZ(wt);!st&&(Math.abs(Ks)>1||Math.abs(Xn)>1)&&it(Math.abs(Ks)>Math.abs(Xn)?"x":"y");let os={x:0,y:0};st==="y"?(li.includes("top")||li.includes("bottom"))&&(li.includes("top")&&Xn<0||li.includes("bottom")&&Xn>0)&&(os.y=Xn):st==="x"&&(li.includes("left")||li.includes("right"))&&(li.includes("left")&&Ks<0||li.includes("right")&&Ks>0)&&(os.x=Ks),(Math.abs(os.x)>0||Math.abs(os.y)>0)&&Ei(!0),(ki=Ws.current)==null||ki.style.setProperty("--swipe-amount-x",`${os.x}px`),(Hi=Ws.current)==null||Hi.style.setProperty("--swipe-amount-y",`${os.y}px`)}},Ha&&!X.jsx?nt.createElement("button",{"aria-label":fe,"data-disabled":So,"data-close-button":!0,onClick:So||!ni?()=>{}:()=>{var Xt;Hs(),(Xt=X.onDismiss)==null||Xt.call(X,X)},className:Ua(Le?.closeButton,(R=X?.classNames)==null?void 0:R.closeButton)},(C=ze?.close)!=null?C:hZ):null,X.jsx||L.isValidElement(X.title)?X.jsx?X.jsx:typeof X.title=="function"?X.title():X.title:nt.createElement(nt.Fragment,null,vi||X.icon||X.promise?nt.createElement("div",{"data-icon":"",className:Ua(Le?.icon,(P=X?.classNames)==null?void 0:P.icon)},X.promise||X.type==="loading"&&!X.icon?X.icon||za():null,X.type!=="loading"?X.icon||ze?.[vi]||sZ(vi):null):null,nt.createElement("div",{"data-content":"",className:Ua(Le?.content,(k=X?.classNames)==null?void 0:k.content)},nt.createElement("div",{"data-title":"",className:Ua(Le?.title,(M=X?.classNames)==null?void 0:M.title)},typeof X.title=="function"?X.title():X.title),X.description?nt.createElement("div",{"data-description":"",className:Ua(pt,Ll,Le?.description,(F=X?.classNames)==null?void 0:F.description)},typeof X.description=="function"?X.description():X.description):null),L.isValidElement(X.cancel)?X.cancel:X.cancel&&mR(X.cancel)?nt.createElement("button",{"data-button":!0,"data-cancel":!0,style:X.cancelButtonStyle||gt,onClick:Xt=>{var yn,qn;mR(X.cancel)&&ni&&((qn=(yn=X.cancel).onClick)==null||qn.call(yn,Xt),Hs())},className:Ua(Le?.cancelButton,(H=X?.classNames)==null?void 0:H.cancelButton)},X.cancel.label):null,L.isValidElement(X.action)?X.action:X.action&&mR(X.action)?nt.createElement("button",{"data-button":!0,"data-action":!0,style:X.actionButtonStyle||ht,onClick:Xt=>{var yn,qn;mR(X.action)&&((qn=(yn=X.action).onClick)==null||qn.call(yn,Xt),!Xt.defaultPrevented&&Hs())},className:Ua(Le?.actionButton,(K=X?.classNames)==null?void 0:K.actionButton)},X.action.label):null))};function _F(){if(typeof window>"u"||typeof document>"u")return"ltr";let l=document.documentElement.getAttribute("dir");return l==="auto"||!l?window.getComputedStyle(document.documentElement).direction:l}function OZ(l,p){let m={};return[l,p].forEach((y,R)=>{let C=R===1,P=C?"--mobile-offset":"--offset",k=C?RZ:TZ;function M(F){["top","right","bottom","left"].forEach(H=>{m[`${P}-${H}`]=typeof F=="number"?`${F}px`:F})}typeof y=="number"||typeof y=="string"?M(y):typeof y=="object"?["top","right","bottom","left"].forEach(F=>{y[F]===void 0?m[`${P}-${F}`]=k:m[`${P}-${F}`]=typeof y[F]=="number"?`${y[F]}px`:y[F]}):M(k)}),m}var PZ=L.forwardRef(function(l,p){let{invert:m,position:y="bottom-right",hotkey:R=["altKey","KeyT"],expand:C,closeButton:P,className:k,offset:M,mobileOffset:F,theme:H="light",richColors:K,duration:ee,style:X,visibleToasts:re=SZ,toastOptions:G,dir:J=_F(),gap:te=CZ,loadingIcon:ne,icons:se,containerAriaLabel:ae="Notifications",pauseWhenPageIsHidden:pe}=l,[Se,Te]=nt.useState([]),Ue=nt.useMemo(()=>Array.from(new Set([y].concat(Se.filter(Ne=>Ne.position).map(Ne=>Ne.position)))),[Se,y]),[tt,gt]=nt.useState([]),[ht,Ge]=nt.useState(!1),[pt,Fe]=nt.useState(!1),[wt,rt]=nt.useState(H!=="system"?H:typeof window<"u"&&window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"),Je=nt.useRef(null),De=R.join("+").replace(/Key/g,"").replace(/Digit/g,""),Le=nt.useRef(null),ze=nt.useRef(!1),fe=nt.useCallback(Ne=>{Te(st=>{var it;return(it=st.find(Pt=>Pt.id===Ne.id))!=null&&it.delete||Fs.dismiss(Ne.id),st.filter(({id:Pt})=>Pt!==Ne.id)})},[]);return nt.useEffect(()=>Fs.subscribe(Ne=>{if(Ne.dismiss){Te(st=>st.map(it=>it.id===Ne.id?{...it,delete:!0}:it));return}setTimeout(()=>{sB.flushSync(()=>{Te(st=>{let it=st.findIndex(Pt=>Pt.id===Ne.id);return it!==-1?[...st.slice(0,it),{...st[it],...Ne},...st.slice(it+1)]:[Ne,...st]})})})}),[]),nt.useEffect(()=>{if(H!=="system"){rt(H);return}if(H==="system"&&(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?rt("dark"):rt("light")),typeof window>"u")return;let Ne=window.matchMedia("(prefers-color-scheme: dark)");try{Ne.addEventListener("change",({matches:st})=>{rt(st?"dark":"light")})}catch{Ne.addListener(({matches:it})=>{try{rt(it?"dark":"light")}catch(Pt){console.error(Pt)}})}},[H]),nt.useEffect(()=>{Se.length<=1&&Ge(!1)},[Se]),nt.useEffect(()=>{let Ne=st=>{var it,Pt;R.every(zt=>st[zt]||st.code===zt)&&(Ge(!0),(it=Je.current)==null||it.focus()),st.code==="Escape"&&(document.activeElement===Je.current||(Pt=Je.current)!=null&&Pt.contains(document.activeElement))&&Ge(!1)};return document.addEventListener("keydown",Ne),()=>document.removeEventListener("keydown",Ne)},[R]),nt.useEffect(()=>{if(Je.current)return()=>{Le.current&&(Le.current.focus({preventScroll:!0}),Le.current=null,ze.current=!1)}},[Je.current]),nt.createElement("section",{ref:p,"aria-label":`${ae} ${De}`,tabIndex:-1,"aria-live":"polite","aria-relevant":"additions text","aria-atomic":"false",suppressHydrationWarning:!0},Ue.map((Ne,st)=>{var it;let[Pt,zt]=Ne.split("-");return Se.length?nt.createElement("ol",{key:Ne,dir:J==="auto"?_F():J,tabIndex:-1,ref:Je,className:k,"data-sonner-toaster":!0,"data-theme":wt,"data-y-position":Pt,"data-lifted":ht&&Se.length>1&&!C,"data-x-position":zt,style:{"--front-toast-height":`${((it=tt[0])==null?void 0:it.height)||0}px`,"--width":`${wZ}px`,"--gap":`${te}px`,...X,...OZ(M,F)},onBlur:Ye=>{ze.current&&!Ye.currentTarget.contains(Ye.relatedTarget)&&(ze.current=!1,Le.current&&(Le.current.focus({preventScroll:!0}),Le.current=null))},onFocus:Ye=>{Ye.target instanceof HTMLElement&&Ye.target.dataset.dismissible==="false"||ze.current||(ze.current=!0,Le.current=Ye.relatedTarget)},onMouseEnter:()=>Ge(!0),onMouseMove:()=>Ge(!0),onMouseLeave:()=>{pt||Ge(!1)},onDragEnd:()=>Ge(!1),onPointerDown:Ye=>{Ye.target instanceof HTMLElement&&Ye.target.dataset.dismissible==="false"||Fe(!0)},onPointerUp:()=>Fe(!1)},Se.filter(Ye=>!Ye.position&&st===0||Ye.position===Ne).map((Ye,Nt)=>{var Gt,Yt;return nt.createElement(NZ,{key:Ye.id,icons:se,index:Nt,toast:Ye,defaultRichColors:K,duration:(Gt=G?.duration)!=null?Gt:ee,className:G?.className,descriptionClassName:G?.descriptionClassName,invert:m,visibleToasts:re,closeButton:(Yt=G?.closeButton)!=null?Yt:P,interacting:pt,position:Ne,style:G?.style,unstyled:G?.unstyled,classNames:G?.classNames,cancelButtonStyle:G?.cancelButtonStyle,actionButtonStyle:G?.actionButtonStyle,removeToast:fe,toasts:Se.filter(Cn=>Cn.position==Ye.position),heights:tt.filter(Cn=>Cn.position==Ye.position),setHeights:gt,expandByDefault:C,gap:te,loadingIcon:ne,expanded:ht,pauseWhenPageIsHidden:pe,swipeDirections:l.swipeDirections})})):null}))});const DZ=({...l})=>{const{theme:p="system"}=n3();return v.jsx(PZ,{theme:p,className:"toaster group",toastOptions:{classNames:{toast:"group toast group-[.toaster]:bg-background group-[.toaster]:text-foreground group-[.toaster]:border-border group-[.toaster]:shadow-lg",description:"group-[.toast]:text-muted-foreground",actionButton:"group-[.toast]:bg-primary group-[.toast]:text-primary-foreground",cancelButton:"group-[.toast]:bg-muted group-[.toast]:text-muted-foreground"}},...l})};var kZ=lN[" useId ".trim().toString()]||(()=>{}),xZ=0;function tu(l){const[p,m]=L.useState(kZ());return ai(()=>{m(y=>y??String(xZ++))},[l]),p?`radix-${p}`:""}const LZ=["top","right","bottom","left"],ou=Math.min,mo=Math.max,OR=Math.round,_R=Math.floor,Bc=l=>({x:l,y:l}),MZ={left:"right",right:"left",bottom:"top",top:"bottom"},UZ={start:"end",end:"start"};function KA(l,p,m){return mo(l,ou(p,m))}function Dl(l,p){return typeof l=="function"?l(p):l}function kl(l){return l.split("-")[0]}function Dm(l){return l.split("-")[1]}function _N(l){return l==="x"?"y":"x"}function gN(l){return l==="y"?"height":"width"}const jZ=new Set(["top","bottom"]);function Fc(l){return jZ.has(kl(l))?"y":"x"}function EN(l){return _N(Fc(l))}function VZ(l,p,m){m===void 0&&(m=!1);const y=Dm(l),R=EN(l),C=gN(R);let P=R==="x"?y===(m?"end":"start")?"right":"left":y==="start"?"bottom":"top";return p.reference[C]>p.floating[C]&&(P=PR(P)),[P,PR(P)]}function FZ(l){const p=PR(l);return[zA(l),p,zA(p)]}function zA(l){return l.replace(/start|end/g,p=>UZ[p])}const gF=["left","right"],EF=["right","left"],BZ=["top","bottom"],WZ=["bottom","top"];function GZ(l,p,m){switch(l){case"top":case"bottom":return m?p?EF:gF:p?gF:EF;case"left":case"right":return p?BZ:WZ;default:return[]}}function HZ(l,p,m,y){const R=Dm(l);let C=GZ(kl(l),m==="start",y);return R&&(C=C.map(P=>P+"-"+R),p&&(C=C.concat(C.map(zA)))),C}function PR(l){return l.replace(/left|right|bottom|top/g,p=>MZ[p])}function KZ(l){return{top:0,right:0,bottom:0,left:0,...l}}function r3(l){return typeof l!="number"?KZ(l):{top:l,right:l,bottom:l,left:l}}function DR(l){const{x:p,y:m,width:y,height:R}=l;return{width:y,height:R,top:m,left:p,right:p+y,bottom:m+R,x:p,y:m}}function vF(l,p,m){let{reference:y,floating:R}=l;const C=Fc(p),P=EN(p),k=gN(P),M=kl(p),F=C==="y",H=y.x+y.width/2-R.width/2,K=y.y+y.height/2-R.height/2,ee=y[k]/2-R[k]/2;let X;switch(M){case"top":X={x:H,y:y.y-R.height};break;case"bottom":X={x:H,y:y.y+y.height};break;case"right":X={x:y.x+y.width,y:K};break;case"left":X={x:y.x-R.width,y:K};break;default:X={x:y.x,y:y.y}}switch(Dm(p)){case"start":X[P]-=ee*(m&&F?-1:1);break;case"end":X[P]+=ee*(m&&F?-1:1);break}return X}const zZ=async(l,p,m)=>{const{placement:y="bottom",strategy:R="absolute",middleware:C=[],platform:P}=m,k=C.filter(Boolean),M=await(P.isRTL==null?void 0:P.isRTL(p));let F=await P.getElementRects({reference:l,floating:p,strategy:R}),{x:H,y:K}=vF(F,y,M),ee=y,X={},re=0;for(let G=0;G<k.length;G++){const{name:J,fn:te}=k[G],{x:ne,y:se,data:ae,reset:pe}=await te({x:H,y:K,initialPlacement:y,placement:ee,strategy:R,middlewareData:X,rects:F,platform:P,elements:{reference:l,floating:p}});H=ne??H,K=se??K,X={...X,[J]:{...X[J],...ae}},pe&&re<=50&&(re++,typeof pe=="object"&&(pe.placement&&(ee=pe.placement),pe.rects&&(F=pe.rects===!0?await P.getElementRects({reference:l,floating:p,strategy:R}):pe.rects),{x:H,y:K}=vF(F,ee,M)),G=-1)}return{x:H,y:K,placement:ee,strategy:R,middlewareData:X}};async function JE(l,p){var m;p===void 0&&(p={});const{x:y,y:R,platform:C,rects:P,elements:k,strategy:M}=l,{boundary:F="clippingAncestors",rootBoundary:H="viewport",elementContext:K="floating",altBoundary:ee=!1,padding:X=0}=Dl(p,l),re=r3(X),J=k[ee?K==="floating"?"reference":"floating":K],te=DR(await C.getClippingRect({element:(m=await(C.isElement==null?void 0:C.isElement(J)))==null||m?J:J.contextElement||await(C.getDocumentElement==null?void 0:C.getDocumentElement(k.floating)),boundary:F,rootBoundary:H,strategy:M})),ne=K==="floating"?{x:y,y:R,width:P.floating.width,height:P.floating.height}:P.reference,se=await(C.getOffsetParent==null?void 0:C.getOffsetParent(k.floating)),ae=await(C.isElement==null?void 0:C.isElement(se))?await(C.getScale==null?void 0:C.getScale(se))||{x:1,y:1}:{x:1,y:1},pe=DR(C.convertOffsetParentRelativeRectToViewportRelativeRect?await C.convertOffsetParentRelativeRectToViewportRelativeRect({elements:k,rect:ne,offsetParent:se,strategy:M}):ne);return{top:(te.top-pe.top+re.top)/ae.y,bottom:(pe.bottom-te.bottom+re.bottom)/ae.y,left:(te.left-pe.left+re.left)/ae.x,right:(pe.right-te.right+re.right)/ae.x}}const YZ=l=>({name:"arrow",options:l,async fn(p){const{x:m,y,placement:R,rects:C,platform:P,elements:k,middlewareData:M}=p,{element:F,padding:H=0}=Dl(l,p)||{};if(F==null)return{};const K=r3(H),ee={x:m,y},X=EN(R),re=gN(X),G=await P.getDimensions(F),J=X==="y",te=J?"top":"left",ne=J?"bottom":"right",se=J?"clientHeight":"clientWidth",ae=C.reference[re]+C.reference[X]-ee[X]-C.floating[re],pe=ee[X]-C.reference[X],Se=await(P.getOffsetParent==null?void 0:P.getOffsetParent(F));let Te=Se?Se[se]:0;(!Te||!await(P.isElement==null?void 0:P.isElement(Se)))&&(Te=k.floating[se]||C.floating[re]);const Ue=ae/2-pe/2,tt=Te/2-G[re]/2-1,gt=ou(K[te],tt),ht=ou(K[ne],tt),Ge=gt,pt=Te-G[re]-ht,Fe=Te/2-G[re]/2+Ue,wt=KA(Ge,Fe,pt),rt=!M.arrow&&Dm(R)!=null&&Fe!==wt&&C.reference[re]/2-(Fe<Ge?gt:ht)-G[re]/2<0,Je=rt?Fe<Ge?Fe-Ge:Fe-pt:0;return{[X]:ee[X]+Je,data:{[X]:wt,centerOffset:Fe-wt-Je,...rt&&{alignmentOffset:Je}},reset:rt}}}),qZ=function(l){return l===void 0&&(l={}),{name:"flip",options:l,async fn(p){var m,y;const{placement:R,middlewareData:C,rects:P,initialPlacement:k,platform:M,elements:F}=p,{mainAxis:H=!0,crossAxis:K=!0,fallbackPlacements:ee,fallbackStrategy:X="bestFit",fallbackAxisSideDirection:re="none",flipAlignment:G=!0,...J}=Dl(l,p);if((m=C.arrow)!=null&&m.alignmentOffset)return{};const te=kl(R),ne=Fc(k),se=kl(k)===k,ae=await(M.isRTL==null?void 0:M.isRTL(F.floating)),pe=ee||(se||!G?[PR(k)]:FZ(k)),Se=re!=="none";!ee&&Se&&pe.push(...HZ(k,G,re,ae));const Te=[k,...pe],Ue=await JE(p,J),tt=[];let gt=((y=C.flip)==null?void 0:y.overflows)||[];if(H&&tt.push(Ue[te]),K){const Fe=VZ(R,P,ae);tt.push(Ue[Fe[0]],Ue[Fe[1]])}if(gt=[...gt,{placement:R,overflows:tt}],!tt.every(Fe=>Fe<=0)){var ht,Ge;const Fe=(((ht=C.flip)==null?void 0:ht.index)||0)+1,wt=Te[Fe];if(wt&&(!(K==="alignment"?ne!==Fc(wt):!1)||gt.every(De=>De.overflows[0]>0&&Fc(De.placement)===ne)))return{data:{index:Fe,overflows:gt},reset:{placement:wt}};let rt=(Ge=gt.filter(Je=>Je.overflows[0]<=0).sort((Je,De)=>Je.overflows[1]-De.overflows[1])[0])==null?void 0:Ge.placement;if(!rt)switch(X){case"bestFit":{var pt;const Je=(pt=gt.filter(De=>{if(Se){const Le=Fc(De.placement);return Le===ne||Le==="y"}return!0}).map(De=>[De.placement,De.overflows.filter(Le=>Le>0).reduce((Le,ze)=>Le+ze,0)]).sort((De,Le)=>De[1]-Le[1])[0])==null?void 0:pt[0];Je&&(rt=Je);break}case"initialPlacement":rt=k;break}if(R!==rt)return{reset:{placement:rt}}}return{}}}};function yF(l,p){return{top:l.top-p.height,right:l.right-p.width,bottom:l.bottom-p.height,left:l.left-p.width}}function SF(l){return LZ.some(p=>l[p]>=0)}const XZ=function(l){return l===void 0&&(l={}),{name:"hide",options:l,async fn(p){const{rects:m}=p,{strategy:y="referenceHidden",...R}=Dl(l,p);switch(y){case"referenceHidden":{const C=await JE(p,{...R,elementContext:"reference"}),P=yF(C,m.reference);return{data:{referenceHiddenOffsets:P,referenceHidden:SF(P)}}}case"escaped":{const C=await JE(p,{...R,altBoundary:!0}),P=yF(C,m.floating);return{data:{escapedOffsets:P,escaped:SF(P)}}}default:return{}}}}},i3=new Set(["left","top"]);async function JZ(l,p){const{placement:m,platform:y,elements:R}=l,C=await(y.isRTL==null?void 0:y.isRTL(R.floating)),P=kl(m),k=Dm(m),M=Fc(m)==="y",F=i3.has(P)?-1:1,H=C&&M?-1:1,K=Dl(p,l);let{mainAxis:ee,crossAxis:X,alignmentAxis:re}=typeof K=="number"?{mainAxis:K,crossAxis:0,alignmentAxis:null}:{mainAxis:K.mainAxis||0,crossAxis:K.crossAxis||0,alignmentAxis:K.alignmentAxis};return k&&typeof re=="number"&&(X=k==="end"?re*-1:re),M?{x:X*H,y:ee*F}:{x:ee*F,y:X*H}}const QZ=function(l){return l===void 0&&(l=0),{name:"offset",options:l,async fn(p){var m,y;const{x:R,y:C,placement:P,middlewareData:k}=p,M=await JZ(p,l);return P===((m=k.offset)==null?void 0:m.placement)&&(y=k.arrow)!=null&&y.alignmentOffset?{}:{x:R+M.x,y:C+M.y,data:{...M,placement:P}}}}},ZZ=function(l){return l===void 0&&(l={}),{name:"shift",options:l,async fn(p){const{x:m,y,placement:R}=p,{mainAxis:C=!0,crossAxis:P=!1,limiter:k={fn:J=>{let{x:te,y:ne}=J;return{x:te,y:ne}}},...M}=Dl(l,p),F={x:m,y},H=await JE(p,M),K=Fc(kl(R)),ee=_N(K);let X=F[ee],re=F[K];if(C){const J=ee==="y"?"top":"left",te=ee==="y"?"bottom":"right",ne=X+H[J],se=X-H[te];X=KA(ne,X,se)}if(P){const J=K==="y"?"top":"left",te=K==="y"?"bottom":"right",ne=re+H[J],se=re-H[te];re=KA(ne,re,se)}const G=k.fn({...p,[ee]:X,[K]:re});return{...G,data:{x:G.x-m,y:G.y-y,enabled:{[ee]:C,[K]:P}}}}}},$Z=function(l){return l===void 0&&(l={}),{options:l,fn(p){const{x:m,y,placement:R,rects:C,middlewareData:P}=p,{offset:k=0,mainAxis:M=!0,crossAxis:F=!0}=Dl(l,p),H={x:m,y},K=Fc(R),ee=_N(K);let X=H[ee],re=H[K];const G=Dl(k,p),J=typeof G=="number"?{mainAxis:G,crossAxis:0}:{mainAxis:0,crossAxis:0,...G};if(M){const se=ee==="y"?"height":"width",ae=C.reference[ee]-C.floating[se]+J.mainAxis,pe=C.reference[ee]+C.reference[se]-J.mainAxis;X<ae?X=ae:X>pe&&(X=pe)}if(F){var te,ne;const se=ee==="y"?"width":"height",ae=i3.has(kl(R)),pe=C.reference[K]-C.floating[se]+(ae&&((te=P.offset)==null?void 0:te[K])||0)+(ae?0:J.crossAxis),Se=C.reference[K]+C.reference[se]+(ae?0:((ne=P.offset)==null?void 0:ne[K])||0)-(ae?J.crossAxis:0);re<pe?re=pe:re>Se&&(re=Se)}return{[ee]:X,[K]:re}}}},e$=function(l){return l===void 0&&(l={}),{name:"size",options:l,async fn(p){var m,y;const{placement:R,rects:C,platform:P,elements:k}=p,{apply:M=()=>{},...F}=Dl(l,p),H=await JE(p,F),K=kl(R),ee=Dm(R),X=Fc(R)==="y",{width:re,height:G}=C.floating;let J,te;K==="top"||K==="bottom"?(J=K,te=ee===(await(P.isRTL==null?void 0:P.isRTL(k.floating))?"start":"end")?"left":"right"):(te=K,J=ee==="end"?"top":"bottom");const ne=G-H.top-H.bottom,se=re-H.left-H.right,ae=ou(G-H[J],ne),pe=ou(re-H[te],se),Se=!p.middlewareData.shift;let Te=ae,Ue=pe;if((m=p.middlewareData.shift)!=null&&m.enabled.x&&(Ue=se),(y=p.middlewareData.shift)!=null&&y.enabled.y&&(Te=ne),Se&&!ee){const gt=mo(H.left,0),ht=mo(H.right,0),Ge=mo(H.top,0),pt=mo(H.bottom,0);X?Ue=re-2*(gt!==0||ht!==0?gt+ht:mo(H.left,H.right)):Te=G-2*(Ge!==0||pt!==0?Ge+pt:mo(H.top,H.bottom))}await M({...p,availableWidth:Ue,availableHeight:Te});const tt=await P.getDimensions(k.floating);return re!==tt.width||G!==tt.height?{reset:{rects:!0}}:{}}}};function KR(){return typeof window<"u"}function km(l){return s3(l)?(l.nodeName||"").toLowerCase():"#document"}function _o(l){var p;return(l==null||(p=l.ownerDocument)==null?void 0:p.defaultView)||window}function Kc(l){var p;return(p=(s3(l)?l.ownerDocument:l.document)||window.document)==null?void 0:p.documentElement}function s3(l){return KR()?l instanceof Node||l instanceof _o(l).Node:!1}function Fa(l){return KR()?l instanceof Element||l instanceof _o(l).Element:!1}function Wc(l){return KR()?l instanceof HTMLElement||l instanceof _o(l).HTMLElement:!1}function TF(l){return!KR()||typeof ShadowRoot>"u"?!1:l instanceof ShadowRoot||l instanceof _o(l).ShadowRoot}const t$=new Set(["inline","contents"]);function sv(l){const{overflow:p,overflowX:m,overflowY:y,display:R}=Ba(l);return/auto|scroll|overlay|hidden|clip/.test(p+y+m)&&!t$.has(R)}const n$=new Set(["table","td","th"]);function r$(l){return n$.has(km(l))}const i$=[":popover-open",":modal"];function zR(l){return i$.some(p=>{try{return l.matches(p)}catch{return!1}})}const s$=["transform","translate","scale","rotate","perspective"],o$=["transform","translate","scale","rotate","perspective","filter"],a$=["paint","layout","strict","content"];function vN(l){const p=yN(),m=Fa(l)?Ba(l):l;return s$.some(y=>m[y]?m[y]!=="none":!1)||(m.containerType?m.containerType!=="normal":!1)||!p&&(m.backdropFilter?m.backdropFilter!=="none":!1)||!p&&(m.filter?m.filter!=="none":!1)||o$.some(y=>(m.willChange||"").includes(y))||a$.some(y=>(m.contain||"").includes(y))}function c$(l){let p=au(l);for(;Wc(p)&&!Am(p);){if(vN(p))return p;if(zR(p))return null;p=au(p)}return null}function yN(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}const l$=new Set(["html","body","#document"]);function Am(l){return l$.has(km(l))}function Ba(l){return _o(l).getComputedStyle(l)}function YR(l){return Fa(l)?{scrollLeft:l.scrollLeft,scrollTop:l.scrollTop}:{scrollLeft:l.scrollX,scrollTop:l.scrollY}}function au(l){if(km(l)==="html")return l;const p=l.assignedSlot||l.parentNode||TF(l)&&l.host||Kc(l);return TF(p)?p.host:p}function o3(l){const p=au(l);return Am(p)?l.ownerDocument?l.ownerDocument.body:l.body:Wc(p)&&sv(p)?p:o3(p)}function QE(l,p,m){var y;p===void 0&&(p=[]),m===void 0&&(m=!0);const R=o3(l),C=R===((y=l.ownerDocument)==null?void 0:y.body),P=_o(R);if(C){const k=YA(P);return p.concat(P,P.visualViewport||[],sv(R)?R:[],k&&m?QE(k):[])}return p.concat(R,QE(R,[],m))}function YA(l){return l.parent&&Object.getPrototypeOf(l.parent)?l.frameElement:null}function a3(l){const p=Ba(l);let m=parseFloat(p.width)||0,y=parseFloat(p.height)||0;const R=Wc(l),C=R?l.offsetWidth:m,P=R?l.offsetHeight:y,k=OR(m)!==C||OR(y)!==P;return k&&(m=C,y=P),{width:m,height:y,$:k}}function SN(l){return Fa(l)?l:l.contextElement}function Rm(l){const p=SN(l);if(!Wc(p))return Bc(1);const m=p.getBoundingClientRect(),{width:y,height:R,$:C}=a3(p);let P=(C?OR(m.width):m.width)/y,k=(C?OR(m.height):m.height)/R;return(!P||!Number.isFinite(P))&&(P=1),(!k||!Number.isFinite(k))&&(k=1),{x:P,y:k}}const d$=Bc(0);function c3(l){const p=_o(l);return!yN()||!p.visualViewport?d$:{x:p.visualViewport.offsetLeft,y:p.visualViewport.offsetTop}}function u$(l,p,m){return p===void 0&&(p=!1),!m||p&&m!==_o(l)?!1:p}function Qh(l,p,m,y){p===void 0&&(p=!1),m===void 0&&(m=!1);const R=l.getBoundingClientRect(),C=SN(l);let P=Bc(1);p&&(y?Fa(y)&&(P=Rm(y)):P=Rm(l));const k=u$(C,m,y)?c3(C):Bc(0);let M=(R.left+k.x)/P.x,F=(R.top+k.y)/P.y,H=R.width/P.x,K=R.height/P.y;if(C){const ee=_o(C),X=y&&Fa(y)?_o(y):y;let re=ee,G=YA(re);for(;G&&y&&X!==re;){const J=Rm(G),te=G.getBoundingClientRect(),ne=Ba(G),se=te.left+(G.clientLeft+parseFloat(ne.paddingLeft))*J.x,ae=te.top+(G.clientTop+parseFloat(ne.paddingTop))*J.y;M*=J.x,F*=J.y,H*=J.x,K*=J.y,M+=se,F+=ae,re=_o(G),G=YA(re)}}return DR({width:H,height:K,x:M,y:F})}function TN(l,p){const m=YR(l).scrollLeft;return p?p.left+m:Qh(Kc(l)).left+m}function l3(l,p,m){m===void 0&&(m=!1);const y=l.getBoundingClientRect(),R=y.left+p.scrollLeft-(m?0:TN(l,y)),C=y.top+p.scrollTop;return{x:R,y:C}}function h$(l){let{elements:p,rect:m,offsetParent:y,strategy:R}=l;const C=R==="fixed",P=Kc(y),k=p?zR(p.floating):!1;if(y===P||k&&C)return m;let M={scrollLeft:0,scrollTop:0},F=Bc(1);const H=Bc(0),K=Wc(y);if((K||!K&&!C)&&((km(y)!=="body"||sv(P))&&(M=YR(y)),Wc(y))){const X=Qh(y);F=Rm(y),H.x=X.x+y.clientLeft,H.y=X.y+y.clientTop}const ee=P&&!K&&!C?l3(P,M,!0):Bc(0);return{width:m.width*F.x,height:m.height*F.y,x:m.x*F.x-M.scrollLeft*F.x+H.x+ee.x,y:m.y*F.y-M.scrollTop*F.y+H.y+ee.y}}function p$(l){return Array.from(l.getClientRects())}function f$(l){const p=Kc(l),m=YR(l),y=l.ownerDocument.body,R=mo(p.scrollWidth,p.clientWidth,y.scrollWidth,y.clientWidth),C=mo(p.scrollHeight,p.clientHeight,y.scrollHeight,y.clientHeight);let P=-m.scrollLeft+TN(l);const k=-m.scrollTop;return Ba(y).direction==="rtl"&&(P+=mo(p.clientWidth,y.clientWidth)-R),{width:R,height:C,x:P,y:k}}function m$(l,p){const m=_o(l),y=Kc(l),R=m.visualViewport;let C=y.clientWidth,P=y.clientHeight,k=0,M=0;if(R){C=R.width,P=R.height;const F=yN();(!F||F&&p==="fixed")&&(k=R.offsetLeft,M=R.offsetTop)}return{width:C,height:P,x:k,y:M}}const _$=new Set(["absolute","fixed"]);function g$(l,p){const m=Qh(l,!0,p==="fixed"),y=m.top+l.clientTop,R=m.left+l.clientLeft,C=Wc(l)?Rm(l):Bc(1),P=l.clientWidth*C.x,k=l.clientHeight*C.y,M=R*C.x,F=y*C.y;return{width:P,height:k,x:M,y:F}}function RF(l,p,m){let y;if(p==="viewport")y=m$(l,m);else if(p==="document")y=f$(Kc(l));else if(Fa(p))y=g$(p,m);else{const R=c3(l);y={x:p.x-R.x,y:p.y-R.y,width:p.width,height:p.height}}return DR(y)}function d3(l,p){const m=au(l);return m===p||!Fa(m)||Am(m)?!1:Ba(m).position==="fixed"||d3(m,p)}function E$(l,p){const m=p.get(l);if(m)return m;let y=QE(l,[],!1).filter(k=>Fa(k)&&km(k)!=="body"),R=null;const C=Ba(l).position==="fixed";let P=C?au(l):l;for(;Fa(P)&&!Am(P);){const k=Ba(P),M=vN(P);!M&&k.position==="fixed"&&(R=null),(C?!M&&!R:!M&&k.position==="static"&&!!R&&_$.has(R.position)||sv(P)&&!M&&d3(l,P))?y=y.filter(H=>H!==P):R=k,P=au(P)}return p.set(l,y),y}function v$(l){let{element:p,boundary:m,rootBoundary:y,strategy:R}=l;const P=[...m==="clippingAncestors"?zR(p)?[]:E$(p,this._c):[].concat(m),y],k=P[0],M=P.reduce((F,H)=>{const K=RF(p,H,R);return F.top=mo(K.top,F.top),F.right=ou(K.right,F.right),F.bottom=ou(K.bottom,F.bottom),F.left=mo(K.left,F.left),F},RF(p,k,R));return{width:M.right-M.left,height:M.bottom-M.top,x:M.left,y:M.top}}function y$(l){const{width:p,height:m}=a3(l);return{width:p,height:m}}function S$(l,p,m){const y=Wc(p),R=Kc(p),C=m==="fixed",P=Qh(l,!0,C,p);let k={scrollLeft:0,scrollTop:0};const M=Bc(0);function F(){M.x=TN(R)}if(y||!y&&!C)if((km(p)!=="body"||sv(R))&&(k=YR(p)),y){const X=Qh(p,!0,C,p);M.x=X.x+p.clientLeft,M.y=X.y+p.clientTop}else R&&F();C&&!y&&R&&F();const H=R&&!y&&!C?l3(R,k):Bc(0),K=P.left+k.scrollLeft-M.x-H.x,ee=P.top+k.scrollTop-M.y-H.y;return{x:K,y:ee,width:P.width,height:P.height}}function RA(l){return Ba(l).position==="static"}function wF(l,p){if(!Wc(l)||Ba(l).position==="fixed")return null;if(p)return p(l);let m=l.offsetParent;return Kc(l)===m&&(m=m.ownerDocument.body),m}function u3(l,p){const m=_o(l);if(zR(l))return m;if(!Wc(l)){let R=au(l);for(;R&&!Am(R);){if(Fa(R)&&!RA(R))return R;R=au(R)}return m}let y=wF(l,p);for(;y&&r$(y)&&RA(y);)y=wF(y,p);return y&&Am(y)&&RA(y)&&!vN(y)?m:y||c$(l)||m}const T$=async function(l){const p=this.getOffsetParent||u3,m=this.getDimensions,y=await m(l.floating);return{reference:S$(l.reference,await p(l.floating),l.strategy),floating:{x:0,y:0,width:y.width,height:y.height}}};function R$(l){return Ba(l).direction==="rtl"}const w$={convertOffsetParentRelativeRectToViewportRelativeRect:h$,getDocumentElement:Kc,getClippingRect:v$,getOffsetParent:u3,getElementRects:T$,getClientRects:p$,getDimensions:y$,getScale:Rm,isElement:Fa,isRTL:R$};function h3(l,p){return l.x===p.x&&l.y===p.y&&l.width===p.width&&l.height===p.height}function C$(l,p){let m=null,y;const R=Kc(l);function C(){var k;clearTimeout(y),(k=m)==null||k.disconnect(),m=null}function P(k,M){k===void 0&&(k=!1),M===void 0&&(M=1),C();const F=l.getBoundingClientRect(),{left:H,top:K,width:ee,height:X}=F;if(k||p(),!ee||!X)return;const re=_R(K),G=_R(R.clientWidth-(H+ee)),J=_R(R.clientHeight-(K+X)),te=_R(H),se={rootMargin:-re+"px "+-G+"px "+-J+"px "+-te+"px",threshold:mo(0,ou(1,M))||1};let ae=!0;function pe(Se){const Te=Se[0].intersectionRatio;if(Te!==M){if(!ae)return P();Te?P(!1,Te):y=setTimeout(()=>{P(!1,1e-7)},1e3)}Te===1&&!h3(F,l.getBoundingClientRect())&&P(),ae=!1}try{m=new IntersectionObserver(pe,{...se,root:R.ownerDocument})}catch{m=new IntersectionObserver(pe,se)}m.observe(l)}return P(!0),C}function b$(l,p,m,y){y===void 0&&(y={});const{ancestorScroll:R=!0,ancestorResize:C=!0,elementResize:P=typeof ResizeObserver=="function",layoutShift:k=typeof IntersectionObserver=="function",animationFrame:M=!1}=y,F=SN(l),H=R||C?[...F?QE(F):[],...QE(p)]:[];H.forEach(te=>{R&&te.addEventListener("scroll",m,{passive:!0}),C&&te.addEventListener("resize",m)});const K=F&&k?C$(F,m):null;let ee=-1,X=null;P&&(X=new ResizeObserver(te=>{let[ne]=te;ne&&ne.target===F&&X&&(X.unobserve(p),cancelAnimationFrame(ee),ee=requestAnimationFrame(()=>{var se;(se=X)==null||se.observe(p)})),m()}),F&&!M&&X.observe(F),X.observe(p));let re,G=M?Qh(l):null;M&&J();function J(){const te=Qh(l);G&&!h3(G,te)&&m(),G=te,re=requestAnimationFrame(J)}return m(),()=>{var te;H.forEach(ne=>{R&&ne.removeEventListener("scroll",m),C&&ne.removeEventListener("resize",m)}),K?.(),(te=X)==null||te.disconnect(),X=null,M&&cancelAnimationFrame(re)}}const I$=QZ,A$=ZZ,N$=qZ,O$=e$,P$=XZ,CF=YZ,D$=$Z,k$=(l,p,m)=>{const y=new Map,R={platform:w$,...m},C={...R.platform,_c:y};return zZ(l,p,{...R,platform:C})};var x$=typeof document<"u",L$=function(){},CR=x$?L.useLayoutEffect:L$;function kR(l,p){if(l===p)return!0;if(typeof l!=typeof p)return!1;if(typeof l=="function"&&l.toString()===p.toString())return!0;let m,y,R;if(l&&p&&typeof l=="object"){if(Array.isArray(l)){if(m=l.length,m!==p.length)return!1;for(y=m;y--!==0;)if(!kR(l[y],p[y]))return!1;return!0}if(R=Object.keys(l),m=R.length,m!==Object.keys(p).length)return!1;for(y=m;y--!==0;)if(!{}.hasOwnProperty.call(p,R[y]))return!1;for(y=m;y--!==0;){const C=R[y];if(!(C==="_owner"&&l.$$typeof)&&!kR(l[C],p[C]))return!1}return!0}return l!==l&&p!==p}function p3(l){return typeof window>"u"?1:(l.ownerDocument.defaultView||window).devicePixelRatio||1}function bF(l,p){const m=p3(l);return Math.round(p*m)/m}function wA(l){const p=L.useRef(l);return CR(()=>{p.current=l}),p}function M$(l){l===void 0&&(l={});const{placement:p="bottom",strategy:m="absolute",middleware:y=[],platform:R,elements:{reference:C,floating:P}={},transform:k=!0,whileElementsMounted:M,open:F}=l,[H,K]=L.useState({x:0,y:0,strategy:m,placement:p,middlewareData:{},isPositioned:!1}),[ee,X]=L.useState(y);kR(ee,y)||X(y);const[re,G]=L.useState(null),[J,te]=L.useState(null),ne=L.useCallback(De=>{De!==Se.current&&(Se.current=De,G(De))},[]),se=L.useCallback(De=>{De!==Te.current&&(Te.current=De,te(De))},[]),ae=C||re,pe=P||J,Se=L.useRef(null),Te=L.useRef(null),Ue=L.useRef(H),tt=M!=null,gt=wA(M),ht=wA(R),Ge=wA(F),pt=L.useCallback(()=>{if(!Se.current||!Te.current)return;const De={placement:p,strategy:m,middleware:ee};ht.current&&(De.platform=ht.current),k$(Se.current,Te.current,De).then(Le=>{const ze={...Le,isPositioned:Ge.current!==!1};Fe.current&&!kR(Ue.current,ze)&&(Ue.current=ze,Om.flushSync(()=>{K(ze)}))})},[ee,p,m,ht,Ge]);CR(()=>{F===!1&&Ue.current.isPositioned&&(Ue.current.isPositioned=!1,K(De=>({...De,isPositioned:!1})))},[F]);const Fe=L.useRef(!1);CR(()=>(Fe.current=!0,()=>{Fe.current=!1}),[]),CR(()=>{if(ae&&(Se.current=ae),pe&&(Te.current=pe),ae&&pe){if(gt.current)return gt.current(ae,pe,pt);pt()}},[ae,pe,pt,gt,tt]);const wt=L.useMemo(()=>({reference:Se,floating:Te,setReference:ne,setFloating:se}),[ne,se]),rt=L.useMemo(()=>({reference:ae,floating:pe}),[ae,pe]),Je=L.useMemo(()=>{const De={position:m,left:0,top:0};if(!rt.floating)return De;const Le=bF(rt.floating,H.x),ze=bF(rt.floating,H.y);return k?{...De,transform:"translate("+Le+"px, "+ze+"px)",...p3(rt.floating)>=1.5&&{willChange:"transform"}}:{position:m,left:Le,top:ze}},[m,k,rt.floating,H.x,H.y]);return L.useMemo(()=>({...H,update:pt,refs:wt,elements:rt,floatingStyles:Je}),[H,pt,wt,rt,Je])}const U$=l=>{function p(m){return{}.hasOwnProperty.call(m,"current")}return{name:"arrow",options:l,fn(m){const{element:y,padding:R}=typeof l=="function"?l(m):l;return y&&p(y)?y.current!=null?CF({element:y.current,padding:R}).fn(m):{}:y?CF({element:y,padding:R}).fn(m):{}}}},j$=(l,p)=>({...I$(l),options:[l,p]}),V$=(l,p)=>({...A$(l),options:[l,p]}),F$=(l,p)=>({...D$(l),options:[l,p]}),B$=(l,p)=>({...N$(l),options:[l,p]}),W$=(l,p)=>({...O$(l),options:[l,p]}),G$=(l,p)=>({...P$(l),options:[l,p]}),H$=(l,p)=>({...U$(l),options:[l,p]});var K$="Arrow",f3=L.forwardRef((l,p)=>{const{children:m,width:y=10,height:R=5,...C}=l;return v.jsx(nn.svg,{...C,ref:p,width:y,height:R,viewBox:"0 0 30 10",preserveAspectRatio:"none",children:l.asChild?m:v.jsx("polygon",{points:"0,0 30,0 15,10"})})});f3.displayName=K$;var z$=f3;function m3(l){const[p,m]=L.useState(void 0);return ai(()=>{if(l){m({width:l.offsetWidth,height:l.offsetHeight});const y=new ResizeObserver(R=>{if(!Array.isArray(R)||!R.length)return;const C=R[0];let P,k;if("borderBoxSize"in C){const M=C.borderBoxSize,F=Array.isArray(M)?M[0]:M;P=F.inlineSize,k=F.blockSize}else P=l.offsetWidth,k=l.offsetHeight;m({width:P,height:k})});return y.observe(l,{box:"border-box"}),()=>y.unobserve(l)}else m(void 0)},[l]),p}var RN="Popper",[_3,qR]=Hc(RN),[Y$,g3]=_3(RN),E3=l=>{const{__scopePopper:p,children:m}=l,[y,R]=L.useState(null);return v.jsx(Y$,{scope:p,anchor:y,onAnchorChange:R,children:m})};E3.displayName=RN;var v3="PopperAnchor",y3=L.forwardRef((l,p)=>{const{__scopePopper:m,virtualRef:y,...R}=l,C=g3(v3,m),P=L.useRef(null),k=or(p,P);return L.useEffect(()=>{C.onAnchorChange(y?.current||P.current)}),y?null:v.jsx(nn.div,{...R,ref:k})});y3.displayName=v3;var wN="PopperContent",[q$,X$]=_3(wN),S3=L.forwardRef((l,p)=>{const{__scopePopper:m,side:y="bottom",sideOffset:R=0,align:C="center",alignOffset:P=0,arrowPadding:k=0,avoidCollisions:M=!0,collisionBoundary:F=[],collisionPadding:H=0,sticky:K="partial",hideWhenDetached:ee=!1,updatePositionStrategy:X="optimized",onPlaced:re,...G}=l,J=g3(wN,m),[te,ne]=L.useState(null),se=or(p,Ye=>ne(Ye)),[ae,pe]=L.useState(null),Se=m3(ae),Te=Se?.width??0,Ue=Se?.height??0,tt=y+(C!=="center"?"-"+C:""),gt=typeof H=="number"?H:{top:0,right:0,bottom:0,left:0,...H},ht=Array.isArray(F)?F:[F],Ge=ht.length>0,pt={padding:gt,boundary:ht.filter(Q$),altBoundary:Ge},{refs:Fe,floatingStyles:wt,placement:rt,isPositioned:Je,middlewareData:De}=M$({strategy:"fixed",placement:tt,whileElementsMounted:(...Ye)=>b$(...Ye,{animationFrame:X==="always"}),elements:{reference:J.anchor},middleware:[j$({mainAxis:R+Ue,alignmentAxis:P}),M&&V$({mainAxis:!0,crossAxis:!1,limiter:K==="partial"?F$():void 0,...pt}),M&&B$({...pt}),W$({...pt,apply:({elements:Ye,rects:Nt,availableWidth:Gt,availableHeight:Yt})=>{const{width:Cn,height:Yn}=Nt.reference,er=Ye.floating.style;er.setProperty("--radix-popper-available-width",`${Gt}px`),er.setProperty("--radix-popper-available-height",`${Yt}px`),er.setProperty("--radix-popper-anchor-width",`${Cn}px`),er.setProperty("--radix-popper-anchor-height",`${Yn}px`)}}),ae&&H$({element:ae,padding:k}),Z$({arrowWidth:Te,arrowHeight:Ue}),ee&&G$({strategy:"referenceHidden",...pt})]}),[Le,ze]=w3(rt),fe=go(re);ai(()=>{Je&&fe?.()},[Je,fe]);const Ne=De.arrow?.x,st=De.arrow?.y,it=De.arrow?.centerOffset!==0,[Pt,zt]=L.useState();return ai(()=>{te&&zt(window.getComputedStyle(te).zIndex)},[te]),v.jsx("div",{ref:Fe.setFloating,"data-radix-popper-content-wrapper":"",style:{...wt,transform:Je?wt.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:Pt,"--radix-popper-transform-origin":[De.transformOrigin?.x,De.transformOrigin?.y].join(" "),...De.hide?.referenceHidden&&{visibility:"hidden",pointerEvents:"none"}},dir:l.dir,children:v.jsx(q$,{scope:m,placedSide:Le,onArrowChange:pe,arrowX:Ne,arrowY:st,shouldHideArrow:it,children:v.jsx(nn.div,{"data-side":Le,"data-align":ze,...G,ref:se,style:{...G.style,animation:Je?void 0:"none"}})})})});S3.displayName=wN;var T3="PopperArrow",J$={top:"bottom",right:"left",bottom:"top",left:"right"},R3=L.forwardRef(function(p,m){const{__scopePopper:y,...R}=p,C=X$(T3,y),P=J$[C.placedSide];return v.jsx("span",{ref:C.onArrowChange,style:{position:"absolute",left:C.arrowX,top:C.arrowY,[P]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[C.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[C.placedSide],visibility:C.shouldHideArrow?"hidden":void 0},children:v.jsx(z$,{...R,ref:m,style:{...R.style,display:"block"}})})});R3.displayName=T3;function Q$(l){return l!==null}var Z$=l=>({name:"transformOrigin",options:l,fn(p){const{placement:m,rects:y,middlewareData:R}=p,P=R.arrow?.centerOffset!==0,k=P?0:l.arrowWidth,M=P?0:l.arrowHeight,[F,H]=w3(m),K={start:"0%",center:"50%",end:"100%"}[H],ee=(R.arrow?.x??0)+k/2,X=(R.arrow?.y??0)+M/2;let re="",G="";return F==="bottom"?(re=P?K:`${ee}px`,G=`${-M}px`):F==="top"?(re=P?K:`${ee}px`,G=`${y.floating.height+M}px`):F==="right"?(re=`${-M}px`,G=P?K:`${X}px`):F==="left"&&(re=`${y.floating.width+M}px`,G=P?K:`${X}px`),{data:{x:re,y:G}}}});function w3(l){const[p,m="center"]=l.split("-");return[p,m]}var $$=E3,C3=y3,b3=S3,I3=R3,[XR]=Hc("Tooltip",[qR]),CN=qR(),A3="TooltipProvider",eee=700,IF="tooltip.open",[tee,N3]=XR(A3),O3=l=>{const{__scopeTooltip:p,delayDuration:m=eee,skipDelayDuration:y=300,disableHoverableContent:R=!1,children:C}=l,P=L.useRef(!0),k=L.useRef(!1),M=L.useRef(0);return L.useEffect(()=>{const F=M.current;return()=>window.clearTimeout(F)},[]),v.jsx(tee,{scope:p,isOpenDelayedRef:P,delayDuration:m,onOpen:L.useCallback(()=>{window.clearTimeout(M.current),P.current=!1},[]),onClose:L.useCallback(()=>{window.clearTimeout(M.current),M.current=window.setTimeout(()=>P.current=!0,y)},[y]),isPointerInTransitRef:k,onPointerInTransitChange:L.useCallback(F=>{k.current=F},[]),disableHoverableContent:R,children:C})};O3.displayName=A3;var P3="Tooltip",[zie,JR]=XR(P3),qA="TooltipTrigger",nee=L.forwardRef((l,p)=>{const{__scopeTooltip:m,...y}=l,R=JR(qA,m),C=N3(qA,m),P=CN(m),k=L.useRef(null),M=or(p,k,R.onTriggerChange),F=L.useRef(!1),H=L.useRef(!1),K=L.useCallback(()=>F.current=!1,[]);return L.useEffect(()=>()=>document.removeEventListener("pointerup",K),[K]),v.jsx(C3,{asChild:!0,...P,children:v.jsx(nn.button,{"aria-describedby":R.open?R.contentId:void 0,"data-state":R.stateAttribute,...y,ref:M,onPointerMove:Ht(l.onPointerMove,ee=>{ee.pointerType!=="touch"&&!H.current&&!C.isPointerInTransitRef.current&&(R.onTriggerEnter(),H.current=!0)}),onPointerLeave:Ht(l.onPointerLeave,()=>{R.onTriggerLeave(),H.current=!1}),onPointerDown:Ht(l.onPointerDown,()=>{R.open&&R.onClose(),F.current=!0,document.addEventListener("pointerup",K,{once:!0})}),onFocus:Ht(l.onFocus,()=>{F.current||R.onOpen()}),onBlur:Ht(l.onBlur,R.onClose),onClick:Ht(l.onClick,R.onClose)})})});nee.displayName=qA;var ree="TooltipPortal",[Yie,iee]=XR(ree,{forceMount:void 0}),Nm="TooltipContent",D3=L.forwardRef((l,p)=>{const m=iee(Nm,l.__scopeTooltip),{forceMount:y=m.forceMount,side:R="top",...C}=l,P=JR(Nm,l.__scopeTooltip);return v.jsx(tp,{present:y||P.open,children:P.disableHoverableContent?v.jsx(k3,{side:R,...C,ref:p}):v.jsx(see,{side:R,...C,ref:p})})}),see=L.forwardRef((l,p)=>{const m=JR(Nm,l.__scopeTooltip),y=N3(Nm,l.__scopeTooltip),R=L.useRef(null),C=or(p,R),[P,k]=L.useState(null),{trigger:M,onClose:F}=m,H=R.current,{onPointerInTransitChange:K}=y,ee=L.useCallback(()=>{k(null),K(!1)},[K]),X=L.useCallback((re,G)=>{const J=re.currentTarget,te={x:re.clientX,y:re.clientY},ne=dee(te,J.getBoundingClientRect()),se=uee(te,ne),ae=hee(G.getBoundingClientRect()),pe=fee([...se,...ae]);k(pe),K(!0)},[K]);return L.useEffect(()=>()=>ee(),[ee]),L.useEffect(()=>{if(M&&H){const re=J=>X(J,H),G=J=>X(J,M);return M.addEventListener("pointerleave",re),H.addEventListener("pointerleave",G),()=>{M.removeEventListener("pointerleave",re),H.removeEventListener("pointerleave",G)}}},[M,H,X,ee]),L.useEffect(()=>{if(P){const re=G=>{const J=G.target,te={x:G.clientX,y:G.clientY},ne=M?.contains(J)||H?.contains(J),se=!pee(te,P);ne?ee():se&&(ee(),F())};return document.addEventListener("pointermove",re),()=>document.removeEventListener("pointermove",re)}},[M,H,P,F,ee]),v.jsx(k3,{...l,ref:C})}),[oee,aee]=XR(P3,{isInside:!1}),cee=lJ("TooltipContent"),k3=L.forwardRef((l,p)=>{const{__scopeTooltip:m,children:y,"aria-label":R,onEscapeKeyDown:C,onPointerDownOutside:P,...k}=l,M=JR(Nm,m),F=CN(m),{onClose:H}=M;return L.useEffect(()=>(document.addEventListener(IF,H),()=>document.removeEventListener(IF,H)),[H]),L.useEffect(()=>{if(M.trigger){const K=ee=>{ee.target?.contains(M.trigger)&&H()};return window.addEventListener("scroll",K,{capture:!0}),()=>window.removeEventListener("scroll",K,{capture:!0})}},[M.trigger,H]),v.jsx(rv,{asChild:!0,disableOutsidePointerEvents:!1,onEscapeKeyDown:C,onPointerDownOutside:P,onFocusOutside:K=>K.preventDefault(),onDismiss:H,children:v.jsxs(b3,{"data-state":M.stateAttribute,...F,...k,ref:p,style:{...k.style,"--radix-tooltip-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-tooltip-content-available-width":"var(--radix-popper-available-width)","--radix-tooltip-content-available-height":"var(--radix-popper-available-height)","--radix-tooltip-trigger-width":"var(--radix-popper-anchor-width)","--radix-tooltip-trigger-height":"var(--radix-popper-anchor-height)"},children:[v.jsx(cee,{children:y}),v.jsx(oee,{scope:m,isInside:!0,children:v.jsx(PJ,{id:M.contentId,role:"tooltip",children:R||y})})]})})});D3.displayName=Nm;var x3="TooltipArrow",lee=L.forwardRef((l,p)=>{const{__scopeTooltip:m,...y}=l,R=CN(m);return aee(x3,m).isInside?null:v.jsx(I3,{...R,...y,ref:p})});lee.displayName=x3;function dee(l,p){const m=Math.abs(p.top-l.y),y=Math.abs(p.bottom-l.y),R=Math.abs(p.right-l.x),C=Math.abs(p.left-l.x);switch(Math.min(m,y,R,C)){case C:return"left";case R:return"right";case m:return"top";case y:return"bottom";default:throw new Error("unreachable")}}function uee(l,p,m=5){const y=[];switch(p){case"top":y.push({x:l.x-m,y:l.y+m},{x:l.x+m,y:l.y+m});break;case"bottom":y.push({x:l.x-m,y:l.y-m},{x:l.x+m,y:l.y-m});break;case"left":y.push({x:l.x+m,y:l.y-m},{x:l.x+m,y:l.y+m});break;case"right":y.push({x:l.x-m,y:l.y-m},{x:l.x-m,y:l.y+m});break}return y}function hee(l){const{top:p,right:m,bottom:y,left:R}=l;return[{x:R,y:p},{x:m,y:p},{x:m,y},{x:R,y}]}function pee(l,p){const{x:m,y}=l;let R=!1;for(let C=0,P=p.length-1;C<p.length;P=C++){const k=p[C],M=p[P],F=k.x,H=k.y,K=M.x,ee=M.y;H>y!=ee>y&&m<(K-F)*(y-H)/(ee-H)+F&&(R=!R)}return R}function fee(l){const p=l.slice();return p.sort((m,y)=>m.x<y.x?-1:m.x>y.x?1:m.y<y.y?-1:m.y>y.y?1:0),mee(p)}function mee(l){if(l.length<=1)return l.slice();const p=[];for(let y=0;y<l.length;y++){const R=l[y];for(;p.length>=2;){const C=p[p.length-1],P=p[p.length-2];if((C.x-P.x)*(R.y-P.y)>=(C.y-P.y)*(R.x-P.x))p.pop();else break}p.push(R)}p.pop();const m=[];for(let y=l.length-1;y>=0;y--){const R=l[y];for(;m.length>=2;){const C=m[m.length-1],P=m[m.length-2];if((C.x-P.x)*(R.y-P.y)>=(C.y-P.y)*(R.x-P.x))m.pop();else break}m.push(R)}return m.pop(),p.length===1&&m.length===1&&p[0].x===m[0].x&&p[0].y===m[0].y?p:p.concat(m)}var _ee=O3,L3=D3;const gee=_ee,Eee=L.forwardRef(({className:l,sideOffset:p=4,...m},y)=>v.jsx(L3,{ref:y,sideOffset:p,className:gn("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",l),...m}));Eee.displayName=L3.displayName;var QR=class{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(l){return this.listeners.add(l),this.onSubscribe(),()=>{this.listeners.delete(l),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}},ZR=typeof window>"u"||"Deno"in globalThis;function Va(){}function vee(l,p){return typeof l=="function"?l(p):l}function yee(l){return typeof l=="number"&&l>=0&&l!==1/0}function See(l,p){return Math.max(l+(p||0)-Date.now(),0)}function XA(l,p){return typeof l=="function"?l(p):l}function Tee(l,p){return typeof l=="function"?l(p):l}function AF(l,p){const{type:m="all",exact:y,fetchStatus:R,predicate:C,queryKey:P,stale:k}=l;if(P){if(y){if(p.queryHash!==bN(P,p.options))return!1}else if(!$E(p.queryKey,P))return!1}if(m!=="all"){const M=p.isActive();if(m==="active"&&!M||m==="inactive"&&M)return!1}return!(typeof k=="boolean"&&p.isStale()!==k||R&&R!==p.state.fetchStatus||C&&!C(p))}function NF(l,p){const{exact:m,status:y,predicate:R,mutationKey:C}=l;if(C){if(!p.options.mutationKey)return!1;if(m){if(ZE(p.options.mutationKey)!==ZE(C))return!1}else if(!$E(p.options.mutationKey,C))return!1}return!(y&&p.state.status!==y||R&&!R(p))}function bN(l,p){return(p?.queryKeyHashFn||ZE)(l)}function ZE(l){return JSON.stringify(l,(p,m)=>JA(m)?Object.keys(m).sort().reduce((y,R)=>(y[R]=m[R],y),{}):m)}function $E(l,p){return l===p?!0:typeof l!=typeof p?!1:l&&p&&typeof l=="object"&&typeof p=="object"?Object.keys(p).every(m=>$E(l[m],p[m])):!1}function M3(l,p){if(l===p)return l;const m=OF(l)&&OF(p);if(m||JA(l)&&JA(p)){const y=m?l:Object.keys(l),R=y.length,C=m?p:Object.keys(p),P=C.length,k=m?[]:{},M=new Set(y);let F=0;for(let H=0;H<P;H++){const K=m?H:C[H];(!m&&M.has(K)||m)&&l[K]===void 0&&p[K]===void 0?(k[K]=void 0,F++):(k[K]=M3(l[K],p[K]),k[K]===l[K]&&l[K]!==void 0&&F++)}return R===P&&F===R?l:k}return p}function OF(l){return Array.isArray(l)&&l.length===Object.keys(l).length}function JA(l){if(!PF(l))return!1;const p=l.constructor;if(p===void 0)return!0;const m=p.prototype;return!(!PF(m)||!m.hasOwnProperty("isPrototypeOf")||Object.getPrototypeOf(l)!==Object.prototype)}function PF(l){return Object.prototype.toString.call(l)==="[object Object]"}function Ree(l){return new Promise(p=>{setTimeout(p,l)})}function wee(l,p,m){return typeof m.structuralSharing=="function"?m.structuralSharing(l,p):m.structuralSharing!==!1?M3(l,p):p}function Cee(l,p,m=0){const y=[...l,p];return m&&y.length>m?y.slice(1):y}function bee(l,p,m=0){const y=[p,...l];return m&&y.length>m?y.slice(0,-1):y}var IN=Symbol();function U3(l,p){return!l.queryFn&&p?.initialPromise?()=>p.initialPromise:!l.queryFn||l.queryFn===IN?()=>Promise.reject(new Error(`Missing queryFn: '${l.queryHash}'`)):l.queryFn}var Iee=class extends QR{#e;#t;#n;constructor(){super(),this.#n=l=>{if(!ZR&&window.addEventListener){const p=()=>l();return window.addEventListener("visibilitychange",p,!1),()=>{window.removeEventListener("visibilitychange",p)}}}}onSubscribe(){this.#t||this.setEventListener(this.#n)}onUnsubscribe(){this.hasListeners()||(this.#t?.(),this.#t=void 0)}setEventListener(l){this.#n=l,this.#t?.(),this.#t=l(p=>{typeof p=="boolean"?this.setFocused(p):this.onFocus()})}setFocused(l){this.#e!==l&&(this.#e=l,this.onFocus())}onFocus(){const l=this.isFocused();this.listeners.forEach(p=>{p(l)})}isFocused(){return typeof this.#e=="boolean"?this.#e:globalThis.document?.visibilityState!=="hidden"}},j3=new Iee,Aee=class extends QR{#e=!0;#t;#n;constructor(){super(),this.#n=l=>{if(!ZR&&window.addEventListener){const p=()=>l(!0),m=()=>l(!1);return window.addEventListener("online",p,!1),window.addEventListener("offline",m,!1),()=>{window.removeEventListener("online",p),window.removeEventListener("offline",m)}}}}onSubscribe(){this.#t||this.setEventListener(this.#n)}onUnsubscribe(){this.hasListeners()||(this.#t?.(),this.#t=void 0)}setEventListener(l){this.#n=l,this.#t?.(),this.#t=l(this.setOnline.bind(this))}setOnline(l){this.#e!==l&&(this.#e=l,this.listeners.forEach(m=>{m(l)}))}isOnline(){return this.#e}},xR=new Aee;function Nee(){let l,p;const m=new Promise((R,C)=>{l=R,p=C});m.status="pending",m.catch(()=>{});function y(R){Object.assign(m,R),delete m.resolve,delete m.reject}return m.resolve=R=>{y({status:"fulfilled",value:R}),l(R)},m.reject=R=>{y({status:"rejected",reason:R}),p(R)},m}function Oee(l){return Math.min(1e3*2**l,3e4)}function V3(l){return(l??"online")==="online"?xR.isOnline():!0}var F3=class extends Error{constructor(l){super("CancelledError"),this.revert=l?.revert,this.silent=l?.silent}};function CA(l){return l instanceof F3}function B3(l){let p=!1,m=0,y=!1,R;const C=Nee(),P=G=>{y||(ee(new F3(G)),l.abort?.())},k=()=>{p=!0},M=()=>{p=!1},F=()=>j3.isFocused()&&(l.networkMode==="always"||xR.isOnline())&&l.canRun(),H=()=>V3(l.networkMode)&&l.canRun(),K=G=>{y||(y=!0,l.onSuccess?.(G),R?.(),C.resolve(G))},ee=G=>{y||(y=!0,l.onError?.(G),R?.(),C.reject(G))},X=()=>new Promise(G=>{R=J=>{(y||F())&&G(J)},l.onPause?.()}).then(()=>{R=void 0,y||l.onContinue?.()}),re=()=>{if(y)return;let G;const J=m===0?l.initialPromise:void 0;try{G=J??l.fn()}catch(te){G=Promise.reject(te)}Promise.resolve(G).then(K).catch(te=>{if(y)return;const ne=l.retry??(ZR?0:3),se=l.retryDelay??Oee,ae=typeof se=="function"?se(m,te):se,pe=ne===!0||typeof ne=="number"&&m<ne||typeof ne=="function"&&ne(m,te);if(p||!pe){ee(te);return}m++,l.onFail?.(m,te),Ree(ae).then(()=>F()?void 0:X()).then(()=>{p?ee(te):re()})})};return{promise:C,cancel:P,continue:()=>(R?.(),C),cancelRetry:k,continueRetry:M,canStart:H,start:()=>(H()?re():X().then(re),C)}}var Pee=l=>setTimeout(l,0);function Dee(){let l=[],p=0,m=k=>{k()},y=k=>{k()},R=Pee;const C=k=>{p?l.push(k):R(()=>{m(k)})},P=()=>{const k=l;l=[],k.length&&R(()=>{y(()=>{k.forEach(M=>{m(M)})})})};return{batch:k=>{let M;p++;try{M=k()}finally{p--,p||P()}return M},batchCalls:k=>(...M)=>{C(()=>{k(...M)})},schedule:C,setNotifyFunction:k=>{m=k},setBatchNotifyFunction:k=>{y=k},setScheduler:k=>{R=k}}}var vs=Dee(),W3=class{#e;destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),yee(this.gcTime)&&(this.#e=setTimeout(()=>{this.optionalRemove()},this.gcTime))}updateGcTime(l){this.gcTime=Math.max(this.gcTime||0,l??(ZR?1/0:300*1e3))}clearGcTimeout(){this.#e&&(clearTimeout(this.#e),this.#e=void 0)}},kee=class extends W3{#e;#t;#n;#i;#r;#o;#a;constructor(l){super(),this.#a=!1,this.#o=l.defaultOptions,this.setOptions(l.options),this.observers=[],this.#i=l.client,this.#n=this.#i.getQueryCache(),this.queryKey=l.queryKey,this.queryHash=l.queryHash,this.#e=Lee(this.options),this.state=l.state??this.#e,this.scheduleGc()}get meta(){return this.options.meta}get promise(){return this.#r?.promise}setOptions(l){this.options={...this.#o,...l},this.updateGcTime(this.options.gcTime)}optionalRemove(){!this.observers.length&&this.state.fetchStatus==="idle"&&this.#n.remove(this)}setData(l,p){const m=wee(this.state.data,l,this.options);return this.#s({data:m,type:"success",dataUpdatedAt:p?.updatedAt,manual:p?.manual}),m}setState(l,p){this.#s({type:"setState",state:l,setStateOptions:p})}cancel(l){const p=this.#r?.promise;return this.#r?.cancel(l),p?p.then(Va).catch(Va):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(this.#e)}isActive(){return this.observers.some(l=>Tee(l.options.enabled,this)!==!1)}isDisabled(){return this.getObserversCount()>0?!this.isActive():this.options.queryFn===IN||this.state.dataUpdateCount+this.state.errorUpdateCount===0}isStatic(){return this.getObserversCount()>0?this.observers.some(l=>XA(l.options.staleTime,this)==="static"):!1}isStale(){return this.getObserversCount()>0?this.observers.some(l=>l.getCurrentResult().isStale):this.state.data===void 0||this.state.isInvalidated}isStaleByTime(l=0){return this.state.data===void 0?!0:l==="static"?!1:this.state.isInvalidated?!0:!See(this.state.dataUpdatedAt,l)}onFocus(){this.observers.find(p=>p.shouldFetchOnWindowFocus())?.refetch({cancelRefetch:!1}),this.#r?.continue()}onOnline(){this.observers.find(p=>p.shouldFetchOnReconnect())?.refetch({cancelRefetch:!1}),this.#r?.continue()}addObserver(l){this.observers.includes(l)||(this.observers.push(l),this.clearGcTimeout(),this.#n.notify({type:"observerAdded",query:this,observer:l}))}removeObserver(l){this.observers.includes(l)&&(this.observers=this.observers.filter(p=>p!==l),this.observers.length||(this.#r&&(this.#a?this.#r.cancel({revert:!0}):this.#r.cancelRetry()),this.scheduleGc()),this.#n.notify({type:"observerRemoved",query:this,observer:l}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||this.#s({type:"invalidate"})}fetch(l,p){if(this.state.fetchStatus!=="idle"){if(this.state.data!==void 0&&p?.cancelRefetch)this.cancel({silent:!0});else if(this.#r)return this.#r.continueRetry(),this.#r.promise}if(l&&this.setOptions(l),!this.options.queryFn){const M=this.observers.find(F=>F.options.queryFn);M&&this.setOptions(M.options)}const m=new AbortController,y=M=>{Object.defineProperty(M,"signal",{enumerable:!0,get:()=>(this.#a=!0,m.signal)})},R=()=>{const M=U3(this.options,p),H=(()=>{const K={client:this.#i,queryKey:this.queryKey,meta:this.meta};return y(K),K})();return this.#a=!1,this.options.persister?this.options.persister(M,H,this):M(H)},P=(()=>{const M={fetchOptions:p,options:this.options,queryKey:this.queryKey,client:this.#i,state:this.state,fetchFn:R};return y(M),M})();this.options.behavior?.onFetch(P,this),this.#t=this.state,(this.state.fetchStatus==="idle"||this.state.fetchMeta!==P.fetchOptions?.meta)&&this.#s({type:"fetch",meta:P.fetchOptions?.meta});const k=M=>{CA(M)&&M.silent||this.#s({type:"error",error:M}),CA(M)||(this.#n.config.onError?.(M,this),this.#n.config.onSettled?.(this.state.data,M,this)),this.scheduleGc()};return this.#r=B3({initialPromise:p?.initialPromise,fn:P.fetchFn,abort:m.abort.bind(m),onSuccess:M=>{if(M===void 0){k(new Error(`${this.queryHash} data is undefined`));return}try{this.setData(M)}catch(F){k(F);return}this.#n.config.onSuccess?.(M,this),this.#n.config.onSettled?.(M,this.state.error,this),this.scheduleGc()},onError:k,onFail:(M,F)=>{this.#s({type:"failed",failureCount:M,error:F})},onPause:()=>{this.#s({type:"pause"})},onContinue:()=>{this.#s({type:"continue"})},retry:P.options.retry,retryDelay:P.options.retryDelay,networkMode:P.options.networkMode,canRun:()=>!0}),this.#r.start()}#s(l){const p=m=>{switch(l.type){case"failed":return{...m,fetchFailureCount:l.failureCount,fetchFailureReason:l.error};case"pause":return{...m,fetchStatus:"paused"};case"continue":return{...m,fetchStatus:"fetching"};case"fetch":return{...m,...xee(m.data,this.options),fetchMeta:l.meta??null};case"success":return this.#t=void 0,{...m,data:l.data,dataUpdateCount:m.dataUpdateCount+1,dataUpdatedAt:l.dataUpdatedAt??Date.now(),error:null,isInvalidated:!1,status:"success",...!l.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};case"error":const y=l.error;return CA(y)&&y.revert&&this.#t?{...this.#t,fetchStatus:"idle"}:{...m,error:y,errorUpdateCount:m.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:m.fetchFailureCount+1,fetchFailureReason:y,fetchStatus:"idle",status:"error"};case"invalidate":return{...m,isInvalidated:!0};case"setState":return{...m,...l.state}}};this.state=p(this.state),vs.batch(()=>{this.observers.forEach(m=>{m.onQueryUpdate()}),this.#n.notify({query:this,type:"updated",action:l})})}};function xee(l,p){return{fetchFailureCount:0,fetchFailureReason:null,fetchStatus:V3(p.networkMode)?"fetching":"paused",...l===void 0&&{error:null,status:"pending"}}}function Lee(l){const p=typeof l.initialData=="function"?l.initialData():l.initialData,m=p!==void 0,y=m?typeof l.initialDataUpdatedAt=="function"?l.initialDataUpdatedAt():l.initialDataUpdatedAt:0;return{data:p,dataUpdateCount:0,dataUpdatedAt:m?y??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:m?"success":"pending",fetchStatus:"idle"}}var Mee=class extends QR{constructor(l={}){super(),this.config=l,this.#e=new Map}#e;build(l,p,m){const y=p.queryKey,R=p.queryHash??bN(y,p);let C=this.get(R);return C||(C=new kee({client:l,queryKey:y,queryHash:R,options:l.defaultQueryOptions(p),state:m,defaultOptions:l.getQueryDefaults(y)}),this.add(C)),C}add(l){this.#e.has(l.queryHash)||(this.#e.set(l.queryHash,l),this.notify({type:"added",query:l}))}remove(l){const p=this.#e.get(l.queryHash);p&&(l.destroy(),p===l&&this.#e.delete(l.queryHash),this.notify({type:"removed",query:l}))}clear(){vs.batch(()=>{this.getAll().forEach(l=>{this.remove(l)})})}get(l){return this.#e.get(l)}getAll(){return[...this.#e.values()]}find(l){const p={exact:!0,...l};return this.getAll().find(m=>AF(p,m))}findAll(l={}){const p=this.getAll();return Object.keys(l).length>0?p.filter(m=>AF(l,m)):p}notify(l){vs.batch(()=>{this.listeners.forEach(p=>{p(l)})})}onFocus(){vs.batch(()=>{this.getAll().forEach(l=>{l.onFocus()})})}onOnline(){vs.batch(()=>{this.getAll().forEach(l=>{l.onOnline()})})}},Uee=class extends W3{#e;#t;#n;constructor(l){super(),this.mutationId=l.mutationId,this.#t=l.mutationCache,this.#e=[],this.state=l.state||jee(),this.setOptions(l.options),this.scheduleGc()}setOptions(l){this.options=l,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(l){this.#e.includes(l)||(this.#e.push(l),this.clearGcTimeout(),this.#t.notify({type:"observerAdded",mutation:this,observer:l}))}removeObserver(l){this.#e=this.#e.filter(p=>p!==l),this.scheduleGc(),this.#t.notify({type:"observerRemoved",mutation:this,observer:l})}optionalRemove(){this.#e.length||(this.state.status==="pending"?this.scheduleGc():this.#t.remove(this))}continue(){return this.#n?.continue()??this.execute(this.state.variables)}async execute(l){const p=()=>{this.#i({type:"continue"})};this.#n=B3({fn:()=>this.options.mutationFn?this.options.mutationFn(l):Promise.reject(new Error("No mutationFn found")),onFail:(R,C)=>{this.#i({type:"failed",failureCount:R,error:C})},onPause:()=>{this.#i({type:"pause"})},onContinue:p,retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>this.#t.canRun(this)});const m=this.state.status==="pending",y=!this.#n.canStart();try{if(m)p();else{this.#i({type:"pending",variables:l,isPaused:y}),await this.#t.config.onMutate?.(l,this);const C=await this.options.onMutate?.(l);C!==this.state.context&&this.#i({type:"pending",context:C,variables:l,isPaused:y})}const R=await this.#n.start();return await this.#t.config.onSuccess?.(R,l,this.state.context,this),await this.options.onSuccess?.(R,l,this.state.context),await this.#t.config.onSettled?.(R,null,this.state.variables,this.state.context,this),await this.options.onSettled?.(R,null,l,this.state.context),this.#i({type:"success",data:R}),R}catch(R){try{throw await this.#t.config.onError?.(R,l,this.state.context,this),await this.options.onError?.(R,l,this.state.context),await this.#t.config.onSettled?.(void 0,R,this.state.variables,this.state.context,this),await this.options.onSettled?.(void 0,R,l,this.state.context),R}finally{this.#i({type:"error",error:R})}}finally{this.#t.runNext(this)}}#i(l){const p=m=>{switch(l.type){case"failed":return{...m,failureCount:l.failureCount,failureReason:l.error};case"pause":return{...m,isPaused:!0};case"continue":return{...m,isPaused:!1};case"pending":return{...m,context:l.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:l.isPaused,status:"pending",variables:l.variables,submittedAt:Date.now()};case"success":return{...m,data:l.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...m,data:void 0,error:l.error,failureCount:m.failureCount+1,failureReason:l.error,isPaused:!1,status:"error"}}};this.state=p(this.state),vs.batch(()=>{this.#e.forEach(m=>{m.onMutationUpdate(l)}),this.#t.notify({mutation:this,type:"updated",action:l})})}};function jee(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0}}var Vee=class extends QR{constructor(l={}){super(),this.config=l,this.#e=new Set,this.#t=new Map,this.#n=0}#e;#t;#n;build(l,p,m){const y=new Uee({mutationCache:this,mutationId:++this.#n,options:l.defaultMutationOptions(p),state:m});return this.add(y),y}add(l){this.#e.add(l);const p=gR(l);if(typeof p=="string"){const m=this.#t.get(p);m?m.push(l):this.#t.set(p,[l])}this.notify({type:"added",mutation:l})}remove(l){if(this.#e.delete(l)){const p=gR(l);if(typeof p=="string"){const m=this.#t.get(p);if(m)if(m.length>1){const y=m.indexOf(l);y!==-1&&m.splice(y,1)}else m[0]===l&&this.#t.delete(p)}}this.notify({type:"removed",mutation:l})}canRun(l){const p=gR(l);if(typeof p=="string"){const y=this.#t.get(p)?.find(R=>R.state.status==="pending");return!y||y===l}else return!0}runNext(l){const p=gR(l);return typeof p=="string"?this.#t.get(p)?.find(y=>y!==l&&y.state.isPaused)?.continue()??Promise.resolve():Promise.resolve()}clear(){vs.batch(()=>{this.#e.forEach(l=>{this.notify({type:"removed",mutation:l})}),this.#e.clear(),this.#t.clear()})}getAll(){return Array.from(this.#e)}find(l){const p={exact:!0,...l};return this.getAll().find(m=>NF(p,m))}findAll(l={}){return this.getAll().filter(p=>NF(l,p))}notify(l){vs.batch(()=>{this.listeners.forEach(p=>{p(l)})})}resumePausedMutations(){const l=this.getAll().filter(p=>p.state.isPaused);return vs.batch(()=>Promise.all(l.map(p=>p.continue().catch(Va))))}};function gR(l){return l.options.scope?.id}function DF(l){return{onFetch:(p,m)=>{const y=p.options,R=p.fetchOptions?.meta?.fetchMore?.direction,C=p.state.data?.pages||[],P=p.state.data?.pageParams||[];let k={pages:[],pageParams:[]},M=0;const F=async()=>{let H=!1;const K=re=>{Object.defineProperty(re,"signal",{enumerable:!0,get:()=>(p.signal.aborted?H=!0:p.signal.addEventListener("abort",()=>{H=!0}),p.signal)})},ee=U3(p.options,p.fetchOptions),X=async(re,G,J)=>{if(H)return Promise.reject();if(G==null&&re.pages.length)return Promise.resolve(re);const ne=(()=>{const Se={client:p.client,queryKey:p.queryKey,pageParam:G,direction:J?"backward":"forward",meta:p.options.meta};return K(Se),Se})(),se=await ee(ne),{maxPages:ae}=p.options,pe=J?bee:Cee;return{pages:pe(re.pages,se,ae),pageParams:pe(re.pageParams,G,ae)}};if(R&&C.length){const re=R==="backward",G=re?Fee:kF,J={pages:C,pageParams:P},te=G(y,J);k=await X(J,te,re)}else{const re=l??C.length;do{const G=M===0?P[0]??y.initialPageParam:kF(y,k);if(M>0&&G==null)break;k=await X(k,G),M++}while(M<re)}return k};p.options.persister?p.fetchFn=()=>p.options.persister?.(F,{client:p.client,queryKey:p.queryKey,meta:p.options.meta,signal:p.signal},m):p.fetchFn=F}}}function kF(l,{pages:p,pageParams:m}){const y=p.length-1;return p.length>0?l.getNextPageParam(p[y],p,m[y],m):void 0}function Fee(l,{pages:p,pageParams:m}){return p.length>0?l.getPreviousPageParam?.(p[0],p,m[0],m):void 0}var Bee=class{#e;#t;#n;#i;#r;#o;#a;#s;constructor(l={}){this.#e=l.queryCache||new Mee,this.#t=l.mutationCache||new Vee,this.#n=l.defaultOptions||{},this.#i=new Map,this.#r=new Map,this.#o=0}mount(){this.#o++,this.#o===1&&(this.#a=j3.subscribe(async l=>{l&&(await this.resumePausedMutations(),this.#e.onFocus())}),this.#s=xR.subscribe(async l=>{l&&(await this.resumePausedMutations(),this.#e.onOnline())}))}unmount(){this.#o--,this.#o===0&&(this.#a?.(),this.#a=void 0,this.#s?.(),this.#s=void 0)}isFetching(l){return this.#e.findAll({...l,fetchStatus:"fetching"}).length}isMutating(l){return this.#t.findAll({...l,status:"pending"}).length}getQueryData(l){const p=this.defaultQueryOptions({queryKey:l});return this.#e.get(p.queryHash)?.state.data}ensureQueryData(l){const p=this.defaultQueryOptions(l),m=this.#e.build(this,p),y=m.state.data;return y===void 0?this.fetchQuery(l):(l.revalidateIfStale&&m.isStaleByTime(XA(p.staleTime,m))&&this.prefetchQuery(p),Promise.resolve(y))}getQueriesData(l){return this.#e.findAll(l).map(({queryKey:p,state:m})=>{const y=m.data;return[p,y]})}setQueryData(l,p,m){const y=this.defaultQueryOptions({queryKey:l}),C=this.#e.get(y.queryHash)?.state.data,P=vee(p,C);if(P!==void 0)return this.#e.build(this,y).setData(P,{...m,manual:!0})}setQueriesData(l,p,m){return vs.batch(()=>this.#e.findAll(l).map(({queryKey:y})=>[y,this.setQueryData(y,p,m)]))}getQueryState(l){const p=this.defaultQueryOptions({queryKey:l});return this.#e.get(p.queryHash)?.state}removeQueries(l){const p=this.#e;vs.batch(()=>{p.findAll(l).forEach(m=>{p.remove(m)})})}resetQueries(l,p){const m=this.#e;return vs.batch(()=>(m.findAll(l).forEach(y=>{y.reset()}),this.refetchQueries({type:"active",...l},p)))}cancelQueries(l,p={}){const m={revert:!0,...p},y=vs.batch(()=>this.#e.findAll(l).map(R=>R.cancel(m)));return Promise.all(y).then(Va).catch(Va)}invalidateQueries(l,p={}){return vs.batch(()=>(this.#e.findAll(l).forEach(m=>{m.invalidate()}),l?.refetchType==="none"?Promise.resolve():this.refetchQueries({...l,type:l?.refetchType??l?.type??"active"},p)))}refetchQueries(l,p={}){const m={...p,cancelRefetch:p.cancelRefetch??!0},y=vs.batch(()=>this.#e.findAll(l).filter(R=>!R.isDisabled()&&!R.isStatic()).map(R=>{let C=R.fetch(void 0,m);return m.throwOnError||(C=C.catch(Va)),R.state.fetchStatus==="paused"?Promise.resolve():C}));return Promise.all(y).then(Va)}fetchQuery(l){const p=this.defaultQueryOptions(l);p.retry===void 0&&(p.retry=!1);const m=this.#e.build(this,p);return m.isStaleByTime(XA(p.staleTime,m))?m.fetch(p):Promise.resolve(m.state.data)}prefetchQuery(l){return this.fetchQuery(l).then(Va).catch(Va)}fetchInfiniteQuery(l){return l.behavior=DF(l.pages),this.fetchQuery(l)}prefetchInfiniteQuery(l){return this.fetchInfiniteQuery(l).then(Va).catch(Va)}ensureInfiniteQueryData(l){return l.behavior=DF(l.pages),this.ensureQueryData(l)}resumePausedMutations(){return xR.isOnline()?this.#t.resumePausedMutations():Promise.resolve()}getQueryCache(){return this.#e}getMutationCache(){return this.#t}getDefaultOptions(){return this.#n}setDefaultOptions(l){this.#n=l}setQueryDefaults(l,p){this.#i.set(ZE(l),{queryKey:l,defaultOptions:p})}getQueryDefaults(l){const p=[...this.#i.values()],m={};return p.forEach(y=>{$E(l,y.queryKey)&&Object.assign(m,y.defaultOptions)}),m}setMutationDefaults(l,p){this.#r.set(ZE(l),{mutationKey:l,defaultOptions:p})}getMutationDefaults(l){const p=[...this.#r.values()],m={};return p.forEach(y=>{$E(l,y.mutationKey)&&Object.assign(m,y.defaultOptions)}),m}defaultQueryOptions(l){if(l._defaulted)return l;const p={...this.#n.queries,...this.getQueryDefaults(l.queryKey),...l,_defaulted:!0};return p.queryHash||(p.queryHash=bN(p.queryKey,p)),p.refetchOnReconnect===void 0&&(p.refetchOnReconnect=p.networkMode!=="always"),p.throwOnError===void 0&&(p.throwOnError=!!p.suspense),!p.networkMode&&p.persister&&(p.networkMode="offlineFirst"),p.queryFn===IN&&(p.enabled=!1),p}defaultMutationOptions(l){return l?._defaulted?l:{...this.#n.mutations,...l?.mutationKey&&this.getMutationDefaults(l.mutationKey),...l,_defaulted:!0}}clear(){this.#e.clear(),this.#t.clear()}},Wee=L.createContext(void 0),Gee=({client:l,children:p})=>(L.useEffect(()=>(l.mount(),()=>{l.unmount()}),[l]),v.jsx(Wee.Provider,{value:l,children:p}));/**
 * @remix-run/router v1.23.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function ev(){return ev=Object.assign?Object.assign.bind():function(l){for(var p=1;p<arguments.length;p++){var m=arguments[p];for(var y in m)Object.prototype.hasOwnProperty.call(m,y)&&(l[y]=m[y])}return l},ev.apply(this,arguments)}var Zd;(function(l){l.Pop="POP",l.Push="PUSH",l.Replace="REPLACE"})(Zd||(Zd={}));const xF="popstate";function Hee(l){l===void 0&&(l={});function p(y,R){let{pathname:C,search:P,hash:k}=y.location;return QA("",{pathname:C,search:P,hash:k},R.state&&R.state.usr||null,R.state&&R.state.key||"default")}function m(y,R){return typeof R=="string"?R:LR(R)}return zee(p,m,null,l)}function oi(l,p){if(l===!1||l===null||typeof l>"u")throw new Error(p)}function G3(l,p){if(!l){typeof console<"u"&&console.warn(p);try{throw new Error(p)}catch{}}}function Kee(){return Math.random().toString(36).substr(2,8)}function LF(l,p){return{usr:l.state,key:l.key,idx:p}}function QA(l,p,m,y){return m===void 0&&(m=null),ev({pathname:typeof l=="string"?l:l.pathname,search:"",hash:""},typeof p=="string"?xm(p):p,{state:m,key:p&&p.key||y||Kee()})}function LR(l){let{pathname:p="/",search:m="",hash:y=""}=l;return m&&m!=="?"&&(p+=m.charAt(0)==="?"?m:"?"+m),y&&y!=="#"&&(p+=y.charAt(0)==="#"?y:"#"+y),p}function xm(l){let p={};if(l){let m=l.indexOf("#");m>=0&&(p.hash=l.substr(m),l=l.substr(0,m));let y=l.indexOf("?");y>=0&&(p.search=l.substr(y),l=l.substr(0,y)),l&&(p.pathname=l)}return p}function zee(l,p,m,y){y===void 0&&(y={});let{window:R=document.defaultView,v5Compat:C=!1}=y,P=R.history,k=Zd.Pop,M=null,F=H();F==null&&(F=0,P.replaceState(ev({},P.state,{idx:F}),""));function H(){return(P.state||{idx:null}).idx}function K(){k=Zd.Pop;let J=H(),te=J==null?null:J-F;F=J,M&&M({action:k,location:G.location,delta:te})}function ee(J,te){k=Zd.Push;let ne=QA(G.location,J,te);F=H()+1;let se=LF(ne,F),ae=G.createHref(ne);try{P.pushState(se,"",ae)}catch(pe){if(pe instanceof DOMException&&pe.name==="DataCloneError")throw pe;R.location.assign(ae)}C&&M&&M({action:k,location:G.location,delta:1})}function X(J,te){k=Zd.Replace;let ne=QA(G.location,J,te);F=H();let se=LF(ne,F),ae=G.createHref(ne);P.replaceState(se,"",ae),C&&M&&M({action:k,location:G.location,delta:0})}function re(J){let te=R.location.origin!=="null"?R.location.origin:R.location.href,ne=typeof J=="string"?J:LR(J);return ne=ne.replace(/ $/,"%20"),oi(te,"No window.location.(origin|href) available to create URL for href: "+ne),new URL(ne,te)}let G={get action(){return k},get location(){return l(R,P)},listen(J){if(M)throw new Error("A history only accepts one active listener");return R.addEventListener(xF,K),M=J,()=>{R.removeEventListener(xF,K),M=null}},createHref(J){return p(R,J)},createURL:re,encodeLocation(J){let te=re(J);return{pathname:te.pathname,search:te.search,hash:te.hash}},push:ee,replace:X,go(J){return P.go(J)}};return G}var MF;(function(l){l.data="data",l.deferred="deferred",l.redirect="redirect",l.error="error"})(MF||(MF={}));function Yee(l,p,m){return m===void 0&&(m="/"),qee(l,p,m)}function qee(l,p,m,y){let R=typeof p=="string"?xm(p):p,C=AN(R.pathname||"/",m);if(C==null)return null;let P=H3(l);Xee(P);let k=null;for(let M=0;k==null&&M<P.length;++M){let F=ate(C);k=ite(P[M],F)}return k}function H3(l,p,m,y){p===void 0&&(p=[]),m===void 0&&(m=[]),y===void 0&&(y="");let R=(C,P,k)=>{let M={relativePath:k===void 0?C.path||"":k,caseSensitive:C.caseSensitive===!0,childrenIndex:P,route:C};M.relativePath.startsWith("/")&&(oi(M.relativePath.startsWith(y),'Absolute route path "'+M.relativePath+'" nested under path '+('"'+y+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),M.relativePath=M.relativePath.slice(y.length));let F=nu([y,M.relativePath]),H=m.concat(M);C.children&&C.children.length>0&&(oi(C.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+F+'".')),H3(C.children,p,H,F)),!(C.path==null&&!C.index)&&p.push({path:F,score:nte(F,C.index),routesMeta:H})};return l.forEach((C,P)=>{var k;if(C.path===""||!((k=C.path)!=null&&k.includes("?")))R(C,P);else for(let M of K3(C.path))R(C,P,M)}),p}function K3(l){let p=l.split("/");if(p.length===0)return[];let[m,...y]=p,R=m.endsWith("?"),C=m.replace(/\?$/,"");if(y.length===0)return R?[C,""]:[C];let P=K3(y.join("/")),k=[];return k.push(...P.map(M=>M===""?C:[C,M].join("/"))),R&&k.push(...P),k.map(M=>l.startsWith("/")&&M===""?"/":M)}function Xee(l){l.sort((p,m)=>p.score!==m.score?m.score-p.score:rte(p.routesMeta.map(y=>y.childrenIndex),m.routesMeta.map(y=>y.childrenIndex)))}const Jee=/^:[\w-]+$/,Qee=3,Zee=2,$ee=1,ete=10,tte=-2,UF=l=>l==="*";function nte(l,p){let m=l.split("/"),y=m.length;return m.some(UF)&&(y+=tte),p&&(y+=Zee),m.filter(R=>!UF(R)).reduce((R,C)=>R+(Jee.test(C)?Qee:C===""?$ee:ete),y)}function rte(l,p){return l.length===p.length&&l.slice(0,-1).every((y,R)=>y===p[R])?l[l.length-1]-p[p.length-1]:0}function ite(l,p,m){let{routesMeta:y}=l,R={},C="/",P=[];for(let k=0;k<y.length;++k){let M=y[k],F=k===y.length-1,H=C==="/"?p:p.slice(C.length)||"/",K=ste({path:M.relativePath,caseSensitive:M.caseSensitive,end:F},H),ee=M.route;if(!K)return null;Object.assign(R,K.params),P.push({params:R,pathname:nu([C,K.pathname]),pathnameBase:ute(nu([C,K.pathnameBase])),route:ee}),K.pathnameBase!=="/"&&(C=nu([C,K.pathnameBase]))}return P}function ste(l,p){typeof l=="string"&&(l={path:l,caseSensitive:!1,end:!0});let[m,y]=ote(l.path,l.caseSensitive,l.end),R=p.match(m);if(!R)return null;let C=R[0],P=C.replace(/(.)\/+$/,"$1"),k=R.slice(1);return{params:y.reduce((F,H,K)=>{let{paramName:ee,isOptional:X}=H;if(ee==="*"){let G=k[K]||"";P=C.slice(0,C.length-G.length).replace(/(.)\/+$/,"$1")}const re=k[K];return X&&!re?F[ee]=void 0:F[ee]=(re||"").replace(/%2F/g,"/"),F},{}),pathname:C,pathnameBase:P,pattern:l}}function ote(l,p,m){p===void 0&&(p=!1),m===void 0&&(m=!0),G3(l==="*"||!l.endsWith("*")||l.endsWith("/*"),'Route path "'+l+'" will be treated as if it were '+('"'+l.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+l.replace(/\*$/,"/*")+'".'));let y=[],R="^"+l.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(P,k,M)=>(y.push({paramName:k,isOptional:M!=null}),M?"/?([^\\/]+)?":"/([^\\/]+)"));return l.endsWith("*")?(y.push({paramName:"*"}),R+=l==="*"||l==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):m?R+="\\/*$":l!==""&&l!=="/"&&(R+="(?:(?=\\/|$))"),[new RegExp(R,p?void 0:"i"),y]}function ate(l){try{return l.split("/").map(p=>decodeURIComponent(p).replace(/\//g,"%2F")).join("/")}catch(p){return G3(!1,'The URL path "'+l+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+p+").")),l}}function AN(l,p){if(p==="/")return l;if(!l.toLowerCase().startsWith(p.toLowerCase()))return null;let m=p.endsWith("/")?p.length-1:p.length,y=l.charAt(m);return y&&y!=="/"?null:l.slice(m)||"/"}function cte(l,p){p===void 0&&(p="/");let{pathname:m,search:y="",hash:R=""}=typeof l=="string"?xm(l):l;return{pathname:m?m.startsWith("/")?m:lte(m,p):p,search:hte(y),hash:pte(R)}}function lte(l,p){let m=p.replace(/\/+$/,"").split("/");return l.split("/").forEach(R=>{R===".."?m.length>1&&m.pop():R!=="."&&m.push(R)}),m.length>1?m.join("/"):"/"}function bA(l,p,m,y){return"Cannot include a '"+l+"' character in a manually specified "+("`to."+p+"` field ["+JSON.stringify(y)+"].  Please separate it out to the ")+("`to."+m+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function dte(l){return l.filter((p,m)=>m===0||p.route.path&&p.route.path.length>0)}function z3(l,p){let m=dte(l);return p?m.map((y,R)=>R===m.length-1?y.pathname:y.pathnameBase):m.map(y=>y.pathnameBase)}function Y3(l,p,m,y){y===void 0&&(y=!1);let R;typeof l=="string"?R=xm(l):(R=ev({},l),oi(!R.pathname||!R.pathname.includes("?"),bA("?","pathname","search",R)),oi(!R.pathname||!R.pathname.includes("#"),bA("#","pathname","hash",R)),oi(!R.search||!R.search.includes("#"),bA("#","search","hash",R)));let C=l===""||R.pathname==="",P=C?"/":R.pathname,k;if(P==null)k=m;else{let K=p.length-1;if(!y&&P.startsWith("..")){let ee=P.split("/");for(;ee[0]==="..";)ee.shift(),K-=1;R.pathname=ee.join("/")}k=K>=0?p[K]:"/"}let M=cte(R,k),F=P&&P!=="/"&&P.endsWith("/"),H=(C||P===".")&&m.endsWith("/");return!M.pathname.endsWith("/")&&(F||H)&&(M.pathname+="/"),M}const nu=l=>l.join("/").replace(/\/\/+/g,"/"),ute=l=>l.replace(/\/+$/,"").replace(/^\/*/,"/"),hte=l=>!l||l==="?"?"":l.startsWith("?")?l:"?"+l,pte=l=>!l||l==="#"?"":l.startsWith("#")?l:"#"+l;function fte(l){return l!=null&&typeof l.status=="number"&&typeof l.statusText=="string"&&typeof l.internal=="boolean"&&"data"in l}const q3=["post","put","patch","delete"];new Set(q3);const mte=["get",...q3];new Set(mte);/**
 * React Router v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function tv(){return tv=Object.assign?Object.assign.bind():function(l){for(var p=1;p<arguments.length;p++){var m=arguments[p];for(var y in m)Object.prototype.hasOwnProperty.call(m,y)&&(l[y]=m[y])}return l},tv.apply(this,arguments)}const NN=L.createContext(null),_te=L.createContext(null),np=L.createContext(null),$R=L.createContext(null),cu=L.createContext({outlet:null,matches:[],isDataRoute:!1}),X3=L.createContext(null);function gte(l,p){let{relative:m}=p===void 0?{}:p;ov()||oi(!1);let{basename:y,navigator:R}=L.useContext(np),{hash:C,pathname:P,search:k}=Q3(l,{relative:m}),M=P;return y!=="/"&&(M=P==="/"?y:nu([y,P])),R.createHref({pathname:M,search:k,hash:C})}function ov(){return L.useContext($R)!=null}function rp(){return ov()||oi(!1),L.useContext($R).location}function J3(l){L.useContext(np).static||L.useLayoutEffect(l)}function Lm(){let{isDataRoute:l}=L.useContext(cu);return l?Pte():Ete()}function Ete(){ov()||oi(!1);let l=L.useContext(NN),{basename:p,future:m,navigator:y}=L.useContext(np),{matches:R}=L.useContext(cu),{pathname:C}=rp(),P=JSON.stringify(z3(R,m.v7_relativeSplatPath)),k=L.useRef(!1);return J3(()=>{k.current=!0}),L.useCallback(function(F,H){if(H===void 0&&(H={}),!k.current)return;if(typeof F=="number"){y.go(F);return}let K=Y3(F,JSON.parse(P),C,H.relative==="path");l==null&&p!=="/"&&(K.pathname=K.pathname==="/"?p:nu([p,K.pathname])),(H.replace?y.replace:y.push)(K,H.state,H)},[p,y,P,C,l])}function vte(){let{matches:l}=L.useContext(cu),p=l[l.length-1];return p?p.params:{}}function Q3(l,p){let{relative:m}=p===void 0?{}:p,{future:y}=L.useContext(np),{matches:R}=L.useContext(cu),{pathname:C}=rp(),P=JSON.stringify(z3(R,y.v7_relativeSplatPath));return L.useMemo(()=>Y3(l,JSON.parse(P),C,m==="path"),[l,P,C,m])}function yte(l,p){return Ste(l,p)}function Ste(l,p,m,y){ov()||oi(!1);let{navigator:R}=L.useContext(np),{matches:C}=L.useContext(cu),P=C[C.length-1],k=P?P.params:{};P&&P.pathname;let M=P?P.pathnameBase:"/";P&&P.route;let F=rp(),H;if(p){var K;let J=typeof p=="string"?xm(p):p;M==="/"||(K=J.pathname)!=null&&K.startsWith(M)||oi(!1),H=J}else H=F;let ee=H.pathname||"/",X=ee;if(M!=="/"){let J=M.replace(/^\//,"").split("/");X="/"+ee.replace(/^\//,"").split("/").slice(J.length).join("/")}let re=Yee(l,{pathname:X}),G=bte(re&&re.map(J=>Object.assign({},J,{params:Object.assign({},k,J.params),pathname:nu([M,R.encodeLocation?R.encodeLocation(J.pathname).pathname:J.pathname]),pathnameBase:J.pathnameBase==="/"?M:nu([M,R.encodeLocation?R.encodeLocation(J.pathnameBase).pathname:J.pathnameBase])})),C,m,y);return p&&G?L.createElement($R.Provider,{value:{location:tv({pathname:"/",search:"",hash:"",state:null,key:"default"},H),navigationType:Zd.Pop}},G):G}function Tte(){let l=Ote(),p=fte(l)?l.status+" "+l.statusText:l instanceof Error?l.message:JSON.stringify(l),m=l instanceof Error?l.stack:null,R={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return L.createElement(L.Fragment,null,L.createElement("h2",null,"Unexpected Application Error!"),L.createElement("h3",{style:{fontStyle:"italic"}},p),m?L.createElement("pre",{style:R},m):null,null)}const Rte=L.createElement(Tte,null);class wte extends L.Component{constructor(p){super(p),this.state={location:p.location,revalidation:p.revalidation,error:p.error}}static getDerivedStateFromError(p){return{error:p}}static getDerivedStateFromProps(p,m){return m.location!==p.location||m.revalidation!=="idle"&&p.revalidation==="idle"?{error:p.error,location:p.location,revalidation:p.revalidation}:{error:p.error!==void 0?p.error:m.error,location:m.location,revalidation:p.revalidation||m.revalidation}}componentDidCatch(p,m){console.error("React Router caught the following error during render",p,m)}render(){return this.state.error!==void 0?L.createElement(cu.Provider,{value:this.props.routeContext},L.createElement(X3.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function Cte(l){let{routeContext:p,match:m,children:y}=l,R=L.useContext(NN);return R&&R.static&&R.staticContext&&(m.route.errorElement||m.route.ErrorBoundary)&&(R.staticContext._deepestRenderedBoundaryId=m.route.id),L.createElement(cu.Provider,{value:p},y)}function bte(l,p,m,y){var R;if(p===void 0&&(p=[]),m===void 0&&(m=null),y===void 0&&(y=null),l==null){var C;if(!m)return null;if(m.errors)l=m.matches;else if((C=y)!=null&&C.v7_partialHydration&&p.length===0&&!m.initialized&&m.matches.length>0)l=m.matches;else return null}let P=l,k=(R=m)==null?void 0:R.errors;if(k!=null){let H=P.findIndex(K=>K.route.id&&k?.[K.route.id]!==void 0);H>=0||oi(!1),P=P.slice(0,Math.min(P.length,H+1))}let M=!1,F=-1;if(m&&y&&y.v7_partialHydration)for(let H=0;H<P.length;H++){let K=P[H];if((K.route.HydrateFallback||K.route.hydrateFallbackElement)&&(F=H),K.route.id){let{loaderData:ee,errors:X}=m,re=K.route.loader&&ee[K.route.id]===void 0&&(!X||X[K.route.id]===void 0);if(K.route.lazy||re){M=!0,F>=0?P=P.slice(0,F+1):P=[P[0]];break}}}return P.reduceRight((H,K,ee)=>{let X,re=!1,G=null,J=null;m&&(X=k&&K.route.id?k[K.route.id]:void 0,G=K.route.errorElement||Rte,M&&(F<0&&ee===0?(Dte("route-fallback"),re=!0,J=null):F===ee&&(re=!0,J=K.route.hydrateFallbackElement||null)));let te=p.concat(P.slice(0,ee+1)),ne=()=>{let se;return X?se=G:re?se=J:K.route.Component?se=L.createElement(K.route.Component,null):K.route.element?se=K.route.element:se=H,L.createElement(Cte,{match:K,routeContext:{outlet:H,matches:te,isDataRoute:m!=null},children:se})};return m&&(K.route.ErrorBoundary||K.route.errorElement||ee===0)?L.createElement(wte,{location:m.location,revalidation:m.revalidation,component:G,error:X,children:ne(),routeContext:{outlet:null,matches:te,isDataRoute:!0}}):ne()},null)}var Z3=(function(l){return l.UseBlocker="useBlocker",l.UseRevalidator="useRevalidator",l.UseNavigateStable="useNavigate",l})(Z3||{}),$3=(function(l){return l.UseBlocker="useBlocker",l.UseLoaderData="useLoaderData",l.UseActionData="useActionData",l.UseRouteError="useRouteError",l.UseNavigation="useNavigation",l.UseRouteLoaderData="useRouteLoaderData",l.UseMatches="useMatches",l.UseRevalidator="useRevalidator",l.UseNavigateStable="useNavigate",l.UseRouteId="useRouteId",l})($3||{});function Ite(l){let p=L.useContext(NN);return p||oi(!1),p}function Ate(l){let p=L.useContext(_te);return p||oi(!1),p}function Nte(l){let p=L.useContext(cu);return p||oi(!1),p}function e4(l){let p=Nte(),m=p.matches[p.matches.length-1];return m.route.id||oi(!1),m.route.id}function Ote(){var l;let p=L.useContext(X3),m=Ate(),y=e4();return p!==void 0?p:(l=m.errors)==null?void 0:l[y]}function Pte(){let{router:l}=Ite(Z3.UseNavigateStable),p=e4($3.UseNavigateStable),m=L.useRef(!1);return J3(()=>{m.current=!0}),L.useCallback(function(R,C){C===void 0&&(C={}),m.current&&(typeof R=="number"?l.navigate(R):l.navigate(R,tv({fromRouteId:p},C)))},[l,p])}const jF={};function Dte(l,p,m){jF[l]||(jF[l]=!0)}function kte(l,p){l?.v7_startTransition,l?.v7_relativeSplatPath}function $o(l){oi(!1)}function xte(l){let{basename:p="/",children:m=null,location:y,navigationType:R=Zd.Pop,navigator:C,static:P=!1,future:k}=l;ov()&&oi(!1);let M=p.replace(/^\/*/,"/"),F=L.useMemo(()=>({basename:M,navigator:C,static:P,future:tv({v7_relativeSplatPath:!1},k)}),[M,k,C,P]);typeof y=="string"&&(y=xm(y));let{pathname:H="/",search:K="",hash:ee="",state:X=null,key:re="default"}=y,G=L.useMemo(()=>{let J=AN(H,M);return J==null?null:{location:{pathname:J,search:K,hash:ee,state:X,key:re},navigationType:R}},[M,H,K,ee,X,re,R]);return G==null?null:L.createElement(np.Provider,{value:F},L.createElement($R.Provider,{children:m,value:G}))}function Lte(l){let{children:p,location:m}=l;return yte(ZA(p),m)}new Promise(()=>{});function ZA(l,p){p===void 0&&(p=[]);let m=[];return L.Children.forEach(l,(y,R)=>{if(!L.isValidElement(y))return;let C=[...p,R];if(y.type===L.Fragment){m.push.apply(m,ZA(y.props.children,C));return}y.type!==$o&&oi(!1),!y.props.index||!y.props.children||oi(!1);let P={id:y.props.id||C.join("-"),caseSensitive:y.props.caseSensitive,element:y.props.element,Component:y.props.Component,index:y.props.index,path:y.props.path,loader:y.props.loader,action:y.props.action,errorElement:y.props.errorElement,ErrorBoundary:y.props.ErrorBoundary,hasErrorBoundary:y.props.ErrorBoundary!=null||y.props.errorElement!=null,shouldRevalidate:y.props.shouldRevalidate,handle:y.props.handle,lazy:y.props.lazy};y.props.children&&(P.children=ZA(y.props.children,C)),m.push(P)}),m}/**
 * React Router DOM v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function $A(){return $A=Object.assign?Object.assign.bind():function(l){for(var p=1;p<arguments.length;p++){var m=arguments[p];for(var y in m)Object.prototype.hasOwnProperty.call(m,y)&&(l[y]=m[y])}return l},$A.apply(this,arguments)}function Mte(l,p){if(l==null)return{};var m={},y=Object.keys(l),R,C;for(C=0;C<y.length;C++)R=y[C],!(p.indexOf(R)>=0)&&(m[R]=l[R]);return m}function Ute(l){return!!(l.metaKey||l.altKey||l.ctrlKey||l.shiftKey)}function jte(l,p){return l.button===0&&(!p||p==="_self")&&!Ute(l)}const Vte=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"],Fte="6";try{window.__reactRouterVersion=Fte}catch{}const Bte="startTransition",VF=lN[Bte];function Wte(l){let{basename:p,children:m,future:y,window:R}=l,C=L.useRef();C.current==null&&(C.current=Hee({window:R,v5Compat:!0}));let P=C.current,[k,M]=L.useState({action:P.action,location:P.location}),{v7_startTransition:F}=y||{},H=L.useCallback(K=>{F&&VF?VF(()=>M(K)):M(K)},[M,F]);return L.useLayoutEffect(()=>P.listen(H),[P,H]),L.useEffect(()=>kte(y),[y]),L.createElement(xte,{basename:p,children:m,location:k.location,navigationType:k.action,navigator:P,future:y})}const Gte=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",Hte=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,jr=L.forwardRef(function(p,m){let{onClick:y,relative:R,reloadDocument:C,replace:P,state:k,target:M,to:F,preventScrollReset:H,viewTransition:K}=p,ee=Mte(p,Vte),{basename:X}=L.useContext(np),re,G=!1;if(typeof F=="string"&&Hte.test(F)&&(re=F,Gte))try{let se=new URL(window.location.href),ae=F.startsWith("//")?new URL(se.protocol+F):new URL(F),pe=AN(ae.pathname,X);ae.origin===se.origin&&pe!=null?F=pe+ae.search+ae.hash:G=!0}catch{}let J=gte(F,{relative:R}),te=Kte(F,{replace:P,state:k,target:M,preventScrollReset:H,relative:R,viewTransition:K});function ne(se){y&&y(se),se.defaultPrevented||te(se)}return L.createElement("a",$A({},ee,{href:re||J,onClick:G||C?y:ne,ref:m,target:M}))});var FF;(function(l){l.UseScrollRestoration="useScrollRestoration",l.UseSubmit="useSubmit",l.UseSubmitFetcher="useSubmitFetcher",l.UseFetcher="useFetcher",l.useViewTransitionState="useViewTransitionState"})(FF||(FF={}));var BF;(function(l){l.UseFetcher="useFetcher",l.UseFetchers="useFetchers",l.UseScrollRestoration="useScrollRestoration"})(BF||(BF={}));function Kte(l,p){let{target:m,replace:y,state:R,preventScrollReset:C,relative:P,viewTransition:k}=p===void 0?{}:p,M=Lm(),F=rp(),H=Q3(l,{relative:P});return L.useCallback(K=>{if(jte(K,m)){K.preventDefault();let ee=y!==void 0?y:LR(F)===LR(H);M(l,{replace:ee,state:R,preventScrollReset:C,relative:P,viewTransition:k})}},[F,M,H,y,R,m,l,C,P,k])}function zte({children:l,attribute:p="class",defaultTheme:m="dark",enableSystem:y=!0,disableTransitionOnChange:R=!1,...C}){return v.jsx($Q,{attribute:p,defaultTheme:m,enableSystem:y,disableTransitionOnChange:R,...C,children:l})}const Yte=GR("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),At=L.forwardRef(({className:l,variant:p,size:m,asChild:y=!1,...R},C)=>{const P=y?aJ:"button";return v.jsx(P,{className:gn(Yte({variant:p,size:m,className:l})),ref:C,...R})});At.displayName="Button";function ON(){const{theme:l,setTheme:p}=n3();return v.jsxs(At,{variant:"ghost",size:"icon",onClick:()=>p(l==="light"?"dark":"light"),className:"hover-scale transition-smooth",children:[v.jsx(FB,{className:"h-[1.2rem] w-[1.2rem] rotate-0 scale-100 transition-all dark:-rotate-90 dark:scale-0"}),v.jsx(cQ,{className:"absolute h-[1.2rem] w-[1.2rem] rotate-90 scale-0 transition-all dark:rotate-0 dark:scale-100"}),v.jsx("span",{className:"sr-only",children:"Toggle theme"})]})}function qte(){const l=Lm();return L.useEffect(()=>{const p=localStorage.getItem("user");if(p&&window.location.pathname==="/")try{const m=JSON.parse(p);m&&m.id&&(console.log("🔵 [LANDING] User already authenticated, redirecting to feed"),l("/feed"))}catch(m){console.error("Error parsing user data:",m),localStorage.removeItem("user")}},[l]),v.jsxs("div",{className:"min-h-screen bg-background",children:[v.jsxs("header",{className:"container mx-auto px-4 py-6 flex justify-between items-center",children:[v.jsxs("div",{className:"flex items-center space-x-3",children:[v.jsx("img",{src:"/logo.png",alt:"TeaTok Logo",className:"hidden dark:block h-12 w-12 md:h-14 md:w-14 animate-float rounded object-contain"}),v.jsx("img",{src:"/logo-light.png",alt:"TeaTok Logo",className:"block dark:hidden h-12 w-12 md:h-14 md:w-14 animate-float rounded object-contain"}),v.jsx("img",{src:"/teatok.png",alt:"TeaTok",className:"hidden dark:block h-8 md:h-9 w-auto object-contain"}),v.jsx("img",{src:"/teatok-light.png",alt:"TeaTok",className:"block dark:hidden h-8 md:h-9 w-auto object-contain"})]}),v.jsxs("div",{className:"flex items-center space-x-4",children:[v.jsx(ON,{}),v.jsx(At,{variant:"ghost",asChild:!0,children:v.jsx(jr,{to:"/auth",children:"Sign In"})})]})]}),v.jsx("section",{className:"container mx-auto px-4 py-20 text-center animate-fade-in",children:v.jsxs("div",{className:"max-w-4xl mx-auto space-y-8",children:[v.jsxs("div",{className:"flex justify-center mb-8",children:[v.jsx("img",{src:"/teatok.png",alt:"TeaTok",className:"hidden dark:block h-32 md:h-40 animate-float object-contain"}),v.jsx("img",{src:"/teatok-light.png",alt:"TeaTok",className:"block dark:hidden h-32 md:h-40 animate-float object-contain"})]}),v.jsx("h1",{className:"text-4xl md:text-6xl font-bold mb-6",children:v.jsx("span",{className:"gradient-hero bg-clip-text text-transparent",children:"Spill it. Sip it. TeaTok it."})}),v.jsx("p",{className:"text-xl md:text-2xl text-muted-foreground mb-12 max-w-2xl mx-auto",children:"The anonymous social playground where you spill gossip, drop reviews, and connect through tea, threads, and hot takes."}),v.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-center mb-16",children:[v.jsx(At,{asChild:!0,size:"lg",className:"spill-button text-lg px-8 py-4 animate-bounce-subtle",children:v.jsxs(jr,{to:"/auth",children:["Join Now",v.jsx(BA,{className:"ml-2 h-5 w-5"})]})}),v.jsx(At,{asChild:!0,variant:"outline",size:"lg",className:"text-lg px-8 py-4 neon-border hover-glow",children:v.jsx(jr,{to:"/feed",children:"Explore Tea"})})]}),v.jsxs("div",{className:"grid md:grid-cols-3 gap-8 mt-20",children:[v.jsxs("div",{className:"tea-card animate-slide-in-right text-center",children:[v.jsx("div",{className:"gradient-primary w-12 h-12 rounded-full flex items-center justify-center mx-auto mb-4",children:v.jsx(Im,{className:"h-6 w-6 text-primary-foreground"})}),v.jsx("h3",{className:"font-semibold text-lg mb-2",children:"Anonymous Vibes"}),v.jsx("p",{className:"text-muted-foreground",children:"Share your hottest takes without revealing your identity. Create personas and keep it mysterious."})]}),v.jsxs("div",{className:"tea-card animate-slide-in-right text-center",style:{animationDelay:"0.2s"},children:[v.jsx("div",{className:"gradient-accent w-12 h-12 rounded-full flex items-center justify-center mx-auto mb-4",children:v.jsx(HB,{className:"h-6 w-6 text-accent-foreground"})}),v.jsx("h3",{className:"font-semibold text-lg mb-2",children:"Instant Reactions"}),v.jsx("p",{className:"text-muted-foreground",children:"React with Tea ☕, Spicy 🌶️, or Cap 🧢. Express yourself beyond basic likes and hearts."})]}),v.jsxs("div",{className:"tea-card animate-slide-in-right text-center",style:{animationDelay:"0.4s"},children:[v.jsx("div",{className:"gradient-warm w-12 h-12 rounded-full flex items-center justify-center mx-auto mb-4",children:v.jsx(HR,{className:"h-6 w-6 text-white"})}),v.jsx("h3",{className:"font-semibold text-lg mb-2",children:"Safe & Playful"}),v.jsx("p",{className:"text-muted-foreground",children:"Built for fun, not drama. Smart moderation keeps the tea hot but the vibes positive."})]})]})]})}),v.jsx("section",{className:"gradient-hero py-20 mt-20",children:v.jsxs("div",{className:"container mx-auto px-4 text-center",children:[v.jsx("h2",{className:"text-3xl md:text-4xl font-bold text-white mb-6",children:"Ready to spill some tea?"}),v.jsx("p",{className:"text-xl text-white/90 mb-8 max-w-2xl mx-auto",children:"Join thousands already sharing gossip, reviews, and anonymous connections."}),v.jsx(At,{asChild:!0,size:"lg",variant:"secondary",className:"text-lg px-8 py-4 hover-scale shadow-soft",children:v.jsxs(jr,{to:"/auth",children:["Get Started Now",v.jsx(BA,{className:"ml-2 h-5 w-5"})]})})]})}),v.jsxs("footer",{className:"container mx-auto px-4 py-12 text-center text-muted-foreground",children:[v.jsxs("div",{className:"flex justify-center items-center space-x-4 mb-4",children:[v.jsx("img",{src:"/logo.png",alt:"TeaTok Logo",className:"hidden dark:inline-block h-8 w-8 rounded object-contain"}),v.jsx("img",{src:"/logo-light.png",alt:"TeaTok Logo",className:"inline-block dark:hidden h-8 w-8 rounded object-contain"}),v.jsx("span",{className:"font-semibold",children:"TeaTok"})]}),v.jsxs("div",{className:"flex justify-center space-x-6 text-sm",children:[v.jsx(jr,{to:"/about",className:"hover:text-foreground transition-colors",children:"About"}),v.jsx(jr,{to:"/settings",className:"hover:text-foreground transition-colors",children:"Privacy"}),v.jsx(jr,{to:"/settings",className:"hover:text-foreground transition-colors",children:"Terms"})]})]})]})}const ea=L.forwardRef(({className:l,type:p,...m},y)=>v.jsx("input",{type:p,className:gn("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",l),ref:y,...m}));ea.displayName="Input";const An=L.forwardRef(({className:l,...p},m)=>v.jsx("div",{ref:m,className:gn("rounded-lg border bg-card text-card-foreground shadow-sm",l),...p}));An.displayName="Card";const Ir=L.forwardRef(({className:l,...p},m)=>v.jsx("div",{ref:m,className:gn("flex flex-col space-y-1.5 p-6",l),...p}));Ir.displayName="CardHeader";const Pi=L.forwardRef(({className:l,...p},m)=>v.jsx("h3",{ref:m,className:gn("text-2xl font-semibold leading-none tracking-tight",l),...p}));Pi.displayName="CardTitle";const Bs=L.forwardRef(({className:l,...p},m)=>v.jsx("p",{ref:m,className:gn("text-sm text-muted-foreground",l),...p}));Bs.displayName="CardDescription";const Dn=L.forwardRef(({className:l,...p},m)=>v.jsx("div",{ref:m,className:gn("p-6 pt-0",l),...p}));Dn.displayName="CardContent";const YE=L.forwardRef(({className:l,...p},m)=>v.jsx("div",{ref:m,className:gn("flex items-center p-6 pt-0",l),...p}));YE.displayName="CardFooter";var Xte=L.createContext(void 0);function PN(l){const p=L.useContext(Xte);return l||p||"ltr"}var IA="rovingFocusGroup.onEntryFocus",Jte={bubbles:!1,cancelable:!0},av="RovingFocusGroup",[eN,t4,Qte]=dN(av),[Zte,n4]=Hc(av,[Qte]),[$te,ene]=Zte(av),r4=L.forwardRef((l,p)=>v.jsx(eN.Provider,{scope:l.__scopeRovingFocusGroup,children:v.jsx(eN.Slot,{scope:l.__scopeRovingFocusGroup,children:v.jsx(tne,{...l,ref:p})})}));r4.displayName=av;var tne=L.forwardRef((l,p)=>{const{__scopeRovingFocusGroup:m,orientation:y,loop:R=!1,dir:C,currentTabStopId:P,defaultCurrentTabStopId:k,onCurrentTabStopIdChange:M,onEntryFocus:F,preventScrollOnEntryFocus:H=!1,...K}=l,ee=L.useRef(null),X=or(p,ee),re=PN(C),[G,J]=Jh({prop:P,defaultProp:k??null,onChange:M,caller:av}),[te,ne]=L.useState(!1),se=go(F),ae=t4(m),pe=L.useRef(!1),[Se,Te]=L.useState(0);return L.useEffect(()=>{const Ue=ee.current;if(Ue)return Ue.addEventListener(IA,se),()=>Ue.removeEventListener(IA,se)},[se]),v.jsx($te,{scope:m,orientation:y,dir:re,loop:R,currentTabStopId:G,onItemFocus:L.useCallback(Ue=>J(Ue),[J]),onItemShiftTab:L.useCallback(()=>ne(!0),[]),onFocusableItemAdd:L.useCallback(()=>Te(Ue=>Ue+1),[]),onFocusableItemRemove:L.useCallback(()=>Te(Ue=>Ue-1),[]),children:v.jsx(nn.div,{tabIndex:te||Se===0?-1:0,"data-orientation":y,...K,ref:X,style:{outline:"none",...l.style},onMouseDown:Ht(l.onMouseDown,()=>{pe.current=!0}),onFocus:Ht(l.onFocus,Ue=>{const tt=!pe.current;if(Ue.target===Ue.currentTarget&&tt&&!te){const gt=new CustomEvent(IA,Jte);if(Ue.currentTarget.dispatchEvent(gt),!gt.defaultPrevented){const ht=ae().filter(rt=>rt.focusable),Ge=ht.find(rt=>rt.active),pt=ht.find(rt=>rt.id===G),wt=[Ge,pt,...ht].filter(Boolean).map(rt=>rt.ref.current);o4(wt,H)}}pe.current=!1}),onBlur:Ht(l.onBlur,()=>ne(!1))})})}),i4="RovingFocusGroupItem",s4=L.forwardRef((l,p)=>{const{__scopeRovingFocusGroup:m,focusable:y=!0,active:R=!1,tabStopId:C,children:P,...k}=l,M=tu(),F=C||M,H=ene(i4,m),K=H.currentTabStopId===F,ee=t4(m),{onFocusableItemAdd:X,onFocusableItemRemove:re,currentTabStopId:G}=H;return L.useEffect(()=>{if(y)return X(),()=>re()},[y,X,re]),v.jsx(eN.ItemSlot,{scope:m,id:F,focusable:y,active:R,children:v.jsx(nn.span,{tabIndex:K?0:-1,"data-orientation":H.orientation,...k,ref:p,onMouseDown:Ht(l.onMouseDown,J=>{y?H.onItemFocus(F):J.preventDefault()}),onFocus:Ht(l.onFocus,()=>H.onItemFocus(F)),onKeyDown:Ht(l.onKeyDown,J=>{if(J.key==="Tab"&&J.shiftKey){H.onItemShiftTab();return}if(J.target!==J.currentTarget)return;const te=ine(J,H.orientation,H.dir);if(te!==void 0){if(J.metaKey||J.ctrlKey||J.altKey||J.shiftKey)return;J.preventDefault();let se=ee().filter(ae=>ae.focusable).map(ae=>ae.ref.current);if(te==="last")se.reverse();else if(te==="prev"||te==="next"){te==="prev"&&se.reverse();const ae=se.indexOf(J.currentTarget);se=H.loop?sne(se,ae+1):se.slice(ae+1)}setTimeout(()=>o4(se))}}),children:typeof P=="function"?P({isCurrentTabStop:K,hasTabStop:G!=null}):P})})});s4.displayName=i4;var nne={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function rne(l,p){return p!=="rtl"?l:l==="ArrowLeft"?"ArrowRight":l==="ArrowRight"?"ArrowLeft":l}function ine(l,p,m){const y=rne(l.key,m);if(!(p==="vertical"&&["ArrowLeft","ArrowRight"].includes(y))&&!(p==="horizontal"&&["ArrowUp","ArrowDown"].includes(y)))return nne[y]}function o4(l,p=!1){const m=document.activeElement;for(const y of l)if(y===m||(y.focus({preventScroll:p}),document.activeElement!==m))return}function sne(l,p){return l.map((m,y)=>l[(p+y)%l.length])}var one=r4,ane=s4,ew="Tabs",[cne]=Hc(ew,[n4]),a4=n4(),[lne,DN]=cne(ew),c4=L.forwardRef((l,p)=>{const{__scopeTabs:m,value:y,onValueChange:R,defaultValue:C,orientation:P="horizontal",dir:k,activationMode:M="automatic",...F}=l,H=PN(k),[K,ee]=Jh({prop:y,onChange:R,defaultProp:C??"",caller:ew});return v.jsx(lne,{scope:m,baseId:tu(),value:K,onValueChange:ee,orientation:P,dir:H,activationMode:M,children:v.jsx(nn.div,{dir:H,"data-orientation":P,...F,ref:p})})});c4.displayName=ew;var l4="TabsList",d4=L.forwardRef((l,p)=>{const{__scopeTabs:m,loop:y=!0,...R}=l,C=DN(l4,m),P=a4(m);return v.jsx(one,{asChild:!0,...P,orientation:C.orientation,dir:C.dir,loop:y,children:v.jsx(nn.div,{role:"tablist","aria-orientation":C.orientation,...R,ref:p})})});d4.displayName=l4;var u4="TabsTrigger",h4=L.forwardRef((l,p)=>{const{__scopeTabs:m,value:y,disabled:R=!1,...C}=l,P=DN(u4,m),k=a4(m),M=m4(P.baseId,y),F=_4(P.baseId,y),H=y===P.value;return v.jsx(ane,{asChild:!0,...k,focusable:!R,active:H,children:v.jsx(nn.button,{type:"button",role:"tab","aria-selected":H,"aria-controls":F,"data-state":H?"active":"inactive","data-disabled":R?"":void 0,disabled:R,id:M,...C,ref:p,onMouseDown:Ht(l.onMouseDown,K=>{!R&&K.button===0&&K.ctrlKey===!1?P.onValueChange(y):K.preventDefault()}),onKeyDown:Ht(l.onKeyDown,K=>{[" ","Enter"].includes(K.key)&&P.onValueChange(y)}),onFocus:Ht(l.onFocus,()=>{const K=P.activationMode!=="manual";!H&&!R&&K&&P.onValueChange(y)})})})});h4.displayName=u4;var p4="TabsContent",f4=L.forwardRef((l,p)=>{const{__scopeTabs:m,value:y,forceMount:R,children:C,...P}=l,k=DN(p4,m),M=m4(k.baseId,y),F=_4(k.baseId,y),H=y===k.value,K=L.useRef(H);return L.useEffect(()=>{const ee=requestAnimationFrame(()=>K.current=!1);return()=>cancelAnimationFrame(ee)},[]),v.jsx(tp,{present:R||H,children:({present:ee})=>v.jsx(nn.div,{"data-state":H?"active":"inactive","data-orientation":k.orientation,role:"tabpanel","aria-labelledby":M,hidden:!ee,id:F,tabIndex:0,...P,ref:p,style:{...l.style,animationDuration:K.current?"0s":void 0},children:ee&&C})})});f4.displayName=p4;function m4(l,p){return`${l}-trigger-${p}`}function _4(l,p){return`${l}-content-${p}`}var dne=c4,g4=d4,E4=h4,v4=f4;const kN=dne,tw=L.forwardRef(({className:l,...p},m)=>v.jsx(g4,{ref:m,className:gn("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",l),...p}));tw.displayName=g4.displayName;const ru=L.forwardRef(({className:l,...p},m)=>v.jsx(E4,{ref:m,className:gn("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",l),...p}));ru.displayName=E4.displayName;const iu=L.forwardRef(({className:l,...p},m)=>v.jsx(v4,{ref:m,className:gn("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",l),...p}));iu.displayName=v4.displayName;const une=()=>"https://bwp-back-1.onrender.com",Ar=une();console.log("🔧 [API] Environment VITE_API_URL:",void 0);console.log("🔧 [API] Environment PROD:",!0);console.log("🔧 [API] Resolved API_BASE:",Ar);async function hne(l){const p=await fetch(`${Ar}/token`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)});if(!p.ok)throw new Error("Failed to get token");return p.json()}async function y4(l){const p=l?`${Ar}/posts?roomId=${l}`:`${Ar}/posts`,m=await fetch(p);if(!m.ok)throw new Error("Failed to fetch posts");return m.json()}async function S4(l,p){const m=await fetch(`${Ar}/posts/${l}`,{method:"DELETE",headers:{"Content-Type":"application/json","x-user-id":p}});if(!m.ok){const y=await m.json().catch(()=>({error:"unknown"}));throw new Error(y.error||"delete_failed")}return m.json()}async function pne(l){const p=await fetch(`${Ar}/posts`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)});if(!p.ok)throw new Error("Failed to create post");return p.json()}async function fne(){const l=await fetch(`${Ar}/users`);if(!l.ok)throw new Error("Failed to fetch users");return l.json()}async function T4(l){console.log("🔵 [FRONTEND] Creating user with data:",{...l,password:"[HIDDEN]"});const p=await fetch(`${Ar}/users`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)});if(console.log("🔵 [FRONTEND] Create user response status:",p.status),!p.ok){const y=await p.json().catch(()=>({}));throw console.error("❌ [FRONTEND] Create user failed:",y),new Error(y.error||"Failed to create user")}const m=await p.json();return console.log("✅ [FRONTEND] User created successfully:",m),m}async function mne(l){console.log("🔵 [FRONTEND] Logging in user with email:",l.email);const p=await fetch(`${Ar}/users/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)});if(console.log("🔵 [FRONTEND] Login response status:",p.status),!p.ok){const y=await p.json().catch(()=>({}));throw console.error("❌ [FRONTEND] Login failed:",y),new Error(y.error||"Failed to login")}const m=await p.json();return console.log("✅ [FRONTEND] Login successful:",m),m}async function _ne(){console.log("🔵 [FRONTEND] Creating anonymous user");const l=await fetch(`${Ar}/users/anonymous`,{method:"POST",headers:{"Content-Type":"application/json"}});if(console.log("🔵 [FRONTEND] Anonymous user response status:",l.status),!l.ok){const m=await l.json().catch(()=>({}));throw console.error("❌ [FRONTEND] Anonymous user creation failed:",m),new Error(m.error||"Failed to create anonymous user")}const p=await l.json();return console.log("✅ [FRONTEND] Anonymous user created successfully:",p),p}async function gne(l){console.log("🔵 [FRONTEND] Logging out user with ID:",l);const p=await fetch(`${Ar}/users/logout`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:l})});if(console.log("🔵 [FRONTEND] Logout response status:",p.status),!p.ok){const y=await p.json().catch(()=>({}));throw console.error("❌ [FRONTEND] Logout failed:",y),new Error(y.error||"Failed to logout")}const m=await p.json();return console.log("✅ [FRONTEND] Logout successful:",m),m}async function R4(l){const p=`${Ar}/rooms`,m=await fetch(p);if(!m.ok)throw new Error("Failed to fetch rooms");return m.json()}async function Ene(l){const p=await fetch(`${Ar}/rooms/${l}`);if(!p.ok)throw new Error("Failed to fetch room");return p.json()}async function vne(l){const p=await fetch(`${Ar}/rooms`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)});if(!p.ok){const m=await p.json().catch(()=>({}));throw new Error(m.error||"Failed to create room")}return p.json()}async function w4(l,p,m){const y=await fetch(`${Ar}/reactions`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({postId:l,userId:p,reactionType:m})});if(!y.ok)throw new Error("Failed to add reaction");return y.json()}async function tN(l,p,m){const y=await fetch(`${Ar}/reactions`,{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({postId:l,userId:p,reactionType:m})});if(!y.ok)throw new Error("Failed to remove reaction");return y.json()}async function MR(l,p){const m=p?`${Ar}/reactions/${l}?userId=${p}`:`${Ar}/reactions/${l}`,y=await fetch(m);if(!y.ok)throw new Error("Failed to fetch reactions");return y.json()}async function yne(l){const p=await fetch(`${Ar}/posts?authorId=${l}`);if(!p.ok)throw new Error("Failed to fetch user posts");return p.json()}async function Sne(l){const p=await fetch(`${Ar}/users/${l}/stats`);if(!p.ok)throw new Error("Failed to fetch user stats");return p.json()}async function Tne(l){const p=await fetch(`${Ar}/badges/${l}`);if(!p.ok)throw new Error("Failed to fetch user badges");return p.json()}async function Rne(l){const p=await fetch(`${Ar}/comments/${l}`);if(!p.ok)throw new Error("Failed to fetch comments");return p.json()}async function WF(l){const p=await fetch(`${Ar}/comments`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)});if(!p.ok){const m=await p.json().catch(()=>({}));throw new Error(m.error||"Failed to create comment")}return p.json()}async function wne(l,p){const m=await fetch(`${Ar}/comments/${l}`,{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:p})});if(!m.ok){const y=await m.json().catch(()=>({}));throw new Error(y.error||"Failed to delete comment")}return m.json()}function Cne(){const[l,p]=L.useState(!1),[m,y]=L.useState(!1),[R,C]=L.useState({email:"",password:"",name:""}),P=Lm(),{toast:k}=Gc(),M=H=>{const{name:K,value:ee}=H.target;C(X=>({...X,[K]:ee}))},F=async(H,K)=>{H.preventDefault(),y(!0);try{let ee;if(K==="anonymous")ee=await _ne(),k({title:"Welcome, Anonymous!",description:"You're now browsing anonymously. Start spilling some tea!"});else if(K==="signup"){if(!R.name.trim()){k({title:"Error",description:"Name is required for signup",variant:"destructive"}),y(!1);return}ee=await T4({name:R.name,email:R.email,password:R.password}),k({title:"Welcome to TeaTok!",description:"Account created successfully. Ready to spill some tea?"})}else ee=await mne({email:R.email,password:R.password}),k({title:"Welcome back!",description:"Ready to spill some tea?"});localStorage.setItem("user",JSON.stringify(ee));const X=localStorage.getItem("redirectAfterLogin");X&&X!=="/auth"?(localStorage.removeItem("redirectAfterLogin"),P(X)):P("/feed")}catch(ee){console.error("Authentication error:",ee),k({title:"Authentication Failed",description:ee instanceof Error?ee.message:"Something went wrong. Please try again.",variant:"destructive"})}finally{y(!1)}};return v.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center p-4",children:v.jsxs("div",{className:"w-full max-w-md space-y-6 animate-fade-in",children:[v.jsxs("div",{className:"text-center space-y-4",children:[v.jsxs(jr,{to:"/",className:"inline-flex items-center text-muted-foreground hover:text-foreground transition-colors mb-4",children:[v.jsx(qE,{className:"h-4 w-4 mr-2"}),"Back to Home"]}),v.jsx("div",{className:"flex justify-center",children:v.jsxs("div",{className:"relative",children:[v.jsx("img",{src:"/logo.png",alt:"TeaTok Logo",className:"hidden dark:block h-20 w-20 md:h-24 md:w-24 animate-pulse-glow rounded object-contain"}),v.jsx("img",{src:"/logo-light.png",alt:"TeaTok Logo",className:"block dark:hidden h-20 w-20 md:h-24 md:w-24 animate-pulse-glow rounded object-contain"})]})}),v.jsxs("div",{children:[v.jsx("h1",{className:"text-2xl font-bold gradient-primary bg-clip-text text-transparent",children:"Welcome to TeaTok"}),v.jsx("p",{className:"text-muted-foreground",children:"Spill anonymously, connect authentically"})]})]}),v.jsx(An,{className:"tea-card",children:v.jsxs(kN,{defaultValue:"signin",children:[v.jsx(Ir,{className:"space-y-1 pb-4",children:v.jsxs(tw,{className:"grid w-full grid-cols-2",children:[v.jsx(ru,{value:"signin",children:"Sign In"}),v.jsx(ru,{value:"signup",children:"Sign Up"})]})}),v.jsx(iu,{value:"signin",children:v.jsxs("form",{onSubmit:H=>F(H,"signin"),children:[v.jsxs(Dn,{className:"space-y-4",children:[v.jsxs("div",{className:"space-y-2",children:[v.jsx("label",{className:"text-sm font-medium",children:"Email"}),v.jsxs("div",{className:"relative",children:[v.jsx(ea,{type:"email",name:"email",value:R.email,onChange:M,placeholder:"spill@teatime.com",className:"pl-10",required:!0}),v.jsx(dF,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"})]})]}),v.jsxs("div",{className:"space-y-2",children:[v.jsx("label",{className:"text-sm font-medium",children:"Password"}),v.jsxs("div",{className:"relative",children:[v.jsx(ea,{type:l?"text":"password",name:"password",value:R.password,onChange:M,placeholder:"Your secret brew...",className:"pl-10 pr-10",required:!0}),v.jsx(cF,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),v.jsx(At,{type:"button",variant:"ghost",size:"icon",className:"absolute right-1 top-1 h-8 w-8",onClick:()=>p(!l),children:l?v.jsx(iF,{className:"h-4 w-4"}):v.jsx(sF,{className:"h-4 w-4"})})]})]})]}),v.jsx(YE,{className:"flex flex-col space-y-3",children:v.jsx(At,{type:"submit",className:"w-full spill-button",disabled:m,children:m?"Brewing...":"Sign In"})})]})}),v.jsx(iu,{value:"signup",children:v.jsxs("form",{onSubmit:H=>F(H,"signup"),children:[v.jsxs(Dn,{className:"space-y-4",children:[v.jsxs("div",{className:"space-y-2",children:[v.jsx("label",{className:"text-sm font-medium",children:"Name"}),v.jsxs("div",{className:"relative",children:[v.jsx(ea,{type:"text",name:"name",value:R.name,onChange:M,placeholder:"Your display name",className:"pl-10",required:!0}),v.jsx(BB,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"})]})]}),v.jsxs("div",{className:"space-y-2",children:[v.jsx("label",{className:"text-sm font-medium",children:"Email"}),v.jsxs("div",{className:"relative",children:[v.jsx(ea,{type:"email",name:"email",value:R.email,onChange:M,placeholder:"newbie@teatime.com",className:"pl-10",required:!0}),v.jsx(dF,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"})]})]}),v.jsxs("div",{className:"space-y-2",children:[v.jsx("label",{className:"text-sm font-medium",children:"Password"}),v.jsxs("div",{className:"relative",children:[v.jsx(ea,{type:l?"text":"password",name:"password",value:R.password,onChange:M,placeholder:"Create your secret...",className:"pl-10 pr-10",required:!0}),v.jsx(cF,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),v.jsx(At,{type:"button",variant:"ghost",size:"icon",className:"absolute right-1 top-1 h-8 w-8",onClick:()=>p(!l),children:l?v.jsx(iF,{className:"h-4 w-4"}):v.jsx(sF,{className:"h-4 w-4"})})]})]})]}),v.jsx(YE,{className:"flex flex-col space-y-3",children:v.jsx(At,{type:"submit",className:"w-full spill-button",disabled:m,children:m?"Brewing...":"Join TeaTok"})})]})})]})}),v.jsxs(An,{className:"tea-card",children:[v.jsxs(Ir,{className:"text-center pb-4",children:[v.jsxs(Pi,{className:"flex items-center justify-center space-x-2 text-lg",children:[v.jsx(oF,{className:"h-5 w-5 text-accent"}),v.jsx("span",{children:"Go Anonymous"})]}),v.jsx(Bs,{children:"Explore TeaTok without creating an account"})]}),v.jsx(YE,{children:v.jsxs(At,{onClick:H=>F(H,"anonymous"),variant:"outline",className:"w-full neon-border hover-glow",disabled:m,children:[v.jsx(oF,{className:"h-4 w-4 mr-2"}),m?"Materializing...":"Browse Anonymously"]})})]}),v.jsxs("p",{className:"text-center text-sm text-muted-foreground",children:["By continuing, you agree to TeaTok's"," ",v.jsx(jr,{to:"/about",className:"underline hover:text-foreground",children:"Terms of Service"})," ","and"," ",v.jsx(jr,{to:"/about",className:"underline hover:text-foreground",children:"Privacy Policy"})]})]})})}var AA={exports:{}},NA={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var GF;function bne(){if(GF)return NA;GF=1;var l=VR();function p(K,ee){return K===ee&&(K!==0||1/K===1/ee)||K!==K&&ee!==ee}var m=typeof Object.is=="function"?Object.is:p,y=l.useState,R=l.useEffect,C=l.useLayoutEffect,P=l.useDebugValue;function k(K,ee){var X=ee(),re=y({inst:{value:X,getSnapshot:ee}}),G=re[0].inst,J=re[1];return C(function(){G.value=X,G.getSnapshot=ee,M(G)&&J({inst:G})},[K,X,ee]),R(function(){return M(G)&&J({inst:G}),K(function(){M(G)&&J({inst:G})})},[K]),P(X),X}function M(K){var ee=K.getSnapshot;K=K.value;try{var X=ee();return!m(K,X)}catch{return!0}}function F(K,ee){return ee()}var H=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?F:k;return NA.useSyncExternalStore=l.useSyncExternalStore!==void 0?l.useSyncExternalStore:H,NA}var HF;function Ine(){return HF||(HF=1,AA.exports=bne()),AA.exports}var Ane=Ine();function Nne(){return Ane.useSyncExternalStore(One,()=>!0,()=>!1)}function One(){return()=>{}}var xN="Avatar",[Pne]=Hc(xN),[Dne,C4]=Pne(xN),b4=L.forwardRef((l,p)=>{const{__scopeAvatar:m,...y}=l,[R,C]=L.useState("idle");return v.jsx(Dne,{scope:m,imageLoadingStatus:R,onImageLoadingStatusChange:C,children:v.jsx(nn.span,{...y,ref:p})})});b4.displayName=xN;var I4="AvatarImage",A4=L.forwardRef((l,p)=>{const{__scopeAvatar:m,src:y,onLoadingStatusChange:R=()=>{},...C}=l,P=C4(I4,m),k=kne(y,C),M=go(F=>{R(F),P.onImageLoadingStatusChange(F)});return ai(()=>{k!=="idle"&&M(k)},[k,M]),k==="loaded"?v.jsx(nn.img,{...C,ref:p,src:y}):null});A4.displayName=I4;var N4="AvatarFallback",O4=L.forwardRef((l,p)=>{const{__scopeAvatar:m,delayMs:y,...R}=l,C=C4(N4,m),[P,k]=L.useState(y===void 0);return L.useEffect(()=>{if(y!==void 0){const M=window.setTimeout(()=>k(!0),y);return()=>window.clearTimeout(M)}},[y]),P&&C.imageLoadingStatus!=="loaded"?v.jsx(nn.span,{...R,ref:p}):null});O4.displayName=N4;function KF(l,p){return l?p?(l.src!==p&&(l.src=p),l.complete&&l.naturalWidth>0?"loaded":"loading"):"error":"idle"}function kne(l,{referrerPolicy:p,crossOrigin:m}){const y=Nne(),R=L.useRef(null),C=y?(R.current||(R.current=new window.Image),R.current):null,[P,k]=L.useState(()=>KF(C,l));return ai(()=>{k(KF(C,l))},[C,l]),ai(()=>{const M=K=>()=>{k(K)};if(!C)return;const F=M("loaded"),H=M("error");return C.addEventListener("load",F),C.addEventListener("error",H),p&&(C.referrerPolicy=p),typeof m=="string"&&(C.crossOrigin=m),()=>{C.removeEventListener("load",F),C.removeEventListener("error",H)}},[C,m,p]),P}var P4=b4,D4=A4,k4=O4;const $d=L.forwardRef(({className:l,...p},m)=>v.jsx(P4,{ref:m,className:gn("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",l),...p}));$d.displayName=P4.displayName;const xne=L.forwardRef(({className:l,...p},m)=>v.jsx(D4,{ref:m,className:gn("aspect-square h-full w-full",l),...p}));xne.displayName=D4.displayName;const eu=L.forwardRef(({className:l,...p},m)=>v.jsx(k4,{ref:m,className:gn("flex h-full w-full items-center justify-center rounded-full bg-muted",l),...p}));eu.displayName=k4.displayName;const Lne=GR("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function su({className:l,variant:p,...m}){return v.jsx("div",{className:gn(Lne({variant:p}),l),...m})}function Xh(){const l=rp(),p=Lm(),{toast:m}=Gc(),[y,R]=L.useState(null),[C,P]=L.useState(!1);L.useEffect(()=>{const F=localStorage.getItem("user");if(F)try{R(JSON.parse(F))}catch(H){console.error("Error parsing user data:",H),localStorage.removeItem("user")}},[]);const k=async()=>{if(y){P(!0);try{await gne(y.id),localStorage.removeItem("user"),R(null),m({title:"Logged out successfully",description:"You have been logged out of your account."}),p("/")}catch(F){console.error("Logout error:",F),m({title:"Logout failed",description:"There was an error logging out. Please try again.",variant:"destructive"})}finally{P(!1)}}},M=[{name:"Feed",href:"/feed",icon:aQ},{name:"Rooms",href:"/rooms",icon:jB},{name:"Profile",href:"/profile",icon:BB},{name:"Settings",href:"/settings",icon:uQ},{name:"Video Call",href:"/video-call",icon:pQ}];return v.jsxs("nav",{className:"fixed top-0 left-0 right-0 z-50 bg-background/95 backdrop-blur-md border-b border-border",children:[v.jsxs("div",{className:"container mx-auto px-4 h-16 flex items-center justify-between",children:[v.jsx(jr,{to:"/",className:"flex items-center space-x-3 hover-scale transition-smooth",children:v.jsxs("div",{className:"flex items-center space-x-2",children:[v.jsx("img",{src:"/logo.png",alt:"TeaTok Logo",className:"hidden dark:block h-12 w-12 md:h-14 md:w-14 rounded object-contain"}),v.jsx("img",{src:"/logo-light.png",alt:"TeaTok Logo",className:"block dark:hidden h-12 w-12 md:h-14 md:w-14 rounded object-contain"}),v.jsx("img",{src:"/teatok.png",alt:"TeaTok Text",className:"hidden dark:block h-10 md:h-12 w-auto object-contain"}),v.jsx("img",{src:"/teatok-light.png",alt:"TeaTok Text",className:"block dark:hidden h-10 md:h-12 w-auto object-contain"})]})}),v.jsx("div",{className:"hidden md:flex items-center space-x-6",children:M.map(F=>{const H=l.pathname===F.href;return v.jsxs(jr,{to:F.href,className:`flex items-center space-x-2 px-3 py-2 rounded-lg transition-smooth hover-lift ${H?"bg-primary text-primary-foreground shadow-glow":"text-muted-foreground hover:text-foreground hover:bg-muted"}`,children:[v.jsx(F.icon,{className:"h-4 w-4"}),v.jsx("span",{className:"font-medium",children:F.name})]},F.name)})}),v.jsxs("div",{className:"flex items-center space-x-3",children:[v.jsx(ON,{}),y&&v.jsxs("div",{className:"flex items-center space-x-2",children:[v.jsx("span",{className:"text-sm text-muted-foreground hidden md:block",children:y.name||y.alias||"User"}),v.jsxs(At,{onClick:k,disabled:C,variant:"outline",size:"sm",className:"hover:bg-destructive hover:text-destructive-foreground",children:[v.jsx(lF,{className:"h-4 w-4 mr-1"}),C?"Logging out...":"Logout"]})]}),v.jsx(At,{asChild:!0,className:"spill-button animate-pulse-glow hidden sm:flex",children:v.jsxs(jr,{to:"/create",children:[v.jsx(WA,{className:"h-4 w-4 mr-2"}),"Spill Tea"]})})]})]}),v.jsx("div",{className:"md:hidden fixed bottom-0 left-0 right-0 bg-background/95 backdrop-blur-md border-t border-border",children:v.jsxs("div",{className:"flex items-center justify-around py-2",children:[M.map(F=>{const H=l.pathname===F.href;return v.jsxs(jr,{to:F.href,className:`flex flex-col items-center p-3 rounded-lg transition-smooth ${H?"text-primary":"text-muted-foreground hover:text-foreground"}`,children:[v.jsx(F.icon,{className:"h-5 w-5 mb-1"}),v.jsx("span",{className:"text-xs font-medium",children:F.name})]},F.name)}),y&&v.jsxs("button",{onClick:k,disabled:C,className:"flex flex-col items-center p-3 rounded-lg transition-smooth text-muted-foreground hover:text-destructive",children:[v.jsx(lF,{className:"h-5 w-5 mb-1"}),v.jsx("span",{className:"text-xs font-medium",children:"Logout"})]}),v.jsx(At,{asChild:!0,size:"icon",className:"gradient-primary text-primary-foreground rounded-full shadow-glow hover-glow",children:v.jsx(jr,{to:"/create",children:v.jsx(WA,{className:"h-5 w-5"})})})]})})]})}const nv=L.forwardRef(({className:l,...p},m)=>v.jsx("textarea",{className:gn("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",l),ref:m,...p}));nv.displayName="Textarea";function Mne({postId:l,currentUser:p,isOpen:m,onToggle:y}){const[R,C]=L.useState([]),[P,k]=L.useState(!1),[M,F]=L.useState(!1),[H,K]=L.useState(""),[ee,X]=L.useState(null),[re,G]=L.useState(""),{toast:J}=Gc();L.useEffect(()=>{m&&R.length===0&&te()},[m,l]);const te=async()=>{try{k(!0);const Se=await Rne(l);C(Se)}catch(Se){console.error("Failed to load comments:",Se),J({title:"Error",description:"Failed to load comments",variant:"destructive"})}finally{k(!1)}},ne=async Se=>{if(Se.preventDefault(),!(!H.trim()||!p))try{F(!0);const Te=await WF({postId:l,authorId:p.id,content:H.trim()});C(Ue=>[Te,...Ue]),K(""),J({title:"Success",description:"Comment posted!"})}catch(Te){console.error("Failed to create comment:",Te),J({title:"Error",description:Te instanceof Error?Te.message:"Failed to post comment",variant:"destructive"})}finally{F(!1)}},se=async Se=>{if(!(!re.trim()||!p))try{F(!0);const Te=await WF({postId:l,authorId:p.id,content:re.trim(),parentCommentId:Se});C(Ue=>Ue.map(tt=>tt.id===Se?{...tt,replies:[...tt.replies||[],Te]}:tt)),G(""),X(null),J({title:"Success",description:"Reply posted!"})}catch(Te){console.error("Failed to create reply:",Te),J({title:"Error",description:Te instanceof Error?Te.message:"Failed to post reply",variant:"destructive"})}finally{F(!1)}},ae=async Se=>{if(p)try{await wne(Se,p.id),C(Te=>Te.filter(Ue=>Ue.id!==Se)),J({title:"Success",description:"Comment deleted"})}catch(Te){console.error("Failed to delete comment:",Te),J({title:"Error",description:Te instanceof Error?Te.message:"Failed to delete comment",variant:"destructive"})}},pe=Se=>{const Te=new Date(Se),tt=Math.floor((new Date().getTime()-Te.getTime())/1e3);return tt<60?"Just now":tt<3600?`${Math.floor(tt/60)}m ago`:tt<86400?`${Math.floor(tt/3600)}h ago`:`${Math.floor(tt/86400)}d ago`};return m?v.jsxs(An,{className:"mt-4",children:[v.jsx(Ir,{className:"pb-3",children:v.jsxs("div",{className:"flex items-center justify-between",children:[v.jsxs("h3",{className:"font-semibold",children:["Comments (",R.length,")"]}),v.jsx(At,{variant:"ghost",size:"sm",onClick:y,children:"Close"})]})}),v.jsxs(Dn,{className:"space-y-4",children:[v.jsx("form",{onSubmit:ne,className:"space-y-3",children:v.jsxs("div",{className:"flex items-start space-x-3",children:[v.jsx($d,{className:"w-8 h-8",children:v.jsx(eu,{className:"gradient-primary text-white text-sm font-bold",children:p?.alias?p.alias.charAt(0):p?.name?.charAt(0)})}),v.jsxs("div",{className:"flex-1 space-y-2",children:[v.jsx(nv,{placeholder:"Add a comment...",value:H,onChange:Se=>K(Se.target.value),className:"min-h-[80px] resize-none"}),v.jsx("div",{className:"flex justify-end",children:v.jsx(At,{type:"submit",size:"sm",disabled:!H.trim()||M,className:"spill-button",children:M?"Posting...":"Post Comment"})})]})]})}),P?v.jsxs("div",{className:"text-center py-4",children:[v.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-primary mx-auto"}),v.jsx("p",{className:"mt-2 text-sm text-muted-foreground",children:"Loading comments..."})]}):R.length===0?v.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[v.jsx(Im,{className:"h-8 w-8 mx-auto mb-2 opacity-50"}),v.jsx("p",{children:"No comments yet. Be the first to comment!"})]}):v.jsx("div",{className:"space-y-4",children:R.map(Se=>v.jsxs("div",{className:"space-y-3",children:[v.jsxs("div",{className:"flex items-start space-x-3",children:[v.jsx($d,{className:"w-8 h-8",children:v.jsx(eu,{className:"gradient-primary text-white text-sm font-bold",children:Se.author.alias?Se.author.alias.charAt(0):Se.author.name.charAt(0)})}),v.jsxs("div",{className:"flex-1 space-y-2",children:[v.jsxs("div",{className:"flex items-center space-x-2",children:[v.jsx("span",{className:"font-medium text-sm",children:Se.author.alias||Se.author.name}),v.jsx("span",{className:"text-xs text-muted-foreground",children:pe(Se.createdAt)})]}),v.jsx("p",{className:"text-sm",children:Se.content}),v.jsxs("div",{className:"flex items-center space-x-4",children:[v.jsxs(At,{variant:"ghost",size:"sm",onClick:()=>X(ee===Se.id?null:Se.id),className:"h-6 px-2 text-xs text-muted-foreground hover:text-foreground",children:[v.jsx(dQ,{className:"h-3 w-3 mr-1"}),"Reply"]}),p&&Se.author.name===p.name&&v.jsxs(At,{variant:"ghost",size:"sm",onClick:()=>ae(Se.id),className:"h-6 px-2 text-xs text-muted-foreground hover:text-destructive",children:[v.jsx(XE,{className:"h-3 w-3 mr-1"}),"Delete"]})]})]})]}),ee===Se.id&&v.jsx("div",{className:"ml-11 space-y-2",children:v.jsxs("div",{className:"flex items-start space-x-2",children:[v.jsx($d,{className:"w-6 h-6",children:v.jsx(eu,{className:"gradient-primary text-white text-xs font-bold",children:p?.alias?p.alias.charAt(0):p?.name?.charAt(0)})}),v.jsxs("div",{className:"flex-1 space-y-2",children:[v.jsx(nv,{placeholder:"Write a reply...",value:re,onChange:Te=>G(Te.target.value),className:"min-h-[60px] resize-none text-sm"}),v.jsxs("div",{className:"flex justify-end space-x-2",children:[v.jsx(At,{variant:"ghost",size:"sm",onClick:()=>{X(null),G("")},className:"h-6 px-2 text-xs",children:"Cancel"}),v.jsx(At,{size:"sm",onClick:()=>se(Se.id),disabled:!re.trim()||M,className:"h-6 px-2 text-xs spill-button",children:M?"Posting...":"Reply"})]})]})]})}),Se.replies&&Se.replies.length>0&&v.jsx("div",{className:"ml-11 space-y-3",children:Se.replies.map(Te=>v.jsxs("div",{className:"flex items-start space-x-2",children:[v.jsx($d,{className:"w-6 h-6",children:v.jsx(eu,{className:"gradient-accent text-white text-xs font-bold",children:Te.author.alias?Te.author.alias.charAt(0):Te.author.name.charAt(0)})}),v.jsxs("div",{className:"flex-1 space-y-1",children:[v.jsxs("div",{className:"flex items-center space-x-2",children:[v.jsx("span",{className:"font-medium text-xs",children:Te.author.alias||Te.author.name}),v.jsx("span",{className:"text-xs text-muted-foreground",children:pe(Te.createdAt)})]}),v.jsx("p",{className:"text-xs",children:Te.content})]})]},Te.id))})]},Se.id))})]})]}):v.jsxs(At,{variant:"ghost",size:"sm",onClick:y,className:"flex items-center space-x-1 text-muted-foreground hover:text-foreground",children:[v.jsx(Im,{className:"h-4 w-4"}),v.jsx("span",{children:R.length})]})}function Une(){const[l,p]=L.useState([]),[m,y]=L.useState(!0),[R,C]=L.useState(null),[P,k]=L.useState({}),[M,F]=L.useState({}),H=te=>{R&&(localStorage.setItem(`userReactions_${R.id}`,JSON.stringify(te)),console.log("🔵 [FEED] User reactions saved to localStorage:",te))};L.useEffect(()=>{const te=localStorage.getItem("user");if(te)try{const ne=JSON.parse(te);C(ne),console.log("🔵 [FEED] User loaded from localStorage:",ne);const se=localStorage.getItem(`userReactions_${ne.id}`);if(se)try{const ae=JSON.parse(se);k(ae),console.log("🔵 [FEED] User reactions loaded from localStorage:",ae)}catch(ae){console.error("Error parsing user reactions:",ae),localStorage.removeItem(`userReactions_${ne.id}`)}K()}catch(ne){console.error("Error parsing user data:",ne),localStorage.removeItem("user"),window.location.href="/auth"}else window.location.href="/auth"},[]);const K=async()=>{try{console.log("Loading posts from API...");const te=await y4();console.log("Received posts:",te.length);const ne=te.map(se=>({id:se.id,authorId:se.authorId,author:se.author.name,alias:se.author.alias||"Anon",content:se.content,timestamp:new Date(se.createdAt).toLocaleString(),duration:se.duration,reactions:{tea:0,spicy:0,cap:0,hearts:0},replies:0,category:se.room.name,isVoiceNote:se.isVoiceNote}));p(ne),console.log("Posts set:",ne.length);for(const se of te)try{const ae=R?.id||"demo-user-id",pe=await MR(se.id,R?ae:void 0);p(Se=>Se.map(Te=>Te.id===se.id?{...Te,reactions:pe.reactions}:Te)),pe.userReaction&&k(Se=>{const Te={...Se,[se.id]:pe.userReaction.reactionType};return H(Te),Te})}catch(ae){console.error("Failed to load reactions for post:",se.id,ae)}}catch(te){console.error("Failed to load posts:",te),p([])}finally{y(!1)}},ee=async(te,ne)=>{if(!R){console.log("🔴 [FEED] No user logged in, cannot react");return}try{const se=R.id||"demo-user-id",ae=P[te];if(console.log(`🔵 [FEED] Handling reaction: ${ne} for post ${te}`),console.log(`🔵 [FEED] Current user reaction: ${ae}`),ae===ne)console.log(`🟡 [FEED] Removing existing reaction: ${ne}`),await tN(te,se,ne),k(pe=>{const Se={...pe};return delete Se[te],H(Se),Se}),p(l.map(pe=>pe.id===te?{...pe,reactions:{...pe.reactions,[ne]:Math.max(0,pe.reactions[ne]-1)}}:pe));else{ae&&console.log(`🟡 [FEED] Updating reaction from ${ae} to ${ne}`),await w4(te,se,ne),k(pe=>{const Se={...pe,[te]:ne};return H(Se),Se});try{const pe=await MR(te,R?se:void 0);p(Se=>Se.map(Te=>Te.id===te?{...Te,reactions:pe.reactions}:Te))}catch(pe){console.error("Failed to reload reactions:",pe)}}}catch(se){console.error("Failed to handle reaction:",se)}},X=te=>{switch(te){case"tea":return"☕";case"spicy":return"🌶️";case"cap":return"🧢";default:return"❤️"}},re=async te=>{try{if(!R||!window.confirm("Delete this post? This cannot be undone."))return;await S4(te,R.id),p(se=>se.filter(ae=>ae.id!==te))}catch(ne){console.error("Failed to delete post:",ne),alert("Failed to delete post")}},G=te=>{switch(te){case"Celeb Gossip":return"gradient-primary";case"Movies":return"gradient-accent";case"Gaming":return"gradient-warm";default:return"bg-muted"}},J=te=>{F(ne=>({...ne,[te]:!ne[te]}))};return v.jsxs("div",{className:"min-h-screen bg-background pb-20 md:pb-8",children:[v.jsx(Xh,{}),v.jsx("main",{className:"container mx-auto px-4 pt-20 max-w-2xl",children:v.jsxs("div",{className:"space-y-6",children:[v.jsxs("div",{className:"text-center py-6 animate-fade-in",children:[v.jsx("h1",{className:"text-2xl font-bold mb-2",children:"Latest Tea"}),v.jsx("p",{className:"text-muted-foreground",children:"Fresh gossip, hot takes, and spicy reviews"}),v.jsxs("div",{className:"mt-4 p-4 bg-muted rounded-lg text-left text-sm",children:[v.jsx("p",{children:v.jsx("strong",{children:"Debug Info:"})}),v.jsxs("p",{children:["Loading: ",m?"Yes":"No"]}),v.jsxs("p",{children:["Posts Count: ",l.length]}),v.jsx("p",{children:"Check browser console for detailed logs"})]})]}),m&&v.jsxs("div",{className:"text-center py-12",children:[v.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto"}),v.jsx("p",{className:"mt-2 text-sm text-muted-foreground",children:"Loading posts..."})]}),!m&&v.jsx("div",{className:"space-y-6",children:l.length===0?v.jsxs("div",{className:"text-center py-12",children:[v.jsx("div",{className:"text-4xl mb-4",children:"☕"}),v.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No tea yet"}),v.jsx("p",{className:"text-muted-foreground",children:"Be the first to spill some tea in this room!"})]}):l.map((te,ne)=>v.jsxs(An,{className:"tea-card animate-slide-in-right",style:{animationDelay:`${ne*.1}s`},children:[v.jsx(Ir,{className:"pb-3",children:v.jsxs("div",{className:"flex items-start justify-between",children:[v.jsxs("div",{className:"flex items-center space-x-3",children:[v.jsx($d,{className:"w-10 h-10",children:v.jsx(eu,{className:`${G(te.category)} text-white font-semibold`,children:te.author.charAt(0)})}),v.jsxs("div",{children:[v.jsx("h3",{className:"font-semibold text-sm",children:te.alias}),v.jsxs("p",{className:"text-xs text-muted-foreground",children:["@",te.author]})]})]}),v.jsxs("div",{className:"flex items-center space-x-2",children:[v.jsx(su,{variant:"secondary",className:"text-xs",children:te.category}),R&&te.authorId&&R.id===te.authorId?v.jsxs(At,{variant:"destructive",size:"sm",className:"h-8 px-3",onClick:()=>re(te.id),"aria-label":"Delete post",title:"Delete post",children:[v.jsx(XE,{className:"h-4 w-4 mr-1"}),"Delete"]}):v.jsxs(At,{variant:"outline",size:"sm",className:"h-8 px-3 text-muted-foreground","aria-label":"Delete post (disabled)",title:"Only the author can delete this post",disabled:!0,children:[v.jsx(XE,{className:"h-4 w-4 mr-1"}),"Delete"]})]})]})}),v.jsx(Dn,{className:"py-0",children:v.jsxs("div",{className:"space-y-3",children:[te.isVoiceNote&&v.jsxs("div",{className:"flex items-center space-x-2 p-3 bg-muted rounded-lg",children:[v.jsx("div",{className:"w-8 h-8 gradient-accent rounded-full flex items-center justify-center",children:v.jsx("div",{className:"w-4 h-4 bg-white rounded-full animate-pulse"})}),v.jsx("div",{className:"flex-1",children:v.jsx("div",{className:"h-2 bg-accent rounded-full overflow-hidden",children:v.jsx("div",{className:"h-full w-3/4 bg-accent-foreground rounded-full"})})}),v.jsx("span",{className:"text-xs text-muted-foreground",children:"1:23"})]}),v.jsx("p",{className:"text-sm leading-relaxed",children:te.content}),v.jsxs("div",{className:"flex items-center justify-between text-xs text-muted-foreground",children:[v.jsxs("div",{className:"flex items-center space-x-1",children:[v.jsx(bm,{className:"h-3 w-3"}),v.jsx("span",{children:te.timestamp})]}),v.jsxs("div",{className:"flex items-center space-x-1",children:[te.duration==="permanent"?v.jsx(iQ,{className:"h-3 w-3 text-orange-500"}):v.jsx(bm,{className:"h-3 w-3"}),v.jsx("span",{children:te.duration})]})]})]})}),v.jsx(YE,{className:"pt-4",children:v.jsx("div",{className:"w-full space-y-3",children:v.jsxs("div",{className:"flex items-center justify-between",children:[v.jsx("div",{className:"flex items-center space-x-4",children:Object.entries(te.reactions).map(([se,ae])=>{const pe=P[te.id]===se;return v.jsxs(At,{variant:pe?"default":"ghost",size:"sm",onClick:()=>ee(te.id,se),className:`flex items-center space-x-1 hover-scale transition-smooth p-2 rounded-full ${pe?"bg-primary text-primary-foreground shadow-glow":""}`,children:[v.jsx("span",{className:"text-base",children:X(se)}),v.jsx("span",{className:"text-xs font-medium",children:ae})]},se)})}),v.jsxs("div",{className:"flex items-center space-x-2",children:[v.jsx(Mne,{postId:te.id,currentUser:R,isOpen:M[te.id]||!1,onToggle:()=>J(te.id)}),v.jsx(At,{variant:"ghost",size:"sm",className:"hover-scale",children:v.jsx(VB,{className:"h-4 w-4"})}),v.jsx(At,{variant:"ghost",size:"sm",className:"hover-scale",children:v.jsx(rQ,{className:"h-4 w-4"})})]})]})})})]},te.id))}),v.jsx("div",{className:"text-center py-8",children:v.jsx(At,{variant:"outline",className:"hover-glow",children:"Load More Tea"})})]})})]})}const jne=[{label:"24 Hours",value:"24h",description:"Perfect for hot takes"},{label:"7 Days",value:"7d",description:"Standard gossip duration"},{label:"Permanent",value:"permanent",description:"Forever in the archives"}];function Vne(){const[l,p]=L.useState(""),[m,y]=L.useState(""),[R,C]=L.useState("24h"),[P,k]=L.useState(!1),[M,F]=L.useState("text"),[H,K]=L.useState([]),[ee,X]=L.useState(!0),re=Lm(),{toast:G}=Gc();nt.useEffect(()=>{(async()=>{try{const se=await R4();K(se)}catch(se){console.error("Failed to load rooms:",se),G({title:"Error",description:"Failed to load rooms. Please try again.",variant:"destructive"})}finally{X(!1)}})()},[G]);const J=async ne=>{if(ne.preventDefault(),!l.trim()||!m){G({title:"Missing Information",description:"Please add content and select a room to spill your tea!",variant:"destructive"});return}try{let ae=(await fne())[0]?.id;ae||(ae=(await T4({name:"Anonymous",email:`anon_${Date.now()}@local`,password:"demo"})).id);const pe=H.find(Se=>Se.id===m);if(!pe)throw new Error("Selected room not found");await pne({title:`${pe.name} - ${M==="voice"?"Voice Note":"Text Post"}`,content:l.trim(),authorId:ae,roomId:m,category:pe.name,duration:R,isVoiceNote:M==="voice"}),G({title:"Tea Spilled! ☕",description:"Your anonymous post is now live. Time to watch the reactions roll in!"}),re("/feed")}catch(se){console.error("Error creating post:",se),G({title:"Error",description:"Failed to create post. Please try again.",variant:"destructive"})}},te=()=>{k(!P),P?(p("Voice note recorded (1:23)"),G({title:"Recording Saved",description:"Your voice note is ready to be spilled!"})):G({title:"Recording Started",description:"Spill your tea! Tap again when you're done."})};return v.jsx("div",{className:"min-h-screen bg-background",children:v.jsxs("div",{className:"container mx-auto px-4 py-8 max-w-2xl",children:[v.jsxs("div",{className:"flex items-center justify-between mb-8 animate-fade-in",children:[v.jsxs(At,{variant:"ghost",onClick:()=>re(-1),className:"flex items-center space-x-2",children:[v.jsx(qE,{className:"h-4 w-4"}),v.jsx("span",{children:"Back"})]}),v.jsx("h1",{className:"text-2xl font-bold gradient-primary bg-clip-text text-transparent",children:"Spill the Tea"}),v.jsx("div",{})," "]}),v.jsxs("form",{onSubmit:J,className:"space-y-6",children:[v.jsxs(An,{className:"tea-card animate-slide-in-right",children:[v.jsx(Ir,{children:v.jsx(Pi,{className:"text-lg",children:"What's brewing?"})}),v.jsx(Dn,{children:v.jsxs(kN,{value:M,onValueChange:ne=>F(ne),children:[v.jsxs(tw,{className:"grid w-full grid-cols-2",children:[v.jsxs(ru,{value:"text",className:"flex items-center space-x-2",children:[v.jsx(aF,{className:"h-4 w-4"}),v.jsx("span",{children:"Text Post"})]}),v.jsxs(ru,{value:"voice",className:"flex items-center space-x-2",children:[v.jsx(uF,{className:"h-4 w-4"}),v.jsx("span",{children:"Voice Note"})]})]}),v.jsxs(iu,{value:"text",className:"mt-4",children:[v.jsx(nv,{placeholder:"Spill your tea here... What's the latest gossip, hot take, or review you're dying to share anonymously?",value:l,onChange:ne=>p(ne.target.value),className:"min-h-[120px] resize-none",maxLength:500}),v.jsxs("div",{className:"flex justify-between items-center mt-2 text-sm text-muted-foreground",children:[v.jsx("span",{children:"Be spicy, but stay respectful ✨"}),v.jsxs("span",{children:[l.length,"/500"]})]})]}),v.jsx(iu,{value:"voice",className:"mt-4",children:v.jsxs("div",{className:"flex flex-col items-center justify-center p-8 border-2 border-dashed border-border rounded-lg",children:[v.jsx(At,{type:"button",onClick:te,className:`w-20 h-20 rounded-full ${P?"bg-destructive hover:bg-destructive/90 animate-pulse-glow":"gradient-primary hover-glow"} transition-smooth`,children:v.jsx(uF,{className:`h-8 w-8 ${P?"text-white":"text-primary-foreground"}`})}),v.jsx("p",{className:"mt-4 text-center text-muted-foreground",children:P?"Recording... Tap to stop":"Tap to start recording"}),l.includes("Voice note")&&v.jsxs("div",{className:"mt-4 p-3 bg-muted rounded-lg flex items-center space-x-2",children:[v.jsx("div",{className:"w-6 h-6 gradient-accent rounded-full flex items-center justify-center",children:v.jsx("div",{className:"w-3 h-3 bg-white rounded-full"})}),v.jsx("span",{className:"text-sm",children:"Voice note ready (1:23)"})]})]})})]})})]}),v.jsxs(An,{className:"tea-card animate-slide-in-right",style:{animationDelay:"0.1s"},children:[v.jsx(Ir,{children:v.jsxs(Pi,{className:"text-lg flex items-center space-x-2",children:[v.jsx(aF,{className:"h-5 w-5"}),v.jsx("span",{children:"Choose Your Room"})]})}),v.jsx(Dn,{children:ee?v.jsxs("div",{className:"text-center py-8",children:[v.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto"}),v.jsx("p",{className:"mt-2 text-sm text-muted-foreground",children:"Loading rooms..."})]}):v.jsx("div",{className:"grid grid-cols-2 gap-3",children:H.map(ne=>v.jsx(At,{type:"button",variant:m===ne.id?"default":"outline",className:`h-auto p-4 justify-start ${m===ne.id?`${ne.gradient} text-white shadow-glow`:"hover-lift"}`,onClick:()=>y(ne.id),children:v.jsxs("div",{className:"flex items-center space-x-3",children:[v.jsx("span",{className:"text-xl",children:ne.icon}),v.jsx("span",{className:"font-medium",children:ne.name})]})},ne.id))})})]}),v.jsxs(An,{className:"tea-card animate-slide-in-right",style:{animationDelay:"0.2s"},children:[v.jsx(Ir,{children:v.jsxs(Pi,{className:"text-lg flex items-center space-x-2",children:[v.jsx(bm,{className:"h-5 w-5"}),v.jsx("span",{children:"How Long Should This Live?"})]})}),v.jsx(Dn,{children:v.jsx("div",{className:"space-y-3",children:jne.map(ne=>v.jsxs(At,{type:"button",variant:R===ne.value?"default":"outline",className:`w-full justify-between h-auto py-4 ${R===ne.value?"gradient-accent text-white shadow-glow":"hover-lift"}`,onClick:()=>C(ne.value),children:[v.jsxs("div",{className:"text-left",children:[v.jsx("div",{className:"font-medium",children:ne.label}),v.jsx("div",{className:"text-sm opacity-80",children:ne.description})]}),ne.value==="permanent"&&v.jsx(sQ,{className:"h-5 w-5"}),ne.value!=="permanent"&&v.jsx(LB,{className:"h-5 w-5"})]},ne.value))})})]}),v.jsx("div",{className:"flex justify-center pt-4 animate-fade-in",style:{animationDelay:"0.3s"},children:v.jsxs(At,{type:"submit",size:"lg",className:"spill-button px-12 py-4 text-lg font-semibold animate-bounce-subtle",disabled:!l.trim()||!m,children:[v.jsx(UB,{className:"h-5 w-5 mr-3"}),"Spill This Tea"]})})]}),v.jsx(An,{className:"tea-card mt-8 animate-fade-in",style:{animationDelay:"0.4s"},children:v.jsxs(Dn,{className:"p-4",children:[v.jsx("h3",{className:"font-semibold mb-3 text-accent",children:"Pro Tips for Better Tea ☕"}),v.jsxs("ul",{className:"space-y-2 text-sm text-muted-foreground",children:[v.jsx("li",{children:"• Be specific but protect identities - no real names!"}),v.jsx("li",{children:"• Spicy takes get more engagement than mild ones"}),v.jsx("li",{children:"• Voice notes feel more authentic and personal"}),v.jsx("li",{children:"• Campus Tea and Celeb Gossip rooms are most active"})]})]})})]})})}var OA="focusScope.autoFocusOnMount",PA="focusScope.autoFocusOnUnmount",zF={bubbles:!1,cancelable:!0},Fne="FocusScope",LN=L.forwardRef((l,p)=>{const{loop:m=!1,trapped:y=!1,onMountAutoFocus:R,onUnmountAutoFocus:C,...P}=l,[k,M]=L.useState(null),F=go(R),H=go(C),K=L.useRef(null),ee=or(p,G=>M(G)),X=L.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;L.useEffect(()=>{if(y){let G=function(se){if(X.paused||!k)return;const ae=se.target;k.contains(ae)?K.current=ae:Qd(K.current,{select:!0})},J=function(se){if(X.paused||!k)return;const ae=se.relatedTarget;ae!==null&&(k.contains(ae)||Qd(K.current,{select:!0}))},te=function(se){if(document.activeElement===document.body)for(const pe of se)pe.removedNodes.length>0&&Qd(k)};document.addEventListener("focusin",G),document.addEventListener("focusout",J);const ne=new MutationObserver(te);return k&&ne.observe(k,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",G),document.removeEventListener("focusout",J),ne.disconnect()}}},[y,k,X.paused]),L.useEffect(()=>{if(k){qF.add(X);const G=document.activeElement;if(!k.contains(G)){const te=new CustomEvent(OA,zF);k.addEventListener(OA,F),k.dispatchEvent(te),te.defaultPrevented||(Bne(zne(x4(k)),{select:!0}),document.activeElement===G&&Qd(k))}return()=>{k.removeEventListener(OA,F),setTimeout(()=>{const te=new CustomEvent(PA,zF);k.addEventListener(PA,H),k.dispatchEvent(te),te.defaultPrevented||Qd(G??document.body,{select:!0}),k.removeEventListener(PA,H),qF.remove(X)},0)}}},[k,F,H,X]);const re=L.useCallback(G=>{if(!m&&!y||X.paused)return;const J=G.key==="Tab"&&!G.altKey&&!G.ctrlKey&&!G.metaKey,te=document.activeElement;if(J&&te){const ne=G.currentTarget,[se,ae]=Wne(ne);se&&ae?!G.shiftKey&&te===ae?(G.preventDefault(),m&&Qd(se,{select:!0})):G.shiftKey&&te===se&&(G.preventDefault(),m&&Qd(ae,{select:!0})):te===ne&&G.preventDefault()}},[m,y,X.paused]);return v.jsx(nn.div,{tabIndex:-1,...P,ref:ee,onKeyDown:re})});LN.displayName=Fne;function Bne(l,{select:p=!1}={}){const m=document.activeElement;for(const y of l)if(Qd(y,{select:p}),document.activeElement!==m)return}function Wne(l){const p=x4(l),m=YF(p,l),y=YF(p.reverse(),l);return[m,y]}function x4(l){const p=[],m=document.createTreeWalker(l,NodeFilter.SHOW_ELEMENT,{acceptNode:y=>{const R=y.tagName==="INPUT"&&y.type==="hidden";return y.disabled||y.hidden||R?NodeFilter.FILTER_SKIP:y.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;m.nextNode();)p.push(m.currentNode);return p}function YF(l,p){for(const m of l)if(!Gne(m,{upTo:p}))return m}function Gne(l,{upTo:p}){if(getComputedStyle(l).visibility==="hidden")return!0;for(;l;){if(p!==void 0&&l===p)return!1;if(getComputedStyle(l).display==="none")return!0;l=l.parentElement}return!1}function Hne(l){return l instanceof HTMLInputElement&&"select"in l}function Qd(l,{select:p=!1}={}){if(l&&l.focus){const m=document.activeElement;l.focus({preventScroll:!0}),l!==m&&Hne(l)&&p&&l.select()}}var qF=Kne();function Kne(){let l=[];return{add(p){const m=l[0];p!==m&&m?.pause(),l=XF(l,p),l.unshift(p)},remove(p){l=XF(l,p),l[0]?.resume()}}}function XF(l,p){const m=[...l],y=m.indexOf(p);return y!==-1&&m.splice(y,1),m}function zne(l){return l.filter(p=>p.tagName!=="A")}var DA=0;function L4(){L.useEffect(()=>{const l=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",l[0]??JF()),document.body.insertAdjacentElement("beforeend",l[1]??JF()),DA++,()=>{DA===1&&document.querySelectorAll("[data-radix-focus-guard]").forEach(p=>p.remove()),DA--}},[])}function JF(){const l=document.createElement("span");return l.setAttribute("data-radix-focus-guard",""),l.tabIndex=0,l.style.outline="none",l.style.opacity="0",l.style.position="fixed",l.style.pointerEvents="none",l}var Vc=function(){return Vc=Object.assign||function(p){for(var m,y=1,R=arguments.length;y<R;y++){m=arguments[y];for(var C in m)Object.prototype.hasOwnProperty.call(m,C)&&(p[C]=m[C])}return p},Vc.apply(this,arguments)};function M4(l,p){var m={};for(var y in l)Object.prototype.hasOwnProperty.call(l,y)&&p.indexOf(y)<0&&(m[y]=l[y]);if(l!=null&&typeof Object.getOwnPropertySymbols=="function")for(var R=0,y=Object.getOwnPropertySymbols(l);R<y.length;R++)p.indexOf(y[R])<0&&Object.prototype.propertyIsEnumerable.call(l,y[R])&&(m[y[R]]=l[y[R]]);return m}function Yne(l,p,m){if(m||arguments.length===2)for(var y=0,R=p.length,C;y<R;y++)(C||!(y in p))&&(C||(C=Array.prototype.slice.call(p,0,y)),C[y]=p[y]);return l.concat(C||Array.prototype.slice.call(p))}var bR="right-scroll-bar-position",IR="width-before-scroll-bar",qne="with-scroll-bars-hidden",Xne="--removed-body-scroll-bar-size";function kA(l,p){return typeof l=="function"?l(p):l&&(l.current=p),l}function Jne(l,p){var m=L.useState(function(){return{value:l,callback:p,facade:{get current(){return m.value},set current(y){var R=m.value;R!==y&&(m.value=y,m.callback(y,R))}}}})[0];return m.callback=p,m.facade}var Qne=typeof window<"u"?L.useLayoutEffect:L.useEffect,QF=new WeakMap;function Zne(l,p){var m=Jne(null,function(y){return l.forEach(function(R){return kA(R,y)})});return Qne(function(){var y=QF.get(m);if(y){var R=new Set(y),C=new Set(l),P=m.current;R.forEach(function(k){C.has(k)||kA(k,null)}),C.forEach(function(k){R.has(k)||kA(k,P)})}QF.set(m,l)},[l]),m}function $ne(l){return l}function ere(l,p){p===void 0&&(p=$ne);var m=[],y=!1,R={read:function(){if(y)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return m.length?m[m.length-1]:l},useMedium:function(C){var P=p(C,y);return m.push(P),function(){m=m.filter(function(k){return k!==P})}},assignSyncMedium:function(C){for(y=!0;m.length;){var P=m;m=[],P.forEach(C)}m={push:function(k){return C(k)},filter:function(){return m}}},assignMedium:function(C){y=!0;var P=[];if(m.length){var k=m;m=[],k.forEach(C),P=m}var M=function(){var H=P;P=[],H.forEach(C)},F=function(){return Promise.resolve().then(M)};F(),m={push:function(H){P.push(H),F()},filter:function(H){return P=P.filter(H),m}}}};return R}function tre(l){l===void 0&&(l={});var p=ere(null);return p.options=Vc({async:!0,ssr:!1},l),p}var U4=function(l){var p=l.sideCar,m=M4(l,["sideCar"]);if(!p)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var y=p.read();if(!y)throw new Error("Sidecar medium not found");return L.createElement(y,Vc({},m))};U4.isSideCarExport=!0;function nre(l,p){return l.useMedium(p),U4}var j4=tre(),xA=function(){},nw=L.forwardRef(function(l,p){var m=L.useRef(null),y=L.useState({onScrollCapture:xA,onWheelCapture:xA,onTouchMoveCapture:xA}),R=y[0],C=y[1],P=l.forwardProps,k=l.children,M=l.className,F=l.removeScrollBar,H=l.enabled,K=l.shards,ee=l.sideCar,X=l.noRelative,re=l.noIsolation,G=l.inert,J=l.allowPinchZoom,te=l.as,ne=te===void 0?"div":te,se=l.gapMode,ae=M4(l,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noRelative","noIsolation","inert","allowPinchZoom","as","gapMode"]),pe=ee,Se=Zne([m,p]),Te=Vc(Vc({},ae),R);return L.createElement(L.Fragment,null,H&&L.createElement(pe,{sideCar:j4,removeScrollBar:F,shards:K,noRelative:X,noIsolation:re,inert:G,setCallbacks:C,allowPinchZoom:!!J,lockRef:m,gapMode:se}),P?L.cloneElement(L.Children.only(k),Vc(Vc({},Te),{ref:Se})):L.createElement(ne,Vc({},Te,{className:M,ref:Se}),k))});nw.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};nw.classNames={fullWidth:IR,zeroRight:bR};var rre=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function ire(){if(!document)return null;var l=document.createElement("style");l.type="text/css";var p=rre();return p&&l.setAttribute("nonce",p),l}function sre(l,p){l.styleSheet?l.styleSheet.cssText=p:l.appendChild(document.createTextNode(p))}function ore(l){var p=document.head||document.getElementsByTagName("head")[0];p.appendChild(l)}var are=function(){var l=0,p=null;return{add:function(m){l==0&&(p=ire())&&(sre(p,m),ore(p)),l++},remove:function(){l--,!l&&p&&(p.parentNode&&p.parentNode.removeChild(p),p=null)}}},cre=function(){var l=are();return function(p,m){L.useEffect(function(){return l.add(p),function(){l.remove()}},[p&&m])}},V4=function(){var l=cre(),p=function(m){var y=m.styles,R=m.dynamic;return l(y,R),null};return p},lre={left:0,top:0,right:0,gap:0},LA=function(l){return parseInt(l||"",10)||0},dre=function(l){var p=window.getComputedStyle(document.body),m=p[l==="padding"?"paddingLeft":"marginLeft"],y=p[l==="padding"?"paddingTop":"marginTop"],R=p[l==="padding"?"paddingRight":"marginRight"];return[LA(m),LA(y),LA(R)]},ure=function(l){if(l===void 0&&(l="margin"),typeof window>"u")return lre;var p=dre(l),m=document.documentElement.clientWidth,y=window.innerWidth;return{left:p[0],top:p[1],right:p[2],gap:Math.max(0,y-m+p[2]-p[0])}},hre=V4(),wm="data-scroll-locked",pre=function(l,p,m,y){var R=l.left,C=l.top,P=l.right,k=l.gap;return m===void 0&&(m="margin"),`
  .`.concat(qne,` {
   overflow: hidden `).concat(y,`;
   padding-right: `).concat(k,"px ").concat(y,`;
  }
  body[`).concat(wm,`] {
    overflow: hidden `).concat(y,`;
    overscroll-behavior: contain;
    `).concat([p&&"position: relative ".concat(y,";"),m==="margin"&&`
    padding-left: `.concat(R,`px;
    padding-top: `).concat(C,`px;
    padding-right: `).concat(P,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(k,"px ").concat(y,`;
    `),m==="padding"&&"padding-right: ".concat(k,"px ").concat(y,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(bR,` {
    right: `).concat(k,"px ").concat(y,`;
  }
  
  .`).concat(IR,` {
    margin-right: `).concat(k,"px ").concat(y,`;
  }
  
  .`).concat(bR," .").concat(bR,` {
    right: 0 `).concat(y,`;
  }
  
  .`).concat(IR," .").concat(IR,` {
    margin-right: 0 `).concat(y,`;
  }
  
  body[`).concat(wm,`] {
    `).concat(Xne,": ").concat(k,`px;
  }
`)},ZF=function(){var l=parseInt(document.body.getAttribute(wm)||"0",10);return isFinite(l)?l:0},fre=function(){L.useEffect(function(){return document.body.setAttribute(wm,(ZF()+1).toString()),function(){var l=ZF()-1;l<=0?document.body.removeAttribute(wm):document.body.setAttribute(wm,l.toString())}},[])},mre=function(l){var p=l.noRelative,m=l.noImportant,y=l.gapMode,R=y===void 0?"margin":y;fre();var C=L.useMemo(function(){return ure(R)},[R]);return L.createElement(hre,{styles:pre(C,!p,R,m?"":"!important")})},nN=!1;if(typeof window<"u")try{var ER=Object.defineProperty({},"passive",{get:function(){return nN=!0,!0}});window.addEventListener("test",ER,ER),window.removeEventListener("test",ER,ER)}catch{nN=!1}var Em=nN?{passive:!1}:!1,_re=function(l){return l.tagName==="TEXTAREA"},F4=function(l,p){if(!(l instanceof Element))return!1;var m=window.getComputedStyle(l);return m[p]!=="hidden"&&!(m.overflowY===m.overflowX&&!_re(l)&&m[p]==="visible")},gre=function(l){return F4(l,"overflowY")},Ere=function(l){return F4(l,"overflowX")},$F=function(l,p){var m=p.ownerDocument,y=p;do{typeof ShadowRoot<"u"&&y instanceof ShadowRoot&&(y=y.host);var R=B4(l,y);if(R){var C=W4(l,y),P=C[1],k=C[2];if(P>k)return!0}y=y.parentNode}while(y&&y!==m.body);return!1},vre=function(l){var p=l.scrollTop,m=l.scrollHeight,y=l.clientHeight;return[p,m,y]},yre=function(l){var p=l.scrollLeft,m=l.scrollWidth,y=l.clientWidth;return[p,m,y]},B4=function(l,p){return l==="v"?gre(p):Ere(p)},W4=function(l,p){return l==="v"?vre(p):yre(p)},Sre=function(l,p){return l==="h"&&p==="rtl"?-1:1},Tre=function(l,p,m,y,R){var C=Sre(l,window.getComputedStyle(p).direction),P=C*y,k=m.target,M=p.contains(k),F=!1,H=P>0,K=0,ee=0;do{if(!k)break;var X=W4(l,k),re=X[0],G=X[1],J=X[2],te=G-J-C*re;(re||te)&&B4(l,k)&&(K+=te,ee+=re);var ne=k.parentNode;k=ne&&ne.nodeType===Node.DOCUMENT_FRAGMENT_NODE?ne.host:ne}while(!M&&k!==document.body||M&&(p.contains(k)||p===k));return(H&&Math.abs(K)<1||!H&&Math.abs(ee)<1)&&(F=!0),F},vR=function(l){return"changedTouches"in l?[l.changedTouches[0].clientX,l.changedTouches[0].clientY]:[0,0]},eB=function(l){return[l.deltaX,l.deltaY]},tB=function(l){return l&&"current"in l?l.current:l},Rre=function(l,p){return l[0]===p[0]&&l[1]===p[1]},wre=function(l){return`
  .block-interactivity-`.concat(l,` {pointer-events: none;}
  .allow-interactivity-`).concat(l,` {pointer-events: all;}
`)},Cre=0,vm=[];function bre(l){var p=L.useRef([]),m=L.useRef([0,0]),y=L.useRef(),R=L.useState(Cre++)[0],C=L.useState(V4)[0],P=L.useRef(l);L.useEffect(function(){P.current=l},[l]),L.useEffect(function(){if(l.inert){document.body.classList.add("block-interactivity-".concat(R));var G=Yne([l.lockRef.current],(l.shards||[]).map(tB),!0).filter(Boolean);return G.forEach(function(J){return J.classList.add("allow-interactivity-".concat(R))}),function(){document.body.classList.remove("block-interactivity-".concat(R)),G.forEach(function(J){return J.classList.remove("allow-interactivity-".concat(R))})}}},[l.inert,l.lockRef.current,l.shards]);var k=L.useCallback(function(G,J){if("touches"in G&&G.touches.length===2||G.type==="wheel"&&G.ctrlKey)return!P.current.allowPinchZoom;var te=vR(G),ne=m.current,se="deltaX"in G?G.deltaX:ne[0]-te[0],ae="deltaY"in G?G.deltaY:ne[1]-te[1],pe,Se=G.target,Te=Math.abs(se)>Math.abs(ae)?"h":"v";if("touches"in G&&Te==="h"&&Se.type==="range")return!1;var Ue=$F(Te,Se);if(!Ue)return!0;if(Ue?pe=Te:(pe=Te==="v"?"h":"v",Ue=$F(Te,Se)),!Ue)return!1;if(!y.current&&"changedTouches"in G&&(se||ae)&&(y.current=pe),!pe)return!0;var tt=y.current||pe;return Tre(tt,J,G,tt==="h"?se:ae)},[]),M=L.useCallback(function(G){var J=G;if(!(!vm.length||vm[vm.length-1]!==C)){var te="deltaY"in J?eB(J):vR(J),ne=p.current.filter(function(pe){return pe.name===J.type&&(pe.target===J.target||J.target===pe.shadowParent)&&Rre(pe.delta,te)})[0];if(ne&&ne.should){J.cancelable&&J.preventDefault();return}if(!ne){var se=(P.current.shards||[]).map(tB).filter(Boolean).filter(function(pe){return pe.contains(J.target)}),ae=se.length>0?k(J,se[0]):!P.current.noIsolation;ae&&J.cancelable&&J.preventDefault()}}},[]),F=L.useCallback(function(G,J,te,ne){var se={name:G,delta:J,target:te,should:ne,shadowParent:Ire(te)};p.current.push(se),setTimeout(function(){p.current=p.current.filter(function(ae){return ae!==se})},1)},[]),H=L.useCallback(function(G){m.current=vR(G),y.current=void 0},[]),K=L.useCallback(function(G){F(G.type,eB(G),G.target,k(G,l.lockRef.current))},[]),ee=L.useCallback(function(G){F(G.type,vR(G),G.target,k(G,l.lockRef.current))},[]);L.useEffect(function(){return vm.push(C),l.setCallbacks({onScrollCapture:K,onWheelCapture:K,onTouchMoveCapture:ee}),document.addEventListener("wheel",M,Em),document.addEventListener("touchmove",M,Em),document.addEventListener("touchstart",H,Em),function(){vm=vm.filter(function(G){return G!==C}),document.removeEventListener("wheel",M,Em),document.removeEventListener("touchmove",M,Em),document.removeEventListener("touchstart",H,Em)}},[]);var X=l.removeScrollBar,re=l.inert;return L.createElement(L.Fragment,null,re?L.createElement(C,{styles:wre(R)}):null,X?L.createElement(mre,{noRelative:l.noRelative,gapMode:l.gapMode}):null)}function Ire(l){for(var p=null;l!==null;)l instanceof ShadowRoot&&(p=l.host,l=l.host),l=l.parentNode;return p}const Are=nre(j4,bre);var MN=L.forwardRef(function(l,p){return L.createElement(nw,Vc({},l,{ref:p,sideCar:Are}))});MN.classNames=nw.classNames;var Nre=function(l){if(typeof document>"u")return null;var p=Array.isArray(l)?l[0]:l;return p.ownerDocument.body},ym=new WeakMap,yR=new WeakMap,SR={},MA=0,G4=function(l){return l&&(l.host||G4(l.parentNode))},Ore=function(l,p){return p.map(function(m){if(l.contains(m))return m;var y=G4(m);return y&&l.contains(y)?y:(console.error("aria-hidden",m,"in not contained inside",l,". Doing nothing"),null)}).filter(function(m){return!!m})},Pre=function(l,p,m,y){var R=Ore(p,Array.isArray(l)?l:[l]);SR[m]||(SR[m]=new WeakMap);var C=SR[m],P=[],k=new Set,M=new Set(R),F=function(K){!K||k.has(K)||(k.add(K),F(K.parentNode))};R.forEach(F);var H=function(K){!K||M.has(K)||Array.prototype.forEach.call(K.children,function(ee){if(k.has(ee))H(ee);else try{var X=ee.getAttribute(y),re=X!==null&&X!=="false",G=(ym.get(ee)||0)+1,J=(C.get(ee)||0)+1;ym.set(ee,G),C.set(ee,J),P.push(ee),G===1&&re&&yR.set(ee,!0),J===1&&ee.setAttribute(m,"true"),re||ee.setAttribute(y,"true")}catch(te){console.error("aria-hidden: cannot operate on ",ee,te)}})};return H(p),k.clear(),MA++,function(){P.forEach(function(K){var ee=ym.get(K)-1,X=C.get(K)-1;ym.set(K,ee),C.set(K,X),ee||(yR.has(K)||K.removeAttribute(y),yR.delete(K)),X||K.removeAttribute(m)}),MA--,MA||(ym=new WeakMap,ym=new WeakMap,yR=new WeakMap,SR={})}},H4=function(l,p,m){m===void 0&&(m="data-aria-hidden");var y=Array.from(Array.isArray(l)?l:[l]),R=Nre(l);return R?(y.push.apply(y,Array.from(R.querySelectorAll("[aria-live]"))),Pre(y,R,m,"aria-hidden")):function(){return null}},rw="Dialog",[K4]=Hc(rw),[Dre,Wa]=K4(rw),z4=l=>{const{__scopeDialog:p,children:m,open:y,defaultOpen:R,onOpenChange:C,modal:P=!0}=l,k=L.useRef(null),M=L.useRef(null),[F,H]=Jh({prop:y,defaultProp:R??!1,onChange:C,caller:rw});return v.jsx(Dre,{scope:p,triggerRef:k,contentRef:M,contentId:tu(),titleId:tu(),descriptionId:tu(),open:F,onOpenChange:H,onOpenToggle:L.useCallback(()=>H(K=>!K),[H]),modal:P,children:m})};z4.displayName=rw;var Y4="DialogTrigger",q4=L.forwardRef((l,p)=>{const{__scopeDialog:m,...y}=l,R=Wa(Y4,m),C=or(p,R.triggerRef);return v.jsx(nn.button,{type:"button","aria-haspopup":"dialog","aria-expanded":R.open,"aria-controls":R.contentId,"data-state":VN(R.open),...y,ref:C,onClick:Ht(l.onClick,R.onOpenToggle)})});q4.displayName=Y4;var UN="DialogPortal",[kre,X4]=K4(UN,{forceMount:void 0}),J4=l=>{const{__scopeDialog:p,forceMount:m,children:y,container:R}=l,C=Wa(UN,p);return v.jsx(kre,{scope:p,forceMount:m,children:L.Children.map(y,P=>v.jsx(tp,{present:m||C.open,children:v.jsx(FR,{asChild:!0,container:R,children:P})}))})};J4.displayName=UN;var UR="DialogOverlay",Q4=L.forwardRef((l,p)=>{const m=X4(UR,l.__scopeDialog),{forceMount:y=m.forceMount,...R}=l,C=Wa(UR,l.__scopeDialog);return C.modal?v.jsx(tp,{present:y||C.open,children:v.jsx(Lre,{...R,ref:p})}):null});Q4.displayName=UR;var xre=Cm("DialogOverlay.RemoveScroll"),Lre=L.forwardRef((l,p)=>{const{__scopeDialog:m,...y}=l,R=Wa(UR,m);return v.jsx(MN,{as:xre,allowPinchZoom:!0,shards:[R.contentRef],children:v.jsx(nn.div,{"data-state":VN(R.open),...y,ref:p,style:{pointerEvents:"auto",...y.style}})})}),Zh="DialogContent",Z4=L.forwardRef((l,p)=>{const m=X4(Zh,l.__scopeDialog),{forceMount:y=m.forceMount,...R}=l,C=Wa(Zh,l.__scopeDialog);return v.jsx(tp,{present:y||C.open,children:C.modal?v.jsx(Mre,{...R,ref:p}):v.jsx(Ure,{...R,ref:p})})});Z4.displayName=Zh;var Mre=L.forwardRef((l,p)=>{const m=Wa(Zh,l.__scopeDialog),y=L.useRef(null),R=or(p,m.contentRef,y);return L.useEffect(()=>{const C=y.current;if(C)return H4(C)},[]),v.jsx($4,{...l,ref:R,trapFocus:m.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:Ht(l.onCloseAutoFocus,C=>{C.preventDefault(),m.triggerRef.current?.focus()}),onPointerDownOutside:Ht(l.onPointerDownOutside,C=>{const P=C.detail.originalEvent,k=P.button===0&&P.ctrlKey===!0;(P.button===2||k)&&C.preventDefault()}),onFocusOutside:Ht(l.onFocusOutside,C=>C.preventDefault())})}),Ure=L.forwardRef((l,p)=>{const m=Wa(Zh,l.__scopeDialog),y=L.useRef(!1),R=L.useRef(!1);return v.jsx($4,{...l,ref:p,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:C=>{l.onCloseAutoFocus?.(C),C.defaultPrevented||(y.current||m.triggerRef.current?.focus(),C.preventDefault()),y.current=!1,R.current=!1},onInteractOutside:C=>{l.onInteractOutside?.(C),C.defaultPrevented||(y.current=!0,C.detail.originalEvent.type==="pointerdown"&&(R.current=!0));const P=C.target;m.triggerRef.current?.contains(P)&&C.preventDefault(),C.detail.originalEvent.type==="focusin"&&R.current&&C.preventDefault()}})}),$4=L.forwardRef((l,p)=>{const{__scopeDialog:m,trapFocus:y,onOpenAutoFocus:R,onCloseAutoFocus:C,...P}=l,k=Wa(Zh,m),M=L.useRef(null),F=or(p,M);return L4(),v.jsxs(v.Fragment,{children:[v.jsx(LN,{asChild:!0,loop:!0,trapped:y,onMountAutoFocus:R,onUnmountAutoFocus:C,children:v.jsx(rv,{role:"dialog",id:k.contentId,"aria-describedby":k.descriptionId,"aria-labelledby":k.titleId,"data-state":VN(k.open),...P,ref:F,onDismiss:()=>k.onOpenChange(!1)})}),v.jsxs(v.Fragment,{children:[v.jsx(jre,{titleId:k.titleId}),v.jsx(Fre,{contentRef:M,descriptionId:k.descriptionId})]})]})}),jN="DialogTitle",e5=L.forwardRef((l,p)=>{const{__scopeDialog:m,...y}=l,R=Wa(jN,m);return v.jsx(nn.h2,{id:R.titleId,...y,ref:p})});e5.displayName=jN;var t5="DialogDescription",n5=L.forwardRef((l,p)=>{const{__scopeDialog:m,...y}=l,R=Wa(t5,m);return v.jsx(nn.p,{id:R.descriptionId,...y,ref:p})});n5.displayName=t5;var r5="DialogClose",i5=L.forwardRef((l,p)=>{const{__scopeDialog:m,...y}=l,R=Wa(r5,m);return v.jsx(nn.button,{type:"button",...y,ref:p,onClick:Ht(l.onClick,()=>R.onOpenChange(!1))})});i5.displayName=r5;function VN(l){return l?"open":"closed"}var s5="DialogTitleWarning",[qie,o5]=sJ(s5,{contentName:Zh,titleName:jN,docsSlug:"dialog"}),jre=({titleId:l})=>{const p=o5(s5),m=`\`${p.contentName}\` requires a \`${p.titleName}\` for the component to be accessible for screen reader users.

If you want to hide the \`${p.titleName}\`, you can wrap it with our VisuallyHidden component.

For more information, see https://radix-ui.com/primitives/docs/components/${p.docsSlug}`;return L.useEffect(()=>{l&&(document.getElementById(l)||console.error(m))},[m,l]),null},Vre="DialogDescriptionWarning",Fre=({contentRef:l,descriptionId:p})=>{const y=`Warning: Missing \`Description\` or \`aria-describedby={undefined}\` for {${o5(Vre).contentName}}.`;return L.useEffect(()=>{const R=l.current?.getAttribute("aria-describedby");p&&R&&(document.getElementById(p)||console.warn(y))},[y,l,p]),null},Bre=z4,Wre=q4,Gre=J4,a5=Q4,c5=Z4,l5=e5,d5=n5,Hre=i5;const Kre=Bre,zre=Wre,Yre=Gre,u5=L.forwardRef(({className:l,...p},m)=>v.jsx(a5,{ref:m,className:gn("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",l),...p}));u5.displayName=a5.displayName;const h5=L.forwardRef(({className:l,children:p,...m},y)=>v.jsxs(Yre,{children:[v.jsx(u5,{}),v.jsxs(c5,{ref:y,className:gn("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",l),...m,children:[p,v.jsxs(Hre,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity data-[state=open]:bg-accent data-[state=open]:text-muted-foreground hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none",children:[v.jsx(GB,{className:"h-4 w-4"}),v.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));h5.displayName=c5.displayName;const p5=({className:l,...p})=>v.jsx("div",{className:gn("flex flex-col space-y-1.5 text-center sm:text-left",l),...p});p5.displayName="DialogHeader";const f5=({className:l,...p})=>v.jsx("div",{className:gn("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",l),...p});f5.displayName="DialogFooter";const m5=L.forwardRef(({className:l,...p},m)=>v.jsx(l5,{ref:m,className:gn("text-lg font-semibold leading-none tracking-tight",l),...p}));m5.displayName=l5.displayName;const _5=L.forwardRef(({className:l,...p},m)=>v.jsx(d5,{ref:m,className:gn("text-sm text-muted-foreground",l),...p}));_5.displayName=d5.displayName;var qre="Label",g5=L.forwardRef((l,p)=>v.jsx(nn.label,{...l,ref:p,onMouseDown:m=>{m.target.closest("button, input, select, textarea")||(l.onMouseDown?.(m),!m.defaultPrevented&&m.detail>1&&m.preventDefault())}}));g5.displayName=qre;var E5=g5;const Xre=GR("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),WE=L.forwardRef(({className:l,...p},m)=>v.jsx(E5,{ref:m,className:gn(Xre(),l),...p}));WE.displayName=E5.displayName;function Jre(){const[l,p]=L.useState(""),[m,y]=L.useState([]),[R,C]=L.useState([]),[P,k]=L.useState(!0),[M,F]=L.useState(!1),[H,K]=L.useState(!1),[ee,X]=L.useState({name:"",description:"",icon:"🏠",gradient:"bg-gradient-to-br from-blue-500 to-purple-600"}),{toast:re}=Gc();L.useEffect(()=>{(async()=>{try{const pe=await R4();y(pe),C(pe)}catch(pe){console.error("Failed to load rooms:",pe)}finally{k(!1)}})()},[]);const G=ae=>{p(ae),ae.trim()===""?C(m):C(m.filter(pe=>pe.name.toLowerCase().includes(ae.toLowerCase())||pe.description.toLowerCase().includes(ae.toLowerCase())))},J=m.filter(ae=>ae.isTrending),te=async()=>{if(!ee.name.trim()||!ee.description.trim()){re({title:"Error",description:"Please fill in all required fields",variant:"destructive"});return}K(!0);try{const ae=await vne(ee);y(pe=>[ae,...pe]),C(pe=>[ae,...pe]),F(!1),X({name:"",description:"",icon:"🏠",gradient:"bg-gradient-to-br from-blue-500 to-purple-600"}),re({title:"Success",description:`Room "${ae.name}" created successfully!`})}catch(ae){console.error("Failed to create room:",ae),re({title:"Error",description:ae instanceof Error?ae.message:"Failed to create room",variant:"destructive"})}finally{K(!1)}},ne=["🏠","🎬","🎵","🎮","📚","💻","🏃","🍕","✈️","🎨","🔬","💡","🌟","🔥","💎"],se=["bg-gradient-to-br from-blue-500 to-purple-600","bg-gradient-to-br from-pink-500 to-rose-600","bg-gradient-to-br from-green-500 to-emerald-600","bg-gradient-to-br from-orange-500 to-red-600","bg-gradient-to-br from-purple-500 to-indigo-600","bg-gradient-to-br from-teal-500 to-cyan-600","bg-gradient-to-br from-yellow-500 to-orange-600","bg-gradient-to-br from-red-500 to-pink-600"];return v.jsxs("div",{className:"min-h-screen bg-background pb-20 md:pb-8",children:[v.jsx(Xh,{}),v.jsx("main",{className:"container mx-auto px-4 pt-20 max-w-4xl",children:v.jsxs("div",{className:"space-y-8",children:[v.jsxs("div",{className:"text-center space-y-4 animate-fade-in",children:[v.jsx("h1",{className:"text-3xl font-bold gradient-primary bg-clip-text text-transparent",children:"Topic Rooms"}),v.jsx("p",{className:"text-muted-foreground max-w-2xl mx-auto",children:"Join themed rooms where the tea flows freely. Each room has its own vibe and community."})]}),v.jsxs("div",{className:"relative max-w-md mx-auto animate-slide-in-right",children:[v.jsx(jB,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),v.jsx(ea,{placeholder:"Search rooms...",value:l,onChange:ae=>G(ae.target.value),className:"pl-10"})]}),P&&v.jsxs("div",{className:"text-center py-12",children:[v.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto"}),v.jsx("p",{className:"mt-2 text-sm text-muted-foreground",children:"Loading rooms..."})]}),!P&&l===""&&v.jsxs("section",{className:"animate-slide-in-right",style:{animationDelay:"0.1s"},children:[v.jsxs("div",{className:"flex items-center space-x-2 mb-4",children:[v.jsx(zE,{className:"h-5 w-5 text-accent"}),v.jsx("h2",{className:"text-xl font-semibold",children:"Trending Now"})]}),v.jsx("div",{className:"grid md:grid-cols-3 gap-4",children:J.map((ae,pe)=>v.jsx(An,{className:"tea-card hover-lift cursor-pointer group",style:{animationDelay:`${pe*.1}s`},children:v.jsxs(jr,{to:`/rooms/${ae.id}`,children:[v.jsxs(Ir,{className:"pb-3",children:[v.jsxs("div",{className:"flex items-center justify-between",children:[v.jsx("div",{className:`w-12 h-12 ${ae.gradient} rounded-full flex items-center justify-center text-2xl shadow-glow`,children:ae.icon}),v.jsxs(su,{variant:"secondary",className:"bg-accent/20 text-accent border-accent/30",children:[v.jsx(zE,{className:"h-3 w-3 mr-1"}),"Hot"]})]}),v.jsx(Pi,{className:"text-lg group-hover:text-primary transition-colors",children:ae.name})]}),v.jsxs(Dn,{children:[v.jsx(Bs,{className:"text-sm mb-4",children:ae.description}),v.jsxs("div",{className:"flex items-center justify-between text-xs text-muted-foreground",children:[v.jsxs("div",{className:"flex items-center space-x-1",children:[v.jsx(WB,{className:"h-3 w-3"}),v.jsx("span",{children:ae.memberCount.toLocaleString()})]}),v.jsxs("div",{className:"flex items-center space-x-1",children:[v.jsx(bm,{className:"h-3 w-3"}),v.jsx("span",{children:ae.lastActivity?new Date(ae.lastActivity).toLocaleDateString():"No activity"})]})]}),v.jsx("div",{className:"mt-3 p-2 bg-muted/50 rounded-lg",children:v.jsxs("div",{className:"text-xs font-medium text-accent",children:[ae.recentPostCount," posts today"]})})]})]})},ae.id))})]}),!P&&v.jsxs("section",{className:"animate-slide-in-right",style:{animationDelay:"0.2s"},children:[v.jsxs("div",{className:"flex items-center justify-between mb-6",children:[v.jsx("h2",{className:"text-xl font-semibold",children:l?`Search Results (${R.length})`:"All Rooms"}),v.jsxs(Kre,{open:M,onOpenChange:F,children:[v.jsx(zre,{asChild:!0,children:v.jsxs(At,{className:"spill-button hover-scale",children:[v.jsx(WA,{className:"h-4 w-4 mr-2"}),"Create Room"]})}),v.jsxs(h5,{className:"sm:max-w-[425px]",children:[v.jsxs(p5,{children:[v.jsx(m5,{children:"Create New Room"}),v.jsx(_5,{children:"Create a new topic room where people can share tea and connect."})]}),v.jsxs("div",{className:"grid gap-4 py-4",children:[v.jsxs("div",{className:"grid gap-2",children:[v.jsx(WE,{htmlFor:"name",children:"Room Name *"}),v.jsx(ea,{id:"name",value:ee.name,onChange:ae=>X(pe=>({...pe,name:ae.target.value})),placeholder:"Enter room name..."})]}),v.jsxs("div",{className:"grid gap-2",children:[v.jsx(WE,{htmlFor:"description",children:"Description *"}),v.jsx(nv,{id:"description",value:ee.description,onChange:ae=>X(pe=>({...pe,description:ae.target.value})),placeholder:"Describe what this room is about...",rows:3})]}),v.jsxs("div",{className:"grid gap-2",children:[v.jsx(WE,{children:"Room Icon"}),v.jsx("div",{className:"flex flex-wrap gap-2",children:ne.map(ae=>v.jsx(At,{variant:ee.icon===ae?"default":"outline",size:"sm",onClick:()=>X(pe=>({...pe,icon:ae})),className:"w-10 h-10 p-0",children:ae},ae))})]}),v.jsxs("div",{className:"grid gap-2",children:[v.jsx(WE,{children:"Room Theme"}),v.jsx("div",{className:"grid grid-cols-4 gap-2",children:se.map(ae=>v.jsx(At,{variant:"outline",size:"sm",onClick:()=>X(pe=>({...pe,gradient:ae})),className:`h-12 p-0 ${ae} ${ee.gradient===ae?"ring-2 ring-primary":""}`,children:v.jsx("div",{className:"w-full h-full rounded flex items-center justify-center text-white text-lg",children:ee.icon})},ae))})]})]}),v.jsxs(f5,{children:[v.jsx(At,{variant:"outline",onClick:()=>F(!1),children:"Cancel"}),v.jsx(At,{onClick:te,disabled:H,className:"spill-button",children:H?"Creating...":"Create Room"})]})]})]})]}),v.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-6",children:R.map((ae,pe)=>v.jsx(An,{className:"tea-card hover-lift cursor-pointer group",style:{animationDelay:`${pe*.05}s`},children:v.jsxs(jr,{to:`/rooms/${ae.id}`,children:[v.jsxs(Ir,{className:"pb-4",children:[v.jsxs("div",{className:"flex items-start justify-between",children:[v.jsx("div",{className:`w-14 h-14 ${ae.gradient} rounded-xl flex items-center justify-center text-3xl shadow-glow group-hover:animate-bounce-subtle`,children:ae.icon}),ae.trending&&v.jsxs(su,{variant:"secondary",className:"bg-accent/20 text-accent border-accent/30",children:[v.jsx(zE,{className:"h-3 w-3 mr-1"}),"Hot"]})]}),v.jsxs("div",{className:"space-y-2",children:[v.jsx(Pi,{className:"text-lg group-hover:text-primary transition-colors",children:ae.name}),v.jsx(Bs,{className:"text-sm line-clamp-2",children:ae.description})]})]}),v.jsxs(Dn,{className:"space-y-4",children:[v.jsxs("div",{className:"grid grid-cols-2 gap-4 text-center",children:[v.jsxs("div",{className:"space-y-1",children:[v.jsx("div",{className:"text-lg font-semibold text-primary",children:ae.memberCount.toLocaleString()}),v.jsx("div",{className:"text-xs text-muted-foreground",children:"Members"})]}),v.jsxs("div",{className:"space-y-1",children:[v.jsx("div",{className:"text-lg font-semibold text-accent",children:ae.recentPostCount}),v.jsx("div",{className:"text-xs text-muted-foreground",children:"Posts Today"})]})]}),v.jsxs("div",{className:"flex items-center justify-between text-xs text-muted-foreground pt-2 border-t border-border",children:[v.jsxs("div",{className:"flex items-center space-x-1",children:[v.jsx(bm,{className:"h-3 w-3"}),v.jsxs("span",{children:["Active ",ae.lastActivity?new Date(ae.lastActivity).toLocaleDateString():"Never"]})]}),v.jsx(BA,{className:"h-4 w-4 opacity-0 group-hover:opacity-100 transition-opacity"})]})]})]})},ae.id))}),R.length===0&&v.jsxs("div",{className:"text-center py-12",children:[v.jsx("div",{className:"text-4xl mb-4",children:"🔍"}),v.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No rooms found"}),v.jsx("p",{className:"text-muted-foreground",children:"Try searching for different keywords or browse all rooms above."})]})]}),!P&&l===""&&v.jsx(An,{className:"tea-card gradient-hero text-center text-white animate-fade-in",style:{animationDelay:"0.3s"},children:v.jsxs(Dn,{className:"py-8",children:[v.jsx("h3",{className:"text-xl font-semibold mb-2",children:"Can't find your vibe?"}),v.jsx("p",{className:"text-white/90 mb-6",children:"Suggest a new topic room and help grow the TeaTok community"}),v.jsx(At,{variant:"secondary",className:"hover-scale shadow-soft",children:"Suggest a Room"})]})})]})})]})}function Qre(){const{roomId:l}=vte(),[p,m]=L.useState(null),[y,R]=L.useState([]),[C,P]=L.useState(!0),[k,M]=L.useState(null),[F,H]=L.useState({}),{toast:K}=Gc();L.useEffect(()=>{const G=localStorage.getItem("user");if(G)try{const J=JSON.parse(G);M(J);const te=localStorage.getItem(`userReactions_${J.id}`);te&&H(JSON.parse(te))}catch(J){console.error("Error parsing user data:",J)}},[]),L.useEffect(()=>{(async()=>{if(l)try{P(!0);const[J,te]=await Promise.all([Ene(l),y4(l)]);m(J);const ne=await Promise.all(te.map(async se=>{try{const ae=await MR(se.id,k?.id);return{...se,reactions:ae.reactions,replies:0,userReaction:ae.userReaction?.reactionType}}catch(ae){return console.error("Error loading reactions for post:",se.id,ae),{...se,reactions:{tea:0,spicy:0,cap:0,hearts:0},replies:0,userReaction:void 0}}}));R(ne)}catch(J){console.error("Failed to load room data:",J),K({title:"Error",description:"Failed to load room data",variant:"destructive"})}finally{P(!1)}})()},[l,k?.id,K]);const ee=async(G,J)=>{if(!k)return;const te=F[G];try{te===J?(await tN(G,k.id,J),H(se=>{const ae={...se};return delete ae[G],ae})):(te&&await tN(G,k.id,te),await w4(G,k.id,J),H(se=>({...se,[G]:J})));const ne=await MR(G,k.id);R(se=>se.map(ae=>ae.id===G?{...ae,reactions:ne.reactions,userReaction:ne.userReaction?.reactionType}:ae))}catch(ne){console.error("Error handling reaction:",ne),K({title:"Error",description:"Failed to update reaction",variant:"destructive"})}},X=async G=>{if(k)try{await S4(G,k.id),R(J=>J.filter(te=>te.id!==G)),K({title:"Success",description:"Post deleted successfully"})}catch(J){console.error("Error deleting post:",J),K({title:"Error",description:J instanceof Error?J.message:"Failed to delete post",variant:"destructive"})}},re=G=>{const J=new Date(G),ne=Math.floor((new Date().getTime()-J.getTime())/1e3);return ne<60?"Just now":ne<3600?`${Math.floor(ne/60)}m ago`:ne<86400?`${Math.floor(ne/3600)}h ago`:`${Math.floor(ne/86400)}d ago`};return C?v.jsxs("div",{className:"min-h-screen bg-background pb-20 md:pb-8",children:[v.jsx(Xh,{}),v.jsx("main",{className:"container mx-auto px-4 pt-20 max-w-4xl",children:v.jsxs("div",{className:"text-center py-12",children:[v.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto"}),v.jsx("p",{className:"mt-2 text-sm text-muted-foreground",children:"Loading room..."})]})})]}):p?v.jsxs("div",{className:"min-h-screen bg-background pb-20 md:pb-8",children:[v.jsx(Xh,{}),v.jsx("main",{className:"container mx-auto px-4 pt-20 max-w-4xl",children:v.jsxs("div",{className:"space-y-6",children:[v.jsx(jr,{to:"/rooms",children:v.jsxs(At,{variant:"ghost",className:"mb-4",children:[v.jsx(qE,{className:"h-4 w-4 mr-2"}),"Back to Rooms"]})}),v.jsxs(An,{className:"tea-card animate-fade-in",children:[v.jsx(Ir,{children:v.jsxs("div",{className:"flex items-start justify-between",children:[v.jsxs("div",{className:"flex items-center space-x-4",children:[v.jsx("div",{className:`w-16 h-16 ${p.gradient} rounded-xl flex items-center justify-center text-4xl shadow-glow`,children:p.icon}),v.jsxs("div",{children:[v.jsx(Pi,{className:"text-2xl",children:p.name}),v.jsx(Bs,{className:"text-base mt-2",children:p.description})]})]}),p.isTrending&&v.jsxs(su,{variant:"secondary",className:"bg-accent/20 text-accent border-accent/30",children:[v.jsx(zE,{className:"h-3 w-3 mr-1"}),"Trending"]})]})}),v.jsx(Dn,{children:v.jsxs("div",{className:"grid grid-cols-3 gap-4 text-center",children:[v.jsxs("div",{children:[v.jsx("div",{className:"text-2xl font-bold text-primary",children:p.memberCount}),v.jsx("div",{className:"text-sm text-muted-foreground",children:"Members"})]}),v.jsxs("div",{children:[v.jsx("div",{className:"text-2xl font-bold text-accent",children:y.length}),v.jsx("div",{className:"text-sm text-muted-foreground",children:"Posts"})]}),v.jsxs("div",{children:[v.jsx("div",{className:"text-2xl font-bold text-tea-orange",children:p.recentPostCount}),v.jsx("div",{className:"text-sm text-muted-foreground",children:"Today"})]})]})})]}),v.jsx("div",{className:"space-y-4",children:y.length===0?v.jsx(An,{className:"tea-card text-center py-12",children:v.jsxs(Dn,{children:[v.jsx("div",{className:"text-4xl mb-4",children:"☕"}),v.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No posts yet"}),v.jsx("p",{className:"text-muted-foreground mb-4",children:"Be the first to spill some tea in this room!"}),v.jsx(jr,{to:"/create",children:v.jsx(At,{className:"spill-button",children:"Create First Post"})})]})}):y.map((G,J)=>v.jsxs(An,{className:"tea-card animate-slide-in-right",style:{animationDelay:`${J*.1}s`},children:[v.jsx(Ir,{className:"pb-3",children:v.jsxs("div",{className:"flex items-center justify-between",children:[v.jsxs("div",{className:"flex items-center space-x-3",children:[v.jsx($d,{className:"w-10 h-10",children:v.jsx(eu,{className:"gradient-primary text-white text-sm font-bold",children:G.author.alias?G.author.alias.charAt(0):G.author.name.charAt(0)})}),v.jsxs("div",{children:[v.jsx("div",{className:"font-semibold text-sm",children:G.author.alias||G.author.name}),v.jsx("div",{className:"text-xs text-muted-foreground",children:re(G.createdAt)})]})]}),v.jsxs("div",{className:"flex items-center space-x-2",children:[v.jsx(su,{variant:"secondary",children:G.category}),G.authorId===k?.id&&v.jsx(At,{variant:"ghost",size:"sm",onClick:()=>X(G.id),className:"h-8 w-8 p-0 text-muted-foreground hover:text-destructive",children:v.jsx(XE,{className:"h-4 w-4"})})]})]})}),v.jsxs(Dn,{className:"space-y-4",children:[v.jsx("h3",{className:"font-semibold text-lg",children:G.title}),v.jsx("p",{className:"text-sm leading-relaxed",children:G.content}),v.jsxs("div",{className:"flex items-center justify-between pt-4 border-t border-border",children:[v.jsxs("div",{className:"flex items-center space-x-4",children:[v.jsxs(At,{variant:"ghost",size:"sm",onClick:()=>ee(G.id,"tea"),className:`flex items-center space-x-1 ${F[G.id]==="tea"?"text-tea-orange":"text-muted-foreground"}`,children:[v.jsx("span",{children:"☕"}),v.jsx("span",{children:G.reactions.tea})]}),v.jsxs(At,{variant:"ghost",size:"sm",onClick:()=>ee(G.id,"spicy"),className:`flex items-center space-x-1 ${F[G.id]==="spicy"?"text-red-500":"text-muted-foreground"}`,children:[v.jsx("span",{children:"🌶️"}),v.jsx("span",{children:G.reactions.spicy})]}),v.jsxs(At,{variant:"ghost",size:"sm",onClick:()=>ee(G.id,"cap"),className:`flex items-center space-x-1 ${F[G.id]==="cap"?"text-yellow-500":"text-muted-foreground"}`,children:[v.jsx("span",{children:"🧢"}),v.jsx("span",{children:G.reactions.cap})]}),v.jsxs(At,{variant:"ghost",size:"sm",onClick:()=>ee(G.id,"hearts"),className:`flex items-center space-x-1 ${F[G.id]==="hearts"?"text-pink-500":"text-muted-foreground"}`,children:[v.jsx("span",{children:"❤️"}),v.jsx("span",{children:G.reactions.hearts})]})]}),v.jsxs("div",{className:"flex items-center space-x-4 text-sm text-muted-foreground",children:[v.jsxs("div",{className:"flex items-center space-x-1",children:[v.jsx(Im,{className:"h-4 w-4"}),v.jsx("span",{children:G.replies})]}),v.jsx(At,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",children:v.jsx(VB,{className:"h-4 w-4"})})]})]})]})]},G.id))})]})})]}):v.jsxs("div",{className:"min-h-screen bg-background pb-20 md:pb-8",children:[v.jsx(Xh,{}),v.jsx("main",{className:"container mx-auto px-4 pt-20 max-w-4xl",children:v.jsxs("div",{className:"text-center py-12",children:[v.jsx("h1",{className:"text-2xl font-bold mb-4",children:"Room not found"}),v.jsx("p",{className:"text-muted-foreground mb-6",children:"The room you're looking for doesn't exist."}),v.jsx(jr,{to:"/rooms",children:v.jsxs(At,{className:"spill-button",children:[v.jsx(qE,{className:"h-4 w-4 mr-2"}),"Back to Rooms"]})})]})})]})}function Zre(){const[l,p]=L.useState("The Campus Oracle"),[m,y]=L.useState(!1),[R,C]=L.useState(null),[P,k]=L.useState(null),[M,F]=L.useState([]),[H,K]=L.useState([]),[ee,X]=L.useState(!0),{toast:re}=Gc();L.useEffect(()=>{const te=localStorage.getItem("user");if(te)try{const ne=JSON.parse(te);C(ne),p(ne.alias||ne.name)}catch(ne){console.error("Error parsing user data:",ne)}},[]),L.useEffect(()=>{(async()=>{if(R)try{X(!0);const[ne,se,ae]=await Promise.all([Sne(R.id),yne(R.id),Tne(R.id)]);k(ne),F(se),K(ae)}catch(ne){console.error("Failed to load user data:",ne),re({title:"Error",description:"Failed to load profile data",variant:"destructive"})}finally{X(!1)}})()},[R,re]);const G=P||{totalPosts:0,totalReactions:0,topCategory:"General",memberSince:"Unknown",streak:0,averageReactions:0},J=te=>{switch(te){case"legendary":return"gradient-primary";case"rare":return"gradient-accent";case"common":return"gradient-warm";default:return"bg-muted"}};return v.jsxs("div",{className:"min-h-screen bg-background pb-20 md:pb-8",children:[v.jsx(Xh,{}),v.jsx("main",{className:"container mx-auto px-4 pt-20 max-w-4xl",children:v.jsxs("div",{className:"space-y-8",children:[v.jsx(An,{className:"tea-card animate-fade-in",children:v.jsx(Ir,{className:"text-center",children:v.jsxs("div",{className:"flex flex-col items-center space-y-4",children:[v.jsx($d,{className:"w-24 h-24",children:v.jsx(eu,{className:"gradient-primary text-white text-2xl font-bold",children:l.charAt(0)})}),v.jsxs("div",{className:"space-y-2",children:[m?v.jsxs("div",{className:"flex items-center space-x-2",children:[v.jsx("input",{type:"text",value:l,onChange:te=>p(te.target.value),className:"text-2xl font-bold bg-transparent border-b border-border focus:outline-none focus:border-primary text-center"}),v.jsx(At,{size:"sm",onClick:()=>y(!1),className:"spill-button",children:"Save"})]}):v.jsxs("div",{className:"flex items-center space-x-2",children:[v.jsx("h1",{className:"text-2xl font-bold",children:l}),v.jsx(At,{size:"icon",variant:"ghost",onClick:()=>y(!0),className:"h-8 w-8 hover-scale",children:v.jsx(lQ,{className:"h-4 w-4"})})]}),v.jsxs("div",{className:"flex items-center justify-center space-x-4 text-sm text-muted-foreground",children:[v.jsxs("div",{className:"flex items-center space-x-1",children:[v.jsx(HR,{className:"h-4 w-4"}),v.jsxs("span",{children:["Anonymous ID: #",R?.anonymousId||"T3A7OK"]})]}),v.jsxs("div",{className:"flex items-center space-x-1",children:[v.jsx(LB,{className:"h-4 w-4"}),v.jsxs("span",{children:["Since ",G.memberSince]})]})]})]})]})})}),v.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 animate-slide-in-right",children:[v.jsx(An,{className:"tea-card text-center",children:v.jsxs(Dn,{className:"p-4",children:[v.jsx("div",{className:"text-2xl font-bold text-primary",children:G.totalPosts}),v.jsx("div",{className:"text-sm text-muted-foreground",children:"Posts Spilled"})]})}),v.jsx(An,{className:"tea-card text-center",children:v.jsxs(Dn,{className:"p-4",children:[v.jsx("div",{className:"text-2xl font-bold text-accent",children:G.totalReactions.toLocaleString()}),v.jsx("div",{className:"text-sm text-muted-foreground",children:"Total Reactions"})]})}),v.jsx(An,{className:"tea-card text-center",children:v.jsxs(Dn,{className:"p-4",children:[v.jsx("div",{className:"text-2xl font-bold text-tea-orange",children:G.streak}),v.jsx("div",{className:"text-sm text-muted-foreground",children:"Day Streak"})]})}),v.jsx(An,{className:"tea-card text-center",children:v.jsxs(Dn,{className:"p-4",children:[v.jsx("div",{className:"text-sm font-bold text-tea-pink",children:G.topCategory}),v.jsx("div",{className:"text-sm text-muted-foreground",children:"Top Category"})]})})]}),v.jsxs(kN,{defaultValue:"badges",className:"animate-slide-in-right",style:{animationDelay:"0.1s"},children:[v.jsxs(tw,{className:"grid w-full grid-cols-3",children:[v.jsx(ru,{value:"badges",children:"Badges"}),v.jsx(ru,{value:"posts",children:"My Posts"}),v.jsx(ru,{value:"activity",children:"Activity"})]}),v.jsx(iu,{value:"badges",className:"space-y-6",children:ee?v.jsxs("div",{className:"text-center py-8",children:[v.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto"}),v.jsx("p",{className:"mt-2 text-sm text-muted-foreground",children:"Loading badges..."})]}):v.jsx("div",{className:"grid md:grid-cols-2 gap-4",children:H.map((te,ne)=>v.jsxs(An,{className:`tea-card ${te.earned?"shadow-glow":te.meetsRequirements?"border-accent/50":"opacity-60"}`,style:{animationDelay:`${ne*.1}s`},children:[v.jsx(Ir,{className:"pb-3",children:v.jsxs("div",{className:"flex items-center space-x-4",children:[v.jsx("div",{className:`w-12 h-12 ${J(te.rarity)} rounded-full flex items-center justify-center text-2xl shadow-glow`,children:te.icon}),v.jsxs("div",{className:"flex-1",children:[v.jsxs(Pi,{className:"text-lg flex items-center space-x-2",children:[v.jsx("span",{children:te.name}),te.earned&&v.jsx($J,{className:"h-4 w-4 text-accent"})]}),v.jsx(su,{variant:"secondary",className:`text-xs ${J(te.rarity)} text-white border-0`,children:te.rarity})]})]})}),v.jsxs(Dn,{children:[v.jsx(Bs,{children:te.description}),te.earned?v.jsxs("div",{className:"mt-3 text-xs text-accent",children:["Earned on ",new Date(te.earnedAt).toLocaleDateString()]}):te.meetsRequirements?v.jsx("div",{className:"mt-3 text-xs text-accent",children:"Ready to earn! Check your activity."}):v.jsxs("div",{className:"mt-3 text-xs text-muted-foreground",children:["Requirements: ",te.requirements.postsRequired>0&&`${te.requirements.postsRequired} posts`,te.requirements.reactionsRequired>0&&`, ${te.requirements.reactionsRequired} reactions`,te.requirements.daysActive>0&&`, ${te.requirements.daysActive} days active`,te.requirements.category&&`, ${te.requirements.category} posts`]})]})]},te.id))})}),v.jsx(iu,{value:"posts",className:"space-y-4",children:ee?v.jsxs("div",{className:"text-center py-8",children:[v.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto"}),v.jsx("p",{className:"mt-2 text-sm text-muted-foreground",children:"Loading posts..."})]}):M.length===0?v.jsx(An,{className:"tea-card text-center py-12",children:v.jsxs(Dn,{children:[v.jsx("div",{className:"text-4xl mb-4",children:"☕"}),v.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No posts yet"}),v.jsx("p",{className:"text-muted-foreground mb-4",children:"Start spilling some tea to see your posts here!"})]})}):M.map((te,ne)=>v.jsxs(An,{className:"tea-card",style:{animationDelay:`${ne*.1}s`},children:[v.jsx(Ir,{className:"pb-3",children:v.jsxs("div",{className:"flex items-center justify-between",children:[v.jsxs("div",{className:"flex items-center space-x-2",children:[v.jsx(su,{variant:"secondary",children:te.category}),v.jsx(su,{variant:"default",className:"bg-accent text-accent-foreground",children:"Active"})]}),v.jsxs("div",{className:"flex items-center space-x-1 text-sm text-muted-foreground",children:[v.jsx(bm,{className:"h-4 w-4"}),v.jsx("span",{children:new Date(te.createdAt).toLocaleDateString()})]})]})}),v.jsxs(Dn,{className:"space-y-4",children:[v.jsx("h3",{className:"font-semibold text-lg",children:te.title}),v.jsx("p",{className:"text-sm leading-relaxed",children:te.content}),v.jsxs("div",{className:"flex items-center justify-between text-sm",children:[v.jsxs("div",{className:"flex items-center space-x-4",children:[v.jsxs("div",{className:"flex items-center space-x-1 text-accent",children:[v.jsx(zE,{className:"h-4 w-4"}),v.jsx("span",{children:"0"})]}),v.jsxs("div",{className:"flex items-center space-x-1 text-muted-foreground",children:[v.jsx(Im,{className:"h-4 w-4"}),v.jsx("span",{children:"0"})]})]}),v.jsx(At,{variant:"ghost",size:"sm",className:"hover-scale",children:"View Post"})]})]})]},te.id))}),v.jsxs(iu,{value:"activity",className:"space-y-6",children:[v.jsxs(An,{className:"tea-card",children:[v.jsxs(Ir,{children:[v.jsx(Pi,{children:"Weekly Activity"}),v.jsx(Bs,{children:"Your tea-spilling patterns"})]}),v.jsx(Dn,{children:v.jsxs("div",{className:"space-y-4",children:[v.jsxs("div",{className:"flex items-center justify-between",children:[v.jsx("span",{className:"text-sm",children:"Most Active Time"}),v.jsx("span",{className:"text-sm font-medium",children:"9-11 PM"})]}),v.jsxs("div",{className:"flex items-center justify-between",children:[v.jsx("span",{className:"text-sm",children:"Favorite Room"}),v.jsx("span",{className:"text-sm font-medium",children:G.topCategory})]}),v.jsxs("div",{className:"flex items-center justify-between",children:[v.jsx("span",{className:"text-sm",children:"Average Reactions per Post"}),v.jsx("span",{className:"text-sm font-medium",children:G.averageReactions})]}),v.jsxs("div",{className:"flex items-center justify-between",children:[v.jsx("span",{className:"text-sm",children:"Reply Rate"}),v.jsx("span",{className:"text-sm font-medium",children:"68%"})]})]})})]}),v.jsx(An,{className:"tea-card gradient-hero text-white",children:v.jsxs(Dn,{className:"p-6 text-center",children:[v.jsx("h3",{className:"text-xl font-semibold mb-2",children:"Keep the Tea Flowing!"}),v.jsxs("p",{className:"text-white/90 mb-4",children:["You're doing great! Your posts generate ",G.averageReactions," average reactions."]}),v.jsx(At,{variant:"secondary",className:"hover-scale shadow-soft",children:"Spill More Tea"})]})})]})]})]})})]})}function v5(l){const p=L.useRef({value:l,previous:l});return L.useMemo(()=>(p.current.value!==l&&(p.current.previous=p.current.value,p.current.value=l),p.current.previous),[l])}var iw="Switch",[$re]=Hc(iw),[eie,tie]=$re(iw),y5=L.forwardRef((l,p)=>{const{__scopeSwitch:m,name:y,checked:R,defaultChecked:C,required:P,disabled:k,value:M="on",onCheckedChange:F,form:H,...K}=l,[ee,X]=L.useState(null),re=or(p,se=>X(se)),G=L.useRef(!1),J=ee?H||!!ee.closest("form"):!0,[te,ne]=Jh({prop:R,defaultProp:C??!1,onChange:F,caller:iw});return v.jsxs(eie,{scope:m,checked:te,disabled:k,children:[v.jsx(nn.button,{type:"button",role:"switch","aria-checked":te,"aria-required":P,"data-state":w5(te),"data-disabled":k?"":void 0,disabled:k,value:M,...K,ref:re,onClick:Ht(l.onClick,se=>{ne(ae=>!ae),J&&(G.current=se.isPropagationStopped(),G.current||se.stopPropagation())})}),J&&v.jsx(R5,{control:ee,bubbles:!G.current,name:y,value:M,checked:te,required:P,disabled:k,form:H,style:{transform:"translateX(-100%)"}})]})});y5.displayName=iw;var S5="SwitchThumb",T5=L.forwardRef((l,p)=>{const{__scopeSwitch:m,...y}=l,R=tie(S5,m);return v.jsx(nn.span,{"data-state":w5(R.checked),"data-disabled":R.disabled?"":void 0,...y,ref:p})});T5.displayName=S5;var nie="SwitchBubbleInput",R5=L.forwardRef(({__scopeSwitch:l,control:p,checked:m,bubbles:y=!0,...R},C)=>{const P=L.useRef(null),k=or(P,C),M=v5(m),F=m3(p);return L.useEffect(()=>{const H=P.current;if(!H)return;const K=window.HTMLInputElement.prototype,X=Object.getOwnPropertyDescriptor(K,"checked").set;if(M!==m&&X){const re=new Event("click",{bubbles:y});X.call(H,m),H.dispatchEvent(re)}},[M,m,y]),v.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:m,...R,tabIndex:-1,ref:k,style:{...R.style,...F,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});R5.displayName=nie;function w5(l){return l?"checked":"unchecked"}var C5=y5,rie=T5;const Yh=L.forwardRef(({className:l,...p},m)=>v.jsx(C5,{className:gn("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors data-[state=checked]:bg-primary data-[state=unchecked]:bg-input focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50",l),...p,ref:m,children:v.jsx(rie,{className:gn("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})}));Yh.displayName=C5.displayName;function nB(l,[p,m]){return Math.min(m,Math.max(p,l))}var iie=[" ","Enter","ArrowUp","ArrowDown"],sie=[" ","Enter"],$h="Select",[sw,ow,oie]=dN($h),[Mm]=Hc($h,[oie,qR]),aw=qR(),[aie,lu]=Mm($h),[cie,lie]=Mm($h),b5=l=>{const{__scopeSelect:p,children:m,open:y,defaultOpen:R,onOpenChange:C,value:P,defaultValue:k,onValueChange:M,dir:F,name:H,autoComplete:K,disabled:ee,required:X,form:re}=l,G=aw(p),[J,te]=L.useState(null),[ne,se]=L.useState(null),[ae,pe]=L.useState(!1),Se=PN(F),[Te,Ue]=Jh({prop:y,defaultProp:R??!1,onChange:C,caller:$h}),[tt,gt]=Jh({prop:P,defaultProp:k,onChange:M,caller:$h}),ht=L.useRef(null),Ge=J?re||!!J.closest("form"):!0,[pt,Fe]=L.useState(new Set),wt=Array.from(pt).map(rt=>rt.props.value).join(";");return v.jsx($$,{...G,children:v.jsxs(aie,{required:X,scope:p,trigger:J,onTriggerChange:te,valueNode:ne,onValueNodeChange:se,valueNodeHasChildren:ae,onValueNodeHasChildrenChange:pe,contentId:tu(),value:tt,onValueChange:gt,open:Te,onOpenChange:Ue,dir:Se,triggerPointerDownPosRef:ht,disabled:ee,children:[v.jsx(sw.Provider,{scope:p,children:v.jsx(cie,{scope:l.__scopeSelect,onNativeOptionAdd:L.useCallback(rt=>{Fe(Je=>new Set(Je).add(rt))},[]),onNativeOptionRemove:L.useCallback(rt=>{Fe(Je=>{const De=new Set(Je);return De.delete(rt),De})},[]),children:m})}),Ge?v.jsxs(J5,{"aria-hidden":!0,required:X,tabIndex:-1,name:H,autoComplete:K,value:tt,onChange:rt=>gt(rt.target.value),disabled:ee,form:re,children:[tt===void 0?v.jsx("option",{value:""}):null,Array.from(pt)]},wt):null]})})};b5.displayName=$h;var I5="SelectTrigger",A5=L.forwardRef((l,p)=>{const{__scopeSelect:m,disabled:y=!1,...R}=l,C=aw(m),P=lu(I5,m),k=P.disabled||y,M=or(p,P.onTriggerChange),F=ow(m),H=L.useRef("touch"),[K,ee,X]=Z5(G=>{const J=F().filter(se=>!se.disabled),te=J.find(se=>se.value===P.value),ne=$5(J,G,te);ne!==void 0&&P.onValueChange(ne.value)}),re=G=>{k||(P.onOpenChange(!0),X()),G&&(P.triggerPointerDownPosRef.current={x:Math.round(G.pageX),y:Math.round(G.pageY)})};return v.jsx(C3,{asChild:!0,...C,children:v.jsx(nn.button,{type:"button",role:"combobox","aria-controls":P.contentId,"aria-expanded":P.open,"aria-required":P.required,"aria-autocomplete":"none",dir:P.dir,"data-state":P.open?"open":"closed",disabled:k,"data-disabled":k?"":void 0,"data-placeholder":Q5(P.value)?"":void 0,...R,ref:M,onClick:Ht(R.onClick,G=>{G.currentTarget.focus(),H.current!=="mouse"&&re(G)}),onPointerDown:Ht(R.onPointerDown,G=>{H.current=G.pointerType;const J=G.target;J.hasPointerCapture(G.pointerId)&&J.releasePointerCapture(G.pointerId),G.button===0&&G.ctrlKey===!1&&G.pointerType==="mouse"&&(re(G),G.preventDefault())}),onKeyDown:Ht(R.onKeyDown,G=>{const J=K.current!=="";!(G.ctrlKey||G.altKey||G.metaKey)&&G.key.length===1&&ee(G.key),!(J&&G.key===" ")&&iie.includes(G.key)&&(re(),G.preventDefault())})})})});A5.displayName=I5;var N5="SelectValue",O5=L.forwardRef((l,p)=>{const{__scopeSelect:m,className:y,style:R,children:C,placeholder:P="",...k}=l,M=lu(N5,m),{onValueNodeHasChildrenChange:F}=M,H=C!==void 0,K=or(p,M.onValueNodeChange);return ai(()=>{F(H)},[F,H]),v.jsx(nn.span,{...k,ref:K,style:{pointerEvents:"none"},children:Q5(M.value)?v.jsx(v.Fragment,{children:P}):C})});O5.displayName=N5;var die="SelectIcon",P5=L.forwardRef((l,p)=>{const{__scopeSelect:m,children:y,...R}=l;return v.jsx(nn.span,{"aria-hidden":!0,...R,ref:p,children:y||"▼"})});P5.displayName=die;var uie="SelectPortal",D5=l=>v.jsx(FR,{asChild:!0,...l});D5.displayName=uie;var ep="SelectContent",k5=L.forwardRef((l,p)=>{const m=lu(ep,l.__scopeSelect),[y,R]=L.useState();if(ai(()=>{R(new DocumentFragment)},[]),!m.open){const C=y;return C?Om.createPortal(v.jsx(x5,{scope:l.__scopeSelect,children:v.jsx(sw.Slot,{scope:l.__scopeSelect,children:v.jsx("div",{children:l.children})})}),C):null}return v.jsx(L5,{...l,ref:p})});k5.displayName=ep;var ja=10,[x5,du]=Mm(ep),hie="SelectContentImpl",pie=Cm("SelectContent.RemoveScroll"),L5=L.forwardRef((l,p)=>{const{__scopeSelect:m,position:y="item-aligned",onCloseAutoFocus:R,onEscapeKeyDown:C,onPointerDownOutside:P,side:k,sideOffset:M,align:F,alignOffset:H,arrowPadding:K,collisionBoundary:ee,collisionPadding:X,sticky:re,hideWhenDetached:G,avoidCollisions:J,...te}=l,ne=lu(ep,m),[se,ae]=L.useState(null),[pe,Se]=L.useState(null),Te=or(p,Ye=>ae(Ye)),[Ue,tt]=L.useState(null),[gt,ht]=L.useState(null),Ge=ow(m),[pt,Fe]=L.useState(!1),wt=L.useRef(!1);L.useEffect(()=>{if(se)return H4(se)},[se]),L4();const rt=L.useCallback(Ye=>{const[Nt,...Gt]=Ge().map(Yn=>Yn.ref.current),[Yt]=Gt.slice(-1),Cn=document.activeElement;for(const Yn of Ye)if(Yn===Cn||(Yn?.scrollIntoView({block:"nearest"}),Yn===Nt&&pe&&(pe.scrollTop=0),Yn===Yt&&pe&&(pe.scrollTop=pe.scrollHeight),Yn?.focus(),document.activeElement!==Cn))return},[Ge,pe]),Je=L.useCallback(()=>rt([Ue,se]),[rt,Ue,se]);L.useEffect(()=>{pt&&Je()},[pt,Je]);const{onOpenChange:De,triggerPointerDownPosRef:Le}=ne;L.useEffect(()=>{if(se){let Ye={x:0,y:0};const Nt=Yt=>{Ye={x:Math.abs(Math.round(Yt.pageX)-(Le.current?.x??0)),y:Math.abs(Math.round(Yt.pageY)-(Le.current?.y??0))}},Gt=Yt=>{Ye.x<=10&&Ye.y<=10?Yt.preventDefault():se.contains(Yt.target)||De(!1),document.removeEventListener("pointermove",Nt),Le.current=null};return Le.current!==null&&(document.addEventListener("pointermove",Nt),document.addEventListener("pointerup",Gt,{capture:!0,once:!0})),()=>{document.removeEventListener("pointermove",Nt),document.removeEventListener("pointerup",Gt,{capture:!0})}}},[se,De,Le]),L.useEffect(()=>{const Ye=()=>De(!1);return window.addEventListener("blur",Ye),window.addEventListener("resize",Ye),()=>{window.removeEventListener("blur",Ye),window.removeEventListener("resize",Ye)}},[De]);const[ze,fe]=Z5(Ye=>{const Nt=Ge().filter(Cn=>!Cn.disabled),Gt=Nt.find(Cn=>Cn.ref.current===document.activeElement),Yt=$5(Nt,Ye,Gt);Yt&&setTimeout(()=>Yt.ref.current.focus())}),Ne=L.useCallback((Ye,Nt,Gt)=>{const Yt=!wt.current&&!Gt;(ne.value!==void 0&&ne.value===Nt||Yt)&&(tt(Ye),Yt&&(wt.current=!0))},[ne.value]),st=L.useCallback(()=>se?.focus(),[se]),it=L.useCallback((Ye,Nt,Gt)=>{const Yt=!wt.current&&!Gt;(ne.value!==void 0&&ne.value===Nt||Yt)&&ht(Ye)},[ne.value]),Pt=y==="popper"?rN:M5,zt=Pt===rN?{side:k,sideOffset:M,align:F,alignOffset:H,arrowPadding:K,collisionBoundary:ee,collisionPadding:X,sticky:re,hideWhenDetached:G,avoidCollisions:J}:{};return v.jsx(x5,{scope:m,content:se,viewport:pe,onViewportChange:Se,itemRefCallback:Ne,selectedItem:Ue,onItemLeave:st,itemTextRefCallback:it,focusSelectedItem:Je,selectedItemText:gt,position:y,isPositioned:pt,searchRef:ze,children:v.jsx(MN,{as:pie,allowPinchZoom:!0,children:v.jsx(LN,{asChild:!0,trapped:ne.open,onMountAutoFocus:Ye=>{Ye.preventDefault()},onUnmountAutoFocus:Ht(R,Ye=>{ne.trigger?.focus({preventScroll:!0}),Ye.preventDefault()}),children:v.jsx(rv,{asChild:!0,disableOutsidePointerEvents:!0,onEscapeKeyDown:C,onPointerDownOutside:P,onFocusOutside:Ye=>Ye.preventDefault(),onDismiss:()=>ne.onOpenChange(!1),children:v.jsx(Pt,{role:"listbox",id:ne.contentId,"data-state":ne.open?"open":"closed",dir:ne.dir,onContextMenu:Ye=>Ye.preventDefault(),...te,...zt,onPlaced:()=>Fe(!0),ref:Te,style:{display:"flex",flexDirection:"column",outline:"none",...te.style},onKeyDown:Ht(te.onKeyDown,Ye=>{const Nt=Ye.ctrlKey||Ye.altKey||Ye.metaKey;if(Ye.key==="Tab"&&Ye.preventDefault(),!Nt&&Ye.key.length===1&&fe(Ye.key),["ArrowUp","ArrowDown","Home","End"].includes(Ye.key)){let Yt=Ge().filter(Cn=>!Cn.disabled).map(Cn=>Cn.ref.current);if(["ArrowUp","End"].includes(Ye.key)&&(Yt=Yt.slice().reverse()),["ArrowUp","ArrowDown"].includes(Ye.key)){const Cn=Ye.target,Yn=Yt.indexOf(Cn);Yt=Yt.slice(Yn+1)}setTimeout(()=>rt(Yt)),Ye.preventDefault()}})})})})})})});L5.displayName=hie;var fie="SelectItemAlignedPosition",M5=L.forwardRef((l,p)=>{const{__scopeSelect:m,onPlaced:y,...R}=l,C=lu(ep,m),P=du(ep,m),[k,M]=L.useState(null),[F,H]=L.useState(null),K=or(p,Te=>H(Te)),ee=ow(m),X=L.useRef(!1),re=L.useRef(!0),{viewport:G,selectedItem:J,selectedItemText:te,focusSelectedItem:ne}=P,se=L.useCallback(()=>{if(C.trigger&&C.valueNode&&k&&F&&G&&J&&te){const Te=C.trigger.getBoundingClientRect(),Ue=F.getBoundingClientRect(),tt=C.valueNode.getBoundingClientRect(),gt=te.getBoundingClientRect();if(C.dir!=="rtl"){const Cn=gt.left-Ue.left,Yn=tt.left-Cn,er=Te.left-Yn,ss=Te.width+er,Ga=Math.max(ss,Ue.width),Ei=window.innerWidth-ja,ta=nB(Yn,[ja,Math.max(ja,Ei-Ga)]);k.style.minWidth=ss+"px",k.style.left=ta+"px"}else{const Cn=Ue.right-gt.right,Yn=window.innerWidth-tt.right-Cn,er=window.innerWidth-Te.right-Yn,ss=Te.width+er,Ga=Math.max(ss,Ue.width),Ei=window.innerWidth-ja,ta=nB(Yn,[ja,Math.max(ja,Ei-Ga)]);k.style.minWidth=ss+"px",k.style.right=ta+"px"}const ht=ee(),Ge=window.innerHeight-ja*2,pt=G.scrollHeight,Fe=window.getComputedStyle(F),wt=parseInt(Fe.borderTopWidth,10),rt=parseInt(Fe.paddingTop,10),Je=parseInt(Fe.borderBottomWidth,10),De=parseInt(Fe.paddingBottom,10),Le=wt+rt+pt+De+Je,ze=Math.min(J.offsetHeight*5,Le),fe=window.getComputedStyle(G),Ne=parseInt(fe.paddingTop,10),st=parseInt(fe.paddingBottom,10),it=Te.top+Te.height/2-ja,Pt=Ge-it,zt=J.offsetHeight/2,Ye=J.offsetTop+zt,Nt=wt+rt+Ye,Gt=Le-Nt;if(Nt<=it){const Cn=ht.length>0&&J===ht[ht.length-1].ref.current;k.style.bottom="0px";const Yn=F.clientHeight-G.offsetTop-G.offsetHeight,er=Math.max(Pt,zt+(Cn?st:0)+Yn+Je),ss=Nt+er;k.style.height=ss+"px"}else{const Cn=ht.length>0&&J===ht[0].ref.current;k.style.top="0px";const er=Math.max(it,wt+G.offsetTop+(Cn?Ne:0)+zt)+Gt;k.style.height=er+"px",G.scrollTop=Nt-it+G.offsetTop}k.style.margin=`${ja}px 0`,k.style.minHeight=ze+"px",k.style.maxHeight=Ge+"px",y?.(),requestAnimationFrame(()=>X.current=!0)}},[ee,C.trigger,C.valueNode,k,F,G,J,te,C.dir,y]);ai(()=>se(),[se]);const[ae,pe]=L.useState();ai(()=>{F&&pe(window.getComputedStyle(F).zIndex)},[F]);const Se=L.useCallback(Te=>{Te&&re.current===!0&&(se(),ne?.(),re.current=!1)},[se,ne]);return v.jsx(_ie,{scope:m,contentWrapper:k,shouldExpandOnScrollRef:X,onScrollButtonChange:Se,children:v.jsx("div",{ref:M,style:{display:"flex",flexDirection:"column",position:"fixed",zIndex:ae},children:v.jsx(nn.div,{...R,ref:K,style:{boxSizing:"border-box",maxHeight:"100%",...R.style}})})})});M5.displayName=fie;var mie="SelectPopperPosition",rN=L.forwardRef((l,p)=>{const{__scopeSelect:m,align:y="start",collisionPadding:R=ja,...C}=l,P=aw(m);return v.jsx(b3,{...P,...C,ref:p,align:y,collisionPadding:R,style:{boxSizing:"border-box",...C.style,"--radix-select-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-select-content-available-width":"var(--radix-popper-available-width)","--radix-select-content-available-height":"var(--radix-popper-available-height)","--radix-select-trigger-width":"var(--radix-popper-anchor-width)","--radix-select-trigger-height":"var(--radix-popper-anchor-height)"}})});rN.displayName=mie;var[_ie,FN]=Mm(ep,{}),iN="SelectViewport",U5=L.forwardRef((l,p)=>{const{__scopeSelect:m,nonce:y,...R}=l,C=du(iN,m),P=FN(iN,m),k=or(p,C.onViewportChange),M=L.useRef(0);return v.jsxs(v.Fragment,{children:[v.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-select-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-select-viewport]::-webkit-scrollbar{display:none}"},nonce:y}),v.jsx(sw.Slot,{scope:m,children:v.jsx(nn.div,{"data-radix-select-viewport":"",role:"presentation",...R,ref:k,style:{position:"relative",flex:1,overflow:"hidden auto",...R.style},onScroll:Ht(R.onScroll,F=>{const H=F.currentTarget,{contentWrapper:K,shouldExpandOnScrollRef:ee}=P;if(ee?.current&&K){const X=Math.abs(M.current-H.scrollTop);if(X>0){const re=window.innerHeight-ja*2,G=parseFloat(K.style.minHeight),J=parseFloat(K.style.height),te=Math.max(G,J);if(te<re){const ne=te+X,se=Math.min(re,ne),ae=ne-se;K.style.height=se+"px",K.style.bottom==="0px"&&(H.scrollTop=ae>0?ae:0,K.style.justifyContent="flex-end")}}}M.current=H.scrollTop})})})]})});U5.displayName=iN;var j5="SelectGroup",[gie,Eie]=Mm(j5),vie=L.forwardRef((l,p)=>{const{__scopeSelect:m,...y}=l,R=tu();return v.jsx(gie,{scope:m,id:R,children:v.jsx(nn.div,{role:"group","aria-labelledby":R,...y,ref:p})})});vie.displayName=j5;var V5="SelectLabel",F5=L.forwardRef((l,p)=>{const{__scopeSelect:m,...y}=l,R=Eie(V5,m);return v.jsx(nn.div,{id:R.id,...y,ref:p})});F5.displayName=V5;var jR="SelectItem",[yie,B5]=Mm(jR),W5=L.forwardRef((l,p)=>{const{__scopeSelect:m,value:y,disabled:R=!1,textValue:C,...P}=l,k=lu(jR,m),M=du(jR,m),F=k.value===y,[H,K]=L.useState(C??""),[ee,X]=L.useState(!1),re=or(p,ne=>M.itemRefCallback?.(ne,y,R)),G=tu(),J=L.useRef("touch"),te=()=>{R||(k.onValueChange(y),k.onOpenChange(!1))};if(y==="")throw new Error("A <Select.Item /> must have a value prop that is not an empty string. This is because the Select value can be set to an empty string to clear the selection and show the placeholder.");return v.jsx(yie,{scope:m,value:y,disabled:R,textId:G,isSelected:F,onItemTextChange:L.useCallback(ne=>{K(se=>se||(ne?.textContent??"").trim())},[]),children:v.jsx(sw.ItemSlot,{scope:m,value:y,disabled:R,textValue:H,children:v.jsx(nn.div,{role:"option","aria-labelledby":G,"data-highlighted":ee?"":void 0,"aria-selected":F&&ee,"data-state":F?"checked":"unchecked","aria-disabled":R||void 0,"data-disabled":R?"":void 0,tabIndex:R?void 0:-1,...P,ref:re,onFocus:Ht(P.onFocus,()=>X(!0)),onBlur:Ht(P.onBlur,()=>X(!1)),onClick:Ht(P.onClick,()=>{J.current!=="mouse"&&te()}),onPointerUp:Ht(P.onPointerUp,()=>{J.current==="mouse"&&te()}),onPointerDown:Ht(P.onPointerDown,ne=>{J.current=ne.pointerType}),onPointerMove:Ht(P.onPointerMove,ne=>{J.current=ne.pointerType,R?M.onItemLeave?.():J.current==="mouse"&&ne.currentTarget.focus({preventScroll:!0})}),onPointerLeave:Ht(P.onPointerLeave,ne=>{ne.currentTarget===document.activeElement&&M.onItemLeave?.()}),onKeyDown:Ht(P.onKeyDown,ne=>{M.searchRef?.current!==""&&ne.key===" "||(sie.includes(ne.key)&&te(),ne.key===" "&&ne.preventDefault())})})})})});W5.displayName=jR;var GE="SelectItemText",G5=L.forwardRef((l,p)=>{const{__scopeSelect:m,className:y,style:R,...C}=l,P=lu(GE,m),k=du(GE,m),M=B5(GE,m),F=lie(GE,m),[H,K]=L.useState(null),ee=or(p,te=>K(te),M.onItemTextChange,te=>k.itemTextRefCallback?.(te,M.value,M.disabled)),X=H?.textContent,re=L.useMemo(()=>v.jsx("option",{value:M.value,disabled:M.disabled,children:X},M.value),[M.disabled,M.value,X]),{onNativeOptionAdd:G,onNativeOptionRemove:J}=F;return ai(()=>(G(re),()=>J(re)),[G,J,re]),v.jsxs(v.Fragment,{children:[v.jsx(nn.span,{id:M.textId,...C,ref:ee}),M.isSelected&&P.valueNode&&!P.valueNodeHasChildren?Om.createPortal(C.children,P.valueNode):null]})});G5.displayName=GE;var H5="SelectItemIndicator",K5=L.forwardRef((l,p)=>{const{__scopeSelect:m,...y}=l;return B5(H5,m).isSelected?v.jsx(nn.span,{"aria-hidden":!0,...y,ref:p}):null});K5.displayName=H5;var sN="SelectScrollUpButton",z5=L.forwardRef((l,p)=>{const m=du(sN,l.__scopeSelect),y=FN(sN,l.__scopeSelect),[R,C]=L.useState(!1),P=or(p,y.onScrollButtonChange);return ai(()=>{if(m.viewport&&m.isPositioned){let k=function(){const F=M.scrollTop>0;C(F)};const M=m.viewport;return k(),M.addEventListener("scroll",k),()=>M.removeEventListener("scroll",k)}},[m.viewport,m.isPositioned]),R?v.jsx(q5,{...l,ref:P,onAutoScroll:()=>{const{viewport:k,selectedItem:M}=m;k&&M&&(k.scrollTop=k.scrollTop-M.offsetHeight)}}):null});z5.displayName=sN;var oN="SelectScrollDownButton",Y5=L.forwardRef((l,p)=>{const m=du(oN,l.__scopeSelect),y=FN(oN,l.__scopeSelect),[R,C]=L.useState(!1),P=or(p,y.onScrollButtonChange);return ai(()=>{if(m.viewport&&m.isPositioned){let k=function(){const F=M.scrollHeight-M.clientHeight,H=Math.ceil(M.scrollTop)<F;C(H)};const M=m.viewport;return k(),M.addEventListener("scroll",k),()=>M.removeEventListener("scroll",k)}},[m.viewport,m.isPositioned]),R?v.jsx(q5,{...l,ref:P,onAutoScroll:()=>{const{viewport:k,selectedItem:M}=m;k&&M&&(k.scrollTop=k.scrollTop+M.offsetHeight)}}):null});Y5.displayName=oN;var q5=L.forwardRef((l,p)=>{const{__scopeSelect:m,onAutoScroll:y,...R}=l,C=du("SelectScrollButton",m),P=L.useRef(null),k=ow(m),M=L.useCallback(()=>{P.current!==null&&(window.clearInterval(P.current),P.current=null)},[]);return L.useEffect(()=>()=>M(),[M]),ai(()=>{k().find(H=>H.ref.current===document.activeElement)?.ref.current?.scrollIntoView({block:"nearest"})},[k]),v.jsx(nn.div,{"aria-hidden":!0,...R,ref:p,style:{flexShrink:0,...R.style},onPointerDown:Ht(R.onPointerDown,()=>{P.current===null&&(P.current=window.setInterval(y,50))}),onPointerMove:Ht(R.onPointerMove,()=>{C.onItemLeave?.(),P.current===null&&(P.current=window.setInterval(y,50))}),onPointerLeave:Ht(R.onPointerLeave,()=>{M()})})}),Sie="SelectSeparator",X5=L.forwardRef((l,p)=>{const{__scopeSelect:m,...y}=l;return v.jsx(nn.div,{"aria-hidden":!0,...y,ref:p})});X5.displayName=Sie;var aN="SelectArrow",Tie=L.forwardRef((l,p)=>{const{__scopeSelect:m,...y}=l,R=aw(m),C=lu(aN,m),P=du(aN,m);return C.open&&P.position==="popper"?v.jsx(I3,{...R,...y,ref:p}):null});Tie.displayName=aN;var Rie="SelectBubbleInput",J5=L.forwardRef(({__scopeSelect:l,value:p,...m},y)=>{const R=L.useRef(null),C=or(y,R),P=v5(p);return L.useEffect(()=>{const k=R.current;if(!k)return;const M=window.HTMLSelectElement.prototype,H=Object.getOwnPropertyDescriptor(M,"value").set;if(P!==p&&H){const K=new Event("change",{bubbles:!0});H.call(k,p),k.dispatchEvent(K)}},[P,p]),v.jsx(nn.select,{...m,style:{...hB,...m.style},ref:C,defaultValue:p})});J5.displayName=Rie;function Q5(l){return l===""||l===void 0}function Z5(l){const p=go(l),m=L.useRef(""),y=L.useRef(0),R=L.useCallback(P=>{const k=m.current+P;p(k),(function M(F){m.current=F,window.clearTimeout(y.current),F!==""&&(y.current=window.setTimeout(()=>M(""),1e3))})(k)},[p]),C=L.useCallback(()=>{m.current="",window.clearTimeout(y.current)},[]);return L.useEffect(()=>()=>window.clearTimeout(y.current),[]),[m,R,C]}function $5(l,p,m){const R=p.length>1&&Array.from(p).every(F=>F===p[0])?p[0]:p,C=m?l.indexOf(m):-1;let P=wie(l,Math.max(C,0));R.length===1&&(P=P.filter(F=>F!==m));const M=P.find(F=>F.textValue.toLowerCase().startsWith(R.toLowerCase()));return M!==m?M:void 0}function wie(l,p){return l.map((m,y)=>l[(p+y)%l.length])}var Cie=b5,eW=A5,bie=O5,Iie=P5,Aie=D5,tW=k5,Nie=U5,nW=F5,rW=W5,Oie=G5,Pie=K5,iW=z5,sW=Y5,oW=X5;const Die=Cie,kie=bie,aW=L.forwardRef(({className:l,children:p,...m},y)=>v.jsxs(eW,{ref:y,className:gn("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",l),...m,children:[p,v.jsx(Iie,{asChild:!0,children:v.jsx(MB,{className:"h-4 w-4 opacity-50"})})]}));aW.displayName=eW.displayName;const cW=L.forwardRef(({className:l,...p},m)=>v.jsx(iW,{ref:m,className:gn("flex cursor-default items-center justify-center py-1",l),...p,children:v.jsx(nQ,{className:"h-4 w-4"})}));cW.displayName=iW.displayName;const lW=L.forwardRef(({className:l,...p},m)=>v.jsx(sW,{ref:m,className:gn("flex cursor-default items-center justify-center py-1",l),...p,children:v.jsx(MB,{className:"h-4 w-4"})}));lW.displayName=sW.displayName;const dW=L.forwardRef(({className:l,children:p,position:m="popper",...y},R)=>v.jsx(Aie,{children:v.jsxs(tW,{ref:R,className:gn("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",m==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",l),position:m,...y,children:[v.jsx(cW,{}),v.jsx(Nie,{className:gn("p-1",m==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:p}),v.jsx(lW,{})]})}));dW.displayName=tW.displayName;const xie=L.forwardRef(({className:l,...p},m)=>v.jsx(nW,{ref:m,className:gn("py-1.5 pl-8 pr-2 text-sm font-semibold",l),...p}));xie.displayName=nW.displayName;const AR=L.forwardRef(({className:l,children:p,...m},y)=>v.jsxs(rW,{ref:y,className:gn("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 focus:bg-accent focus:text-accent-foreground",l),...m,children:[v.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:v.jsx(Pie,{children:v.jsx(tQ,{className:"h-4 w-4"})})}),v.jsx(Oie,{children:p})]}));AR.displayName=rW.displayName;const Lie=L.forwardRef(({className:l,...p},m)=>v.jsx(oW,{ref:m,className:gn("-mx-1 my-1 h-px bg-muted",l),...p}));Lie.displayName=oW.displayName;function Mie(){const[l,p]=L.useState({reactions:!0,replies:!0,mentions:!1,trending:!0,digest:!1}),[m,y]=L.useState({showActivity:!1,allowDMs:!1,dataCollection:!0}),[R,C]=L.useState("24h"),{toast:P}=Gc(),k=()=>{P({title:"Settings Saved",description:"Your preferences have been updated successfully."})},M=()=>{P({title:"Account Deletion",description:"This feature will permanently delete your anonymous profile. Contact support if you need assistance.",variant:"destructive"})},F=()=>{P({title:"Data Export",description:"Your anonymous data export will be ready in a few minutes. We'll notify you when it's ready."})};return v.jsxs("div",{className:"min-h-screen bg-background pb-20 md:pb-8",children:[v.jsx(Xh,{}),v.jsx("main",{className:"container mx-auto px-4 pt-20 max-w-2xl",children:v.jsxs("div",{className:"space-y-8",children:[v.jsxs("div",{className:"text-center space-y-2 animate-fade-in",children:[v.jsx("h1",{className:"text-3xl font-bold gradient-primary bg-clip-text text-transparent",children:"Settings"}),v.jsx("p",{className:"text-muted-foreground",children:"Customize your anonymous TeaTok experience"})]}),v.jsxs(An,{className:"tea-card animate-slide-in-right",children:[v.jsxs(Ir,{children:[v.jsxs(Pi,{className:"flex items-center space-x-2",children:[v.jsx(FB,{className:"h-5 w-5"}),v.jsx("span",{children:"Appearance"})]}),v.jsx(Bs,{children:"Customize how TeaTok looks and feels"})]}),v.jsx(Dn,{className:"space-y-4",children:v.jsxs("div",{className:"flex items-center justify-between",children:[v.jsxs("div",{children:[v.jsx("div",{className:"font-medium",children:"Theme"}),v.jsx("div",{className:"text-sm text-muted-foreground",children:"Choose your preferred theme"})]}),v.jsx(ON,{})]})})]}),v.jsxs(An,{className:"tea-card animate-slide-in-right",style:{animationDelay:"0.1s"},children:[v.jsxs(Ir,{children:[v.jsxs(Pi,{className:"flex items-center space-x-2",children:[v.jsx(eQ,{className:"h-5 w-5"}),v.jsx("span",{children:"Notifications"})]}),v.jsx(Bs,{children:"Control what notifications you receive"})]}),v.jsx(Dn,{className:"space-y-6",children:v.jsxs("div",{className:"space-y-4",children:[v.jsxs("div",{className:"flex items-center justify-between",children:[v.jsxs("div",{children:[v.jsx("div",{className:"font-medium",children:"Reactions on my posts"}),v.jsx("div",{className:"text-sm text-muted-foreground",children:"Get notified when someone reacts to your tea"})]}),v.jsx(Yh,{checked:l.reactions,onCheckedChange:H=>p(K=>({...K,reactions:H}))})]}),v.jsxs("div",{className:"flex items-center justify-between",children:[v.jsxs("div",{children:[v.jsx("div",{className:"font-medium",children:"Replies to my posts"}),v.jsx("div",{className:"text-sm text-muted-foreground",children:"When someone responds to your spilled tea"})]}),v.jsx(Yh,{checked:l.replies,onCheckedChange:H=>p(K=>({...K,replies:H}))})]}),v.jsxs("div",{className:"flex items-center justify-between",children:[v.jsxs("div",{children:[v.jsx("div",{className:"font-medium",children:"Trending posts"}),v.jsx("div",{className:"text-sm text-muted-foreground",children:"Hot tea from rooms you follow"})]}),v.jsx(Yh,{checked:l.trending,onCheckedChange:H=>p(K=>({...K,trending:H}))})]}),v.jsxs("div",{className:"flex items-center justify-between",children:[v.jsxs("div",{children:[v.jsx("div",{className:"font-medium",children:"Daily digest"}),v.jsx("div",{className:"text-sm text-muted-foreground",children:"Summary of the hottest tea each day"})]}),v.jsx(Yh,{checked:l.digest,onCheckedChange:H=>p(K=>({...K,digest:H}))})]})]})})]}),v.jsxs(An,{className:"tea-card animate-slide-in-right",style:{animationDelay:"0.2s"},children:[v.jsxs(Ir,{children:[v.jsxs(Pi,{className:"flex items-center space-x-2",children:[v.jsx(HR,{className:"h-5 w-5"}),v.jsx("span",{children:"Privacy & Safety"})]}),v.jsx(Bs,{children:"Control your anonymity and safety settings"})]}),v.jsxs(Dn,{className:"space-y-6",children:[v.jsxs("div",{className:"space-y-4",children:[v.jsxs("div",{className:"flex items-center justify-between",children:[v.jsxs("div",{children:[v.jsx("div",{className:"font-medium",children:"Show activity status"}),v.jsx("div",{className:"text-sm text-muted-foreground",children:"Let others see when you're active"})]}),v.jsx(Yh,{checked:m.showActivity,onCheckedChange:H=>y(K=>({...K,showActivity:H}))})]}),v.jsxs("div",{className:"flex items-center justify-between",children:[v.jsxs("div",{children:[v.jsx("div",{className:"font-medium",children:"Anonymous data collection"}),v.jsx("div",{className:"text-sm text-muted-foreground",children:"Help improve TeaTok with anonymous usage data"})]}),v.jsx(Yh,{checked:m.dataCollection,onCheckedChange:H=>y(K=>({...K,dataCollection:H}))})]})]}),v.jsxs("div",{className:"pt-4 border-t border-border",children:[v.jsx("h4",{className:"font-medium mb-3",children:"Content Preferences"}),v.jsx("div",{className:"space-y-3",children:v.jsxs("div",{children:[v.jsx("label",{className:"text-sm font-medium",children:"Default post duration"}),v.jsxs(Die,{value:R,onValueChange:C,children:[v.jsx(aW,{className:"mt-1",children:v.jsx(kie,{})}),v.jsxs(dW,{children:[v.jsx(AR,{value:"24h",children:"24 Hours"}),v.jsx(AR,{value:"7d",children:"7 Days"}),v.jsx(AR,{value:"permanent",children:"Permanent"})]})]})]})})]})]})]}),v.jsxs(An,{className:"tea-card animate-slide-in-right",style:{animationDelay:"0.3s"},children:[v.jsxs(Ir,{children:[v.jsxs(Pi,{className:"flex items-center space-x-2",children:[v.jsx(rF,{className:"h-5 w-5"}),v.jsx("span",{children:"Data & Account"})]}),v.jsx(Bs,{children:"Manage your data and account settings"})]}),v.jsx(Dn,{className:"space-y-4",children:v.jsxs("div",{className:"space-y-3",children:[v.jsxs(At,{variant:"outline",className:"w-full justify-start",onClick:F,children:[v.jsx(rF,{className:"h-4 w-4 mr-2"}),"Export My Data"]}),v.jsx("div",{className:"pt-4 border-t border-border",children:v.jsxs("div",{className:"flex items-start space-x-3 p-4 bg-destructive/10 border border-destructive/20 rounded-lg",children:[v.jsx(hQ,{className:"h-5 w-5 text-destructive mt-0.5"}),v.jsxs("div",{className:"flex-1 space-y-2",children:[v.jsx("h4",{className:"font-medium text-destructive",children:"Delete Account"}),v.jsx("p",{className:"text-sm text-muted-foreground",children:"Permanently delete your anonymous profile and all associated data. This action cannot be undone."}),v.jsxs(At,{variant:"destructive",size:"sm",onClick:M,className:"hover-scale",children:[v.jsx(XE,{className:"h-4 w-4 mr-2"}),"Delete Account"]})]})]})})]})})]}),v.jsx(An,{className:"tea-card animate-slide-in-right",style:{animationDelay:"0.4s"},children:v.jsxs(Dn,{className:"p-6 text-center space-y-4",children:[v.jsxs("div",{className:"space-y-2",children:[v.jsx("h3",{className:"font-semibold",children:"TeaTok v1.0.0"}),v.jsx("p",{className:"text-sm text-muted-foreground",children:"The anonymous social playground where you spill, sip, and connect."})]}),v.jsxs("div",{className:"flex justify-center space-x-4 text-sm",children:[v.jsx("button",{className:"text-muted-foreground hover:text-foreground transition-colors",children:"Terms of Service"}),v.jsx("button",{className:"text-muted-foreground hover:text-foreground transition-colors",children:"Privacy Policy"}),v.jsx("button",{className:"text-muted-foreground hover:text-foreground transition-colors",children:"Support"})]})]})}),v.jsx("div",{className:"flex justify-center pt-4 animate-fade-in",style:{animationDelay:"0.5s"},children:v.jsx(At,{onClick:k,className:"spill-button px-12 py-3 text-lg",children:"Save Settings"})})]})})]})}function Uie(){const l=[{icon:Im,title:"Anonymous Expression",description:"Share your thoughts, gossip, and reviews without revealing your identity. Create personas and keep it mysterious."},{icon:UB,title:"Unique Reactions",description:"React with Tea ☕, Spicy 🌶️, or Cap 🧢. Express yourself beyond basic likes with our themed reaction system."},{icon:WB,title:"Topic Rooms",description:"Join themed communities for Movies, Gaming, Celebrity Gossip, Campus Tea, and more. Each room has its own vibe."},{icon:HB,title:"Instant Engagement",description:"Posts can have different lifespans - from 24-hour hot takes to permanent reviews. Choose how long your tea lives."},{icon:HR,title:"Safe & Moderated",description:"Smart moderation keeps the platform fun and safe. We're built for positive anonymous interactions."},{icon:oQ,title:"Community Driven",description:"Built by tea-spillers, for tea-spillers. Every feature is designed to make anonymous sharing fun and addictive."}];return v.jsx("div",{className:"min-h-screen bg-background",children:v.jsxs("div",{className:"container mx-auto px-4 py-8 max-w-4xl",children:[v.jsx("div",{className:"flex items-center justify-between mb-8 animate-fade-in",children:v.jsx(At,{variant:"ghost",asChild:!0,className:"flex items-center space-x-2",children:v.jsxs(jr,{to:"/",children:[v.jsx(qE,{className:"h-4 w-4"}),v.jsx("span",{children:"Back to Home"})]})})}),v.jsxs("div",{className:"space-y-12",children:[v.jsxs("section",{className:"text-center space-y-6 animate-fade-in",children:[v.jsxs("div",{className:"flex justify-center",children:[v.jsx("img",{src:"/logo.png",alt:"TeaTok Logo",className:"hidden dark:block h-24 w-24 md:h-28 md:w-28 animate-float rounded object-contain"}),v.jsx("img",{src:"/logo-light.png",alt:"TeaTok Logo",className:"block dark:hidden h-24 w-24 md:h-28 md:w-28 animate-float rounded object-contain"})]}),v.jsxs("div",{className:"space-y-4",children:[v.jsx("h1",{className:"text-4xl md:text-5xl font-bold gradient-hero bg-clip-text text-transparent",children:"About TeaTok"}),v.jsx("p",{className:"text-xl text-muted-foreground max-w-2xl mx-auto",children:"The anonymous social playground where you spill gossip, drop reviews, and connect through tea, threads, and hot takes."})]})]}),v.jsx("section",{className:"animate-slide-in-right",children:v.jsx(An,{className:"tea-card gradient-hero text-white",children:v.jsxs(Dn,{className:"p-8 text-center",children:[v.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Our Mission"}),v.jsx("p",{className:"text-lg text-white/90 leading-relaxed",children:"TeaTok reimagines social media by putting anonymity first. We believe the best conversations happen when people can express themselves freely without judgment. Whether you're spilling celebrity gossip, reviewing the latest blockbuster, or sharing campus drama, TeaTok is your safe space to be authentic."})]})})}),v.jsxs("section",{className:"animate-slide-in-right",style:{animationDelay:"0.1s"},children:[v.jsxs("div",{className:"text-center mb-8",children:[v.jsx("h2",{className:"text-3xl font-bold mb-4",children:"What Makes TeaTok Special"}),v.jsx("p",{className:"text-muted-foreground",children:"Every feature is designed to make anonymous sharing fun, safe, and addictive."})]}),v.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-6",children:l.map((p,m)=>v.jsxs(An,{className:"tea-card hover-lift",style:{animationDelay:`${m*.1}s`},children:[v.jsxs(Ir,{className:"text-center",children:[v.jsx("div",{className:"gradient-primary w-12 h-12 rounded-full flex items-center justify-center mx-auto mb-4",children:v.jsx(p.icon,{className:"h-6 w-6 text-primary-foreground"})}),v.jsx(Pi,{className:"text-lg",children:p.title})]}),v.jsx(Dn,{children:v.jsx(Bs,{className:"text-center",children:p.description})})]},p.title))})]}),v.jsx("section",{className:"animate-slide-in-right",style:{animationDelay:"0.2s"},children:v.jsxs(An,{className:"tea-card",children:[v.jsxs(Ir,{className:"text-center",children:[v.jsx(Pi,{className:"text-2xl",children:"How TeaTok Works"}),v.jsx(Bs,{children:"Simple, anonymous, and addictive"})]}),v.jsx(Dn,{className:"space-y-6",children:v.jsxs("div",{className:"grid md:grid-cols-3 gap-6",children:[v.jsxs("div",{className:"text-center space-y-3",children:[v.jsx("div",{className:"w-16 h-16 gradient-primary rounded-full flex items-center justify-center mx-auto text-2xl text-primary-foreground font-bold",children:"1"}),v.jsx("h3",{className:"font-semibold",children:"Choose Your Persona"}),v.jsx("p",{className:"text-sm text-muted-foreground",children:"Create anonymous aliases and personas. Be whoever you want to be."})]}),v.jsxs("div",{className:"text-center space-y-3",children:[v.jsx("div",{className:"w-16 h-16 gradient-accent rounded-full flex items-center justify-center mx-auto text-2xl text-accent-foreground font-bold",children:"2"}),v.jsx("h3",{className:"font-semibold",children:"Spill Your Tea"}),v.jsx("p",{className:"text-sm text-muted-foreground",children:"Share gossip, reviews, and hot takes in themed rooms. Text or voice - your choice."})]}),v.jsxs("div",{className:"text-center space-y-3",children:[v.jsx("div",{className:"w-16 h-16 gradient-warm rounded-full flex items-center justify-center mx-auto text-2xl text-white font-bold",children:"3"}),v.jsx("h3",{className:"font-semibold",children:"Watch It Brew"}),v.jsx("p",{className:"text-sm text-muted-foreground",children:"Get reactions, replies, and engage with the community. Watch your tea spread!"})]})]})})]})}),v.jsx("section",{className:"animate-slide-in-right",style:{animationDelay:"0.3s"},children:v.jsxs(An,{className:"tea-card",children:[v.jsxs(Ir,{className:"text-center",children:[v.jsx(Pi,{className:"text-2xl",children:"Our Values"}),v.jsx(Bs,{children:"What we believe in"})]}),v.jsx(Dn,{children:v.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[v.jsxs("div",{className:"space-y-3",children:[v.jsx("h3",{className:"font-semibold text-accent",children:"Authenticity Over Identity"}),v.jsx("p",{className:"text-sm text-muted-foreground",children:"Real thoughts and genuine expression matter more than who you are in real life."})]}),v.jsxs("div",{className:"space-y-3",children:[v.jsx("h3",{className:"font-semibold text-accent",children:"Fun Over Drama"}),v.jsx("p",{className:"text-sm text-muted-foreground",children:"We're here to spill tea and have fun, not to spread hate or toxicity."})]}),v.jsxs("div",{className:"space-y-3",children:[v.jsx("h3",{className:"font-semibold text-accent",children:"Community Over Clout"}),v.jsx("p",{className:"text-sm text-muted-foreground",children:"It's not about followers or fame - it's about connecting with people who get your vibe."})]}),v.jsxs("div",{className:"space-y-3",children:[v.jsx("h3",{className:"font-semibold text-accent",children:"Privacy Over Profit"}),v.jsx("p",{className:"text-sm text-muted-foreground",children:"Your anonymity is sacred. We'll never compromise your privacy for business gain."})]})]})})]})}),v.jsx("section",{className:"text-center space-y-6 animate-fade-in",style:{animationDelay:"0.4s"},children:v.jsx(An,{className:"tea-card gradient-hero text-white",children:v.jsxs(Dn,{className:"p-8",children:[v.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Ready to spill some tea?"}),v.jsx("p",{className:"text-white/90 mb-6",children:"Join the community where your voice matters more than your name."}),v.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-center",children:[v.jsx(At,{asChild:!0,variant:"secondary",size:"lg",className:"hover-scale shadow-soft",children:v.jsx(jr,{to:"/auth",children:"Join TeaTok"})}),v.jsx(At,{asChild:!0,variant:"outline",size:"lg",className:"border-white/30 text-white hover:bg-white/10",children:v.jsx(jr,{to:"/feed",children:"Explore Feed"})})]})]})})})]})]})})}const jie=()=>{const l=rp();return L.useEffect(()=>{console.error("404 Error: User attempted to access non-existent route:",l.pathname)},[l.pathname]),v.jsx("div",{className:"flex min-h-screen items-center justify-center bg-gray-100",children:v.jsxs("div",{className:"text-center",children:[v.jsx("h1",{className:"mb-4 text-4xl font-bold",children:"404"}),v.jsx("p",{className:"mb-4 text-xl text-gray-600",children:"Oops! Page not found"}),v.jsx("a",{href:"/",className:"text-blue-500 underline hover:text-blue-700",children:"Return to Home"})]})})};var NR={exports:{}},Vie=NR.exports,rB;function Fie(){return rB||(rB=1,(function(l,p){(function(m,y){l.exports=y()})(Vie,(function(){function m(e,t){return t.forEach((function(n){n&&typeof n!="string"&&!Array.isArray(n)&&Object.keys(n).forEach((function(r){if(r!=="default"&&!(r in e)){var i=Object.getOwnPropertyDescriptor(n,r);Object.defineProperty(e,r,i.get?i:{enumerable:!0,get:function(){return n[r]}})}}))})),Object.freeze(e)}var y=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof hA<"u"?hA:typeof self<"u"?self:{};function R(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var C=function(e){try{return!!e()}catch{return!0}},P=!C((function(){var e=(function(){}).bind();return typeof e!="function"||e.hasOwnProperty("prototype")})),k=P,M=Function.prototype,F=M.call,H=k&&M.bind.bind(F,F),K=k?H:function(e){return function(){return F.apply(e,arguments)}},ee=K({}.isPrototypeOf),X=function(e){return e&&e.Math===Math&&e},re=X(typeof globalThis=="object"&&globalThis)||X(typeof window=="object"&&window)||X(typeof self=="object"&&self)||X(typeof y=="object"&&y)||X(typeof y=="object"&&y)||(function(){return this})()||Function("return this")(),G=P,J=Function.prototype,te=J.apply,ne=J.call,se=typeof Reflect=="object"&&Reflect.apply||(G?ne.bind(te):function(){return ne.apply(te,arguments)}),ae=K,pe=ae({}.toString),Se=ae("".slice),Te=function(e){return Se(pe(e),8,-1)},Ue=Te,tt=K,gt=function(e){if(Ue(e)==="Function")return tt(e)},ht=typeof document=="object"&&document.all,Ge=ht===void 0&&ht!==void 0?function(e){return typeof e=="function"||e===ht}:function(e){return typeof e=="function"},pt={},Fe=!C((function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!==7})),wt=P,rt=Function.prototype.call,Je=wt?rt.bind(rt):function(){return rt.apply(rt,arguments)},De={},Le={}.propertyIsEnumerable,ze=Object.getOwnPropertyDescriptor,fe=ze&&!Le.call({1:2},1);De.f=fe?function(e){var t=ze(this,e);return!!t&&t.enumerable}:Le;var Ne,st,it=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},Pt=C,zt=Te,Ye=Object,Nt=K("".split),Gt=Pt((function(){return!Ye("z").propertyIsEnumerable(0)}))?function(e){return zt(e)==="String"?Nt(e,""):Ye(e)}:Ye,Yt=function(e){return e==null},Cn=Yt,Yn=TypeError,er=function(e){if(Cn(e))throw new Yn("Can't call method on "+e);return e},ss=Gt,Ga=er,Ei=function(e){return ss(Ga(e))},ta=Ge,Sr=function(e){return typeof e=="object"?e!==null:ta(e)},ci={},Eo=ci,Gi=re,xl=Ge,Ws=function(e){return xl(e)?e:void 0},Vr=function(e,t){return arguments.length<2?Ws(Eo[e])||Ws(Gi[e]):Eo[e]&&Eo[e][t]||Gi[e]&&Gi[e][t]},uu=re.navigator,vi=uu&&uu.userAgent,ni=vi?String(vi):"",zc=re,Ll=ni,Gs=zc.process,Ha=zc.Deno,hu=Gs&&Gs.versions||Ha&&Ha.version,Yc=hu&&hu.v8;Yc&&(st=(Ne=Yc.split("."))[0]>0&&Ne[0]<4?1:+(Ne[0]+Ne[1])),!st&&Ll&&(!(Ne=Ll.match(/Edge\/(\d+)/))||Ne[1]>=74)&&(Ne=Ll.match(/Chrome\/(\d+)/))&&(st=+Ne[1]);var Di=st,pu=Di,vo=C,fu=re.String,yo=!!Object.getOwnPropertySymbols&&!vo((function(){var e=Symbol("symbol detection");return!fu(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&pu&&pu<41})),qc=yo&&!Symbol.sham&&typeof Symbol.iterator=="symbol",Ml=Vr,Ka=Ge,So=ee,Hs=Object,za=qc?function(e){return typeof e=="symbol"}:function(e){var t=Ml("Symbol");return Ka(t)&&So(t.prototype,Hs(e))},Xt=String,yn=function(e){try{return Xt(e)}catch{return"Object"}},qn=Ge,ki=yn,Hi=TypeError,Xn=function(e){if(qn(e))return e;throw new Hi(ki(e)+" is not a function")},Ks=Xn,li=Yt,os=function(e,t){var n=e[t];return li(n)?void 0:Ks(n)},Ul=Je,mu=Ge,_u=Sr,Um=TypeError,cv={exports:{}},lv=re,cw=Object.defineProperty,Xc=re,dv=function(e,t){try{cw(lv,e,{value:t,configurable:!0,writable:!0})}catch{lv[e]=t}return t},jm="__core-js_shared__",uv=cv.exports=Xc[jm]||dv(jm,{});(uv.versions||(uv.versions=[])).push({version:"3.42.0",mode:"pure",copyright:"© 2014-2025 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.42.0/LICENSE",source:"https://github.com/zloirock/core-js"});var ip=cv.exports,Vm=ip,Jc=function(e,t){return Vm[e]||(Vm[e]=t||{})},hv=er,lw=Object,To=function(e){return lw(hv(e))},Nr=To,dw=K({}.hasOwnProperty),Tr=Object.hasOwn||function(e,t){return dw(Nr(e),t)},pv=K,sp=0,uw=Math.random(),fv=pv(1 .toString),jl=function(e){return"Symbol("+(e===void 0?"":e)+")_"+fv(++sp+uw,36)},Ro=Jc,mv=Tr,zs=jl,hw=yo,pw=qc,Vl=re.Symbol,Fl=Ro("wks"),op=pw?Vl.for||Vl:Vl&&Vl.withoutSetter||zs,Mn=function(e){return mv(Fl,e)||(Fl[e]=hw&&mv(Vl,e)?Vl[e]:op("Symbol."+e)),Fl[e]},ap=Je,_v=Sr,gv=za,Fm=os,Ev=function(e,t){var n,r;if(mu(n=e.toString)&&!_u(r=Ul(n,e))||mu(n=e.valueOf)&&!_u(r=Ul(n,e)))return r;throw new Um("Can't convert object to primitive value")},Bm=TypeError,gu=Mn("toPrimitive"),fw=function(e,t){if(!_v(e)||gv(e))return e;var n,r=Fm(e,gu);if(r){if(n=ap(r,e,t),!_v(n)||gv(n))return n;throw new Bm("Can't convert object to primitive value")}return Ev(e)},Wm=za,Un=function(e){var t=fw(e,"string");return Wm(t)?t:t+""},Gm=Sr,cp=re.document,Hm=Gm(cp)&&Gm(cp.createElement),lp=function(e){return Hm?cp.createElement(e):{}},vv=lp,Km=!Fe&&!C((function(){return Object.defineProperty(vv("div"),"a",{get:function(){return 7}}).a!==7})),zm=Fe,dp=Je,Ya=De,qa=it,Xa=Ei,Eu=Un,vu=Tr,Ja=Km,yv=Object.getOwnPropertyDescriptor;pt.f=zm?yv:function(e,t){if(e=Xa(e),t=Eu(t),Ja)try{return yv(e,t)}catch{}if(vu(e,t))return qa(!dp(Ya.f,e,t),e[t])};var Sv=C,yu=Ge,mw=/#|\.prototype\./,Bl=function(e,t){var n=Tv[up(e)];return n===Su||n!==_w&&(yu(t)?Sv(t):!!t)},up=Bl.normalize=function(e){return String(e).replace(mw,".").toLowerCase()},Tv=Bl.data={},_w=Bl.NATIVE="N",Su=Bl.POLYFILL="P",Wl=Bl,Gl=Xn,hp=P,gw=gt(gt.bind),Qa=function(e,t){return Gl(e),t===void 0?e:hp?gw(e,t):function(){return e.apply(t,arguments)}},Ki={},Tu=Fe&&C((function(){return Object.defineProperty((function(){}),"prototype",{value:42,writable:!1}).prototype!==42})),Ym=Sr,Rv=String,Za=TypeError,di=function(e){if(Ym(e))return e;throw new Za(Rv(e)+" is not an object")},pp=Fe,wv=Km,fp=Tu,Qc=di,qm=Un,as=TypeError,$a=Object.defineProperty,Xm=Object.getOwnPropertyDescriptor,Zc="enumerable",Jm="configurable",Ru="writable";Ki.f=pp?fp?function(e,t,n){if(Qc(e),t=qm(t),Qc(n),typeof e=="function"&&t==="prototype"&&"value"in n&&Ru in n&&!n[Ru]){var r=Xm(e,t);r&&r[Ru]&&(e[t]=n.value,n={configurable:Jm in n?n[Jm]:r[Jm],enumerable:Zc in n?n[Zc]:r[Zc],writable:!1})}return $a(e,t,n)}:$a:function(e,t,n){if(Qc(e),t=qm(t),Qc(n),wv)try{return $a(e,t,n)}catch{}if("get"in n||"set"in n)throw new as("Accessors not supported");return"value"in n&&(e[t]=n.value),e};var Qm=Ki,wu=it,wo=Fe?function(e,t,n){return Qm.f(e,t,wu(1,n))}:function(e,t,n){return e[t]=n,e},Hl=re,Ew=se,vw=gt,yw=Ge,Zm=pt.f,Sw=Wl,Kl=ci,Tw=Qa,zl=wo,Cv=Tr,bv=function(e){var t=function(n,r,i){if(this instanceof t){switch(arguments.length){case 0:return new e;case 1:return new e(n);case 2:return new e(n,r)}return new e(n,r,i)}return Ew(e,this,arguments)};return t.prototype=e.prototype,t},Zt=function(e,t){var n,r,i,s,o,c,d,h,f,g=e.target,E=e.global,S=e.stat,O=e.proto,A=E?Hl:S?Hl[g]:Hl[g]&&Hl[g].prototype,N=E?Kl:Kl[g]||zl(Kl,g,{})[g],j=N.prototype;for(s in t)r=!(n=Sw(E?s:g+(S?".":"#")+s,e.forced))&&A&&Cv(A,s),c=N[s],r&&(d=e.dontCallGetSet?(f=Zm(A,s))&&f.value:A[s]),o=r&&d?d:t[s],(n||O||typeof c!=typeof o)&&(h=e.bind&&r?Tw(o,Hl):e.wrap&&r?bv(o):O&&yw(o)?vw(o):o,(e.sham||o&&o.sham||c&&c.sham)&&zl(h,"sham",!0),zl(N,s,h),O&&(Cv(Kl,i=g+"Prototype")||zl(Kl,i,{}),zl(Kl[i],s,o),e.real&&j&&(n||!j[s])&&zl(j,s,o)))},Rw=Math.ceil,ww=Math.floor,Cw=Math.trunc||function(e){var t=+e;return(t>0?ww:Rw)(t)},$m=Cw,e_=function(e){var t=+e;return t!=t||t===0?0:$m(t)},bw=e_,Iw=Math.max,Iv=Math.min,t_=function(e,t){var n=bw(e);return n<0?Iw(n+t,0):Iv(n,t)},Aw=e_,Nw=Math.min,Av=function(e){var t=Aw(e);return t>0?Nw(t,9007199254740991):0},Ow=Av,ec=function(e){return Ow(e.length)},Pw=Ei,n_=t_,Cu=ec,Nv=function(e){return function(t,n,r){var i=Pw(t),s=Cu(i);if(s===0)return!e&&-1;var o,c=n_(r,s);if(e&&n!=n){for(;s>c;)if((o=i[c++])!=o)return!0}else for(;s>c;c++)if((e||c in i)&&i[c]===n)return e||c||0;return!e&&-1}},mp={includes:Nv(!0),indexOf:Nv(!1)},Ov=mp.includes;Zt({target:"Array",proto:!0,forced:C((function(){return!Array(1).includes()}))},{includes:function(e){return Ov(this,e,arguments.length>1?arguments[1]:void 0)}});var Pv=re,Dv=ci,cs=function(e,t){var n=Dv[e+"Prototype"],r=n&&n[t];if(r)return r;var i=Pv[e],s=i&&i.prototype;return s&&s[t]},Yl=cs("Array","includes"),Dw=Sr,kw=Te,xw=Mn("match"),r_=function(e){var t;return Dw(e)&&((t=e[xw])!==void 0?!!t:kw(e)==="RegExp")},kv=r_,bu=TypeError,ql={};ql[Mn("toStringTag")]="z";var i_=String(ql)==="[object z]",_p=i_,Lw=Ge,Iu=Te,s_=Mn("toStringTag"),o_=Object,xv=Iu((function(){return arguments})())==="Arguments",na=_p?Iu:function(e){var t,n,r;return e===void 0?"Undefined":e===null?"Null":typeof(n=(function(i,s){try{return i[s]}catch{}})(t=o_(e),s_))=="string"?n:xv?Iu(t):(r=Iu(t))==="Object"&&Lw(t.callee)?"Arguments":r},Lv=na,Mw=String,zi=function(e){if(Lv(e)==="Symbol")throw new TypeError("Cannot convert a Symbol value to a string");return Mw(e)},Uw=Mn("match"),jw=Zt,Vw=function(e){if(kv(e))throw new bu("The method doesn't accept regular expressions");return e},Ys=er,Xl=zi,Mv=function(e){var t=/./;try{"/./"[e](t)}catch{try{return t[Uw]=!1,"/./"[e](t)}catch{}}return!1},Uv=K("".indexOf);jw({target:"String",proto:!0,forced:!Mv("includes")},{includes:function(e){return!!~Uv(Xl(Ys(this)),Xl(Vw(e)),arguments.length>1?arguments[1]:void 0)}});var jv=cs("String","includes"),a_=ee,c_=Yl,Fw=jv,l_=Array.prototype,tc=String.prototype,d_=function(e){var t=e.includes;return e===l_||a_(l_,e)&&t===l_.includes?c_:typeof e=="string"||e===tc||a_(tc,e)&&t===tc.includes?Fw:t},be=R(d_),u_=Xn,Vv=To,gp=Gt,Jl=ec,Ep=TypeError,h_="Reduce of empty array with no initial value",vp=function(e){return function(t,n,r,i){var s=Vv(t),o=gp(s),c=Jl(s);if(u_(n),c===0&&r<2)throw new Ep(h_);var d=e?c-1:0,h=e?-1:1;if(r<2)for(;;){if(d in o){i=o[d],d+=h;break}if(d+=h,e?d<0:c<=d)throw new Ep(h_)}for(;e?d>=0:c>d;d+=h)d in o&&(i=n(i,o[d],d,s));return i}},Fv={left:vp(!1)},Bv=C,Au=function(e,t){var n=[][e];return!!n&&Bv((function(){n.call(null,t||function(){return 1},1)}))},Ql=re,Wv=ni,Gv=Te,qs=function(e){return Wv.slice(0,e.length)===e},Nu=qs("Bun/")?"BUN":qs("Cloudflare-Workers")?"CLOUDFLARE":qs("Deno/")?"DENO":qs("Node.js/")?"NODE":Ql.Bun&&typeof Bun.version=="string"?"BUN":Ql.Deno&&typeof Deno.version=="object"?"DENO":Gv(Ql.process)==="process"?"NODE":Ql.window&&Ql.document?"BROWSER":"REST",Zl=Nu==="NODE",Bw=Fv.left;Zt({target:"Array",proto:!0,forced:!Zl&&Di>79&&Di<83||!Au("reduce")},{reduce:function(e){var t=arguments.length;return Bw(this,e,t,t>1?arguments[1]:void 0)}});var Ww=cs("Array","reduce"),Ou=ee,Gw=Ww,yp=Array.prototype,Hv=function(e){var t=e.reduce;return e===yp||Ou(yp,e)&&t===yp.reduce?Gw:t},tr=Hv,Yi=R(tr),Sp=Te,ra=Array.isArray||function(e){return Sp(e)==="Array"},Kv=Zt,p_=ra,Pu=K([].reverse),Du=[1,2];Kv({target:"Array",proto:!0,forced:String(Du)===String(Du.reverse())},{reverse:function(){return p_(this)&&(this.length=this.length),Pu(this)}});var $l=cs("Array","reverse"),zv=ee,Hw=$l,f_=Array.prototype,Yv=function(e){var t=e.reverse;return e===f_||zv(f_,e)&&t===f_.reverse?Hw:t},ku=Yv,xu=R(ku),m_=jl,Tp=Jc("keys"),ed=function(e){return Tp[e]||(Tp[e]=m_(e))},__=!C((function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype})),Kw=Tr,qv=Ge,zw=To,Yw=__,Rp=ed("IE_PROTO"),Co=Object,Xv=Co.prototype,nc=Yw?Co.getPrototypeOf:function(e){var t=zw(e);if(Kw(t,Rp))return t[Rp];var n=t.constructor;return qv(n)&&t instanceof n?n.prototype:t instanceof Co?Xv:null},bo=K,Lu=Xn,ia=Sr,g_=function(e){return ia(e)||e===null},qw=String,Xw=TypeError,$c=function(e,t,n){try{return bo(Lu(Object.getOwnPropertyDescriptor(e,t)[n]))}catch{}},Mu=Sr,td=er,wp=function(e){if(g_(e))return e;throw new Xw("Can't set "+qw(e)+" as a prototype")},E_=Object.setPrototypeOf||("__proto__"in{}?(function(){var e,t=!1,n={};try{(e=$c(Object.prototype,"__proto__","set"))(n,[]),t=n instanceof Array}catch{}return function(r,i){return td(r),wp(i),Mu(r)&&(t?e(r,i):r.__proto__=i),r}})():void 0),sa={},Xs={},Jn=Tr,nr=Ei,rc=mp.indexOf,yi=Xs,xi=K([].push),ic=function(e,t){var n,r=nr(e),i=0,s=[];for(n in r)!Jn(yi,n)&&Jn(r,n)&&xi(s,n);for(;t.length>i;)Jn(r,n=t[i++])&&(~rc(s,n)||xi(s,n));return s},sc=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],qi=ic,Cp=sc.concat("length","prototype");sa.f=Object.getOwnPropertyNames||function(e){return qi(e,Cp)};var nd={};nd.f=Object.getOwnPropertySymbols;var Jv=Vr,bp=sa,Qv=nd,oa=di,Ip=K([].concat),v_=Jv("Reflect","ownKeys")||function(e){var t=bp.f(oa(e)),n=Qv.f;return n?Ip(t,n(e)):t},y_=Tr,Jw=v_,oc=pt,rd=Ki,ac={},Ap=ic,Np=sc,Li=Object.keys||function(e){return Ap(e,Np)},ys=Fe,el=Tu,aa=Ki,ca=di,tl=Ei,Zv=Li;ac.f=ys&&!el?Object.defineProperties:function(e,t){ca(e);for(var n,r=tl(t),i=Zv(t),s=i.length,o=0;s>o;)aa.f(e,n=i[o++],r[n]);return e};var id,Op=Vr("document","documentElement"),ls=di,ds=ac,ar=sc,Js=Xs,$v=Op,ey=lp,Uu="prototype",ju="script",S_=ed("IE_PROTO"),sd=function(){},T_=function(e){return"<"+ju+">"+e+"</"+ju+">"},nl=function(e){e.write(T_("")),e.close();var t=e.parentWindow.Object;return e=null,t},od=function(){try{id=new ActiveXObject("htmlfile")}catch{}var e,t,n;od=typeof document<"u"?document.domain&&id?nl(id):(t=ey("iframe"),n="java"+ju+":",t.style.display="none",$v.appendChild(t),t.src=String(n),(e=t.contentWindow.document).open(),e.write(T_("document.F=Object")),e.close(),e.F):nl(id);for(var r=ar.length;r--;)delete od[Uu][ar[r]];return od()};Js[S_]=!0;var Vu=Object.create||function(e,t){var n;return e!==null?(sd[Uu]=ls(e),n=new sd,sd[Uu]=null,n[S_]=e):n=od(),t===void 0?n:ds.f(n,t)},Fu=Sr,Pp=wo,R_=Error,ty=K("".replace),ad=String(new R_("zxcasd").stack),w_=/\n\s*at [^:]*:[^\n]*/,Dp=w_.test(ad),kp=it,cd=!C((function(){var e=new Error("a");return!("stack"in e)||(Object.defineProperty(e,"stack",kp(1,7)),e.stack!==7)})),C_=wo,b_=function(e,t){if(Dp&&typeof e=="string"&&!R_.prepareStackTrace)for(;t--;)e=ty(e,w_,"");return e},I_=cd,xp=Error.captureStackTrace,Qs={},Ss=Qs,rl=Mn("iterator"),A_=Array.prototype,N_=function(e){return e!==void 0&&(Ss.Array===e||A_[rl]===e)},la=na,da=os,O_=Yt,ny=Qs,ua=Mn("iterator"),Zs=function(e){if(!O_(e))return da(e,ua)||da(e,"@@iterator")||ny[la(e)]},Lp=Je,ry=Xn,Mp=di,iy=yn,Bu=Zs,Io=TypeError,il=function(e,t){var n=arguments.length<2?Bu(e):t;if(ry(n))return Mp(Lp(n,e));throw new Io(iy(e)+" is not iterable")},Wu=Je,cc=di,P_=os,sl=function(e,t,n){var r,i;cc(e);try{if(!(r=P_(e,"return"))){if(t==="throw")throw n;return n}r=Wu(r,e)}catch(s){i=!0,r=s}if(t==="throw")throw n;if(i)throw r;return cc(r),n},sy=Qa,D_=Je,mr=di,Up=yn,k_=N_,x_=ec,Gu=ee,L_=il,ol=Zs,hr=sl,zr=TypeError,Or=function(e,t){this.stopped=e,this.result=t},Hu=Or.prototype,ha=function(e,t,n){var r,i,s,o,c,d,h,f=n&&n.that,g=!(!n||!n.AS_ENTRIES),E=!(!n||!n.IS_RECORD),S=!(!n||!n.IS_ITERATOR),O=!(!n||!n.INTERRUPTED),A=sy(t,f),N=function(U){return r&&hr(r,"normal",U),new Or(!0,U)},j=function(U){return g?(mr(U),O?A(U[0],U[1],N):A(U[0],U[1])):O?A(U,N):A(U)};if(E)r=e.iterator;else if(S)r=e;else{if(!(i=ol(e)))throw new zr(Up(e)+" is not iterable");if(k_(i)){for(s=0,o=x_(e);o>s;s++)if((c=j(e[s]))&&Gu(Hu,c))return c;return new Or(!1)}r=L_(e,i)}for(d=E?e.next:r.next;!(h=D_(d,r)).done;){try{c=j(h.value)}catch(U){hr(r,"throw",U)}if(typeof c=="object"&&c&&Gu(Hu,c))return c}return new Or(!1)},Ku=zi,Qw=Zt,Si=ee,M_=nc,ld=E_,U_=function(e,t,n){for(var r=Jw(t),i=rd.f,s=oc.f,o=0;o<r.length;o++){var c=r[o];y_(e,c)||n&&y_(n,c)||i(e,c,s(t,c))}},$s=Vu,Xi=wo,al=it,j_=function(e,t){Fu(t)&&"cause"in t&&Pp(e,"cause",t.cause)},V_=function(e,t,n,r){I_&&(xp?xp(e,t):C_(e,"stack",b_(n,r)))},oy=ha,ay=function(e,t){return e===void 0?arguments.length<2?"":t:Ku(e)},cy=Mn("toStringTag"),zu=Error,ly=[].push,cl=function(e,t){var n,r=Si(jp,this);ld?n=ld(new zu,r?M_(this):jp):(n=r?this:$s(jp),Xi(n,cy,"Error")),t!==void 0&&Xi(n,"message",ay(t)),V_(n,cl,n.stack,1),arguments.length>2&&j_(n,arguments[2]);var i=[];return oy(e,ly,{that:i}),Xi(n,"errors",i),n};ld?ld(cl,zu):U_(cl,zu,{name:!0});var jp=cl.prototype=$s(zu.prototype,{constructor:al(1,cl),message:al(1,""),name:al(1,"AggregateError")});Qw({global:!0},{AggregateError:cl});var Yu,pa,qu,Vp=Ge,Xu=re.WeakMap,dy=Vp(Xu)&&/native code/.test(String(Xu)),Fp=re,uy=Sr,hy=wo,Bp=Tr,Wp=ip,F_=ed,py=Xs,B_="Object already initialized",Gp=Fp.TypeError,Zw=Fp.WeakMap;if(dy||Wp.state){var eo=Wp.state||(Wp.state=new Zw);eo.get=eo.get,eo.has=eo.has,eo.set=eo.set,Yu=function(e,t){if(eo.has(e))throw new Gp(B_);return t.facade=e,eo.set(e,t),t},pa=function(e){return eo.get(e)||{}},qu=function(e){return eo.has(e)}}else{var dd=F_("state");py[dd]=!0,Yu=function(e,t){if(Bp(e,dd))throw new Gp(B_);return t.facade=e,hy(e,dd,t),t},pa=function(e){return Bp(e,dd)?e[dd]:{}},qu=function(e){return Bp(e,dd)}}var ll,W_,G_,lc={set:Yu,get:pa,has:qu,enforce:function(e){return qu(e)?pa(e):Yu(e,{})},getterFor:function(e){return function(t){var n;if(!uy(t)||(n=pa(t)).type!==e)throw new Gp("Incompatible receiver, "+e+" required");return n}}},ud=Fe,$w=Tr,fy=Function.prototype,eC=ud&&Object.getOwnPropertyDescriptor,Ts=$w(fy,"name"),Hp={PROPER:Ts&&(function(){}).name==="something",CONFIGURABLE:Ts&&(!ud||ud&&eC(fy,"name").configurable)},Kp=wo,fa=function(e,t,n,r){return r&&r.enumerable?e[t]=n:Kp(e,t,n),e},my=C,_y=Ge,H_=Sr,hd=Vu,zp=nc,K_=fa,z_=Mn("iterator"),Y_=!1;[].keys&&("next"in(G_=[].keys())?(W_=zp(zp(G_)))!==Object.prototype&&(ll=W_):Y_=!0);var gy=!H_(ll)||my((function(){var e={};return ll[z_].call(e)!==e}));_y((ll=gy?{}:hd(ll))[z_])||K_(ll,z_,(function(){return this}));var q_={IteratorPrototype:ll,BUGGY_SAFARI_ITERATORS:Y_},Ey=na,vy=i_?{}.toString:function(){return"[object "+Ey(this)+"]"},tC=i_,Ji=Ki.f,Mi=wo,yy=Tr,Sy=vy,X_=Mn("toStringTag"),Ao=function(e,t,n,r){var i=n?e:e&&e.prototype;i&&(yy(i,X_)||Ji(i,X_,{configurable:!0,value:t}),r&&!tC&&Mi(i,"toString",Sy))},Ty=q_.IteratorPrototype,J_=Vu,Ry=it,Q_=Ao,wy=Qs,Cy=function(){return this},Ju=function(e,t,n,r){var i=t+" Iterator";return e.prototype=J_(Ty,{next:Ry(+!r,n)}),Q_(e,i,!1,!0),wy[i]=Cy,e},Z_=Zt,by=Je,$_=Hp,Yp=Ju,nC=nc,Iy=Ao,qp=fa,eg=Qs,Xp=q_,ma=$_.PROPER,Jp=Xp.BUGGY_SAFARI_ITERATORS,Qp=Mn("iterator"),Zp="keys",Qu="values",tg="entries",Zu=function(){return this},ui=function(e,t,n,r,i,s,o){Yp(n,t,r);var c,d,h,f=function(j){if(j===i&&A)return A;if(!Jp&&j&&j in S)return S[j];switch(j){case Zp:case Qu:case tg:return function(){return new n(this,j)}}return function(){return new n(this)}},g=t+" Iterator",E=!1,S=e.prototype,O=S[Qp]||S["@@iterator"]||i&&S[i],A=!Jp&&O||f(i),N=t==="Array"&&S.entries||O;if(N&&(c=nC(N.call(new e)))!==Object.prototype&&c.next&&(Iy(c,g,!0,!0),eg[g]=Zu),ma&&i===Qu&&O&&O.name!==Qu&&(E=!0,A=function(){return by(O,this)}),i)if(d={values:f(Qu),keys:s?A:f(Zp),entries:f(tg)},o)for(h in d)(Jp||E||!(h in S))&&qp(S,h,d[h]);else Z_({target:t,proto:!0,forced:Jp||E},d);return o&&S[Qp]!==A&&qp(S,Qp,A,{}),eg[t]=A,d},$p=function(e,t){return{value:e,done:t}},rC=Ei,$u=Qs,hi=lc;Ki.f;var iC=ui,_t=$p,dl="Array Iterator",ng=hi.set,Ay=hi.getterFor(dl);iC(Array,"Array",(function(e,t){ng(this,{type:dl,target:rC(e),index:0,kind:t})}),(function(){var e=Ay(this),t=e.target,n=e.index++;if(!t||n>=t.length)return e.target=null,_t(void 0,!0);switch(e.kind){case"keys":return _t(n,!1);case"values":return _t(t[n],!1)}return _t([n,t[n]],!1)}),"values"),$u.Arguments=$u.Array;var sC=Ki,dc=function(e,t,n){return sC.f(e,t,n)},ef=Vr,rg=dc,Ny=Fe,ig=Mn("species"),Oy=ee,sg=TypeError,eh=function(e,t){if(Oy(t,e))return e;throw new sg("Incorrect invocation")},pi=Ge,us=ip,uc=K(Function.toString);pi(us.inspectSource)||(us.inspectSource=function(e){return uc(e)});var og=us.inspectSource,Py=K,to=C,ag=Ge,No=na,oC=og,cg=function(){},lg=Vr("Reflect","construct"),tf=/^\s*(?:class|function)\b/,Dy=Py(tf.exec),aC=!tf.test(cg),hc=function(e){if(!ag(e))return!1;try{return lg(cg,[],e),!0}catch{return!1}},nf=function(e){if(!ag(e))return!1;switch(No(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return aC||!!Dy(tf,oC(e))}catch{return!0}};nf.sham=!0;var Ti,mn,Yr,Rr,Fr=!lg||to((function(){var e;return hc(hc.call)||!hc(Object)||!hc((function(){e=!0}))||e}))?nf:hc,hs=Fr,pd=yn,qr=TypeError,fd=di,ul=function(e){if(hs(e))return e;throw new qr(pd(e)+" is not a constructor")},rf=Yt,dg=Mn("species"),hl=function(e,t){var n,r=fd(e).constructor;return r===void 0||rf(n=fd(r)[dg])?t:ul(n)},Pr=K([].slice),ug=TypeError,Rs=function(e,t){if(e<t)throw new ug("Not enough arguments");return e},Oo=/(?:ipad|iphone|ipod).*applewebkit/i.test(ni),Ri=re,hg=se,pc=Qa,th=Ge,fc=Tr,nh=C,md=Op,pg=Pr,rh=lp,sf=Rs,Ui=Oo,mc=Zl,ps=Ri.setImmediate,wi=Ri.clearImmediate,ky=Ri.process,ih=Ri.Dispatch,fg=Ri.Function,xy=Ri.MessageChannel,_c=Ri.String,of=0,pl={},gc="onreadystatechange";nh((function(){Ti=Ri.location}));var sh=function(e){if(fc(pl,e)){var t=pl[e];delete pl[e],t()}},_a=function(e){return function(){sh(e)}},mg=function(e){sh(e.data)},_g=function(e){Ri.postMessage(_c(e),Ti.protocol+"//"+Ti.host)};ps&&wi||(ps=function(e){sf(arguments.length,1);var t=th(e)?e:fg(e),n=pg(arguments,1);return pl[++of]=function(){hg(t,void 0,n)},mn(of),of},wi=function(e){delete pl[e]},mc?mn=function(e){ky.nextTick(_a(e))}:ih&&ih.now?mn=function(e){ih.now(_a(e))}:xy&&!Ui?(Rr=(Yr=new xy).port2,Yr.port1.onmessage=mg,mn=pc(Rr.postMessage,Rr)):Ri.addEventListener&&th(Ri.postMessage)&&!Ri.importScripts&&Ti&&Ti.protocol!=="file:"&&!nh(_g)?(mn=_g,Ri.addEventListener("message",mg,!1)):mn=gc in rh("script")?function(e){md.appendChild(rh("script"))[gc]=function(){md.removeChild(this),sh(e)}}:function(e){setTimeout(_a(e),0)});var _d={set:ps,clear:wi},oh=re,cC=Fe,lC=Object.getOwnPropertyDescriptor,gg=function(e){if(!cC)return oh[e];var t=lC(oh,e);return t&&t.value},Eg=function(){this.head=null,this.tail=null};Eg.prototype={add:function(e){var t={item:e,next:null},n=this.tail;n?n.next=t:this.head=t,this.tail=t},get:function(){var e=this.head;if(e)return(this.head=e.next)===null&&(this.tail=null),e.item}};var ws,vg,Ec,af,_r,Ly=Eg,My=/ipad|iphone|ipod/i.test(ni)&&typeof Pebble<"u",dC=/web0s(?!.*chrome)/i.test(ni),gd=re,Uy=gg,yg=Qa,Sg=_d.set,Cs=Ly,Tg=Oo,uC=My,vc=dC,Ed=Zl,yc=gd.MutationObserver||gd.WebKitMutationObserver,ah=gd.document,cf=gd.process,vd=gd.Promise,Rg=Uy("queueMicrotask");if(!Rg){var yd=new Cs,lf=function(){var e,t;for(Ed&&(e=cf.domain)&&e.exit();t=yd.get();)try{t()}catch(n){throw yd.head&&ws(),n}e&&e.enter()};Tg||Ed||vc||!yc||!ah?!uC&&vd&&vd.resolve?((af=vd.resolve(void 0)).constructor=vd,_r=yg(af.then,af),ws=function(){_r(lf)}):Ed?ws=function(){cf.nextTick(lf)}:(Sg=yg(Sg,gd),ws=function(){Sg(lf)}):(vg=!0,Ec=ah.createTextNode(""),new yc(lf).observe(Ec,{characterData:!0}),ws=function(){Ec.data=vg=!vg}),Rg=function(e){yd.head||ws(),yd.add(e)}}var wg=Rg,fl=function(e){try{return{error:!1,value:e()}}catch(t){return{error:!0,value:t}}},Po=re.Promise,df=re,Sd=Po,Cg=Ge,hC=Wl,jy=og,bg=Mn,ch=Nu,lh=Di,dh=Sd&&Sd.prototype,Vy=bg("species"),Fy=Cg(df.PromiseRejectionEvent),uf=hC("Promise",(function(){var e=jy(Sd),t=e!==String(Sd);if(!t&&lh===66||!dh.catch||!dh.finally)return!0;if(!lh||lh<51||!/native code/.test(e)){var n=new Sd((function(i){i(1)})),r=function(i){i((function(){}),(function(){}))};if((n.constructor={})[Vy]=r,!(n.then((function(){}))instanceof r))return!0}return!(t||ch!=="BROWSER"&&ch!=="DENO"||Fy)})),uh={CONSTRUCTOR:uf,REJECTION_EVENT:Fy},Qi={},By=Xn,hf=TypeError,a=function(e){var t,n;this.promise=new e((function(r,i){if(t!==void 0||n!==void 0)throw new hf("Bad Promise constructor");t=r,n=i})),this.resolve=By(t),this.reject=By(n)};Qi.f=function(e){return new a(e)};var u,_,T=Zt,I=Zl,D=re,q=Je,ce=fa,he=Ao,Oe=function(e){var t=ef(e);Ny&&t&&!t[ig]&&rg(t,ig,{configurable:!0,get:function(){return this}})},Ke=Xn,qe=Ge,He=Sr,ft=eh,yt=hl,Tt=_d.set,gr=wg,ye=function(e,t){try{arguments.length===1?console.error(e):console.error(e,t)}catch{}},me=fl,Ie=Ly,Qe=lc,Rt=Po,kt=uh,xt=Qi,Vt="Promise",Xr=kt.CONSTRUCTOR,kn=kt.REJECTION_EVENT,Do=Qe.getterFor(Vt),pC=Qe.set,fW=Rt&&Rt.prototype,Ig=Rt,fC=fW,BN=D.TypeError,mC=D.document,_C=D.process,gC=xt.f,mW=gC,_W=!!(mC&&mC.createEvent&&D.dispatchEvent),WN="unhandledrejection",GN=function(e){var t;return!(!He(e)||!qe(t=e.then))&&t},HN=function(e,t){var n,r,i,s=t.value,o=t.state===1,c=o?e.ok:e.fail,d=e.resolve,h=e.reject,f=e.domain;try{c?(o||(t.rejection===2&&EW(t),t.rejection=1),c===!0?n=s:(f&&f.enter(),n=c(s),f&&(f.exit(),i=!0)),n===e.promise?h(new BN("Promise-chain cycle")):(r=GN(n))?q(r,n,d,h):d(n)):h(s)}catch(g){f&&!i&&f.exit(),h(g)}},KN=function(e,t){e.notified||(e.notified=!0,gr((function(){for(var n,r=e.reactions;n=r.get();)HN(n,e);e.notified=!1,t&&!e.rejection&&gW(e)})))},zN=function(e,t,n){var r,i;_W?((r=mC.createEvent("Event")).promise=t,r.reason=n,r.initEvent(e,!1,!0),D.dispatchEvent(r)):r={promise:t,reason:n},!kn&&(i=D["on"+e])?i(r):e===WN&&ye("Unhandled promise rejection",n)},gW=function(e){q(Tt,D,(function(){var t,n=e.facade,r=e.value;if(YN(e)&&(t=me((function(){I?_C.emit("unhandledRejection",r,n):zN(WN,n,r)})),e.rejection=I||YN(e)?2:1,t.error))throw t.value}))},YN=function(e){return e.rejection!==1&&!e.parent},EW=function(e){q(Tt,D,(function(){var t=e.facade;I?_C.emit("rejectionHandled",t):zN("rejectionhandled",t,e.value)}))},pf=function(e,t,n){return function(r){e(t,r,n)}},ff=function(e,t,n){e.done||(e.done=!0,n&&(e=n),e.value=t,e.state=2,KN(e,!0))},EC=function(e,t,n){if(!e.done){e.done=!0,n&&(e=n);try{if(e.facade===t)throw new BN("Promise can't be resolved itself");var r=GN(t);r?gr((function(){var i={done:!1};try{q(r,t,pf(EC,i,e),pf(ff,i,e))}catch(s){ff(i,s,e)}})):(e.value=t,e.state=1,KN(e,!1))}catch(i){ff({done:!1},i,e)}}};Xr&&(fC=(Ig=function(e){ft(this,fC),Ke(e),q(u,this);var t=Do(this);try{e(pf(EC,t),pf(ff,t))}catch(n){ff(t,n)}}).prototype,(u=function(e){pC(this,{type:Vt,done:!1,notified:!1,parent:!1,reactions:new Ie,rejection:!1,state:0,value:null})}).prototype=ce(fC,"then",(function(e,t){var n=Do(this),r=gC(yt(this,Ig));return n.parent=!0,r.ok=!qe(e)||e,r.fail=qe(t)&&t,r.domain=I?_C.domain:void 0,n.state===0?n.reactions.add(r):gr((function(){HN(r,n)})),r.promise})),_=function(){var e=new u,t=Do(e);this.promise=e,this.resolve=pf(EC,t),this.reject=pf(ff,t)},xt.f=gC=function(e){return e===Ig||e===void 0?new _(e):mW(e)}),T({global:!0,wrap:!0,forced:Xr},{Promise:Ig}),he(Ig,Vt,!1,!0),Oe(Vt);var qN=Mn("iterator"),XN=!1;try{var vW=0,JN={next:function(){return{done:!!vW++}},return:function(){XN=!0}};JN[qN]=function(){return this},Array.from(JN,(function(){throw 2}))}catch{}var yW=Po,SW=function(e,t){try{if(!t&&!XN)return!1}catch{return!1}var n=!1;try{var r={};r[qN]=function(){return{next:function(){return{done:n=!0}}}},e(r)}catch{}return n},Wy=uh.CONSTRUCTOR||!SW((function(e){yW.all(e).then(void 0,(function(){}))})),TW=Je,RW=Xn,wW=Qi,CW=fl,bW=ha;Zt({target:"Promise",stat:!0,forced:Wy},{all:function(e){var t=this,n=wW.f(t),r=n.resolve,i=n.reject,s=CW((function(){var o=RW(t.resolve),c=[],d=0,h=1;bW(e,(function(f){var g=d++,E=!1;h++,TW(o,t,f).then((function(S){E||(E=!0,c[g]=S,--h||r(c))}),i)})),--h||r(c)}));return s.error&&i(s.value),n.promise}});var IW=Zt,AW=uh.CONSTRUCTOR;Po&&Po.prototype,IW({target:"Promise",proto:!0,forced:AW,real:!0},{catch:function(e){return this.then(void 0,e)}});var NW=Je,OW=Xn,PW=Qi,DW=fl,kW=ha;Zt({target:"Promise",stat:!0,forced:Wy},{race:function(e){var t=this,n=PW.f(t),r=n.reject,i=DW((function(){var s=OW(t.resolve);kW(e,(function(o){NW(s,t,o).then(n.resolve,r)}))}));return i.error&&r(i.value),n.promise}});var xW=Qi;Zt({target:"Promise",stat:!0,forced:uh.CONSTRUCTOR},{reject:function(e){var t=xW.f(this);return(0,t.reject)(e),t.promise}});var LW=di,MW=Sr,UW=Qi,QN=function(e,t){if(LW(e),MW(t)&&t.constructor===e)return t;var n=UW.f(e);return(0,n.resolve)(t),n.promise},jW=Zt,VW=Po,FW=uh.CONSTRUCTOR,BW=QN,WW=Vr("Promise"),GW=!FW;jW({target:"Promise",stat:!0,forced:!0},{resolve:function(e){return BW(GW&&this===WW?VW:this,e)}});var HW=Je,KW=Xn,zW=Qi,YW=fl,qW=ha;Zt({target:"Promise",stat:!0,forced:Wy},{allSettled:function(e){var t=this,n=zW.f(t),r=n.resolve,i=n.reject,s=YW((function(){var o=KW(t.resolve),c=[],d=0,h=1;qW(e,(function(f){var g=d++,E=!1;h++,HW(o,t,f).then((function(S){E||(E=!0,c[g]={status:"fulfilled",value:S},--h||r(c))}),(function(S){E||(E=!0,c[g]={status:"rejected",reason:S},--h||r(c))}))})),--h||r(c)}));return s.error&&i(s.value),n.promise}});var XW=Je,JW=Xn,QW=Vr,ZW=Qi,$W=fl,eG=ha,ZN="No one promise resolved";Zt({target:"Promise",stat:!0,forced:Wy},{any:function(e){var t=this,n=QW("AggregateError"),r=ZW.f(t),i=r.resolve,s=r.reject,o=$W((function(){var c=JW(t.resolve),d=[],h=0,f=1,g=!1;eG(e,(function(E){var S=h++,O=!1;f++,XW(c,t,E).then((function(A){O||g||(g=!0,i(A))}),(function(A){O||g||(O=!0,d[S]=A,--f||s(new n(d,ZN)))}))})),--f||s(new n(d,ZN))}));return o.error&&s(o.value),r.promise}});var tG=Zt,nG=se,rG=Pr,iG=Qi,sG=Xn,$N=fl,vC=re.Promise,eO=!1;tG({target:"Promise",stat:!0,forced:!vC||!vC.try||$N((function(){vC.try((function(e){eO=e===8}),8)})).error||!eO},{try:function(e){var t=arguments.length>1?rG(arguments,1):[],n=iG.f(this),r=$N((function(){return nG(sG(e),void 0,t)}));return(r.error?n.reject:n.resolve)(r.value),n.promise}});var oG=Qi;Zt({target:"Promise",stat:!0},{withResolvers:function(){var e=oG.f(this);return{promise:e.promise,resolve:e.resolve,reject:e.reject}}});var aG=Zt,yC=Po,cG=C,lG=Vr,dG=Ge,uG=hl,tO=QN,hG=yC&&yC.prototype;aG({target:"Promise",proto:!0,real:!0,forced:!!yC&&cG((function(){hG.finally.call({then:function(){}},(function(){}))}))},{finally:function(e){var t=uG(this,lG("Promise")),n=dG(e);return this.then(n?function(r){return tO(t,e()).then((function(){return r}))}:e,n?function(r){return tO(t,e()).then((function(){throw r}))}:e)}});var SC=K,pG=e_,fG=zi,mG=er,_G=SC("".charAt),nO=SC("".charCodeAt),gG=SC("".slice),rO=function(e){return function(t,n){var r,i,s=fG(mG(t)),o=pG(n),c=s.length;return o<0||o>=c?e?"":void 0:(r=nO(s,o))<55296||r>56319||o+1===c||(i=nO(s,o+1))<56320||i>57343?e?_G(s,o):r:e?gG(s,o,o+2):i-56320+(r-55296<<10)+65536}},TC={codeAt:rO(!1),charAt:rO(!0)},EG=TC.charAt,vG=zi,iO=lc,yG=ui,sO=$p,oO="String Iterator",SG=iO.set,TG=iO.getterFor(oO);yG(String,"String",(function(e){SG(this,{type:oO,string:vG(e),index:0})}),(function(){var e,t=TG(this),n=t.string,r=t.index;return r>=n.length?sO(void 0,!0):(e=EG(n,r),t.index+=e.length,sO(e,!1))}));var RG=ci.Promise,wG={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},CG=re,bG=Ao,aO=Qs;for(var RC in wG)bG(CG[RC],RC),aO[RC]=aO.Array;var cO=RG,ke=R(cO),IG=cs("Array","values"),AG=na,NG=Tr,OG=ee,PG=IG,wC=Array.prototype,DG={DOMTokenList:!0,NodeList:!0},kG=function(e){var t=e.values;return e===wC||OG(wC,e)&&t===wC.values||NG(DG,AG(e))?PG:t},fs=R(kG),lO=yn,xG=TypeError,dO=Pr,LG=Math.floor,CC=function(e,t){var n=e.length;if(n<8)for(var r,i,s=1;s<n;){for(i=s,r=e[s];i&&t(e[i-1],r)>0;)e[i]=e[--i];i!==s++&&(e[i]=r)}else for(var o=LG(n/2),c=CC(dO(e,0,o),t),d=CC(dO(e,o),t),h=c.length,f=d.length,g=0,E=0;g<h||E<f;)e[g+E]=g<h&&E<f?t(c[g],d[E])<=0?c[g++]:d[E++]:g<h?c[g++]:d[E++];return e},uO=CC,hO=ni.match(/firefox\/(\d+)/i),MG=!!hO&&+hO[1],UG=/MSIE|Trident/.test(ni),pO=ni.match(/AppleWebKit\/(\d+)\./),jG=!!pO&&+pO[1],VG=Zt,fO=K,FG=Xn,BG=To,mO=ec,WG=function(e,t){if(!delete e[t])throw new xG("Cannot delete property "+lO(t)+" of "+lO(e))},_O=zi,bC=C,GG=uO,HG=Au,gO=MG,KG=UG,EO=Di,vO=jG,Td=[],yO=fO(Td.sort),zG=fO(Td.push),YG=bC((function(){Td.sort(void 0)})),qG=bC((function(){Td.sort(null)})),XG=HG("sort"),SO=!bC((function(){if(EO)return EO<70;if(!(gO&&gO>3)){if(KG)return!0;if(vO)return vO<603;var e,t,n,r,i="";for(e=65;e<76;e++){switch(t=String.fromCharCode(e),e){case 66:case 69:case 70:case 72:n=3;break;case 68:case 71:n=4;break;default:n=2}for(r=0;r<47;r++)Td.push({k:t+r,v:n})}for(Td.sort((function(s,o){return o.v-s.v})),r=0;r<Td.length;r++)t=Td[r].k.charAt(0),i.charAt(i.length-1)!==t&&(i+=t);return i!=="DGBEFHACIJK"}}));VG({target:"Array",proto:!0,forced:YG||!qG||!XG||!SO},{sort:function(e){e!==void 0&&FG(e);var t=BG(this);if(SO)return e===void 0?yO(t):yO(t,e);var n,r,i=[],s=mO(t);for(r=0;r<s;r++)r in t&&zG(i,t[r]);for(GG(i,(function(o){return function(c,d){return d===void 0?-1:c===void 0?1:o!==void 0?+o(c,d)||0:_O(c)>_O(d)?1:-1}})(e)),n=mO(i),r=0;r<n;)t[r]=i[r++];for(;r<s;)WG(t,r++);return t}});var JG=cs("Array","sort"),QG=ee,ZG=JG,IC=Array.prototype,$G=function(e){var t=e.sort;return e===IC||QG(IC,e)&&t===IC.sort?ZG:t},hh=R($G),e6=Zt,t6=K,n6=t_,r6=RangeError,TO=String.fromCharCode,RO=String.fromCodePoint,i6=t6([].join);e6({target:"String",stat:!0,forced:!!RO&&RO.length!==1},{fromCodePoint:function(e){for(var t,n=[],r=arguments.length,i=0;r>i;){if(t=+arguments[i++],n6(t,1114111)!==t)throw new r6(t+" is not a valid code point");n[i]=t<65536?TO(t):TO(55296+((t-=65536)>>10),t%1024+56320)}return i6(n,"")}});var s6=C,o6=Mn("iterator"),Gy=!s6((function(){var e=new URL("b?a=1&b=2&c=3","https://a"),t=e.searchParams,n=new URLSearchParams("a=1&a=2&b=3"),r="";return e.pathname="c%20d",t.forEach((function(i,s){t.delete("b"),r+=s+i})),n.delete("a",2),n.delete("b",void 0),!e.toJSON||!n.has("a",1)||n.has("a",2)||!n.has("a",void 0)||n.has("b")||!t.size&&!0||!t.sort||e.href!=="https://a/c%20d?a=1&c=3"||t.get("c")!=="3"||String(new URLSearchParams("?a=1"))!=="a=1"||!t[o6]||new URL("https://a@b").username!=="a"||new URLSearchParams(new URLSearchParams("a=b")).get("a")!=="b"||new URL("https://тест").host!=="xn--e1aybc"||new URL("https://a#б").hash!=="#%D0%B1"||r!=="a1c3"||new URL("https://x",void 0).host!=="x"})),a6=fa,AC=Zt,wO=re,NC=gg,c6=Vr,Hy=Je,ga=K,Ag=Fe,CO=Gy,bO=fa,l6=dc,d6=function(e,t,n){for(var r in t)n&&n.unsafe&&e[r]?e[r]=t[r]:a6(e,r,t[r],n);return e},u6=Ao,h6=Ju,OC=lc,IO=eh,PC=Ge,p6=Tr,f6=Qa,m6=na,_6=di,AO=Sr,ms=zi,g6=Vu,NO=it,OO=il,E6=Zs,Ky=$p,mf=Rs,v6=uO,y6=Mn("iterator"),_f="URLSearchParams",PO=_f+"Iterator",DO=OC.set,ko=OC.getterFor(_f),S6=OC.getterFor(PO),kO=NC("fetch"),zy=NC("Request"),Ng=NC("Headers"),DC=zy&&zy.prototype,xO=Ng&&Ng.prototype,T6=wO.TypeError,R6=wO.encodeURIComponent,w6=String.fromCharCode,C6=c6("String","fromCodePoint"),b6=parseInt,Yy=ga("".charAt),LO=ga([].join),Rd=ga([].push),MO=ga("".replace),I6=ga([].shift),UO=ga([].splice),jO=ga("".split),VO=ga("".slice),A6=ga(/./.exec),N6=/\+/g,O6=/^[0-9a-f]+$/i,FO=function(e,t){var n=VO(e,t,t+2);return A6(O6,n)?b6(n,16):NaN},P6=function(e){for(var t=0,n=128;n>0&&(e&n)!=0;n>>=1)t++;return t},D6=function(e){var t=null;switch(e.length){case 1:t=e[0];break;case 2:t=(31&e[0])<<6|63&e[1];break;case 3:t=(15&e[0])<<12|(63&e[1])<<6|63&e[2];break;case 4:t=(7&e[0])<<18|(63&e[1])<<12|(63&e[2])<<6|63&e[3]}return t>1114111?null:t},BO=function(e){for(var t=(e=MO(e,N6," ")).length,n="",r=0;r<t;){var i=Yy(e,r);if(i==="%"){if(Yy(e,r+1)==="%"||r+3>t){n+="%",r++;continue}var s=FO(e,r+1);if(s!=s){n+=i,r++;continue}r+=2;var o=P6(s);if(o===0)i=w6(s);else{if(o===1||o>4){n+="�",r++;continue}for(var c=[s],d=1;d<o&&!(++r+3>t||Yy(e,r)!=="%");){var h=FO(e,r+1);if(h!=h){r+=3;break}if(h>191||h<128)break;Rd(c,h),r+=2,d++}if(c.length!==o){n+="�";continue}var f=D6(c);f===null?n+="�":i=C6(f)}}n+=i,r++}return n},k6=/[!'()~]|%20/g,x6={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},L6=function(e){return x6[e]},WO=function(e){return MO(R6(e),k6,L6)},kC=h6((function(e,t){DO(this,{type:PO,target:ko(e).entries,index:0,kind:t})}),_f,(function(){var e=S6(this),t=e.target,n=e.index++;if(!t||n>=t.length)return e.target=null,Ky(void 0,!0);var r=t[n];switch(e.kind){case"keys":return Ky(r.key,!1);case"values":return Ky(r.value,!1)}return Ky([r.key,r.value],!1)}),!0),GO=function(e){this.entries=[],this.url=null,e!==void 0&&(AO(e)?this.parseObject(e):this.parseQuery(typeof e=="string"?Yy(e,0)==="?"?VO(e,1):e:ms(e)))};GO.prototype={type:_f,bindURL:function(e){this.url=e,this.update()},parseObject:function(e){var t,n,r,i,s,o,c,d=this.entries,h=E6(e);if(h)for(n=(t=OO(e,h)).next;!(r=Hy(n,t)).done;){if(s=(i=OO(_6(r.value))).next,(o=Hy(s,i)).done||(c=Hy(s,i)).done||!Hy(s,i).done)throw new T6("Expected sequence with length 2");Rd(d,{key:ms(o.value),value:ms(c.value)})}else for(var f in e)p6(e,f)&&Rd(d,{key:f,value:ms(e[f])})},parseQuery:function(e){if(e)for(var t,n,r=this.entries,i=jO(e,"&"),s=0;s<i.length;)(t=i[s++]).length&&(n=jO(t,"="),Rd(r,{key:BO(I6(n)),value:BO(LO(n,"="))}))},serialize:function(){for(var e,t=this.entries,n=[],r=0;r<t.length;)e=t[r++],Rd(n,WO(e.key)+"="+WO(e.value));return LO(n,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var qy=function(){IO(this,gf);var e=DO(this,new GO(arguments.length>0?arguments[0]:void 0));Ag||(this.size=e.entries.length)},gf=qy.prototype;if(d6(gf,{append:function(e,t){var n=ko(this);mf(arguments.length,2),Rd(n.entries,{key:ms(e),value:ms(t)}),Ag||this.length++,n.updateURL()},delete:function(e){for(var t=ko(this),n=mf(arguments.length,1),r=t.entries,i=ms(e),s=n<2?void 0:arguments[1],o=s===void 0?s:ms(s),c=0;c<r.length;){var d=r[c];if(d.key!==i||o!==void 0&&d.value!==o)c++;else if(UO(r,c,1),o!==void 0)break}Ag||(this.size=r.length),t.updateURL()},get:function(e){var t=ko(this).entries;mf(arguments.length,1);for(var n=ms(e),r=0;r<t.length;r++)if(t[r].key===n)return t[r].value;return null},getAll:function(e){var t=ko(this).entries;mf(arguments.length,1);for(var n=ms(e),r=[],i=0;i<t.length;i++)t[i].key===n&&Rd(r,t[i].value);return r},has:function(e){for(var t=ko(this).entries,n=mf(arguments.length,1),r=ms(e),i=n<2?void 0:arguments[1],s=i===void 0?i:ms(i),o=0;o<t.length;){var c=t[o++];if(c.key===r&&(s===void 0||c.value===s))return!0}return!1},set:function(e,t){var n=ko(this);mf(arguments.length,1);for(var r,i=n.entries,s=!1,o=ms(e),c=ms(t),d=0;d<i.length;d++)(r=i[d]).key===o&&(s?UO(i,d--,1):(s=!0,r.value=c));s||Rd(i,{key:o,value:c}),Ag||(this.size=i.length),n.updateURL()},sort:function(){var e=ko(this);v6(e.entries,(function(t,n){return t.key>n.key?1:-1})),e.updateURL()},forEach:function(e){for(var t,n=ko(this).entries,r=f6(e,arguments.length>1?arguments[1]:void 0),i=0;i<n.length;)r((t=n[i++]).value,t.key,this)},keys:function(){return new kC(this,"keys")},values:function(){return new kC(this,"values")},entries:function(){return new kC(this,"entries")}},{enumerable:!0}),bO(gf,y6,gf.entries,{}),bO(gf,"toString",(function(){return ko(this).serialize()}),{enumerable:!0}),Ag&&l6(gf,"size",{get:function(){return ko(this).entries.length},configurable:!0,enumerable:!0}),u6(qy,_f),AC({global:!0,forced:!CO},{URLSearchParams:qy}),!CO&&PC(Ng)){var M6=ga(xO.has),U6=ga(xO.set),HO=function(e){if(AO(e)){var t,n=e.body;if(m6(n)===_f)return t=e.headers?new Ng(e.headers):new Ng,M6(t,"content-type")||U6(t,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),g6(e,{body:NO(0,ms(n)),headers:NO(0,t)})}return e};if(PC(kO)&&AC({global:!0,dontCallGetSet:!0,forced:!0},{fetch:function(e){return kO(e,arguments.length>1?HO(arguments[1]):{})}}),PC(zy)){var xC=function(e){return IO(this,DC),new zy(e,arguments.length>1?HO(arguments[1]):{})};DC.constructor=xC,xC.prototype=DC,AC({global:!0,dontCallGetSet:!0,forced:!0},{Request:xC})}}var xo,j6={URLSearchParams:qy,getState:ko},V6=ci.URLSearchParams,KO=Fe,F6=K,B6=Je,W6=C,LC=Li,G6=nd,H6=De,K6=To,z6=Gt,Ef=Object.assign,zO=Object.defineProperty,Y6=F6([].concat),q6=!Ef||W6((function(){if(KO&&Ef({b:1},Ef(zO({},"a",{enumerable:!0,get:function(){zO(this,"b",{value:3,enumerable:!1})}}),{b:2})).b!==1)return!0;var e={},t={},n=Symbol("assign detection"),r="abcdefghijklmnopqrst";return e[n]=7,r.split("").forEach((function(i){t[i]=i})),Ef({},e)[n]!==7||LC(Ef({},t)).join("")!==r}))?function(e,t){for(var n=K6(e),r=arguments.length,i=1,s=G6.f,o=H6.f;r>i;)for(var c,d=z6(arguments[i++]),h=s?Y6(LC(d),s(d)):LC(d),f=h.length,g=0;f>g;)c=h[g++],KO&&!B6(o,d,c)||(n[c]=d[c]);return n}:Ef,X6=di,J6=sl,Q6=Fe,Z6=Ki,$6=it,MC=function(e,t,n){Q6?Z6.f(e,t,$6(0,n)):e[t]=n},e8=Qa,t8=Je,n8=To,r8=function(e,t,n,r){try{return r?t(X6(n)[0],n[1]):t(n)}catch(i){J6(e,"throw",i)}},i8=N_,s8=Fr,o8=ec,YO=MC,a8=il,c8=Zs,qO=Array,ph=K,UC=2147483647,l8=/[^\0-\u007E]/,XO=/[.\u3002\uFF0E\uFF61]/g,JO="Overflow: input needs wider integers to process",QO=RangeError,d8=ph(XO.exec),vf=Math.floor,jC=String.fromCharCode,ZO=ph("".charCodeAt),$O=ph([].join),wd=ph([].push),u8=ph("".replace),h8=ph("".split),p8=ph("".toLowerCase),eP=function(e){return e+22+75*(e<26)},f8=function(e,t,n){var r=0;for(e=n?vf(e/700):e>>1,e+=vf(e/t);e>455;)e=vf(e/35),r+=36;return vf(r+36*e/(e+38))},m8=function(e){var t=[];e=(function(j){for(var U=[],W=0,$=j.length;W<$;){var Z=ZO(j,W++);if(Z>=55296&&Z<=56319&&W<$){var Y=ZO(j,W++);(64512&Y)==56320?wd(U,((1023&Z)<<10)+(1023&Y)+65536):(wd(U,Z),W--)}else wd(U,Z)}return U})(e);var n,r,i=e.length,s=128,o=0,c=72;for(n=0;n<e.length;n++)(r=e[n])<128&&wd(t,jC(r));var d=t.length,h=d;for(d&&wd(t,"-");h<i;){var f=UC;for(n=0;n<e.length;n++)(r=e[n])>=s&&r<f&&(f=r);var g=h+1;if(f-s>vf((UC-o)/g))throw new QO(JO);for(o+=(f-s)*g,s=f,n=0;n<e.length;n++){if((r=e[n])<s&&++o>UC)throw new QO(JO);if(r===s){for(var E=o,S=36;;){var O=S<=c?1:S>=c+26?26:S-c;if(E<O)break;var A=E-O,N=36-O;wd(t,jC(eP(O+A%N))),E=vf(A/N),S+=36}wd(t,jC(eP(E))),c=f8(o,g,h===d),o=0,h++}}o++,s++}return $O(t,"")},_8=Zt,VC=Fe,g8=Gy,FC=re,tP=Qa,Lo=K,Xy=fa,Mo=dc,E8=eh,BC=Tr,WC=q6,yf=function(e){var t=n8(e),n=s8(this),r=arguments.length,i=r>1?arguments[1]:void 0,s=i!==void 0;s&&(i=e8(i,r>2?arguments[2]:void 0));var o,c,d,h,f,g,E=c8(t),S=0;if(!E||this===qO&&i8(E))for(o=o8(t),c=n?new this(o):qO(o);o>S;S++)g=s?i(t[S],S):t[S],YO(c,S,g);else for(c=n?new this:[],f=(h=a8(t,E)).next;!(d=t8(f,h)).done;S++)g=s?r8(h,i,[d.value,S],!0):d.value,YO(c,S,g);return c.length=S,c},Ea=Pr,v8=TC.codeAt,y8=function(e){var t,n,r=[],i=h8(u8(p8(e),XO,"."),".");for(t=0;t<i.length;t++)n=i[t],wd(r,d8(l8,n)?"xn--"+m8(n):n);return $O(r,".")},ml=zi,S8=Ao,T8=Rs,nP=j6,rP=lc,R8=rP.set,Jy=rP.getterFor("URL"),w8=nP.URLSearchParams,C8=nP.getState,Og=FC.URL,GC=FC.TypeError,Qy=FC.parseInt,b8=Math.floor,iP=Math.pow,Uo=Lo("".charAt),va=Lo(/./.exec),Pg=Lo([].join),I8=Lo(1 .toString),A8=Lo([].pop),Sf=Lo([].push),HC=Lo("".replace),N8=Lo([].shift),O8=Lo("".split),Dg=Lo("".slice),Zy=Lo("".toLowerCase),P8=Lo([].unshift),KC="Invalid scheme",fh="Invalid host",sP="Invalid port",oP=/[a-z]/i,D8=/[\d+-.a-z]/i,zC=/\d/,k8=/^0x/i,x8=/^[0-7]+$/,L8=/^\d+$/,aP=/^[\da-f]+$/i,M8=/[\0\t\n\r #%/:<>?@[\\\]^|]/,U8=/[\0\t\n\r #/:<>?@[\\\]^|]/,j8=/^[\u0000-\u0020]+/,V8=/(^|[^\u0000-\u0020])[\u0000-\u0020]+$/,F8=/[\t\n\r]/g,kg=function(e){var t,n,r,i;if(typeof e=="number"){for(t=[],n=0;n<4;n++)P8(t,e%256),e=b8(e/256);return Pg(t,".")}if(typeof e=="object"){for(t="",r=(function(s){for(var o=null,c=1,d=null,h=0,f=0;f<8;f++)s[f]!==0?(h>c&&(o=d,c=h),d=null,h=0):(d===null&&(d=f),++h);return h>c?d:o})(e),n=0;n<8;n++)i&&e[n]===0||(i&&(i=!1),r===n?(t+=n?":":"::",i=!0):(t+=I8(e[n],16),n<7&&(t+=":")));return"["+t+"]"}return e},$y={},cP=WC({},$y,{" ":1,'"':1,"<":1,">":1,"`":1}),lP=WC({},cP,{"#":1,"?":1,"{":1,"}":1}),YC=WC({},lP,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),Cd=function(e,t){var n=v8(e,0);return n>32&&n<127&&!BC(t,e)?e:encodeURIComponent(e)},eS={ftp:21,file:null,http:80,https:443,ws:80,wss:443},xg=function(e,t){var n;return e.length===2&&va(oP,Uo(e,0))&&((n=Uo(e,1))===":"||!t&&n==="|")},dP=function(e){var t;return e.length>1&&xg(Dg(e,0,2))&&(e.length===2||(t=Uo(e,2))==="/"||t==="\\"||t==="?"||t==="#")},B8=function(e){return e==="."||Zy(e)==="%2e"},qC={},uP={},XC={},hP={},pP={},JC={},fP={},mP={},tS={},nS={},QC={},ZC={},$C={},e0={},_P={},t0={},Tf={},Sc={},gP={},mh={},_l={},n0=function(e,t,n){var r,i,s,o=ml(e);if(t){if(i=this.parse(o))throw new GC(i);this.searchParams=null}else{if(n!==void 0&&(r=new n0(n,!0)),i=this.parse(o,null,r))throw new GC(i);(s=C8(new w8)).bindURL(this),this.searchParams=s}};n0.prototype={type:"URL",parse:function(e,t,n){var r,i,s,o,c,d=this,h=t||qC,f=0,g="",E=!1,S=!1,O=!1;for(e=ml(e),t||(d.scheme="",d.username="",d.password="",d.host=null,d.port=null,d.path=[],d.query=null,d.fragment=null,d.cannotBeABaseURL=!1,e=HC(e,j8,""),e=HC(e,V8,"$1")),e=HC(e,F8,""),r=yf(e);f<=r.length;){switch(i=r[f],h){case qC:if(!i||!va(oP,i)){if(t)return KC;h=XC;continue}g+=Zy(i),h=uP;break;case uP:if(i&&(va(D8,i)||i==="+"||i==="-"||i==="."))g+=Zy(i);else{if(i!==":"){if(t)return KC;g="",h=XC,f=0;continue}if(t&&(d.isSpecial()!==BC(eS,g)||g==="file"&&(d.includesCredentials()||d.port!==null)||d.scheme==="file"&&!d.host))return;if(d.scheme=g,t)return void(d.isSpecial()&&eS[d.scheme]===d.port&&(d.port=null));g="",d.scheme==="file"?h=e0:d.isSpecial()&&n&&n.scheme===d.scheme?h=hP:d.isSpecial()?h=mP:r[f+1]==="/"?(h=pP,f++):(d.cannotBeABaseURL=!0,Sf(d.path,""),h=gP)}break;case XC:if(!n||n.cannotBeABaseURL&&i!=="#")return KC;if(n.cannotBeABaseURL&&i==="#"){d.scheme=n.scheme,d.path=Ea(n.path),d.query=n.query,d.fragment="",d.cannotBeABaseURL=!0,h=_l;break}h=n.scheme==="file"?e0:JC;continue;case hP:if(i!=="/"||r[f+1]!=="/"){h=JC;continue}h=tS,f++;break;case pP:if(i==="/"){h=nS;break}h=Sc;continue;case JC:if(d.scheme=n.scheme,i===xo)d.username=n.username,d.password=n.password,d.host=n.host,d.port=n.port,d.path=Ea(n.path),d.query=n.query;else if(i==="/"||i==="\\"&&d.isSpecial())h=fP;else if(i==="?")d.username=n.username,d.password=n.password,d.host=n.host,d.port=n.port,d.path=Ea(n.path),d.query="",h=mh;else{if(i!=="#"){d.username=n.username,d.password=n.password,d.host=n.host,d.port=n.port,d.path=Ea(n.path),d.path.length--,h=Sc;continue}d.username=n.username,d.password=n.password,d.host=n.host,d.port=n.port,d.path=Ea(n.path),d.query=n.query,d.fragment="",h=_l}break;case fP:if(!d.isSpecial()||i!=="/"&&i!=="\\"){if(i!=="/"){d.username=n.username,d.password=n.password,d.host=n.host,d.port=n.port,h=Sc;continue}h=nS}else h=tS;break;case mP:if(h=tS,i!=="/"||Uo(g,f+1)!=="/")continue;f++;break;case tS:if(i!=="/"&&i!=="\\"){h=nS;continue}break;case nS:if(i==="@"){E&&(g="%40"+g),E=!0,s=yf(g);for(var A=0;A<s.length;A++){var N=s[A];if(N!==":"||O){var j=Cd(N,YC);O?d.password+=j:d.username+=j}else O=!0}g=""}else if(i===xo||i==="/"||i==="?"||i==="#"||i==="\\"&&d.isSpecial()){if(E&&g==="")return"Invalid authority";f-=yf(g).length+1,g="",h=QC}else g+=i;break;case QC:case ZC:if(t&&d.scheme==="file"){h=t0;continue}if(i!==":"||S){if(i===xo||i==="/"||i==="?"||i==="#"||i==="\\"&&d.isSpecial()){if(d.isSpecial()&&g==="")return fh;if(t&&g===""&&(d.includesCredentials()||d.port!==null))return;if(o=d.parseHost(g))return o;if(g="",h=Tf,t)return;continue}i==="["?S=!0:i==="]"&&(S=!1),g+=i}else{if(g==="")return fh;if(o=d.parseHost(g))return o;if(g="",h=$C,t===ZC)return}break;case $C:if(!va(zC,i)){if(i===xo||i==="/"||i==="?"||i==="#"||i==="\\"&&d.isSpecial()||t){if(g!==""){var U=Qy(g,10);if(U>65535)return sP;d.port=d.isSpecial()&&U===eS[d.scheme]?null:U,g=""}if(t)return;h=Tf;continue}return sP}g+=i;break;case e0:if(d.scheme="file",i==="/"||i==="\\")h=_P;else{if(!n||n.scheme!=="file"){h=Sc;continue}switch(i){case xo:d.host=n.host,d.path=Ea(n.path),d.query=n.query;break;case"?":d.host=n.host,d.path=Ea(n.path),d.query="",h=mh;break;case"#":d.host=n.host,d.path=Ea(n.path),d.query=n.query,d.fragment="",h=_l;break;default:dP(Pg(Ea(r,f),""))||(d.host=n.host,d.path=Ea(n.path),d.shortenPath()),h=Sc;continue}}break;case _P:if(i==="/"||i==="\\"){h=t0;break}n&&n.scheme==="file"&&!dP(Pg(Ea(r,f),""))&&(xg(n.path[0],!0)?Sf(d.path,n.path[0]):d.host=n.host),h=Sc;continue;case t0:if(i===xo||i==="/"||i==="\\"||i==="?"||i==="#"){if(!t&&xg(g))h=Sc;else if(g===""){if(d.host="",t)return;h=Tf}else{if(o=d.parseHost(g))return o;if(d.host==="localhost"&&(d.host=""),t)return;g="",h=Tf}continue}g+=i;break;case Tf:if(d.isSpecial()){if(h=Sc,i!=="/"&&i!=="\\")continue}else if(t||i!=="?")if(t||i!=="#"){if(i!==xo&&(h=Sc,i!=="/"))continue}else d.fragment="",h=_l;else d.query="",h=mh;break;case Sc:if(i===xo||i==="/"||i==="\\"&&d.isSpecial()||!t&&(i==="?"||i==="#")){if((c=Zy(c=g))===".."||c==="%2e."||c===".%2e"||c==="%2e%2e"?(d.shortenPath(),i==="/"||i==="\\"&&d.isSpecial()||Sf(d.path,"")):B8(g)?i==="/"||i==="\\"&&d.isSpecial()||Sf(d.path,""):(d.scheme==="file"&&!d.path.length&&xg(g)&&(d.host&&(d.host=""),g=Uo(g,0)+":"),Sf(d.path,g)),g="",d.scheme==="file"&&(i===xo||i==="?"||i==="#"))for(;d.path.length>1&&d.path[0]==="";)N8(d.path);i==="?"?(d.query="",h=mh):i==="#"&&(d.fragment="",h=_l)}else g+=Cd(i,lP);break;case gP:i==="?"?(d.query="",h=mh):i==="#"?(d.fragment="",h=_l):i!==xo&&(d.path[0]+=Cd(i,$y));break;case mh:t||i!=="#"?i!==xo&&(i==="'"&&d.isSpecial()?d.query+="%27":d.query+=i==="#"?"%23":Cd(i,$y)):(d.fragment="",h=_l);break;case _l:i!==xo&&(d.fragment+=Cd(i,cP))}f++}},parseHost:function(e){var t,n,r;if(Uo(e,0)==="["){if(Uo(e,e.length-1)!=="]"||(t=(function(i){var s,o,c,d,h,f,g,E=[0,0,0,0,0,0,0,0],S=0,O=null,A=0,N=function(){return Uo(i,A)};if(N()===":"){if(Uo(i,1)!==":")return;A+=2,O=++S}for(;N();){if(S===8)return;if(N()!==":"){for(s=o=0;o<4&&va(aP,N());)s=16*s+Qy(N(),16),A++,o++;if(N()==="."){if(o===0||(A-=o,S>6))return;for(c=0;N();){if(d=null,c>0){if(!(N()==="."&&c<4))return;A++}if(!va(zC,N()))return;for(;va(zC,N());){if(h=Qy(N(),10),d===null)d=h;else{if(d===0)return;d=10*d+h}if(d>255)return;A++}E[S]=256*E[S]+d,++c!=2&&c!==4||S++}if(c!==4)return;break}if(N()===":"){if(A++,!N())return}else if(N())return;E[S++]=s}else{if(O!==null)return;A++,O=++S}}if(O!==null)for(f=S-O,S=7;S!==0&&f>0;)g=E[S],E[S--]=E[O+f-1],E[O+--f]=g;else if(S!==8)return;return E})(Dg(e,1,-1)),!t))return fh;this.host=t}else if(this.isSpecial()){if(e=y8(e),va(M8,e)||(t=(function(i){var s,o,c,d,h,f,g,E=O8(i,".");if(E.length&&E[E.length-1]===""&&E.length--,(s=E.length)>4)return i;for(o=[],c=0;c<s;c++){if((d=E[c])==="")return i;if(h=10,d.length>1&&Uo(d,0)==="0"&&(h=va(k8,d)?16:8,d=Dg(d,h===8?1:2)),d==="")f=0;else{if(!va(h===10?L8:h===8?x8:aP,d))return i;f=Qy(d,h)}Sf(o,f)}for(c=0;c<s;c++)if(f=o[c],c===s-1){if(f>=iP(256,5-s))return null}else if(f>255)return null;for(g=A8(o),c=0;c<o.length;c++)g+=o[c]*iP(256,3-c);return g})(e),t===null))return fh;this.host=t}else{if(va(U8,e))return fh;for(t="",n=yf(e),r=0;r<n.length;r++)t+=Cd(n[r],$y);this.host=t}},cannotHaveUsernamePasswordPort:function(){return!this.host||this.cannotBeABaseURL||this.scheme==="file"},includesCredentials:function(){return this.username!==""||this.password!==""},isSpecial:function(){return BC(eS,this.scheme)},shortenPath:function(){var e=this.path,t=e.length;!t||this.scheme==="file"&&t===1&&xg(e[0],!0)||e.length--},serialize:function(){var e=this,t=e.scheme,n=e.username,r=e.password,i=e.host,s=e.port,o=e.path,c=e.query,d=e.fragment,h=t+":";return i!==null?(h+="//",e.includesCredentials()&&(h+=n+(r?":"+r:"")+"@"),h+=kg(i),s!==null&&(h+=":"+s)):t==="file"&&(h+="//"),h+=e.cannotBeABaseURL?o[0]:o.length?"/"+Pg(o,"/"):"",c!==null&&(h+="?"+c),d!==null&&(h+="#"+d),h},setHref:function(e){var t=this.parse(e);if(t)throw new GC(t);this.searchParams.update()},getOrigin:function(){var e=this.scheme,t=this.port;if(e==="blob")try{return new Rf(e.path[0]).origin}catch{return"null"}return e!=="file"&&this.isSpecial()?e+"://"+kg(this.host)+(t!==null?":"+t:""):"null"},getProtocol:function(){return this.scheme+":"},setProtocol:function(e){this.parse(ml(e)+":",qC)},getUsername:function(){return this.username},setUsername:function(e){var t=yf(ml(e));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var n=0;n<t.length;n++)this.username+=Cd(t[n],YC)}},getPassword:function(){return this.password},setPassword:function(e){var t=yf(ml(e));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var n=0;n<t.length;n++)this.password+=Cd(t[n],YC)}},getHost:function(){var e=this.host,t=this.port;return e===null?"":t===null?kg(e):kg(e)+":"+t},setHost:function(e){this.cannotBeABaseURL||this.parse(e,QC)},getHostname:function(){var e=this.host;return e===null?"":kg(e)},setHostname:function(e){this.cannotBeABaseURL||this.parse(e,ZC)},getPort:function(){var e=this.port;return e===null?"":ml(e)},setPort:function(e){this.cannotHaveUsernamePasswordPort()||((e=ml(e))===""?this.port=null:this.parse(e,$C))},getPathname:function(){var e=this.path;return this.cannotBeABaseURL?e[0]:e.length?"/"+Pg(e,"/"):""},setPathname:function(e){this.cannotBeABaseURL||(this.path=[],this.parse(e,Tf))},getSearch:function(){var e=this.query;return e?"?"+e:""},setSearch:function(e){(e=ml(e))===""?this.query=null:(Uo(e,0)==="?"&&(e=Dg(e,1)),this.query="",this.parse(e,mh)),this.searchParams.update()},getSearchParams:function(){return this.searchParams.facade},getHash:function(){var e=this.fragment;return e?"#"+e:""},setHash:function(e){(e=ml(e))!==""?(Uo(e,0)==="#"&&(e=Dg(e,1)),this.fragment="",this.parse(e,_l)):this.fragment=null},update:function(){this.query=this.searchParams.serialize()||null}};var Rf=function(e){var t=E8(this,_s),n=T8(arguments.length,1)>1?arguments[1]:void 0,r=R8(t,new n0(e,!1,n));VC||(t.href=r.serialize(),t.origin=r.getOrigin(),t.protocol=r.getProtocol(),t.username=r.getUsername(),t.password=r.getPassword(),t.host=r.getHost(),t.hostname=r.getHostname(),t.port=r.getPort(),t.pathname=r.getPathname(),t.search=r.getSearch(),t.searchParams=r.getSearchParams(),t.hash=r.getHash())},_s=Rf.prototype,jo=function(e,t){return{get:function(){return Jy(this)[e]()},set:t&&function(n){return Jy(this)[t](n)},configurable:!0,enumerable:!0}};if(VC&&(Mo(_s,"href",jo("serialize","setHref")),Mo(_s,"origin",jo("getOrigin")),Mo(_s,"protocol",jo("getProtocol","setProtocol")),Mo(_s,"username",jo("getUsername","setUsername")),Mo(_s,"password",jo("getPassword","setPassword")),Mo(_s,"host",jo("getHost","setHost")),Mo(_s,"hostname",jo("getHostname","setHostname")),Mo(_s,"port",jo("getPort","setPort")),Mo(_s,"pathname",jo("getPathname","setPathname")),Mo(_s,"search",jo("getSearch","setSearch")),Mo(_s,"searchParams",jo("getSearchParams")),Mo(_s,"hash",jo("getHash","setHash"))),Xy(_s,"toJSON",(function(){return Jy(this).serialize()}),{enumerable:!0}),Xy(_s,"toString",(function(){return Jy(this).serialize()}),{enumerable:!0}),Og){var EP=Og.createObjectURL,vP=Og.revokeObjectURL;EP&&Xy(Rf,"createObjectURL",tP(EP,Og)),vP&&Xy(Rf,"revokeObjectURL",tP(vP,Og))}S8(Rf,"URL"),_8({global:!0,forced:!g8,sham:!VC},{URL:Rf});var W8=Zt,yP=C,G8=Rs,SP=zi,H8=Gy,r0=Vr("URL"),K8=H8&&yP((function(){r0.canParse()})),z8=yP((function(){return r0.canParse.length!==1}));W8({target:"URL",stat:!0,forced:!K8||z8},{canParse:function(e){var t=G8(arguments.length,1),n=SP(e),r=t<2||arguments[1]===void 0?void 0:SP(arguments[1]);try{return!!new r0(n,r)}catch{return!1}}});var Y8=Zt,q8=Rs,TP=zi,X8=Gy,J8=Vr("URL");Y8({target:"URL",stat:!0,forced:!X8},{parse:function(e){var t=q8(arguments.length,1),n=TP(e),r=t<2||arguments[1]===void 0?void 0:TP(arguments[1]);try{return new J8(n,r)}catch{return null}}});var rS=R(ci.URL);let RP=!0,wP=!0;function iS(e,t,n){const r=e.match(t);return r&&r.length>=n&&parseInt(r[n],10)}function _h(e,t,n){if(!e.RTCPeerConnection)return;const r=e.RTCPeerConnection.prototype,i=r.addEventListener;r.addEventListener=function(o,c){if(o!==t)return i.apply(this,arguments);const d=h=>{const f=n(h);f&&(c.handleEvent?c.handleEvent(f):c(f))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(c,d),i.apply(this,[o,d])};const s=r.removeEventListener;r.removeEventListener=function(o,c){if(o!==t||!this._eventMap||!this._eventMap[t])return s.apply(this,arguments);if(!this._eventMap[t].has(c))return s.apply(this,arguments);const d=this._eventMap[t].get(c);return this._eventMap[t].delete(c),this._eventMap[t].size===0&&delete this._eventMap[t],Object.keys(this._eventMap).length===0&&delete this._eventMap,s.apply(this,[o,d])},Object.defineProperty(r,"on"+t,{get(){return this["_on"+t]},set(o){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),o&&this.addEventListener(t,this["_on"+t]=o)},enumerable:!0,configurable:!0})}function Q8(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(RP=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function Z8(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(wP=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function CP(){if(typeof window=="object"){if(RP)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function i0(e,t){wP&&console.warn(e+" is deprecated, please use "+t+" instead.")}function bP(e){return Object.prototype.toString.call(e)==="[object Object]"}function IP(e){var t;return bP(e)?Yi(t=Object.keys(e)).call(t,(function(n,r){const i=bP(e[r]),s=i?IP(e[r]):e[r],o=i&&!Object.keys(s).length;return s===void 0||o?n:Object.assign(n,{[r]:s})}),{}):e}function s0(e,t,n){t&&!n.has(t.id)&&(n.set(t.id,t),Object.keys(t).forEach((r=>{r.endsWith("Id")?s0(e,e.get(t[r]),n):r.endsWith("Ids")&&t[r].forEach((i=>{s0(e,e.get(i),n)}))})))}function AP(e,t,n){const r=n?"outbound-rtp":"inbound-rtp",i=new Map;if(t===null)return i;const s=[];return e.forEach((o=>{o.type==="track"&&o.trackIdentifier===t.id&&s.push(o)})),s.forEach((o=>{e.forEach((c=>{c.type===r&&c.trackId===o.id&&s0(e,c,i)}))})),i}const NP=CP;function OP(e,t){const n=e&&e.navigator;if(!n.mediaDevices)return;const r=function(o){if(typeof o!="object"||o.mandatory||o.optional)return o;const c={};return Object.keys(o).forEach((d=>{if(d==="require"||d==="advanced"||d==="mediaSource")return;const h=typeof o[d]=="object"?o[d]:{ideal:o[d]};h.exact!==void 0&&typeof h.exact=="number"&&(h.min=h.max=h.exact);const f=function(g,E){return g?g+E.charAt(0).toUpperCase()+E.slice(1):E==="deviceId"?"sourceId":E};if(h.ideal!==void 0){c.optional=c.optional||[];let g={};typeof h.ideal=="number"?(g[f("min",d)]=h.ideal,c.optional.push(g),g={},g[f("max",d)]=h.ideal,c.optional.push(g)):(g[f("",d)]=h.ideal,c.optional.push(g))}h.exact!==void 0&&typeof h.exact!="number"?(c.mandatory=c.mandatory||{},c.mandatory[f("",d)]=h.exact):["min","max"].forEach((g=>{h[g]!==void 0&&(c.mandatory=c.mandatory||{},c.mandatory[f(g,d)]=h[g])}))})),o.advanced&&(c.optional=(c.optional||[]).concat(o.advanced)),c},i=function(o,c){if(t.version>=61)return c(o);if((o=JSON.parse(JSON.stringify(o)))&&typeof o.audio=="object"){const d=function(h,f,g){f in h&&!(g in h)&&(h[g]=h[f],delete h[f])};d((o=JSON.parse(JSON.stringify(o))).audio,"autoGainControl","googAutoGainControl"),d(o.audio,"noiseSuppression","googNoiseSuppression"),o.audio=r(o.audio)}if(o&&typeof o.video=="object"){let d=o.video.facingMode;d=d&&(typeof d=="object"?d:{ideal:d});const h=t.version<66;if(d&&(d.exact==="user"||d.exact==="environment"||d.ideal==="user"||d.ideal==="environment")&&(!n.mediaDevices.getSupportedConstraints||!n.mediaDevices.getSupportedConstraints().facingMode||h)){let f;if(delete o.video.facingMode,d.exact==="environment"||d.ideal==="environment"?f=["back","rear"]:d.exact!=="user"&&d.ideal!=="user"||(f=["front"]),f)return n.mediaDevices.enumerateDevices().then((g=>{g=g.filter((S=>S.kind==="videoinput"));let E=g.find((S=>f.some((O=>{var A;return be(A=S.label.toLowerCase()).call(A,O)}))));return!E&&g.length&&be(f).call(f,"back")&&(E=g[g.length-1]),E&&(o.video.deviceId=d.exact?{exact:E.deviceId}:{ideal:E.deviceId}),o.video=r(o.video),NP("chrome: "+JSON.stringify(o)),c(o)}))}o.video=r(o.video)}return NP("chrome: "+JSON.stringify(o)),c(o)},s=function(o){return t.version>=64?o:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[o.name]||o.name,message:o.message,constraint:o.constraint||o.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(n.getUserMedia=(function(o,c,d){i(o,(h=>{n.webkitGetUserMedia(h,c,(f=>{d&&d(s(f))}))}))}).bind(n),n.mediaDevices.getUserMedia){const o=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(c){return i(c,(d=>o(d).then((h=>{if(d.audio&&!h.getAudioTracks().length||d.video&&!h.getVideoTracks().length)throw h.getTracks().forEach((f=>{f.stop()})),new DOMException("","NotFoundError");return h}),(h=>ke.reject(s(h))))))}}}function PP(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function DP(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(n){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=n)},enumerable:!0,configurable:!0});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=n=>{n.stream.addEventListener("addtrack",(r=>{let i;i=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find((o=>o.track&&o.track.id===r.track.id)):{track:r.track};const s=new Event("track");s.track=r.track,s.receiver=i,s.transceiver={receiver:i},s.streams=[n.stream],this.dispatchEvent(s)})),n.stream.getTracks().forEach((r=>{let i;i=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find((o=>o.track&&o.track.id===r.id)):{track:r};const s=new Event("track");s.track=r,s.receiver=i,s.transceiver={receiver:i},s.streams=[n.stream],this.dispatchEvent(s)}))},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else _h(e,"track",(t=>(t.transceiver||Object.defineProperty(t,"transceiver",{value:{receiver:t.receiver}}),t)))}function kP(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){const t=function(i,s){return{track:s,get dtmf(){return this._dtmf===void 0&&(s.kind==="audio"?this._dtmf=i.createDTMFSender(s):this._dtmf=null),this._dtmf},_pc:i}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const i=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(o,c){let d=i.apply(this,arguments);return d||(d=t(this,o),this._senders.push(d)),d};const s=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(o){s.apply(this,arguments);const c=this._senders.indexOf(o);c!==-1&&this._senders.splice(c,1)}}const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(i){this._senders=this._senders||[],n.apply(this,[i]),i.getTracks().forEach((s=>{this._senders.push(t(this,s))}))};const r=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(i){this._senders=this._senders||[],r.apply(this,[i]),i.getTracks().forEach((s=>{const o=this._senders.find((c=>c.track===s));o&&this._senders.splice(this._senders.indexOf(o),1)}))}}else if(typeof e=="object"&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){const n=t.apply(this,[]);return n.forEach((r=>r._pc=this)),n},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function xP(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[n,r,i]=arguments;if(arguments.length>0&&typeof n=="function")return t.apply(this,arguments);if(t.length===0&&(arguments.length===0||typeof n!="function"))return t.apply(this,[]);const s=function(c){const d={};return c.result().forEach((h=>{const f={id:h.id,timestamp:h.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[h.type]||h.type};h.names().forEach((g=>{f[g]=h.stat(g)})),d[f.id]=f})),d},o=function(c){return new Map(Object.keys(c).map((d=>[d,c[d]])))};if(arguments.length>=2){const c=function(d){r(o(s(d)))};return t.apply(this,[c,n])}return new ke(((c,d)=>{t.apply(this,[function(h){c(o(s(h)))},d])})).then(r,i)}}function LP(e){if(!(typeof e=="object"&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if(!("getStats"in e.RTCRtpSender.prototype)){const n=e.RTCPeerConnection.prototype.getSenders;n&&(e.RTCPeerConnection.prototype.getSenders=function(){const i=n.apply(this,[]);return i.forEach((s=>s._pc=this)),i});const r=e.RTCPeerConnection.prototype.addTrack;r&&(e.RTCPeerConnection.prototype.addTrack=function(){const i=r.apply(this,arguments);return i._pc=this,i}),e.RTCRtpSender.prototype.getStats=function(){const i=this;return this._pc.getStats().then((s=>AP(s,i.track,!0)))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){const n=e.RTCPeerConnection.prototype.getReceivers;n&&(e.RTCPeerConnection.prototype.getReceivers=function(){const r=n.apply(this,[]);return r.forEach((i=>i._pc=this)),r}),_h(e,"track",(r=>(r.receiver._pc=r.srcElement,r))),e.RTCRtpReceiver.prototype.getStats=function(){const r=this;return this._pc.getStats().then((i=>AP(i,r.track,!1)))}}if(!("getStats"in e.RTCRtpSender.prototype)||!("getStats"in e.RTCRtpReceiver.prototype))return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){const n=arguments[0];let r,i,s;return this.getSenders().forEach((o=>{o.track===n&&(r?s=!0:r=o)})),this.getReceivers().forEach((o=>(o.track===n&&(i?s=!0:i=o),o.track===n))),s||r&&i?ke.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):r?r.getStats():i?i.getStats():ke.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return t.apply(this,arguments)}}function MP(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map((s=>this._shimmedLocalStreams[s][0]))};const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(s,o){if(!o)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const c=t.apply(this,arguments);return this._shimmedLocalStreams[o.id]?this._shimmedLocalStreams[o.id].indexOf(c)===-1&&this._shimmedLocalStreams[o.id].push(c):this._shimmedLocalStreams[o.id]=[o,c],c};const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(s){this._shimmedLocalStreams=this._shimmedLocalStreams||{},s.getTracks().forEach((d=>{if(this.getSenders().find((f=>f.track===d)))throw new DOMException("Track already exists.","InvalidAccessError")}));const o=this.getSenders();n.apply(this,arguments);const c=this.getSenders().filter((d=>o.indexOf(d)===-1));this._shimmedLocalStreams[s.id]=[s].concat(c)};const r=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(s){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[s.id],r.apply(this,arguments)};const i=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(s){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},s&&Object.keys(this._shimmedLocalStreams).forEach((o=>{const c=this._shimmedLocalStreams[o].indexOf(s);c!==-1&&this._shimmedLocalStreams[o].splice(c,1),this._shimmedLocalStreams[o].length===1&&delete this._shimmedLocalStreams[o]})),i.apply(this,arguments)}}function UP(e,t){if(!e.RTCPeerConnection)return;if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return MP(e);const n=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){const d=n.apply(this);return this._reverseStreams=this._reverseStreams||{},d.map((h=>this._reverseStreams[h.id]))};const r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(d){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},d.getTracks().forEach((h=>{if(this.getSenders().find((g=>g.track===h)))throw new DOMException("Track already exists.","InvalidAccessError")})),!this._reverseStreams[d.id]){const h=new e.MediaStream(d.getTracks());this._streams[d.id]=h,this._reverseStreams[h.id]=d,d=h}r.apply(this,[d])};const i=e.RTCPeerConnection.prototype.removeStream;function s(d,h){let f=h.sdp;return Object.keys(d._reverseStreams||[]).forEach((g=>{const E=d._reverseStreams[g],S=d._streams[E.id];f=f.replace(new RegExp(S.id,"g"),E.id)})),new RTCSessionDescription({type:h.type,sdp:f})}e.RTCPeerConnection.prototype.removeStream=function(d){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},i.apply(this,[this._streams[d.id]||d]),delete this._reverseStreams[this._streams[d.id]?this._streams[d.id].id:d.id],delete this._streams[d.id]},e.RTCPeerConnection.prototype.addTrack=function(d,h){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const f=[].slice.call(arguments,1);if(f.length!==1||!f[0].getTracks().find((S=>S===d)))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find((S=>S.track===d)))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const E=this._streams[h.id];if(E)E.addTrack(d),ke.resolve().then((()=>{this.dispatchEvent(new Event("negotiationneeded"))}));else{const S=new e.MediaStream([d]);this._streams[h.id]=S,this._reverseStreams[S.id]=h,this.addStream(S)}return this.getSenders().find((S=>S.track===d))},["createOffer","createAnswer"].forEach((function(d){const h=e.RTCPeerConnection.prototype[d],f={[d](){const g=arguments;return arguments.length&&typeof arguments[0]=="function"?h.apply(this,[E=>{const S=s(this,E);g[0].apply(null,[S])},E=>{g[1]&&g[1].apply(null,E)},arguments[2]]):h.apply(this,arguments).then((E=>s(this,E)))}};e.RTCPeerConnection.prototype[d]=f[d]}));const o=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=(function(d,h){let f=h.sdp;return Object.keys(d._reverseStreams||[]).forEach((g=>{const E=d._reverseStreams[g],S=d._streams[E.id];f=f.replace(new RegExp(E.id,"g"),S.id)})),new RTCSessionDescription({type:h.type,sdp:f})})(this,arguments[0]),o.apply(this,arguments)):o.apply(this,arguments)};const c=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get(){const d=c.get.apply(this);return d.type===""?d:s(this,d)}}),e.RTCPeerConnection.prototype.removeTrack=function(d){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!d._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(d._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let h;this._streams=this._streams||{},Object.keys(this._streams).forEach((f=>{this._streams[f].getTracks().find((g=>d.track===g))&&(h=this._streams[f])})),h&&(h.getTracks().length===1?this.removeStream(this._reverseStreams[h.id]):h.removeTrack(d.track),this.dispatchEvent(new Event("negotiationneeded")))}}function o0(e,t){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection&&t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(n){const r=e.RTCPeerConnection.prototype[n],i={[n](){return arguments[0]=new(n==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}};e.RTCPeerConnection.prototype[n]=i[n]}))}function jP(e,t){_h(e,"negotiationneeded",(n=>{const r=n.target;if(!(t.version<72||r.getConfiguration&&r.getConfiguration().sdpSemantics==="plan-b")||r.signalingState==="stable")return n}))}var VP=Object.freeze({__proto__:null,fixNegotiationNeeded:jP,shimAddTrackRemoveTrack:UP,shimAddTrackRemoveTrackWithNative:MP,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(typeof t=="function"?e.navigator.mediaDevices.getDisplayMedia=function(n){return t(n).then((r=>{const i=n.video&&n.video.width,s=n.video&&n.video.height,o=n.video&&n.video.frameRate;return n.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:r,maxFrameRate:o||3}},i&&(n.video.mandatory.maxWidth=i),s&&(n.video.mandatory.maxHeight=s),e.navigator.mediaDevices.getUserMedia(n)}))}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))},shimGetSendersWithDtmf:kP,shimGetStats:xP,shimGetUserMedia:OP,shimMediaStream:PP,shimOnTrack:DP,shimPeerConnection:o0,shimSenderReceiverGetStats:LP});function FP(e,t){const n=e&&e.navigator,r=e&&e.MediaStreamTrack;if(n.getUserMedia=function(i,s,o){i0("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(i).then(s,o)},!(t.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){const i=function(o,c,d){c in o&&!(d in o)&&(o[d]=o[c],delete o[c])},s=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(o){return typeof o=="object"&&typeof o.audio=="object"&&(o=JSON.parse(JSON.stringify(o)),i(o.audio,"autoGainControl","mozAutoGainControl"),i(o.audio,"noiseSuppression","mozNoiseSuppression")),s(o)},r&&r.prototype.getSettings){const o=r.prototype.getSettings;r.prototype.getSettings=function(){const c=o.apply(this,arguments);return i(c,"mozAutoGainControl","autoGainControl"),i(c,"mozNoiseSuppression","noiseSuppression"),c}}if(r&&r.prototype.applyConstraints){const o=r.prototype.applyConstraints;r.prototype.applyConstraints=function(c){return this.kind==="audio"&&typeof c=="object"&&(c=JSON.parse(JSON.stringify(c)),i(c,"autoGainControl","mozAutoGainControl"),i(c,"noiseSuppression","mozNoiseSuppression")),o.apply(this,[c])}}}}function BP(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function a0(e,t){if(typeof e!="object"||!e.RTCPeerConnection&&!e.mozRTCPeerConnection)return;!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(i){const s=e.RTCPeerConnection.prototype[i],o={[i](){return arguments[0]=new(i==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),s.apply(this,arguments)}};e.RTCPeerConnection.prototype[i]=o[i]}));const n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},r=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[i,s,o]=arguments;return r.apply(this,[i||null]).then((c=>{if(t.version<53&&!s)try{c.forEach((d=>{d.type=n[d.type]||d.type}))}catch(d){if(d.name!=="TypeError")throw d;c.forEach(((h,f)=>{c.set(f,Object.assign({},h,{type:n[h.type]||h.type}))}))}return c})).then(s,o)}}function WP(e){if(typeof e!="object"||!e.RTCPeerConnection||!e.RTCRtpSender||e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)return;const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const r=t.apply(this,[]);return r.forEach((i=>i._pc=this)),r});const n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){const r=n.apply(this,arguments);return r._pc=this,r}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):ke.resolve(new Map)}}function GP(e){if(typeof e!="object"||!e.RTCPeerConnection||!e.RTCRtpSender||e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)return;const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const n=t.apply(this,[]);return n.forEach((r=>r._pc=this)),n}),_h(e,"track",(n=>(n.receiver._pc=n.srcElement,n))),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function HP(e){e.RTCPeerConnection&&!("removeStream"in e.RTCPeerConnection.prototype)&&(e.RTCPeerConnection.prototype.removeStream=function(t){i0("removeStream","removeTrack"),this.getSenders().forEach((n=>{var r;n.track&&be(r=t.getTracks()).call(r,n.track)&&this.removeTrack(n)}))})}function KP(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function zP(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let n=arguments[1]&&arguments[1].sendEncodings;n===void 0&&(n=[]),n=[...n];const r=n.length>0;r&&n.forEach((s=>{if("rid"in s&&!/^[a-z0-9]{0,16}$/i.test(s.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in s&&!(parseFloat(s.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in s&&!(parseFloat(s.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")}));const i=t.apply(this,arguments);if(r){const{sender:s}=i,o=s.getParameters();(!("encodings"in o)||o.encodings.length===1&&Object.keys(o.encodings[0]).length===0)&&(o.encodings=n,s.sendEncodings=n,this.setParametersPromises.push(s.setParameters(o).then((()=>{delete s.sendEncodings})).catch((()=>{delete s.sendEncodings}))))}return i})}function YP(e){if(typeof e!="object"||!e.RTCRtpSender)return;const t=e.RTCRtpSender.prototype.getParameters;t&&(e.RTCRtpSender.prototype.getParameters=function(){const n=t.apply(this,arguments);return"encodings"in n||(n.encodings=[].concat(this.sendEncodings||[{}])),n})}function qP(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?ke.all(this.setParametersPromises).then((()=>t.apply(this,arguments))).finally((()=>{this.setParametersPromises=[]})):t.apply(this,arguments)}}function XP(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?ke.all(this.setParametersPromises).then((()=>t.apply(this,arguments))).finally((()=>{this.setParametersPromises=[]})):t.apply(this,arguments)}}var JP=Object.freeze({__proto__:null,shimAddTransceiver:zP,shimCreateAnswer:XP,shimCreateOffer:qP,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(n){if(!n||!n.video){const r=new DOMException("getDisplayMedia without video constraints is undefined");return r.name="NotFoundError",r.code=8,ke.reject(r)}return n.video===!0?n.video={mediaSource:t}:n.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(n)})},shimGetParameters:YP,shimGetUserMedia:FP,shimOnTrack:BP,shimPeerConnection:a0,shimRTCDataChannel:KP,shimReceiverGetStats:GP,shimRemoveStream:HP,shimSenderGetStats:WP});function QP(e){if(typeof e=="object"&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(n){var r;this._localStreams||(this._localStreams=[]),be(r=this._localStreams).call(r,n)||this._localStreams.push(n),n.getAudioTracks().forEach((i=>t.call(this,i,n))),n.getVideoTracks().forEach((i=>t.call(this,i,n)))},e.RTCPeerConnection.prototype.addTrack=function(n){for(var r=arguments.length,i=new Array(r>1?r-1:0),s=1;s<r;s++)i[s-1]=arguments[s];return i&&i.forEach((o=>{var c;this._localStreams?be(c=this._localStreams).call(c,o)||this._localStreams.push(o):this._localStreams=[o]})),t.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(t){this._localStreams||(this._localStreams=[]);const n=this._localStreams.indexOf(t);if(n===-1)return;this._localStreams.splice(n,1);const r=t.getTracks();this.getSenders().forEach((i=>{be(r).call(r,i.track)&&this.removeTrack(i)}))})}}function ZP(e){if(typeof e=="object"&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(n){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=n),this.addEventListener("track",this._onaddstreampoly=r=>{r.streams.forEach((i=>{var s;if(this._remoteStreams||(this._remoteStreams=[]),be(s=this._remoteStreams).call(s,i))return;this._remoteStreams.push(i);const o=new Event("addstream");o.stream=i,this.dispatchEvent(o)}))})}});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){const n=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(r){r.streams.forEach((i=>{if(n._remoteStreams||(n._remoteStreams=[]),n._remoteStreams.indexOf(i)>=0)return;n._remoteStreams.push(i);const s=new Event("addstream");s.stream=i,n.dispatchEvent(s)}))}),t.apply(n,arguments)}}}function $P(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype,n=t.createOffer,r=t.createAnswer,i=t.setLocalDescription,s=t.setRemoteDescription,o=t.addIceCandidate;t.createOffer=function(d,h){const f=arguments.length>=2?arguments[2]:arguments[0],g=n.apply(this,[f]);return h?(g.then(d,h),ke.resolve()):g},t.createAnswer=function(d,h){const f=arguments.length>=2?arguments[2]:arguments[0],g=r.apply(this,[f]);return h?(g.then(d,h),ke.resolve()):g};let c=function(d,h,f){const g=i.apply(this,[d]);return f?(g.then(h,f),ke.resolve()):g};t.setLocalDescription=c,c=function(d,h,f){const g=s.apply(this,[d]);return f?(g.then(h,f),ke.resolve()):g},t.setRemoteDescription=c,c=function(d,h,f){const g=o.apply(this,[d]);return f?(g.then(h,f),ke.resolve()):g},t.addIceCandidate=c}function eD(e){const t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){const n=t.mediaDevices,r=n.getUserMedia.bind(n);t.mediaDevices.getUserMedia=i=>r(tD(i))}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=(function(n,r,i){t.mediaDevices.getUserMedia(n).then(r,i)}).bind(t))}function tD(e){return e&&e.video!==void 0?Object.assign({},e,{video:IP(e.video)}):e}function nD(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection;e.RTCPeerConnection=function(n,r){if(n&&n.iceServers){const i=[];for(let s=0;s<n.iceServers.length;s++){let o=n.iceServers[s];!o.hasOwnProperty("urls")&&o.hasOwnProperty("url")?(i0("RTCIceServer.url","RTCIceServer.urls"),o=JSON.parse(JSON.stringify(o)),o.urls=o.url,delete o.url,i.push(o)):i.push(n.iceServers[s])}n.iceServers=i}return new t(n,r)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:()=>t.generateCertificate})}function rD(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function iD(e){const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(n){if(n){n.offerToReceiveAudio!==void 0&&(n.offerToReceiveAudio=!!n.offerToReceiveAudio);const r=this.getTransceivers().find((s=>s.receiver.track.kind==="audio"));n.offerToReceiveAudio===!1&&r?r.direction==="sendrecv"?r.setDirection?r.setDirection("sendonly"):r.direction="sendonly":r.direction==="recvonly"&&(r.setDirection?r.setDirection("inactive"):r.direction="inactive"):n.offerToReceiveAudio!==!0||r||this.addTransceiver("audio",{direction:"recvonly"}),n.offerToReceiveVideo!==void 0&&(n.offerToReceiveVideo=!!n.offerToReceiveVideo);const i=this.getTransceivers().find((s=>s.receiver.track.kind==="video"));n.offerToReceiveVideo===!1&&i?i.direction==="sendrecv"?i.setDirection?i.setDirection("sendonly"):i.direction="sendonly":i.direction==="recvonly"&&(i.setDirection?i.setDirection("inactive"):i.direction="inactive"):n.offerToReceiveVideo!==!0||i||this.addTransceiver("video",{direction:"recvonly"})}return t.apply(this,arguments)}}function sD(e){typeof e!="object"||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}var oD=Object.freeze({__proto__:null,shimAudioContext:sD,shimCallbacksAPI:$P,shimConstraints:tD,shimCreateOfferLegacy:iD,shimGetUserMedia:eD,shimLocalStreamsAPI:QP,shimRTCIceServerUrls:nD,shimRemoteStreamsAPI:ZP,shimTrackEventTransceiver:rD}),aD=`	
\v\f\r                　\u2028\u2029\uFEFF`,$8=er,eH=zi,c0=aD,cD=K("".replace),tH=RegExp("^["+c0+"]+"),nH=RegExp("(^|[^"+c0+"])["+c0+"]+$"),rH=function(e){return function(t){var n=eH($8(t));return 1&e&&(n=cD(n,tH,"")),2&e&&(n=cD(n,nH,"$1")),n}},iH={trim:rH(3)},sH=Hp.PROPER,oH=C,lD=aD,aH=iH.trim;Zt({target:"String",proto:!0,forced:(function(e){return oH((function(){return!!lD[e]()||"​᠎"[e]()!=="​᠎"||sH&&lD[e].name!==e}))})("trim")},{trim:function(){return aH(this)}});var cH=cs("String","trim"),lH=ee,dH=cH,l0=String.prototype,uH=function(e){var t=e.trim;return typeof e=="string"||e===l0||lH(l0,e)&&t===l0.trim?dH:t},fi=R(uH),dD={exports:{}};(function(e){const t={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};t.localCName=t.generateIdentifier(),t.splitLines=function(n){return n.trim().split(`
`).map((r=>r.trim()))},t.splitSections=function(n){return n.split(`
m=`).map(((r,i)=>(i>0?"m="+r:r).trim()+`\r
`))},t.getDescription=function(n){const r=t.splitSections(n);return r&&r[0]},t.getMediaSections=function(n){const r=t.splitSections(n);return r.shift(),r},t.matchPrefix=function(n,r){return t.splitLines(n).filter((i=>i.indexOf(r)===0))},t.parseCandidate=function(n){let r;r=n.indexOf("a=candidate:")===0?n.substring(12).split(" "):n.substring(10).split(" ");const i={foundation:r[0],component:{1:"rtp",2:"rtcp"}[r[1]]||r[1],protocol:r[2].toLowerCase(),priority:parseInt(r[3],10),ip:r[4],address:r[4],port:parseInt(r[5],10),type:r[7]};for(let s=8;s<r.length;s+=2)switch(r[s]){case"raddr":i.relatedAddress=r[s+1];break;case"rport":i.relatedPort=parseInt(r[s+1],10);break;case"tcptype":i.tcpType=r[s+1];break;case"ufrag":i.ufrag=r[s+1],i.usernameFragment=r[s+1];break;default:i[r[s]]===void 0&&(i[r[s]]=r[s+1])}return i},t.writeCandidate=function(n){const r=[];r.push(n.foundation);const i=n.component;i==="rtp"?r.push(1):i==="rtcp"?r.push(2):r.push(i),r.push(n.protocol.toUpperCase()),r.push(n.priority),r.push(n.address||n.ip),r.push(n.port);const s=n.type;return r.push("typ"),r.push(s),s!=="host"&&n.relatedAddress&&n.relatedPort&&(r.push("raddr"),r.push(n.relatedAddress),r.push("rport"),r.push(n.relatedPort)),n.tcpType&&n.protocol.toLowerCase()==="tcp"&&(r.push("tcptype"),r.push(n.tcpType)),(n.usernameFragment||n.ufrag)&&(r.push("ufrag"),r.push(n.usernameFragment||n.ufrag)),"candidate:"+r.join(" ")},t.parseIceOptions=function(n){return n.substring(14).split(" ")},t.parseRtpMap=function(n){let r=n.substring(9).split(" ");const i={payloadType:parseInt(r.shift(),10)};return r=r[0].split("/"),i.name=r[0],i.clockRate=parseInt(r[1],10),i.channels=r.length===3?parseInt(r[2],10):1,i.numChannels=i.channels,i},t.writeRtpMap=function(n){let r=n.payloadType;n.preferredPayloadType!==void 0&&(r=n.preferredPayloadType);const i=n.channels||n.numChannels||1;return"a=rtpmap:"+r+" "+n.name+"/"+n.clockRate+(i!==1?"/"+i:"")+`\r
`},t.parseExtmap=function(n){const r=n.substring(9).split(" ");return{id:parseInt(r[0],10),direction:r[0].indexOf("/")>0?r[0].split("/")[1]:"sendrecv",uri:r[1],attributes:r.slice(2).join(" ")}},t.writeExtmap=function(n){return"a=extmap:"+(n.id||n.preferredId)+(n.direction&&n.direction!=="sendrecv"?"/"+n.direction:"")+" "+n.uri+(n.attributes?" "+n.attributes:"")+`\r
`},t.parseFmtp=function(n){const r={};let i;const s=n.substring(n.indexOf(" ")+1).split(";");for(let o=0;o<s.length;o++)i=s[o].trim().split("="),r[i[0].trim()]=i[1];return r},t.writeFmtp=function(n){let r="",i=n.payloadType;if(n.preferredPayloadType!==void 0&&(i=n.preferredPayloadType),n.parameters&&Object.keys(n.parameters).length){const s=[];Object.keys(n.parameters).forEach((o=>{n.parameters[o]!==void 0?s.push(o+"="+n.parameters[o]):s.push(o)})),r+="a=fmtp:"+i+" "+s.join(";")+`\r
`}return r},t.parseRtcpFb=function(n){const r=n.substring(n.indexOf(" ")+1).split(" ");return{type:r.shift(),parameter:r.join(" ")}},t.writeRtcpFb=function(n){let r="",i=n.payloadType;return n.preferredPayloadType!==void 0&&(i=n.preferredPayloadType),n.rtcpFeedback&&n.rtcpFeedback.length&&n.rtcpFeedback.forEach((s=>{r+="a=rtcp-fb:"+i+" "+s.type+(s.parameter&&s.parameter.length?" "+s.parameter:"")+`\r
`})),r},t.parseSsrcMedia=function(n){const r=n.indexOf(" "),i={ssrc:parseInt(n.substring(7,r),10)},s=n.indexOf(":",r);return s>-1?(i.attribute=n.substring(r+1,s),i.value=n.substring(s+1)):i.attribute=n.substring(r+1),i},t.parseSsrcGroup=function(n){const r=n.substring(13).split(" ");return{semantics:r.shift(),ssrcs:r.map((i=>parseInt(i,10)))}},t.getMid=function(n){const r=t.matchPrefix(n,"a=mid:")[0];if(r)return r.substring(6)},t.parseFingerprint=function(n){const r=n.substring(14).split(" ");return{algorithm:r[0].toLowerCase(),value:r[1].toUpperCase()}},t.getDtlsParameters=function(n,r){return{role:"auto",fingerprints:t.matchPrefix(n+r,"a=fingerprint:").map(t.parseFingerprint)}},t.writeDtlsParameters=function(n,r){let i="a=setup:"+r+`\r
`;return n.fingerprints.forEach((s=>{i+="a=fingerprint:"+s.algorithm+" "+s.value+`\r
`})),i},t.parseCryptoLine=function(n){const r=n.substring(9).split(" ");return{tag:parseInt(r[0],10),cryptoSuite:r[1],keyParams:r[2],sessionParams:r.slice(3)}},t.writeCryptoLine=function(n){return"a=crypto:"+n.tag+" "+n.cryptoSuite+" "+(typeof n.keyParams=="object"?t.writeCryptoKeyParams(n.keyParams):n.keyParams)+(n.sessionParams?" "+n.sessionParams.join(" "):"")+`\r
`},t.parseCryptoKeyParams=function(n){if(n.indexOf("inline:")!==0)return null;const r=n.substring(7).split("|");return{keyMethod:"inline",keySalt:r[0],lifeTime:r[1],mkiValue:r[2]?r[2].split(":")[0]:void 0,mkiLength:r[2]?r[2].split(":")[1]:void 0}},t.writeCryptoKeyParams=function(n){return n.keyMethod+":"+n.keySalt+(n.lifeTime?"|"+n.lifeTime:"")+(n.mkiValue&&n.mkiLength?"|"+n.mkiValue+":"+n.mkiLength:"")},t.getCryptoParameters=function(n,r){return t.matchPrefix(n+r,"a=crypto:").map(t.parseCryptoLine)},t.getIceParameters=function(n,r){const i=t.matchPrefix(n+r,"a=ice-ufrag:")[0],s=t.matchPrefix(n+r,"a=ice-pwd:")[0];return i&&s?{usernameFragment:i.substring(12),password:s.substring(10)}:null},t.writeIceParameters=function(n){let r="a=ice-ufrag:"+n.usernameFragment+`\r
a=ice-pwd:`+n.password+`\r
`;return n.iceLite&&(r+=`a=ice-lite\r
`),r},t.parseRtpParameters=function(n){const r={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},i=t.splitLines(n)[0].split(" ");r.profile=i[2];for(let o=3;o<i.length;o++){const c=i[o],d=t.matchPrefix(n,"a=rtpmap:"+c+" ")[0];if(d){const h=t.parseRtpMap(d),f=t.matchPrefix(n,"a=fmtp:"+c+" ");switch(h.parameters=f.length?t.parseFmtp(f[0]):{},h.rtcpFeedback=t.matchPrefix(n,"a=rtcp-fb:"+c+" ").map(t.parseRtcpFb),r.codecs.push(h),h.name.toUpperCase()){case"RED":case"ULPFEC":r.fecMechanisms.push(h.name.toUpperCase())}}}t.matchPrefix(n,"a=extmap:").forEach((o=>{r.headerExtensions.push(t.parseExtmap(o))}));const s=t.matchPrefix(n,"a=rtcp-fb:* ").map(t.parseRtcpFb);return r.codecs.forEach((o=>{s.forEach((c=>{o.rtcpFeedback.find((d=>d.type===c.type&&d.parameter===c.parameter))||o.rtcpFeedback.push(c)}))})),r},t.writeRtpDescription=function(n,r){let i="";i+="m="+n+" ",i+=r.codecs.length>0?"9":"0",i+=" "+(r.profile||"UDP/TLS/RTP/SAVPF")+" ",i+=r.codecs.map((o=>o.preferredPayloadType!==void 0?o.preferredPayloadType:o.payloadType)).join(" ")+`\r
`,i+=`c=IN IP4 0.0.0.0\r
`,i+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,r.codecs.forEach((o=>{i+=t.writeRtpMap(o),i+=t.writeFmtp(o),i+=t.writeRtcpFb(o)}));let s=0;return r.codecs.forEach((o=>{o.maxptime>s&&(s=o.maxptime)})),s>0&&(i+="a=maxptime:"+s+`\r
`),r.headerExtensions&&r.headerExtensions.forEach((o=>{i+=t.writeExtmap(o)})),i},t.parseRtpEncodingParameters=function(n){const r=[],i=t.parseRtpParameters(n),s=i.fecMechanisms.indexOf("RED")!==-1,o=i.fecMechanisms.indexOf("ULPFEC")!==-1,c=t.matchPrefix(n,"a=ssrc:").map((E=>t.parseSsrcMedia(E))).filter((E=>E.attribute==="cname")),d=c.length>0&&c[0].ssrc;let h;const f=t.matchPrefix(n,"a=ssrc-group:FID").map((E=>E.substring(17).split(" ").map((S=>parseInt(S,10)))));f.length>0&&f[0].length>1&&f[0][0]===d&&(h=f[0][1]),i.codecs.forEach((E=>{if(E.name.toUpperCase()==="RTX"&&E.parameters.apt){let S={ssrc:d,codecPayloadType:parseInt(E.parameters.apt,10)};d&&h&&(S.rtx={ssrc:h}),r.push(S),s&&(S=JSON.parse(JSON.stringify(S)),S.fec={ssrc:d,mechanism:o?"red+ulpfec":"red"},r.push(S))}})),r.length===0&&d&&r.push({ssrc:d});let g=t.matchPrefix(n,"b=");return g.length&&(g=g[0].indexOf("b=TIAS:")===0?parseInt(g[0].substring(7),10):g[0].indexOf("b=AS:")===0?1e3*parseInt(g[0].substring(5),10)*.95-16e3:void 0,r.forEach((E=>{E.maxBitrate=g}))),r},t.parseRtcpParameters=function(n){const r={},i=t.matchPrefix(n,"a=ssrc:").map((c=>t.parseSsrcMedia(c))).filter((c=>c.attribute==="cname"))[0];i&&(r.cname=i.value,r.ssrc=i.ssrc);const s=t.matchPrefix(n,"a=rtcp-rsize");r.reducedSize=s.length>0,r.compound=s.length===0;const o=t.matchPrefix(n,"a=rtcp-mux");return r.mux=o.length>0,r},t.writeRtcpParameters=function(n){let r="";return n.reducedSize&&(r+=`a=rtcp-rsize\r
`),n.mux&&(r+=`a=rtcp-mux\r
`),n.ssrc!==void 0&&n.cname&&(r+="a=ssrc:"+n.ssrc+" cname:"+n.cname+`\r
`),r},t.parseMsid=function(n){let r;const i=t.matchPrefix(n,"a=msid:");if(i.length===1)return r=i[0].substring(7).split(" "),{stream:r[0],track:r[1]};const s=t.matchPrefix(n,"a=ssrc:").map((o=>t.parseSsrcMedia(o))).filter((o=>o.attribute==="msid"));return s.length>0?(r=s[0].value.split(" "),{stream:r[0],track:r[1]}):void 0},t.parseSctpDescription=function(n){const r=t.parseMLine(n),i=t.matchPrefix(n,"a=max-message-size:");let s;i.length>0&&(s=parseInt(i[0].substring(19),10)),isNaN(s)&&(s=65536);const o=t.matchPrefix(n,"a=sctp-port:");if(o.length>0)return{port:parseInt(o[0].substring(12),10),protocol:r.fmt,maxMessageSize:s};const c=t.matchPrefix(n,"a=sctpmap:");if(c.length>0){const d=c[0].substring(10).split(" ");return{port:parseInt(d[0],10),protocol:d[1],maxMessageSize:s}}},t.writeSctpDescription=function(n,r){let i=[];return i=n.protocol!=="DTLS/SCTP"?["m="+n.kind+" 9 "+n.protocol+" "+r.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+r.port+`\r
`]:["m="+n.kind+" 9 "+n.protocol+" "+r.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+r.port+" "+r.protocol+` 65535\r
`],r.maxMessageSize!==void 0&&i.push("a=max-message-size:"+r.maxMessageSize+`\r
`),i.join("")},t.generateSessionId=function(){return Math.random().toString().substr(2,22)},t.writeSessionBoilerplate=function(n,r,i){let s;const o=r!==void 0?r:2;return s=n||t.generateSessionId(),`v=0\r
o=`+(i||"thisisadapterortc")+" "+s+" "+o+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},t.getDirection=function(n,r){const i=t.splitLines(n);for(let s=0;s<i.length;s++)switch(i[s]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return i[s].substring(2)}return r?t.getDirection(r):"sendrecv"},t.getKind=function(n){return t.splitLines(n)[0].split(" ")[0].substring(2)},t.isRejected=function(n){return n.split(" ",2)[1]==="0"},t.parseMLine=function(n){const r=t.splitLines(n)[0].substring(2).split(" ");return{kind:r[0],port:parseInt(r[1],10),protocol:r[2],fmt:r.slice(3).join(" ")}},t.parseOLine=function(n){const r=t.matchPrefix(n,"o=")[0].substring(2).split(" ");return{username:r[0],sessionId:r[1],sessionVersion:parseInt(r[2],10),netType:r[3],addressType:r[4],address:r[5]}},t.isValidSDP=function(n){if(typeof n!="string"||n.length===0)return!1;const r=t.splitLines(n);for(let i=0;i<r.length;i++)if(r[i].length<2||r[i].charAt(1)!=="=")return!1;return!0},e.exports=t})(dD);var uD=dD.exports,wf=R(uD),hH=m({__proto__:null,default:wf},[uD]);function sS(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)return;const t=e.RTCIceCandidate;e.RTCIceCandidate=function(n){if(typeof n=="object"&&n.candidate&&n.candidate.indexOf("a=")===0&&((n=JSON.parse(JSON.stringify(n))).candidate=n.candidate.substr(2)),n.candidate&&n.candidate.length){const r=new t(n),i=wf.parseCandidate(n.candidate),s=Object.assign(r,i);return s.toJSON=function(){return{candidate:s.candidate,sdpMid:s.sdpMid,sdpMLineIndex:s.sdpMLineIndex,usernameFragment:s.usernameFragment}},s}return new t(n)},e.RTCIceCandidate.prototype=t.prototype,_h(e,"icecandidate",(n=>(n.candidate&&Object.defineProperty(n,"candidate",{value:new e.RTCIceCandidate(n.candidate),writable:"false"}),n)))}function d0(e){!e.RTCIceCandidate||e.RTCIceCandidate&&"relayProtocol"in e.RTCIceCandidate.prototype||_h(e,"icecandidate",(t=>{if(t.candidate){const n=wf.parseCandidate(t.candidate.candidate);n.type==="relay"&&(t.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[n.priority>>24])}return t}))}function oS(e,t){if(!e.RTCPeerConnection)return;"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get(){return this._sctp===void 0?null:this._sctp}});const n=function(c){if(!c||!c.sdp)return!1;const d=wf.splitSections(c.sdp);return d.shift(),d.some((h=>{const f=wf.parseMLine(h);return f&&f.kind==="application"&&f.protocol.indexOf("SCTP")!==-1}))},r=function(c){const d=c.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(d===null||d.length<2)return-1;const h=parseInt(d[1],10);return h!=h?-1:h},i=function(c){let d=65536;return t.browser==="firefox"&&(d=t.version<57?c===-1?16384:2147483637:t.version<60?t.version===57?65535:65536:2147483637),d},s=function(c,d){let h=65536;t.browser==="firefox"&&t.version===57&&(h=65535);const f=wf.matchPrefix(c.sdp,"a=max-message-size:");return f.length>0?h=parseInt(f[0].substr(19),10):t.browser==="firefox"&&d!==-1&&(h=2147483637),h},o=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,t.browser==="chrome"&&t.version>=76){const{sdpSemantics:c}=this.getConfiguration();c==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return this._sctp===void 0?null:this._sctp},enumerable:!0,configurable:!0})}if(n(arguments[0])){const c=r(arguments[0]),d=i(c),h=s(arguments[0],c);let f;f=d===0&&h===0?Number.POSITIVE_INFINITY:d===0||h===0?Math.max(d,h):Math.min(d,h);const g={};Object.defineProperty(g,"maxMessageSize",{get:()=>f}),this._sctp=g}return o.apply(this,arguments)}}function aS(e){if(!e.RTCPeerConnection||!("createDataChannel"in e.RTCPeerConnection.prototype))return;function t(r,i){const s=r.send;r.send=function(){const o=arguments[0],c=o.length||o.size||o.byteLength;if(r.readyState==="open"&&i.sctp&&c>i.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+i.sctp.maxMessageSize+" bytes)");return s.apply(r,arguments)}}const n=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){const r=n.apply(this,arguments);return t(r,this),r},_h(e,"datachannel",(r=>(t(r.channel,r.target),r)))}function u0(e){if(!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype)return;const t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(n){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),n&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=n)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach((n=>{const r=t[n];t[n]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=i=>{const s=i.target;if(s._lastConnectionState!==s.connectionState){s._lastConnectionState=s.connectionState;const o=new Event("connectionstatechange",i);s.dispatchEvent(o)}return i},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),r.apply(this,arguments)}}))}function h0(e,t){if(!e.RTCPeerConnection||t.browser==="chrome"&&t.version>=71||t.browser==="safari"&&t.version>=605)return;const n=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(r){if(r&&r.sdp&&r.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const i=r.sdp.split(`
`).filter((s=>fi(s).call(s)!=="a=extmap-allow-mixed")).join(`
`);e.RTCSessionDescription&&r instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:r.type,sdp:i}):r.sdp=i}return n.apply(this,arguments)}}function cS(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const n=e.RTCPeerConnection.prototype.addIceCandidate;n&&n.length!==0&&(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(t.browser==="chrome"&&t.version<78||t.browser==="firefox"&&t.version<68||t.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?ke.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),ke.resolve())})}function lS(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const n=e.RTCPeerConnection.prototype.setLocalDescription;n&&n.length!==0&&(e.RTCPeerConnection.prototype.setLocalDescription=function(){let r=arguments[0]||{};if(typeof r!="object"||r.type&&r.sdp)return n.apply(this,arguments);if(r={type:r.type,sdp:r.sdp},!r.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":r.type="offer";break;default:r.type="answer"}return r.sdp||r.type!=="offer"&&r.type!=="answer"?n.apply(this,[r]):(r.type==="offer"?this.createOffer:this.createAnswer).apply(this).then((i=>n.apply(this,[i])))})}var pH=Object.freeze({__proto__:null,removeExtmapAllowMixed:h0,shimAddIceCandidateNullOrEmpty:cS,shimConnectionState:u0,shimMaxMessageSize:oS,shimParameterlessSetLocalDescription:lS,shimRTCIceCandidate:sS,shimRTCIceCandidateRelayProtocol:d0,shimSendThrowTypeError:aS});(function(){let{window:e}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const n=CP,r=(function(s){const o={browser:null,version:null};if(s===void 0||!s.navigator)return o.browser="Not a browser.",o;const{navigator:c}=s;if(c.mozGetUserMedia)o.browser="firefox",o.version=iS(c.userAgent,/Firefox\/(\d+)\./,1);else if(c.webkitGetUserMedia||s.isSecureContext===!1&&s.webkitRTCPeerConnection)o.browser="chrome",o.version=iS(c.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!s.RTCPeerConnection||!c.userAgent.match(/AppleWebKit\/(\d+)\./))return o.browser="Not a supported browser.",o;o.browser="safari",o.version=iS(c.userAgent,/AppleWebKit\/(\d+)\./,1),o.supportsUnifiedPlan=s.RTCRtpTransceiver&&"currentDirection"in s.RTCRtpTransceiver.prototype}return o})(e),i={browserDetails:r,commonShim:pH,extractVersion:iS,disableLog:Q8,disableWarnings:Z8,sdp:hH};switch(r.browser){case"chrome":if(!VP||!o0||!t.shimChrome)return n("Chrome shim is not included in this adapter release."),i;if(r.version===null)return n("Chrome shim can not determine version, not shimming."),i;n("adapter.js shimming chrome."),i.browserShim=VP,cS(e,r),lS(e),OP(e,r),PP(e),o0(e,r),DP(e),UP(e,r),kP(e),xP(e),LP(e),jP(e,r),sS(e),d0(e),u0(e),oS(e,r),aS(e),h0(e,r);break;case"firefox":if(!JP||!a0||!t.shimFirefox)return n("Firefox shim is not included in this adapter release."),i;n("adapter.js shimming firefox."),i.browserShim=JP,cS(e,r),lS(e),FP(e,r),a0(e,r),BP(e),HP(e),WP(e),GP(e),KP(e),zP(e),YP(e),qP(e),XP(e),sS(e),u0(e),oS(e,r),aS(e);break;case"safari":if(!oD||!t.shimSafari)return n("Safari shim is not included in this adapter release."),i;n("adapter.js shimming safari."),i.browserShim=oD,cS(e,r),lS(e),nD(e),iD(e),$P(e),QP(e),ZP(e),rD(e),eD(e),sD(e),sS(e),d0(e),oS(e,r),aS(e),h0(e,r);break;default:n("Unsupported browser!")}})({window:typeof window>"u"?void 0:window});var p0=re;Zt({global:!0,forced:p0.globalThis!==p0},{globalThis:p0});var hD=R(re),f0={exports:{}};(function(e,t){(function(n,r){var i="function",s="undefined",o="object",c="string",d="major",h="model",f="name",g="type",E="vendor",S="version",O="architecture",A="console",N="mobile",j="tablet",U="smarttv",W="wearable",$="embedded",Z="Amazon",Y="Apple",ie="ASUS",ue="BlackBerry",ge="Browser",Re="Chrome",St="Firefox",Ct="Google",at="Huawei",Qt="LG",qt="Microsoft",ti="Motorola",_e="Opera",Ae="Samsung",je="Sharp",Ee="Sony",b="Xiaomi",z="Zebra",Q="Facebook",Ce="Chromium OS",mt="Mac OS",_n=" Browser",dr=function(sr){for(var ur={},Rn=0;Rn<sr.length;Rn++)ur[sr[Rn].toUpperCase()]=sr[Rn];return ur},po=function(sr,ur){return typeof sr===c&&Zo(ur).indexOf(Zo(sr))!==-1},Zo=function(sr){return sr.toLowerCase()},jE=function(sr,ur){if(typeof sr===c)return sr=sr.replace(/^\s\s*/,""),typeof ur===s?sr:sr.substring(0,500)},Hh=function(sr,ur){for(var Rn,is,La,zn,Ol,jt,Ma=0;Ma<ur.length&&!Ol;){var Kh=ur[Ma],jc=ur[Ma+1];for(Rn=is=0;Rn<Kh.length&&!Ol&&Kh[Rn];)if(Ol=Kh[Rn++].exec(sr))for(La=0;La<jc.length;La++)jt=Ol[++is],typeof(zn=jc[La])===o&&zn.length>0?zn.length===2?typeof zn[1]==i?this[zn[0]]=zn[1].call(this,jt):this[zn[0]]=zn[1]:zn.length===3?typeof zn[1]!==i||zn[1].exec&&zn[1].test?this[zn[0]]=jt?jt.replace(zn[1],zn[2]):r:this[zn[0]]=jt?zn[1].call(this,jt,zn[2]):r:zn.length===4&&(this[zn[0]]=jt?zn[3].call(this,jt.replace(zn[1],zn[2])):r):this[zn]=jt||r;Ma+=2}},gm=function(sr,ur){for(var Rn in ur)if(typeof ur[Rn]===o&&ur[Rn].length>0){for(var is=0;is<ur[Rn].length;is++)if(po(ur[Rn][is],sr))return Rn==="?"?r:Rn}else if(po(ur[Rn],sr))return Rn==="?"?r:Rn;return ur.hasOwnProperty("*")?ur["*"]:sr},lR={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},dR={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[S,[f,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[S,[f,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[f,S],[/opios[\/ ]+([\w\.]+)/i],[S,[f,_e+" Mini"]],[/\bop(?:rg)?x\/([\w\.]+)/i],[S,[f,_e+" GX"]],[/\bopr\/([\w\.]+)/i],[S,[f,_e]],[/\bb[ai]*d(?:uhd|[ub]*[aekoprswx]{5,6})[\/ ]?([\w\.]+)/i],[S,[f,"Baidu"]],[/\b(?:mxbrowser|mxios|myie2)\/?([-\w\.]*)\b/i],[S,[f,"Maxthon"]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer|sleipnir)[\/ ]?([\w\.]*)/i,/(avant|iemobile|slim(?:browser|boat|jet))[\/ ]?([\d\.]*)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|duckduckgo|klar|helio|(?=comodo_)?dragon)\/([-\w\.]+)/i,/(heytap|ovi|115)browser\/([\d\.]+)/i,/(weibo)__([\d\.]+)/i],[f,S],[/quark(?:pc)?\/([-\w\.]+)/i],[S,[f,"Quark"]],[/\bddg\/([\w\.]+)/i],[S,[f,"DuckDuckGo"]],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[S,[f,"UC"+ge]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i,/micromessenger\/([\w\.]+)/i],[S,[f,"WeChat"]],[/konqueror\/([\w\.]+)/i],[S,[f,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[S,[f,"IE"]],[/ya(?:search)?browser\/([\w\.]+)/i],[S,[f,"Yandex"]],[/slbrowser\/([\w\.]+)/i],[S,[f,"Smart Lenovo "+ge]],[/(avast|avg)\/([\w\.]+)/i],[[f,/(.+)/,"$1 Secure "+ge],S],[/\bfocus\/([\w\.]+)/i],[S,[f,St+" Focus"]],[/\bopt\/([\w\.]+)/i],[S,[f,_e+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[S,[f,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[S,[f,"Dolphin"]],[/coast\/([\w\.]+)/i],[S,[f,_e+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[S,[f,"MIUI"+_n]],[/fxios\/([\w\.-]+)/i],[S,[f,St]],[/\bqihoobrowser\/?([\w\.]*)/i],[S,[f,"360"]],[/\b(qq)\/([\w\.]+)/i],[[f,/(.+)/,"$1Browser"],S],[/(oculus|sailfish|huawei|vivo|pico)browser\/([\w\.]+)/i],[[f,/(.+)/,"$1"+_n],S],[/samsungbrowser\/([\w\.]+)/i],[S,[f,Ae+" Internet"]],[/metasr[\/ ]?([\d\.]+)/i],[S,[f,"Sogou Explorer"]],[/(sogou)mo\w+\/([\d\.]+)/i],[[f,"Sogou Mobile"],S],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|2345(?=browser|chrome|explorer))\w*[\/ ]?v?([\w\.]+)/i],[f,S],[/(lbbrowser|rekonq)/i,/\[(linkedin)app\]/i],[f],[/ome\/([\w\.]+) \w* ?(iron) saf/i,/ome\/([\w\.]+).+qihu (360)[es]e/i],[S,f],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[f,Q],S],[/(Klarna)\/([\w\.]+)/i,/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(alipay)client\/([\w\.]+)/i,/(twitter)(?:and| f.+e\/([\w\.]+))/i,/(chromium|instagram|snapchat)[\/ ]([-\w\.]+)/i],[f,S],[/\bgsa\/([\w\.]+) .*safari\//i],[S,[f,"GSA"]],[/musical_ly(?:.+app_?version\/|_)([\w\.]+)/i],[S,[f,"TikTok"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[S,[f,Re+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[f,Re+" WebView"],S],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[S,[f,"Android "+ge]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[f,S],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[S,[f,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[S,f],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[f,[S,gm,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[f,S],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[f,"Netscape"],S],[/(wolvic|librewolf)\/([\w\.]+)/i],[f,S],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[S,[f,St+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i],[f,[S,/_/g,"."]],[/(cobalt)\/([\w\.]+)/i],[f,[S,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[O,"amd64"]],[/(ia32(?=;))/i],[[O,Zo]],[/((?:i[346]|x)86)[;\)]/i],[[O,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[O,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[O,"armhf"]],[/windows (ce|mobile); ppc;/i],[[O,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[O,/ower/,"",Zo]],[/(sun4\w)[;\)]/i],[[O,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[O,Zo]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[h,[E,Ae],[g,j]],[/\b((?:s[cgp]h|gt|sm)-(?![lr])\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]((?!sm-[lr])[-\w]+)/i,/sec-(sgh\w+)/i],[h,[E,Ae],[g,N]],[/(?:\/|\()(ip(?:hone|od)[\w, ]*)(?:\/|;)/i],[h,[E,Y],[g,N]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[h,[E,Y],[g,j]],[/(macintosh);/i],[h,[E,Y]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[h,[E,je],[g,N]],[/(?:honor)([-\w ]+)[;\)]/i],[h,[E,"Honor"],[g,N]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[h,[E,at],[g,j]],[/(?:huawei)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[h,[E,at],[g,N]],[/\b(poco[\w ]+|m2\d{3}j\d\d[a-z]{2})(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/oid[^\)]+; (m?[12][0-389][01]\w{3,6}[c-y])( bui|; wv|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite|pro)?)(?: bui|\))/i],[[h,/_/g," "],[E,b],[g,N]],[/oid[^\)]+; (2\d{4}(283|rpbf)[cgl])( bui|\))/i,/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[h,/_/g," "],[E,b],[g,j]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[h,[E,"OPPO"],[g,N]],[/\b(opd2\d{3}a?) bui/i],[h,[E,"OPPO"],[g,j]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[h,[E,"Vivo"],[g,N]],[/\b(rmx[1-3]\d{3})(?: bui|;|\))/i],[h,[E,"Realme"],[g,N]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[h,[E,ti],[g,N]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[h,[E,ti],[g,j]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[h,[E,Qt],[g,j]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[h,[E,Qt],[g,N]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[h,[E,"Lenovo"],[g,j]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[h,/_/g," "],[E,"Nokia"],[g,N]],[/(pixel c)\b/i],[h,[E,Ct],[g,j]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[h,[E,Ct],[g,N]],[/droid.+; (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[h,[E,Ee],[g,N]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[h,"Xperia Tablet"],[E,Ee],[g,j]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[h,[E,"OnePlus"],[g,N]],[/(alexa)webm/i,/(kf[a-z]{2}wi|aeo(?!bc)\w\w)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[h,[E,Z],[g,j]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[h,/(.+)/g,"Fire Phone $1"],[E,Z],[g,N]],[/(playbook);[-\w\),; ]+(rim)/i],[h,E,[g,j]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[h,[E,ue],[g,N]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[h,[E,ie],[g,j]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[h,[E,ie],[g,N]],[/(nexus 9)/i],[h,[E,"HTC"],[g,j]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[E,[h,/_/g," "],[g,N]],[/droid [\w\.]+; ((?:8[14]9[16]|9(?:0(?:48|60|8[01])|1(?:3[27]|66)|2(?:6[69]|9[56])|466))[gqswx])\w*(\)| bui)/i],[h,[E,"TCL"],[g,j]],[/(itel) ((\w+))/i],[[E,Zo],h,[g,gm,{tablet:["p10001l","w7001"],"*":"mobile"}]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[h,[E,"Acer"],[g,j]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[h,[E,"Meizu"],[g,N]],[/; ((?:power )?armor(?:[\w ]{0,8}))(?: bui|\))/i],[h,[E,"Ulefone"],[g,N]],[/; (energy ?\w+)(?: bui|\))/i,/; energizer ([\w ]+)(?: bui|\))/i],[h,[E,"Energizer"],[g,N]],[/; cat (b35);/i,/; (b15q?|s22 flip|s48c|s62 pro)(?: bui|\))/i],[h,[E,"Cat"],[g,N]],[/((?:new )?andromax[\w- ]+)(?: bui|\))/i],[h,[E,"Smartfren"],[g,N]],[/droid.+; (a(?:015|06[35]|142p?))/i],[h,[E,"Nothing"],[g,N]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron|infinix|tecno|micromax|advan)[-_ ]?([-\w]*)/i,/; (imo) ((?!tab)[\w ]+?)(?: bui|\))/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[E,h,[g,N]],[/(imo) (tab \w+)/i,/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[E,h,[g,j]],[/(surface duo)/i],[h,[E,qt],[g,j]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[h,[E,"Fairphone"],[g,N]],[/(u304aa)/i],[h,[E,"AT&T"],[g,N]],[/\bsie-(\w*)/i],[h,[E,"Siemens"],[g,N]],[/\b(rct\w+) b/i],[h,[E,"RCA"],[g,j]],[/\b(venue[\d ]{2,7}) b/i],[h,[E,"Dell"],[g,j]],[/\b(q(?:mv|ta)\w+) b/i],[h,[E,"Verizon"],[g,j]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[h,[E,"Barnes & Noble"],[g,j]],[/\b(tm\d{3}\w+) b/i],[h,[E,"NuVision"],[g,j]],[/\b(k88) b/i],[h,[E,"ZTE"],[g,j]],[/\b(nx\d{3}j) b/i],[h,[E,"ZTE"],[g,N]],[/\b(gen\d{3}) b.+49h/i],[h,[E,"Swiss"],[g,N]],[/\b(zur\d{3}) b/i],[h,[E,"Swiss"],[g,j]],[/\b((zeki)?tb.*\b) b/i],[h,[E,"Zeki"],[g,j]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[E,"Dragon Touch"],h,[g,j]],[/\b(ns-?\w{0,9}) b/i],[h,[E,"Insignia"],[g,j]],[/\b((nxa|next)-?\w{0,9}) b/i],[h,[E,"NextBook"],[g,j]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[E,"Voice"],h,[g,N]],[/\b(lvtel\-)?(v1[12]) b/i],[[E,"LvTel"],h,[g,N]],[/\b(ph-1) /i],[h,[E,"Essential"],[g,N]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[h,[E,"Envizen"],[g,j]],[/\b(trio[-\w\. ]+) b/i],[h,[E,"MachSpeed"],[g,j]],[/\btu_(1491) b/i],[h,[E,"Rotor"],[g,j]],[/(shield[\w ]+) b/i],[h,[E,"Nvidia"],[g,j]],[/(sprint) (\w+)/i],[E,h,[g,N]],[/(kin\.[onetw]{3})/i],[[h,/\./g," "],[E,qt],[g,N]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[h,[E,z],[g,j]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[h,[E,z],[g,N]],[/smart-tv.+(samsung)/i],[E,[g,U]],[/hbbtv.+maple;(\d+)/i],[[h,/^/,"SmartTV"],[E,Ae],[g,U]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[E,Qt],[g,U]],[/(apple) ?tv/i],[E,[h,Y+" TV"],[g,U]],[/crkey/i],[[h,Re+"cast"],[E,Ct],[g,U]],[/droid.+aft(\w+)( bui|\))/i],[h,[E,Z],[g,U]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[h,[E,je],[g,U]],[/(bravia[\w ]+)( bui|\))/i],[h,[E,Ee],[g,U]],[/(mitv-\w{5}) bui/i],[h,[E,b],[g,U]],[/Hbbtv.*(technisat) (.*);/i],[E,h,[g,U]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[E,jE],[h,jE],[g,U]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[g,U]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[E,h,[g,A]],[/droid.+; (shield) bui/i],[h,[E,"Nvidia"],[g,A]],[/(playstation [345portablevi]+)/i],[h,[E,Ee],[g,A]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[h,[E,qt],[g,A]],[/\b(sm-[lr]\d\d[05][fnuw]?s?)\b/i],[h,[E,Ae],[g,W]],[/((pebble))app/i],[E,h,[g,W]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[h,[E,Y],[g,W]],[/droid.+; (glass) \d/i],[h,[E,Ct],[g,W]],[/droid.+; (wt63?0{2,3})\)/i],[h,[E,z],[g,W]],[/droid.+; (glass) \d/i],[h,[E,Ct],[g,W]],[/(pico) (4|neo3(?: link|pro)?)/i],[E,h,[g,W]],[/; (quest( \d| pro)?)/i],[h,[E,Q],[g,W]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[E,[g,$]],[/(aeobc)\b/i],[h,[E,Z],[g,$]],[/droid .+?; ([^;]+?)(?: bui|; wv\)|\) applew).+? mobile safari/i],[h,[g,N]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[h,[g,j]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[g,j]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[g,N]],[/(android[-\w\. ]{0,9});.+buil/i],[h,[E,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[S,[f,"EdgeHTML"]],[/(arkweb)\/([\w\.]+)/i],[f,S],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[S,[f,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna|servo)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i,/\b(libweb)/i],[f,S],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[S,f]],os:[[/microsoft (windows) (vista|xp)/i],[f,S],[/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i],[f,[S,gm,lR]],[/windows nt 6\.2; (arm)/i,/windows[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i,/(?:win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[S,gm,lR],[f,"Windows"]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/(?:ios;fbsv\/|iphone.+ios[\/ ])([\d\.]+)/i,/cfnetwork\/.+darwin/i],[[S,/_/g,"."],[f,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[f,mt],[S,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[S,f],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish|openharmony)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[f,S],[/\(bb(10);/i],[S,[f,ue]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[S,[f,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[S,[f,St+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[S,[f,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[S,[f,"watchOS"]],[/crkey\/([\d\.]+)/i],[S,[f,Re+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[f,Ce],S],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[f,S],[/(sunos) ?([\w\.\d]*)/i],[[f,"Solaris"],S],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux|serenityos)/i,/(unix) ?([\w\.]*)/i],[f,S]]},fo=function(sr,ur){if(typeof sr===o&&(ur=sr,sr=r),!(this instanceof fo))return new fo(sr,ur).getResult();var Rn=typeof n!==s&&n.navigator?n.navigator:r,is=sr||(Rn&&Rn.userAgent?Rn.userAgent:""),La=Rn&&Rn.userAgentData?Rn.userAgentData:r,zn=ur?(function(jt,Ma){var Kh={};for(var jc in jt)Ma[jc]&&Ma[jc].length%2==0?Kh[jc]=Ma[jc].concat(jt[jc]):Kh[jc]=jt[jc];return Kh})(dR,ur):dR,Ol=Rn&&Rn.userAgent==is;return this.getBrowser=function(){var jt={};return jt[f]=r,jt[S]=r,Hh.call(jt,is,zn.browser),jt[d]=(function(Ma){return typeof Ma===c?Ma.replace(/[^\d\.]/g,"").split(".")[0]:r})(jt[S]),Ol&&Rn&&Rn.brave&&typeof Rn.brave.isBrave==i&&(jt[f]="Brave"),jt},this.getCPU=function(){var jt={};return jt[O]=r,Hh.call(jt,is,zn.cpu),jt},this.getDevice=function(){var jt={};return jt[E]=r,jt[h]=r,jt[g]=r,Hh.call(jt,is,zn.device),Ol&&!jt[g]&&La&&La.mobile&&(jt[g]=N),Ol&&jt[h]=="Macintosh"&&Rn&&typeof Rn.standalone!==s&&Rn.maxTouchPoints&&Rn.maxTouchPoints>2&&(jt[h]="iPad",jt[g]=j),jt},this.getEngine=function(){var jt={};return jt[f]=r,jt[S]=r,Hh.call(jt,is,zn.engine),jt},this.getOS=function(){var jt={};return jt[f]=r,jt[S]=r,Hh.call(jt,is,zn.os),Ol&&!jt[f]&&La&&La.platform&&La.platform!="Unknown"&&(jt[f]=La.platform.replace(/chrome os/i,Ce).replace(/macos/i,mt)),jt},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return is},this.setUA=function(jt){return is=typeof jt===c&&jt.length>500?jE(jt,500):jt,this},this.setUA(is),this};fo.VERSION="0.7.40",fo.BROWSER=dr([f,S,d]),fo.CPU=dr([O]),fo.DEVICE=dr([h,E,g,A,N,U,j,W,$]),fo.ENGINE=fo.OS=dr([f,S]),e.exports&&(t=e.exports=fo),t.UAParser=fo;var Nl=typeof n!==s&&(n.jQuery||n.Zepto);if(Nl&&!Nl.ua){var uR=new fo;Nl.ua=uR.getResult(),Nl.ua.get=function(){return uR.getUA()},Nl.ua.set=function(sr){uR.setUA(sr);var ur=uR.getResult();for(var Rn in ur)Nl.ua[Rn]=ur[Rn]}}})(typeof window=="object"?window:y)})(f0,f0.exports);var fH=R(f0.exports),pD=_d.clear;Zt({global:!0,bind:!0,forced:re.clearImmediate!==pD},{clearImmediate:pD});var fD=re,mH=se,_H=Ge,gH=Nu,EH=ni,vH=Pr,yH=Rs,SH=fD.Function,TH=/MSIE .\./.test(EH)||gH==="BUN"&&(function(){var e=fD.Bun.version.split(".");return e.length<3||e[0]==="0"&&(e[1]<3||e[1]==="3"&&e[2]==="0")})(),RH=Zt,mD=re,_D=_d.set,wH=function(e,t){var n=1;return TH?function(r,i){var s=yH(arguments.length,1)>n,o=_H(r)?r:SH(r),c=s?vH(arguments,n):[],d=s?function(){mH(o,this,c)}:o;return e(d)}:e},gD=mD.setImmediate?wH(_D):_D;RH({global:!0,bind:!0,forced:mD.setImmediate!==gD},{setImmediate:gD});var ED=R(ci.setImmediate),CH=re,bH=wg,IH=Xn,AH=Rs,NH=Fe;Zt({global:!0,dontCallGetSet:!0,forced:C((function(){return NH&&Object.getOwnPropertyDescriptor(CH,"queueMicrotask").value.length!==1}))},{queueMicrotask:function(e){AH(arguments.length,1),bH(IH(e))}});var vD=R(ci.queueMicrotask);function yD(e,t){return function(){return e.apply(t,arguments)}}const{toString:OH}=Object.prototype,{getPrototypeOf:m0}=Object,{iterator:dS,toStringTag:SD}=Symbol,uS=(_0=Object.create(null),e=>{const t=OH.call(e);return _0[t]||(_0[t]=t.slice(8,-1).toLowerCase())});var _0;const ya=e=>(e=e.toLowerCase(),t=>uS(t)===e),hS=e=>t=>typeof t===e,{isArray:Cf}=Array,Lg=hS("undefined"),TD=ya("ArrayBuffer"),PH=hS("string"),bs=hS("function"),RD=hS("number"),pS=e=>e!==null&&typeof e=="object",fS=e=>{if(uS(e)!=="object")return!1;const t=m0(e);return!(t!==null&&t!==Object.prototype&&Object.getPrototypeOf(t)!==null||SD in e||dS in e)},DH=ya("Date"),kH=ya("File"),xH=ya("Blob"),LH=ya("FileList"),MH=ya("URLSearchParams"),[UH,jH,VH,FH]=["ReadableStream","Request","Response","Headers"].map(ya);function Mg(e,t){let n,r,{allOwnKeys:i=!1}=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(e!=null)if(typeof e!="object"&&(e=[e]),Cf(e))for(n=0,r=e.length;n<r;n++)t.call(null,e[n],n,e);else{const s=i?Object.getOwnPropertyNames(e):Object.keys(e),o=s.length;let c;for(n=0;n<o;n++)c=s[n],t.call(null,e[c],c,e)}}function wD(e,t){t=t.toLowerCase();const n=Object.keys(e);let r,i=n.length;for(;i-- >0;)if(r=n[i],t===r.toLowerCase())return r;return null}const gh=hD!==void 0?hD:typeof self<"u"?self:typeof window<"u"?window:hA,CD=e=>!Lg(e)&&e!==gh,BH=(g0=typeof Uint8Array<"u"&&m0(Uint8Array),e=>g0&&e instanceof g0);var g0;const WH=ya("HTMLFormElement"),bD=(e=>{let{hasOwnProperty:t}=e;return(n,r)=>t.call(n,r)})(Object.prototype),GH=ya("RegExp"),ID=(e,t)=>{const n=Object.getOwnPropertyDescriptors(e),r={};Mg(n,((i,s)=>{let o;(o=t(i,s,e))!==!1&&(r[s]=o||i)})),Object.defineProperties(e,r)},HH=ya("AsyncFunction"),AD=(ND=typeof ED=="function",OD=bs(gh.postMessage),ND?ED:OD?(E0="axios@".concat(Math.random()),mS=[],gh.addEventListener("message",(e=>{let{source:t,data:n}=e;t===gh&&n===E0&&mS.length&&mS.shift()()}),!1),e=>{mS.push(e),gh.postMessage(E0,"*")}):e=>setTimeout(e));var ND,OD,E0,mS;const KH=vD!==void 0?vD.bind(gh):typeof process<"u"&&process.nextTick||AD;var Pe={isArray:Cf,isArrayBuffer:TD,isBuffer:function(e){return e!==null&&!Lg(e)&&e.constructor!==null&&!Lg(e.constructor)&&bs(e.constructor.isBuffer)&&e.constructor.isBuffer(e)},isFormData:e=>{let t;return e&&(typeof FormData=="function"&&e instanceof FormData||bs(e.append)&&((t=uS(e))==="formdata"||t==="object"&&bs(e.toString)&&e.toString()==="[object FormData]"))},isArrayBufferView:function(e){let t;return t=typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&TD(e.buffer),t},isString:PH,isNumber:RD,isBoolean:e=>e===!0||e===!1,isObject:pS,isPlainObject:fS,isReadableStream:UH,isRequest:jH,isResponse:VH,isHeaders:FH,isUndefined:Lg,isDate:DH,isFile:kH,isBlob:xH,isRegExp:GH,isFunction:bs,isStream:e=>pS(e)&&bs(e.pipe),isURLSearchParams:MH,isTypedArray:BH,isFileList:LH,forEach:Mg,merge:function e(){const{caseless:t}=CD(this)&&this||{},n={},r=(i,s)=>{const o=t&&wD(n,s)||s;fS(n[o])&&fS(i)?n[o]=e(n[o],i):fS(i)?n[o]=e({},i):Cf(i)?n[o]=i.slice():n[o]=i};for(let i=0,s=arguments.length;i<s;i++)arguments[i]&&Mg(arguments[i],r);return n},extend:function(e,t,n){let{allOwnKeys:r}=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return Mg(t,((i,s)=>{n&&bs(i)?e[s]=yD(i,n):e[s]=i}),{allOwnKeys:r}),e},trim:e=>fi(e)?fi(e).call(e):e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:e=>(e.charCodeAt(0)===65279&&(e=e.slice(1)),e),inherits:(e,t,n,r)=>{e.prototype=Object.create(t.prototype,r),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:t.prototype}),n&&Object.assign(e.prototype,n)},toFlatObject:(e,t,n,r)=>{let i,s,o;const c={};if(t=t||{},e==null)return t;do{for(i=Object.getOwnPropertyNames(e),s=i.length;s-- >0;)o=i[s],r&&!r(o,e,t)||c[o]||(t[o]=e[o],c[o]=!0);e=n!==!1&&m0(e)}while(e&&(!n||n(e,t))&&e!==Object.prototype);return t},kindOf:uS,kindOfTest:ya,endsWith:(e,t,n)=>{e=String(e),(n===void 0||n>e.length)&&(n=e.length),n-=t.length;const r=e.indexOf(t,n);return r!==-1&&r===n},toArray:e=>{if(!e)return null;if(Cf(e))return e;let t=e.length;if(!RD(t))return null;const n=new Array(t);for(;t-- >0;)n[t]=e[t];return n},forEachEntry:(e,t)=>{const n=(e&&e[dS]).call(e);let r;for(;(r=n.next())&&!r.done;){const i=r.value;t.call(e,i[0],i[1])}},matchAll:(e,t)=>{let n;const r=[];for(;(n=e.exec(t))!==null;)r.push(n);return r},isHTMLForm:WH,hasOwnProperty:bD,hasOwnProp:bD,reduceDescriptors:ID,freezeMethods:e=>{ID(e,((t,n)=>{if(bs(e)&&["arguments","caller","callee"].indexOf(n)!==-1)return!1;const r=e[n];bs(r)&&(t.enumerable=!1,"writable"in t?t.writable=!1:t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+n+"'")}))}))},toObjectSet:(e,t)=>{const n={},r=i=>{i.forEach((s=>{n[s]=!0}))};return Cf(e)?r(e):r(String(e).split(t)),n},toCamelCase:e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,(function(t,n,r){return n.toUpperCase()+r})),noop:()=>{},toFiniteNumber:(e,t)=>e!=null&&Number.isFinite(e=+e)?e:t,findKey:wD,global:gh,isContextDefined:CD,isSpecCompliantForm:function(e){return!!(e&&bs(e.append)&&e[SD]==="FormData"&&e[dS])},toJSONObject:e=>{const t=new Array(10),n=(r,i)=>{if(pS(r)){if(t.indexOf(r)>=0)return;if(!("toJSON"in r)){t[i]=r;const s=Cf(r)?[]:{};return Mg(r,((o,c)=>{const d=n(o,i+1);!Lg(d)&&(s[c]=d)})),t[i]=void 0,s}}return r};return n(e,0)},isAsyncFn:HH,isThenable:e=>e&&(pS(e)||bs(e))&&bs(e.then)&&bs(e.catch),setImmediate:AD,asap:KH,isIterable:e=>e!=null&&bs(e[dS])};function an(e,t,n,r,i){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=e,this.name="AxiosError",t&&(this.code=t),n&&(this.config=n),r&&(this.request=r),i&&(this.response=i,this.status=i.status?i.status:null)}Pe.inherits(an,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:Pe.toJSONObject(this.config),code:this.code,status:this.status}}});const PD=an.prototype,DD={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach((e=>{DD[e]={value:e}})),Object.defineProperties(an,DD),Object.defineProperty(PD,"isAxiosError",{value:!0}),an.from=(e,t,n,r,i,s)=>{const o=Object.create(PD);return Pe.toFlatObject(e,o,(function(c){return c!==Error.prototype}),(c=>c!=="isAxiosError")),an.call(o,e.message,t,n,r,i),o.cause=e,o.name=e.name,s&&Object.assign(o,s),o};function v0(e){return Pe.isPlainObject(e)||Pe.isArray(e)}function kD(e){return Pe.endsWith(e,"[]")?e.slice(0,-2):e}function xD(e,t,n){return e?e.concat(t).map((function(r,i){return r=kD(r),!n&&i?"["+r+"]":r})).join(n?".":""):t}const zH=Pe.toFlatObject(Pe,{},null,(function(e){return/^is[A-Z]/.test(e)}));function _S(e,t,n){if(!Pe.isObject(e))throw new TypeError("target must be an object");t=t||new FormData;const r=(n=Pe.toFlatObject(n,{metaTokens:!0,dots:!1,indexes:!1},!1,(function(E,S){return!Pe.isUndefined(S[E])}))).metaTokens,i=n.visitor||h,s=n.dots,o=n.indexes,c=(n.Blob||typeof Blob<"u"&&Blob)&&Pe.isSpecCompliantForm(t);if(!Pe.isFunction(i))throw new TypeError("visitor must be a function");function d(E){if(E===null)return"";if(Pe.isDate(E))return E.toISOString();if(!c&&Pe.isBlob(E))throw new an("Blob is not supported. Use a Buffer instead.");return Pe.isArrayBuffer(E)||Pe.isTypedArray(E)?c&&typeof Blob=="function"?new Blob([E]):Buffer.from(E):E}function h(E,S,O){let A=E;if(E&&!O&&typeof E=="object"){if(Pe.endsWith(S,"{}"))S=r?S:S.slice(0,-2),E=JSON.stringify(E);else if(Pe.isArray(E)&&(function(N){return Pe.isArray(N)&&!N.some(v0)})(E)||(Pe.isFileList(E)||Pe.endsWith(S,"[]"))&&(A=Pe.toArray(E)))return S=kD(S),A.forEach((function(N,j){!Pe.isUndefined(N)&&N!==null&&t.append(o===!0?xD([S],j,s):o===null?S:S+"[]",d(N))})),!1}return!!v0(E)||(t.append(xD(O,S,s),d(E)),!1)}const f=[],g=Object.assign(zH,{defaultVisitor:h,convertValue:d,isVisitable:v0});if(!Pe.isObject(e))throw new TypeError("data must be an object");return(function E(S,O){if(!Pe.isUndefined(S)){if(f.indexOf(S)!==-1)throw Error("Circular reference detected in "+O.join("."));f.push(S),Pe.forEach(S,(function(A,N){(!(Pe.isUndefined(A)||A===null)&&i.call(t,A,Pe.isString(N)?fi(N).call(N):N,O,g))===!0&&E(A,O?O.concat(N):[N])})),f.pop()}})(e),t}function LD(e){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,(function(n){return t[n]}))}function y0(e,t){this._pairs=[],e&&_S(e,this,t)}const MD=y0.prototype;function YH(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function UD(e,t,n){if(!t)return e;const r=n&&n.encode||YH;Pe.isFunction(n)&&(n={serialize:n});const i=n&&n.serialize;let s;if(s=i?i(t,n):Pe.isURLSearchParams(t)?t.toString():new y0(t,n).toString(r),s){const o=e.indexOf("#");o!==-1&&(e=e.slice(0,o)),e+=(e.indexOf("?")===-1?"?":"&")+s}return e}MD.append=function(e,t){this._pairs.push([e,t])},MD.toString=function(e){const t=e?function(n){return e.call(this,n,LD)}:LD;return this._pairs.map((function(n){return t(n[0])+"="+t(n[1])}),"").join("&")};var jD=class{constructor(){this.handlers=[]}use(e,t,n){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!n&&n.synchronous,runWhen:n?n.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){Pe.forEach(this.handlers,(function(t){t!==null&&e(t)}))}},VD={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},FD={exports:{}},qH=Zt,XH=Fe,BD=Ki.f;qH({target:"Object",stat:!0,forced:Object.defineProperty!==BD,sham:!XH},{defineProperty:BD});var WD=ci.Object,JH=FD.exports=function(e,t,n){return WD.defineProperty(e,t,n)};WD.defineProperty.sham&&(JH.sham=!0);var GD=R(FD.exports),QH=TypeError,HD=ra,ZH=Fr,$H=Sr,eK=Mn("species"),KD=Array,tK=function(e){var t;return HD(e)&&(t=e.constructor,(ZH(t)&&(t===KD||HD(t.prototype))||$H(t)&&(t=t[eK])===null)&&(t=void 0)),t===void 0?KD:t},zD=function(e,t){return new(tK(e))(t===0?0:t)},nK=C,rK=Di,iK=Mn("species"),YD=function(e){return rK>=51||!nK((function(){var t=[];return(t.constructor={})[iK]=function(){return{foo:1}},t[e](Boolean).foo!==1}))},sK=Zt,oK=C,aK=ra,cK=Sr,lK=To,dK=ec,qD=function(e){if(e>9007199254740991)throw QH("Maximum allowed index exceeded");return e},XD=MC,uK=zD,hK=YD,pK=Di,JD=Mn("isConcatSpreadable"),fK=pK>=51||!oK((function(){var e=[];return e[JD]=!1,e.concat()[0]!==e})),mK=function(e){if(!cK(e))return!1;var t=e[JD];return t!==void 0?!!t:aK(e)};sK({target:"Array",proto:!0,forced:!fK||!hK("concat")},{concat:function(e){var t,n,r,i,s,o=lK(this),c=uK(o,0),d=0;for(t=-1,r=arguments.length;t<r;t++)if(mK(s=t===-1?o:arguments[t]))for(i=dK(s),qD(d+i),n=0;n<i;n++,d++)n in s&&XD(c,d,s[n]);else qD(d+1),XD(c,d++,s);return c.length=d,c}});var QD={},_K=Te,gK=Ei,ZD=sa.f,EK=Pr,$D=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];QD.f=function(e){return $D&&_K(e)==="Window"?(function(t){try{return ZD(t)}catch{return EK($D)}})(e):ZD(gK(e))};var bf={},vK=Mn;bf.f=vK;var ek=ci,yK=Tr,SK=bf,TK=Ki.f,Dr=function(e){var t=ek.Symbol||(ek.Symbol={});yK(t,e)||TK(t,e,{value:SK.f(e)})},RK=Je,wK=Vr,CK=Mn,bK=fa,tk=function(){var e=wK("Symbol"),t=e&&e.prototype,n=t&&t.valueOf,r=CK("toPrimitive");t&&!t[r]&&bK(t,r,(function(i){return RK(n,this)}),{})},IK=Qa,AK=Gt,NK=To,OK=ec,PK=zD,nk=K([].push),DK=function(e){var t=e===1,n=e===2,r=e===3,i=e===4,s=e===6,o=e===7,c=e===5||s;return function(d,h,f,g){for(var E,S,O=NK(d),A=AK(O),N=OK(A),j=IK(h,f),U=0,W=g||PK,$=t?W(d,N):n||o?W(d,0):void 0;N>U;U++)if((c||U in A)&&(S=j(E=A[U],U,O),e))if(t)$[U]=S;else if(S)switch(e){case 3:return!0;case 5:return E;case 6:return U;case 2:nk($,E)}else switch(e){case 4:return!1;case 7:nk($,E)}return s?-1:r||i?i:$}},rk={forEach:DK(0)},gS=Zt,Ug=re,S0=Je,kK=K,If=Fe,Af=yo,xK=C,Ci=Tr,LK=ee,T0=di,ES=Ei,R0=Un,MK=zi,w0=it,Nf=Vu,ik=Li,UK=sa,sk=QD,jK=nd,ok=pt,ak=Ki,VK=ac,ck=De,lk=fa,FK=dc,C0=Jc,dk=Xs,uk=jl,BK=Mn,WK=bf,GK=Dr,HK=tk,KK=Ao,hk=lc,vS=rk.forEach,Is=ed("hidden"),yS="Symbol",jg="prototype",zK=hk.set,pk=hk.getterFor(yS),Sa=Object[jg],Eh=Ug.Symbol,SS=Eh&&Eh[jg],YK=Ug.RangeError,qK=Ug.TypeError,b0=Ug.QObject,fk=ok.f,vh=ak.f,mk=sk.f,XK=ck.f,_k=kK([].push),gl=C0("symbols"),Vg=C0("op-symbols"),JK=C0("wks"),I0=!b0||!b0[jg]||!b0[jg].findChild,gk=function(e,t,n){var r=fk(Sa,t);r&&delete Sa[t],vh(e,t,n),r&&e!==Sa&&vh(Sa,t,r)},A0=If&&xK((function(){return Nf(vh({},"a",{get:function(){return vh(this,"a",{value:7}).a}})).a!==7}))?gk:vh,N0=function(e,t){var n=gl[e]=Nf(SS);return zK(n,{type:yS,tag:e,description:t}),If||(n.description=t),n},TS=function(e,t,n){e===Sa&&TS(Vg,t,n),T0(e);var r=R0(t);return T0(n),Ci(gl,r)?(n.enumerable?(Ci(e,Is)&&e[Is][r]&&(e[Is][r]=!1),n=Nf(n,{enumerable:w0(0,!1)})):(Ci(e,Is)||vh(e,Is,w0(1,Nf(null))),e[Is][r]=!0),A0(e,r,n)):vh(e,r,n)},O0=function(e,t){T0(e);var n=ES(t),r=ik(n).concat(Sk(n));return vS(r,(function(i){If&&!S0(Ek,n,i)||TS(e,i,n[i])})),e},Ek=function(e){var t=R0(e),n=S0(XK,this,t);return!(this===Sa&&Ci(gl,t)&&!Ci(Vg,t))&&(!(n||!Ci(this,t)||!Ci(gl,t)||Ci(this,Is)&&this[Is][t])||n)},vk=function(e,t){var n=ES(e),r=R0(t);if(n!==Sa||!Ci(gl,r)||Ci(Vg,r)){var i=fk(n,r);return!i||!Ci(gl,r)||Ci(n,Is)&&n[Is][r]||(i.enumerable=!0),i}},yk=function(e){var t=mk(ES(e)),n=[];return vS(t,(function(r){Ci(gl,r)||Ci(dk,r)||_k(n,r)})),n},Sk=function(e){var t=e===Sa,n=mk(t?Vg:ES(e)),r=[];return vS(n,(function(i){!Ci(gl,i)||t&&!Ci(Sa,i)||_k(r,gl[i])})),r};Af||(Eh=function(){if(LK(SS,this))throw new qK("Symbol is not a constructor");var e=arguments.length&&arguments[0]!==void 0?MK(arguments[0]):void 0,t=uk(e),n=function(r){var i=this===void 0?Ug:this;i===Sa&&S0(n,Vg,r),Ci(i,Is)&&Ci(i[Is],t)&&(i[Is][t]=!1);var s=w0(1,r);try{A0(i,t,s)}catch(o){if(!(o instanceof YK))throw o;gk(i,t,s)}};return If&&I0&&A0(Sa,t,{configurable:!0,set:n}),N0(t,e)},lk(SS=Eh[jg],"toString",(function(){return pk(this).tag})),lk(Eh,"withoutSetter",(function(e){return N0(uk(e),e)})),ck.f=Ek,ak.f=TS,VK.f=O0,ok.f=vk,UK.f=sk.f=yk,jK.f=Sk,WK.f=function(e){return N0(BK(e),e)},If&&FK(SS,"description",{configurable:!0,get:function(){return pk(this).description}})),gS({global:!0,wrap:!0,forced:!Af,sham:!Af},{Symbol:Eh}),vS(ik(JK),(function(e){GK(e)})),gS({target:yS,stat:!0,forced:!Af},{useSetter:function(){I0=!0},useSimple:function(){I0=!1}}),gS({target:"Object",stat:!0,forced:!Af,sham:!If},{create:function(e,t){return t===void 0?Nf(e):O0(Nf(e),t)},defineProperty:TS,defineProperties:O0,getOwnPropertyDescriptor:vk}),gS({target:"Object",stat:!0,forced:!Af},{getOwnPropertyNames:yk}),HK(),KK(Eh,yS),dk[Is]=!0;var Tk=yo&&!!Symbol.for&&!!Symbol.keyFor,QK=Zt,ZK=Vr,$K=Tr,ez=zi,Rk=Jc,tz=Tk,P0=Rk("string-to-symbol-registry"),nz=Rk("symbol-to-string-registry");QK({target:"Symbol",stat:!0,forced:!tz},{for:function(e){var t=ez(e);if($K(P0,t))return P0[t];var n=ZK("Symbol")(t);return P0[t]=n,nz[n]=t,n}});var rz=Zt,iz=Tr,sz=za,oz=yn,az=Tk,wk=Jc("symbol-to-string-registry");rz({target:"Symbol",stat:!0,forced:!az},{keyFor:function(e){if(!sz(e))throw new TypeError(oz(e)+" is not a symbol");if(iz(wk,e))return wk[e]}});var Ck=ra,cz=Ge,bk=Te,lz=zi,Ik=K([].push),dz=Zt,Ak=Vr,Nk=se,uz=Je,Fg=K,Ok=C,Pk=Ge,Dk=za,kk=Pr,hz=function(e){if(cz(e))return e;if(Ck(e)){for(var t=e.length,n=[],r=0;r<t;r++){var i=e[r];typeof i=="string"?Ik(n,i):typeof i!="number"&&bk(i)!=="Number"&&bk(i)!=="String"||Ik(n,lz(i))}var s=n.length,o=!0;return function(c,d){if(o)return o=!1,d;if(Ck(this))return d;for(var h=0;h<s;h++)if(n[h]===c)return d}}},pz=yo,fz=String,bd=Ak("JSON","stringify"),RS=Fg(/./.exec),xk=Fg("".charAt),mz=Fg("".charCodeAt),_z=Fg("".replace),gz=Fg(1 .toString),Ez=/[\uD800-\uDFFF]/g,Lk=/^[\uD800-\uDBFF]$/,Mk=/^[\uDC00-\uDFFF]$/,Uk=!pz||Ok((function(){var e=Ak("Symbol")("stringify detection");return bd([e])!=="[null]"||bd({a:e})!=="{}"||bd(Object(e))!=="{}"})),jk=Ok((function(){return bd("\uDF06\uD834")!=='"\\udf06\\ud834"'||bd("\uDEAD")!=='"\\udead"'})),vz=function(e,t){var n=kk(arguments),r=hz(t);if(Pk(r)||e!==void 0&&!Dk(e))return n[1]=function(i,s){if(Pk(r)&&(s=uz(r,this,fz(i),s)),!Dk(s))return s},Nk(bd,null,n)},yz=function(e,t,n){var r=xk(n,t-1),i=xk(n,t+1);return RS(Lk,e)&&!RS(Mk,i)||RS(Mk,e)&&!RS(Lk,r)?"\\u"+gz(mz(e,0),16):e};bd&&dz({target:"JSON",stat:!0,forced:Uk||jk},{stringify:function(e,t,n){var r=kk(arguments),i=Nk(Uk?vz:bd,null,r);return jk&&typeof i=="string"?_z(i,Ez,yz):i}});var Vk=nd,Sz=To;Zt({target:"Object",stat:!0,forced:!yo||C((function(){Vk.f(1)}))},{getOwnPropertySymbols:function(e){var t=Vk.f;return t?t(Sz(e)):[]}}),Dr("asyncIterator"),Dr("hasInstance"),Dr("isConcatSpreadable"),Dr("iterator"),Dr("match"),Dr("matchAll"),Dr("replace"),Dr("search"),Dr("species"),Dr("split");var Tz=tk;Dr("toPrimitive"),Tz();var Rz=Vr,wz=Ao;Dr("toStringTag"),wz(Rz("Symbol"),"Symbol"),Dr("unscopables"),Ao(re.JSON,"JSON",!0);var Cz=ci.Symbol,bz=Mn,Iz=Ki.f,Fk=bz("metadata"),Bk=Function.prototype;Bk[Fk]===void 0&&Iz(Bk,Fk,{value:null}),Dr("asyncDispose"),Dr("dispose"),Dr("metadata");var Az=Cz,Nz=K,D0=Vr("Symbol"),Oz=D0.keyFor,Pz=Nz(D0.prototype.valueOf),Wk=D0.isRegisteredSymbol||function(e){try{return Oz(Pz(e))!==void 0}catch{return!1}};Zt({target:"Symbol",stat:!0},{isRegisteredSymbol:Wk});for(var Dz=Jc,Gk=Vr,kz=K,xz=za,Lz=Mn,wS=Gk("Symbol"),Hk=wS.isWellKnownSymbol,Kk=Gk("Object","getOwnPropertyNames"),Mz=kz(wS.prototype.valueOf),zk=Dz("wks"),k0=0,Yk=Kk(wS),Uz=Yk.length;k0<Uz;k0++)try{var qk=Yk[k0];xz(wS[qk])&&Lz(qk)}catch{}var Xk=function(e){if(Hk&&Hk(e))return!0;try{for(var t=Mz(e),n=0,r=Kk(zk),i=r.length;n<i;n++)if(zk[r[n]]==t)return!0}catch{}return!1};Zt({target:"Symbol",stat:!0,forced:!0},{isWellKnownSymbol:Xk}),Dr("customMatcher"),Dr("observable"),Zt({target:"Symbol",stat:!0},{isRegistered:Wk}),Zt({target:"Symbol",stat:!0,forced:!0},{isWellKnown:Xk}),Dr("matcher"),Dr("metadataKey"),Dr("patternMatch"),Dr("replaceAll");var Of=R(Az),Jk=R(bf.f("iterator"));function Bg(e){return Bg=typeof Of=="function"&&typeof Jk=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Of=="function"&&t.constructor===Of&&t!==Of.prototype?"symbol":typeof t},Bg(e)}var jz=R(bf.f("toPrimitive"));function Vz(e){var t=(function(n,r){if(Bg(n)!="object"||!n)return n;var i=n[jz];if(i!==void 0){var s=i.call(n,r);if(Bg(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(r==="string"?String:Number)(n)})(e,"string");return Bg(t)=="symbol"?t:t+""}function x(e,t,n){return(t=Vz(t))in e?GD(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Qk=R(V6),Fz={isBrowser:!0,classes:{URLSearchParams:Qk!==void 0?Qk:y0,FormData:typeof FormData<"u"?FormData:null,Blob:typeof Blob<"u"?Blob:null},protocols:["http","https","file","blob","url","data"]};const x0=typeof window<"u"&&typeof document<"u",L0=typeof navigator=="object"&&navigator||void 0,Bz=x0&&(!L0||["ReactNative","NativeScript","NS"].indexOf(L0.product)<0),Wz=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",Gz=x0&&window.location.href||"http://localhost";function Zk(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable}))),n.push.apply(n,r)}return n}function $k(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Zk(Object(n),!0).forEach((function(r){x(e,r,n[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Zk(Object(n)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))}))}return e}var Zi=$k($k({},Object.freeze({__proto__:null,hasBrowserEnv:x0,hasStandardBrowserEnv:Bz,hasStandardBrowserWebWorkerEnv:Wz,navigator:L0,origin:Gz})),Fz),Hz=di,Kz=Je,zz=Tr,Yz=ee,qz=function(){var e=Hz(this),t="";return e.hasIndices&&(t+="d"),e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.unicodeSets&&(t+="v"),e.sticky&&(t+="y"),t},ex=RegExp.prototype,tx=function(e){var t=e.flags;return t!==void 0||"flags"in ex||zz(e,"flags")||!Yz(ex,e)?t:Kz(qz,e)},Xz=TC.charAt,nx=Je,Jz=di,Qz=Ge,Zz=Te,$z=/./.exec,eY=TypeError,tY=Zt,rx=Je,ix=gt,nY=Ju,CS=$p,sx=er,ox=Av,Wg=zi,rY=di,iY=Sr,sY=Te,oY=r_,ax=tx,aY=os,cY=C,lY=hl,dY=function(e,t,n){return t+(n?Xz(e,t).length:1)},uY=function(e,t){var n=e.exec;if(Qz(n)){var r=nx(n,e,t);return r!==null&&Jz(r),r}if(Zz(e)==="RegExp")return nx($z,e,t);throw new eY("RegExp#exec called on incompatible receiver")},cx=lc,hY=Mn("matchAll"),lx="RegExp String",dx=lx+" Iterator",pY=cx.set,fY=cx.getterFor(dx),mY=TypeError,M0=ix("".indexOf),bS=ix("".matchAll),U0=!!bS&&!cY((function(){bS("a",/./)})),_Y=nY((function(e,t,n,r){pY(this,{type:dx,regexp:e,string:t,global:n,unicode:r,done:!1})}),lx,(function(){var e=fY(this);if(e.done)return CS(void 0,!0);var t=e.regexp,n=e.string,r=uY(t,n);return r===null?(e.done=!0,CS(void 0,!0)):e.global?(Wg(r[0])===""&&(t.lastIndex=dY(n,ox(t.lastIndex),e.unicode)),CS(r,!1)):(e.done=!0,CS(r,!1))})),ux=function(e){var t,n,r,i=rY(this),s=Wg(e),o=lY(i,RegExp),c=Wg(ax(i));return t=new o(o===RegExp?i.source:i,c),n=!!~M0(c,"g"),r=!!~M0(c,"u"),t.lastIndex=ox(i.lastIndex),new _Y(t,s,n,r)};tY({target:"String",proto:!0,forced:U0},{matchAll:function(e){var t,n,r,i,s=sx(this);if(iY(e)){if(oY(e)&&(t=Wg(sx(ax(e))),!~M0(t,"g")))throw new mY("`.matchAll` does not allow non-global regexes");if(U0)return bS(s,e);if((r=aY(e,hY))===void 0&&sY(e)==="RegExp"&&(r=ux),r)return rx(r,e,s)}else if(U0)return bS(s,e);return n=Wg(s),i=new RegExp(e,"g"),rx(ux,i,n)}});var gY=cs("String","matchAll"),EY=ee,vY=gY,j0=String.prototype,yY=function(e){var t=e.matchAll;return typeof e=="string"||e===j0||EY(j0,e)&&t===j0.matchAll?vY:t},SY=R(yY);function hx(e){function t(n,r,i,s){let o=n[s++];if(o==="__proto__")return!0;const c=Number.isFinite(+o),d=s>=n.length;return o=!o&&Pe.isArray(i)?i.length:o,d?(Pe.hasOwnProp(i,o)?i[o]=[i[o],r]:i[o]=r,!c):(i[o]&&Pe.isObject(i[o])||(i[o]=[]),t(n,r,i[o],s)&&Pe.isArray(i[o])&&(i[o]=(function(h){const f={},g=Object.keys(h);let E;const S=g.length;let O;for(E=0;E<S;E++)O=g[E],f[O]=h[O];return f})(i[o])),!c)}if(Pe.isFormData(e)&&Pe.isFunction(e.entries)){const n={};return Pe.forEachEntry(e,((r,i)=>{t((function(s){return SY(Pe).call(Pe,/\w+|\[(\w*)]/g,s).map((o=>o[0]==="[]"?"":o[1]||o[0]))})(r),i,n,0)})),n}return null}const V0={transitional:VD,adapter:["xhr","http","fetch"],transformRequest:[function(e,t){const n=t.getContentType()||"",r=n.indexOf("application/json")>-1,i=Pe.isObject(e);if(i&&Pe.isHTMLForm(e)&&(e=new FormData(e)),Pe.isFormData(e))return r?JSON.stringify(hx(e)):e;if(Pe.isArrayBuffer(e)||Pe.isBuffer(e)||Pe.isStream(e)||Pe.isFile(e)||Pe.isBlob(e)||Pe.isReadableStream(e))return e;if(Pe.isArrayBufferView(e))return e.buffer;if(Pe.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let s;if(i){if(n.indexOf("application/x-www-form-urlencoded")>-1)return(function(o,c){return _S(o,new Zi.classes.URLSearchParams,Object.assign({visitor:function(d,h,f,g){return Zi.isNode&&Pe.isBuffer(d)?(this.append(h,d.toString("base64")),!1):g.defaultVisitor.apply(this,arguments)}},c))})(e,this.formSerializer).toString();if((s=Pe.isFileList(e))||n.indexOf("multipart/form-data")>-1){const o=this.env&&this.env.FormData;return _S(s?{"files[]":e}:e,o&&new o,this.formSerializer)}}return i||r?(t.setContentType("application/json",!1),(function(o,c,d){if(Pe.isString(o))try{return(c||JSON.parse)(o),fi(Pe).call(Pe,o)}catch(h){if(h.name!=="SyntaxError")throw h}return(d||JSON.stringify)(o)})(e)):e}],transformResponse:[function(e){const t=this.transitional||V0.transitional,n=t&&t.forcedJSONParsing,r=this.responseType==="json";if(Pe.isResponse(e)||Pe.isReadableStream(e))return e;if(e&&Pe.isString(e)&&(n&&!this.responseType||r)){const i=!(t&&t.silentJSONParsing)&&r;try{return JSON.parse(e)}catch(s){if(i)throw s.name==="SyntaxError"?an.from(s,an.ERR_BAD_RESPONSE,this,null,this.response):s}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Zi.classes.FormData,Blob:Zi.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};Pe.forEach(["delete","get","head","post","put","patch"],(e=>{V0.headers[e]={}}));var F0=V0;const TY=Pe.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),px=Symbol("internals");function Gg(e){var t;return e&&fi(t=String(e)).call(t).toLowerCase()}function IS(e){return e===!1||e==null?e:Pe.isArray(e)?e.map(IS):String(e)}function B0(e,t,n,r,i){return Pe.isFunction(r)?r.call(this,t,n):(i&&(t=n),Pe.isString(t)?Pe.isString(r)?t.indexOf(r)!==-1:Pe.isRegExp(r)?r.test(t):void 0:void 0)}class AS{constructor(t){t&&this.set(t)}set(t,n,r){const i=this;function s(d,h,f){const g=Gg(h);if(!g)throw new Error("header name must be a non-empty string");const E=Pe.findKey(i,g);(!E||i[E]===void 0||f===!0||f===void 0&&i[E]!==!1)&&(i[E||h]=IS(d))}const o=(d,h)=>Pe.forEach(d,((f,g)=>s(f,g,h)));if(Pe.isPlainObject(t)||t instanceof this.constructor)o(t,n);else if(Pe.isString(t)&&(t=fi(t).call(t))&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(fi(c=t).call(c)))o((d=>{const h={};let f,g,E;return d&&d.split(`
`).forEach((function(S){var O,A;E=S.indexOf(":"),f=fi(O=S.substring(0,E)).call(O).toLowerCase(),g=fi(A=S.substring(E+1)).call(A),!f||h[f]&&TY[f]||(f==="set-cookie"?h[f]?h[f].push(g):h[f]=[g]:h[f]=h[f]?h[f]+", "+g:g)})),h})(t),n);else if(Pe.isObject(t)&&Pe.isIterable(t)){let d,h,f={};for(const g of t){if(!Pe.isArray(g))throw TypeError("Object iterator must return a key-value pair");f[h=g[0]]=(d=f[h])?Pe.isArray(d)?[...d,g[1]]:[d,g[1]]:g[1]}o(f,n)}else t!=null&&s(n,t,r);var c;return this}get(t,n){if(t=Gg(t)){const r=Pe.findKey(this,t);if(r){const i=this[r];if(!n)return i;if(n===!0)return(function(s){const o=Object.create(null),c=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let d;for(;d=c.exec(s);)o[d[1]]=d[2];return o})(i);if(Pe.isFunction(n))return n.call(this,i,r);if(Pe.isRegExp(n))return n.exec(i);throw new TypeError("parser must be boolean|regexp|function")}}}has(t,n){if(t=Gg(t)){const r=Pe.findKey(this,t);return!(!r||this[r]===void 0||n&&!B0(0,this[r],r,n))}return!1}delete(t,n){const r=this;let i=!1;function s(o){if(o=Gg(o)){const c=Pe.findKey(r,o);!c||n&&!B0(0,r[c],c,n)||(delete r[c],i=!0)}}return Pe.isArray(t)?t.forEach(s):s(t),i}clear(t){const n=Object.keys(this);let r=n.length,i=!1;for(;r--;){const s=n[r];t&&!B0(0,this[s],s,t,!0)||(delete this[s],i=!0)}return i}normalize(t){const n=this,r={};return Pe.forEach(this,((i,s)=>{var o;const c=Pe.findKey(r,s);if(c)return n[c]=IS(i),void delete n[s];const d=t?(function(h){return fi(h).call(h).toLowerCase().replace(/([a-z\d])(\w*)/g,((f,g,E)=>g.toUpperCase()+E))})(s):fi(o=String(s)).call(o);d!==s&&delete n[s],n[d]=IS(i),r[d]=!0})),this}concat(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return this.constructor.concat(this,...n)}toJSON(t){const n=Object.create(null);return Pe.forEach(this,((r,i)=>{r!=null&&r!==!1&&(n[i]=t&&Pe.isArray(r)?r.join(", "):r)})),n}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map((t=>{let[n,r]=t;return n+": "+r})).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(t){return t instanceof this?t:new this(t)}static concat(t){const n=new this(t);for(var r=arguments.length,i=new Array(r>1?r-1:0),s=1;s<r;s++)i[s-1]=arguments[s];return i.forEach((o=>n.set(o))),n}static accessor(t){const n=(this[px]=this[px]={accessors:{}}).accessors,r=this.prototype;function i(s){const o=Gg(s);n[o]||((function(c,d){const h=Pe.toCamelCase(" "+d);["get","set","has"].forEach((f=>{Object.defineProperty(c,f+h,{value:function(g,E,S){return this[f].call(this,d,g,E,S)},configurable:!0})}))})(r,s),n[o]=!0)}return Pe.isArray(t)?t.forEach(i):i(t),this}}AS.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),Pe.reduceDescriptors(AS.prototype,((e,t)=>{let{value:n}=e,r=t[0].toUpperCase()+t.slice(1);return{get:()=>n,set(i){this[r]=i}}})),Pe.freezeMethods(AS);var Ta=AS;function W0(e,t){const n=this||F0,r=t||n,i=Ta.from(r.headers);let s=r.data;return Pe.forEach(e,(function(o){s=o.call(n,s,i.normalize(),t?t.status:void 0)})),i.normalize(),s}function fx(e){return!(!e||!e.__CANCEL__)}function Pf(e,t,n){an.call(this,e??"canceled",an.ERR_CANCELED,t,n),this.name="CanceledError"}function mx(e,t,n){const r=n.config.validateStatus;n.status&&r&&!r(n.status)?t(new an("Request failed with status code "+n.status,[an.ERR_BAD_REQUEST,an.ERR_BAD_RESPONSE][Math.floor(n.status/100)-4],n.config,n.request,n)):e(n)}Pe.inherits(Pf,an,{__CANCEL__:!0});const NS=function(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,r=0;const i=(function(s,o){s=s||10;const c=new Array(s),d=new Array(s);let h,f=0,g=0;return o=o!==void 0?o:1e3,function(E){const S=Date.now(),O=d[g];h||(h=S),c[f]=E,d[f]=S;let A=g,N=0;for(;A!==f;)N+=c[A++],A%=s;if(f=(f+1)%s,f===g&&(g=(g+1)%s),S-h<o)return;const j=O&&S-O;return j?Math.round(1e3*N/j):void 0}})(50,250);return(function(s,o){let c,d,h=0,f=1e3/o;const g=function(E){h=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Date.now(),c=null,d&&(clearTimeout(d),d=null),s.apply(null,E)};return[function(){const E=Date.now(),S=E-h;for(var O=arguments.length,A=new Array(O),N=0;N<O;N++)A[N]=arguments[N];S>=f?g(A,E):(c=A,d||(d=setTimeout((()=>{d=null,g(c)}),f-S)))},()=>c&&g(c)]})((s=>{const o=s.loaded,c=s.lengthComputable?s.total:void 0,d=o-r,h=i(d);r=o,e({loaded:o,total:c,progress:c?o/c:void 0,bytes:d,rate:h||void 0,estimated:h&&c&&o<=c?(c-o)/h:void 0,event:s,lengthComputable:c!=null,[t?"download":"upload"]:!0})}),n)},_x=(e,t)=>{const n=e!=null;return[r=>t[0]({lengthComputable:n,total:e,loaded:r}),t[1]]},gx=e=>function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return Pe.asap((()=>e(...n)))};var RY=Zi.hasStandardBrowserEnv?((e,t)=>n=>(n=new rS(n,Zi.origin),e.protocol===n.protocol&&e.host===n.host&&(t||e.port===n.port)))(new rS(Zi.origin),Zi.navigator&&/(msie|trident)/i.test(Zi.navigator.userAgent)):()=>!0,wY=Zi.hasStandardBrowserEnv?{write(e,t,n,r,i,s){const o=[e+"="+encodeURIComponent(t)];Pe.isNumber(n)&&o.push("expires="+new Date(n).toGMTString()),Pe.isString(r)&&o.push("path="+r),Pe.isString(i)&&o.push("domain="+i),s===!0&&o.push("secure"),document.cookie=o.join("; ")},read(e){const t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove(e){this.write(e,"",Date.now()-864e5)}}:{write(){},read:()=>null,remove(){}};function Ex(e,t,n){let r=!(function(i){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(i)})(t);return e&&(r||n==0)?(function(i,s){return s?i.replace(/\/?\/$/,"")+"/"+s.replace(/^\/+/,""):i})(e,t):t}function vx(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable}))),n.push.apply(n,r)}return n}const yx=e=>e instanceof Ta?(function(t){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?vx(Object(r),!0).forEach((function(i){x(t,i,r[i])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):vx(Object(r)).forEach((function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(r,i))}))}return t})({},e):e;function yh(e,t){t=t||{};const n={};function r(h,f,g,E){return Pe.isPlainObject(h)&&Pe.isPlainObject(f)?Pe.merge.call({caseless:E},h,f):Pe.isPlainObject(f)?Pe.merge({},f):Pe.isArray(f)?f.slice():f}function i(h,f,g,E){return Pe.isUndefined(f)?Pe.isUndefined(h)?void 0:r(void 0,h,0,E):r(h,f,0,E)}function s(h,f){if(!Pe.isUndefined(f))return r(void 0,f)}function o(h,f){return Pe.isUndefined(f)?Pe.isUndefined(h)?void 0:r(void 0,h):r(void 0,f)}function c(h,f,g){return g in t?r(h,f):g in e?r(void 0,h):void 0}const d={url:s,method:s,data:s,baseURL:o,transformRequest:o,transformResponse:o,paramsSerializer:o,timeout:o,timeoutMessage:o,withCredentials:o,withXSRFToken:o,adapter:o,responseType:o,xsrfCookieName:o,xsrfHeaderName:o,onUploadProgress:o,onDownloadProgress:o,decompress:o,maxContentLength:o,maxBodyLength:o,beforeRedirect:o,transport:o,httpAgent:o,httpsAgent:o,cancelToken:o,socketPath:o,responseEncoding:o,validateStatus:c,headers:(h,f,g)=>i(yx(h),yx(f),0,!0)};return Pe.forEach(Object.keys(Object.assign({},e,t)),(function(h){const f=d[h]||i,g=f(e[h],t[h],h);Pe.isUndefined(g)&&f!==c||(n[h]=g)})),n}var Sx=e=>{const t=yh({},e);let n,{data:r,withXSRFToken:i,xsrfHeaderName:s,xsrfCookieName:o,headers:c,auth:d}=t;if(t.headers=c=Ta.from(c),t.url=UD(Ex(t.baseURL,t.url,t.allowAbsoluteUrls),e.params,e.paramsSerializer),d&&c.set("Authorization","Basic "+btoa((d.username||"")+":"+(d.password?unescape(encodeURIComponent(d.password)):""))),Pe.isFormData(r)){if(Zi.hasStandardBrowserEnv||Zi.hasStandardBrowserWebWorkerEnv)c.setContentType(void 0);else if((n=c.getContentType())!==!1){const[h,...f]=n?n.split(";").map((g=>fi(g).call(g))).filter(Boolean):[];c.setContentType([h||"multipart/form-data",...f].join("; "))}}if(Zi.hasStandardBrowserEnv&&(i&&Pe.isFunction(i)&&(i=i(t)),i||i!==!1&&RY(t.url))){const h=s&&o&&wY.read(o);h&&c.set(s,h)}return t},CY=typeof XMLHttpRequest<"u"&&function(e){return new ke((function(t,n){const r=Sx(e);let i=r.data;const s=Ta.from(r.headers).normalize();let o,c,d,h,f,{responseType:g,onUploadProgress:E,onDownloadProgress:S}=r;function O(){h&&h(),f&&f(),r.cancelToken&&r.cancelToken.unsubscribe(o),r.signal&&r.signal.removeEventListener("abort",o)}let A=new XMLHttpRequest;function N(){if(!A)return;const U=Ta.from("getAllResponseHeaders"in A&&A.getAllResponseHeaders());mx((function(W){t(W),O()}),(function(W){n(W),O()}),{data:g&&g!=="text"&&g!=="json"?A.response:A.responseText,status:A.status,statusText:A.statusText,headers:U,config:e,request:A}),A=null}A.open(r.method.toUpperCase(),r.url,!0),A.timeout=r.timeout,"onloadend"in A?A.onloadend=N:A.onreadystatechange=function(){A&&A.readyState===4&&(A.status!==0||A.responseURL&&A.responseURL.indexOf("file:")===0)&&setTimeout(N)},A.onabort=function(){A&&(n(new an("Request aborted",an.ECONNABORTED,e,A)),A=null)},A.onerror=function(){n(new an("Network Error",an.ERR_NETWORK,e,A)),A=null},A.ontimeout=function(){let U=r.timeout?"timeout of "+r.timeout+"ms exceeded":"timeout exceeded";const W=r.transitional||VD;r.timeoutErrorMessage&&(U=r.timeoutErrorMessage),n(new an(U,W.clarifyTimeoutError?an.ETIMEDOUT:an.ECONNABORTED,e,A)),A=null},i===void 0&&s.setContentType(null),"setRequestHeader"in A&&Pe.forEach(s.toJSON(),(function(U,W){A.setRequestHeader(W,U)})),Pe.isUndefined(r.withCredentials)||(A.withCredentials=!!r.withCredentials),g&&g!=="json"&&(A.responseType=r.responseType),S&&([d,f]=NS(S,!0),A.addEventListener("progress",d)),E&&A.upload&&([c,h]=NS(E),A.upload.addEventListener("progress",c),A.upload.addEventListener("loadend",h)),(r.cancelToken||r.signal)&&(o=U=>{A&&(n(!U||U.type?new Pf(null,e,A):U),A.abort(),A=null)},r.cancelToken&&r.cancelToken.subscribe(o),r.signal&&(r.signal.aborted?o():r.signal.addEventListener("abort",o)));const j=(function(U){const W=/^([-+\w]{1,25})(:?\/\/|:)/.exec(U);return W&&W[1]||""})(r.url);j&&Zi.protocols.indexOf(j)===-1?n(new an("Unsupported protocol "+j+":",an.ERR_BAD_REQUEST,e)):A.send(i||null)}))},bY=(e,t)=>{const{length:n}=e=e?e.filter(Boolean):[];if(t||n){let r,i=new AbortController;const s=function(h){if(!r){r=!0,c();const f=h instanceof Error?h:this.reason;i.abort(f instanceof an?f:new Pf(f instanceof Error?f.message:f))}};let o=t&&setTimeout((()=>{o=null,s(new an("timeout ".concat(t," of ms exceeded"),an.ETIMEDOUT))}),t);const c=()=>{e&&(o&&clearTimeout(o),o=null,e.forEach((h=>{h.unsubscribe?h.unsubscribe(s):h.removeEventListener("abort",s)})),e=null)};e.forEach((h=>h.addEventListener("abort",s)));const{signal:d}=i;return d.unsubscribe=()=>Pe.asap(c),d}},G0=R(cO),Tx=bf.f("asyncIterator"),IY=R(Tx);function H0(e,t){this.v=e,this.k=t}function no(e){return function(){return new Hg(e.apply(this,arguments))}}function Hg(e){var t,n;function r(s,o){try{var c=e[s](o),d=c.value,h=d instanceof H0;G0.resolve(h?d.v:d).then((function(f){if(h){var g=s==="return"?"return":"next";if(!d.k||f.done)return r(g,f);f=e[g](f).value}i(c.done?"return":"normal",f)}),(function(f){r("throw",f)}))}catch(f){i("throw",f)}}function i(s,o){switch(s){case"return":t.resolve({value:o,done:!0});break;case"throw":t.reject(o);break;default:t.resolve({value:o,done:!1})}(t=t.next)?r(t.key,t.arg):n=null}this._invoke=function(s,o){return new G0((function(c,d){var h={key:s,arg:o,resolve:c,reject:d,next:null};n?n=n.next=h:(t=n=h,r(s,o))}))},typeof e.return!="function"&&(this.return=void 0)}function Ft(e){return new H0(e,0)}function OS(e){var t={},n=!1;function r(i,s){return n=!0,s=new G0((function(o){o(e[i](s))})),{done:!1,value:new H0(s,1)}}return t[Of!==void 0&&Jk||"@@iterator"]=function(){return this},t.next=function(i){return n?(n=!1,i):r("next",i)},typeof e.throw=="function"&&(t.throw=function(i){if(n)throw n=!1,i;return r("throw",i)}),typeof e.return=="function"&&(t.return=function(i){return n?(n=!1,i):r("return",i)}),t}Hg.prototype[typeof Of=="function"&&IY||"@@asyncIterator"]=function(){return this},Hg.prototype.next=function(e){return this._invoke("next",e)},Hg.prototype.throw=function(e){return this._invoke("throw",e)},Hg.prototype.return=function(e){return this._invoke("return",e)};var K0=R(Tx);function z0(e){var t,n,r,i=2;for(typeof Symbol<"u"&&(n=K0,r=Symbol.iterator);i--;){if(n&&(t=e[n])!=null)return t.call(e);if(r&&(t=e[r])!=null)return new PS(t.call(e));n="@@asyncIterator",r="@@iterator"}throw new TypeError("Object is not async iterable")}function PS(e){function t(n){if(Object(n)!==n)return ke.reject(new TypeError(n+" is not an object."));var r=n.done;return ke.resolve(n.value).then((function(i){return{value:i,done:r}}))}return PS=function(n){this.s=n,this.n=n.next},PS.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(n){var r=this.s.return;return r===void 0?ke.resolve({value:n,done:!0}):t(r.apply(this.s,arguments))},throw:function(n){var r=this.s.return;return r===void 0?ke.reject(n):t(r.apply(this.s,arguments))}},new PS(e)}const AY=function*(e,t){let n=e.byteLength;if(!t||n<t)return void(yield e);let r,i=0;for(;i<n;)r=i+t,yield e.slice(i,r),i=r},NY=(function(){var e=no((function*(t,n){var r,i=!1,s=!1;try{for(var o,c=z0(OY(t));i=!(o=yield Ft(c.next())).done;i=!1){const d=o.value;yield*OS(z0(AY(d,n)))}}catch(d){s=!0,r=d}finally{try{i&&c.return!=null&&(yield Ft(c.return()))}finally{if(s)throw r}}}));return function(t,n){return e.apply(this,arguments)}})(),OY=(function(){var e=no((function*(t){if(t[K0])return void(yield*OS(z0(t)));const n=t.getReader();try{for(;;){const{done:r,value:i}=yield Ft(n.read());if(r)break;yield i}}finally{yield Ft(n.cancel())}}));return function(t){return e.apply(this,arguments)}})(),Rx=(e,t,n,r)=>{const i=NY(e,t);let s,o=0,c=d=>{s||(s=!0,r&&r(d))};return new ReadableStream({async pull(d){try{const{done:h,value:f}=await i.next();if(h)return c(),void d.close();let g=f.byteLength;if(n){let E=o+=g;n(E)}d.enqueue(new Uint8Array(f))}catch(h){throw c(h),h}},cancel:d=>(c(d),i.return())},{highWaterMark:2})};function wx(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable}))),n.push.apply(n,r)}return n}function Cx(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?wx(Object(n),!0).forEach((function(r){x(e,r,n[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):wx(Object(n)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))}))}return e}const DS=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",bx=DS&&typeof ReadableStream=="function",PY=DS&&(typeof TextEncoder=="function"?(Ix=new TextEncoder,e=>Ix.encode(e)):async e=>new Uint8Array(await new Response(e).arrayBuffer()));var Ix;const Ax=function(e){try{for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return!!e(...n)}catch{return!1}},DY=bx&&Ax((()=>{let e=!1;const t=new Request(Zi.origin,{body:new ReadableStream,method:"POST",get duplex(){return e=!0,"half"}}).headers.has("Content-Type");return e&&!t})),Y0=bx&&Ax((()=>Pe.isReadableStream(new Response("").body))),kS={stream:Y0&&(e=>e.body)};var Nx;DS&&(Nx=new Response,["text","arrayBuffer","blob","formData","stream"].forEach((e=>{!kS[e]&&(kS[e]=Pe.isFunction(Nx[e])?t=>t[e]():(t,n)=>{throw new an("Response type '".concat(e,"' is not supported"),an.ERR_NOT_SUPPORT,n)})})));const kY=async(e,t)=>{const n=Pe.toFiniteNumber(e.getContentLength());return n??(async r=>r==null?0:Pe.isBlob(r)?r.size:Pe.isSpecCompliantForm(r)?(await new Request(Zi.origin,{method:"POST",body:r}).arrayBuffer()).byteLength:Pe.isArrayBufferView(r)||Pe.isArrayBuffer(r)?r.byteLength:(Pe.isURLSearchParams(r)&&(r+=""),Pe.isString(r)?(await PY(r)).byteLength:void 0))(t)};var xY=DS&&(async e=>{let{url:t,method:n,data:r,signal:i,cancelToken:s,timeout:o,onDownloadProgress:c,onUploadProgress:d,responseType:h,headers:f,withCredentials:g="same-origin",fetchOptions:E}=Sx(e);h=h?(h+"").toLowerCase():"text";let S,O=bY([i,s&&s.toAbortSignal()],o);const A=O&&O.unsubscribe&&(()=>{O.unsubscribe()});let N;try{if(d&&DY&&n!=="get"&&n!=="head"&&(N=await kY(f,r))!==0){let Z,Y=new Request(t,{method:"POST",body:r,duplex:"half"});if(Pe.isFormData(r)&&(Z=Y.headers.get("content-type"))&&f.setContentType(Z),Y.body){const[ie,ue]=_x(N,NS(gx(d)));r=Rx(Y.body,65536,ie,ue)}}Pe.isString(g)||(g=g?"include":"omit");const j="credentials"in Request.prototype;S=new Request(t,Cx(Cx({},E),{},{signal:O,method:n.toUpperCase(),headers:f.normalize().toJSON(),body:r,duplex:"half",credentials:j?g:void 0}));let U=await fetch(S);const W=Y0&&(h==="stream"||h==="response");if(Y0&&(c||W&&A)){const Z={};["status","statusText","headers"].forEach((ge=>{Z[ge]=U[ge]}));const Y=Pe.toFiniteNumber(U.headers.get("content-length")),[ie,ue]=c&&_x(Y,NS(gx(c),!0))||[];U=new Response(Rx(U.body,65536,ie,(()=>{ue&&ue(),A&&A()})),Z)}h=h||"text";let $=await kS[Pe.findKey(kS,h)||"text"](U,e);return!W&&A&&A(),await new ke(((Z,Y)=>{mx(Z,Y,{data:$,headers:Ta.from(U.headers),status:U.status,statusText:U.statusText,config:e,request:S})}))}catch(j){throw A&&A(),j&&j.name==="TypeError"&&/Load failed|fetch/i.test(j.message)?Object.assign(new an("Network Error",an.ERR_NETWORK,e,S),{cause:j.cause||j}):an.from(j,j&&j.code,e,S)}});const q0={http:null,xhr:CY,fetch:xY};Pe.forEach(q0,((e,t)=>{if(e){try{Object.defineProperty(e,"name",{value:t})}catch{}Object.defineProperty(e,"adapterName",{value:t})}}));const Ox=e=>"- ".concat(e),LY=e=>Pe.isFunction(e)||e===null||e===!1;var Px={getAdapter:e=>{e=Pe.isArray(e)?e:[e];const{length:t}=e;let n,r;const i={};for(let s=0;s<t;s++){let o;if(n=e[s],r=n,!LY(n)&&(r=q0[(o=String(n)).toLowerCase()],r===void 0))throw new an("Unknown adapter '".concat(o,"'"));if(r)break;i[o||"#"+s]=r}if(!r){const s=Object.entries(i).map((o=>{let[c,d]=o;return"adapter ".concat(c," ")+(d===!1?"is not supported by the environment":"is not available in the build")}));throw new an("There is no suitable adapter to dispatch the request "+(t?s.length>1?`since :
`+s.map(Ox).join(`
`):" "+Ox(s[0]):"as no adapter specified"),"ERR_NOT_SUPPORT")}return r},adapters:q0};function X0(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new Pf(null,e)}function Dx(e){return X0(e),e.headers=Ta.from(e.headers),e.data=W0.call(e,e.transformRequest),["post","put","patch"].indexOf(e.method)!==-1&&e.headers.setContentType("application/x-www-form-urlencoded",!1),Px.getAdapter(e.adapter||F0.adapter)(e).then((function(t){return X0(e),t.data=W0.call(e,e.transformResponse,t),t.headers=Ta.from(t.headers),t}),(function(t){return fx(t)||(X0(e),t&&t.response&&(t.response.data=W0.call(e,e.transformResponse,t.response),t.response.headers=Ta.from(t.response.headers))),ke.reject(t)}))}const kx="1.9.0",xS={};["object","boolean","number","function","string","symbol"].forEach(((e,t)=>{xS[e]=function(n){return typeof n===e||"a"+(t<1?"n ":" ")+e}}));const xx={};xS.transitional=function(e,t,n){function r(i,s){return"[Axios v"+kx+"] Transitional option '"+i+"'"+s+(n?". "+n:"")}return(i,s,o)=>{if(e===!1)throw new an(r(s," has been removed"+(t?" in "+t:"")),an.ERR_DEPRECATED);return t&&!xx[s]&&(xx[s]=!0,console.warn(r(s," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(i,s,o)}},xS.spelling=function(e){return(t,n)=>(console.warn("".concat(n," is likely a misspelling of ").concat(e)),!0)};var LS={assertOptions:function(e,t,n){if(typeof e!="object")throw new an("options must be an object",an.ERR_BAD_OPTION_VALUE);const r=Object.keys(e);let i=r.length;for(;i-- >0;){const s=r[i],o=t[s];if(o){const c=e[s],d=c===void 0||o(c,s,e);if(d!==!0)throw new an("option "+s+" must be "+d,an.ERR_BAD_OPTION_VALUE)}else if(n!==!0)throw new an("Unknown option "+s,an.ERR_BAD_OPTION)}},validators:xS};const Tc=LS.validators;let MS=class{constructor(e){this.defaults=e||{},this.interceptors={request:new jD,response:new jD}}async request(e,t){try{return await this._request(e,t)}catch(n){if(n instanceof Error){let r={};Error.captureStackTrace?Error.captureStackTrace(r):r=new Error;const i=r.stack?r.stack.replace(/^.+\n/,""):"";try{n.stack?i&&!String(n.stack).endsWith(i.replace(/^.+\n.+\n/,""))&&(n.stack+=`
`+i):n.stack=i}catch{}}throw n}}_request(e,t){typeof e=="string"?(t=t||{}).url=e:t=e||{},t=yh(this.defaults,t);const{transitional:n,paramsSerializer:r,headers:i}=t;n!==void 0&&LS.assertOptions(n,{silentJSONParsing:Tc.transitional(Tc.boolean),forcedJSONParsing:Tc.transitional(Tc.boolean),clarifyTimeoutError:Tc.transitional(Tc.boolean)},!1),r!=null&&(Pe.isFunction(r)?t.paramsSerializer={serialize:r}:LS.assertOptions(r,{encode:Tc.function,serialize:Tc.function},!0)),t.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?t.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:t.allowAbsoluteUrls=!0),LS.assertOptions(t,{baseUrl:Tc.spelling("baseURL"),withXsrfToken:Tc.spelling("withXSRFToken")},!0),t.method=(t.method||this.defaults.method||"get").toLowerCase();let s=i&&Pe.merge(i.common,i[t.method]);i&&Pe.forEach(["delete","get","head","post","put","patch","common"],(S=>{delete i[S]})),t.headers=Ta.concat(s,i);const o=[];let c=!0;this.interceptors.request.forEach((function(S){typeof S.runWhen=="function"&&S.runWhen(t)===!1||(c=c&&S.synchronous,o.unshift(S.fulfilled,S.rejected))}));const d=[];let h;this.interceptors.response.forEach((function(S){d.push(S.fulfilled,S.rejected)}));let f,g=0;if(!c){const S=[Dx.bind(this),void 0];for(S.unshift.apply(S,o),S.push.apply(S,d),f=S.length,h=ke.resolve(t);g<f;)h=h.then(S[g++],S[g++]);return h}f=o.length;let E=t;for(g=0;g<f;){const S=o[g++],O=o[g++];try{E=S(E)}catch(A){O.call(this,A);break}}try{h=Dx.call(this,E)}catch(S){return ke.reject(S)}for(g=0,f=d.length;g<f;)h=h.then(d[g++],d[g++]);return h}getUri(e){return UD(Ex((e=yh(this.defaults,e)).baseURL,e.url,e.allowAbsoluteUrls),e.params,e.paramsSerializer)}};Pe.forEach(["delete","get","head","options"],(function(e){MS.prototype[e]=function(t,n){return this.request(yh(n||{},{method:e,url:t,data:(n||{}).data}))}})),Pe.forEach(["post","put","patch"],(function(e){function t(n){return function(r,i,s){return this.request(yh(s||{},{method:e,headers:n?{"Content-Type":"multipart/form-data"}:{},url:r,data:i}))}}MS.prototype[e]=t(),MS.prototype[e+"Form"]=t(!0)}));var US=MS;class J0{constructor(t){if(typeof t!="function")throw new TypeError("executor must be a function.");let n;this.promise=new ke((function(i){n=i}));const r=this;this.promise.then((i=>{if(!r._listeners)return;let s=r._listeners.length;for(;s-- >0;)r._listeners[s](i);r._listeners=null})),this.promise.then=i=>{let s;const o=new ke((c=>{r.subscribe(c),s=c})).then(i);return o.cancel=function(){r.unsubscribe(s)},o},t((function(i,s,o){r.reason||(r.reason=new Pf(i,s,o),n(r.reason))}))}throwIfRequested(){if(this.reason)throw this.reason}subscribe(t){this.reason?t(this.reason):this._listeners?this._listeners.push(t):this._listeners=[t]}unsubscribe(t){if(!this._listeners)return;const n=this._listeners.indexOf(t);n!==-1&&this._listeners.splice(n,1)}toAbortSignal(){const t=new AbortController,n=r=>{t.abort(r)};return this.subscribe(n),t.signal.unsubscribe=()=>this.unsubscribe(n),t.signal}static source(){let t;return{token:new J0((function(r){t=r})),cancel:t}}}var MY=J0;const Q0={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(Q0).forEach((e=>{let[t,n]=e;Q0[n]=t}));var UY=Q0;const ri=(function e(t){const n=new US(t),r=yD(US.prototype.request,n);return Pe.extend(r,US.prototype,n,{allOwnKeys:!0}),Pe.extend(r,n,null,{allOwnKeys:!0}),r.create=function(i){return e(yh(t,i))},r})(F0);ri.Axios=US,ri.CanceledError=Pf,ri.CancelToken=MY,ri.isCancel=fx,ri.VERSION=kx,ri.toFormData=_S,ri.AxiosError=an,ri.Cancel=ri.CanceledError,ri.all=function(e){return ke.all(e)},ri.spread=function(e){return function(t){return e.apply(null,t)}},ri.isAxiosError=function(e){return Pe.isObject(e)&&e.isAxiosError===!0},ri.mergeConfig=yh,ri.AxiosHeaders=Ta,ri.formToJSON=e=>hx(Pe.isHTMLForm(e)?new FormData(e):e),ri.getAdapter=Px.getAdapter,ri.HttpStatusCode=UY,ri.default=ri;var ji=ri;const jY=()=>{};function Kg(){const e={promise:void 0,isResolved:!1,isRejected:!1,isFinished:!1,resolve:void 0,reject:void 0,cancel:jY};return e.promise=new ke(((t,n)=>{e.resolve=r=>{e.isFinished||(e.isResolved=!0,e.isFinished=!0,t(r),e.value=r)},e.reject=r=>{e.isFinished||(e.isRejected=!0,e.isFinished=!0,n(r))}})),e}const jS=new Map,VS=new Map,Rc=new Map;let Er=(function(e){return e.WIN_10="Windows 10",e.WIN_81="Windows 8.1",e.WIN_8="Windows 8",e.WIN_7="Windows 7",e.WIN_VISTA="Windows Vista",e.WIN_SERVER_2003="Windows Server 2003",e.WIN_XP="Windows XP",e.WIN_2000="Windows 2000",e.ANDROID="Android",e.HARMONY_OS="HarmonyOS",e.OPEN_BSD="Open BSD",e.SUN_OS="Sun OS",e.LINUX="Linux",e.IOS="iOS",e.MAC_OS="Mac OS",e.CHROMIUM_OS="Chromium OS",e.QNX="QNX",e.UNIX="UNIX",e.BEOS="BeOS",e.OS_2="OS/2",e.SEARCH_BOT="Search Bot",e})({}),Kt=(function(e){return e.CHROME="Chrome",e.SAFARI="Safari",e.EDGE="Edge",e.FIREFOX="Firefox",e.OPERA="OPR",e.QQ="QQBrowser",e.WECHAT="MicroMessenger",e})({});const Lx=new fH;let Ra=Lx.getResult(),Z0=null;function Mt(e){if(!Z0){Ra=Lx.getResult();const t=(function(c){if(c.engine.name==="Blink"&&c.browser.name!=="WeChat")return Kt.CHROME;switch(c.browser.name){case"Chrome Headless":case"Chrome":case"Chromium":return Kt.CHROME;case"Safari":case"Mobile Safari":return Kt.SAFARI;case"Edge":return Kt.EDGE;case"Firefox":return Kt.FIREFOX;case"QQ":case"QQBrowser":return Kt.QQ;case"Opera":return Kt.OPERA;case"WeChat":return Kt.WECHAT;default:return c.browser.name||""}})(Ra),n=Mx(Ra),r=(function(c){return c.os.name==="Windows"?c.os.version?c.os.name+" "+c.os.version:c.os.name:c.os.name||""})(Ra),i=Ra.os.version,s=Mx(Ra,!1),o=Ra.device.type;if(!(t&&n&&r&&i))return{name:t,version:n,os:r,osVersion:i,browserVersion:s,deviceType:o};Z0={name:t,version:n,os:r,osVersion:i,browserVersion:s,deviceType:o}}return Z0}function Mx(e){let t,n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];return t=e.engine.name==="Blink"?e.engine.version||"":e.browser.version||"",n?t.split(".")[0]:t}function FS(){return Mt().os}function Ux(){const e=Mt();return"".concat(e.os," ").concat(e.osVersion)}function BS(){const e=Mt();return!!(Ra.engine.name==="WebKit"&&e.os===Er.MAC_OS&&navigator.maxTouchPoints&&navigator.maxTouchPoints>0&&e.name!==Kt.SAFARI||ii()&&e.name!==Kt.SAFARI)}function El(){return Mt().name===Kt.CHROME}function Br(){return Mt().name===Kt.SAFARI}function jx(){const e=Mt();if(e.name!==Kt.SAFARI||!e.browserVersion)return!1;const t=e.browserVersion.split(".");return Number(t[0])>15||Number(t[0])===15&&Number(t[1])>=4}function Vx(){return Mt().name===Kt.EDGE}function jn(){return Mt().name===Kt.FIREFOX}function ii(){return Mt().os===Er.IOS}function Df(e){const t=Mt();return!(t.name!==Kt.CHROME||!t.osVersion)&&Number(t.version)>=e}function Fx(e){const t=Mt();return!(t.name!==Kt.CHROME||!t.osVersion)&&Number(t.version)<e}function $0(e,t,n){const r=Mt();return!(r.name!==e||!r.osVersion)&&(n?Number(r.version)>=t&&Number(r.version)<=n:Number(r.version)===t)}function eb(e){const t=Mt();return!(t.name!==Kt.EDGE||!t.osVersion)&&Number(t.version)>=e}function tb(e){const t=Mt();return!(t.name!==Kt.FIREFOX||!t.osVersion)&&Number(t.version)>=e}function Bx(e){const t=Mt();return!(t.name!==Kt.SAFARI||!t.osVersion)&&Number(t.version)>=e}function Wx(e,t,n){const r=Mt();if(r.os!==Er.IOS||!r.osVersion)return!1;const i=r.osVersion.split(".");return n?t&&Number(i[0])===e&&Number(i[1])>t||Number(i[0])>e:t?Number(i[0])===e&&Number(i[1])>=t||Number(i[0])>e:Number(i[0])>=e}function Gx(e,t,n){const r=Mt();if(r.os!==Er.IOS||!r.osVersion)return!1;const i=r.osVersion.split(".");return t&&Number(i[0])===e&&Number(i[1])<t||Number(i[0])<e}function nb(e,t,n){const r=Mt();if(r.name!==Kt.SAFARI||!r.osVersion||!r.browserVersion)return!1;const i=r.browserVersion.split(".");return n?t&&Number(i[0])===e&&Number(i[1])<t||Number(i[0])<e:t?Number(i[0])===e&&Number(i[1])<=t||Number(i[0])<e:Number(i[0])<=e}function rb(e){const t=Mt();return!(t.name!==Kt.OPERA||!t.osVersion)&&Number(t.version)>=e}function Hx(){const e=Mt();if(e.os!==Er.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return Number(t[0])<14||Number(t[0])===14&&Number(t[1])<=6}function kf(){const e=Mt();if(e.os!==Er.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return Number(t[0])===15}function ib(){const e=Mt();if(e.os!==Er.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return Number(t[0])===16}function Kx(){const e=Mt();if(e.os!==Er.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return Number(t[0])===15&&Number(t[1])>=1}function Vo(){return Br()&&navigator.maxTouchPoints>0}function zx(){return Mt().name===Kt.WECHAT}function Yx(){return window.navigator.appVersion&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)!==null&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<=35}function sb(){const e=FS();return(function(){const{deviceType:t}=Mt();return t==="mobile"||t==="tablet"})()||e===Er.ANDROID||e===Er.IOS||e===Er.HARMONY_OS}function vl(){const e=Mt();return e.name!==Kt.EDGE&&e.name!==Kt.SAFARI&&!!navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i)}function WS(){return FS()===Er.ANDROID}function zg(){const e=Mt();return WS()&&(e.name===Kt.CHROME||e.name===Kt.WECHAT||/chrome|chromium/i.test(navigator.userAgent))}function lt(e,t,n){return(t=(function(r){var i=(function(s,o){if(typeof s!="object"||!s)return s;var c=s[Symbol.toPrimitive];if(c!==void 0){var d=c.call(s,"string");if(typeof d!="object")return d;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(s)})(r);return typeof i=="symbol"?i:i+""})(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function qx(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable}))),n.push.apply(n,r)}return n}function we(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?qx(Object(n),!0).forEach((function(r){lt(e,r,n[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):qx(Object(n)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))}))}return e}let V=(function(e){return e.UNEXPECTED_ERROR="UNEXPECTED_ERROR",e.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",e.TIMEOUT="TIMEOUT",e.INVALID_PARAMS="INVALID_PARAMS",e.NOT_READABLE="NOT_READABLE",e.NOT_SUPPORTED="NOT_SUPPORTED",e.INVALID_OPERATION="INVALID_OPERATION",e.OPERATION_ABORTED="OPERATION_ABORTED",e.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",e.EXCHANGE_SDP_FAILED="EXCHANGE_SDP_FAILED",e.ADD_CANDIDATE_FAILED="ADD_CANDIDATE_FAILED",e.DATACHANNEL_FAILED="DATACHANNEL_FAILED",e.NETWORK_ERROR="NETWORK_ERROR",e.NETWORK_TIMEOUT="NETWORK_TIMEOUT",e.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",e.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",e.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",e.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",e.ELECTRON_IS_NULL="ELECTRON_IS_NULL",e.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",e.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",e.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",e.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",e.PERMISSION_DENIED="PERMISSION_DENIED",e.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",e.TRACK_IS_DISABLED="TRACK_IS_DISABLED",e.GET_VIDEO_ELEMENT_VISIBLE_ERROR="GET_VIDEO_ELEMENT_VISIBLE_ERROR",e.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",e.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",e.SET_ENCODING_PARAMETER_ERROR="SET_ENCODING_PARAMETER_ERROR",e.TRACK_STATE_UNREACHABLE="TRACK_STATE_UNREACHABLE",e.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",e.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",e.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",e.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",e.UID_CONFLICT="UID_CONFLICT",e.MULTI_UNILBS_RESPONSE_ERROR="MULTI_UNILBS_RESPONSE_ERROR",e.UPDATE_TICKET_FAILED="UPDATE_TICKET_FAILED",e.TOKEN_EXPIRE="TOKEN_EXPIRE",e.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",e.INVALID_TRACK="INVALID_TRACK",e.SENDER_NOT_FOUND="SENDER_NOT_FOUND",e.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",e.SET_ANSWER_FAILED="SET_ANSWER_FAILED",e.ICE_FAILED="ICE_FAILED",e.PC_CLOSED="PC_CLOSED",e.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",e.GET_LOCAL_CAPABILITIES_FAILED="GET_LOCAL_CAPABILITIES_FAILED",e.GET_LOCAL_CONNECTION_PARAMS_FAILED="GET_LOCAL_CONNECTION_PARAMS_FAILED",e.SUBSCRIBE_FAILED="SUBSCRIBE_FAILED",e.UNSUBSCRIBE_FAILED="UNSUBSCRIBE_FAILED",e.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",e.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",e.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",e.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",e.INVALID_REMOTE_USER="INVALID_REMOTE_USER",e.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",e.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",e.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",e.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",e.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",e.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",e.WS_ABORT="WS_ABORT",e.WS_DISCONNECT="WS_DISCONNECT",e.WS_ERR="WS_ERR",e.EXTERNAL_SIGNAL_ABORT="EXTERNAL_SIGNAL_ABORT",e.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",e.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",e.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",e.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",e.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",e.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",e.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",e.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",e.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",e.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",e.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",e.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",e.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",e.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",e.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",e.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",e.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",e.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE",e.LOCAL_AEC_ERROR="LOCAL_AEC_ERROR",e.INVALID_PLUGIN="INVALID_PLUGIN",e.DISCONNECT_P2P="DISCONNECT_P2P",e.CONVERTING_IMAGEDATA_TO_BLOB_FAILED="CONVERTING_IMAGEDATA_TO_BLOB_FAILED",e.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED="CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED",e.INIT_DATACHANNEL_TIMEOUT="INIT_DATACHANNEL_TIMEOUT",e.CREATE_DATACHANNEL_ERROR="CREATE_DATACHANNEL_ERROR",e.DATACHANNEL_CONNECTION_TIMEOUT="DATACHANNEL_CONNECTION_TIMEOUT",e.PROHIBITED_OPERATION="PROHIBITED_OPERATION",e.IMAGE_MODERATION_UPLOAD_FAILED="IMAGE_MODERATION_UPLOAD_FAILED",e.P2P_MESSAGE_FAILED="P2P_MESSAGE_FAILED",e})({}),de=class extends Error{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",n=arguments.length>2?arguments[2]:void 0;super(t),lt(this,"code",void 0),lt(this,"message",void 0),lt(this,"data",void 0),lt(this,"name","AgoraRTCException"),this.code=e,this.message="AgoraRTCError ".concat(this.code,": ").concat(t),this.data=n}toString(){return this.data?"".concat(this.message,`
data: `).concat(JSON.stringify(this.data)):this.message}print(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error",t=arguments.length>1?arguments[1]:void 0;return e==="error"&&(t||console).error(this.toString()),e==="warning"&&(t||console).warn(this.toString()),this}throw(e){throw this.print("error",e),this}};function wa(e,t){if(typeof e!="boolean")throw new de(V.INVALID_PARAMS,"Invalid ".concat(t,": The value is of the boolean type."))}function pr(e,t,n){if(!be(n).call(n,e))throw new de(V.INVALID_PARAMS,"".concat(t," can only be set as ").concat(JSON.stringify(n)))}function cn(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1e4;if(e<n||e>r||(!(arguments.length>4&&arguments[4]!==void 0)||arguments[4])&&!(function(i){return typeof i=="number"&&i%1==0})(e))throw new de(V.INVALID_PARAMS,"invalid ".concat(t,": the value range is [").concat(n,", ").concat(r,"]. integer only"))}function ob(e,t){if(typeof e!="number"){if(!(e.min||e.max||e.ideal||e.exact))throw new de(V.INVALID_PARAMS,"".concat(t," is not a valid ConstrainLong"));e.min!==void 0&&cn(e.min,"".concat(t,".min"),0,1/0),e.max!==void 0&&cn(e.max,"".concat(t,".max"),1,1/0),e.exact!==void 0&&cn(e.exact,"".concat(t,".exact"),1,1/0),e.ideal!==void 0&&cn(e.ideal,"".concat(t,".ideal"),1,1/0)}else cn(e,t,1,1/0)}function kr(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:255,i=!(arguments.length>4&&arguments[4]!==void 0)||arguments[4];if(e==null)throw new de(V.INVALID_PARAMS,"".concat(t||"param"," cannot be empty"));if(!Xx(e,n,r,i))throw new de(V.INVALID_PARAMS,"Invalid ".concat(t||"string param",": Length of the string: [").concat(n,",").concat(r,"].").concat(i?" ASCII characters only.":""))}function yl(e,t){if(!Array.isArray(e))throw new de(V.INVALID_PARAMS,"".concat(t," should be an array"))}function Vn(e){return e==null}function Xx(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:255,r=!(arguments.length>3&&arguments[3]!==void 0)||arguments[3];return typeof e=="string"&&e.length<=n&&e.length>=t&&(!r||(function(i){if(typeof i!="string")return!1;for(let s=0;s<i.length;s+=1){const o=i.charCodeAt(s);if(o<0||o>255)return!1}return!0})(e))}var Yg=(function(e){return e.COVERED="COVERED",e.POSITION="POSITION",e.SIZE="SIZE",e.STYLE="STYLE",e})(Yg||{}),ab=(function(e){return e.UNMOUNTED="UNMOUNTED",e.INVALID_HTML_ELEMENT="INVALID_HTML_ELEMENT",e})(ab||{});const Jx=new class{constructor(){lt(this,"_clientSize",null),lt(this,"getClientWidth",(()=>document.documentElement?document.documentElement.clientWidth:document.body.clientWidth)),lt(this,"getClientHeight",(()=>document.documentElement?document.documentElement.clientHeight:document.body.clientHeight)),lt(this,"getStyle",(e=>window.getComputedStyle(e,null))),lt(this,"checkCssVisibleProperty",(e=>{var t;let n=!0;const r=this.getStyle(e),{display:i,visibility:s,opacity:o,filter:c}=r;return(i==="none"||be(t=["hidden","collapse"]).call(t,s)||Number(o)<.1)&&(n=!1),!!n&&(c&&c.split(" ").filter((d=>{var h;const f=d.split("(")[0];return be(h=["brightness","blur","opacity"]).call(h,f)})).map((d=>{const[h,f]=d.split(/\(|\)/);return[h,Number(f.match(/^[0-9\.]+/))]})).forEach((d=>{const[h,f]=d;switch(h){case"brightness":(f<.1||f>3)&&(n=!1);break;case"blur":f>3&&(n=!1);break;case"opacity":f<.1&&(n=!1)}})),n)})),lt(this,"checkPropertyUpToAllParentNodes",((e,t)=>{let n=!0,r=!0;const i=o=>t(o);let s=e;for(;s&&r;)i(s)||(n=!1,r=!1),s=s.parentElement,s||(r=!1);return n})),lt(this,"checkActualCssVisibleIncludeInherit",(e=>this.checkPropertyUpToAllParentNodes(e,this.checkCssVisibleProperty))),lt(this,"getSizeAboutClient",(e=>{const{width:t,height:n,left:r,right:i,top:s,bottom:o}=e.getBoundingClientRect(),c=this.getClientWidth(),d=this.getClientHeight();return{width:t,height:n,left:r,right:i,top:s,bottom:o,clientWidth:c,clientHeight:d,clientMin:Math.min(c,d)}})),lt(this,"checkActualSize",(()=>{const{width:e,height:t,clientMin:n}=this._clientSize;return this.checkSizeIsVisible(e,t,n)})),lt(this,"elementFromPoint",((e,t)=>document.elementFromPoint?document.elementFromPoint(e,t):null)),lt(this,"checkCoverForAPoint",((e,t,n)=>{const r=this.elementFromPoint(e,t);return r!==null&&r!==n})),lt(this,"getPointPositionList",(()=>{const{width:e,height:t,left:n,top:r}=this._clientSize,i=e/6,s=t/6,o=[],c=10**6;for(let d=0;d<5;d++)for(let h=0;h<5;h++){const f=(n*c+(d===0?.1:d===4?(i*d*c-1e5)/c:i*d)*c)/c,g=(r*c+(h===0?.1:h===4?(s*h*c-1e5)/c:s*h)*c)/c;o.push({x:f,y:g})}return[...o]})),lt(this,"checkElementCover",(e=>this.getPointPositionList().map((t=>this.checkCoverForAPoint(t.x,t.y,e))).filter((t=>!!t)).length>6)),lt(this,"checkSizeIsVisible",((e,t,n)=>(e>50||n/e<=10)&&(t>50||n/t<=10))),lt(this,"checkSizeOfPartInClient",(()=>{const{left:e,right:t,top:n,bottom:r,clientHeight:i,clientWidth:s,clientMin:o}=this._clientSize;let c,d,h,f;if(e<0)c=0;else{if(!(e<s))return!1;c=e}if(t<0)return!1;if(d=t<s?t:s,n<0)h=0;else{if(!(n<i))return!1;h=n}if(r<0)return!1;f=r<i?r:i;const g=d-c,E=f-h;return this.checkSizeIsVisible(g,E,o)})),lt(this,"returnHiddenResult",(e=>(this._clientSize=null,{visible:!1,reason:e}))),lt(this,"checkOneElementVisible",(e=>{if(e instanceof HTMLElement){if(this.checkElementIsMountedOnDom(e)){if(this.checkActualCssVisibleIncludeInherit(e)){if(this._clientSize=this.getSizeAboutClient(e),this.checkElementCover(e))return this.returnHiddenResult(Yg.COVERED);{const t=this.checkActualSize(),n=this.checkSizeOfPartInClient();return t&&!n?this.returnHiddenResult(Yg.POSITION):t?(this._clientSize=null,{visible:!0}):this.returnHiddenResult(Yg.SIZE)}}return this.returnHiddenResult(Yg.STYLE)}return this.returnHiddenResult(ab.UNMOUNTED)}return this.returnHiddenResult(ab.INVALID_HTML_ELEMENT)})),lt(this,"checkElementIsMountedOnDom",(e=>this.checkPropertyUpToAllParentNodes(e,(t=>t.nodeName.toUpperCase()!=="HTML"?t.parentElement!==null:!!document.documentElement))))}};function cb(e){return new TextEncoder().encode(e)}const Qx=function(e,t){const n=new Uint8Array(e.byteLength+t.byteLength);return n.set(new Uint8Array(e),0),n.set(new Uint8Array(t),e.byteLength),n},lb=async e=>(function(t,n){let r="";return new Uint8Array(t).forEach((i=>{r+=i.toString(n).padStart(2,"0")})),r})(await crypto.subtle.digest("SHA-256",cb(e)),16);class xn{constructor(){lt(this,"_events",{}),lt(this,"addListener",this.on)}getListeners(t){return this._events[t]?this._events[t].map((n=>n.listener)):[]}on(t,n){this._events[t]||(this._events[t]=[]);const r=this._events[t];this._indexOfListener(r,n)===-1&&r.push({listener:n,once:!1})}once(t,n){this._events[t]||(this._events[t]=[]);const r=this._events[t];this._indexOfListener(r,n)===-1&&r.push({listener:n,once:!0})}off(t,n){if(!this._events[t])return;const r=this._events[t],i=this._indexOfListener(r,n);i!==-1&&r.splice(i,1),this._events[t].length===0&&delete this._events[t]}removeAllListeners(t){t?delete this._events[t]:this._events={}}emit(t){this._events[t]||(this._events[t]=[]);const n=this._events[t].map((o=>o));for(var r=arguments.length,i=new Array(r>1?r-1:0),s=1;s<r;s++)i[s-1]=arguments[s];for(let o=0;o<n.length;o+=1){const c=n[o];c.once&&this.off(t,c.listener),c.listener.apply(this,i||[])}}safeEmit(t){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];[...this._events[t]||[]].forEach((s=>{s.once&&this.off(t,s.listener);try{s.listener.apply(this,r)}catch(o){console.error("safeEmit event:".concat(t," error ").concat(o?.toString()))}}))}_indexOfListener(t,n){let r=t.length;for(;r--;)if(t[r].listener===n)return r;return-1}}let qg=null;function Zx(){if(qg)return qg;if(window.electron)return qg=window.electron;if(!window.require)return null;try{return qg=window.require("electron"),qg}catch{return null}}let Gn=(function(e){return e.CREATE_CLIENT="createClient",e.CHECK_SYSTEM_REQUIREMENTS="checkSystemRequirements",e.SET_AREA="setArea",e.PRELOAD="PRELOAD",e.CHECK_VIDEO_TRACK_IS_ACTIVE="checkVideoTrackIsActive",e.CHECK_AUDIO_TRACK_IS_ACTIVE="checkAudioTrackIsActive",e.CREATE_MIC_AUDIO_TRACK="createMicrophoneAudioTrack",e.CREATE_CUSTOM_AUDIO_TRACK="createCustomAudioTrack",e.CREATE_BUFFER_AUDIO_TRACK="createBufferSourceAudioTrack",e.CREATE_CAM_VIDEO_TRACK="createCameraVideoTrack",e.CREATE_CUSTOM_VIDEO_TRACK="createCustomVideoTrack",e.CREATE_MIC_AND_CAM_TRACKS="createMicrophoneAndCameraTracks",e.CREATE_SCREEN_VIDEO_TRACK="createScreenVideoTrack",e.SET_ENCRYPTION_CONFIG="Client.setEncryptionConfig",e.START_PROXY_SERVER="Client.startProxyServer",e.STOP_PROXY_SERVER="Client.stopProxyServer",e.SET_PROXY_SERVER="Client.setProxyServer",e.SET_TURN_SERVER="Client.setTurnServer",e.SET_CLIENT_ROLE="Client.setClientRole",e.SET_LOW_STREAM_PARAMETER="Client.setLowStreamParameter",e.ENABLE_DUAL_STREAM="Client.enableDualStream",e.DISABLE_DUAL_STREAM="Client.disableDualStream",e.JOIN="Client.join",e.LEAVE="Client.leave",e.PUBLISH="Client.publish",e.UNPUBLISH="Client.unpublish",e.SUBSCRIBE="Client.subscribe",e.MASS_SUBSCRIBE="Client.massSubscribe",e.MASS_UNSUBSCRIBE="Client.massUnsubscribe",e.UNSUBSCRIBE="Client.unsubscribe",e.RENEW_TOKEN="Client.renewToken",e.SET_REMOTE_VIDEO_STREAM_TYPE="Client.setRemoteVideoStreamType",e.SET_STREAM_FALLBACK_OPTION="Client.setStreamFallbackOption",e.ENABLE_AUDIO_VOLUME_INDICATOR="Client.enableAudioVolumeIndicator",e.SEND_CUSTOM_REPORT_MESSAGE="Client.sendCustomReportMessage",e.INSPECT_VIDEO_CONTENT="Client.inspectVideoContent",e.STOP_INSPECT_VIDEO_CONTENT="Client.stopInspectVideoContent",e.JOIN_FALLBACK_TO_PROXY="Client._joinFallbackToProxy",e.ON_LIVE_STREAM_WARNING="Client.onLiveStreamWarning",e.ON_LIVE_STREAM_ERROR="Client.onLiveStreamingError",e.START_LIVE_STREAMING="Client.startLiveStreaming",e.SET_LIVE_TRANSCODING="Client.setLiveTranscoding",e.STOP_LIVE_STREAMING="Client.stopLiveStreaming",e.START_CHANNEL_MEDIA_RELAY="Client.startChannelMediaRelay",e.UPDATE_CHANNEL_MEDIA_RELAY="Client.updateChannelMediaRelay",e.STOP_CHANNEL_MEDIA_RELAY="Client.stopChannelMediaRelay",e.REQUEST_CONFIG_DISTRIBUTE="_config-distribute-request",e.SET_CONFIG_DISTRIBUTE="_configDistribute",e.LOCAL_TRACK_SET_MUTED="LocalTrack.setMute",e.LOCAL_AUDIO_TRACK_PLAY="LocalAudioTrack.play",e.LOCAL_AUDIO_TRACK_PLAY_IN_ELEMENT="LocalAudioTrack.playInElement",e.LOCAL_AUDIO_TRACK_STOP="LocalAudioTrack.stop",e.LOCAL_AUDIO_TRACK_SET_VOLUME="LocalAudioTrack.setVolume",e.MIC_AUDIO_TRACK_SET_DEVICE="MicrophoneAudioTrack.setDevice",e.BUFFER_AUDIO_TRACK_START="BufferSourceAudioTrack.startProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_STOP="BufferSourceAudioTrack.stopProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_PAUSE="BufferSourceAudioTrack.pauseProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_RESUME="BufferSourceAudioTrack.resumeProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_SEEK="BufferSourceAudioTrack.seekAudioBuffer",e.LOCAL_VIDEO_TRACK_PLAY="LocalVideoTrack.play",e.LOCAL_VIDEO_TRACK_STOP="LocalVideoTrack.stop",e.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE="LocalVideoTrack.getVideoElementVisibleStatus",e.LOCAL_VIDEO_TRACK_BEAUTY="LocalVideoTrack.setBeautyEffect",e.LOCAL_VIDEO_SEND_SEI_DATA="LocalVideoTrack.sendSeiData",e.CAM_VIDEO_TRACK_SET_DEVICE="CameraVideoTrack.setDevice",e.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG="CameraVideoTrack.setEncoderConfiguration",e.REMOTE_VIDEO_TRACK_PLAY="RemoteVideoTrack.play",e.REMOTE_VIDEO_TRACK_STOP="RemoteVideoTrack.stop",e.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE="RemoteVideoTrack.getVideoElementVisibleStatus",e.REMOTE_AUDIO_TRACK_PLAY="RemoteAudioTrack.play",e.REMOTE_AUDIO_TRACK_STOP="RemoteAudioTrack.stop",e.REMOTE_AUDIO_SET_VOLUME="RemoteAudioTrack.setVolume",e.REMOTE_AUDIO_SET_OUTPUT_DEVICE="RemoteAudioTrack.setOutputDevice",e.GET_MEDIA_STREAM_TRACK="Track.getMediaStreamTrack",e.STREAM_TYPE_CHANGE="streamTypeChange",e.CONNECTION_STATE_CHANGE="connectionStateChange",e.LOAD_CONFIG_FROM_LOCALSTORAGE="loadConfigFromLocalStorage",e.IMAGE_MODERATION_UPLOAD="imageModerationUpload",e.REPUB_AFTER_PC_CONNECTED="repubAfterPCConnected",e.PRELOAD_MEDIA_FAILED="preloadMediaFailed",e.MISMATCH_DTLS_PARAMETERS="mismatchDtlsParameters",e})({}),Nn=(function(e){return e.TRACER="tracer",e})({});function $x(e){return cn(e.timeout,"config.timeout",0,1e5),cn(e.timeoutFactor,"config.timeoutFactor",0,100,!1),cn(e.maxRetryCount,"config.maxRetryConfig",0,1/0),cn(e.maxRetryTimeout,"config.maxRetryTimeout",0,1/0),!0}let VY=(function(e){return e[e.AUDIENCE_LEVEL_LOW_LATENCY=1]="AUDIENCE_LEVEL_LOW_LATENCY",e[e.AUDIENCE_LEVEL_ULTRA_LOW_LATENCY=2]="AUDIENCE_LEVEL_ULTRA_LOW_LATENCY",e[e.AUDIENCE_LEVEL_SYNC_LATENCY=3]="AUDIENCE_LEVEL_SYNC_LATENCY",e})({}),$t=(function(e){return e.LEAVE="LEAVE",e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.UID_BANNED="UID_BANNED",e.FALLBACK="FALLBACK",e.IP_BANNED="IP_BANNED",e.CHANNEL_BANNED="CHANNEL_BANNED",e.LICENSE_MISSING="LICENSE_MISSING",e.LICENSE_EXPIRED="LICENSE_EXPIRED",e.LICENSE_MINUTES_EXCEEDED="LICENSE_MINUTES_EXCEEDED",e.LICENSE_PERIOD_INVALID="LICENSE_PERIOD_INVALID",e.LICENSE_MULTIPLE_SDK_SERVICE="LICENSE_MULTIPLE_SDK_SERVICE",e.LICENSE_ILLEGAL="LICENSE_ILLEGAL",e.TOKEN_EXPIRE="TOKEN_EXPIRE",e})({});function Xg(e){if(!Array.isArray(e)||e.length<1)return!1;try{e.forEach((t=>{if(!t.urls)throw Error()}))}catch{return!1}return!0}function e1(e){return kr(e.turnServerURL,"turnServerURL"),kr(e.username,"username"),kr(e.password,"password"),e.udpport&&cn(e.udpport,"udpport",1,99999,!0),e.forceturn&&wa(e.forceturn,"forceturn"),e.security&&wa(e.security,"security"),e.tcpport&&cn(e.tcpport,"tcpport",1,99999,!0),!0}function db(e){return e.level!==void 0&&pr(e.level,"level",[1,2,3]),e.delay!==void 0&&cn(e.delay,"delay",0,3e3,!0),!0}let Ot=(function(e){return e.PEERCONNECTION_STATE_CHANGE="peerconnection-state-change",e.AUDIO_METADATA="audio-metadata",e.AUDIO_PTS="audio-pts",e.CONNECTION_STATE_CHANGE="connection-state-change",e.MEDIA_RECONNECT_START="media-reconnect-start",e.MEDIA_RECONNECT_END="media-reconnect-end",e.IS_USING_CLOUD_PROXY="is-using-cloud-proxy",e.USER_JOINED="user-joined",e.USER_LEAVED="user-left",e.USER_PUBLISHED="user-published",e.USER_UNPUBLISHED="user-unpublished",e.USER_INFO_UPDATED="user-info-updated",e.CLIENT_BANNED="client-banned",e.CHANNEL_MEDIA_RELAY_STATE="channel-media-relay-state",e.CHANNEL_MEDIA_RELAY_EVENT="channel-media-relay-event",e.VOLUME_INDICATOR="volume-indicator",e.CRYPT_ERROR="crypt-error",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="token-privilege-will-expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="token-privilege-did-expire",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGED="stream-type-changed",e.STREAM_FALLBACK="stream-fallback",e.RECEIVE_METADATA="receive-metadata",e.STREAM_MESSAGE="stream-message",e.LIVE_STREAMING_ERROR="live-streaming-error",e.LIVE_STREAMING_WARNING="live-streaming-warning",e.EXCEPTION="exception",e.ERROR="error",e.P2P_LOST="p2p_lost",e.JOIN_FALLBACK_TO_PROXY="join-fallback-to-proxy",e.CHANNEL_FALLBACK_TO_WEBSOCKET="channel-fallback-to-websocket",e.MEDIA_CONNECTION_TYPE_CHANGE="media-connection-type-change",e.PUBLISHED_USER_LIST="published-user-list",e.CONTENT_INSPECT_CONNECTION_STATE_CHANGE="content-inspect-connection-state-change",e.CONTENT_INSPECT_ERROR="content-inspect-error",e.CONTENT_INSPECT_RESULT="content-inspect-result",e.IMAGE_MODERATION_CONNECTION_STATE_CHANGE="image-moderation-connection-state-change",e})({}),Wr=(function(e){return e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.MULTI_IP="MULTI_IP",e.TIMEOUT="TIMEOUT",e.OFFLINE="OFFLINE",e.LEAVE="LEAVE",e.P2P_FAILED="P2P_FAILED",e.FALLBACK="FALLBACK",e.REGIONAL_DISTRIBUTION="REGIONAL_DISTRIBUTION",e})({}),gs=(function(e){return e.ONLINE="ONLINE",e.OFFLINE="OFFLINE",e})({}),xf=(function(e){return e.NETWORK_STATE_CHANGE="NETWORK_STATE_CHANGE",e.ONLINE="ONLINE",e.OFFLINE="OFFLINE",e})({});function Gr(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];return e.getListeners(t).length===0?ke.reject(new de(V.UNEXPECTED_ERROR,"can not emit promise")):new ke(((s,o)=>{e.emit(t,...r,s,o)}))}function un(e,t){if(e.getListeners(t).length===0)return ke.resolve();for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];return Gr(e,t,...r)}function As(e,t){if(e.getListeners(t).length===0)return null;for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];return Jg(e,t,...r)}function Jg(e,t){let n=null,r=null;for(var i=arguments.length,s=new Array(i>2?i-2:0),o=2;o<i;o++)s[o-2]=arguments[o];if(e.emit(t,...s,(c=>{n=c}),(c=>{r=c})),r!==null)throw r;if(n===null)throw new de(V.UNEXPECTED_ERROR,"handler is not sync");return n}const Qn=new class extends xn{set networkState(e){this.emit(xf.NETWORK_STATE_CHANGE,e,this._networkState),e===gs.ONLINE?this.emit(xf.ONLINE):e===gs.OFFLINE&&(this.onlineWaiter=new ke((t=>{this.once(xf.ONLINE,(()=>{this.onlineWaiter=void 0,t(gs.ONLINE)}))})),this.emit(xf.OFFLINE)),this._networkState=e}get networkState(){return this._networkState}get isOnline(){return this._networkState===gs.ONLINE}constructor(){super(),lt(this,"_moduleName","network-indicator"),lt(this,"_networkState",gs.ONLINE),lt(this,"onlineWaiter",void 0),window.addEventListener("online",(()=>{this.networkState=gs.ONLINE})),window.addEventListener("offline",(()=>{this.networkState=gs.OFFLINE}))}};function GS(e,t){const n=e.indexOf(t);n!==-1&&e.splice(n,1)}function Lf(e){const t=[];return e.forEach((n=>{t.indexOf(n)===-1&&t.push(n)})),t}function HS(e){ke!==void 0?ke.resolve().then(e):setTimeout(e,0)}function On(e){return JSON.parse(JSON.stringify(e))}function Sh(e){try{return On(e)}catch{return e}}const t1={};function Id(e,t){t1[t]||(t1[t]=!0,e())}function Th(e){const t=window.atob(e),n=new Uint8Array(new ArrayBuffer(t.length));for(let r=0;r<t.length;r+=1)n[r]=t.charCodeAt(r);return n}function Ad(e){let t="";for(let n=0;n<e.length;n+=1)t+=String.fromCharCode(e[n]);return window.btoa(t)}function n1(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:16,n=new TextEncoder().encode(e);if(n.length>t)n=n.slice(0,t);else if(n.length<t){const r=new Uint8Array(t);r.set(n),n=r}return n}function r1(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const r=Yi(t).call(t,((o,c)=>o+c.length),0),i=new Uint8Array(new ArrayBuffer(r));let s=0;return t.forEach((o=>{i.set(o,s),s+=o.length})),i}function wc(e){return window.TextEncoder?new TextEncoder().encode(e).length:e.length}function i1(e){let t=0;return(/DingTalk/i.test(navigator.userAgent)||/AliApp/i.test(navigator.userAgent))&&e.realFormData&&(e=e.realFormData),e.forEach((n=>{t+=typeof n=="string"?wc(n):n.size})),t+138}function FY(e){const t=new de(V.TIMEOUT,"timeout");return new ke(((n,r)=>{window.setTimeout((()=>r(t)),e)}))}function xr(e){return new ke((t=>{window.setTimeout(t,e)}))}function hn(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:7,t=arguments.length>1?arguments[1]:void 0;const n=Math.random().toString(16).substr(2,e).toLowerCase();return n.length===e?"".concat(t).concat(n):"".concat(t).concat(n)+hn(e-n.length,"")}function Rh(){return hn(32,"").toUpperCase()}const KS=()=>{},s1=new class{constructor(){lt(this,"fnMap",new Map)}throttleByKey(e,t,n,r){for(var i=arguments.length,s=new Array(i>4?i-4:0),o=4;o<i;o++)s[o-4]=arguments[o];if(this.fnMap.has(t)){const c=this.fnMap.get(t);if(c.threshold!==n){c.fn(...c.args),clearTimeout(c.timer);const d=window.setTimeout((()=>{const h=this.fnMap.get(t);h&&h.fn(...h.args),this.fnMap.delete(t)}),n);this.fnMap.set(t,{fn:e,threshold:n,timer:d,args:s,skipFn:r})}else c.skipFn&&c.skipFn(...c.args),this.fnMap.set(t,we(we({},c),{},{fn:e,args:s,skipFn:r}))}else{const c=window.setTimeout((()=>{const d=this.fnMap.get(t);d&&d.fn(...d.args),this.fnMap.delete(t)}),n);this.fnMap.set(t,{fn:e,threshold:n,timer:c,args:s,skipFn:r})}}},o1=s1.throttleByKey.bind(s1);function a1(e){return typeof e=="object"&&e!==null&&!(e instanceof RegExp)}function ub(e,t){if(!a1(e)||!a1(t)||Array.isArray(e)&&!Array.isArray(t)||!Array.isArray(e)&&Array.isArray(t))return t;if(Array.isArray(t)&&Array.isArray(e)){const n=[...e];for(let r=0;r<t.length;r++)n[r]=ub(e[r],t[r]);return n}{const n=we({},e);for(const r in t)Object.prototype.hasOwnProperty.call(t,r)&&(Object.prototype.hasOwnProperty.call(e,r)?n[r]=ub(e[r],t[r]):n[r]=t[r]);return n}}function c1(e,t){let n=[0];if(n=new Array(t).fill(0),e===0)return n;let r=0;for(;e>0&&(n[r]=255&e,e>>=8,r++,r!==t););return n}function Mf(e){return typeof e=="number"?e:e.exact||e.ideal||e.max||e.min||0}function hb(e){return Yi(e).call(e,((t,n)=>t+n),0)}function l1(e){const t="0123456789abcdef";function n(W){let $,Z="";for($=0;$<=3;$++)Z+=t.charAt(W>>8*$+4&15)+t.charAt(W>>8*$&15);return Z}function r(W,$){const Z=(65535&W)+(65535&$);return(W>>16)+($>>16)+(Z>>16)<<16|65535&Z}function i(W,$,Z,Y,ie,ue){return r((function(ge,Re){return ge<<Re|ge>>>32-Re})(r(r($,W),r(Y,ue)),ie),Z)}function s(W,$,Z,Y,ie,ue,ge){return i($&Z|~$&Y,W,$,ie,ue,ge)}function o(W,$,Z,Y,ie,ue,ge){return i($&Y|Z&~Y,W,$,ie,ue,ge)}function c(W,$,Z,Y,ie,ue,ge){return i($^Z^Y,W,$,ie,ue,ge)}function d(W,$,Z,Y,ie,ue,ge){return i(Z^($|~Y),W,$,ie,ue,ge)}const h=(function(W){let $;const Z=1+(W.length+8>>6),Y=new Array(16*Z);for($=0;$<16*Z;$++)Y[$]=0;for($=0;$<W.length;$++)Y[$>>2]|=W.charCodeAt($)<<$%4*8;return Y[$>>2]|=128<<$%4*8,Y[16*Z-2]=8*W.length,Y})(e);let f,g,E,S,O,A=1732584193,N=-271733879,j=-1732584194,U=271733878;for(f=0;f<h.length;f+=16)g=A,E=N,S=j,O=U,A=s(A,N,j,U,h[f+0],7,-680876936),U=s(U,A,N,j,h[f+1],12,-389564586),j=s(j,U,A,N,h[f+2],17,606105819),N=s(N,j,U,A,h[f+3],22,-1044525330),A=s(A,N,j,U,h[f+4],7,-176418897),U=s(U,A,N,j,h[f+5],12,1200080426),j=s(j,U,A,N,h[f+6],17,-1473231341),N=s(N,j,U,A,h[f+7],22,-45705983),A=s(A,N,j,U,h[f+8],7,1770035416),U=s(U,A,N,j,h[f+9],12,-1958414417),j=s(j,U,A,N,h[f+10],17,-42063),N=s(N,j,U,A,h[f+11],22,-1990404162),A=s(A,N,j,U,h[f+12],7,1804603682),U=s(U,A,N,j,h[f+13],12,-40341101),j=s(j,U,A,N,h[f+14],17,-1502002290),N=s(N,j,U,A,h[f+15],22,1236535329),A=o(A,N,j,U,h[f+1],5,-165796510),U=o(U,A,N,j,h[f+6],9,-1069501632),j=o(j,U,A,N,h[f+11],14,643717713),N=o(N,j,U,A,h[f+0],20,-373897302),A=o(A,N,j,U,h[f+5],5,-701558691),U=o(U,A,N,j,h[f+10],9,38016083),j=o(j,U,A,N,h[f+15],14,-660478335),N=o(N,j,U,A,h[f+4],20,-405537848),A=o(A,N,j,U,h[f+9],5,568446438),U=o(U,A,N,j,h[f+14],9,-1019803690),j=o(j,U,A,N,h[f+3],14,-187363961),N=o(N,j,U,A,h[f+8],20,1163531501),A=o(A,N,j,U,h[f+13],5,-1444681467),U=o(U,A,N,j,h[f+2],9,-51403784),j=o(j,U,A,N,h[f+7],14,1735328473),N=o(N,j,U,A,h[f+12],20,-1926607734),A=c(A,N,j,U,h[f+5],4,-378558),U=c(U,A,N,j,h[f+8],11,-2022574463),j=c(j,U,A,N,h[f+11],16,1839030562),N=c(N,j,U,A,h[f+14],23,-35309556),A=c(A,N,j,U,h[f+1],4,-1530992060),U=c(U,A,N,j,h[f+4],11,1272893353),j=c(j,U,A,N,h[f+7],16,-155497632),N=c(N,j,U,A,h[f+10],23,-1094730640),A=c(A,N,j,U,h[f+13],4,681279174),U=c(U,A,N,j,h[f+0],11,-358537222),j=c(j,U,A,N,h[f+3],16,-722521979),N=c(N,j,U,A,h[f+6],23,76029189),A=c(A,N,j,U,h[f+9],4,-640364487),U=c(U,A,N,j,h[f+12],11,-421815835),j=c(j,U,A,N,h[f+15],16,530742520),N=c(N,j,U,A,h[f+2],23,-995338651),A=d(A,N,j,U,h[f+0],6,-198630844),U=d(U,A,N,j,h[f+7],10,1126891415),j=d(j,U,A,N,h[f+14],15,-1416354905),N=d(N,j,U,A,h[f+5],21,-57434055),A=d(A,N,j,U,h[f+12],6,1700485571),U=d(U,A,N,j,h[f+3],10,-1894986606),j=d(j,U,A,N,h[f+10],15,-1051523),N=d(N,j,U,A,h[f+1],21,-2054922799),A=d(A,N,j,U,h[f+8],6,1873313359),U=d(U,A,N,j,h[f+15],10,-30611744),j=d(j,U,A,N,h[f+6],15,-1560198380),N=d(N,j,U,A,h[f+13],21,1309151649),A=d(A,N,j,U,h[f+4],6,-145523070),U=d(U,A,N,j,h[f+11],10,-1120210379),j=d(j,U,A,N,h[f+2],15,718787259),N=d(N,j,U,A,h[f+9],21,-343485551),A=r(A,g),N=r(N,E),j=r(j,S),U=r(U,O);return n(A)+n(N)+n(j)+n(U)}let BY=1,d1=console,Jr=class{static setLogger(e){d1=e}constructor(e,t){lt(this,"id",void 0),lt(this,"lockingPromise",ke.resolve()),lt(this,"locks",0),lt(this,"name",""),lt(this,"lockId",void 0),this.lockId=BY++,e&&(this.name=e),t&&(this.id=t),this.logger("created")}logger(e,t){const n=(this.id?"[".concat(this.id,"]"):"")+"[lock-".concat(this.name,"-").concat(this.lockId,"]"),r=e==="created"?"is ".concat(e,"."):"is ".concat(e,", current queue ").concat(this.locks,". ").concat(t??"");d1.debug("".concat(n," ").concat(r))}setId(e){this.id=e}get isLocked(){return this.locks>0}lock(e){let t;this.locks+=1,this.logger("locked",e);const n=new ke((i=>{t=()=>{this.locks-=1,this.logger("unlocked",e),i()}})),r=this.lockingPromise.then((()=>t));return this.lockingPromise=this.lockingPromise.then((()=>n)),r}};function Uf(e,t){return function(n,r,i){const s=i.value;if(typeof s!="function")throw new Error("Cannot use mutex on object property.");return i.value=async function(){const o=this[t];if(!o)throw new Error("mutex property key ".concat(t," doesn't exist on ").concat(e));const c=await o.lock("From ".concat(e,".").concat(r));try{for(var d=arguments.length,h=new Array(d),f=0;f<d;f++)h[f]=arguments[f];return await s.apply(this,h)}finally{c()}},i}}const rr={timeout:500,timeoutFactor:1.5,maxRetryCount:1/0,maxRetryTimeout:1e4};function pb(e,t){const n=Math.floor(t.timeout*Math.pow(t.timeoutFactor,e));return Math.min(t.maxRetryTimeout,n)}function Ca(e,t,n,r){const i=Object.assign({},rr,r);let s=i.timeout;const o=async()=>{await(function(h){return new ke((f=>{window.setTimeout(f,h)}))})(s),s*=i.timeoutFactor,s=Math.min(i.maxRetryTimeout,s)};let c=!1;const d=new ke((async(h,f)=>{t=t||(()=>!1),n=n||(()=>!0);for(let g=0;g<i.maxRetryCount;g+=1){if(c)return f(new de(V.OPERATION_ABORTED));try{const E=await e();if(!t(E,g)||g+1===i.maxRetryCount)return h(E);await o()}catch(E){if(!n(E,g)||g+1===i.maxRetryCount)return f(E);await o()}}}));return d.cancel=()=>c=!0,d}let zS,u1=class{constructor(e){lt(this,"input",[]),lt(this,"size",void 0),this.size=e}add(e){this.input.push(e),this.input.length>this.size&&this.input.splice(0,1)}mean(){var e;return this.input.length===0?0:Yi(e=this.input).call(e,((t,n)=>t+n))/this.input.length}},YS=0,fb=0;function mb(e,t,n,r){return new ke(((i,s)=>{t.responseType=t.responseType||"json",t.data&&!n?(t.data=JSON.stringify(t.data),YS+=wc(t.data)):n&&(t.data.size?YS+=t.data.size:t.data instanceof FormData?YS+=i1(t.data):YS+=wc(JSON.stringify(t.data))),t.headers=t.headers||{},t.headers["Content-Type"]=t.headers["Content-Type"]||"application/json",t.method="POST",t.url=e,ji.request(t).then((o=>{typeof o.data=="string"?fb+=wc(o.data):o.data instanceof ArrayBuffer||o.data instanceof Uint8Array?fb+=o.data.byteLength:fb+=wc(JSON.stringify(o.data)),i(o.data)})).catch((o=>{ji.isCancel(o)?s(new de(V.OPERATION_ABORTED,"cancel token canceled")):o.code==="ECONNABORTED"?s(new de(V.NETWORK_TIMEOUT,o.message)):o.response?s(new de(V.NETWORK_RESPONSE_ERROR,o.response.status)):s(new de(V.NETWORK_ERROR,o.message))}))}))}async function WY(e,t){const n=new Blob([t.data],{type:"buffer"});return await mb(e,we(we({},t),{},{data:n,headers:{"Content-Type":"application/octet-stream"}}),!0)}const h1=()=>window.isSecureContext!==void 0;function Fo(e){if(Array.isArray(e))return e.map((n=>n));if(!p1(e))return e;const t={};for(const n in e){const r=e[n];p1(r)||Array.isArray(r)?t[n]=Fo(r):t[n]=r}return t}function p1(e){return!(typeof e!="object"||Array.isArray(e)||!e)}let _b=class{constructor(e){lt(this,"input",[]),lt(this,"size",void 0),this.size=e}add(e){this.input.push(e),this.input.length>this.size&&this.input.splice(0,1)}diffMean(){return this.input.length===0?0:(this.input[this.input.length-1]-this.input[0])/this.input.length}};const Cc={address:"unknown",candidateType:"unknown",id:"unknown",port:0,priority:0,protocol:"unknown",type:"unknown"},Qg={timestamp:0,bitrate:{actualEncoded:0,transmit:0},sendPacketLossRate:0,recvPacketLossRate:0,videoRecv:[],videoSend:[],audioRecv:[],audioSend:[],selectedCandidatePair:{id:"unknown",localCandidate:Cc,remoteCandidate:Cc},updateInterval:0},f1={firsCount:0,nacksCount:0,plisCount:0,framesDecodeCount:0,framesDecodeInterval:0,framesDecodeFreezeTime:0,decodeFrameRate:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,qpSumPerFrame:0,framesDroppedCount:0,outputFrameRate:0,packetsDiscarded:0,framesAssembledFromMultiplePackets:0,totalProcessingDelay:0,avgDecodeMs:0,avgFramesAssembledFromMultiplePacketsMs:0,avgProcessingDelayMs:0,avgInterFrameDelayMs:0,totalAssemblyTime:0},m1={firsCount:0,nacksCount:0,plisCount:0,frameCount:0,bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0,qpSumPerFrame:0},_1={bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0},g1={jitterBufferMs:0,jitterMs:0,bytes:0,packetsLost:0,packetLostRate:0,packetsDiscarded:0,packets:0,ssrc:0,receivedFrames:0,droppedFrames:0,concealedSamples:0,totalSamplesReceived:0,silentConcealedSamples:0,concealmentEvents:0,freezeMs80:0,freezeMs200:0,freezeSamples80:0,freezeSamples200:0};let gb=class{constructor(e,t){lt(this,"onFirstVideoReceived",void 0),lt(this,"onFirstVideoDecoded",void 0),lt(this,"onFirstAudioReceived",void 0),lt(this,"onFirstVideoDecodedTimeout",void 0),lt(this,"onFirstAudioDecoded",void 0),lt(this,"onSelectedLocalCandidateChanged",void 0),lt(this,"onSelectedRemoteCandidateChanged",void 0),lt(this,"videoIsReady",!1),lt(this,"videoIsReady2",{}),lt(this,"pc",void 0),lt(this,"options",void 0),lt(this,"intervalTimer",void 0),lt(this,"stats",Fo(Qg)),lt(this,"isFirstVideoReceived",{}),lt(this,"isFirstVideoDecoded",{}),lt(this,"isFirstAudioReceived",{}),lt(this,"isFirstAudioDecoded",{}),lt(this,"isFirstVideoDecodedTimeout",{}),lt(this,"lossRateWindowStats",[]),this.pc=e,this.options=t,this.intervalTimer=window.setInterval((async()=>{this.updateStats()}),this.options.updateInterval)}getStats(){return this.stats}getSelectedCandidatePair(){return new ke((e=>{e({local:we({},Cc),remote:we({},Cc)})}))}setVideoIsReady(e){this.videoIsReady=e}setVideoIsReady2(e,t){this.videoIsReady2[e]=t}getVideoIsReady(e){return this.videoIsReady2[e]||!1}setIsFirstAudioDecoded(e){}destroy(){window.clearInterval(this.intervalTimer),this.pc=void 0}calcLossRate(e){this.lossRateWindowStats.push(e),this.lossRateWindowStats.length>this.options.lossRateInterval&&this.lossRateWindowStats.splice(0,1);const t=this.lossRateWindowStats.length,n=["videoSend","audioSend","videoRecv","audioRecv"];let r=0,i=0,s=0,o=0;for(const c of n)e[c].forEach(((d,h)=>{if(!this.lossRateWindowStats[t-1][c][h]||!this.lossRateWindowStats[0][c][h])return;const f=this.lossRateWindowStats[t-1][c][h].packets-this.lossRateWindowStats[0][c][h].packets,g=this.lossRateWindowStats[t-1][c][h].packetsLost-this.lossRateWindowStats[0][c][h].packetsLost;c==="videoSend"||c==="audioSend"?(r+=f,s+=g):(i+=f,o+=g),Number.isNaN(f)||Number.isNaN(f)?d.packetLostRate=0:d.packetLostRate=f<=0||g<=0?0:g/(f+g)}));e.sendPacketLossRate=r<=0||s<=0?0:s/(r+s),e.recvPacketLossRate=i<=0||o<=0?0:o/(i+o)}},GY=class extends gb{constructor(){super(...arguments),lt(this,"_stats",Qg),lt(this,"lastDecodeVideoReceiverStats",new Map)}async updateStats(){const e=await this._getStats(),t=this.statsResponsesToObjects(e);this._stats=Fo(Qg);const n=t.filter((i=>i.type==="ssrc"));this.processSSRCStats(n);const r=t.find((i=>i.type==="VideoBwe"));r&&this.processBandwidthStats(r),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}processBandwidthStats(e){this._stats.bitrate={actualEncoded:Number(e.googActualEncBitrate),targetEncoded:Number(e.googTargetEncBitrate),retransmit:Number(e.googRetransmitBitrate),transmit:Number(e.googTransmitBitrate)},this._stats.sendBandwidth=Number(e.googAvailableSendBandwidth)}processSSRCStats(e){e.forEach((t=>{var n;const r=be(n=t.id).call(n,"send");switch("".concat(t.mediaType,"_").concat(r?"send":"recv")){case"video_send":{const i=Fo(m1);i.codec=t.googCodecName,i.adaptionChangeReason="none",t.googCpuLimitedResolution&&(i.adaptionChangeReason="cpu"),t.googBandwidthLimitedResolution&&(i.adaptionChangeReason="bandwidth"),i.avgEncodeMs=Number(t.googAvgEncodeMs),i.inputFrame={width:Number(t.googFrameWidthInput)||Number(t.googFrameWidthSent),height:Number(t.googFrameHeightInput)||Number(t.googFrameHeightSent),frameRate:Number(t.googFrameRateInput)},i.sentFrame={width:Number(t.googFrameWidthSent),height:Number(t.googFrameHeightSent),frameRate:Number(t.googFrameRateInput)},i.firsCount=Number(t.googFirReceived),i.nacksCount=Number(t.googNacksReceived),i.plisCount=Number(t.googPlisReceived),i.frameCount=Number(t.framesEncoded),i.bytes=Number(t.bytesSent),i.packets=Number(t.packetsSent),i.packetsLost=Number(t.packetsLost),i.ssrc=Number(t.ssrc),i.rttMs=Number(t.googRtt||0),this._stats.videoSend.push(i),this._stats.rtt=i.rttMs;break}case"video_recv":{const i=Fo(f1),s=this.lastDecodeVideoReceiverStats.get(Number(t.ssrc));if(i.codec=t.googCodecName,i.targetDelayMs=Number(t.googTargetDelayMs),i.renderDelayMs=Number(t.googRenderDelayMs),i.currentDelayMs=Number(t.googCurrentDelayMs),i.minPlayoutDelayMs=Number(t.googMinPlayoutDelayMs),i.decodeMs=Number(t.googDecodeMs),i.maxDecodeMs=Number(t.googMaxDecodeMs),i.receivedFrame={width:Number(t.googFrameWidthReceived),height:Number(t.googFrameHeightReceived),frameRate:Number(t.googFrameRateReceived)},i.decodedFrame={width:Number(t.googFrameWidthReceived),height:Number(t.googFrameHeightReceived),frameRate:Number(t.googFrameRateDecoded)},i.decodeFrameRate=Number(t.googFrameRateDecoded),i.outputFrame={width:Number(t.googFrameWidthReceived),height:Number(t.googFrameHeightReceived),frameRate:Number(t.googFrameRateOutput)},i.jitterBufferMs=Number(t.googJitterBufferMs),i.firsCount=Number(t.googFirsSent),i.nacksCount=Number(t.googNacksSent),i.plisCount=Number(t.googPlisSent),i.framesDecodeCount=Number(t.framesDecoded),i.bytes=Number(t.bytesReceived),i.packets=Number(t.packetsReceived),i.packetsLost=Number(t.packetsLost),i.ssrc=Number(t.ssrc),i.packets>0&&!this.isFirstVideoReceived[i.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(i.ssrc),this.isFirstVideoReceived[i.ssrc]=!0),i.framesDecodeCount>0&&!this.isFirstVideoDecoded[i.ssrc]&&(this.onFirstVideoDecoded&&this.onFirstVideoDecoded(i.ssrc,i.decodedFrame.width,i.decodedFrame.height),this.isFirstVideoDecoded[i.ssrc]=!0),s){const o=s.stats,c=Date.now()-s.lts;i.framesDecodeFreezeTime=o.framesDecodeFreezeTime,i.framesDecodeInterval=o.framesDecodeInterval,i.framesDecodeCount>o.framesDecodeCount&&this.isFirstVideoDecoded[i.ssrc]?(s.lts=Date.now(),i.framesDecodeInterval=c,i.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(t.ssrc,10))?i.framesDecodeFreezeTime+=i.framesDecodeInterval:this.setVideoIsReady2(parseInt(t.ssrc,10),!0))):i.framesDecodeCount<s.stats.framesDecodeCount&&(i.framesDecodeInterval=0)}this.lastDecodeVideoReceiverStats.set(i.ssrc,{stats:we({},i),lts:Date.now()}),this._stats.videoRecv.push(i);break}case"audio_recv":{const i=Fo(g1);i.codec=t.googCodecName,i.outputLevel=Math.abs(Number(t.audioOutputLevel))/32767,i.decodingCNG=Number(t.googDecodingCNG),i.decodingCTN=Number(t.googDecodingCTN),i.decodingCTSG=Number(t.googDecodingCTSG),i.decodingNormal=Number(t.googDecodingNormal),i.decodingPLC=Number(t.googDecodingPLC),i.decodingPLCCNG=Number(t.googDecodingPLCCNG),i.expandRate=Number(t.googExpandRate),i.accelerateRate=Number(t.googAccelerateRate),i.preemptiveExpandRate=Number(t.googPreemptiveExpandRate),i.secondaryDecodedRate=Number(t.googSecondaryDecodedRate),i.speechExpandRate=Number(t.googSpeechExpandRate),i.preferredJitterBufferMs=Number(t.googPreferredJitterBufferMs),i.jitterBufferMs=Number(t.googJitterBufferMs),i.jitterMs=Number(t.googJitterReceived),i.bytes=Number(t.bytesReceived),i.packets=Number(t.packetsReceived),i.packetsLost=Number(t.packetsLost),i.ssrc=Number(t.ssrc),i.receivedFrames=Number(t.googDecodingCTN)||Number(t.packetsReceived),i.droppedFrames=Number(t.googDecodingPLC)+Number(t.googDecodingPLCCNG)||Number(t.packetsLost),i.receivedFrames>0&&!this.isFirstAudioReceived[i.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(i.ssrc),this.isFirstAudioReceived[i.ssrc]=!0),i.decodingNormal>0&&!this.isFirstAudioDecoded[i.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(i.ssrc),this.isFirstAudioDecoded[i.ssrc]=!0),this._stats.audioRecv.push(i);break}case"audio_send":{const i=Fo(_1);i.codec=t.googCodecName,i.inputLevel=Math.abs(Number(t.audioInputLevel))/32767,i.aecReturnLoss=Number(t.googEchoCancellationReturnLoss||0),i.aecReturnLossEnhancement=Number(t.googEchoCancellationReturnLossEnhancement||0),i.residualEchoLikelihood=Number(t.googResidualEchoLikelihood||0),i.residualEchoLikelihoodRecentMax=Number(t.googResidualEchoLikelihoodRecentMax||0),i.bytes=Number(t.bytesSent),i.packets=Number(t.packetsSent),i.packetsLost=Number(t.packetsLost),i.ssrc=Number(t.ssrc),i.rttMs=Number(t.googRtt||0),this._stats.rtt=i.rttMs,this._stats.audioSend.push(i);break}}}))}_getStats(){return new ke(((e,t)=>{this.pc.getStats(e,t)}))}statsResponsesToObjects(e){const t=[];return e.result().forEach((n=>{const r={id:n.id,timestamp:n.timestamp.valueOf().toString(),type:n.type};n.names().forEach((i=>{r[i]=n.stat(i)})),t.push(r)})),t}},Zg=(function(e){return e.BANDWIDTH="bandwidth",e.CPU="cpu",e.NONE="none",e.OTHER="other",e})({}),qS=(function(e){return e.L1T1="L1T1",e.L1T2="L1T2",e.L1T3="L1T3",e.L1T3_KEY="L1T3_KEY",e.L2T1_KEY="L2T1_KEY",e.L2T2_KEY="L2T2_KEY",e.L2T3_KEY="L2T3_KEY",e.L3T1_KEY="L3T1_KEY",e.L3T2_KEY="L3T2_KEY",e.L3T3_KEY="L3T3_KEY",e})({}),Eb=(function(e){return e[e.new=0]="new",e[e.connecting=1]="connecting",e[e.connected=2]="connected",e[e.disconnected=3]="disconnected",e[e.failed=4]="failed",e[e.closed=5]="closed",e})({}),Ns=(function(e){return e.CERTIFICATE="certificate",e.CODEC="codec",e.CANDIDATE_PAIR="candidate-pair",e.LOCAL_CANDIDATE="local-candidate",e.REMOTE_CANDIDATE="remote-candidate",e.INBOUND="inbound-rtp",e.TRACK="track",e.OUTBOUND="outbound-rtp",e.PC="peer-connection",e.REMOTE_INBOUND="remote-inbound-rtp",e.REMOTE_OUTBOUND="remote-outbound-rtp",e.TRANSPORT="transport",e.CSRC="csrc",e.DATA_CHANNEL="data-channel",e.STREAM="stream",e.SENDER="sender",e.RECEIVER="receiver",e})({});var jf=(function(e){return e[e.kNone=1]="kNone",e[e.kMillisecondsFromSeconds=1e3]="kMillisecondsFromSeconds",e[e.kBytesToBits=8]="kBytesToBits",e})(jf||{});function $g(e,t,n,r){let i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:jf.kNone;if(!t)return;const s=Number(t[n]);if(typeof s!="number")return;const o=Number(t[r]);if(typeof o!="number")return;if(!e)return o?s/o*i:void 0;const c=Number(e[n]);if(typeof c!="number")return;const d=Number(e[r]);if(typeof d!="number")return;const h=o-d;return h?(s-c)/h*i:void 0}let E1=class extends gb{constructor(){super(...arguments),lt(this,"_stats",Qg),lt(this,"report",void 0),lt(this,"lastDecodeVideoReceiverStats",new Map),lt(this,"lastVideoFramesRecv",new Map),lt(this,"lastVideoFramesSent",new Map),lt(this,"lastVideoFramesDecode",new Map),lt(this,"lastVideoFramesOutput",new Map),lt(this,"lastVideoJBDelay",new Map),lt(this,"lastAudioJBDelay",new Map),lt(this,"mediaBytesSent",new Map),lt(this,"mediaBytesRetransmit",new Map),lt(this,"mediaBytesTargetEncode",new Map),lt(this,"lastDecodeAudioReceiverStats",new Map),lt(this,"lastAudioConcealment",new Map),lt(this,"lastEncoderMs",new Map)}async updateStats(){this.report=await this.pc.getStats(),this._stats=Fo(Qg),this.report.forEach((e=>{switch(e.type){case Ns.OUTBOUND:case Ns.INBOUND:{const t=e.mediaType||e.kind,n=!t&&"frameWidth"in e,r=!t&&!("frameWidth"in e);e.type===Ns.OUTBOUND?t==="audio"||r?this.processAudioOutboundStats(e):(t==="video"||n)&&this.processVideoOutboundStats(e):e.type===Ns.INBOUND&&(t==="audio"||r?this.processAudioInboundStats(e):(t==="video"||n)&&this.processVideoInboundStats(e));break}case Ns.TRANSPORT:{const t=this.report.get(e.selectedCandidatePairId);t&&this.processCandidatePairStats(t);break}case Ns.CANDIDATE_PAIR:e.selected&&this.processCandidatePairStats(e)}})),this.updateSendBitrate(),this._stats.updateInterval=Date.now()-this.stats.timestamp,this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}async getSelectedCandidatePair(){const e=await this.pc.getStats(),t={local:we({},Cc),remote:we({},Cc)};return e.forEach((n=>{let r;if(n.type===Ns.TRANSPORT&&(r=e.get(n.selectedCandidatePairId)),n.type===Ns.CANDIDATE_PAIR&&n.selected&&(r=n),r){const i=(s,o)=>{s.type=o.type,s.id=o.id,o.address&&(s.address=o.address),o.candidateType&&(s.candidateType=o.candidateType),o.port&&(s.port=o.port),o.priority&&(s.priority=o.priority),o.protocol&&(s.protocol=o.protocol),o.relayProtocol&&(s.relayProtocol=o.relayProtocol)};if(r.localCandidateId){const s=e.get(r.localCandidateId);s&&i(t.local,s)}if(r.remoteCandidateId){const s=e.get(r.remoteCandidateId);s&&i(t.remote,s)}}})),t}processCandidatePairStats(e){if(this._stats.sendBandwidth=e.availableOutgoingBitrate||0,e.currentRoundTripTime&&(this._stats.rtt=1e3*e.currentRoundTripTime),this._stats.videoSend.forEach((t=>{e.currentRoundTripTime&&(t.rttMs=1e3*e.currentRoundTripTime)})),this._stats.audioSend.forEach((t=>{e.currentRoundTripTime&&(t.rttMs=1e3*e.currentRoundTripTime)})),this._stats.selectedCandidatePair.id=e.id,e.localCandidateId){const t=this.report.get(e.localCandidateId);t&&this.processCandidateStats(t)}if(e.remoteCandidateId){const t=this.report.get(e.remoteCandidateId);t&&this.processCandidateStats(t)}}processCandidateStats(e){let t;e.type===Ns.LOCAL_CANDIDATE&&(t=this._stats.selectedCandidatePair.localCandidate),e.type===Ns.REMOTE_CANDIDATE&&(t=this._stats.selectedCandidatePair.remoteCandidate),t&&(t.type=e.type,t.id=e.id,e.address&&(t.address=e.address),e.candidateType&&(t.candidateType=e.candidateType),e.port&&(t.port=e.port),e.priority&&(t.priority=e.priority),e.protocol&&(t.protocol=e.protocol),e.relayProtocol&&(t.relayProtocol=e.relayProtocol),e.type===Ns.LOCAL_CANDIDATE&&this.stats.selectedCandidatePair.localCandidate.id!==t.id&&this.onSelectedLocalCandidateChanged&&this.onSelectedLocalCandidateChanged(we({},t),we({},this.stats.selectedCandidatePair.localCandidate)),e.type===Ns.REMOTE_CANDIDATE&&this.stats.selectedCandidatePair.remoteCandidate.id!==t.id&&this.onSelectedRemoteCandidateChanged&&this.onSelectedRemoteCandidateChanged(we({},t),we({},this.stats.selectedCandidatePair.remoteCandidate)))}processAudioInboundStats(e){let t=this._stats.audioRecv.find((r=>r.ssrc===e.ssrc));t||(t=Fo(g1),this._stats.audioRecv.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsReceived,t.packetsLost=e.packetsLost,t.packetsDiscarded=e.packetsDiscarded,t.bytes=e.bytesReceived,t.jitterMs=1e3*e.jitter,t.retransmittedBytesReceived=e.retransmittedBytesReceived,t.retransmittedPacketsReceived=e.retransmittedPacketsReceived,t.totalProcessingDelay=e.totalProcessingDelay,t.jitterBufferEmittedCount=e.jitterBufferEmittedCount;const n=this.lastDecodeAudioReceiverStats.get(t.ssrc);t.avgProcessingDelayMs=$g(n,t,"totalProcessingDelay","jitterBufferEmittedCount",jf.kMillisecondsFromSeconds),this.processAudioTrackReceiverStats(e,e.trackId,t),this.calculateAudioFreeze(t,n,e),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),t.receivedFrames||(t.receivedFrames=e.packetsReceived),t.droppedFrames||(t.droppedFrames=e.packetsLost),t.receivedFrames>0&&!this.isFirstAudioReceived[t.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(t.ssrc),this.isFirstAudioReceived[t.ssrc]=!0),t.outputLevel&&t.outputLevel>0&&!this.isFirstAudioDecoded[t.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(t.ssrc),this.isFirstAudioDecoded[t.ssrc]=!0),typeof e.concealedSamples=="number"&&(t.concealedSamples=e.concealedSamples),this.lastDecodeAudioReceiverStats.set(t.ssrc,we({},t))}calculateAudioFreeze(e,t,n){const r=this.lastAudioConcealment.get(e.ssrc);if(t!=null&&r!=null){const i=r.lts,s=n.timestamp,o=s-i;if(o<=0)return;const c=e.concealedSamples-t.concealedSamples-0,d=r.nonSilent+c,h=e.totalSamplesReceived-t.totalSamplesReceived;if(h<=0)return;const f=80*h/o,g=200*h/o,E=o/h;let S=0;e.freezeSamples80=t.freezeSamples80,e.freezeMs80=t.freezeMs80,d>f&&(r.plc80>0?(e.freezeSamples80+=c,e.freezeMs80+=Math.round(c*E)):(e.freezeSamples80+=d,e.freezeMs80+=Math.round(d*E)),S=r.plc80+1);let O=0;e.freezeSamples200=t.freezeSamples200,e.freezeMs200=t.freezeMs200,d>g&&(r.plc200>0?(e.freezeSamples200+=c,e.freezeMs200+=Math.round(c*E)):(e.freezeSamples200+=d,e.freezeMs200+=Math.round(d*E)),O=r.plc200+1),this.lastAudioConcealment.set(e.ssrc,{nonSilent:c,lts:s,plc80:S,plc200:O})}else e.freezeSamples80=0,e.freezeSamples200=0,e.freezeMs80=0,e.freezeMs200=0,this.lastAudioConcealment.set(e.ssrc,{nonSilent:0,lts:n.timestamp,plc80:0,plc200:0})}processVideoInboundStats(e){let t=this._stats.videoRecv.find((o=>o.ssrc===e.ssrc));t||(t=Fo(f1),this._stats.videoRecv.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsReceived,t.packetsLost=e.packetsLost,t.bytes=e.bytesReceived,t.firsCount=e.firCount,t.nacksCount=e.nackCount,t.plisCount=e.pliCount,t.framesDecodeCount=e.framesDecoded,t.framesDroppedCount=e.framesDropped,t.totalInterFrameDelay=e.totalInterFrameDelay,t.totalSquaredInterFrameDelay=e.totalSquaredInterFrameDelay,t.totalFreezesDuration=e.totalFreezesDuration,t.totalProcessingDelay=e.totalProcessingDelay,t.packetsDiscarded=e.packetsDiscarded,t.framesAssembledFromMultiplePackets=e.framesAssembledFromMultiplePackets,t.totalAssemblyTime=e.totalAssemblyTime,t.keyFramesDecoded=e.keyFramesDecoded,t.retransmittedBytesReceived=e.retransmittedBytesReceived,t.retransmittedPacketsReceived=e.retransmittedPacketsReceived;const n=this.lastDecodeVideoReceiverStats.get(t.ssrc),r=this.lastVideoFramesDecode.get(t.ssrc),i=this.lastVideoFramesOutput.get(t.ssrc),s=Date.now();if(t.framesDecodeCount>0&&!this.isFirstVideoDecoded[t.ssrc]){const o=t.decodedFrame?t.decodedFrame.width:0,c=t.decodedFrame?t.decodedFrame.height:0;this.onFirstVideoDecoded&&this.onFirstVideoDecoded(t.ssrc,o,c),this.isFirstVideoDecoded[t.ssrc]=!0}if(n){const o=n.stats,c=s-n.lts;t.framesDecodeFreezeTime=o.framesDecodeFreezeTime,t.framesDecodeInterval=o.framesDecodeInterval,!this.isFirstVideoDecoded[t.ssrc]&&c>this.options.firstVideoDecodedTimeout&&!this.isFirstVideoDecodedTimeout[t.ssrc]&&(this.onFirstVideoDecodedTimeout&&this.onFirstVideoDecodedTimeout(t.ssrc),this.isFirstVideoDecodedTimeout[t.ssrc]=!0),t.framesDecodeCount>o.framesDecodeCount&&this.isFirstVideoDecoded[t.ssrc]?(n.lts=Date.now(),t.framesDecodeInterval=c,t.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(e.ssrc))?t.framesDecodeFreezeTime+=t.framesDecodeInterval:this.setVideoIsReady2(parseInt(e.ssrc,10),!0))):t.framesDecodeCount<o.framesDecodeCount&&(t.framesDecodeInterval=0),e.framesDecoded&&e.qpSum&&(n.stats.framesDecodeCount>e.framesDecoded?t.qpSumPerFrame=e.qpSum/e.framesDecoded:t.qpSumPerFrame=(e.qpSum-n.qpSum)/(e.framesDecoded-n.stats.framesDecodeCount))}e.totalDecodeTime&&(t.decodeMs=1e3*e.totalDecodeTime,t.avgDecodeMs=$g(n?.stats,t,"decodeMs","framesDecodeCount")),t.avgProcessingDelayMs=$g(n?.stats,t,"totalProcessingDelay","framesDecodeCount",jf.kMillisecondsFromSeconds),t.avgFramesAssembledFromMultiplePacketsMs=$g(n?.stats,t,"totalAssemblyTime","framesAssembledFromMultiplePackets",jf.kMillisecondsFromSeconds),t.avgInterFrameDelayMs=$g(n?.stats,t,"totalInterFrameDelay","framesDecodeCount",jf.kMillisecondsFromSeconds),r&&s-r.lts>=800?(t.decodeFrameRate=Math.round((t.framesDecodeCount-r.count)/((s-r.lts)/1e3)),this.lastVideoFramesDecode.set(t.ssrc,{count:t.framesDecodeCount,lts:s,rate:t.decodeFrameRate})):r?t.decodeFrameRate=r.rate:this.lastVideoFramesDecode.set(t.ssrc,{count:t.framesDecodeCount,lts:s,rate:0}),t.framesDroppedCount&&e.framesReceived&&(i&&s-i.lts>=800?(t.outputFrameRate=Math.round((e.framesReceived-t.framesDroppedCount-i.count)/((s-i.lts)/1e3)),this.lastVideoFramesOutput.set(t.ssrc,{count:e.framesReceived-t.framesDroppedCount,lts:s,rate:Math.max(t.outputFrameRate,0)})):i?t.outputFrameRate=i.rate:this.lastVideoFramesOutput.set(t.ssrc,{count:e.framesReceived-t.framesDroppedCount,lts:s,rate:0})),this.processVideoTrackReceiverStats(e,e.trackId,t),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),e.framerateMean&&(t.framesRateFirefox=e.framerateMean),t.packets>0&&!this.isFirstVideoReceived[t.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(t.ssrc),this.isFirstVideoReceived[t.ssrc]=!0),this.lastDecodeVideoReceiverStats.set(t.ssrc,{stats:we({},t),lts:n?n.lts:Date.now(),qpSum:e.qpSum})}processVideoOutboundStats(e){let t=this._stats.videoSend.find((r=>r.ssrc===e.ssrc));t||(t=Fo(m1),this._stats.videoSend.push(t));const n=this.mediaBytesSent.get(e.ssrc);if(n)n.add(e.bytesSent);else{const r=new _b(10);r.add(e.bytesSent),this.mediaBytesSent.set(e.ssrc,r)}if(e.retransmittedBytesSent!==void 0){const r=this.mediaBytesRetransmit.get(e.ssrc);if(r)r.add(e.retransmittedBytesSent);else{const i=new _b(10);i.add(e.retransmittedBytesSent),this.mediaBytesRetransmit.set(e.ssrc,i)}}if(e.totalEncodedBytesTarget){const r=this.mediaBytesTargetEncode.get(e.ssrc);if(r)r.add(e.totalEncodedBytesTarget);else{const i=new _b(10);i.add(e.totalEncodedBytesTarget),this.mediaBytesTargetEncode.set(e.ssrc,i)}}if(t.ssrc=e.ssrc,t.bytes=e.bytesSent,t.packets=e.packetsSent,t.firsCount=e.firCount,t.nacksCount=e.nackCount,t.plisCount=e.pliCount,t.frameCount=e.framesEncoded,t.adaptionChangeReason=e.qualityLimitationReason,t.scalabilityMode=e.scalabilityMode,t.retransmittedBytesSent=e.retransmittedBytesSent,t.retransmittedPacketsSent=e.retransmittedPacketsSent,t.hugeFramesSent=e.hugeFramesSent,t.keyFramesEncoded=e.keyFramesEncoded,t.targetBitrate=e.targetBitrate,e.totalEncodeTime&&e.framesEncoded){const r=this.lastEncoderMs.get(e.ssrc);if(!r||r.lastFrameCount>e.framesEncoded)t.avgEncodeMs=1e3*e.totalEncodeTime/e.framesEncoded;else{const i=e.framesEncoded-r.lastFrameCount,s=e.totalEncodeTime-r.lastEncoderTime;t.avgEncodeMs=1e3*s/i}}if(e.framesEncoded&&e.qpSum){const r=this.lastEncoderMs.get(e.ssrc);!r||r.lastFrameCount>e.framesEncoded?t.qpSumPerFrame=e.qpSum/e.framesEncoded:t.qpSumPerFrame=(e.qpSum-r.lastQpSum)/(e.framesEncoded-r.lastFrameCount)}if(this.lastEncoderMs.set(e.ssrc,{lastFrameCount:e.framesEncoded,lastEncoderTime:e.totalEncodeTime,lastQpSum:e.qpSum,lts:Date.now()}),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),e.mediaSourceId&&this.processVideoMediaSource(e.mediaSourceId,t),this.processVideoTrackSenderStats(e,e.trackId,t),e.remoteId)this.processRemoteInboundStats(e.remoteId,t);else{const r=this.findRemoteStatsId(e.ssrc,Ns.REMOTE_INBOUND);r&&this.processRemoteInboundStats(r,t)}}processAudioOutboundStats(e){let t=this._stats.audioSend.find((n=>n.ssrc===e.ssrc));if(t||(t=Fo(_1),this._stats.audioSend.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsSent,t.bytes=e.bytesSent,t.retransmittedBytesSent=e.retransmittedBytesSent,t.retransmittedPacketsSent=e.retransmittedPacketsSent,e.mediaSourceId&&this.processAudioMediaSource(e.mediaSourceId,t),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),this.processAudioTrackSenderStats(e,e.trackId,t),e.remoteId)this.processRemoteInboundStats(e.remoteId,t);else{const n=this.findRemoteStatsId(e.ssrc,Ns.REMOTE_INBOUND);n&&this.processRemoteInboundStats(n,t)}}findRemoteStatsId(e,t){var n;const r=Array.from(fs(n=this.report).call(n)).find((i=>i.type===t&&i.ssrc===e));return r?r.id:null}processVideoMediaSource(e,t){const n=this.report.get(e);n&&n.width&&n.height&&n.framesPerSecond&&(t.inputFrame={width:n.width,height:n.height,frameRate:n.framesPerSecond})}processAudioMediaSource(e,t){const n=this.report.get(e);n&&(t.inputLevel=n.audioLevel)}processVideoTrackSenderStats(e,t,n){var r,i,s,o;const c=t?this.report.get(t):void 0,d=(r=c?.framesSent)!==null&&r!==void 0?r:e.framesSent;if(typeof d!="number")return;let h=(i=c?.frameWidth)!==null&&i!==void 0?i:e.frameWidth,f=(s=c?.frameHeight)!==null&&s!==void 0?s:e.frameHeight,g=(o=c?.framesPerSecond)!==null&&o!==void 0?o:e.framesPerSecond;if(typeof h=="number"&&typeof f=="number"||(h=0,f=0),g==null){const E=Date.now(),S=this.lastVideoFramesSent.get(n.ssrc);S&&E-S.lts>=800?(g=Math.round((d-S.count)/((E-S.lts)/1e3)),this.lastVideoFramesSent.set(n.ssrc,{count:d,lts:E,rate:g})):S?g=S.rate:this.lastVideoFramesSent.set(n.ssrc,{count:d,lts:E,rate:0})}n.sentFrame={width:h,height:f,frameRate:Math.max(0,g)}}processVideoTrackReceiverStats(e,t,n){var r,i,s,o,c;const d=t?this.report.get(t):void 0,h=(r=d?.framesReceived)!==null&&r!==void 0?r:e.framesReceived,f=(i=d?.frameWidth)!==null&&i!==void 0?i:e.frameWidth,g=(s=d?.frameHeight)!==null&&s!==void 0?s:e.frameHeight,E=(o=d?.jitterBufferDelay)!==null&&o!==void 0?o:e.jitterBufferDelay,S=(c=d?.jitterBufferEmittedCount)!==null&&c!==void 0?c:e.jitterBufferEmittedCount;if(typeof h=="number"){const O=this.lastVideoFramesRecv.get(n.ssrc),A=Date.now();n.framesReceivedCount=h;let N=0;O&&A-O.lts>=800?(N=Math.round((h-O.count)/((A-O.lts)/1e3)),this.lastVideoFramesRecv.set(n.ssrc,{count:h,lts:A,rate:N})):O?N=O.rate:this.lastVideoFramesRecv.set(n.ssrc,{count:h,lts:A,rate:0}),n.receivedFrame={width:f||0,height:g||0,frameRate:N||0},n.decodedFrame={width:f||0,height:g||0,frameRate:n.decodeFrameRate||0},n.outputFrame={width:f||0,height:g||0,frameRate:n.outputFrameRate||n.decodeFrameRate||0}}if(E&&S){const O=this.lastVideoJBDelay.get(n.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let A=O.jitterBufferMs;const N=S-O.jitterBufferEmittedCount;N>0&&(A=1e3*(E-O.jitterBufferDelay)/N),n.jitterBufferMs=A,n.currentDelayMs=Math.round(A),this.lastVideoJBDelay.set(n.ssrc,{jitterBufferDelay:E,jitterBufferEmittedCount:S,jitterBufferMs:n.currentDelayMs})}}processAudioTrackSenderStats(e,t,n){var r,i,s,o;const c=t?this.report.get(t):void 0,d=(r=(i=c?.echoReturnLoss)!==null&&i!==void 0?i:e.echoReturnLoss)!==null&&r!==void 0?r:0,h=(s=(o=c?.echoReturnLossEnhancement)!==null&&o!==void 0?o:e.echoReturnLossEnhancement)!==null&&s!==void 0?s:0;n.aecReturnLoss=d,n.aecReturnLossEnhancement=h}processAudioTrackReceiverStats(e,t,n){var r,i,s,o,c,d,h,f,g;const E=t?this.report.get(t):void 0,S=(r=E?.removedSamplesForAcceleration)!==null&&r!==void 0?r:e.removedSamplesForAcceleration,O=(i=E?.totalSamplesReceived)!==null&&i!==void 0?i:e.totalSamplesReceived,A=(s=E?.jitterBufferDelay)!==null&&s!==void 0?s:e.jitterBufferDelay,N=(o=E?.jitterBufferEmittedCount)!==null&&o!==void 0?o:e.jitterBufferEmittedCount,j=(c=E?.audioLevel)!==null&&c!==void 0?c:e?.audioLevel,U=(d=E?.totalSamplesDuration)!==null&&d!==void 0?d:e?.totalSamplesDuration,W=(h=E?.concealedSamples)!==null&&h!==void 0?h:e.concealedSamples,$=(f=E?.silentConcealedSamples)!==null&&f!==void 0?f:e.silentConcealedSamples,Z=(g=E?.concealmentEvents)!==null&&g!==void 0?g:e.concealmentEvents;if(typeof O=="number"&&(n.totalSamplesReceived=O),typeof $=="number"&&(n.silentConcealedSamples=$),typeof Z=="number"&&(n.concealmentEvents=Z),typeof W=="number"&&(n.concealedSamples=W),S&&O&&(n.accelerateRate=S/O),A&&N){const ie=this.lastAudioJBDelay.get(n.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let ue=ie.jitterBufferMs;const ge=N-ie.jitterBufferEmittedCount;ge>0&&(ue=1e3*(A-ie.jitterBufferDelay)/ge),n.jitterBufferMs=Math.round(ue),this.lastAudioJBDelay.set(n.ssrc,{jitterBufferDelay:A,jitterBufferEmittedCount:N,jitterBufferMs:n.jitterBufferMs})}n.outputLevel=j;let Y=1920;U&&O&&(Y=O/U/50,n.receivedFrames=Math.round(O/Y)),W&&(n.droppedFrames=Math.round(W/Y))}processRemoteInboundStats(e,t){const n=this.report.get(e);n&&(t.packetsLost=n.packetsLost,n.roundTripTime&&(t.rttMs=1e3*n.roundTripTime),n.jitter&&(t.jitterMs=1e3*n.jitter),n.timestamp&&(t.timestamp=n.timestamp))}getCodecFromCodecStats(e){const t=this.report.get(e);if(!t)return"";const n=t.mimeType.match(/\/(.*)$/);return n&&n[1]?n[1]:""}updateSendBitrate(){let e=0,t=null,n=null;this.mediaBytesSent.forEach((i=>{e+=i.diffMean()})),this.mediaBytesRetransmit.forEach((i=>{t=t===null?i.diffMean():t+i.diffMean()})),this.mediaBytesTargetEncode.forEach((i=>{n=n===null?i.diffMean():n+i.diffMean()}));const r=t!==null?e-t:e;this._stats.bitrate={actualEncoded:8*r/(this.options.updateInterval/1e3),transmit:8*e/(this.options.updateInterval/1e3)},t!==null&&(this._stats.bitrate.retransmit=8*t/(this.options.updateInterval/1e3)),n!==null&&(this._stats.bitrate.targetEncoded=8*n/(this.options.updateInterval/1e3))}},HY=class extends gb{updateStats(){return ke.resolve()}};function vb(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:250,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:8,r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:500,i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1e4;const s=(function(){const o=navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]*/i);return o&&o[0]?Number(o[0].split("/")[1]):null})();return s?s<76?new GY(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:r,firstVideoDecodedTimeout:i}):new E1(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:r,firstVideoDecodedTimeout:i}):(function(o){if(!window.RTCStatsReport)return!1;const c=o.getStats();return!!(c instanceof ke||(function(d){return!!d&&(typeof d=="object"||typeof d=="function")&&typeof d.then=="function"})(c))})(e)?new E1(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:r,firstVideoDecodedTimeout:i}):new HY(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:r,firstVideoDecodedTimeout:i})}const v1="websdk_ng_install_id";function yb(){try{if(B("INSTALL_ID"))return B("INSTALL_ID");let e=window.localStorage.getItem(v1);return e||(e=Rh(),window.localStorage.setItem(v1,e)),sn("INSTALL_ID",e),e}catch{return}}const ro=(function(e){if(e.match(/[0-9]+\.[0-9]+\.[0-9]+$/))return e;const t=e.match(/([0-9]+\.[0-9]+\.[0-9]+)\-([0-9]+)/);if(t&&t[1]&&t[2]){const n=t[1],r=t[2];return"".concat(n,".").concat(r)}return"4.0.0.999"})("4.24.0"),Sb=(function(){try{return JSON.parse("true")===!0}catch{return!0}})();let wh=(function(e){return e.Default="default",e.Auto="auto",e.Relay="relay",e.SdRtn="sd-rtn",e})({});const Hr=(function(){const e="us".concat("erna","me"),t="pa".concat("sswo","rd"),n=["t","s","t"];n.splice(1,0,"e");const r=n.join(""),i=[];for(let c=0;c<6;c++)i.push("1");const s=i.join(""),o={};return o[e]=r,o[t]=s,Object.assign(o,{turnServerURL:"",tcpport:3433,udpport:3478,forceturn:!1})})();window.DEFAULT_TURN_CONFIG=Hr;const XS={ENABLE_PUBLISHED_USER_LIST:!0,MAX_SUBSCRIPTION:50,SUBSCRIBE_AUDIO_FILTER_TOPN:void 0,ENABLE_PUBLISH_AUDIO_FILTER:void 0,ENABLE_USER_LICENSE_CHECK:!0,DISABLE_FEC:void 0,ENABLE_NTP_REPORT:!1,ENABLE_INSTANT_VIDEO:!1,ENABLE_USER_AUTO_REBALANCE_CHECK:!0,ENABLE_LOSSBASED_BWE:!0,ENABLE_AUT_CC:!0,FORCE_ENABLE_AUT_CC:!1,ENABLE_CC_FALLBACK:void 0,SUBSCRIBE_TWCC:!0,PUBLISH_TWCC:!1,ENABLE_SVC_DEFAULT_CODECS:["H264","VP8","VP9","AV1"],SVC:[],ENABLE_FULL_LINK_AV_SYNC:!1,SVC_MODE:null,PRE_SUB_NUM:1,ENABLE_AUT_FEEDBACK:!0,SVC_EXTENDED:["VP9"]},Tb={MIN_FRAME_RATE:1,MAX_FRAME_RATE:30,MAX_THRESHOLD_FRAMERATE:30,BITRATE_MIN_THRESHOLD:100,BITRATE_MAX_THRESHOLD:100,MAX_SCALE:5,BWE_SCALE_UP_THRESHOLD:.6,BWE_SCALE_DOWN_THRESHOLD:.6,PERF_SCALE_UP_THRESHOLD:.7,PERF_SCALE_DOWN_THRESHOLD:.6,MOTION_RESOLUTION_FACTOR:.8,MOTION_BITRATE_FACTOR:.6,DETAIL_FRAMERATE_FACTOR:.8,DETAIL_BITRATE_FACTOR:.6,BALANCE_RESOLUTION_FACTOR:.9,BALANCE_FRAMERATE_FACTOR:.9,BALANCE_BITRATE_FACTOR:.6,OVERUSE_TIMES_THRESHOLD:10,UNDERUSE_TIMES_THRESHOLD:40},Rb="v4.24.0-0-gf2267710-dirty(7/31/2025, 7:00:42 PM)",wb={ENABLE_EVENT_REPORT:!0,UPLOAD_LOG:!1,ENABLE_AG_ADAPTATION:!0,FORCE_AG_HIGH_FRAMERATE:!1,FORCE_SUPPORT_AG_ADAPTATION:!1,ENCODER_CONFIG_LIMIT:{},CAMERA_CAPTURE_CONFIG:void 0,ENABLE_PRELOAD:!0,NEW_ICE_RESTART:!0,ICE_RESTART_INTERVAL:1e4,RESTART_SEQUENCE:["udp_tcp_relay","relay"],FIRST_TCP_CANDIDATE:!1,FIRST_TCP_CANDIDATE_INTERVAL:1e3,TURN_DOMAIN:"edge.agora.io",USE_TURN_IP:!0,NEW_TURN_MODE:4,NEW_FORCE_TURN:!1,USE_NEW_RENDER_FREEZE_TIME:!1,ENCODE_EXCEPTION_TIMES:5,ENABLE_ENCODE_EXCEPTION:!0,ENCODE_EXCEPTION_VALIDATE_CODEC:["h264"],VIDEO_ENCODER_CONFIG_LIST:[{width:240,height:180},{width:320,height:240},{width:400,height:300},{width:480,height:360},{width:560,height:420},{width:640,height:480}],DELETE_NEQ_AFTER_USER_LEAVE:!0},bn=we(we(we(we({},wb),{},{PROCESS_ID:"",ENCRYPT_AES:!0,AREAS:["CHINA","GLOBAL"],WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io","webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io","webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-web-2.ap.sd-rtn.com","cds-ap-web-3.agora.io","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-web-2.ap.sd-rtn.com","sua-ap-web-3.agora.io","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-ap-web-1.agora.io","uap-web-2.ap.sd-rtn.com","uap-ap-web-3.agora.io","uap-web-4.ap.sd-rtn.com"],LOG_UPLOAD_SERVER:"logservice.agora.io",EVENT_REPORT_DOMAIN:"statscollector-1.agora.io",EVENT_REPORT_BACKUP_DOMAIN:"web-2.statscollector.sd-rtn.com",GATEWAY_ADDRESS:[],GATEWAY_WSS_ADDRESS:"",LIVE_STREAMING_ADDRESS:"",HTTP_CONNECT_TIMEOUT:5e3,SIGNAL_REQUEST_TIMEOUT:1e4,REPORT_STATS:!0,NOT_REPORT_EVENT:[],PING_PONG_TIME_OUT:10,WEBSOCKET_TIMEOUT_MIN:1e4,EVENT_REPORT_SEND_INTERVAL:3e3,CONFIG_DISTRIBUTE_INTERVAL:3e5,ENABLE_CONFIG_DISTRIBUTE:!0,CANDIDATE_TIMEOUT:5e3,SHOW_REPORT_INVOKER_LOG:!1,SHOW_REPORT_USER_INVOKER_LOG:!0,JOIN_EXTEND:"",PUB_EXTEND:"",SUB_EXTEND:"",FORCE_TURN:!1,TURN_ENABLE_TCP:!0,TURN_ENABLE_UDP:!0,MAX_UPLOAD_CACHE:50,UPLOAD_CACHE_INTERVAL:2e3,AJAX_REQUEST_CONCURRENT:3,REPORT_APP_SCENARIO:void 0,GATEWAY_DOMAINS:["edge.agora.io","edge.sd-rtn.com"],CONNECT_GATEWAY_WITHOUT_DOMAIN:!1,WORKER_DOMAIN:"edge.agora.io",EVENT_REPORT_RETRY:!0,CHROME_FORCE_PLAN_B:!1,AUDIO_SOURCE_VOLUME_UPDATE_INTERVAL:400,AUDIO_SOURCE_AVG_VOLUME_DURATION:3e3,AUDIO_VOLUME_INDICATION_INTERVAL:2e3,VOLUME_VOICE_WEIGHT:10,GET_VOLUME_OF_MUTED_AUDIO_TRACK:!1,STATS_UPDATE_INTERVAL:250,NORMAL_EVENT_QUEUE_CAPACITY:100,CUSTOM_REPORT:!0,CUSTOM_REPORT_LIMIT:20,PROXY_SERVER_TYPE2:"webnginx-proxy.agora.io",PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com","webrtc-cloud-proxy.agora.io"],CUSTOM_PUB_ANSWER_MODIFIER:null,CUSTOM_SUB_ANSWER_MODIFIER:null,CUSTOM_PUB_OFFER_MODIFIER:null,CUSTOM_SUB_OFFER_MODIFIER:null,DSCP_TYPE:"high",REMOVE_NEW_CODECS:!0,FRAGEMENT_LENGTH:3,WEBSOCKET_COMPRESS:!1,SIMULCAST:!1,CHECK_VIDEO_VISIBLE_INTERVAL:3e4,CHECK_LOCAL_STATS_INTERVAL:250,PROFILE_SWITCH_INTERVAL:2e3,UNSUPPORTED_VIDEO_CODEC:[],ENUMERATE_DEVICES_INTERVAL:!1,ENUMERATE_DEVICES_INTERVAL_TIME:1e4,USE_NEW_TOKEN:!1,CLOSE_AFB_FOR_LOCAL_AP:!0,JOIN_MAX_CONCURRENCY:6,JOIN_WITH_FALLBACK_SIGNAL_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE:!1,JOIN_GATEWAY_TRY_443PORT_DURATION:2e3,JOIN_GATEWAY_USE_443PORT_ONLY:!1,JOIN_GATEWAY_USE_DUAL_DOMAIN:!0,JOIN_GATEWAY_FALLBACK_PORT:443,USE_TURN_SERVER_OF_GATEWAY:!1,H264_PROFILE_LEVEL_ID:"",USE_NEW_LOG:!1,LOG_VERSION:3,MEDIA_DEVICE_CONSTRAINTS:null,ENCRYPT_PROXY_USERNAME_AND_PSW:!0,SDP_LOGGING:!1,CSP_DETECTED_HOSTNAME_LIST:["agora.io","sd-rtn.com"],REMOTE_AUDIO_TRACK_USES_WEB_AUDIO:!1,LOCAL_AUDIO_TRACK_USES_WEB_AUDIO:!1,BITRATE_ADAPTER_TYPE:"STANDARD_BITRATE",AI_DENOISER_PARAMETERS:{excludedLinks:[]},ADJUST_3A_FROM_PLUGINS:!0,RAISE_H264_BASELINE_PRIORITY:!0,FILTER_SEND_H264_BASELINE:!1,FIRST_H264_PROFILE_LEVEL_ID:"42001f",FIRST_PACKETIZATION_MODE:"",X_GOOGLE_START_BITRATE:void 0,NEW_REPORT_SERVER:!1,NEW_REPORT_SERVER_DOMAINS:["data-reporting.agora.io","data-reporting.agora.io"],VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT:3e5,VIDEO_INSPECT_INTERVAL_MINIMUM:1e3,VIDEO_INSPECT_QUALITY_RATIO:.9,VIDEO_INSPECT_WORKER_MANAGER_HOST:"edge.agora.io",VIDEO_INSPECT_WORKER_MANAGER_PORT:"",VIDEO_INSPECT_WORKER_PORT:"",SHOW_VIDEO_INSPECT_WORKER_MESSAGE:!1,STATS_COLLECTOR_PORT:443,FORCE_TURN_TCP:!1,WEBAUDIO_INIT_OPTIONS:void 0,FILTER_VIDEO_FEC:!0,FILTER_AUDIO_FEC:!1,CHROME_DUAL_STREAM_USE_ENCODING:!0,DISABLE_DUAL_STREAM_USE_ENCODING:!1,EXTENSION_USAGE_UPLOAD_INTERVAL:1e4,ICE_RESTART:!0,FINGERPRINT:null,ENABLE_VIDEO_FRAME_CALLBACK:!0,VIDEO_FREEZE_DURATION:500,SPATIALIZER_PARAMETERS:{},UPLOAD_LOG_INTERVAL:3e3,UPLOAD_LOG_REQUEST_RETRY_INTERVAL:2e3,UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL:2e4,UPLOAD_LOG_TRY_INTERVAL_WHILE_OFF:5e3,UPLOAD_LOG_RETRY_INTERVAL_V1:1e4,UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1:200,UPLOAD_LOG_LENGTH_EACH_TIME:10,APP_TYPE:0,DISABLE_WEBAUDIO:!1,CHANNEL_MEDIA_RELAY_SERVERS:void 0,KEEP_LAST_FRAME:!0,FORWARD_P2P_CREATION:!0,SYNC_GROUP:!0,BLOCK_LOCAL_CLIENT:!1,ENABLE_AUDIO_TOPN:!1,ENABLE_AUDIO_METADATA:!1,ENABLE_AUDIO_PTS:!1,TOPN_SMOOTH_LEVEL:void 0,TOPN_NEW_SPEAKER_DELAY:void 0,TOPN_SWITCH_HOLD_MS:void 0,TOPN_AUDIO_GAIN:void 0,TOPN_SILENCE_THRESHOLD:250,AP_AREA:!0,ENABLE_ENCODED_TRANSFORM:!1,ENABLE_VIDEO_SEI:!1,IMAGE_MODERATION_WORKER_HOST:"edge.agora.io",IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT:3e5,IMAGE_MODERATION_INTERVAL_MINIMUM:1e3,SHOW_IMAGE_MODERATION_WORKER_MESSAGE:!1,IMAGE_MODERATION_QUALITY_RATIO:.9,IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL:5e3,SHOW_GLOBAL_CLIENT_LIST:!1,DATASTREAM_MAX_RETRANSMITS:10,TCP_CANDIDATE_ONLY:!1,EXTERNAL_SIGNAL_REQUEST_TIMEOUT:3e3,SHOW_P2P_LOG:!1,MAX_P2P_TIMEOUT:3e4,P2P_TOKEN_INTERVAL:1e3,SHOW_DATASTREAM2_LOG:!1,RESTRICTION_SET_PLAYBACK_DEVICE:!0,USE_PURE_ENCRYPTION_MASTER_KEY:!1,ENABLE_AUDIO_RED:!1,OPUS_PTIME:void 0,AUDIO_DUPLICATE_NUM:void 0,ENABLE_ABSSENDTIME_AS_SENTTS:!0,ACCOUNT_REGISTER_RETRY_TIMEOUT:1,ACCOUNT_REGISTER_RETRY_RATIO:2,ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX:6e4,ACCOUNT_REGISTER_RETRY_COUNT_MAX:1e5,AUDIO_CONTEXT:null,WEBCS_BACKUP_CONNECT_TIMEOUT:6e3,PLAYER_STATE_DEFER:2e3,SIGNAL_REQUEST_WATCH_INTERVAL:1e3,FILEPATH_LENMAX:255,DUALSTREAM_OPERATION_CHECK:!0,MEDIA_ELEMENT_EXISTS_DEPTH:3,SHIM_CANDIDATE:!1,LEAVE_MSG_TIMEOUT:2e3,STATS_FILTER:{transportId:!0,googTrackId:!0},FILTER_VIDEO_CODEC:[],UNSUPPORTED_VIDEO_UPLINK_CODEC:[],UNSUPPORTED_VIDEO_DOWNLINK_CODEC:[],USE_NEW_NETWORK_CONFIG:!1,AUTO_RESET_AUDIO_ROUTE:!1,PLUGIN_INFO:[],OVERUSE_DETECTOR_PARAMS:Tb,CUSTOM_ADAPTATION_DEFAULT_MODE:"",HIDE_NO_POSTER:!1,AP_CACHE_NUM:10,AP_UPDATE_INTERVAL:12e4,AP_CACHE_LIFETIME:12e4,MAX_PRELOAD_ASYNC_LENGTH:3,DISABLE_SCREEN_SHARE_REMB:!1},XS),{},{USE_CANDIDATE_FROM_AP_DETAIL:!1,AP_REQUEST_DETAIL:void 0,ENABLE_ROLE_SELECT_EDGE:!1,CLIENT_ROLE_OPTIONS:void 0,COMPATIBLE_SDP_EXTENSION:["gdpr_forbidden"],LIMIT_BITRATE:void 0,EXPERIMENTS:{},USE_PUB_RTX:!0,USE_SUB_RTX:!0,ENABLE_DATASTREAM_2:!1,USE_XR:!0,ENABLE_PREALLOC_PC:!1,ENABLE_PRE_SUB:!1,ENABLE_SVC:!1,ENABLE_PRE_RENDER:!1,FORCE_DISABLE_AUTO_SUB:!1,ENABLE_PRE_SUB_WITH_PRE_PC:!1,PRE_USE_LOCAL_CODECS:!0},{INSTALL_ID:""}),{},{K_MIN_RENDER_DELAY:66,USE_STANDARD_BITRATE_DEFAULT:!1,VIDEO_NEW_BITRATE_RATIO:void 0,VIDEO_STANDARD_BITRATE_VERSION:2,BASELINE_MORE_H264_BITRATE_RATIO:1.1});function sn(e,t,n){var r,i,s;be(r=Object.keys(bn)).call(r,e)&&(!n&&be(i=Object.keys(ba)).call(i,e)||(bn[e]=t,e!=="ENABLE_VIDEO_SEI"&&e!=="ENABLE_AUDIO_TOPN"&&e!=="ENABLE_AUDIO_METADATA"&&e!=="ENABLE_AUDIO_PTS"||t!==!0||(bn.ENABLE_ENCODED_TRANSFORM=!0),e==="USE_NEW_NETWORK_CONFIG"&&t&&(s=!!t,bn.USE_NEW_NETWORK_CONFIG=s,s&&(bn.WEBCS_DOMAIN=["webrtc2-2.ap.sd-rtn.com"],bn.WEBCS_DOMAIN_BACKUP_LIST=["webrtc2-4.ap.sd-rtn.com"],bn.CDS_AP=["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],bn.ACCOUNT_REGISTER=["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],bn.EVENT_REPORT_DOMAIN="web-2.statscollector.sd-rtn.com",bn.EVENT_REPORT_BACKUP_DOMAIN="statscollector-1.agora.io",bn.GATEWAY_DOMAINS=["edge.sd-rtn.com"])),e==="ENABLE_PRE_SUB"&&t&&(bn.ENABLE_INSTANT_VIDEO=!0,bn.ENABLE_PREALLOC_PC=!0),e==="ENABLE_SVC"&&t&&(bn.ENABLE_AUT_CC=!0),e==="NEW_FORCE_TURN"&&t&&(bn.NEW_TURN_MODE||(bn.NEW_TURN_MODE=4))))}function B(e){return bn[e]}Sb||(bn.WEBCS_DOMAIN=["ap-web-1-oversea.agora.io","ap-web-1-north-america.agora.io"],bn.WEBCS_DOMAIN_BACKUP_LIST=["ap-web-2-oversea.agora.io","ap-web-2-north-america.agora.io"],bn.PROXY_CS=["proxy-ap-web-oversea.agora.io","proxy-ap-web-america.agora.io"],bn.CDS_AP=["cds-ap-web-oversea.agora.io","cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],bn.ACCOUNT_REGISTER=["sua-ap-web-oversea.agora.io","sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],bn.UAP_AP=["uap-ap-web-oversea.agora.io","uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],bn.LOG_UPLOAD_SERVER="logservice-oversea.agora.io",bn.EVENT_REPORT_DOMAIN="statscollector-1-oversea.agora.io",bn.EVENT_REPORT_BACKUP_DOMAIN="statscollector-2-oversea.agora.io",bn.PROXY_SERVER_TYPE3="webrtc-cloud-proxy.agora.io",bn.AREAS=["NORTH_AMERICA","OVERSEA"]);let y1=(function(e){return e[e.REALTIME=1]="REALTIME",e})({});const ba={};var dt=(function(e){return e.SET_SESSION_ID="SET_SESSION_ID",e.SET_P2P_ID="SET_P2P_id",e.SET_DC_ID="SET_DC_id",e.SET_UID="SET_UID",e.SET_INT_UID="SET_INT_UID",e.SET_PUB_ID="SET_PUB_ID",e.SET_CLOUD_PROXY_SERVER_MODE="SET_CLOUD_PROXY_SERVER_MODE",e.KEY_METRIC_CLIENT_CREATED="KEY_METRIC_CLIENT_CREATED",e.KEY_METRIC_JOIN_START="KEY_METRIC_JOIN_START",e.KEY_METRIC_PRELOAD_START="KEY_METRIC_PRELOAD_START",e.KEY_METRIC_PRELOAD_END="KEY_METRIC_PRELOAD_END",e.KEY_METRIC_JOIN_END="KEY_METRIC_JOIN_END",e.KEY_METRIC_REQUEST_AP_START="KEY_METRIC_REQUEST_AP_START",e.KEY_METRIC_REQUEST_AP_END="KEY_METRIC_REQUEST_AP_END",e.KEY_METRIC_REQUEST_SUA_END="KEY_METRIC_REQUEST_SUA_END",e.KEY_METRIC_BEFORE_CONNECT="KEY_METRIC_BEFORE_CONNECT",e.KEY_METRIC_PEER_RECEIVER="KEY_METRIC_PEER_RECEIVER",e.KEY_METRIC_SIGNAL_CONNECTED="KEY_METRIC_SIGNAL_CONNECTED",e.KEY_METRIC_JOIN_REQ="KEY_METRIC_JOIN_REQ",e.KEY_METRIC_JOIN_REP="KEY_METRIC_JOIN_REP",e.KEY_METRIC_JOIN_GATEWAY_START="KEY_METRIC_JOIN_GATEWAY_START",e.KEY_METRIC_JOIN_GATEWAY_END="KEY_METRIC_JOIN_GATEWAY_END",e.KEY_METRIC_PEER_CONNECTION_START="KEY_METRIC_PEER_CONNECTION_START",e.KEY_METRIC_PEER_CONNECTION_END="KEY_METRIC_PEER_CONNECTION_END",e.KEY_METRIC_FIRST_VIDEO_FRAME_DECODED="KEY_METRIC_FIRST_VIDEO_FRAME_DECODED",e.KEY_METRIC_DESCRIPTION_START="KEY_METRIC_DESCRIPTION_START",e.KEY_METRIC_ICE_CONNECTION_END="KEY_METRIC_ICE_CONNECTION_END",e.KEY_METRIC_SIGNAL_CHANNEL_OPEN="KEY_METRIC_SIGNAL_CHANNEL_OPEN",e.KEY_METRIC_PUBLISH="KEY_METRIC_PUBLISH",e.KEY_METRIC_SUBSCRIBE="KEY_METRIC_SUBSCRIBE",e.RECORD_JOIN_CHANNEL_SERVICE="RECORD_JOIN_CHANNEL_SERVICE",e.RESET_JOIN_CHANNEL_SERVICE_RECORDS="RESET_JOIN_CHANNEL_SERVICE_RECORDS",e.RESET_KEY_METRICS="RESET_KEY_METRICS",e.RESET_FIRST_VIDEO_FRAME_DECODED="RESET_FIRST_VIDEO_FRAME_DECODED",e.SET_USE_P2P="SET_USE_P2P",e.SET_TRANSPORT_TYPE="SET_TRANSPORT_TYPE",e})(dt||{});let eE=(function(e){return e.h264="h264",e.h265="h265",e.vp8="vp8",e.vp9="vp9",e.av1="av1",e})({});(function(e){e.opus="opus",e.pcma="pcma",e.pcmu="pcmu",e.g722="g722"})({});const S1=128,KY=96,T1=1e3,Vf=10;let zY=0;var R1=(()=>{var e={8:(r,i,s)=>{s.r(i),s.d(i,{Parser:()=>ge,Printer:()=>Qt,parse:()=>Ae,print:()=>je});const o=`
`,c="".concat("\r").concat(o),d=" ";let h;function f(Ee){return Ee>="0"&&Ee<="9"}function g(Ee){return Ee>="!"&&Ee<="~"}function E(Ee){return g(Ee)||Ee>=""&&Ee<="ÿ"}function S(Ee){return Ee==="!"||Ee>="#"&&Ee<="'"||Ee>="*"&&Ee<="+"||Ee>="-"&&Ee<="."||Ee>="0"&&Ee<="9"||Ee>="A"&&Ee<="Z"||Ee>="^"&&Ee<="~"}function O(Ee){return Ee>="1"&&Ee<="9"}function A(Ee){return Ee>="A"&&Ee<="Z"||Ee>="a"&&Ee<="z"}function N(Ee){return Ee==="d"||Ee==="h"||Ee==="m"||Ee==="s"}function j(Ee){return Ee>""&&Ee<"	"||Ee>"\v"&&Ee<"\f"||Ee>""&&Ee<"ÿ"}function U(Ee){return A(Ee)||f(Ee)||Ee==="+"||Ee==="/"}function W(Ee){return f(Ee)||A(Ee)||Ee==="+"||Ee==="/"||Ee==="-"||Ee==="_"}function $(Ee){return A(Ee)||f(Ee)||Ee==="+"||Ee==="/"}function Z(Ee,b){var z=Object.keys(Ee);if(Object.getOwnPropertySymbols){var Q=Object.getOwnPropertySymbols(Ee);b&&(Q=Q.filter((function(Ce){return Object.getOwnPropertyDescriptor(Ee,Ce).enumerable}))),z.push.apply(z,Q)}return z}function Y(Ee){for(var b=1;b<arguments.length;b++){var z=arguments[b]!=null?arguments[b]:{};b%2?Z(Object(z),!0).forEach((function(Q){ie(Ee,Q,z[Q])})):Object.getOwnPropertyDescriptors?Object.defineProperties(Ee,Object.getOwnPropertyDescriptors(z)):Z(Object(z)).forEach((function(Q){Object.defineProperty(Ee,Q,Object.getOwnPropertyDescriptor(z,Q))}))}return Ee}function ie(Ee,b,z){return b in Ee?Object.defineProperty(Ee,b,{value:z,enumerable:!0,configurable:!0,writable:!0}):Ee[b]=z,Ee}(function(Ee){Ee.VERSION="v",Ee.ORIGIN="o",Ee.SESSION_NAME="s",Ee.INFORMATION="i",Ee.URI="u",Ee.EMAIL="e",Ee.PHONE="p",Ee.CONNECTION="c",Ee.BANDWIDTH="b",Ee.TIME="t",Ee.REPEAT="r",Ee.ZONE_ADJUSTMENTS="z",Ee.KEY="k",Ee.ATTRIBUTE="a",Ee.MEDIA="m"})(h||(h={}));class ue{consumeText(b,z){let Q=z;for(;Q<b.length;){const Ce=b[Q];if(Ce==="\0"||Ce==="\r"||Ce===o)break;Q+=1}if(Q-z==0)throw new Error("Invalid text, at ".concat(b));return Q}consumeUnicastAddress(b,z,Q){return this.consumeTill(b,z,d)}consumeOneOrMore(b,z,Q){let Ce=z;for(;Q(b[Ce]);)Ce++;if(Ce-z==0)throw new Error("Invalid rule at ".concat(z,"."));return Ce}consumeSpace(b,z){if(b[z]===d)return z+1;throw new Error("Invalid space at ".concat(z,"."))}consumeIP4Address(b,z){let Q=z;for(let Ce=0;Ce<4;Ce++)if(Q=this.consumeDecimalUChar(b,Q),Ce!==3){if(b[Q]!==".")throw new Error("Invalid IP4 address.");Q++}return Q}consumeDecimalUChar(b,z){let Q=z;for(let mt=0;mt<3&&f(b[Q]);mt++,Q++);if(Q-z==0)throw new Error("Invalid decimal uchar.");const Ce=parseInt(b.slice(z,Q));if(Ce>=0&&Ce<=255)return Q;throw new Error("Invalid decimal uchar")}consumeIP6Address(b,z){let Q=this.consumeHexpart(b,z);return b[Q]===":"&&(Q+=1,Q=this.consumeIP4Address(b,Q)),Q}consumeHexpart(b,z){let Q=z;if(b[Q]===":"&&b[Q+1]===":"){Q+=2;try{Q=this.consumeHexseq(b,Q)}catch{}return Q}if(Q=this.consumeHexseq(b,Q),b[Q]===":"&&b[Q+1]===":"){Q+=2;try{Q=this.consumeHexseq(b,Q)}catch{}return Q}return Q}consumeHexseq(b,z){let Q=z;for(;Q=this.consumeHex4(b,Q),b[Q]===":"&&b[Q+1]!==":";)Q+=1;return Q}consumeHex4(b,z){let Q=0;for(;Q<4;Q++)if(!((Ce=b[z+Q])>="0"&&Ce<="9"||Ce>="a"&&Ce<="f"||Ce>="A"&&Ce<="F")){if(Q===0)throw new Error("Invalid hex 4");break}var Ce;return z+Q}consumeFQDN(b,z){let Q=z;for(;f(b[Q])||A(b[Q])||b[Q]==="-"||b[Q]===".";)Q+=1;if(Q-z<4)throw new Error("Invalid FQDN");return Q}consumeExtnAddr(b,z){return this.consumeOneOrMore(b,z,E)}consumeMulticastAddress(b,z,Q){switch(Q){case"IP4":case"ip4":return this.consumeIP4MulticastAddress(b,z);case"IP6":case"ip6":return this.consumeIP6MulticastAddress(b,z);default:try{return this.consumeFQDN(b,z)}catch{return this.consumeExtnAddr(b,z)}}}consumeIP6MulticastAddress(b,z){const Q=this.consumeHexpart(b,z);return b[Q]==="/"?this.consumeInteger(b,Q+1):Q}consumeIP4MulticastAddress(b,z){let Q=z+3;const Ce=b.slice(z,Q),mt=parseInt(Ce);if(mt<224||mt>239)throw new Error("Invalid IP4 multicast address, IPv4 multicast addresses may be in the range 224.0.0.0 to 239.255.255.255.");for(let _n=0;_n<3;_n++){if(b[Q]!==".")throw new Error("Invalid IP4 multicast address.");Q+=1,Q=this.consumeDecimalUChar(b,Q)}return b[Q]==="/"&&(Q+=1),Q=this.consumeTTL(b,Q),b[Q]==="/"&&(Q=this.consumeInteger(b,Q)),Q}consumeInteger(b,z){if(!O(b[z]))throw new Error("Invalid integer.");for(z+=1;f(b[z]);)z+=1;return z}consumeTTL(b,z){if(b[z]==="0")return z+1;if(!O(b[z]))throw new Error("Invalid TTL.");z+=1;for(let Q=0;Q<2&&f(b[z]);Q++)z+=1;return z}consumeToken(b,z){return this.consumeOneOrMore(b,z,S)}consumeTime(b,z){let Q=z;if(b[Q]==="0")return Q+1;for(O(b[Q])&&(Q+=1);f(b[Q]);)Q++;if(Q-z<10)throw new Error("Invalid time");return Q}consumeAddress(b,z){return this.consumeTill(b,z,d)}consumeTypedTime(b,z){let Q=z;return Q=this.consumeOneOrMore(b,Q,f),N(b[Q])?Q+1:Q}consumeRepeatInterval(b,z){if(!O(b[z]))throw new Error("Invalid repeat interval");for(z+=1;f(b[z]);)z+=1;return N(b[z])&&(z+=1),z}consumePort(b,z){return this.consumeOneOrMore(b,z,f)}consume(b,z,Q){for(let Ce=0;Ce<Q.length;Ce++){if(z+Ce>=b.length)throw new Error("consume exceeding value length");if(b[z+Ce]!==Q[Ce])throw new Error("consume ".concat(Q," failed at ").concat(Ce))}return z+Q.length}consumeTill(b,z,Q){let Ce=z;for(;Ce<b.length&&(typeof Q!="string"||b[Ce]!==Q)&&(typeof Q!="function"||!Q(b[Ce]));)Ce++;return Ce}}class ge extends ue{constructor(){super(),ie(this,"records",[]),ie(this,"currentLine",0)}parse(b){const z=this.probeEOL(b);this.records=b.split(z).filter((Nl=>!!fi(Nl).call(Nl))).map(this.parseLine),this.currentLine=0;const Q=this.parseVersion(),Ce=this.parseOrigin(),mt=this.parseSessionName(),_n=this.parseInformation(),dr=this.parseUri(),po=this.parseEmail(),Zo=this.parsePhone(),jE=this.parseConnection(),Hh=this.parseBandWidth(),gm=this.parseTimeFields(),lR=this.parseKey(),dR=this.parseSessionAttribute(),fo=this.parseMediaDescription();if(this.currentLine!==this.records.length)throw new Error("parsing failed, non exhaustive sdp lines.");return{version:Q,origin:Ce,sessionName:mt,information:_n,uri:dr,emails:po,phones:Zo,connection:jE,bandwidths:Hh,timeFields:gm,key:lR,attributes:dR,mediaDescriptions:fo}}getCurrentRecord(){const b=this.records[this.currentLine];if(!b)throw new Error("Record doesn't exit.");return b}probeEOL(b){for(let z=0;z<b.length;z++)if(b[z]===o)return b[z-1]==="\r"?c:o;throw new Error("Invalid newline character.")}parseLine(b,z){if(b.length<2)throw new Error("Invalid sdp line, sdp line should be of form <type>=<value>.");const Q=b[0];if(b[1]!=="=")throw new Error('Invalid sdp line, <type> should be a single character followed by an "=" sign.');return{type:Q,value:b.slice(2),line:z,cur:0}}parseSessionAttribute(){const b=new St;for(;this.currentLine<this.records.length;){const z=this.getCurrentRecord();if(z.type!==h.ATTRIBUTE)break;const Q={attField:this.extractOneOrMore(z,(Ce=>S(Ce)&&Ce!==":")),_cur:0};z.value[z.cur]===":"&&(z.cur+=1,Q.attValue=this.extractOneOrMore(z,j)),b.parse(Q),this.currentLine++}return b.digest()}parseMediaAttributes(b){const z=new Ct(b);for(;this.currentLine<this.records.length;){const Q=this.getCurrentRecord();if(Q.type!==h.ATTRIBUTE)break;const Ce={attField:this.extractOneOrMore(Q,(mt=>S(mt)&&mt!==":")),_cur:0};Q.value[Q.cur]===":"&&(Q.cur+=1,Ce.attValue=this.extractOneOrMore(Q,j)),z.parse(Ce),this.currentLine++}return z.digest()}parseKey(){const b=this.getCurrentRecord();if(b.type===h.KEY){if(b.value==="prompt"||b.value==="clear:"||b.value==="base64:"||b.value==="uri:")return b.value;throw this.currentLine++,new Error("Invalid key.")}}parseZone(){const b=this.getCurrentRecord();if(b.type===h.ZONE_ADJUSTMENTS){const z=[];for(;;)try{const Q=this.extract(b,this.consumeTime);this.consumeSpaceForRecord(b);let Ce=!1;b.value[b.cur]==="-"&&(Ce=!0,b.cur+=1);const mt=this.extract(b,this.consumeTypedTime);z.push({time:Q,typedTime:mt,back:Ce})}catch{break}if(z.length===0)throw new Error("Invalid zone adjustments");return this.currentLine++,z}return[]}parseRepeat(){const b=[];for(;;){const z=this.getCurrentRecord();if(z.type!==h.REPEAT)break;{const Q=this.extract(z,this.consumeRepeatInterval),Ce=this.parseTypedTime(z);b.push({repeatInterval:Q,typedTimes:Ce}),this.currentLine++}}return b}parseTypedTime(b){const z=[];for(;;)try{this.consumeSpaceForRecord(b),z.push(this.extract(b,this.consumeTypedTime))}catch{break}if(z.length===0)throw new Error("Invalid typed time.");return z}parseTime(){const b=this.getCurrentRecord(),z=this.extract(b,this.consumeTime);this.consumeSpaceForRecord(b);const Q=this.extract(b,this.consumeTime);return this.currentLine++,{startTime:z,stopTime:Q}}parseBandWidth(){const b=[];for(;this.currentLine<this.records.length;){const z=this.getCurrentRecord();if(z.type!==h.BANDWIDTH)break;{const Q=this.extractOneOrMore(z,S);if(z.value[z.cur]!==":")throw new Error("Invalid bandwidth field.");z.cur++;const Ce=this.extractOneOrMore(z,f);b.push({bwtype:Q,bandwidth:Ce}),this.currentLine++}}return b}parseVersion(){const b=this.getCurrentRecord();if(b.type!==h.VERSION)throw new Error("first sdp record must be version");const z=b.value.slice(0,this.consumeOneOrMore(b.value,0,f));if(z.length!==b.value.length)throw new Error('invalid proto version, "v='.concat(b.value,'"'));return this.currentLine++,z}parseOrigin(){const b=this.getCurrentRecord();if(b.type!==h.ORIGIN)throw new Error("second line of sdp must be origin");const z=this.extractOneOrMore(b,E);this.consumeSpaceForRecord(b);const Q=this.extractOneOrMore(b,f);this.consumeSpaceForRecord(b);const Ce=this.extractOneOrMore(b,f);this.consumeSpaceForRecord(b);const mt=this.extractOneOrMore(b,S);this.consumeSpaceForRecord(b);const _n=this.extractOneOrMore(b,S);this.consumeSpaceForRecord(b);const dr=this.extract(b,this.consumeUnicastAddress);return this.currentLine++,{username:z,sessId:Q,sessVersion:Ce,nettype:mt,addrtype:_n,unicastAddress:dr}}parseSessionName(){const b=this.getCurrentRecord();if(b.type===h.SESSION_NAME){const z=this.extract(b,this.consumeText);return this.currentLine++,z}}parseInformation(){const b=this.getCurrentRecord();if(b.type!==h.INFORMATION)return;const z=this.extract(b,this.consumeText);return this.currentLine++,z}parseUri(){const b=this.getCurrentRecord();if(b.type===h.URI)return this.currentLine++,b.value}parseEmail(){const b=[];for(;;){const z=this.getCurrentRecord();if(z.type!==h.EMAIL)break;b.push(z.value),this.currentLine++}return b}parsePhone(){const b=[];for(;;){const z=this.getCurrentRecord();if(z.type!==h.PHONE)break;b.push(z.value),this.currentLine++}return b}parseConnection(){const b=this.getCurrentRecord();if(b.type===h.CONNECTION){const z=this.extractOneOrMore(b,S);this.consumeSpaceForRecord(b);const Q=this.extractOneOrMore(b,S);this.consumeSpaceForRecord(b);const Ce=this.extract(b,this.consumeAddress);return this.currentLine++,{nettype:z,addrtype:Q,address:Ce}}}parseMedia(){const b=this.getCurrentRecord(),z=this.extract(b,this.consumeToken);this.consumeSpaceForRecord(b);let Q=this.extract(b,this.consumePort);b.value[b.cur]==="/"&&(b.cur+=1,Q+=this.extract(b,this.consumeInteger)),this.consumeSpaceForRecord(b);const Ce=[];for(Ce.push(this.extract(b,this.consumeToken));b.value[b.cur]==="/";)b.cur+=1,Ce.push(this.extract(b,this.consumeToken));if(Ce.length===0)throw new Error("Invalid proto");const mt=this.parseFmt(b);return this.currentLine++,{mediaType:z,port:Q,protos:Ce,fmts:mt}}parseTimeFields(){const b=[];for(;this.getCurrentRecord().type===h.TIME;){const z=this.parseTime(),Q=this.parseRepeat(),Ce=this.parseZone();b.push({time:z,repeats:Q,zones:Ce})}return b}parseMediaDescription(){const b=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===h.MEDIA;){const z=this.parseMedia(),Q=this.parseInformation(),Ce=this.parseConnections(),mt=this.parseBandWidth(),_n=this.parseKey(),dr=this.parseMediaAttributes(z);b.push({media:z,information:Q,connections:Ce,bandwidths:mt,key:_n,attributes:dr})}return b}parseConnections(){const b=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===h.CONNECTION;)b.push(this.parseConnection());return b}parseFmt(b){const z=[];for(;;)try{this.consumeSpaceForRecord(b),z.push(this.extract(b,this.consumeToken))}catch{break}if(z.length===0)throw new Error("Invalid fmts");return z}extract(b,z){for(var Q=arguments.length,Ce=new Array(Q>2?Q-2:0),mt=2;mt<Q;mt++)Ce[mt-2]=arguments[mt];const _n=z.call(this,b.value,b.cur,...Ce),dr=b.value.slice(b.cur,_n);return b.cur=_n,dr}extractOneOrMore(b,z){const Q=this.consumeOneOrMore(b.value,b.cur,z),Ce=b.value.slice(b.cur,Q);return b.cur=Q,Ce}consumeSpaceForRecord(b){if(b.value[b.cur]!==d)throw new Error("Invalid space at ".concat(b.cur,"."));b.cur+=1}}class Re extends ue{constructor(){super(...arguments),ie(this,"attributes",void 0),ie(this,"digested",!1)}extractOneOrMore(b,z,Q){const Ce=this.consumeOneOrMore(b.attValue,b._cur,z),mt=b.attValue.slice(b._cur,Ce),[_n,dr]=Q||[];if(typeof _n=="number"&&mt.length<_n)throw new Error("error in length, should be more or equal than ".concat(_n," characters."));if(typeof dr=="number"&&mt.length>dr)throw new Error("error in length, should be less or equal than ".concat(dr," characters."));return b._cur=Ce,mt}consumeAttributeSpace(b){if(b.attValue[b._cur]!==d)throw new Error("Invalid space at ".concat(b._cur,"."));b._cur+=1}extract(b,z){if(!b.attValue)throw new Error("Nothing to extract from attValue.");for(var Q=arguments.length,Ce=new Array(Q>2?Q-2:0),mt=2;mt<Q;mt++)Ce[mt-2]=arguments[mt];const _n=z.call(this,b.attValue,b._cur,...Ce),dr=b.attValue.slice(b._cur,_n);return b._cur=_n,dr}atEnd(b){if(!b.attValue)throw new Error;return b._cur>=b.attValue.length}peekChar(b){if(!b.attValue)throw new Error;return b.attValue[b._cur]}peek(b,z){if(!b.attValue)throw new Error;for(let Q=0;Q<z.length;Q++)if(z[Q]!==b.attValue[b._cur+Q])return!1;return!0}parseIceUfrag(b){if(this.attributes.iceUfrag)throw new Error("Invalid ice-ufrag, should be only a single line if 'a=ice-ufrag'");this.attributes.iceUfrag=this.extractOneOrMore(b,U,[4,256])}parseIcePwd(b){if(this.attributes.icePwd)throw new Error("Invalid ice-pwd, should be only a single line if 'a=ice-pwd'");this.attributes.icePwd=this.extractOneOrMore(b,U,[22,256])}parseIceOptions(b){if(this.attributes.iceOptions)throw new Error("Invalid ice-options, should be only one 'ice-options' line");const z=[];for(;!this.atEnd(b);){z.push(this.extractOneOrMore(b,U));try{this.consumeAttributeSpace(b)}catch(Q){if(this.atEnd(b))break;throw Q}}this.attributes.iceOptions=z}parseFingerprint(b){const z=this.extract(b,this.consumeToken);this.consumeAttributeSpace(b);const Q=this.extract(b,this.consumeTill);this.attributes.fingerprints.push({hashFunction:z,fingerprint:Q})}parseExtmap(b){const z=this.extractOneOrMore(b,f);let Q;this.peekChar(b)==="/"&&(this.extract(b,this.consume,"/"),Q=this.extract(b,this.consumeToken)),this.consumeAttributeSpace(b);const Ce=this.extract(b,this.consumeTill,d),mt=Y(Y({entry:parseInt(z,10)},Q&&{direction:Q}),{},{extensionName:Ce});this.peekChar(b)===d&&(this.consumeAttributeSpace(b),mt.extensionAttributes=this.extract(b,this.consumeTill)),this.attributes.extmaps.push(mt)}parseSetup(b){if(this.attributes.setup)throw new Error("must only be one single 'a=setup' line.");const z=this.extract(b,this.consumeTill);if(z!=="active"&&z!=="passive"&&z!=="actpass"&&z!=="holdconn")throw new Error("role must be one of 'active', 'passive', 'actpass', 'holdconn'.");this.attributes.setup=z}}class St extends Re{constructor(){super(...arguments),ie(this,"attributes",{unrecognized:[],groups:[],extmaps:[],fingerprints:[],identities:[]})}parse(b){if(this.digested)throw new Error("already digested");try{switch(b.attField){case"group":this.parseGroup(b);break;case"ice-lite":this.parseIceLite();break;case"ice-ufrag":this.parseIceUfrag(b);break;case"ice-pwd":this.parseIcePwd(b);break;case"ice-options":this.parseIceOptions(b);break;case"fingerprint":this.parseFingerprint(b);break;case"setup":this.parseSetup(b);break;case"tls-id":this.parseTlsId(b);break;case"identity":this.parseIdentity(b);break;case"extmap":this.parseExtmap(b);break;case"msid-semantic":this.parseMsidSemantic(b);break;default:b.ignored=!0,this.attributes.unrecognized.push(b)}}catch(z){throw console.error("parsing session attribute ".concat(b.attField,' error, "a=').concat(b.attField,":").concat(b.attValue,'"')),z}if(!b.ignored&&b.attValue&&!this.atEnd(b))throw new Error("attribute parsing error")}digest(){return this.digested=!0,this.attributes}parseGroup(b){const z=this.extract(b,this.consumeToken),Q=[];for(;!this.atEnd(b)&&this.peekChar(b)===d;)this.consumeAttributeSpace(b),Q.push(this.extract(b,this.consumeToken));this.attributes.groups.push({semantic:z,identificationTag:Q})}parseIceLite(){if(this.attributes.iceLite)throw new Error("Invalid ice-lite, should be only a single line of 'a=ice-lite'");this.attributes.iceLite=!0}parseTlsId(b){if(this.attributes.tlsId)throw new Error("must be only one tld-id line");this.attributes.tlsId=this.extractOneOrMore(b,W)}parseIdentity(b){const z=this.extractOneOrMore(b,$),Q=[];for(;!this.atEnd(b)&&this.peekChar(b)===d;){this.consumeAttributeSpace(b);const Ce=this.extract(b,this.consumeToken);this.extract(b,this.consume,"=");const mt=this.extractOneOrMore(b,(_n=>_n!==d&&j(_n)));Q.push({name:Ce,value:mt})}this.attributes.identities.push({assertionValue:z,extensions:Q})}parseMsidSemantic(b){this.peekChar(b)===d&&this.consumeAttributeSpace(b);const z={semantic:this.extract(b,this.consumeToken),identifierList:[]};for(;;){try{this.consumeAttributeSpace(b)}catch{break}if(this.peekChar(b)==="*"){this.extract(b,this.consume,"*"),z.applyForAll=!0;break}{const Q=this.extract(b,this.consumeTill,d);z.identifierList.push(Q)}}this.attributes.msidSemantic=z}}class Ct extends Re{constructor(b){super(),ie(this,"attributes",void 0),b.protos.indexOf("RTP")!==-1||b.protos.indexOf("rtp"),this.attributes={unrecognized:[],candidates:[],extmaps:[],fingerprints:[],imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[]}}parse(b){if(this.digested)throw new Error("already digested");try{switch(b.attField){case"extmap":this.parseExtmap(b);break;case"setup":this.parseSetup(b);break;case"ice-ufrag":this.parseIceUfrag(b);break;case"ice-pwd":this.parseIcePwd(b);break;case"ice-options":this.parseIceOptions(b);break;case"candidate":this.parseCandidate(b);break;case"remote-candidate":this.parseRemoteCandidate(b);break;case"end-of-candidates":this.parseEndOfCandidates();break;case"fingerprint":this.parseFingerprint(b);break;case"rtpmap":this.parseRtpmap(b);break;case"ptime":this.parsePtime(b);break;case"maxptime":this.parseMaxPtime(b);break;case"sendrecv":case"recvonly":case"sendonly":case"inactive":this.parseDirection(b);break;case"ssrc":this.parseSSRC(b);break;case"fmtp":this.parseFmtp(b);break;case"rtcp-fb":this.parseRtcpFb(b);break;case"rtcp-mux":this.parseRTCPMux();break;case"rtcp-mux-only":this.parseRTCPMuxOnly();break;case"rtcp-rsize":this.parseRTCPRsize();break;case"rtcp":this.parseRTCP(b);break;case"mid":this.parseMid(b);break;case"msid":this.parseMsid(b);break;case"imageattr":this.parseImageAttr(b);break;case"rid":this.parseRid(b);break;case"simulcast":this.parseSimulcast(b);break;case"sctp-port":this.parseSctpPort(b);break;case"max-message-size":this.parseMaxMessageSize(b);break;case"ssrc-group":this.parseSSRCGroup(b);break;default:b.ignored=!0,this.attributes.unrecognized.push(b)}}catch(z){throw console.error("parsing media attribute ".concat(b.attField,' error, "a=').concat(b.attField,":").concat(b.attValue,'"')),z}if(!b.ignored&&b.attValue&&!this.atEnd(b))throw new Error("attribute parsing error")}parseCandidate(b){const z=this.extractOneOrMore(b,U,[1,32]);this.consumeAttributeSpace(b);const Q=this.extractOneOrMore(b,f,[1,5]);this.consumeAttributeSpace(b);const Ce=this.extract(b,this.consumeToken);this.consumeAttributeSpace(b);const mt=this.extractOneOrMore(b,f,[1,10]);this.consumeAttributeSpace(b);const _n=this.extract(b,this.consumeAddress);this.consumeAttributeSpace(b);const dr=this.extract(b,this.consumePort);this.consumeAttributeSpace(b),this.extract(b,this.consume,"typ"),this.consumeAttributeSpace(b);const po={foundation:z,componentId:Q,transport:Ce,priority:mt,connectionAddress:_n,port:dr,type:this.extract(b,this.consumeToken),extension:{}};for(this.peek(b," raddr")&&(this.extract(b,this.consume," raddr"),this.consumeAttributeSpace(b),po.relAddr=this.extract(b,this.consumeAddress)),this.peek(b," rport")&&(this.extract(b,this.consume," rport"),this.consumeAttributeSpace(b),po.relPort=this.extract(b,this.consumePort));this.peekChar(b)===d;){this.consumeAttributeSpace(b);const Zo=this.extract(b,this.consumeToken);this.consumeAttributeSpace(b),po.extension[Zo]=this.extractOneOrMore(b,g)}this.attributes.candidates.push(po)}parseRemoteCandidate(b){const z=[];for(;;){const Q=this.extractOneOrMore(b,f,[1,5]);this.consumeAttributeSpace(b);const Ce=this.extract(b,this.consumeAddress);this.consumeAttributeSpace(b);const mt=this.extract(b,this.consumePort);z.push({componentId:Q,connectionAddress:Ce,port:mt});try{this.consumeAttributeSpace(b)}catch{break}}this.attributes.remoteCandidatesList.push(z)}parseEndOfCandidates(){if(this.attributes.endOfCandidates)throw new Error("must be only one line of end-of-candidates");this.attributes.endOfCandidates=!0}parseRtpmap(b){const z=this.extract(b,this.consumeToken);this.consumeAttributeSpace(b);const Q=this.extract(b,this.consumeTill,"/");this.extract(b,this.consume,"/");const Ce={encodingName:Q,clockRate:this.extractOneOrMore(b,f)};this.atEnd(b)||this.peekChar(b)!=="/"||(this.extract(b,this.consume,"/"),Ce.encodingParameters=parseInt(this.extract(b,this.consumeTill),10));const mt=this.attributes.payloads.find((_n=>_n.payloadType===parseInt(z,10)));mt?mt.rtpMap=Ce:this.attributes.payloads.push({payloadType:parseInt(z,10),rtpMap:Ce,rtcpFeedbacks:[]})}parsePtime(b){if(this.attributes.ptime)throw new Error("must be only one line of ptime");this.attributes.ptime=this.extract(b,this.consumeTill)}parseMaxPtime(b){if(this.attributes.maxPtime)throw new Error("must be only one line of ptime");this.attributes.maxPtime=this.extract(b,this.consumeTill)}parseDirection(b){if(this.attributes.direction)throw new Error("must be only one line of direction info");this.attributes.direction=b.attField}parseSSRC(b){const z=this.extractOneOrMore(b,f);this.consumeAttributeSpace(b);const Q=this.extract(b,this.consumeTill,":");let Ce;this.peekChar(b)===":"&&(this.extract(b,this.consume,":"),Ce=this.extract(b,this.consumeTill));const mt=this.attributes.ssrcs.find((_n=>_n.ssrcId===parseInt(z,10)));mt?mt.attributes[Q]=Ce:this.attributes.ssrcs.push({ssrcId:parseInt(z,10),attributes:{[Q]:Ce}})}parseFmtp(b){const z=this.extract(b,this.consumeTill,d);this.consumeAttributeSpace(b);const Q=this.extract(b,this.consumeTill),Ce={};Q.split(";").forEach((_n=>{let[dr,po]=_n.split("=");dr=fi(dr).call(dr);const Zo=typeof po=="string"?fi(po).call(po):null;typeof dr=="string"&&dr.length>0&&(Ce[dr]=Zo)}));const mt=this.attributes.payloads.find((_n=>_n.payloadType===parseInt(z,10)));mt?mt.fmtp={parameters:Ce}:this.attributes.payloads.push({payloadType:parseInt(z,10),rtcpFeedbacks:[],fmtp:{parameters:Ce}})}parseFmtParameters(b){const z={},Q=this.extract(b,this.consumeTill,"=");b._cur++;const Ce=this.extract(b,this.consumeTill,";");for(z[Q]=Ce;b.attValue[b._cur]===";";){const mt=this.extract(b,this.consumeTill,"=");b._cur++;const _n=this.extract(b,this.consumeTill,";");z[mt]=_n}return z}parseRtcpFb(b){let z="";z=this.peekChar(b)==="*"?this.extract(b,this.consume,"*"):this.extract(b,this.consumeTill,d),this.consumeAttributeSpace(b);const Q=this.extract(b,this.consumeTill,d);let Ce;if(Q==="trr-int")Ce={type:Q,interval:this.extract(b,this.consumeTill)};else{const mt={type:Q};this.peekChar(b)===d&&(this.consumeAttributeSpace(b),mt.parameter=this.extract(b,this.consumeToken),this.peekChar(b)===d&&(mt.additional=this.extract(b,this.consumeTill))),Ce=mt}if(z==="*")this.attributes.rtcpFeedbackWildcards.push(Ce);else{const mt=this.attributes.payloads.find((_n=>_n.payloadType===parseInt(z,10)));mt?mt.rtcpFeedbacks.push(Ce):this.attributes.payloads.push({payloadType:parseInt(z,10),rtcpFeedbacks:[Ce]})}}parseRTCPMux(){if(this.attributes.rtcpMux)throw new Error("must be single line of rtcp-mux");this.attributes.rtcpMux=!0}parseRTCPMuxOnly(){if(this.attributes.rtcpMuxOnly)throw new Error("must be single line of rtcp-only");this.attributes.rtcpMuxOnly=!0}parseRTCPRsize(){if(this.attributes.rtcpRsize)throw new Error("must be single line of rtcp-rsize");this.attributes.rtcpRsize=!0}parseRTCP(b){if(this.attributes.rtcp)throw new Error("must be single line of rtcp");const z={port:this.extract(b,this.consumePort)};this.peekChar(b)===d&&(this.consumeAttributeSpace(b),z.netType=this.extractOneOrMore(b,S),this.consumeAttributeSpace(b),z.addressType=this.extractOneOrMore(b,S),this.consumeAttributeSpace(b),z.address=this.extract(b,this.consumeAddress)),this.attributes.rtcp=z}parseMsid(b){const z={id:this.extractOneOrMore(b,S,[1,64])};this.peekChar(b)===d&&(this.consumeAttributeSpace(b),z.appdata=this.extractOneOrMore(b,S,[1,64])),this.attributes.msids.push(z)}parseImageAttr(b){this.attributes.imageattr.push(b.attValue)}parseRid(b){const z=this.extractOneOrMore(b,(Ce=>A(Ce)||f(Ce)||Ce==="_"||Ce==="-"));this.consumeAttributeSpace(b);const Q={id:z,direction:this.extract(b,this.consumeToken),params:[]};if(this.peekChar(b)===d){if(this.consumeAttributeSpace(b),this.peek(b,"pt=")){this.extract(b,this.consume,"pt=");const Ce=[];for(;;){const mt=this.extract(b,this.consumeToken);Ce.push(mt);try{this.extract(b,this.consume,",")}catch{break}}Q.payloads=Ce,this.peekChar(b)===d&&this.extract(b,this.consume,d)}for(;;){const Ce=this.extract(b,this.consumeToken);switch(Ce){case"depend":{const mt={type:Ce,rids:this.extract(b,this.consume,"=").split(",")};Q.params.push(mt);break}default:{const mt={type:Ce};this.peekChar(b)==="="&&(this.extract(b,this.consume,"="),mt.val=this.extract(b,this.consumeTill,";")),Q.params.push(mt)}}try{this.extract(b,this.consume,";")}catch{break}}}this.attributes.rids.push(Q)}parseSimulcast(b){if(this.attributes.simulcast)throw new Error("must be single line of simulcast");this.attributes.simulcast=b.attValue,this.extract(b,this.consumeTill)}parseSctpPort(b){this.attributes.sctpPort=this.extractOneOrMore(b,f,[1,5])}parseMaxMessageSize(b){this.attributes.maxMessageSize=this.extractOneOrMore(b,f,[1,void 0])}digest(){return this.digested=!0,this.attributes}parseMid(b){this.attributes.mid=this.extract(b,this.consumeToken)}parseSSRCGroup(b){const z=this.extract(b,this.consumeToken),Q=[];for(;;)try{this.consumeAttributeSpace(b);const Ce=this.extract(b,this.consumeInteger);Q.push(parseInt(Ce,10))}catch{break}this.attributes.ssrcGroups.push({semantic:z,ssrcIds:Q})}}function at(Ee,b,z){return b in Ee?Object.defineProperty(Ee,b,{value:z,enumerable:!0,configurable:!0,writable:!0}):Ee[b]=z,Ee}class Qt{constructor(){at(this,"eol",c)}print(b,z){let Q="";return z&&(this.eol=z),Q+=this.printVersion(b.version),Q+=this.printOrigin(b.origin),Q+=this.printSessionName(b.sessionName),Q+=this.printInformation(b.information),Q+=this.printUri(b.uri),Q+=this.printEmail(b.emails),Q+=this.printPhone(b.phones),Q+=this.printConnection(b.connection),Q+=this.printBandwidth(b.bandwidths),Q+=this.printTimeFields(b.timeFields),Q+=this.printKey(b.key),Q+=this.printSessionAttributes(b.attributes),Q+=this.printMediaDescription(b.mediaDescriptions),Q}printVersion(b){return"v=".concat(b).concat(this.eol)}printOrigin(b){return"o=".concat(b.username," ").concat(b.sessId," ").concat(b.sessVersion," ").concat(b.nettype," ").concat(b.addrtype," ").concat(b.unicastAddress).concat(this.eol)}printSessionName(b){return b?"s=".concat(b).concat(this.eol):""}printInformation(b){return b?"i=".concat(b).concat(this.eol):""}printUri(b){return b?"u=".concat(b).concat(this.eol):""}printEmail(b){let z="";for(const Q of b)z+="e=".concat(Q).concat(this.eol);return z}printPhone(b){let z="";for(const Q of b)z+="e=".concat(Q).concat(this.eol);return z}printConnection(b){return b?"c=".concat(b.nettype," ").concat(b.addrtype," ").concat(b.address).concat(this.eol):""}printBandwidth(b){let z="";for(const Q of b)z+="b=".concat(Q.bwtype,":").concat(Q.bandwidth).concat(this.eol);return z}printTimeFields(b){let z="";for(const Q of b){z+="t=".concat(Q.time.startTime," ").concat(Q.time.startTime).concat(this.eol);for(const Ce of Q.repeats)z+="r=".concat(Ce.repeatInterval," ").concat(Ce.typedTimes.join(" ")).concat(this.eol);Q.zoneAdjustments&&(z+="z=",z+="z=".concat(Q.zoneAdjustments.map((Ce=>"".concat(Ce.time," ").concat(Ce.back?"-":""," ").concat(Ce.typedTime))).join(" ")).concat(this.eol),z+=this.eol)}return z}printKey(b){return b?"k=".concat(b).concat(this.eol):""}printAttributes(b){let z="";for(const Q of b)z+="a=".concat(Q.attField).concat(Q.attValue?":".concat(Q.attValue):"").concat(this.eol);return z}printMediaDescription(b){let z="";for(const Q of b)z+=this.printMedia(Q.media),z+=this.printInformation(Q.information),z+=this.printConnections(Q.connections),z+=this.printBandwidth(Q.bandwidths),z+=this.printKey(Q.key),z+=this.printMediaAttributes(Q);return z}printConnections(b){let z="";for(const Q of b)z+=this.printConnection(Q);return z}printMedia(b){return"m=".concat(b.mediaType," ").concat(b.port," ").concat(b.protos.join("/")," ").concat(b.fmts.join(" ")).concat(this.eol)}printSessionAttributes(b){return new ti(this.eol).print(b)}printMediaAttributes(b){return new _e(this.eol).print(b)}}class qt{constructor(b){at(this,"eol",void 0),this.eol=b}printIceUfrag(b){return b===void 0?"":"a=ice-ufrag:".concat(b).concat(this.eol)}printIcePwd(b){return b===void 0?"":"a=ice-pwd:".concat(b).concat(this.eol)}printIceOptions(b){return b===void 0?"":"a=ice-options:".concat(b.join(d)).concat(this.eol)}printFingerprints(b){return b.length>0?b.map((z=>"a=fingerprint:".concat(z.hashFunction).concat(d).concat(z.fingerprint))).join(this.eol)+this.eol:""}printExtmap(b){return b.map((z=>"a=extmap:".concat(z.entry).concat(z.direction?"/".concat(z.direction):"").concat(d).concat(z.extensionName).concat(z.extensionAttributes?"".concat(d).concat(z.extensionAttributes):"").concat(this.eol))).join("")}printSetup(b){return b===void 0?"":"a=setup:".concat(b).concat(this.eol)}printUnrecognized(b){return b.map((z=>"a=".concat(z.attField).concat(z.attValue?":".concat(z.attValue):"").concat(this.eol))).join("")}}class ti extends qt{print(b){let z="";return z+=this.printGroups(b.groups),z+=this.printMsidSemantic(b.msidSemantic),z+=this.printIceLite(b.iceLite),z+=this.printIceUfrag(b.iceUfrag),z+=this.printIcePwd(b.icePwd),z+=this.printIceOptions(b.iceOptions),z+=this.printFingerprints(b.fingerprints),z+=this.printSetup(b.setup),z+=this.printTlsId(b.tlsId),z+=this.printIdentity(b.identities),z+=this.printExtmap(b.extmaps),z+=this.printUnrecognized(b.unrecognized),z}printGroups(b){let z="";return b.length>0&&(z+=b.map((Q=>"a=group:".concat(Q.semantic).concat(Q.identificationTag.map((Ce=>"".concat(d).concat(Ce))).join("")).concat(this.eol))).join("")),z}printIceLite(b){return b===void 0?"":"a=ice-lite"+this.eol}printTlsId(b){return b?"a=tls-id:".concat(b).concat(this.eol):""}printIdentity(b){return b.length===0?"":b.map((z=>"a=identity:".concat(z.assertionValue).concat(z.extensions.map((Q=>"".concat(d).concat(Q.name).concat(Q.value?"=".concat(Q.value):"")))))).join(this.eol)+this.eol}printMsidSemantic(b){if(!b)return"";let z="a=msid-semantic:".concat(b.semantic);return b.applyForAll?z+="".concat(d,"*"):b.identifierList.length>0&&(z+=b.identifierList.map((Q=>"".concat(d).concat(Q)))),z+this.eol}}class _e extends qt{print(b){const z=b.attributes;let Q="";return Q+=this.printRTCP(z.rtcp),Q+=this.printIceUfrag(z.iceUfrag),Q+=this.printIcePwd(z.icePwd),Q+=this.printIceOptions(z.iceOptions),Q+=this.printCandidates(z.candidates),Q+=this.printRemoteCandidatesList(z.remoteCandidatesList),Q+=this.printEndOfCandidates(z.endOfCandidates),Q+=this.printFingerprints(z.fingerprints),Q+=this.printSetup(z.setup),Q+=this.printMid(z.mid),Q+=this.printExtmap(z.extmaps),Q+=this.printRTPRelated(z),Q+=this.printPtime(z.ptime),Q+=this.printMaxPtime(z.maxPtime),Q+=this.printDirection(z.direction),Q+=this.printSSRCGroups(z.ssrcGroups),Q+=this.printSSRC(z.ssrcs),Q+=this.printRTCPMux(z.rtcpMux),Q+=this.printRTCPMuxOnly(z.rtcpMuxOnly),Q+=this.printRTCPRsize(z.rtcpRsize),Q+=this.printMSId(z.msids),Q+=this.printImageattr(z.imageattr),Q+=this.printRid(z.rids),Q+=this.printSimulcast(z.simulcast),Q+=this.printSCTPPort(z.sctpPort),Q+=this.printMaxMessageSize(z.maxMessageSize),Q+=this.printUnrecognized(z.unrecognized),Q}printCandidates(b){return b.map((z=>"a=candidate:".concat(z.foundation).concat(d).concat(z.componentId).concat(d).concat(z.transport).concat(d).concat(z.priority).concat(d).concat(z.connectionAddress).concat(d).concat(z.port).concat(d,"typ").concat(d).concat(z.type).concat(z.relAddr?"".concat(d,"raddr").concat(d).concat(z.relAddr):"").concat(z.relPort?"".concat(d,"rport").concat(d).concat(z.relPort):"").concat(Object.keys(z.extension).map((Q=>"".concat(d).concat(Q).concat(d).concat(z.extension[Q]))).join("")).concat(this.eol))).join("")}printRemoteCandidatesList(b){return b.map((z=>"a=remote-candidates:".concat(z.join(d)).concat(this.eol))).join("")}printEndOfCandidates(b){return b===void 0?"":"a=end-of-candidates"+this.eol}printRTPRelated(b){if(!b.payloads)return"";const z=b.payloads;let Q="";Q+=b.rtcpFeedbackWildcards.map((Ce=>this.printRTCPFeedback("*",Ce))).join("");for(const Ce of z)Q+=this.printRtpMap(Ce.payloadType,Ce.rtpMap),Q+=this.printFmtp(Ce.payloadType,Ce.fmtp),Q+=Ce.rtcpFeedbacks.map((mt=>this.printRTCPFeedback(Ce.payloadType,mt))).join("");return Q}printFmtp(b,z){if(!z)return"";const Q=Object.keys(z.parameters);return Q.length===1&&z.parameters[Q[0]]===null?"a=fmtp:".concat(b).concat(d).concat(Q[0]).concat(this.eol):"a=fmtp:".concat(b).concat(d).concat(Object.keys(z.parameters).map((Ce=>"".concat(Ce,"=").concat(z.parameters[Ce]))).join(";")).concat(this.eol)}printRtpMap(b,z){return z?"a=rtpmap:".concat(b).concat(d).concat(z.encodingName,"/").concat(z.clockRate).concat(z.encodingParameters?"/".concat(z.encodingParameters):"").concat(this.eol):""}printRTCPFeedback(b,z){let Q="a=rtcp-fb:".concat(b).concat(d),Ce=z;return Ce.type==="trr-int"?Q+="ttr-int".concat(d).concat(Ce.interval):(Q+="".concat(Ce.type),Ce.parameter&&(Q+="".concat(d).concat(Ce.parameter),Ce.additional&&(Q+="".concat(d).concat(Ce.additional)))),Q+this.eol}printPtime(b){return b===void 0?"":"a=ptime:".concat(b).concat(this.eol)}printMaxPtime(b){return b===void 0?"":"a=maxptime:".concat(b).concat(this.eol)}printDirection(b){return b===void 0?"":"a=".concat(b).concat(this.eol)}printSSRC(b){return b.map((z=>Object.keys(z.attributes).map((Q=>"a=ssrc:".concat(z.ssrcId.toString(10)).concat(d).concat(Q).concat(z.attributes[Q]?":".concat(z.attributes[Q]):"").concat(this.eol))).join(""))).join("")}printRTCPMux(b){return b===void 0?"":"a=rtcp-mux".concat(this.eol)}printRTCPMuxOnly(b){return b===void 0?"":"a=rtcp-mux-only".concat(this.eol)}printRTCPRsize(b){return b===void 0?"":"a=rtcp-rsize".concat(this.eol)}printRTCP(b){if(b===void 0)return"";let z="a=rtcp:".concat(b.port);return b.netType&&(z+="".concat(d).concat(b.netType)),b.addressType&&(z+="".concat(d).concat(b.addressType)),b.address&&(z+="".concat(d).concat(b.address)),z+this.eol}printMSId(b){return b.map((z=>"a=msid:".concat(z.id).concat(z.appdata?"".concat(d).concat(z.appdata):"").concat(this.eol))).join("")}printImageattr(b){return b.map((z=>"a=imageattr:".concat(z).concat(this.eol))).join("")}printRid(b){return b.map((z=>{let Q="a=rid:".concat(z.id).concat(d).concat(z.direction);return z.payloads&&(Q+="".concat(d,"pt=").concat(z.payloads.join(","))),z.params.length>0&&(Q+="".concat(d).concat(z.params.map((Ce=>Ce.type==="depend"?"depend=".concat(Ce.rids.join(",")):"".concat(Ce.type,"=").concat(Ce.val))).join(";"))),Q+this.eol})).join("")}printSimulcast(b){return b===void 0?"":"a=simulcast:".concat(b).concat(this.eol)}printSCTPPort(b){return b===void 0?"":"a=sctp-port:".concat(b).concat(this.eol)}printMaxMessageSize(b){return b===void 0?"":"a=max-message-size:".concat(b).concat(this.eol)}printMid(b){return b===void 0?"":"a=mid:".concat(b).concat(this.eol)}printSSRCGroups(b){return b.map((z=>"a=ssrc-group:".concat(z.semantic).concat(z.ssrcIds.map((Q=>"".concat(d).concat(Q.toString(10)))).join("")).concat(this.eol))).join("")}}function Ae(Ee){return new ge().parse(Ee)}function je(Ee,b){return new Qt().print(Ee,b)}}},t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={exports:{}};return e[r](i,i.exports,n),i.exports}return n.d=(r,i)=>{for(var s in i)n.o(i,s)&&!n.o(r,s)&&Object.defineProperty(r,s,{enumerable:!0,get:i[s]})},n.o=(r,i)=>Object.prototype.hasOwnProperty.call(r,i),n.r=r=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(r,"__esModule",{value:!0})},n(8)})();function $i(e){return R1.parse(e)}function Nd(e,t){return R1.print(e,t)}var YY=cs("Array","keys"),qY=na,XY=Tr,JY=ee,QY=YY,Cb=Array.prototype,ZY={DOMTokenList:!0,NodeList:!0},$Y=function(e){var t=e.keys;return e===Cb||JY(Cb,e)&&t===Cb.keys||XY(ZY,qY(e))?QY:t},es=R($Y);function Fn(e,t,n){return(t=(function(r){var i=(function(s,o){if(typeof s!="object"||!s)return s;var c=s[Symbol.toPrimitive];if(c!==void 0){var d=c.call(s,"string");if(typeof d!="object")return d;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(s)})(r);return typeof i=="symbol"?i:i+""})(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function w1(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable}))),n.push.apply(n,r)}return n}function vt(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?w1(Object(n),!0).forEach((function(r){Fn(e,r,n[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):w1(Object(n)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))}))}return e}const C1=new class extends xn{constructor(){super(...arguments),Fn(this,"currentUploadLogID",0)}reportLogUploadError(e){const{errorRange:t}=e;t[t.length-1]&&t[t.length-1]>this.currentUploadLogID&&(this.currentUploadLogID=t[t.length-1],this.emit("REPORT_LOG_UPLOAD",e))}};class e9{constructor(t){Fn(this,"logger",void 0),Fn(this,"prefixLists",[]),this.logger=t}debug(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];this.logger.debug(...this.prefixLists,...n)}info(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];this.logger.info(...this.prefixLists,...n)}warning(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];this.logger.warning(...this.prefixLists,...n)}error(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];this.logger.error(...this.prefixLists,...n)}prefix(t){return this.prefixLists.push(t),this}popPrefix(){return this.prefixLists.pop(),this}}function bb(){const e=new Date;return e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}function b1(){const e=new Date,t=/((\d+:){2}\d+)/.exec(new Date().toUTCString());return t?t?.[0]+":"+e.getUTCMilliseconds():e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}const io={DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4},JS=Date.now(),tE=e=>{for(const t in io)if(Object.prototype.hasOwnProperty.call(io,t)&&io[t]===e)return t;return"DEFAULT"},w=new class{constructor(){Fn(this,"proxyServerURL",void 0),Fn(this,"logLevel",io.DEBUG),Fn(this,"uploadState","collecting"),Fn(this,"uploadLogWaitingList",[]),Fn(this,"uploadLogUploadingList",[]),Fn(this,"uploadErrorCount",0),Fn(this,"currentLogID",0),Fn(this,"url",void 0),Fn(this,"extLog",((e,t)=>{this.appendLogToWaitingList(e,...t)}))}debug(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const r=[io.DEBUG].concat(t);this.log.apply(this,r)}info(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const r=[io.INFO].concat(t);this.log.apply(this,r)}warning(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const r=[io.WARNING].concat(t);this.log.apply(this,r)}warn(){this.warning(...arguments)}error(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const r=[io.ERROR].concat(t);this.log.apply(this,r)}upload(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const r=[io.DEBUG].concat(t);this.uploadLog.apply(this,r)}setLogLevel(e){e=Math.min(Math.max(0,e),4),this.logLevel=e}enableLogUpload(){sn("UPLOAD_LOG",!0)}disableLogUpload(){sn("UPLOAD_LOG",!1),this.uploadLogUploadingList=[],this.uploadLogWaitingList=[]}setProxyServer(e){this.proxyServerURL=e}prefix(e){return new e9(this).prefix(e)}log(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if(Date.now()-JS<100)return void setTimeout((()=>{this.log(...t)}),Date.now()-JS);const r=Math.max(0,Math.min(4,t[0]));if(t[0]=bb()+" Agora-SDK [".concat(tE(r),"]:"),this.appendLogToWaitingList(r,...t),r<this.logLevel)return;const i=bb()+" %cAgora-SDK [".concat(tE(r),"]:");let s=[];if(!B("USE_NEW_LOG"))switch(r){case io.DEBUG:s=[i,"color: #64B5F6;"].concat(t.slice(1)),console.log.apply(console,s);break;case io.INFO:s=[i,"color: #1E88E5; font-weight: bold;"].concat(t.slice(1)),console.log.apply(console,s);break;case io.WARNING:s=[i,"color: #FB8C00; font-weight: bold;"].concat(t.slice(1)),console.warn.apply(console,s);break;case io.ERROR:s=[i,"color: #B00020; font-weight: bold;"].concat(t.slice(1)),console.error.apply(console,s)}}uploadLog(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if(Date.now()-JS<100)return void setTimeout((()=>{this.uploadLog(...t)}),Date.now()-JS);const r=Math.max(0,Math.min(4,t[0]));t[0]=bb()+" Agora-SDK [".concat(tE(r),"]:"),this.appendLogToWaitingList(r,...t)}appendLogToWaitingList(e){if(!B("UPLOAD_LOG"))return;for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];Array.isArray(n[0])?n[0][0]=b1()+" Agora-SDK [".concat(tE(e),"]:"):n[0]=b1()+" Agora-SDK [".concat(tE(e),"]:");let i="";n.forEach((s=>{typeof s=="object"&&(s=JSON.stringify(s)),i+="".concat(s," ")})),this.uploadLogWaitingList.push({payload_str:i,log_level:e,log_item_id:this.currentLogID++}),this.uploadState==="uploading"&&this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}startUpload(){this.uploadState="uploading",this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}async uploadLogs(){const e=this.uploadLogUploadingList,t={sdk_version:ro,process_id:B("PROCESS_ID"),payload:JSON.stringify(e)};return Ca((async()=>{const n=await ji.post(this.url||(this.proxyServerURL?"https://".concat(this.proxyServerURL,"/ls/?h=").concat(B("LOG_UPLOAD_SERVER"),"&p=443&d=upload/v1"):"https://".concat(B("LOG_UPLOAD_SERVER"),"/upload/v1")),t,{responseType:"text"});if(n.data!=="OK"){const r=new Error("unexpected upload log response");throw r.response=n,r}}),(()=>(this.uploadLogUploadingList=[],!1)),(n=>{const r={status:-1,message:n.message,errorRange:e.map((i=>i.log_item_id))};return n.response?(r.status=n.response.status,r.data=n.response.data,r.headers=n.response.headers):n.request&&(r.status=n.request.status),C1.reportLogUploadError(r),!0}),{timeout:B("UPLOAD_LOG_REQUEST_RETRY_INTERVAL"),maxRetryTimeout:B("UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL")})}uploadLogInterval(){this.uploadLogUploadingList.length===0&&this.uploadLogWaitingList.length===0||(this.uploadLogUploadingList.length===0&&(this.uploadLogUploadingList=this.uploadLogWaitingList.splice(0,B("UPLOAD_LOG_LENGTH_EACH_TIME"))),this.uploadLogs().then((()=>{this.uploadErrorCount=0,this.uploadLogWaitingList.length>0&&window.setTimeout((()=>this.uploadLogInterval()),B("UPLOAD_LOG_INTERVAL"))})).catch((e=>{this.uploadErrorCount+=1,this.uploadErrorCount<2?window.setTimeout((()=>this.uploadLogInterval()),B("UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1")):window.setTimeout((()=>this.uploadLogInterval()),B("UPLOAD_LOG_RETRY_INTERVAL_V1"))})))}};var I1;function t9(e){return kr(e.reportId,"params.reportId",0,100,!1),kr(e.category,"params.category",0,100,!1),kr(e.event,"params.event",0,100,!1),kr(e.label,"params.label",0,100,!1),cn(e.value,"params.value",Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,!1),!0}(I1={}).FREE="free",I1.UPLOADING="uploading",(function(e){e[e.MISC=0]="MISC",e[e.INTERNAL_EVENT=1]="INTERNAL_EVENT",e[e.PUBLIC_EVENT=2]="PUBLIC_EVENT",e[e.WEB_EVENT=3]="WEB_EVENT",e[e.INTERNAL_API=4]="INTERNAL_API",e[e.WEB_API=5]="WEB_API",e[e.PUBLIC_API=6]="PUBLIC_API"})({});const n9={sid:"",lts:0,success:null,cname:null,uid:null,peer:null,cid:null,elapse:null,extend:null,vid:0};let fr=(function(e){return e.PUBLISH="publish",e.SUBSCRIBE="subscribe",e.WS_COMPRESSOR_INIT="ws_compressor_init",e.SESSION_INIT="session_init",e.JOIN_CHOOSE_SERVER="join_choose_server",e.REQ_USER_ACCOUNT="req_user_account",e.JOIN_GATEWAY="join_gateway",e.REJOIN_GATEWAY="rejoin_gateway",e.STREAM_SWITCH="stream_switch",e.REQUEST_PROXY_WORKER_MANAGER="request_proxy_worker_manager",e.REQUEST_PROXY_APPCENTER="request_proxy_appcenter",e.FIRST_VIDEO_RECEIVED="first_video_received",e.FIRST_AUDIO_RECEIVED="first_audio_received",e.FIRST_VIDEO_DECODE="first_video_decode",e.FIRST_AUDIO_DECODE="first_audio_decode",e.XLA_PEER_FIRST_VIDEO_FRAME="xla_peer_first_video_frame",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_UPDATE_STREAM="on_update_stream",e.ON_REMOVE_STREAM="on_remove_stream",e.USER_ANALYTICS="req_user_analytics",e.PC_STATS="pc_stats",e.UPDATE_REMOTE_RTPCAPABILITIES="update_remote_rtpCapabilities",e.AB_TEST="ab_test",e})({}),In=(function(e){return e.SESSION="io.agora.pb.Wrtc.Session",e.JOIN_CHOOSE_SERVER="io.agora.pb.Wrtc.JoinChooseServer",e.REQ_USER_ACCOUNT="io.agora.pb.Wrtc.ReqUserAccount",e.JOIN_GATEWAY="io.agora.pb.Wrtc.JoinGateway",e.RE_JOIN_GATEWAY="io.agora.pb.Wrtc.ReJoinGateway",e.PUBLISH="io.agora.pb.Wrtc.Publish",e.SUBSCRIBE="io.agora.pb.Wrtc.Subscribe",e.WS_COMPRESSOR_INIT="io.agora.pb.Wrtc.WsCompressorInit",e.STREAM_SWITCH="io.agora.pb.Wrtc.StreamSwitch",e.AUDIO_SENDING_STOPPED="io.agora.pb.Wrtc.AudioSendingStopped",e.VIDEO_SENDING_STOPPED="io.agora.pb.Wrtc.VideoSendingStopped",e.REQUEST_PROXY_APPCENTER="io.agora.pb.Wrtc.RequestProxyAppCenter",e.REQUEST_PROXY_WORKER_MANAGER="io.agora.pb.Wrtc.RequestProxyWorkerManager",e.API_INVOKE="io.agora.pb.Wrtc.ApiInvoke",e.FIRST_VIDEO_RECEIVED="io.agora.pb.Wrtc.FirstVideoReceived",e.FIRST_AUDIO_RECEIVED="io.agora.pb.Wrtc.FirstAudioReceived",e.FIRST_VIDEO_DECODE="io.agora.pb.Wrtc.FirstVideoDecode",e.FIRST_AUDIO_DECODE="io.agora.pb.Wrtc.FirstAudioDecode",e.XLA_PEER_FIRST_VIDEO_FRAME="io.agora.pb.Wrtc.XLAPeerFirstVideoFrame",e.ON_ADD_AUDIO_STREAM="io.agora.pb.Wrtc.OnAddAudioStream",e.ON_ADD_VIDEO_STREAM="io.agora.pb.Wrtc.OnAddVideoStream",e.ON_UPDATE_STREAM="io.agora.pb.Wrtc.OnUpdateStream",e.ON_REMOVE_STREAM="io.agora.pb.Wrtc.OnRemoveStream",e.JOIN_CHANNEL_TIMEOUT="io.agora.pb.Wrtc.JoinChannelTimeout",e.PEER_PUBLISH_STATUS="io.agora.pb.Wrtc.PeerPublishStatus",e.WORKER_EVENT="io.agora.pb.Wrtc.WorkerEvent",e.AP_WORKER_EVENT="io.agora.pb.Wrtc.APWorkerEvent",e.JOIN_WEB_PROXY_AP="io.agora.pb.Wrtc.JoinWebProxyAP",e.WEBSOCKET_QUIT="io.agora.pb.Wrtc.WebSocketQuit",e.USER_ANALYTICS="io.agora.pb.Wrtc.UserAnalytics",e.AUTOPLAY_FAILED="io.agora.pb.Wrtc.AutoplayFailed",e.PC_STATS="io.agora.pb.Wrtc.PCStats",e.UPDATE_REMOTE_RTPCAPABILITIES="io.agora.pb.Wrtc.UpdateRemoteRTPCapabilities",e.AB_TEST="io.agora.pb.Wrtc.ABTest",e})({});(function(e){e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT"})({});let r9=(function(e){return e[e.SESSION=26]="SESSION",e[e.JOIN_CHOOSE_SERVER=27]="JOIN_CHOOSE_SERVER",e[e.REQ_USER_ACCOUNT=196]="REQ_USER_ACCOUNT",e[e.JOIN_GATEWAY=28]="JOIN_GATEWAY",e[e.PUBLISH=30]="PUBLISH",e[e.SUBSCRIBE=29]="SUBSCRIBE",e[e.WS_COMPRESSOR_INIT=9430]="WS_COMPRESSOR_INIT",e[e.STREAM_SWITCH=32]="STREAM_SWITCH",e[e.AUDIO_SENDING_STOPPED=33]="AUDIO_SENDING_STOPPED",e[e.VIDEO_SENDING_STOPPED=34]="VIDEO_SENDING_STOPPED",e[e.REQUEST_PROXY_APPCENTER=35]="REQUEST_PROXY_APPCENTER",e[e.REQUEST_PROXY_WORKER_MANAGER=36]="REQUEST_PROXY_WORKER_MANAGER",e[e.API_INVOKE=41]="API_INVOKE",e[e.FIRST_VIDEO_RECEIVED=348]="FIRST_VIDEO_RECEIVED",e[e.FIRST_AUDIO_RECEIVED=349]="FIRST_AUDIO_RECEIVED",e[e.FIRST_VIDEO_DECODE=350]="FIRST_VIDEO_DECODE",e[e.FIRST_AUDIO_DECODE=351]="FIRST_AUDIO_DECODE",e[e.ON_ADD_AUDIO_STREAM=352]="ON_ADD_AUDIO_STREAM",e[e.ON_ADD_VIDEO_STREAM=353]="ON_ADD_VIDEO_STREAM",e[e.ON_UPDATE_STREAM=356]="ON_UPDATE_STREAM",e[e.ON_REMOVE_STREAM=355]="ON_REMOVE_STREAM",e[e.JOIN_CHANNEL_TIMEOUT=407]="JOIN_CHANNEL_TIMEOUT",e[e.PEER_PUBLISH_STATUS=408]="PEER_PUBLISH_STATUS",e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT",e[e.JOIN_WEB_PROXY_AP=700]="JOIN_WEB_PROXY_AP",e[e.WEBSOCKET_QUIT=671]="WEBSOCKET_QUIT",e[e.USER_ANALYTICS=1e4]="USER_ANALYTICS",e[e.AUTOPLAY_FAILED=9178]="AUTOPLAY_FAILED",e})({});function et(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return function(t,n,r){const i=r.value;if(typeof i=="function"){const s=e.className||t.__className__||(t.constructor.name==="AgoraRTCClient"?"Client":t.constructor.name);r.value=function(){for(var o,c=arguments.length,d=new Array(c),h=0;h<c;h++)d[h]=arguments[h];let f=d;if(e.argsMap)try{f=e.argsMap(this,...d)}catch(E){w.warning(E),f=[]}try{JSON.stringify(f)}catch{w.warning("arguments for method ".concat(s,".").concat(String(n)," not serializable for apiInvoke.")),f=[]}const g=(e.report||We).reportApiInvoke(this._sessionId||null,{id:this._clientId||((o=this.store)===null||o===void 0?void 0:o.clientId)||this._ID,name:"".concat(s,".").concat(String(n)),options:f,tag:Nn.TRACER,reportResult:e.reportResult},e.throttleTime);try{const E=i.apply(this,d);return E instanceof ke?E.then((S=>(g.onSuccess(e.reportResult&&S),S))).catch((S=>{throw g.onError(S),S})):(g.onSuccess(e.reportResult&&E),E)}catch(E){throw g.onError(E),E}}}return r}}const We=new class{constructor(){Fn(this,"baseInfoMap",new Map),Fn(this,"proxyServer",void 0),Fn(this,"eventUploadTimer",void 0),Fn(this,"setSessionIdTimer",void 0),Fn(this,"url",void 0),Fn(this,"sids",new Set),Fn(this,"backupUrl",void 0),Fn(this,"_appId",void 0),Fn(this,"_aid",0),Fn(this,"keyEventUploadPendingItems",[]),Fn(this,"normalEventUploadPendingItems",[]),Fn(this,"apiInvokeUploadPendingItems",[]),Fn(this,"apiInvokeCount",0),Fn(this,"apiInvokeLoggedCount",0),Fn(this,"ltsList",[]),Fn(this,"lastSendNormalEventTime",Date.now()),Fn(this,"customReportCounterTimer",void 0),Fn(this,"customReportCount",0),Fn(this,"extApiInvoke",(async e=>{for(const t of e){const n=vt(vt({},t),{},{sid:null,invokeId:++this.apiInvokeCount,tag:Nn.TRACER});this.sendApiInvoke(n)}})),this.eventUploadTimer=window.setInterval(this.doSend.bind(this),B("EVENT_REPORT_SEND_INTERVAL")),this.setSessionIdTimer=window.setInterval(this.appendSessionId.bind(this),B("EVENT_REPORT_SEND_INTERVAL"))}getBaseInfoBySessionId(e){return this.baseInfoMap.get(e)}setAppId(e){this._appId=e,this._aid=parseInt(e.replace(/[a-fA-F0-9]{8}/g,(t=>{let[n,r]=t;return n+r})),16)||0}reportApiInvoke(e,t,n){t.timeout=t.timeout||6e4,t.reportResult=t.reportResult===void 0||t.reportResult;const r=Date.now();this.apiInvokeCount+=1;const i=this.apiInvokeCount,s=!!B("SHOW_REPORT_INVOKER_LOG"),o=!!B("SHOW_REPORT_USER_INVOKER_LOG"),c=s||o&&t.id;c&&(this.apiInvokeLoggedCount+=1);const d=this.apiInvokeLoggedCount;function h(S,O){if(c){let A="[apiInvoke-".concat(d,"]");if(t.id&&(A+="[".concat(t.id,"]")),t.name&&(A+="[".concat(t.name,"]"),t.name===Gn.JOIN))return w.info("".concat(A," ").concat(S));w.info("".concat(A," ").concat(S),S==="start"?t.options:O||"")}}const f=()=>({tag:t.tag,invokeId:i,sid:e,name:t.name,apiInvokeTime:r,options:t.options,states:t.states||null});h("start");let g=!1;xr(t.timeout).then((()=>{g||(this.sendApiInvoke(vt(vt({},f()),{},{error:V.API_INVOKE_TIMEOUT,success:!1})),h("timeout"))}));const E=new de(V.UNEXPECTED_ERROR,"".concat(t.name,": this api invoke is end"));return{onSuccess:S=>{const O=()=>{if(g)throw E;return g=!0,this.sendApiInvoke(vt(vt({},f()),{},{success:!0},t.reportResult&&{result:S})),h("onSuccess"),S};return n?o1(O,t.name+"Success",n,(()=>g=!0)):O()},onError:S=>{const O=()=>{if(g)throw S;g=!0,this.sendApiInvoke(vt(vt({},f()),{},{success:!1,error:S})),h("onFailure",S.toString())};return n?o1(O,t.name+"Error",n,(()=>g=!0)):O()}}}sessionInit(e,t){if(this.baseInfoMap.has(e))return;const n=Date.now(),r=this.createBaseInfo(e,n);r.cname=t.cname;const i=Object.assign({},{willUploadConsoleLog:B("UPLOAD_LOG"),maxTouchPoints:navigator.maxTouchPoints,areaVersion:Sb?"global":"oversea",areas:B("AREAS")&&B("AREAS").join(",")},t.extend),{stringUid:s,channelProfile:o,channelMode:c,isABTestSuccess:d,lsid:h,clientRole:f}=t,g=Date.now(),E=vt(vt({},r),{},{eventType:fr.SESSION_INIT,appid:t.appid,browser:navigator.userAgent,buildFormat:t.buildFormat,build:Rb,lts:g,elapse:g-n,extend:JSON.stringify(i),mode:t.mode,process:B("PROCESS_ID"),appType:B("APP_TYPE"),success:!0,version:ro,stringUid:s,channelProfile:o,channelMode:c,isABTestSuccess:d,lsid:h,clientType:be(S=window.navigator.userAgent).call(S,"AgoraWebView")?42:20,clientRole:f,serviceId:B("PROCESS_ID"),extensionID:B("PLUGIN_INFO").join(",")||""});var S;this.send({type:In.SESSION,data:E},!0)}joinChooseServer(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),s=vt(vt({},r),{},{role:t.role,eventType:fr.JOIN_CHOOSE_SERVER,lts:i,eventElapse:t.elapse||i-t.lts,chooseServerAddr:t.csAddr,errorCode:t.ec,elapse:i-n.startTime,success:t.succ,chooseServerAddrList:JSON.stringify(t.serverList),uid:t.uid?parseInt(t.uid):null,cid:t.cid?parseInt(t.cid):null,chooseServerIp:t.csIp||"",opid:t.opid,unilbsServerIds:t.unilbsServerIds,extend:t.extend||void 0,isHttp3:t.isHttp3,corssRegionTagReq:t.corssRegionTagReq||void 0,corssRegionTagRes:t.corssRegionTagRes||void 0,resourceTimingInfo:t.resourceTimingInfo||void 0});this.send({type:In.JOIN_CHOOSE_SERVER,data:s},!0)}reqUserAccount(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),s=vt(vt({},r),{},{eventType:fr.REQ_USER_ACCOUNT,lts:i,success:t.success,serverAddress:t.serverAddr,stringUid:t.stringUid,uid:t.uid,errorCode:t.errorCode,elapse:t.elapse||i-n.startTime,eventElapse:i-t.lts,extend:JSON.stringify(t.extend)});this.send({type:In.REQ_USER_ACCOUNT,data:s},!0)}joinGateway(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info;t.vid&&(r.vid=t.vid),r.uid=t.uid,r.cid=t.cid;const i=Date.now(),{firstSuccess:s,addr:o,isProxy:c}=t,d=i-n.startTime,h=vt(vt({},r),{},{eventType:fr.JOIN_GATEWAY,lts:i,gatewayAddr:t.addr,success:t.succ,errorCode:t.ec,errorMsg:t.errorMsg||"",elapse:d,eventElapse:i-t.lts,firstSuccess:s,signalChannel:t.signalChannel,preload:t.preload?1:0,installId:yb(),isABTestSuccess:t.isABTestSuccess?1:0}),f=h.success?1:0;if(t.succ&&(n.lastJoinSuccessTime=i),s)this.send({type:In.JOIN_GATEWAY,data:h},!0);else{let g;if(o)if(c){const S=o.match(/h=(\d{1,3}-){3}\d{1,3}/g),O=o.match(/p=[0-9]{1,6}/g);g={isSuccess:f,gatewayIp:S&&S.length?S[0].split("=")[1].replace(/-/g,"."):"",port:O&&O.length?O[0].split("=")[1]:"",isProxy:c?1:0}}else{const S=o.match(/wss:\/\/(\d{1,3}-){3}\d{1,3}/g),O=o.match(/(:|p=)[0-9]{1,6}/g);g={isSuccess:f,gatewayIp:S&&S.length?S[0].split("//")[1].replace(/-/g,"."):"",port:O&&O.length?O[0].split(/:|p=/g)[1]:"",isProxy:c?1:0}}else g={isSuccess:f,gatewayIp:"",port:"",isProxy:c?1:0};delete h.success,delete h.eventType,delete h.firstSuccess,h.vid=Number(h.vid);const E=Object.assign({},h,g,{eventType:fr.REJOIN_GATEWAY});this.send({type:In.RE_JOIN_GATEWAY,data:E},!0)}}joinChannelTimeout(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=Date.now(),i=vt(vt({},n.info),{},{lts:r,timeout:t,elapse:r-n.startTime});this.send({type:In.JOIN_CHANNEL_TIMEOUT,data:i},!0)}publish(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),s=vt(vt({},r),{},{eventType:fr.PUBLISH,lts:i,eventElapse:t.eventElapse,elapse:i-n.startTime,success:t.succ,errorCode:t.ec,videoName:t.videoName,audioName:t.audioName,screenName:t.screenName,screenshare:t.screenshare,audio:t.audio,video:t.video,p2pid:t.p2pid,publishRequestid:t.publishRequestid});this.send({type:In.PUBLISH,data:s},!0)}subscribe(e,t,n){const r=this.baseInfoMap.get(e);if(!r)return;const i=r.info,s=Date.now(),o=vt(vt({},i),{},{eventType:fr.SUBSCRIBE,lts:s,eventElapse:t.eventElapse,elapse:s-r.startTime,success:t.succ,errorCode:t.ec,video:t.video,audio:t.audio,subscribeRequestid:t.subscribeRequestid,p2pid:t.p2pid,preSsrc:t.preSsrc?1:0},n&&{extend:JSON.stringify({isMassSubscribe:!0})});typeof t.peerid=="string"?o.peerSuid=t.peerid:o.peer=t.peerid,this.send({type:In.SUBSCRIBE,data:o},!0)}wsCompressorInit(e){var t;const n=[...es(t=this.baseInfoMap).call(t)],r=n.length?n[0]:"UnableToGetSid",i=this.baseInfoMap.get(r);if(!i)return;const s=i.info,o=Date.now(),c=vt(vt({},s),{},{eventType:fr.WS_COMPRESSOR_INIT,lts:o,eventElapse:e.eventElapse,elapse:o-i.startTime,status:e.status?1:2});this.send({type:In.WS_COMPRESSOR_INIT,data:c},!0)}firstXLAPeerFirstVideoFrame(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),s=t.peerPubStatusMs-(n.lastJoinSuccessTime||i),o=vt(vt({},r),{},{elapse:i-n.startTime,eventType:fr.XLA_PEER_FIRST_VIDEO_FRAME,lts:i,peer:t.peer,width:t.width,height:t.height,ssrc:t.ssrc,p2pid:t.p2pid,peerPublishDuration:t.peerPublishDuration,joinChannelSuccessElapse:s,peerPubStatusMs:t.peerPubStatusMs-t.joinChannelStart,availablePublish:t.peerPublishDuration>s?1:0,preloadStart:Math.max(t.preloadStart-t.joinChannelStart,0),preloadEnd:Math.max(t.preloadEnd-t.joinChannelStart,0),encrypt:Math.max(t.apStart-t.joinChannelStart,0),ap:Math.max(t.apEnd-t.joinChannelStart,0),sua:Math.max(t.suaEnd-t.joinChannelStart,0),beforeConnect:Math.max(t.beforeConnect-t.joinChannelStart,0),peerRecevier:Math.max(t.peerReceiver-t.joinChannelStart,0),ice:Math.max(t.ice-t.joinChannelStart,0),pc:Math.max(t.pc-t.joinChannelStart,0),signalConnected:Math.max(t.signalConnected-t.joinChannelStart,0),joinReq:Math.max(t.joinReq-t.joinChannelStart,0),joinRes:Math.max(t.joinRes-t.joinChannelStart,0),userJoinNotify:Math.max(t.userJoinNotify-t.joinChannelStart,0),videoSsrcNotify:Math.max(t.videoAddNotify-t.joinChannelStart,0),subscribeDelayMs:Math.max(t.subscribeStart-t.videoAddNotify,0),subscribeStart:Math.max(t.subscribeStart-t.joinChannelStart,0),subscribeEnd:Math.max(t.subscribeEnd-t.joinChannelStart,0),firstReceived:Math.max(t.firstReceived-t.joinChannelStart,0),firstDecoded:Math.max(t.firstDecoded-t.joinChannelStart,0),firstPreRender:Math.max(t.firstPreRender-t.joinChannelStart,0),firstRender:Math.max(t.firstRender-t.joinChannelStart,0),playDelayMs:Math.max(t.playStart-t.subscribeEnd,0),playStart:Math.max(t.playStart-t.joinChannelStart,0),playEnd:Math.max(t.playEnd-t.joinChannelStart,0),isPreSub:t.isPreSub?1:0,isPrePc:t.isPrePc?1:0,isPreInstantVideo:t.isPreInstantVideo?1:0});this.send({type:In.XLA_PEER_FIRST_VIDEO_FRAME,data:o},!0)}firstRemoteVideoDecode(e,t,n,r){const i=this.baseInfoMap.get(e);if(!i)return;const s=i.info,o=Date.now(),c=vt(vt(vt({},s),r),{},{elapse:o-i.startTime,eventType:t,lts:o,firstDecodeFrame:Math.max((r.firstFrame||o)-i.startTime,0),apEnd:Math.max(r.apEnd-i.startTime,0),apStart:Math.max(r.apStart-i.startTime,0),joinGwEnd:Math.max(r.joinGwEnd-i.startTime,0),joinGwStart:Math.max(r.joinGwStart-i.startTime,0),pcEnd:Math.max(r.pcEnd-i.startTime,0),pcStart:Math.max(r.pcStart-i.startTime,0),subscriberEnd:Math.max(r.subscriberEnd-i.startTime,0),subscriberStart:Math.max(r.subscriberStart-i.startTime,0),videoAddNotify:Math.max(r.videoAddNotify-i.startTime,0)});this.send({type:n,data:c},!0)}firstRemoteFrame(e,t,n,r){const i=this.baseInfoMap.get(e);if(!i)return;const s=i.info,o=Date.now(),c=vt(vt(vt({},s),r),{},{elapse:o-i.startTime,eventType:t,lts:o});this.send({type:n,data:c},!0)}abTest(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),s=vt(vt(vt({},r),t),{},{vid:r.vid===void 0?0:Number(r.vid),elapse:i-n.startTime,eventType:fr.AB_TEST,lts:i});this.send({type:In.AB_TEST,data:s},!0)}pcStats(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),s=vt(vt(vt({},r),t),{},{vid:r.vid===void 0?0:Number(r.vid),elapse:i-n.startTime,eventType:fr.PC_STATS,lts:i,preallocation:t.preallocation?1:0});this.send({type:In.PC_STATS,data:s},!0)}updateRemoteRTPCapabilities(e,t){if(e){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),s=vt(vt(vt({},r),t),{},{vid:r.vid===void 0?0:Number(r.vid),eventType:fr.UPDATE_REMOTE_RTPCAPABILITIES,lts:i});this.send({type:In.UPDATE_REMOTE_RTPCAPABILITIES,data:s},!0)}}onGatewayStream(e,t,n,r){const i=this.baseInfoMap.get(e);if(!i)return;const s=i.info,o=Date.now(),c=vt(vt(vt({},s),r),{},{eventType:t,lts:o});this.send({type:n,data:c},!0)}streamSwitch(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),s=vt(vt({},r),{},{eventType:fr.STREAM_SWITCH,lts:i,isDual:t.isdual,elapse:i-n.startTime,success:t.succ});this.send({type:In.STREAM_SWITCH,data:s},!0)}requestProxyAppCenter(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),s=vt(vt({},r),{},{eventType:fr.REQUEST_PROXY_APPCENTER,lts:i,eventElapse:i-t.lts,elapse:i-n.startTime,APAddr:t.APAddr,workerManagerList:t.workerManagerList,response:t.response,errorCode:t.ec,success:t.succ});this.send({type:In.REQUEST_PROXY_APPCENTER,data:s},!0)}requestProxyWorkerManager(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),s=vt(vt({},r),{},{eventType:fr.REQUEST_PROXY_WORKER_MANAGER,lts:i,eventElapse:i-t.lts,elapse:i-n.startTime,workerManagerAddr:t.workerManagerAddr,response:t.response,errorCode:t.ec,success:t.succ});this.send({type:In.REQUEST_PROXY_WORKER_MANAGER,data:s},!0)}setProxyServer(e){this.proxyServer=e,e?w.debug("reportProxyServerurl: ".concat(e)):w.debug("disable reportProxyServerurl: ".concat(e))}peerPublishStatus(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),s=vt(vt({},r),{},{subscribeElapse:t.subscribeElapse,peer:t.peer,peerPublishDuration:Math.max(t.audioPublishDuration,t.videoPublishDuration),audiotag:t.audioPublishDuration>0?1:-1,videotag:t.videoPublishDuration>0?1:-1,lts:i,elapse:i-n.startTime,joinChannelSuccessElapse:i-(n.lastJoinSuccessTime||i),peerPublishDurationVideo:t.videoPublishDuration,peerPublishDurationAudio:t.audioPublishDuration});this.send({type:In.PEER_PUBLISH_STATUS,data:s},!0)}workerEvent(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now();(function(s,o,c){const d=s[o];if(!d||typeof d!="string")return[s];s[o]="";const h=wc(JSON.stringify(s));let f=0;const g=[];let E=0;for(let S=0;S<d.length;S++)E+=d.charCodeAt(S)<=127?1:3,E<=c-h||(g[g.length]=we(we({},s),{},{[o]:d.substring(f,S)}),f=S,E=d.charCodeAt(S)<=127?1:3);return f!==d.length-1&&(g[g.length]=we(we({},s),{},{[o]:d.substring(f)})),g})(vt(vt(vt({},r),t),{},{elapse:i-n.startTime,lts:i,productType:"WebRTC"}),"payload",1300).forEach((s=>this.send({type:In.WORKER_EVENT,data:s},!0)))}apworkerEvent(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),s=vt(vt(vt({},r),t),{},{elapse:i-n.startTime,lts:i});this.send({type:In.AP_WORKER_EVENT,data:s},!0)}joinWebProxyAP(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),s=vt(vt(vt({},r),t),{},{elapse:i-n.startTime,lts:i,extend:t.extend||void 0});this.send({type:In.JOIN_WEB_PROXY_AP,data:s},!0)}WebSocketQuit(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),s=vt(vt(vt({},r),t),{},{elapse:i-n.startTime,lts:i});this.send({type:In.WEBSOCKET_QUIT,data:s},!0)}async sendCustomReportMessage(e,t){if(this.customReportCount+=t.length,this.customReportCount>B("CUSTOM_REPORT_LIMIT"))throw new de(V.CUSTOM_REPORT_FREQUENCY_TOO_HIGH);this.customReportCounterTimer||(this.customReportCounterTimer=window.setInterval((()=>{this.customReportCount=0}),5e3));const n=Date.now(),r=t.map((i=>({type:In.USER_ANALYTICS,data:vt(vt({sid:e},i),{},{lts:n})})));try{B("NEW_REPORT_SERVER")?await this.postDataToStatsCollector2(r):await this.postDataToStatsCollector(r)}catch(i){throw w.error("send custom report message failed",i.toString()),new de(V.CUSTOM_REPORT_SEND_FAILED,i.message)}}sendApiInvoke(e){const t=B("NOT_REPORT_EVENT");if(e.tag&&be(t)&&be(t).call(t,e.tag))return!1;if(e.sid===null)return this.apiInvokeUploadPendingItems.push(e),!1;const n=this.baseInfoMap.get(e.sid);if(!n)return this.apiInvokeUploadPendingItems.push(e),!1;const{cname:r,uid:i,cid:s}=n.info;let o;if(e.lts=e.lts||Date.now(),e.error)if(e.error instanceof de){const{code:d,message:h}=e.error;o=d||h||e.error.toString()}else o=e.error.toString();const c={invokeId:e.invokeId,sid:e.sid,cname:r,cid:s,uid:i,lts:e.lts,success:e.success,elapse:e.lts-n.startTime,execElapse:e.lts-e.apiInvokeTime,apiName:e.name,options:e.options?JSON.stringify(e.options):void 0,execStates:e.states?JSON.stringify(e.states):void 0,execResult:e.result?JSON.stringify(e.result):void 0,errorCode:e.error?o:void 0,errorMsg:e.error?JSON.stringify(e.error):void 0};return this.send({type:In.API_INVOKE,data:c},!1),!0}addSid(e){this.sids.add(e)}removeSid(e){this.sids.delete(e)}appendSessionId(){const e=this.apiInvokeUploadPendingItems;if(e.length===0)return;const t=Array.from(this.sids).find((n=>n!==null));t&&e.forEach((n=>{n&&(n.sid=t,this.sendApiInvoke(Object.assign({},n)))})),e.length=0}send(e,t){if(t)return this.keyEventUploadPendingItems.push(e),void this.sendItems(this.keyEventUploadPendingItems,!0);this.normalEventUploadPendingItems.push(e),this.normalEventUploadPendingItems.length>B("NORMAL_EVENT_QUEUE_CAPACITY")&&this.normalEventUploadPendingItems.splice(0,1),this.normalEventUploadPendingItems.length>=10&&this.sendItems(this.normalEventUploadPendingItems,!1)}doSend(){this.keyEventUploadPendingItems.length>0&&this.sendItems(this.keyEventUploadPendingItems,!0),this.normalEventUploadPendingItems.length>0&&Date.now()-this.lastSendNormalEventTime>=5e3&&this.sendItems(this.normalEventUploadPendingItems,!1)}sendItems(e,t){const n=[],r=[];for(;e.length;){const s=e.shift();n.length<20?n.push(s):r.push(s)}e.push(...r);for(const s of[...n]){var i;this.ltsList.indexOf(s.data.lts)!==-1?(s.data.lts=this.ltsList[this.ltsList.length-1]+1,this.ltsList.push(s.data.lts)):(this.ltsList.push(s.data.lts),hh(i=this.ltsList).call(i,((o,c)=>o-c)))}return t||(this.lastSendNormalEventTime=Date.now()),B("ENABLE_EVENT_REPORT")&&n.length&&(B("NEW_REPORT_SERVER")?this.postDataToStatsCollector2(n):this.postDataToStatsCollector(n)).catch((s=>o=>{B("EVENT_REPORT_RETRY")&&(t?this.keyEventUploadPendingItems=this.keyEventUploadPendingItems.concat(s):(this.normalEventUploadPendingItems=this.normalEventUploadPendingItems.concat(s),this.normalEventUploadPendingItems.length>B("NORMAL_EVENT_QUEUE_CAPACITY")&&(this.normalEventUploadPendingItems.splice(0,this.normalEventUploadPendingItems.length-B("NORMAL_EVENT_QUEUE_CAPACITY")),w.warning("report: drop normal events"))))})(n)),e}async postDataToStatsCollector2(e){Qn.networkState===gs.OFFLINE&&await ke.race([Qn.onlineWaiter,xr(2*rr.maxRetryTimeout)]);const t=i=>{let s=new Uint8Array;return i.forEach((o=>{const c=cb(JSON.stringify(o.data)),d=new ArrayBuffer(5),h=(g=>{let E=0;return Object.entries(In).forEach((S=>{let[O,A]=S;A===g.type&&(E=r9[O])})),E})(o),f=new DataView(d);f.setUint16(0,c.byteLength,!0),f.setUint8(2,255&h),f.setUint8(3,h>>>8&255),f.setUint8(4,h>>>16&255),s=Qx(s,new Uint8Array(d)),s=Qx(s,c)})),s},n="event";let r=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(B("NEW_REPORT_SERVER_DOMAINS")[0],"&p=443&d=").concat(n):"https://".concat(B("NEW_REPORT_SERVER_DOMAINS")[0],"/").concat(n);for(let i=0;i<2;i+=1){i===1&&(r=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(B("NEW_REPORT_SERVER_DOMAINS")[1],"&p=443&d=").concat(n):"https://".concat(B("NEW_REPORT_SERVER_DOMAINS")[1],"/").concat(n));try{await mb(r,{timeout:1e4,data:t(e),headers:vt(vt({biz:"webrtc",sendts:Math.round(Date.now()/1e3),debug:"false"},this._appId&&{appid:this._appId}),{},{"Content-Type":"application/octet-stream"})},!0)}catch(s){if(i===1)throw s;continue}return}}async postDataToStatsCollector(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const n=(c=>{const d=c&&c.data.sid&&this.baseInfoMap.get(c.data.sid);return d&&d.info.vid&&+d.info.vid||0})(e[0]),r=n?void 0:this._aid,i={msgType:"EventMessages",sentTs:Math.round(Date.now()/1e3),payloads:e.map((c=>JSON.stringify(c))),vid:n,aid:r};Qn.networkState===gs.OFFLINE&&await ke.race([Qn.onlineWaiter,xr(2*rr.maxRetryTimeout)]);const s=t?"/events/proto-raws":"/events/messages";let o=this.url||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(B("EVENT_REPORT_DOMAIN"),"&p=").concat(B("STATS_COLLECTOR_PORT"),"&d=").concat(s):"https://".concat(B("EVENT_REPORT_DOMAIN"),":").concat(B("STATS_COLLECTOR_PORT")).concat(s));for(let c=0;c<2;c+=1){c===1&&(o=this.backupUrl||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(B("EVENT_REPORT_BACKUP_DOMAIN"),"&p=").concat(B("STATS_COLLECTOR_PORT"),"&d=").concat(s):"https://".concat(B("EVENT_REPORT_BACKUP_DOMAIN"),":").concat(B("STATS_COLLECTOR_PORT")).concat(s)));try{t?await WY(o,{timeout:1e4,data:i}):await mb(o,{timeout:1e4,data:i})}catch(d){if(c===1)throw d;continue}return}}createBaseInfo(e,t){const n=Object.assign({},n9);return n.sid=e,this.baseInfoMap.set(e,{info:n,startTime:t}),n}reportResourceTiming(e,t){const n=performance.getEntriesByName(e),r=n[n.length-1];r&&this.reportApiInvoke(t,{name:"Client.resourceTiming",options:r,tag:Nn.TRACER}).onSuccess()}};C1.on("REPORT_LOG_UPLOAD",(e=>{e.networkState=Qn.networkState,We.reportApiInvoke(null,{name:"logUploadError",options:e,tag:Nn.TRACER}).onSuccess("logUploadError")}));class le extends de{constructor(t){super(t,arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",arguments.length>2?arguments[2]:void 0),Fn(this,"name","AgoraRTCException")}print(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error";return super.print(t,w)}throw(){super.throw(w)}}const Lr={getDisplayMedia:!1,getStreamFromExtension:!1,supportUnifiedPlan:!1,supportMinBitrate:!1,supportSetRtpSenderParameters:!1,supportDualStream:!0,webAudioMediaStreamDest:!1,supportReplaceTrack:!1,supportWebGL:!1,webAudioWithAEC:!1,supportRequestFrame:!1,supportShareAudio:!1,supportDualStreamEncoding:!1,supportDataChannel:!1,supportPCSetConfiguration:!1,supportWebRTCEncodedTransform:!1,supportWebRTCInsertableStream:!1,supportRequestVideoFrameCallback:!1,supportWebCrypto:!1};function Bt(){return Lr}function A1(){return"setSinkId"in HTMLAudioElement.prototype&&(!B("RESTRICTION_SET_PLAYBACK_DEVICE")||(El()||Vx())&&!sb())}function QS(){return!Lr.supportUnifiedPlan||B("CHROME_FORCE_PLAN_B")&&vl()}function Ib(e){return!(jn()||Fx(87)||QS()||!B("ENABLE_PRE_SUB")&&(e==null||!e.autoSubscribe||B("FORCE_DISABLE_AUTO_SUB")))}function N1(e){return!!B("ENABLE_INSTANT_VIDEO")||!(e==null||!e.autoSubscribe||B("FORCE_DISABLE_AUTO_SUB"))}let Mr=(function(e){return e.IOS_15_16_INTERRUPTION_START="ios15_16-interruption-start",e.IOS_15_16_INTERRUPTION_END="ios15_16-interruption-end",e.IOS_INTERRUPTION_START="ios-interruption-start",e.IOS_INTERRUPTION_END="ios-interruption-end",e.STATE_CHANGE="state-change",e})({});function Ff(e,t,n){return{sampleRate:e,stereo:t,bitrate:n}}function Wt(e,t,n,r,i){return{width:e,height:t,frameRate:n,bitrateMin:r,bitrateMax:i}}function Bo(e,t,n,r,i){return{width:{max:e},height:{max:t},frameRate:n,bitrateMin:r,bitrateMax:i}}function Ab(e,t){return{numSpatialLayers:e,numTemporalLayers:t}}const i9={"90p":Wt(160,90),"90p_1":Wt(160,90),"120p":Wt(160,120,15,30,65),"120p_1":Wt(160,120,15,30,65),"120p_3":Wt(120,120,15,30,50),"120p_4":Wt(212,120),"180p":Wt(320,180,15,30,140),"180p_1":Wt(320,180,15,30,140),"180p_3":Wt(180,180,15,30,100),"180p_4":Wt(240,180,15,30,120),"240p":Wt(320,240,15,40,200),"240p_1":Wt(320,240,15,40,200),"240p_3":Wt(240,240,15,40,140),"240p_4":Wt(424,240,15,40,220),"360p":Wt(640,360,15,80,400),"360p_1":Wt(640,360,15,80,400),"360p_3":Wt(360,360,15,80,260),"360p_4":Wt(640,360,30,80,600),"360p_6":Wt(360,360,30,80,400),"360p_7":Wt(480,360,15,80,320),"360p_8":Wt(480,360,30,80,490),"360p_9":Wt(640,360,15,80,800),"360p_10":Wt(640,360,24,80,800),"360p_11":Wt(640,360,24,80,1e3),"480p":Wt(640,480,15,100,500),"480p_1":Wt(640,480,15,100,500),"480p_2":Wt(640,480,30,100,1e3),"480p_3":Wt(480,480,15,100,400),"480p_4":Wt(640,480,30,100,750),"480p_6":Wt(480,480,30,100,600),"480p_8":Wt(848,480,15,100,610),"480p_9":Wt(848,480,30,100,930),"480p_10":Wt(640,480,10,100,400),"720p":Wt(1280,720,15,120,1130),"720p_auto":Wt(1280,720,30,900,3e3),"720p_1":Wt(1280,720,15,120,1130),"720p_2":Wt(1280,720,30,120,2e3),"720p_3":Wt(1280,720,30,120,1710),"720p_5":Wt(960,720,15,120,910),"720p_6":Wt(960,720,30,120,1380),"1080p":Wt(1920,1080,15,120,2080),"1080p_1":Wt(1920,1080,15,120,2080),"1080p_2":Wt(1920,1080,30,120,3e3),"1080p_3":Wt(1920,1080,30,120,3150),"1080p_5":Wt(1920,1080,60,120,4780),"1440p":Wt(2560,1440,30,120,4850),"1440p_1":Wt(2560,1440,30,120,4850),"1440p_2":Wt(2560,1440,60,120,7350),"4k":Wt(3840,2160,30,120,8910),"4k_1":Wt(3840,2160,30,120,8910),"4k_3":Wt(3840,2160,60,120,13500)},s9={"480p":Bo(640,480,5),"480p_1":Bo(640,480,5),"480p_2":Bo(640,480,30),"480p_3":Bo(640,480,15),"720p":Bo(1280,720,5),"720p_auto":Wt(1280,720,30,900,3e3),"720p_1":Bo(1280,720,5),"720p_2":Bo(1280,720,30),"720p_3":Bo(1280,720,15),"1080p":Bo(1920,1080,5),"1080p_1":Bo(1920,1080,5),"1080p_2":Bo(1920,1080,30),"1080p_3":Bo(1920,1080,15)},o9={"1SL1TL":Ab(1,1),"3SL3TL":Ab(3,3),"2SL3TL":Ab(2,3)};function Wo(e){return e||(e="480p_1"),typeof e=="string"?Object.assign({},i9[e]):e}function Nb(e){return typeof e=="string"?Object.assign({},s9[e]):e}function ZS(e){return typeof e=="string"?Object.assign({},o9[e]):e}const a9={speech_low_quality:Ff(16e3,!1),speech_standard:Ff(32e3,!1,18),music_standard:Ff(48e3,!1),standard_stereo:Ff(48e3,!0,56),high_quality:Ff(48e3,!1,128),high_quality_stereo:Ff(48e3,!0,192)};function $S(e){return typeof e=="string"?Object.assign({},a9[e]):e}const Bf=[];function O1(e){return pr(e,"mediaSource",["screen","window","application"]),!0}let Ve=(function(e){return e.NEED_RENEGOTIATE="@need_renegotiate",e.NEED_REPLACE_TRACK="@need_replace_track",e.NEED_REPLACE_MIXING_TRACK="@need_replace_mixing_track",e.NEED_CLOSE="@need_close",e.NEED_ENABLE_TRACK="@need_enable_track",e.NEED_DISABLE_TRACK="@need_disable_track",e.NEED_SESSION_ID="@need_sid",e.SET_OPTIMIZATION_MODE="@set_optimization_mode",e.GET_STATS="@get_stats",e.GET_RTC_STATS="@get_rtc_stats",e.GET_LOW_VIDEO_TRACK="@get_low_video_track",e.NEED_RESET_REMOTE_SDP="@need_reset_remote_sdp",e.NEED_UPDATE_VIDEO_ENCODER="@need_update_video_encoder",e.NEED_UPDATE_VIDEO_SEND_PARAMETERS="@need_update_video_send_parameters",e.NEED_MUTE_TRACK="@need_mute_track",e.NEED_UNMUTE_TRACK="@need_unmute_track",e})({}),ln=(function(e){return e.SCREEN_TRACK="screen_track",e.CUSTOM_TRACK="custome_track",e.LOW_STREAM="low_stream",e.SCREEN_LOW_TRACK="screen_low_track",e})({}),Wf=(function(e){return e[e.HIGH_STREAM=0]="HIGH_STREAM",e[e.LOW_STREAM=1]="LOW_STREAM",e})({}),c9=(function(e){return e[e.HIGH_STREAM=0]="HIGH_STREAM",e[e.LOW_STREAM=1]="LOW_STREAM",e[e.HIGH_STREAM_LAYER1=4]="HIGH_STREAM_LAYER1",e[e.HIGH_STREAM_LAYER2=5]="HIGH_STREAM_LAYER2",e[e.HIGH_STREAM_LAYER3=6]="HIGH_STREAM_LAYER3",e[e.HIGH_STREAM_LAYER4=7]="HIGH_STREAM_LAYER4",e[e.HIGH_STREAM_LAYER5=8]="HIGH_STREAM_LAYER5",e[e.HIGH_STREAM_LAYER6=9]="HIGH_STREAM_LAYER6",e})({}),l9=(function(e){return e[e.DISABLE=0]="DISABLE",e[e.LOW_STREAM=1]="LOW_STREAM",e[e.AUDIO_ONLY=2]="AUDIO_ONLY",e[e.HIGH_STREAM_LAYER1=3]="HIGH_STREAM_LAYER1",e[e.HIGH_STREAM_LAYER2=4]="HIGH_STREAM_LAYER2",e[e.HIGH_STREAM_LAYER3=5]="HIGH_STREAM_LAYER3",e[e.HIGH_STREAM_LAYER4=6]="HIGH_STREAM_LAYER4",e[e.HIGH_STREAM_LAYER5=7]="HIGH_STREAM_LAYER5",e[e.HIGH_STREAM_LAYER6=8]="HIGH_STREAM_LAYER6",e})({}),Ch=(function(e){return e.TRANSCEIVER_UPDATED="transceiver-updated",e.SEI_TO_SEND="sei-to-send",e.SEI_RECEIVED="sei-received",e.TRACK_UPDATED="track-updated",e})({}),Gf=(function(e){return e.SOURCE_STATE_CHANGE="source-state-change",e.TRACK_ENDED="track-ended",e.BEAUTY_EFFECT_OVERLOAD="beauty-effect-overload",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",e.CLOSED="closed",e})({}),so=(function(e){return e.FIRST_FRAME_DECODED="first-frame-decoded",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",e.VIDEO_STATE_CHANGED="video-state-changed",e.PLAY_START="play-start",e.PLAY_END="play-end",e.FIRST_FRAME_RENDER="first-frame-render",e})({}),Hf=(function(e){return e.AUDIO="audio",e.VIDEO="video",e.DATA="data",e})({}),Os=(function(e){return e.AUDIO_SOURCE_STATE_CHANGE="audio_source_state_change",e.RECEIVE_TRACK_BUFFER="receive_track_buffer",e.ON_AUDIO_BUFFER="on_audio_buffer",e.UPDATE_SOURCE="update_source",e})({});(function(e){e.UPDATE_TRACK_SOURCE="update-track-source"})({});const Ob={sendVolumeLevel:0,sendBitrate:0,sendBytes:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,currentPacketLossRate:0},Pb={sendBytes:0,sendBitrate:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,sendResolutionHeight:0,sendResolutionWidth:0,captureResolutionHeight:0,captureResolutionWidth:0,targetSendBitrate:0,totalDuration:0,totalFreezeTime:0,currentPacketLossRate:0},P1={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveLevel:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receivePacketsDiscarded:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},d9={uplinkNetworkQuality:0,downlinkNetworkQuality:0},D1={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receiveResolutionHeight:0,receiveResolutionWidth:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1};let bi=(function(e){return e.ON_TRACK="on_track",e.ON_NODE="on_node",e})({}),Ps=(function(e){return e.REQUEST_UPDATE_CONSTRAINTS="request_update_constraints",e.REQUEST_CONSTRAINTS="request_constraints",e})({}),nE=(function(e){return e.IDLE="IDLE",e.INITING="INITING",e.INITEND="INITEND",e})({}),bh=(function(e){return e.STATE_CHANGE="state_change",e.RECORDING_DEVICE_CHANGED="recordingDeviceChanged",e.PLAYOUT_DEVICE_CHANGED="playoutDeviceChanged",e.CAMERA_DEVICE_CHANGED="cameraDeviceChanged",e})({}),Qr=(function(e){return e.NONE="none",e.INIT="init",e.CANPLAY="canplay",e.PLAYING="playing",e.PAUSED="paused",e.SUSPEND="suspend",e.STALLED="stalled",e.WAITING="waiting",e.ERROR="error",e.DESTROYED="destroyed",e.ABORT="abort",e.ENDED="ended",e.EMPTIED="emptied",e.LOADEDDATA="loadeddata",e})({}),bc=(function(e){return e[e.VideoStateStopped=0]="VideoStateStopped",e[e.VideoStateStarting=1]="VideoStateStarting",e[e.VideoStateDecoding=2]="VideoStateDecoding",e[e.VideoStateFrozen=3]="VideoStateFrozen",e})({});const Db={uninit:100,none:110,init:120,loadeddata:130,canplay:200,playing:210,paused:220,suspend:300,stalled:310,waiting:320,error:330,destroyed:340,abort:350,ended:360,emptied:370};let eT=(function(e){return e.OPEN="open",e.MESSAGE="message",e.CLOSE="close",e.CLOSING="closing",e.ERROR="error",e})({});function Lt(e,t,n,r,i){var s,o,c={};return Object.keys(r).forEach((function(d){c[d]=r[d]})),c.enumerable=!!c.enumerable,c.configurable=!!c.configurable,("value"in c||c.initializer)&&(c.writable=!0),c=Yi(s=xu(o=n.slice()).call(o)).call(s,(function(d,h){return h(e,t,d)||d}),c),i&&c.initializer!==void 0&&(c.value=c.initializer?c.initializer.call(i):void 0,c.initializer=void 0),c.initializer===void 0?(Object.defineProperty(e,t,c),null):c}function oe(e,t,n){return(t=(function(r){var i=(function(s,o){if(typeof s!="object"||!s)return s;var c=s[Symbol.toPrimitive];if(c!==void 0){var d=c.call(s,"string");if(typeof d!="object")return d;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(s)})(r);return typeof i=="symbol"?i:i+""})(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function k1(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable}))),n.push.apply(n,r)}return n}function En(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?k1(Object(n),!0).forEach((function(r){oe(e,r,n[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):k1(Object(n)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))}))}return e}class x1 extends xn{set _mediaStreamTrack(t){t!==this.mediaStreamTrack&&(this.safeEmit(Ch.TRACK_UPDATED,t),this.mediaStreamTrack=t)}get _mediaStreamTrack(){return this.mediaStreamTrack}constructor(t,n){super(),oe(this,"trackMediaType",void 0),oe(this,"_ID",void 0),oe(this,"_rtpTransceiver",void 0),oe(this,"_lowRtpTransceiver",void 0),oe(this,"_hints",[]),oe(this,"_isClosed",!1),oe(this,"_originMediaStreamTrack",void 0),oe(this,"mediaStreamTrack",void 0),oe(this,"_external",{}),this._ID=n||hn(8,"track-"),this._originMediaStreamTrack=t,this.mediaStreamTrack=t,(function(r){be(Bf).call(Bf,r)||Bf.push(r)})(this)}toString(){return this._ID}getTrackId(){return this._ID}getMediaStreamTrack(t){return t||Id((()=>{var n;We.reportApiInvoke(null,{name:Gn.GET_MEDIA_STREAM_TRACK,options:[],tag:Nn.TRACER}).onSuccess(((n=this._mediaStreamTrack)===null||n===void 0?void 0:n.label)||"")}),this.mediaStreamTrack.id||this.getTrackId()),this._mediaStreamTrack}getRTCRtpTransceiver(t){return t===Wf.LOW_STREAM?this._lowRtpTransceiver:this._rtpTransceiver}getMediaStreamTrackSettings(){return this.getMediaStreamTrack(!0).getSettings()}close(){this._isClosed=!0,this._lowRtpTransceiver=void 0,this._rtpTransceiver=void 0,(function(t){const n=Bf.indexOf(t);n!==-1&&Bf.splice(n,1)})(this),this.emit(Gf.CLOSED),this.removeAllListeners(Ch.SEI_RECEIVED)}_updateRtpTransceiver(t,n){if(n===Wf.LOW_STREAM){if(this._lowRtpTransceiver===t)return;this._lowRtpTransceiver=t}else{if(this._rtpTransceiver===t)return;this._rtpTransceiver=t}this.emit(Ch.TRANSCEIVER_UPDATED,t,n)}}class Kf extends x1{get isExternalTrack(){return this._isExternalTrack}get muted(){return this._muted}get enabled(){return this._enabled}get processorContext(){return this._processorContext}constructor(t,n){super(t,n),oe(this,"_enabled",!0),oe(this,"_muted",!1),oe(this,"_isExternalTrack",!1),oe(this,"_isClosed",!1),oe(this,"_enabledMutex",void 0),oe(this,"processor",void 0),oe(this,"_processorContext",void 0),oe(this,"_handleTrackEnded",(()=>{this.onTrackEnded()})),this._enabledMutex=new Jr("".concat(this.getTrackId())),t.addEventListener("ended",this._handleTrackEnded)}getTrackLabel(){var t,n;return(t=(n=this._originMediaStreamTrack)===null||n===void 0?void 0:n.label)!==null&&t!==void 0?t:""}close(){this._isClosed||(this.stop(),this._originMediaStreamTrack.stop(),this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack.stop(),this._mediaStreamTrack=null),this._originMediaStreamTrack=null,this._enabledMutex=null,w.debug("[".concat(this.getTrackId(),"] close")),this.emit(Ve.NEED_CLOSE),super.close())}async _updateOriginMediaStreamTrack(t,n){let r=arguments.length>2&&arguments[2]!==void 0&&arguments[2];this._isExternalTrack=r,t!==this._originMediaStreamTrack&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),n&&this._originMediaStreamTrack.stop()),t.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=t,this._muted&&(this._originMediaStreamTrack.enabled=!1),this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await un(this,Ve.NEED_REPLACE_TRACK,this),this.processor&&this._processorContext&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this._processorContext}))}_getDefaultPlayerConfig(){return{}}onTrackEnded(){w.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(Gf.TRACK_ENDED)}stateCheck(t,n){if(w.debug("check track state, [muted: ".concat(this._muted,", enabled: ").concat(this._enabled,"] to [").concat(t,": ").concat(n,"]")),wa(n,t),this._enabled&&this._muted&&t==="enabled"&&n===!1)throw new de(V.TRACK_STATE_UNREACHABLE,"cannot set enabled while the track is muted").print("error",w);if(!this._enabled&&!this._muted&&t==="muted"&&n===!0)throw new de(V.TRACK_STATE_UNREACHABLE,"cannot set muted while the track is disabled").print("error",w)}getProcessorStats(){return this._processorContext&&this._processorContext.gatherStats()||[]}getProcessorUsage(){return this._processorContext?this._processorContext.gatherUsage():ke.resolve([])}}const L1=window.AudioContext||window.webkitAudioContext;let Ds=null;const on=new class extends xn{constructor(){super(...arguments),oe(this,"prevState",void 0),oe(this,"curState",void 0),oe(this,"currentTime",void 0),oe(this,"currentTimeStuckAt",void 0),oe(this,"interruptDetectorTrack",void 0),oe(this,"onLocalAudioTrackMute",(()=>{w.info("ios15-interruption-start"),this.emit(Mr.IOS_15_16_INTERRUPTION_START)})),oe(this,"onLocalAudioTrackUnmute",(async()=>{w.info("ios15-interruption-end"),this.curState!=="running"||this.duringInterruption?w.info("ios15-interruption-end-canceled"):(Ds&&await Ds.suspend(),this.emit(Mr.IOS_15_16_INTERRUPTION_END))}))}get duringInterruption(){return this.prevState==="running"&&this.curState==="interrupted"}bindInterruptDetectorTrack(e){w.debug("webaudio bindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack||(this.interruptDetectorTrack=e,this.interruptDetectorTrack._mediaStreamTrack.onmute=this.onLocalAudioTrackMute,this.interruptDetectorTrack._mediaStreamTrack.onunmute=this.onLocalAudioTrackUnmute)}unbindInterruptDetectorTrack(e){w.debug("webaudio unbindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack&&this.interruptDetectorTrack===e&&(this.interruptDetectorTrack._mediaStreamTrack&&(this.interruptDetectorTrack._mediaStreamTrack.onmute=null,this.interruptDetectorTrack._mediaStreamTrack.onunmute=null),this.interruptDetectorTrack=void 0)}};function zf(){if(!Ds){if((function(){if(!L1)return void w.error("your browser is not support web audio");w.info("create audio context");const e=En({},B("WEBAUDIO_INIT_OPTIONS"));w.debug("audio context init option:",JSON.stringify(e)),Ds=new L1(e),on.curState=Ds.state,Ds.onstatechange=()=>{on.prevState=on.curState,on.curState=Ds?Ds.state:void 0;const{prevState:t,curState:n}=on,r=n==="running",i=n==="interrupted",s=t==="running",o=t==="suspended",c=t==="interrupted",d=Mt().osVersion;(ii()||Vo())&&s&&i&&(w.info("ios".concat(d,"-interruption-start")),on.emit(Mr.IOS_INTERRUPTION_START)),(ii()||Vo())&&(o||c)&&r&&(w.info("ios".concat(d,"-interruption-end")),on.emit(Mr.IOS_INTERRUPTION_END)),t!==n&&on.emit(Mr.STATE_CHANGE,n,t)},setInterval((()=>{var t;const n=(t=Ds)===null||t===void 0?void 0:t.currentTime;on.currentTime!==n?(on.currentTimeStuckAt&&(w.debug("AudioContext current time resume at ".concat(n)),on.currentTimeStuckAt=void 0),on.currentTime=n):(n!==on.currentTimeStuckAt&&(We.reportApiInvoke(null,{name:"WEB_AUDIO_CURRENT_TIME_STUCK",options:{currentTime:n},tag:Nn.TRACER}).onSuccess(),w.warning("AudioContext current time stuck at ".concat(n))),on.currentTimeStuckAt=n)}),5e3),(async function(t){const n=["click","contextmenu","auxclick","dblclick","mousedown","mouseup","touchend","keydown","keyup"];let r,i=!1,s=!1,o=!1;function c(A){t.state==="running"?d(!1):ii()||Vo()?t.state==="suspended"&&(d(!0),A&&t.resume().then(h,h)):t.state!=="closed"&&(d(!0),A&&t.resume().then(h,h))}function d(A){if(i!==A){i=A;for(let N=0,j=n;N<j.length;N+=1){const U=j[N];A?window.addEventListener(U,f,{capture:!0,passive:!0}):window.removeEventListener(U,f,{capture:!0,passive:!0})}}}function h(){c(!1)}function f(){c(!0)}function g(A){if(!o)if(r.paused)if(A){let N;E(!1),o=!0;try{N=r.play(),N?N.then(S,S):(r.addEventListener("playing",S),r.addEventListener("abort",S),r.addEventListener("error",S))}catch{S()}}else E(!0);else E(!1)}function E(A){if(s!==A){s=A;for(let N=0,j=n;N<j.length;N++){const U=j[N];A?window.addEventListener(U,O,{capture:!0,passive:!0}):window.removeEventListener(U,O,{capture:!0,passive:!0})}}}function S(){r.removeEventListener("playing",S),r.removeEventListener("abort",S),r.removeEventListener("error",S),o=!1,g(!1)}function O(){g(!0)}if(ii()){const A=t.createMediaStreamDestination(),N=document.createElement("div");N.innerHTML="<audio x-webkit-airplay='deny'></audio>",r=N.children.item(0),r.controls=!1,r.disableRemotePlayback=!0,r.preload="auto",r.srcObject=A.stream,g(!0)}on.on(Mr.STATE_CHANGE,(function(){c(!0)})),c(!1)})(Ds)})(),!Ds)throw new de(V.NOT_SUPPORTED,"can not create audio context");return Ds}return Ds}function Ih(e){if((function(){if(kb!==null)return kb;const r=zf(),i=r.createBufferSource(),s=r.createGain(),o=r.createGain();i.connect(s),i.connect(o),i.disconnect(s);let c=!1;try{i.disconnect(s)}catch{c=!0}return i.disconnect(),kb=c,c})())return;const t=e.connect,n=e.disconnect;e.connect=(r,i,s)=>{var o;return e._inputNodes||(e._inputNodes=[]),be(o=e._inputNodes).call(o,r)||(r instanceof AudioNode?(e._inputNodes.push(r),t.call(e,r,i,s)):t.call(e,r,i)),e},e.disconnect=(r,i,s)=>{n.call(e),r?GS(e._inputNodes,r):e._inputNodes=[];for(const o of e._inputNodes)t.call(e,o)}}let kb=null;function xb(e,t){let n=!1;const r=1/t;if(B("DISABLE_WEBAUDIO")){const i=window.setInterval((()=>{n?window.clearInterval(i):e(performance.now()/1e3)}),1e3*r)}else{const i=zf();let s=i.createGain();s.gain.value=0,s.connect(i.destination);const o=()=>{if(n)return void(s=null);const c=i.createOscillator();c.onended=o,c.connect(s),c.start(0),c.stop(i.currentTime+r),e(i.currentTime)};o()}return()=>{n=!0}}class M1{constructor(){oe(this,"context",void 0),oe(this,"analyserNode",void 0),oe(this,"sourceNode",void 0),this.context=zf(),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4}updateSource(t){if(t!==this.sourceNode){if(this.sourceNode)try{this.sourceNode.disconnect(this.analyserNode)}catch{}this.sourceNode=t,t?.connect(this.analyserNode)}}getVolumeLevel(){if(!this.sourceNode||(!this.context||ii()||Vo()||this.context.state!=="running"&&this.context.resume(),!this.analyserNode))return 0;const t=new Float32Array(this.analyserNode.fftSize);if(this.analyserNode.getFloatTimeDomainData)this.analyserNode.getFloatTimeDomainData(t);else{const r=new Uint8Array(this.analyserNode.fftSize);this.analyserNode.getByteTimeDomainData(r);for(let i=0;i<t.length;++i)t[i]=r[i]/128-1}const n=Yi(t).call(t,((r,i)=>r+i*i),0)/t.length;return Math.max(10*Math.log10(n)+100,0)/100}getAnalyserNode(){return this.analyserNode}rebuildAnalyser(){try{var t,n;(t=this.sourceNode)===null||t===void 0||t.disconnect(this.analyserNode),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4,(n=this.sourceNode)===null||n===void 0||n.connect(this.analyserNode)}catch{w.warning("rebuild analyser node failed.")}}destroy(){this.updateSource(void 0)}}class U1 extends xn{get processSourceNode(){return this.sourceNode}set processedNode(t){var n;if(!this.isDestroyed&&this._processedNode!==t){try{var r;(r=this.sourceNode)===null||r===void 0||r.disconnect(this.outputNode)}catch{}(n=this._processedNode)===null||n===void 0||n.disconnect(),this._processedNode=t,this.connect()}}get processedNode(){return this._processedNode}constructor(){super(),oe(this,"outputNode",void 0),oe(this,"outputTrack",void 0),oe(this,"isPlayed",!1),oe(this,"sourceNode",void 0),oe(this,"context",void 0),oe(this,"audioBufferNode",void 0),oe(this,"destNode",void 0),oe(this,"audioOutputLevel",0),oe(this,"volumeLevelAnalyser",void 0),oe(this,"_processedNode",void 0),oe(this,"playNode",void 0),oe(this,"isDestroyed",!1),oe(this,"onNoAudioInput",void 0),oe(this,"isNoAudioInput",!1),oe(this,"_noAudioInputCount",0),this.context=zf(),this.playNode=this.context.destination,this.outputNode=this.context.createGain(),Ih(this.outputNode),this.volumeLevelAnalyser=new M1}startGetAudioBuffer(t){this.audioBufferNode||(this.audioBufferNode=this.context.createScriptProcessor(t),this.outputNode.connect(this.audioBufferNode),this.audioBufferNode.connect(this.context.destination),this.audioBufferNode.onaudioprocess=n=>{this.emit(Os.ON_AUDIO_BUFFER,(function(r){for(let i=0;i<r.outputBuffer.numberOfChannels;i+=1){const s=r.outputBuffer.getChannelData(i);for(let o=0;o<s.length;o+=1)s[o]=0}return r.inputBuffer})(n))})}stopGetAudioBuffer(){this.audioBufferNode&&(this.audioBufferNode.onaudioprocess=null,this.outputNode.disconnect(this.audioBufferNode),this.audioBufferNode=void 0)}createOutputTrack(){if(!Bt().webAudioMediaStreamDest)throw new de(V.NOT_SUPPORTED,"your browser is not support audio processor");return this.destNode&&this.outputTrack||(this.destNode=this.context.createMediaStreamDestination(),this.outputNode.connect(this.destNode),this.outputTrack=this.destNode.stream.getAudioTracks()[0]),this.outputTrack}play(t){this.context.state!=="running"&&HS((()=>{on.emit("autoplay-failed")})),this.isPlayed=!0,this.playNode=t||this.context.destination,this.outputNode.connect(this.playNode)}stop(){if(this.isPlayed)try{this.outputNode.disconnect(this.playNode)}catch{}this.isPlayed=!1}getAccurateVolumeLevel(){return this.volumeLevelAnalyser.getVolumeLevel()}async checkHasAudioInput(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;if(t>5)return this.isNoAudioInput=!0,this.onNoAudioInput&&this.onNoAudioInput(),!1;ii()||Vo()?this.context.state==="suspended"&&this.context.resume():this.context.state!=="running"&&this.context.resume();const n=this.volumeLevelAnalyser.getAnalyserNode();let r;n.getFloatTimeDomainData?(r=new Float32Array(n.fftSize),n.getFloatTimeDomainData(r)):(r=new Uint8Array(n.fftSize),n.getByteTimeDomainData(r));let i=!1;for(let s=0;s<r.length;s++)r[s]!==0&&(i=!0);return i?(this.isNoAudioInput=!1,!0):(await xr(200),await this.checkHasAudioInput(t?t+1:1)&&i)}getAudioVolume(){return this.outputNode.gain.value}setVolume(t){this.outputNode.gain.setValueAtTime(t,this.context.currentTime)}destroy(){this.disconnect(),this.stop(),this.isDestroyed=!0,this.onNoAudioInput=void 0}disconnect(){var t,n;(t=this.processedNode)===null||t===void 0||t.disconnect(),(n=this.sourceNode)===null||n===void 0||n.disconnect(),this.outputNode&&this.outputNode.disconnect()}connect(){var t;this.processedNode?(t=this.processedNode)===null||t===void 0||t.connect(this.outputNode):this.sourceNode&&this.sourceNode.connect(this.outputNode),this.volumeLevelAnalyser.updateSource(this.outputNode)}}class j1 extends U1{get isFreeze(){return!1}constructor(t,n,r){var i;if(super(),oe(this,"sourceNode",void 0),oe(this,"track",void 0),oe(this,"clonedTrack",void 0),oe(this,"audioElement",void 0),oe(this,"isCurrentTrackCloned",!1),oe(this,"isRemoteTrack",!1),oe(this,"originVolumeLevelAnalyser",void 0),oe(this,"rebuildWebAudio",(async()=>{if(w.debug("ready to rebuild web audio, state:",this.context.state),this.isNoAudioInput&&await this.checkHasAudioInput(),!this.isNoAudioInput||this.isDestroyed)return document.body.removeEventListener("click",this.rebuildWebAudio,!0),void w.debug("rebuild web audio success, current volume status",this.getAccurateVolumeLevel());this.context.resume().then((()=>w.info("resume success"))),w.debug("rebuild web audio because of ios 12 bugs"),this.disconnect();const c=this.track;this.track=this.track.clone(),this.isCurrentTrackCloned?c.stop():this.isCurrentTrackCloned=!0;const d=new MediaStream([this.track]);this.sourceNode=this.context.createMediaStreamSource(d),Ih(this.sourceNode),this.volumeLevelAnalyser.rebuildAnalyser();const h=this.outputNode.gain.value;this.outputNode=this.context.createGain(),this.outputNode.gain.setValueAtTime(h,this.context.currentTime),Ih(this.outputNode),this.emit(Os.UPDATE_SOURCE),this.connect(),this.audioElement.srcObject=d,this.isPlayed&&this.play(this.playNode),this.checkHasAudioInput()})),t.kind!=="audio")throw new de(V.UNEXPECTED_ERROR);this.track=t;const s=new MediaStream([this.track]);if(this.isRemoteTrack=!!n,this.sourceNode=this.context.createMediaStreamSource(s),Ih(this.sourceNode),r){const c=r.clone();c.enabled=!0,this.clonedTrack=c,w.debug("create an unmuted track ".concat(c.id," from the original track ").concat(r.id," to get the volume"));const d=this.context.createMediaStreamSource(new MediaStream([c]));Ih(d),this.originVolumeLevelAnalyser=new M1,this.originVolumeLevelAnalyser.updateSource(d)}this.connect(),this.audioElement=document.createElement("audio"),this.audioElement.srcObject=s;const o=Mt();n&&o.os===Er.IOS&&Number((i=o.osVersion)===null||i===void 0?void 0:i.split(".")[0])<15&&(on.on(Mr.STATE_CHANGE,(()=>{this.context.state==="suspended"?document.body.addEventListener("click",this.rebuildWebAudio,!0):this.context.state==="running"&&this.rebuildWebAudio()})),this.checkHasAudioInput().then((c=>{c||document.body.addEventListener("click",this.rebuildWebAudio,!0)})))}updateTrack(t){this.sourceNode.disconnect(),this.track=t,this.isCurrentTrackCloned=!1;const n=new MediaStream([t]);this.sourceNode=this.context.createMediaStreamSource(n),Ih(this.sourceNode),this.processedNode||this.sourceNode.connect(this.outputNode),this.emit(Os.UPDATE_SOURCE),this.audioElement.srcObject=n}destroy(){var t;this.audioElement.srcObject=null,this.audioElement.remove(),on.off("state-change",this.rebuildWebAudio),(t=this.originVolumeLevelAnalyser)===null||t===void 0||t.destroy(),this.clonedTrack=void 0,super.destroy()}createMediaStreamSourceNode(t){return this.context.createMediaStreamSource(new MediaStream([t]))}updateOriginTrack(t){const n=t.clone();n.enabled=!0,this.clonedTrack&&(this.clonedTrack.stop(),this.clonedTrack=n),w.debug("create an unmuted track ".concat(n.id," from the original track ").concat(t.id," to get the volume"));const r=this.context.createMediaStreamSource(new MediaStream([n]));Ih(r),this.originVolumeLevelAnalyser&&this.originVolumeLevelAnalyser.updateSource(r)}getOriginVolumeLevel(){return this.originVolumeLevelAnalyser?this.originVolumeLevelAnalyser.getVolumeLevel():this.getAccurateVolumeLevel()}}async function V1(e,t,n){const r=(s,o)=>s?typeof s!="number"?s.max||s.exact||s.ideal||s.min||o:s:o,i={audio:!!n&&{mandatory:{chromeMediaSource:"desktop"}},video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:e,maxHeight:r(t.height,1080),maxWidth:r(t.width,1920)}}};return t.frameRate&&typeof t.frameRate!="number"?(i.video.mandatory.maxFrameRate=t.frameRate.max,i.video.mandatory.minFrameRate=t.frameRate.min):typeof t.frameRate=="number"&&(i.video.mandatory.maxFrameRate=t.frameRate),await navigator.mediaDevices.getUserMedia(i)}async function u9(e,t){const n=await F1(e.mediaSource),{sourceId:r,audio:i}=await(function(s){let o=arguments.length>1&&arguments[1]!==void 0&&arguments[1];return new ke(((c,d)=>{const h=document.createElement("div");h.innerText="share screen",h.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;");const f=document.createElement("div");f.setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;");const g=document.createElement("div");g.innerText="Agora Web Screensharing wants to share the contents of your screen with webdemo.agorabeckon.com. Choose what you'd like to share.",g.setAttribute("style","height: 12%;");const E=document.createElement("div");E.setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;");const S=document.createElement("div");S.setAttribute("style","display: flex; justify-content: space-between; padding: 16px 0;");const O=document.createElement("button");O.innerHTML="cancel",O.setAttribute("style","width: 85px;"),O.onclick=()=>{document.body.removeChild(j);const U=new Error("NotAllowedError");U.name="NotAllowedError",d(U)};let A=o;const N=document.createElement("div");if(o){const U=document.createElement("input");U.setAttribute("type","checkbox");const W=document.createElement("span");U.setAttribute("style","margin-right: 6px;"),W.innerText="Share audio",U.checked=A,U.onchange=()=>{A=U.checked},N.appendChild(U),N.appendChild(W)}S.appendChild(N),S.appendChild(O),f.appendChild(g),f.appendChild(E),f.appendChild(S);const j=document.createElement("div");j.setAttribute("style","position: fixed; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),j.appendChild(h),j.appendChild(f),document.body.appendChild(j),s.map((U=>{if(U.id){const W=document.createElement("div");W.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;");let $=U.thumbnail;try{const{width:Z}=$.getSize();Z>1920&&($=$.resize({width:1920}))}catch(Z){throw Z&&Z.message.startsWith("Illegal invocation")&&console.error("Operate thumbnail error, please try to set contextIsolation: false. (https://github.com/electron/electron/issues/34953)"),Z}W.innerHTML='<div style="height: 120px; display: table-cell; vertical-align: middle;"><img style="width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);" src='+$.toDataURL()+' /></div><span style="	height: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+U.name.replace(/[\u00A0-\u9999<>\&]/g,(function(Z){return"&#"+Z.charCodeAt(0)+";"}))+"</span>",W.onclick=()=>{document.body.removeChild(j),c({sourceId:U.id,audio:A})},E.appendChild(W)}}))}))})(n,t);return await V1(r,e,i)}async function F1(e){let t=["window","screen"];e!=="application"&&e!=="window"||(t=["window"]),e==="screen"&&(t=["screen"]);const n=Zx();if(!n)throw console.error("failed to fetch electron, please mount it to window"),new de(V.ELECTRON_IS_NULL);let r=null;try{var i;r=((i=n.desktopCapturer)===null||i===void 0?void 0:i.getSources({types:t}))||n.ipcRenderer.invoke("DESKTOP_CAPTURER_GET_SOURCES",{types:t})}catch{r=null}r&&r.then||(r=new ke(((s,o)=>{n.desktopCapturer.getSources({types:t},((c,d)=>{c?o(c):s(d)}))})));try{return await r}catch(s){throw new de(V.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR,s.toString())}}const Lb=new Jr("safari");let B1=!1,W1=!1;async function ks(e,t){let n=0,r=null;for(;n<2;)try{r=await h9(e,t,n>0);break}catch(i){if(i instanceof de)throw w.error("[".concat(t,"] ").concat(i.toString())),i;const s=tT(i.name||i.code||i,i.message);if(s.code===V.MEDIA_OPTION_INVALID){w.debug("[".concat(t,"] detect media option invalid, retry")),n+=1,await xr(500);continue}throw w.error("[".concat(t,"] ").concat(s.toString())),s}if(!r)throw new de(V.UNEXPECTED_ERROR,"can not find stream after getUserMedia");return r}async function h9(e,t,n){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new de(V.NOT_SUPPORTED,"can not find getUserMedia");n&&(e.video&&(delete e.video.width,delete e.video.height),e.screen&&(delete e.screen.width,delete e.screen.height));const r=Bt(),i=new MediaStream;if(e.audioSource&&i.addTrack(e.audioSource),e.videoSource&&i.addTrack(e.videoSource),!e.audio&&!e.video&&!e.screen)return w.debug("Using Video Source/ Audio Source"),i;if(e.screen)if(Zx())e.screen.sourceId?Yf(i,await V1(e.screen.sourceId,e.screen,!!e.screenAudio)):Yf(i,await u9(e.screen,!!e.screenAudio));else if(El()&&e.screen.extensionId&&e.screen.mandatory){if(!r.getStreamFromExtension)throw new de(V.NOT_SUPPORTED,"This browser does not support screen sharing");w.debug("[".concat(t,'] Screen access on chrome stable, looking for extension"'));const E=await(o=e.screen.extensionId,c=t,new ke(((S,O)=>{try{chrome.runtime.sendMessage(o,{getStream:!0},(A=>{if(!A||!A.streamId)return w.error("[".concat(c,"] No response from Chrome Plugin. Plugin not installed properly"),A),void O(new de(V.CHROME_PLUGIN_NO_RESPONSE,"No response from Chrome Plugin. Plugin not installed properly"));S(A.streamId)}))}catch(A){w.error("[".concat(c,"] AgoraRTC screensharing plugin is not accessible(").concat(o,")"),A.toString()),O(new de(V.CHROME_PLUGIN_NOT_INSTALL))}})));e.screen.mandatory.chromeMediaSourceId=E,Yf(i,await navigator.mediaDevices.getUserMedia({video:{mandatory:e.screen.mandatory}}))}else if(r.getDisplayMedia){var s;e.screen.mediaSource&&O1(e.screen.mediaSource);const E={width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate,displaySurface:(s=e.screen.displaySurface)!==null&&s!==void 0?s:e.screen.mediaSource==="screen"?"monitor":e.screen.mediaSource},{selfBrowserSurface:S,surfaceSwitching:O,systemAudio:A,preferCurrentTab:N}=e.screen,j={selfBrowserSurface:S,surfaceSwitching:O,systemAudio:A,preferCurrentTab:N};!S&&delete j.selfBrowserSurface,!O&&delete j.surfaceSwitching,!A&&delete j.systemAudio,!N&&delete j.preferCurrentTab,w.debug("[".concat(t,"] getDisplayMedia:"),JSON.stringify({video:E,audio:e.screenAudio,controls:j})),Yf(i,await navigator.mediaDevices.getDisplayMedia(En({video:E,audio:e.screenAudio},j)))}else{if(!jn())throw w.error("[".concat(t,"] This browser does not support screenSharing")),new de(V.NOT_SUPPORTED,"This browser does not support screen sharing");{e.screen.mediaSource&&O1(e.screen.mediaSource);const E={video:{mediaSource:e.screen.mediaSource,width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate}};w.debug("[".concat(t,"] getUserMedia: ").concat(JSON.stringify(E))),Yf(i,await navigator.mediaDevices.getUserMedia(E))}}var o,c;if(!e.video&&!e.audio)return i;let d={video:e.video,audio:e.audio},h=B("MEDIA_DEVICE_CONSTRAINTS");if(h)try{typeof h=="string"&&(h=JSON.parse(h)),d=ub(d,h)}catch{}w.debug("[".concat(t,"] GetUserMedia"),JSON.stringify(d)),Mt();let f,g=null;(Br()||ii()||BS())&&(g=await Lb.lock());try{f=await navigator.mediaDevices.getUserMedia(d)}catch(E){throw g&&g(),E}return d.audio&&(B1=!0),d.video&&(W1=!0),Yf(i,f),g&&g(),i}function tT(e,t){switch(e){case"Starting video failed":case"OverconstrainedError":case"TrackStartError":return new de(V.MEDIA_OPTION_INVALID,"".concat(e,": ").concat(t));case"NotFoundError":case"DevicesNotFoundError":return new de(V.DEVICE_NOT_FOUND,"".concat(e,": ").concat(t));case"NotSupportedError":return new de(V.NOT_SUPPORTED,"".concat(e,": ").concat(t));case"NotReadableError":return new de(V.NOT_READABLE,"".concat(e,": ").concat(t));case"InvalidStateError":case"NotAllowedError":case"PERMISSION_DENIED":case"PermissionDeniedError":return new de(V.PERMISSION_DENIED,"".concat(e,": ").concat(t));case"ConstraintNotSatisfiedError":return new de(V.CONSTRAINT_NOT_SATISFIED,"".concat(e,": ").concat(t));default:return w.error("getUserMedia unexpected error",e),new de(V.UNEXPECTED_ERROR,"".concat(e,": ").concat(t))}}function Yf(e,t){const n=e.getVideoTracks()[0],r=e.getAudioTracks()[0],i=t.getVideoTracks()[0],s=t.getAudioTracks()[0];s&&(r&&e.removeTrack(r),e.addTrack(s)),i&&(n&&e.removeTrack(n),e.addTrack(i))}const xs=new class extends xn{get state(){return this._state}set state(e){e!==this._state&&(this.emit(bh.STATE_CHANGE,e),this._state=e)}constructor(){super(),oe(this,"_state",nE.IDLE),oe(this,"isAccessMicrophonePermission",!1),oe(this,"isAccessCameraPermission",!1),oe(this,"lastAccessMicrophonePermission",!1),oe(this,"lastAccessCameraPermission",!1),oe(this,"checkdeviceMatched",!1),oe(this,"deviceInfoMap",new Map),this.init().then((()=>{navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",this.updateDevicesInfo.bind(this)),window.setInterval((()=>{(B("ENUMERATE_DEVICES_INTERVAL")||(WS()||FS()===Er.HARMONY_OS)&&vl())&&this.updateDevicesInfo()}),B("ENUMERATE_DEVICES_INTERVAL_TIME"))})).catch((e=>w.error(e.toString())))}async enumerateDevices(e,t){let n=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return new de(V.NOT_SUPPORTED,"enumerateDevices() not supported.").throw();const r=await navigator.mediaDevices.enumerateDevices(),i=this.checkMediaDeviceInfoIsOk(r);let s=!this.isAccessMicrophonePermission&&e,o=!this.isAccessCameraPermission&&t;i.audio&&(s=!1),i.video&&(o=!1);let c=null,d=null,h=null;if(!n&&(s||o)){if(Lb.isLocked&&(w.debug("[device manager] wait GUM lock"),(await Lb.lock())(),w.debug("[device manager] GUM unlock")),B1&&(s=!1,this.isAccessMicrophonePermission=!0),W1&&(o=!1,this.isAccessCameraPermission=!0),w.debug("[device manager] check media device permissions",e,t,s,o),s&&o){try{h=await navigator.mediaDevices.getUserMedia({audio:!0,video:!0})}catch(f){const g=tT(f.name||f.code||f,f.message);if(g.code===V.PERMISSION_DENIED)throw g;w.warning("getUserMedia failed in getDevices",g)}this.isAccessCameraPermission=!0,this.isAccessMicrophonePermission=!0}else if(s){try{c=await navigator.mediaDevices.getUserMedia({audio:e})}catch(f){const g=tT(f.name||f.code||f,f.message);if(g.code===V.PERMISSION_DENIED)throw g;w.warning("getUserMedia failed in getDevices",g)}this.isAccessMicrophonePermission=!0}else if(o){try{d=await navigator.mediaDevices.getUserMedia({video:t})}catch(f){const g=tT(f.name||f.code||f,f.message);if(g.code===V.PERMISSION_DENIED)throw g;w.warning("getUserMedia failed in getDevices",g)}this.isAccessCameraPermission=!0}w.debug("[device manager] mic permission",e,"cam permission",t)}try{const f=await navigator.mediaDevices.enumerateDevices();return c&&c.getTracks().forEach((g=>g.stop())),d&&d.getTracks().forEach((g=>g.stop())),h&&h.getTracks().forEach((g=>g.stop())),c=null,d=null,h=null,f}catch(f){return c&&c.getTracks().forEach((g=>g.stop())),d&&d.getTracks().forEach((g=>g.stop())),h&&h.getTracks().forEach((g=>g.stop())),c=null,d=null,h=null,new de(V.ENUMERATE_DEVICES_FAILED,f.toString()).throw()}}async getRecordingDevices(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,e)).filter((t=>t.kind==="audioinput"))}async getCamerasDevices(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!1,!0,e)).filter((t=>t.kind==="videoinput"))}async getSpeakers(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,e)).filter((t=>t.kind==="audiooutput"))}searchDeviceIdByName(e){let t=null;return this.deviceInfoMap.forEach((n=>{n.device.label===e&&(t=n.device.deviceId)})),t}async getDeviceById(e){const t=(await this.enumerateDevices(!0,!0,!0)).find((n=>n.deviceId===e));if(!t)throw new de(V.DEVICE_NOT_FOUND,"deviceId: ".concat(e));return t}async init(){this.state=nE.INITING;try{await this.updateDevicesInfo(),this.state=nE.INITEND}catch(e){throw w.warning("Device Detection functionality cannot start properly.",e.toString()),this.state=nE.IDLE,(typeof isSecureContext=="boolean"?isSecureContext:location.protocol==="https:"||location.protocol==="file:"||location.hostname==="localhost"||location.hostname==="127.0.0.1"||location.hostname==="::1")||new de(V.WEB_SECURITY_RESTRICT,"Your context is limited by web security, please try using https protocol or localhost.").throw(),e}}async updateDevicesInfo(){const e=await this.enumerateDevices(!0,!0,!0),t=Date.now(),n=[];if(e[0]&&e[0].label&&this.checkdeviceMatched===!1){this.checkdeviceMatched=!0;const i=e.find((o=>o.kind==="audioinput"&&o.deviceId==="default")),s=e.find((o=>o.kind==="audiooutput"&&o.deviceId==="default"));i&&s?s.groupId===i.groupId?w.debug("[device-check] default input ".concat(i.label," and output ").concat(s.label," is the same group")):w.debug("[device-check] default input ".concat(i.label," and output ").concat(s.label," is not the same group")):w.debug("[device-check] default input or output not found")}const r=this.checkMediaDeviceInfoIsOk(e);if(e.forEach((i=>{if(!i.deviceId)return;const s=this.deviceInfoMap.get("".concat(i.kind,"_").concat(i.deviceId));if((s?s.state:"INACTIVE")!=="ACTIVE"){const o={initAt:t,updateAt:t,device:i,state:"ACTIVE"};this.deviceInfoMap.set("".concat(i.kind,"_").concat(i.deviceId),o),n.push(o)}s&&(s.updateAt=t)})),this.deviceInfoMap.forEach(((i,s)=>{i.state==="ACTIVE"&&i.updateAt!==t&&(i.state="INACTIVE",n.push(i))})),this.state!==nE.INITEND)return r.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),void(r.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0));n.forEach((i=>{switch(i.device.kind){case"audioinput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(bh.RECORDING_DEVICE_CHANGED,i);break;case"videoinput":this.lastAccessCameraPermission&&this.isAccessCameraPermission&&this.emit(bh.CAMERA_DEVICE_CHANGED,i);break;case"audiooutput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(bh.PLAYOUT_DEVICE_CHANGED,i)}})),r.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),r.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0)}checkMediaDeviceInfoIsOk(e){const t=e.filter((i=>i.kind==="audioinput")),n=e.filter((i=>i.kind==="videoinput")),r={audio:!1,video:!1};for(const i of t)if(i.label&&i.deviceId){r.audio=!0;break}for(const i of n)if(i.label&&i.deviceId){r.video=!0;break}return r}};let Mb=!1;const Ls=new class extends xn{constructor(){super(...arguments),oe(this,"onAutoplayFailed",void 0),oe(this,"onAudioAutoplayFailed",void 0)}};function G1(){if(Mt(),!Mb){const e=t=>{t.preventDefault(),Mb=!1,zg()?document.body.removeEventListener("click",e,!0):(document.body.removeEventListener("touchstart",e,!0),document.body.removeEventListener("mousedown",e,!0))};Mb=!0,zg()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0)),w.info("detect media autoplay failed, document: https://docs.agora.io/cn/Voice/autoplay_policy_web_ng?platform=Web"),Ls.onAutoplayFailed?Ls.onAutoplayFailed():Ls.onAudioAutoplayFailed?w.warning(`AgoraRTC.onAudioAutoplayFailed has been deprecated in favor of AgoraRTC.onAutoplayFailed.

  Please refer to the Agora document to migrate the newer API, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`):w.warning(`We have detected a media autoplay failed event, and found out that you haven't implemented AgoraRTC.onAutoplayFailed callback yet.

  It will cause audio/video element not playing automatically on some browsers without user interaction, possibly hurting user experiences.

  Please refer to the Agora document to properly handle autoplay failed event, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`),Ls.emit("autoplay-failed")}}function H1(e,t,n,r){if(!e)return;const i=We.getBaseInfoBySessionId(e);if(!i)return;const s=i.info,o=Date.now(),c=En(En({},s),{},{vid:s.vid===void 0?0:Number(s.vid),lts:o,elapse:o-i.startTime,cbRegistered:Ls.onAutoplayFailed||Ls.onAudioAutoplayFailed?1:-1,errorMsg:n,mediaType:t,trackId:r,extend:void 0});We.send({type:In.AUTOPLAY_FAILED,data:c},!0)}const p9=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","error"],Vi=new class{constructor(){oe(this,"onAutoplayFailed",void 0),oe(this,"elementMap",new Map),oe(this,"elementStateMap",new Map),oe(this,"elementsNeedToResume",[]),oe(this,"sinkIdMap",new Map),oe(this,"autoResumeAfterInterruption",(e=>{Array.from(this.elementMap.entries()).forEach((t=>{let[n,r]=t;const i=this.elementStateMap.get(n),s=r.srcObject.getAudioTracks()[0],o=s&&s.readyState;if(w.debug("resume after interrupted, ele: ".concat(i," audio: ").concat(o," ").concat(e)),o==="live"){if(e)return r.pause(),void r.play();if(on.curState==="running")return kf()?(r.pause(),void r.play()):void(i&&i==="paused"&&r.play())}}))})),oe(this,"autoResumeAfterInterruptionOnIOS15_16",(()=>{Array.from(this.elementMap.entries()).forEach((e=>{let[t,n]=e;const r=n.srcObject.getAudioTracks()[0];r&&r.readyState==="live"&&(w.debug("auto resume after interruption inside autoResumeAfterInterruptionOnIOS15"),n.pause(),n.play())}))})),this.autoResumeAudioElement(),on.on(Mr.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),on.on(Mr.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),on.on(Mr.STATE_CHANGE,(()=>{ii()&&on.prevState==="suspended"&&on.curState==="running"&&this.autoResumeAfterInterruption()}))}async setSinkID(e,t){const n=this.elementMap.get(e);if(this.sinkIdMap.set(e,t),n)try{await n.setSinkId(t)}catch(r){throw new de(V.PERMISSION_DENIED,"can not set sink id: "+r.toString())}}play(e,t,n,r){if(this.elementMap.has(t))return;const i=document.createElement("audio");i.autoplay=!0,i.srcObject=new MediaStream([e]),this.bindAudioElementEvents(t,i),this.elementMap.set(t,i),this.elementStateMap.set(t,Qr.INIT),this.setVolume(t,n);const s=this.sinkIdMap.get(t);if(s)try{i.setSinkId(s).catch((c=>{w.warning("[".concat(t,"] set sink id failed"),c.toString())}))}catch(c){w.warning("[".concat(t,"] set sink id failed"),c.toString())}const o=i.play();o&&o.then&&o.catch((c=>{r&&H1(r,"audio",c.message,t),w.warning("audio element play warning",c.toString()),this.elementMap.has(t)&&c.name==="NotAllowedError"&&(w.warning("detected audio element autoplay failed"),this.elementsNeedToResume.push(i),HS((()=>{this.onAutoplayFailed&&this.onAutoplayFailed(),G1()})))}))}updateTrack(e,t){const n=this.elementMap.get(e);n&&(n.srcObject=new MediaStream([t]))}isPlaying(e){return this.elementMap.has(e)&&this.elementStateMap.get(e)==="playing"}setVolume(e,t){const n=this.elementMap.get(e);n&&(t=Math.max(0,Math.min(100,t)),n.volume=t/100)}stop(e){const t=this.elementMap.get(e);if(this.sinkIdMap.delete(e),!t)return;const n=this.elementsNeedToResume.indexOf(t);this.elementsNeedToResume.splice(n,1),t.srcObject=null,t.remove(),this.elementMap.delete(e),this.elementStateMap.delete(e)}bindAudioElementEvents(e,t){p9.forEach((n=>{t.addEventListener(n,(r=>{const i=this.elementStateMap.get(e),s=r.type==="pause"?"paused":r.type;if(w.debug("[".concat(e,"] audio-element-status change ").concat(i," => ").concat(s)),r.type==="error"){const o=t?.error;o&&w.error("[".concat(e,"] media error, code: ").concat(o.code,", message: ").concat(o.message))}this.elementStateMap.set(e,s)}))}))}getPlayerState(e){return this.elementStateMap.get(e)||"uninit"}autoResumeAudioElement(){const e=()=>{this.elementsNeedToResume.forEach((t=>{t.play().then((n=>{w.debug("Auto resume audio element success")})).catch((n=>{w.warning("Auto resume audio element failed!",n)}))})),this.elementsNeedToResume=[]};new ke((t=>{document.body?t():window.addEventListener("load",(()=>t()))})).then((()=>{zg()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0))}))}};function Bn(){return function(e,t,n){const r=n.value;return typeof r=="function"&&(n.value=function(){this._isClosed&&new de(V.INVALID_OPERATION,"[".concat(this.getTrackId(),"] cannot operate a closed track")).print("warning",w);for(var i=arguments.length,s=new Array(i),o=0;o<i;o++)s[o]=arguments[o];const c=r.apply(this,s);return c instanceof ke?new ke(((d,h)=>{c.then(d).catch(h)})):c}),n}}class K1 extends xn{constructor(t){super(),oe(this,"name","VideoProcessorDestination"),oe(this,"ID","0"),oe(this,"_source",void 0),oe(this,"videoContext",void 0),oe(this,"inputTrack",void 0),this.videoContext=t}get kind(){return"video"}get enabled(){return!0}pipe(){throw new de(V.NOT_SUPPORTED,"VideoProcessor cannot pipe to any other Processor")}unpipe(){throw new de(V.NOT_SUPPORTED,"VideoProcessor cannot unpipe to any other Processor")}enable(){}disable(){}updateInput(t){if(t.context!==this.videoContext)throw new Error(`ProcessorContext passed to VideoTrack.processorDestination doesn't match it's belonging VideoTrack's context.
Probably you are making pipeline like this:
videoTrack1.pipe(processor).pipe(videoTrack2.processorDestination).`);t.track&&t.track!==this.inputTrack&&(this.videoContext.chained=!0,this.inputTrack=t.track,this.emit(bi.ON_TRACK,t.track))}reset(){this.inputTrack=void 0,this.videoContext.chained=!1,this.emit(bi.ON_TRACK,void 0)}}class z1 extends xn{set chained(t){this._chained=t}get chained(){return this._chained}constructor(t,n){super(),oe(this,"constraintsMap",new Map),oe(this,"statsRegistry",[]),oe(this,"usageRegistry",[]),oe(this,"trackId",void 0),oe(this,"direction",void 0),oe(this,"_chained",!1),this.trackId=t,this.direction=n}async getConstraints(){return await Gr(this,Ps.REQUEST_CONSTRAINTS)}async requestApplyConstraints(t,n){var r;return w.info("processor ".concat(n.name," requestApplyConstraints for ").concat(this.trackId)),t&&this.constraintsMap.set(n,t),un(this,Ps.REQUEST_UPDATE_CONSTRAINTS,Array.from(fs(r=this.constraintsMap).call(r)))}async requestRevertConstraints(t){var n;if(this.constraintsMap.has(t))return w.info("processor ".concat(t.name," requestRevertConstraints for ").concat(this.trackId)),this.constraintsMap.delete(t),un(this,Ps.REQUEST_UPDATE_CONSTRAINTS,Array.from(fs(n=this.constraintsMap).call(n)))}registerStats(t,n,r){this.statsRegistry.find((i=>i.processorID===t.ID&&i.processorName===t.name&&i.type===n))||this.statsRegistry.push({processorName:t.name,processorID:t.ID,type:n,cb:r})}unregisterStats(t,n){const r=this.statsRegistry.findIndex((i=>i.processorID===t.ID&&i.processorName===t.name&&i.type===n));r!==-1&&this.statsRegistry.splice(r,1)}gatherStats(){const t=[];for(const{processorID:n,processorName:r,type:i,cb:s}of this.statsRegistry)try{const o=s();t.push({processorID:n,processorName:r,type:i,stats:o})}catch(o){w.error(new de(V.UNEXPECTED_ERROR,o.message))}return t}registerUsage(t,n){this.usageRegistry.find((r=>r.processorID===t.ID&&r.processorName===t.name))||this.usageRegistry.push({processorID:t.ID,processorName:t.name,cb:n})}unregisterUsage(t){const n=this.usageRegistry.findIndex((r=>r.processorID===t.ID&&r.processorName===t.name));n!==-1&&this.usageRegistry.splice(n,1)}async gatherUsage(){const t=[];if(!this.chained)return[];for(const{cb:n}of this.usageRegistry)try{let r=n();r instanceof ke&&(r=await r),t.push(En(En({},r),{},{direction:this.direction}))}catch(r){w.error("gather extension usage error",r)}return t}getDirection(){return this.direction}}class Y1 extends xn{constructor(t){super(),oe(this,"name","AudioProcessorDestination"),oe(this,"ID","0"),oe(this,"inputTrack",void 0),oe(this,"inputNode",void 0),oe(this,"audioProcessorContext",void 0),oe(this,"_source",void 0),this.audioProcessorContext=t}get kind(){return"audio"}get enabled(){return!0}pipe(){throw new de(V.NOT_SUPPORTED,"AudioProcessorDestination cannot pipe to any other Processor")}unpipe(){throw new de(V.NOT_SUPPORTED,"AudioProcessor cannot unpipe to any other Processor")}enable(){}disable(){}reset(){this.inputTrack=void 0,this.inputNode=void 0,this.audioProcessorContext.chained=!1,this.emit(bi.ON_TRACK,void 0),this.emit(bi.ON_NODE,void 0)}updateInput(t){if(t.context!==this.audioProcessorContext)throw new Error(`ProcessorContext passed to AudioTrack.processorDestination doesn't match it's belonging AudioTrack's context.
        Probably you are making pipeline like this: audioTrack1.pipe(processor).pipe(audioTrack2.processorDestination).`);t.track&&this.inputTrack!==t.track&&(this.audioProcessorContext.chained=!0,this.inputTrack=t.track,this.emit(bi.ON_TRACK,this.inputTrack)),t.node&&this.inputNode!==t.node&&(this.audioProcessorContext.chained=!0,this.inputNode=t.node,this.emit(bi.ON_NODE,this.inputNode))}}class q1 extends xn{set chained(t){this._chained=t}get chained(){return this._chained}constructor(t,n,r){super(),oe(this,"constraintsMap",new Map),oe(this,"statsRegistry",[]),oe(this,"audioContext",void 0),oe(this,"trackId",void 0),oe(this,"direction",void 0),oe(this,"usageRegistry",[]),oe(this,"_chained",!1),this.audioContext=t,this.trackId=n,this.direction=r}async getConstraints(){return Gr(this,Ps.REQUEST_CONSTRAINTS)}getAudioContext(){return this.audioContext}async requestApplyConstraints(t,n){var r;return w.info("processor ".concat(n.name," requestApplyConstraints for ").concat(this.trackId)),t&&this.constraintsMap.set(n,t),un(this,Ps.REQUEST_UPDATE_CONSTRAINTS,Array.from(fs(r=this.constraintsMap).call(r)))}async requestRevertConstraints(t){var n;if(this.constraintsMap.has(t))return this.constraintsMap.delete(t),un(this,Ps.REQUEST_UPDATE_CONSTRAINTS,Array.from(fs(n=this.constraintsMap).call(n)))}registerStats(t,n,r){this.statsRegistry.find((i=>i.processorID===t.ID&&i.processorName===t.name&&i.type===n))||this.statsRegistry.push({processorName:t.name,processorID:t.ID,type:n,cb:r})}unregisterStats(t,n){const r=this.statsRegistry.findIndex((i=>i.processorID===t.ID&&i.processorName===t.name&&i.type===n));r!==-1&&this.statsRegistry.splice(r,1)}gatherStats(){const t=[];for(const{processorID:n,processorName:r,type:i,cb:s}of this.statsRegistry)try{const o=s();t.push({processorID:n,processorName:r,type:i,stats:o})}catch(o){w.error(new de(V.UNEXPECTED_ERROR,o.message))}return t}registerUsage(t,n){this.usageRegistry.find((r=>r.processorID===t.ID&&r.processorName===t.name))||this.usageRegistry.push({processorID:t.ID,processorName:t.name,cb:n})}unregisterUsage(t){const n=this.usageRegistry.findIndex((r=>r.processorID===t.ID&&r.processorName===t.name));n!==-1&&this.usageRegistry.splice(n,1)}async gatherUsage(){const t=[];if(!this.chained)return[];for(const{cb:n}of this.usageRegistry)try{let r=n();r instanceof ke&&(r=await r),t.push(En(En({},r),{},{direction:this.direction}))}catch(r){w.error("gather extension usage error",r)}return t}getDirection(){return this.direction}}class Ub extends xn{get isPlayed(){return!0}get isFreeze(){return!1}constructor(){super(),oe(this,"context",void 0),oe(this,"processSourceNode",void 0),oe(this,"outputTrack",void 0),oe(this,"processedNode",void 0),oe(this,"clonedTrack",void 0),oe(this,"outputNode",void 0),this.outputNode=new f9}setVolume(){}createOutputTrack(){throw new de(V.NOT_SUPPORTED,"can not create output MediaStreamTrack when WebAudio disabled")}getOriginVolumeLevel(){return 0}getAccurateVolumeLevel(){return 0}stopGetAudioBuffer(){}startGetAudioBuffer(){}play(){}stop(){}destroy(){}updateTrack(){}updateOriginTrack(){}createMediaStreamSourceNode(){}}class f9{disconnect(){}connect(){}}function X1(e){return new ke(((t,n)=>{let r=!1;const i=document.createElement("video");i.setAttribute("autoplay",""),i.setAttribute("muted",""),i.muted=!0,i.autoplay=!0,i.setAttribute("playsinline",""),i.setAttribute("style","position: fixed; top: 0; left: 0; width: 1px; height: 1px"),document.body.appendChild(i);const s=ii()?"canplay":"playing";i.addEventListener(s,(()=>{const o=i.videoWidth,c=i.videoHeight;!o&&jn()||(r=!0,i.srcObject=null,i.remove(),t([o,c]))})),i.srcObject=new MediaStream([e]),i.play().catch(KS),setTimeout((()=>{r||(i.srcObject=null,i.remove(),t([i.videoWidth,i.videoHeight]))}),4e3)}))}function nT(e){const t={};e.facingMode&&(t.facingMode=e.facingMode),e.cameraId&&(t.deviceId={exact:e.cameraId});const n=Wo(e.encoderConfig);return n.width!=null&&(t.width=n.width),n.height!=null&&(t.height=n.height),!Yx()&&n.frameRate&&(t.frameRate=n.frameRate),Vx()&&typeof t.frameRate=="object"&&(t.frameRate.max=60),jn()&&(t.frameRate={ideal:30,max:30}),t}function J1(e){const t={};return Yx()||(e.AGC!==void 0&&(t.autoGainControl=e.AGC),e.AEC!==void 0&&(t.echoCancellation=e.AEC),e.ANS!==void 0&&(t.noiseSuppression=e.ANS,El()&&e.ANS&&(t.googHighpassFilter=e.ANS))),t}function Q1(e){const t=J1(e);if(e.encoderConfig){const n=$S(e.encoderConfig);t.channelCount=n.stereo?2:1,t.sampleRate=n.sampleRate,t.sampleSize=n.sampleSize}return e.microphoneId&&(t.deviceId={exact:e.microphoneId}),WS()&&(t.sampleRate=void 0),t}const m9=e=>{const t=e._encoderConfig;if(!t)return;const{frameRate:n,width:r,height:i}=e.getMediaStreamTrackSettings();let{frameRate:s=n,width:o=r,height:c=i}=t;if(!s||!o||!c)return;o=Mf(o),c=Mf(c),s=Mf(s);const{max:d,min:h}=(function(S,O,A){const N=200*Math.pow(A/15,.6)*Math.pow(S*O/640/360,.75);return{min:Math.floor(N),max:Math.floor(4*N)}})(o,c,s),{bitrateMax:f,bitrateMin:g}=t||{};f||w.debug("calculate bitrate: [w: ".concat(o,", h: ").concat(c,", fps: ").concat(s,"] => [brMax: ").concat(f,", brMin: ").concat(g,"]"));const{maxFramerate:E}=B("ENCODER_CONFIG_LIMIT");return E&&typeof E=="number"&&(s=Math.min(s,E)),{frameRate:s,bitrateMax:f||d,bitrateMin:g||h,scaleResolutionDownBy:1,scale:0}},Z1=async(e,t,n)=>await(async(r,i,s)=>{const o=(function(h){const f=[];for(let g=0;g<h.length;g+=2)f.push(parseInt(h.slice(g,g+2),16));return Uint8Array.from(f)})(l1(""+i+s)).slice(0,16),c=o.slice(0,12),d=await window.crypto.subtle.importKey("raw",o,"AES-GCM",!0,["encrypt"]);return new Uint8Array(await window.crypto.subtle.encrypt({name:"AES-GCM",iv:c},d,r))})(e.buffer,t,n),jb=e=>{const t=document.createElement("canvas");return t.width=2,t.height=2,new ke(((n,r)=>{t.toBlob((async i=>{if(t.remove(),i){const s=await $1(i);n({buffer:s,width:t.width,height:t.height})}else r(new de(V.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))}),e,1)}))},$1=async e=>{const t=await e.arrayBuffer();return new Uint8Array(t)};var eL,tL,nL,rL,iL,sL,oL,aL,cL,lL,dL,uL,hL,pL,fL,mL,_L,gL,Ln,EL,vL,yL,SL,TL,RL,Ic,wL,CL,bL,IL,AL,NL,OL,PL,DL,kL,xL,LL,ML,Kr;let Wn=(eL=et({argsMap:(e,t)=>[e.getTrackId(),t],throttleTime:300}),tL=et({argsMap:(e,t)=>[e.getTrackId(),t]}),nL=Bn(),rL=Uf("LocalAudioTrack","_enabledMutex"),iL=et({argsMap:(e,t)=>[e.getTrackId(),t]}),sL=Bn(),oL=Uf("LocalAudioTrack","_enabledMutex"),aL=et({argsMap:(e,t)=>[e.getTrackId(),t]}),cL=Bn(),lL=Bn(),dL=Bn(),uL=et({argsMap:e=>[e.getTrackId()]}),hL=Bn(),pL=et({argsMap:e=>[e.getTrackId()]}),fL=Bn(),mL=et({argsMap:e=>[e.getTrackId()]}),_L=et({argsMap:(e,t)=>[e.getTrackId(),t.name]}),gL=et({argsMap:e=>[e.getTrackId()]}),Lt((Ln=class extends Kf{get _source(){return this.initWebAudio()}set _source(e){this._trackSource=e}get processorContext(){return this._processorContext||(this._processorContext=this.initProcessor().processorContext),this._processorContext}get processorDestination(){return this._processorDestination||(this._processorDestination=this.initProcessor().processorDestination),this._processorDestination}get isPlaying(){return this._useAudioElement?Vi.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"LocalAudioTrack"}constructor(e,t,n,r){super(e,n),oe(this,"trackMediaType",Hf.AUDIO),oe(this,"_encoderConfig",void 0),oe(this,"_trackSource",void 0),oe(this,"metadata",[]),oe(this,"_enabled",!0),oe(this,"_volume",100),oe(this,"_useAudioElement",!0),oe(this,"_bypassWebAudio",!1),oe(this,"processor",void 0),oe(this,"_processorContext",void 0),oe(this,"_processorDestination",void 0),oe(this,"_getOriginVolumeLevel",void 0),this._encoderConfig=t,this._getOriginVolumeLevel=!!r,this._trackSource=new Ub,B("DISABLE_WEBAUDIO")&&(this._bypassWebAudio=!0),B("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1),Br()&&!Ds?setTimeout((()=>this.initWebAudio())):this.initWebAudio()}setVolume(e){cn(e,"volume",0,1e3),this._volume=e,this._source.setVolume(e/100),this._useAudioElement&&Vi.setVolume(this.getTrackId(),e);try{if(this._bypassWebAudio)return void w.debug("[".concat(this.getTrackId(),"] setVolume returned because no pass through WebAudio."));const t=this._source.createOutputTrack();this._mediaStreamTrack!==t&&(this._mediaStreamTrack=t,un(this,Ve.NEED_REPLACE_TRACK,this).then((()=>{w.debug("[".concat(this.getTrackId(),"] replace web audio track success"))})).catch((n=>{w.warning("[".concat(this.getTrackId(),"] replace web audio track failed"),n)})))}catch{}}getVolumeLevel(){return this._muted&&this.enabled&&this._getOriginVolumeLevel?this._source.getOriginVolumeLevel():this._source.getAccurateVolumeLevel()}async setPlaybackDevice(e){if(!this._useAudioElement||!A1())throw new de(V.NOT_SUPPORTED,"your browser does not support setting the audio output device");await Vi.setSinkID(this.getTrackId(),e)}async setEnabled(e,t,n){return this._setEnabled(e,t,n)}async _setEnabled(e,t,n){if(!n){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(w.info("[".concat(this.getTrackId(),"] start setEnabled"),e),e){this._originMediaStreamTrack.enabled=!0;try{n||(this._enabled=!0),await un(this,Ve.NEED_ENABLE_TRACK,this),w.info("[".concat(this.getTrackId(),"] setEnabled to ").concat(e," success"))}catch(r){throw n||(this._enabled=!1),w.error("[".concat(this.getTrackId(),"] setEnabled to true error"),r.toString()),r}}else{this._originMediaStreamTrack.enabled=!1,n||(this._enabled=!1);try{await un(this,Ve.NEED_DISABLE_TRACK,this)}catch(r){throw n||(this._enabled=!0),w.error("[".concat(this.getTrackId(),"] setEnabled to false error"),r.toString()),r}}}async setMuted(e){e!==this._muted&&(this.stateCheck("muted",e),this._muted=e,this._originMediaStreamTrack.enabled=!e,w.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(e)),e?await un(this,Ve.NEED_MUTE_TRACK,this):await un(this,Ve.NEED_UNMUTE_TRACK,this))}getStats(){return Id((()=>{w.warning("[deprecated] LocalAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalAudioStats instead")}),"localAudioTrackGetStatsWarning"),As(this,Ve.GET_STATS)||En({},Ob)}setAudioFrameCallback(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!e)return this._source.removeAllListeners(Os.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(t),this._source.removeAllListeners(Os.ON_AUDIO_BUFFER),this._source.on(Os.ON_AUDIO_BUFFER,(n=>e(n)))}play(){w.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?(w.debug("[".concat(this.getTrackId(),"] start audio playback in element")),Vi.play(this._mediaStreamTrack,this.getTrackId(),this._volume)):this._source.play()}stop(){w.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?Vi.stop(this.getTrackId()):this._source.stop()}close(){super.close(),this._processorDestination&&this.unbindProcessorDestinationEvents(this._processorDestination),this._processorContext&&this.unbindProcessorContextEvents(this._processorContext),this.unpipe(),this._processorDestination&&this._processorDestination._source&&this._processorDestination._source.unpipe(),this._source.destroy()}_updatePlayerSource(){let e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];w.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&Vi.updateTrack(this.getTrackId(),this._mediaStreamTrack)}async _updateOriginMediaStreamTrack(e,t){this._originMediaStreamTrack!==e&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),t&&this._originMediaStreamTrack.stop()),e.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=e,this._muted&&(this._originMediaStreamTrack.enabled=!1),this.processor&&this._processorContext&&this.processor.updateInput({track:e,context:this._processorContext}),this._mediaStreamTrack!==this._source.outputTrack?(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await un(this,Ve.NEED_REPLACE_TRACK,this)):this._source.updateTrack(this._originMediaStreamTrack),this._getOriginVolumeLevel&&this._source.updateOriginTrack(e))}renewMediaStreamTrack(e){return ke.resolve(void 0)}pipe(e){if(this._bypassWebAudio)throw new de(V.INVALID_OPERATION,"Can not process AudioTrack when bypassWebAudio set to true.");if(this.processor===e)return e;if(e._source)throw new de(V.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(!this.processor)return;const t=this.processor;(e=this._source.processSourceNode)===null||e===void 0||e.disconnect(),this.processor._source=!1,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(e){e.on(bi.ON_TRACK,(async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(t),await un(this,Ve.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await un(this,Ve.NEED_REPLACE_TRACK,this))})),e.on(bi.ON_NODE,(t=>{this._source.processedNode=t}))}unbindProcessorDestinationEvents(e){e.removeAllListeners(bi.ON_TRACK),e.removeAllListeners(bi.ON_NODE)}bindProcessorContextEvents(e){e.on(Ps.REQUEST_CONSTRAINTS,(async t=>{t(this._originMediaStreamTrack.getSettings())}))}unbindProcessorContextEvents(e){e.removeAllListeners(Ps.REQUEST_CONSTRAINTS)}initWebAudio(){return this._trackSource instanceof Ub&&(this._trackSource=new j1(this._mediaStreamTrack,!1,this._getOriginVolumeLevel?this._mediaStreamTrack:void 0)),this._trackSource}initProcessor(){const e=new q1(this._source.context,this.getTrackId(),"local"),t=new Y1(e);return this._processorContext=e,this._processorDestination=t,this.bindProcessorContextEvents(e),this.bindProcessorDestinationEvents(t),this._source.on(Os.UPDATE_SOURCE,(()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:e})})),this._useAudioElement&&(this._useAudioElement=!1,this.isPlaying&&(Vi.stop(this.getTrackId()),this._source.play()),un(this,Ve.NEED_REPLACE_MIXING_TRACK,this).then((()=>{w.debug("[".concat(this.getTrackId(),"] replace from origin track to web audio track success"))})).catch((n=>{w.warning("[".concat(this.getTrackId(),"] replace from origin track to web audio track failed"),n)}))),{processorContext:e,processorDestination:t}}}).prototype,"setVolume",[eL],Object.getOwnPropertyDescriptor(Ln.prototype,"setVolume"),Ln.prototype),Lt(Ln.prototype,"setPlaybackDevice",[tL,nL],Object.getOwnPropertyDescriptor(Ln.prototype,"setPlaybackDevice"),Ln.prototype),Lt(Ln.prototype,"setEnabled",[rL,iL,sL],Object.getOwnPropertyDescriptor(Ln.prototype,"setEnabled"),Ln.prototype),Lt(Ln.prototype,"setMuted",[oL,aL,cL],Object.getOwnPropertyDescriptor(Ln.prototype,"setMuted"),Ln.prototype),Lt(Ln.prototype,"getStats",[lL],Object.getOwnPropertyDescriptor(Ln.prototype,"getStats"),Ln.prototype),Lt(Ln.prototype,"setAudioFrameCallback",[dL],Object.getOwnPropertyDescriptor(Ln.prototype,"setAudioFrameCallback"),Ln.prototype),Lt(Ln.prototype,"play",[uL,hL],Object.getOwnPropertyDescriptor(Ln.prototype,"play"),Ln.prototype),Lt(Ln.prototype,"stop",[pL,fL],Object.getOwnPropertyDescriptor(Ln.prototype,"stop"),Ln.prototype),Lt(Ln.prototype,"close",[mL],Object.getOwnPropertyDescriptor(Ln.prototype,"close"),Ln.prototype),Lt(Ln.prototype,"pipe",[_L],Object.getOwnPropertyDescriptor(Ln.prototype,"pipe"),Ln.prototype),Lt(Ln.prototype,"unpipe",[gL],Object.getOwnPropertyDescriptor(Ln.prototype,"unpipe"),Ln.prototype),Ln),rE=(EL=et({argsMap:(e,t)=>[e.getTrackId(),t]}),vL=Bn(),yL=Uf("MicrophoneAudioTrack","_enabledMutex"),SL=et({argsMap:(e,t,n)=>[e.getTrackId(),t,n]}),TL=Bn(),RL=et({argsMap:e=>[e.getTrackId()]}),Lt((Ic=class extends Wn{get __className__(){return"MicrophoneAudioTrack"}constructor(e,t,n,r){super(e,t.encoderConfig?$S(t.encoderConfig):{},r,B("GET_VOLUME_OF_MUTED_AUDIO_TRACK")),oe(this,"_config",void 0),oe(this,"_deviceName","default"),oe(this,"_constraints",void 0),oe(this,"_originalConstraints",void 0),oe(this,"_enabled",!0),this._config=t,this._constraints=n,this._originalConstraints=n,this._deviceName=e.label,typeof t.bypassWebAudio=="boolean"&&(this._bypassWebAudio=t.bypassWebAudio),(kf()||ib())&&on.bindInterruptDetectorTrack(this)}async setDevice(e){if(w.info("[".concat(this.getTrackId(),"] start set device to ").concat(e)),this._enabled)try{const t=await xs.getDeviceById(e),n={};n.audio=En({},this._constraints),n.audio.deviceId={exact:e},this._originMediaStreamTrack.stop();let r=null;try{r=await ks(n,this.getTrackId())}catch(i){throw w.error("[".concat(this.getTrackId(),"] setDevice failed"),i.toString()),r=await ks({audio:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(r.getAudioTracks()[0],!1),i}await this._updateOriginMediaStreamTrack(r.getAudioTracks()[0],!1),this._deviceName=t.label,this._config.microphoneId=e,this._constraints.deviceId={exact:e}}catch(t){throw w.error("[".concat(this.getTrackId(),"] setDevice error"),t.toString()),t}else try{const t=await xs.getDeviceById(e);this._deviceName=t.label,this._config.microphoneId=e,this._constraints.deviceId={exact:e}}catch(t){throw w.error("[".concat(this.getTrackId(),"] setDevice error"),t.toString()),t}w.info("[".concat(this.getTrackId(),"] set device to ").concat(e," success"))}async setEnabled(e,t,n){if(t)return w.debug("[".concat(this.getTrackId(),"] setEnabled false (do not close microphone)")),await super._setEnabled(e);if(!n){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(w.info("[".concat(this.getTrackId(),"] start setEnabled"),e),B("AUTO_RESET_AUDIO_ROUTE")&&(ii()||Vo())){const o=navigator.audioSession;o&&(e||(o.type="playback"),o.type="auto")}if(!e){var r;this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop(),(r=this._source.clonedTrack)===null||r===void 0||r.stop(),n||(this._enabled=!1);try{await un(this,Ve.NEED_DISABLE_TRACK,this)}catch(o){throw w.error("[".concat(this.getTrackId(),"] setEnabled false failed"),o.toString()),o}return}const i=En({},this._constraints),s=xs.searchDeviceIdByName(this._deviceName);s&&!i.deviceId&&(i.deviceId=s);try{n||(this._enabled=!0);const o=await ks({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(o.getAudioTracks()[0],!1),await un(this,Ve.NEED_ENABLE_TRACK,this)}catch(o){throw n||(this._enabled=!1),w.error("[".concat(this.getTrackId(),"] setEnabled true failed"),o.toString()),o}w.info("[".concat(this.getTrackId(),"] setEnabled success"))}close(){super.close(),(kf()||ib())&&on.unbindInterruptDetectorTrack(this)}onTrackEnded(){if((ii()||Vo())&&this._enabled&&!this._isClosed&&on.duringInterruption){const e=async()=>{on.off(Mr.IOS_INTERRUPTION_END,e),this._enabled&&!this._isClosed&&(w.debug("[".concat(this.getTrackId(),"] try capture microphone media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};on.on(Mr.IOS_INTERRUPTION_END,e)}else w.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(Gf.TRACK_ENDED)}async renewMediaStreamTrack(e){const t=e||this._constraints,n=xs.searchDeviceIdByName(this._deviceName);if(n&&!t.deviceId&&(t.deviceId=n),this._constraints=t,this._enabled){this._originMediaStreamTrack.stop();const r=await ks({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(r.getAudioTracks()[0],!0)}}bindProcessorContextEvents(e){super.bindProcessorContextEvents(e),e.on(Ps.REQUEST_UPDATE_CONSTRAINTS,(async(t,n,r)=>{try{const i=Object.assign({},this._originalConstraints,...t);await this.renewMediaStreamTrack(i),n()}catch(i){r(i)}}))}unbindProcessorContextEvents(e){super.unbindProcessorContextEvents(e),e.removeAllListeners(Ps.REQUEST_UPDATE_CONSTRAINTS)}}).prototype,"setDevice",[EL,vL],Object.getOwnPropertyDescriptor(Ic.prototype,"setDevice"),Ic.prototype),Lt(Ic.prototype,"setEnabled",[yL,SL,TL],Object.getOwnPropertyDescriptor(Ic.prototype,"setEnabled"),Ic.prototype),Lt(Ic.prototype,"close",[RL],Object.getOwnPropertyDescriptor(Ic.prototype,"close"),Ic.prototype),Ic),_9=(wL=et({argsMap:(e,t)=>[e.getTrackId(),t,e.duration]}),CL=Bn(),bL=et({argsMap:e=>[e.getTrackId()]}),IL=Bn(),AL=et({argsMap:e=>[e.getTrackId()]}),NL=Bn(),OL=et({argsMap:e=>[e.getTrackId()]}),PL=Bn(),DL=et({argsMap:e=>[e.getTrackId()]}),kL=Bn(),xL=et({argsMap:e=>[e.getTrackId()]}),LL=et({argsMap:e=>[e.getTrackId()]}),ML=Bn(),Lt((Kr=class extends Wn{get __className__(){return"BufferSourceAudioTrack"}constructor(e,t,n,r){super(t.createOutputTrack(),n,r),oe(this,"source",void 0),oe(this,"_bufferSource",void 0),this._useAudioElement=!1,this.source=e,this._bufferSource=t,this._bufferSource.on(Os.AUDIO_SOURCE_STATE_CHANGE,(i=>{this.safeEmit(Gf.SOURCE_STATE_CHANGE,i)}));try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}}get currentState(){return this._bufferSource.currentState}get duration(){return this._bufferSource.duration}get playbackSpeed(){return this._bufferSource.playbackSpeed}getCurrentTime(){return this._bufferSource.currentTime}startProcessAudioBuffer(e){e&&this._bufferSource.updateOptions(e),this._bufferSource.startProcessAudioBuffer()}pauseProcessAudioBuffer(){this._bufferSource.pauseProcessAudioBuffer()}seekAudioBuffer(e){this._bufferSource.seekAudioBuffer(e)}resumeProcessAudioBuffer(){this._bufferSource.resumeProcessAudioBuffer()}stopProcessAudioBuffer(){this._bufferSource.stopProcessAudioBuffer()}close(){this.source=null,this._bufferSource.destroy(),super.close()}setAudioBufferPlaybackSpeed(e){cn(e,"speed",0),this._bufferSource.setAudioBufferPlaybackSpeed(e)}}).prototype,"startProcessAudioBuffer",[wL,CL],Object.getOwnPropertyDescriptor(Kr.prototype,"startProcessAudioBuffer"),Kr.prototype),Lt(Kr.prototype,"pauseProcessAudioBuffer",[bL,IL],Object.getOwnPropertyDescriptor(Kr.prototype,"pauseProcessAudioBuffer"),Kr.prototype),Lt(Kr.prototype,"seekAudioBuffer",[AL,NL],Object.getOwnPropertyDescriptor(Kr.prototype,"seekAudioBuffer"),Kr.prototype),Lt(Kr.prototype,"resumeProcessAudioBuffer",[OL,PL],Object.getOwnPropertyDescriptor(Kr.prototype,"resumeProcessAudioBuffer"),Kr.prototype),Lt(Kr.prototype,"stopProcessAudioBuffer",[DL,kL],Object.getOwnPropertyDescriptor(Kr.prototype,"stopProcessAudioBuffer"),Kr.prototype),Lt(Kr.prototype,"close",[xL],Object.getOwnPropertyDescriptor(Kr.prototype,"close"),Kr.prototype),Lt(Kr.prototype,"setAudioBufferPlaybackSpeed",[LL,ML],Object.getOwnPropertyDescriptor(Kr.prototype,"setAudioBufferPlaybackSpeed"),Kr.prototype),Kr);class cr extends Wn{get __className__(){return"MixingAudioTrack"}get isActive(){for(const t of this.trackList)if(t._enabled&&!t._isClosed&&!t.muted)return!0;return!1}constructor(){const t=zf().createMediaStreamDestination();super(t.stream.getAudioTracks()[0],void 0,hn(8,"track-mix-")),oe(this,"trackList",void 0),oe(this,"destNode",void 0),this._useAudioElement=!1;try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}this.destNode=t,this.trackList=[]}hasAudioTrack(t){return this.trackList.indexOf(t)!==-1}addAudioTrack(t){this.trackList.indexOf(t)===-1?(w.debug("add ".concat(t.getTrackId()," to mixing track")),t._source.outputNode.connect(this.destNode),this.trackList.push(t),this.updateEncoderConfig()):w.debug("track ".concat(t.getTrackId()," is already added"))}removeAudioTrack(t){if(this.trackList.indexOf(t)!==-1){w.debug("remove ".concat(t.getTrackId()," from mixing track"));try{t._source.outputNode.disconnect(this.destNode)}catch{}GS(this.trackList,t),this.updateEncoderConfig()}}updateEncoderConfig(){const t={};this.trackList.forEach((n=>{n._encoderConfig&&((n._encoderConfig.bitrate||0)>(t.bitrate||0)&&(t.bitrate=n._encoderConfig.bitrate),(n._encoderConfig.sampleRate||0)>(t.sampleRate||0)&&(t.sampleRate=n._encoderConfig.sampleRate),(n._encoderConfig.sampleSize||0)>(t.sampleSize||0)&&(t.sampleSize=n._encoderConfig.sampleSize),n._encoderConfig.stereo&&(t.stereo=!0))})),this._encoderConfig=t}_updateRtpTransceiver(t){this._rtpTransceiver!==t&&(this._rtpTransceiver=t,this.trackList.forEach((n=>{n instanceof cr?n.emit(Ch.TRANSCEIVER_UPDATED,t):n._updateRtpTransceiver(t)})))}}class g9 extends U1{set currentState(t){t!==this._currentState&&(this._currentState=t,this.safeEmit(Os.AUDIO_SOURCE_STATE_CHANGE,this._currentState))}get currentState(){return this._currentState}constructor(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),oe(this,"audioBuffer",void 0),oe(this,"sourceNode",void 0),oe(this,"startPlayTime",0),oe(this,"startPlayOffset",0),oe(this,"pausePlayTime",0),oe(this,"options",void 0),oe(this,"currentLoopCount",0),oe(this,"currentPlaybackSpeed",100),oe(this,"_currentState","stopped"),this.audioBuffer=t,this.options=n,this.startPlayOffset=this.options.startPlayTime||0}createWebAudioDiagram(){return this.context.createGain()}get duration(){return this.audioBuffer?this.audioBuffer.duration:0}get playbackSpeed(){return this.currentPlaybackSpeed}get currentTime(){return this.audioBuffer?this.currentState==="stopped"?0:this.currentState==="paused"?this.pausePlayTime:((this.context.currentTime-this.startPlayTime)*(this.playbackSpeed/100)+this.startPlayOffset)%this.audioBuffer.duration:0}updateOptions(t){this.currentState==="stopped"?(this.options=t,this.startPlayOffset=this.options.startPlayTime||0):w.warning("can not set audio source options")}startProcessAudioBuffer(){this.sourceNode&&this.stopProcessAudioBuffer(),this.sourceNode=this.createSourceNode(),this.startSourceNode(),this.currentState="playing"}pauseProcessAudioBuffer(){this.sourceNode&&this.currentState==="playing"&&(this.pausePlayTime=this.currentTime,this.sourceNode.onended=null,this.sourceNode.stop(),this.sourceNode.buffer=null,this.sourceNode=this.createSourceNode(),this.currentState="paused")}seekAudioBuffer(t){this.sourceNode&&(this.sourceNode.onended=null,this.currentState==="playing"&&this.sourceNode.stop(),this.sourceNode=this.createSourceNode(),this.currentState==="playing"?(this.startPlayOffset=t,this.startSourceNode()):this.currentState==="paused"&&(this.pausePlayTime=t))}resumeProcessAudioBuffer(){this.currentState==="paused"&&this.sourceNode&&(this.startPlayOffset=this.pausePlayTime,this.pausePlayTime=0,this.startSourceNode(),this.currentState="playing")}stopProcessAudioBuffer(){if(this.sourceNode){this.sourceNode.onended=null;try{this.sourceNode.stop()}catch{}this.reset()}}destroy(){this.audioBuffer=null,super.destroy()}setAudioBufferPlaybackSpeed(t){this.sourceNode&&(this.currentState==="playing"&&(this.startPlayOffset=this.currentTime,this.startPlayTime=this.context.currentTime),this.sourceNode.playbackRate.value=t/100),this.currentPlaybackSpeed=t}startSourceNode(){this.sourceNode&&this.sourceNode.buffer&&(this.sourceNode.start(0,this.startPlayOffset),this.startPlayTime=this.context.currentTime,this.sourceNode.onended=this.handleSourceNodeEnded.bind(this))}createSourceNode(){const t=this.context.createBufferSource();return t.buffer=this.audioBuffer,t.loop=!!this.options.loop,t.connect(this.outputNode),t.playbackRate.value=this.currentPlaybackSpeed/100,t}handleSourceNodeEnded(){if(this.currentLoopCount+=1,this.options.cycle&&this.options.cycle>this.currentLoopCount)return this.startPlayOffset=0,this.sourceNode=void 0,void this.startProcessAudioBuffer();this.reset()}reset(){this.startPlayOffset=this.options.startPlayTime||0,this.currentState="stopped",this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=void 0),this.currentLoopCount=0}}const UL=new Map;function jL(e,t){if(e.length===0||t.length===0)return 1/0;const n=hb(e),r=hb(t);return Math.floor(r/n)}class Vb{get rendFrameRate(){const t=Math.max(1,jL(this._render_interframe_delays_sizes,this._render_interframe_delays));return Math.floor(1e3/t)}get videoElementStatus(){return this._isInPage?this._videoElementStatus:Qr.DESTROYED}set videoElementStatus(t){t!==this._videoElementStatus&&(w.debug("[".concat(this.trackId,"] video-element-status change ").concat(this._videoElementStatus," => ").concat(t)),this._videoElementStatus=t)}get videoState(){return this._videoState}set videoState(t){var n;t!==this._videoState&&(this._videoState=t,(n=this.onVideoStateChanged)===null||n===void 0||n.call(this,this.videoState))}constructor(t){oe(this,"trackId",void 0),oe(this,"config",void 0),oe(this,"onFirstVideoFrameDecoded",void 0),oe(this,"onFirstVideoFrameRender",void 0),oe(this,"onVideoStateChanged",void 0),oe(this,"freezeTimeCounterList",[]),oe(this,"renderFreezeAccTime",0),oe(this,"renderFreezeAccTime2",0),oe(this,"isKeepLastFrame",!1),oe(this,"isDestroyed",!1),oe(this,"timeUpdatedCount",0),oe(this,"freezeTime",0),oe(this,"playbackTime",0),oe(this,"lastTimeUpdatedTime",0),oe(this,"autoplayFailed",!1),oe(this,"videoTrack",void 0),oe(this,"videoElement",void 0),oe(this,"cacheVideoElement",void 0),oe(this,"internal",!1),oe(this,"_render_interframe_delays",[]),oe(this,"_render_interframe_delays_sizes",[]),oe(this,"_videoState",bc.VideoStateStopped),oe(this,"videoElementCheckInterval",void 0),oe(this,"videoElementFreezeTimeout",void 0),oe(this,"_videoElementStatus",Qr.NONE),oe(this,"_isInPage",!0),oe(this,"isGettingVideoDimensions",!1),oe(this,"startGetVideoDimensions",(()=>{const n=()=>{if(this.isGettingVideoDimensions=!0,this.videoElement.videoWidth*this.videoElement.videoHeight>4)return w.debug("[".concat(this.trackId,"] current video dimensions:"),this.videoElement.videoWidth,this.videoElement.videoHeight),void(this.isGettingVideoDimensions=!1);setTimeout(n,500)};!this.isGettingVideoDimensions&&n()})),oe(this,"autoResumeAfterInterruption",(()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&on.curState==="running"&&(w.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(Ux())),Kx()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))})),oe(this,"handleVideoEvents",(n=>{switch(n.type){case"play":case"playing":n.type==="play"&&w.debug("[".concat(this.trackId,"] video element status: play")),this.startGetVideoDimensions(),this.videoElementStatus=Qr.PLAYING;break;case"loadeddata":if(this.videoState=bc.VideoStateStarting,this.onFirstVideoFrameRender&&this.onFirstVideoFrameRender(),this.onFirstVideoFrameDecoded&&this.onFirstVideoFrameDecoded(),this.cacheVideoElement){try{this.cacheVideoElement.srcObject=null,this.cacheVideoElement.remove()}catch{}this.cacheVideoElement=void 0}break;case"canplay":this.videoElementStatus=Qr.CANPLAY;break;case"stalled":this.videoElementStatus=Qr.STALLED;break;case"suspend":this.videoElementStatus=Qr.SUSPEND;break;case"pause":this.videoElementStatus=Qr.PAUSED,ii()||Vo()||Br()&&this.autoplayFailed||!this.videoTrack||this.videoTrack.readyState!=="live"||(w.debug("[track-".concat(this.trackId,"] video element paused, auto resume")),this.videoElement.play());break;case"waiting":this.videoElementStatus=Qr.WAITING;break;case"abort":this.videoElementStatus=Qr.ABORT;break;case"ended":this.videoElementStatus=Qr.ENDED;break;case"emptied":this.videoElementStatus=Qr.EMPTIED;break;case"error":{const r=this.videoElement.error;r&&(this.videoElementStatus=Qr.ERROR,w.error("[".concat(this.trackId,"] media error: ").concat(r.message," (").concat(r.code,")")));break}case"timeupdate":{const r=performance.now();if(this.timeUpdatedCount+=1,this.timeUpdatedCount<10)return void(this.lastTimeUpdatedTime=r);const i=r-this.lastTimeUpdatedTime,s=this.lastTimeUpdatedTime;if(this.lastTimeUpdatedTime=r,Ac.lastVisibleTime<Ac.lastHiddenTime||s<Ac.lastHiddenTime||s<Ac.lastVisibleTime||this.isSkipCalcRenderFreezeTime())return;for(i>B("VIDEO_FREEZE_DURATION")&&(this.freezeTime+=i),this.playbackTime+=i;this.playbackTime>=6e3;){this.playbackTime-=6e3;const o=Math.min(6e3,this.freezeTime);this.freezeTimeCounterList.push(o),this.freezeTime=Math.max(0,this.freezeTime-6e3)}break}}})),oe(this,"autoResumeAfterInterruptionOnIOS15_16",(()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&(w.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(Ux())),Kx()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))})),this.trackId=t.trackId,this.config=t,t.element instanceof HTMLVideoElement?this.videoElement=t.element:this.videoElement=document.createElement("video"),on.on(Mr.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),on.on(Mr.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16)}getVideoElement(){return this.videoElement}getContainerElement(){var t;return(t=this.videoElement.parentElement)!==null&&t!==void 0?t:void 0}updateConfig(t){this.config=t,this.trackId=t.trackId,t.element!==this.videoElement&&(this.destroy(),this.videoElement=t.element),this.videoTrack&&this.initVideoElement()}updateVideoTrack(t){this.videoTrack!==t&&(this.videoTrack=t,this.initVideoElement())}play(t){const n=this.videoElement.play();n&&n.catch&&n.catch((i=>{t&&H1(t,"video",i.message,this.trackId),i.name==="NotAllowedError"?(w.warning("detected video element autoplay failed",i),this.autoplayFailed=!0,this.handleAutoPlayFailed()):w.warning("[".concat(this.trackId,"] play warning: "),i)}));const r=Mt();if((r.name==="Safari"&&Number(r.version)===15||kf())&&n&&n.then){const i=()=>{this.config.mirror&&(this.videoElement.style.transform="rotateY(180deg)")};n.then(i).catch(i)}}getCurrentFrame(){const t=document.createElement("canvas");t.width=this.videoElement.videoWidth,t.height=this.videoElement.videoHeight;const n=t.getContext("2d");if(!n)return w.error("create canvas context failed!"),new ImageData(2,2);n.drawImage(this.videoElement,0,0,t.width,t.height);const r=n.getImageData(0,0,t.width,t.height);return t.remove(),r}async getCurrentFrameToUint8Array(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const r=document.createElement("canvas");r.width=this.videoElement.videoWidth,r.height=this.videoElement.videoHeight;const i=r.getContext("2d");return i?(i.drawImage(this.videoElement,0,0,r.width,r.height),new ke(((s,o)=>{r.toBlob((async c=>{if(r.remove(),c){const d=await $1(c);s({buffer:d,width:r.width,height:r.height})}else o(new de(V.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))}),t,n<0?.1:n>1?1:n)}))):await jb(t)}destroy(){this.isDestroyed=!0,on.off(Mr.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),on.off(Mr.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),this.videoElement.srcObject=null,this.resetVideoElement(),this.freezeTimeCounterList=[],this.videoState=bc.VideoStateStopped}initVideoElement(){if(this.videoElementStatus=Qr.INIT,!this.videoElementCheckInterval&&(VL.forEach((s=>{this.videoElement.addEventListener(s,this.handleVideoEvents)})),this.videoElementCheckInterval=window.setInterval((()=>{this._isInPage=(function(s){return s!==document.body&&document.body.contains(s)})(this.videoElement)}),1e3),B("ENABLE_VIDEO_FRAME_CALLBACK"))){var t,n;let s;const o=()=>{document.visibilityState==="visible"&&(document.removeEventListener("visibilitychange",o),this.videoElementFreezeTimeout=window.setTimeout(c,B("VIDEO_FREEZE_DURATION")))},c=()=>{this.videoElementFreezeTimeout=void 0,this.videoState===bc.VideoStateDecoding&&(document.visibilityState==="visible"?this.videoState=bc.VideoStateFrozen:document.addEventListener("visibilitychange",o))},d=(h,f)=>{if(this.videoElementStatus===Qr.PLAYING){if(s){const S=f.presentationTime-s.presentationTime,O=f.presentedFrames-s.presentedFrames;this._render_interframe_delays_sizes.push(O),this._render_interframe_delays.push(S);const A=hb(this._render_interframe_delays_sizes),N=A-this._render_interframe_delays_sizes[0];if(A>30&&N>5&&(this._render_interframe_delays_sizes.shift(),this._render_interframe_delays.shift()),this.videoState===bc.VideoStateStarting&&(this.videoState=bc.VideoStateDecoding),this.videoState===bc.VideoStateDecoding&&this.onVideoStateChanged&&(this.videoElementFreezeTimeout&&window.clearTimeout(this.videoElementFreezeTimeout),this.videoElementFreezeTimeout=window.setTimeout(c,B("VIDEO_FREEZE_DURATION"))),S<B("VIDEO_FREEZE_DURATION")&&this.videoState===bc.VideoStateFrozen&&(this.videoState=bc.VideoStateDecoding),S>B("VIDEO_FREEZE_DURATION")&&Ac.lastVisibleTime>=Ac.lastHiddenTime&&s.timestamp>Ac.lastVisibleTime&&s.timestamp>Ac.lastHiddenTime){const j=Math.min(66,jL(this._render_interframe_delays_sizes,this._render_interframe_delays)),U=Math.max(0,S-(O-1)*j);this.renderFreezeAccTime2+=U>j?U:0,this.renderFreezeAccTime+=S}}s=En(En({},f),{},{timestamp:h})}else this.isSkipCalcRenderFreezeTime()&&(s=En(En({},f),{},{timestamp:h}));var g,E;B("ENABLE_VIDEO_FRAME_CALLBACK")&&((g=(E=this.videoElement).requestVideoFrameCallback)===null||g===void 0||g.call(E,d))};(t=(n=this.videoElement).requestVideoFrameCallback)===null||t===void 0||t.call(n,d)}this.videoElement.controls=!1,this.videoElement.setAttribute("playsinline",""),WS()&&!B("HIDE_NO_POSTER")&&(this.videoElement.poster="noposter");const r=Mt();r.name==="Safari"&&Number(r.version)===15||kf()||!this.config.mirror||(this.videoElement.style.transform="rotateY(180deg)"),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",this.videoElement.setAttribute("muted",""),this.videoElement.muted=!0,this.videoElement.srcObject&&this.videoElement.srcObject instanceof MediaStream?this.videoElement.srcObject.getVideoTracks()[0]!==this.videoTrack&&(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,jn()&&this.videoElement.load()):(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,jn()&&this.videoElement.load());const i=this.videoElement.play();i!==void 0&&i.catch((s=>{w.debug("[".concat(this.trackId,"] playback interrupted"),s.toString())}))}resetVideoElement(){VL.forEach((t=>{this.videoElement&&this.videoElement.removeEventListener(t,this.handleVideoEvents)})),this.videoElementCheckInterval&&(window.clearInterval(this.videoElementCheckInterval),this.videoElementCheckInterval=void 0),this.videoElementStatus=Qr.NONE}isSkipCalcRenderFreezeTime(){return this.videoElementStatus===Qr.DESTROYED||this.internal}handleAutoPlayFailed(){const t=n=>{n.preventDefault(),this.videoElement.play().then((()=>{w.debug("[".concat(this.trackId,"] Video element for trackId:").concat(this.trackId," autoplay resumed."))})).catch((r=>{w.error(r)})),this.autoplayFailed=!1,zg()?document.body.removeEventListener("click",t,!0):(document.body.removeEventListener("touchstart",t,!0),document.body.removeEventListener("mousedown",t,!0))};zg()?document.body.addEventListener("click",t,!0):(document.body.addEventListener("touchstart",t,!0),document.body.addEventListener("mousedown",t,!0)),G1()}}const VL=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","timeupdate","error"];class Fb extends Vb{constructor(t){let n=arguments.length>1&&arguments[1]!==void 0&&arguments[1];super(t),oe(this,"container",void 0),oe(this,"slot",void 0),this.slot=t.element,this.internal=n,this.updateConfig(t)}updateConfig(t){this.config=t,this.trackId=t.trackId;const n=t.element;var r;!this.internal||this.slot?(n!==this.slot&&(this.destroy(),this.slot=n),this.createElements()):(this.slot=n,n&&this.container?(this.internal=!1,this.container.id="agora-video-player-".concat(this.trackId),this.videoElement.id="video_".concat(this.trackId),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",(r=this.slot)===null||r===void 0||r.appendChild(this.container)):this.createElements())}updateVideoTrack(t){this.videoTrack!==t&&(this.videoTrack=t,this.createElements())}play(t){var n;(n=this.container)!==null&&n!==void 0&&n.contains(this.videoElement)&&super.play(t)}getCurrentFrame(){var t;return(t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)?super.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameToUint8Array(t){var n;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return(n=this.container)!==null&&n!==void 0&&n.contains(this.videoElement)?await super.getCurrentFrameToUint8Array(t,r):await jb(t)}destroy(){if(super.destroy(),this.videoElement.remove(),this.videoElement=document.createElement("video"),this.container){try{var t;this.container.remove(),(t=this.slot)===null||t===void 0||t.removeChild(this.container)}catch{}this.container=void 0}}createElements(){var t;this.container||(this.container=document.createElement("div")),this.container.id="agora-video-player-".concat(this.trackId),this.container.style.width="100%",this.container.style.height="100%",this.container.style.position="relative",this.container.style.overflow="hidden",this.videoTrack?(this.container.style.backgroundColor="black",B("KEEP_LAST_FRAME")&&this.isKeepLastFrame&&this.videoElement.paused&&this.resetVideoElement(),this.mountedVideoElement()):this.unmountedVideoElement(),(t=this.slot)===null||t===void 0||t.appendChild(this.container)}mountedVideoElement(){var t;!this.container||(t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)||this.container.appendChild(this.videoElement),super.initVideoElement(),this.videoElement.id="video_".concat(this.trackId),this.videoElement.className="agora_video_player",this.videoElement.style.width="100%",this.videoElement.style.height="100%",this.videoElement.style.position="absolute",this.videoElement.style.left="0",this.videoElement.style.top="0"}unmountedVideoElement(){var t;if((t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)){super.resetVideoElement();try{this.container&&this.container.removeChild(this.videoElement)}catch{}this.videoElement=document.createElement("video")}}resetVideoElement(){var t;(t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)&&(super.resetVideoElement(),this.cacheVideoElement=this.videoElement,this.videoElement=document.createElement("video"))}getContainerElement(){return this.container}}var FL,BL,WL,GL,HL,KL,zL,YL,qL,XL,JL,QL,ZL,$L,eM,tM,nM,rM,iM,sM,oM,aM,cM,lM,dM,uM,hM,pM,bt,fM,mM,_M,gM,EM,vM,yM,SM,Ms;let Sn=(FL=et({argsMap:(e,t,n)=>[e.getTrackId(),typeof t=="string"?t:t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",n]}),BL=Bn(),WL=et({argsMap:e=>[e.getTrackId()]}),GL=Uf("LocalVideoTrack","_enabledMutex"),HL=et({argsMap:(e,t)=>[e.getTrackId(),t]}),KL=Bn(),zL=Uf("LocalVideoTrack","_enabledMutex"),YL=et({argsMap:(e,t)=>[e.getTrackId(),t]}),qL=Bn(),XL=et({argsMap:(e,t)=>[e.getTrackId(),t,e._saveEncodeBitrateRatio]}),JL=Bn(),QL=et({argsMap:(e,t)=>[e.getTrackId(),t]}),ZL=Bn(),$L=Bn(),eM=et({argsMap:(e,t,n)=>[e.getTrackId(),t,n]}),tM=Bn(),nM=Bn(),rM=Bn(),iM=et({argsMap:e=>[e.getTrackId()]}),sM=Bn(),oM=Bn(),aM=Bn(),cM=Bn(),lM=Bn(),dM=et({argsMap:(e,t)=>[e.getTrackId(),t.name]}),uM=et({argsMap:e=>[e.getTrackId()]}),hM=et({argsMap:e=>[e.getTrackId()]}),pM=et({argsMap:(e,t,n)=>[e.getTrackId(),t.label,n]}),bt=class uW extends Kf{get videoHeight(){if(Br()){const{height:t}=this._mediaStreamTrack.getSettings();return this._videoHeight=t,this._videoHeight}return this._videoHeight}get videoWidth(){if(Br()){const{width:t}=this._mediaStreamTrack.getSettings();return this._videoWidth=t,this._videoWidth}return this._videoWidth}get isPlaying(){return!(!this._player||this._player.videoElementStatus!==Qr.PLAYING)}get processorDestination(){return this._processorDestination}get processorContext(){return this._processorContext}set processorContext(t){this._processorContext=t}get __className__(){return"LocalVideoTrack"}constructor(t,n,r,i,s,o){if(super(t,s),oe(this,"trackMediaType",Hf.VIDEO),oe(this,"_player",void 0),oe(this,"isUseScaleResolutionDownBy",!1),oe(this,"_videoVisibleTimer",null),oe(this,"_previousVideoVisibleStatus",void 0),oe(this,"_clearPreviousVideoVisibleStatus",(()=>this._previousVideoVisibleStatus=void 0)),oe(this,"_encoderConfig",void 0),oe(this,"_scalabilityMode",{numSpatialLayers:1,numTemporalLayers:1}),oe(this,"_optimizationMode",void 0),oe(this,"_saveEncodeBitrateRatio",1),oe(this,"_videoHeight",void 0),oe(this,"_videoWidth",void 0),oe(this,"_forceBitrateLimit",void 0),oe(this,"_enabled",!0),oe(this,"_processorDestination",void 0),oe(this,"_processorContext",void 0),Br()){const{width:c,height:d}=t.getSettings();this._videoWidth=c,this._videoHeight=d}else this.updateMediaStreamTrackResolution();if(this._scalabilityMode=r,this._optimizationMode=i,this._hints=o||[],n&&this._hints.indexOf(ln.CUSTOM_TRACK)!==-1?this._encoderConfig=On(n):this._encoderConfig=n,this._hints.indexOf(ln.SCREEN_TRACK)===-1)this.updateBitrateFromProfile();else if($0(Kt.CHROME,115)&&FS().indexOf("Windows")!==-1){const c=(function(d,h){if("VideoFrame"in window&&"TransformStream"in window&&Bt().supportWebRTCInsertableStream){const f=new MediaStreamTrackProcessor(d),g=new MediaStreamTrackGenerator({kind:"video"});let E,S,O=Date.now();const A=()=>{N&&(clearInterval(N),N=void 0),E&&(E.close(),E=void 0),d.stop(),S=void 0,g.removeEventListener("ended",A)};let N=window.setInterval((()=>{if(S&&E&&Date.now()-O>1e3)try{g.readyState==="live"?S.enqueue(E.clone()):A()}catch{A()}}),1e3);const j=new TransformStream({transform:(U,W)=>{g.readyState==="live"?(S=W,O=Date.now(),E===void 0?(E=U,W.enqueue(U.clone())):(W.enqueue(E),E=U)):U.close()}});return g.addEventListener("ended",A),f.readable.pipeThrough(j).pipeTo(g.writable),g}})(t);c&&(w.info("local screen video track begin to inject frame"),this._mediaStreamTrack=c)}n&&this._hints.indexOf(ln.CUSTOM_TRACK)!==-1&&this.setEncoderConfiguration(n),this._processorContext=new z1(this.getTrackId(),"local"),this._processorDestination=new K1(this.processorContext),this.bindProcessorDestinationEvents()}play(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof t=="string"){const i=document.getElementById(t);i?t=i:(w.warning("[".concat(this.getTrackId(),'] can not find "#').concat(t,'" element, use document.body')),t=document.body)}w.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(n));const r=En(En(En({},this._getDefaultPlayerConfig()),n),{},{trackId:this.getTrackId(),element:t});this._player?this._player.updateConfig(r):(t instanceof HTMLVideoElement?this._player=new Vb(r):this._player=new Fb(r),this._player.updateVideoTrack(this._mediaStreamTrack)),this._player.play(),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval((()=>{try{const i=this.getVideoElementVisibleStatus();this.safeEmit(Gf.VIDEO_ELEMENT_VISIBLE_STATUS,i)}catch{}}),B("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,w.debug("[".concat(this.getTrackId(),"] stop video playback")))}async setEnabled(t,n){if(!n){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(w.info("[".concat(this.getTrackId(),"] start setEnabled"),t),!t){this._originMediaStreamTrack.enabled=!1;try{await un(this,Ve.NEED_DISABLE_TRACK,this)}catch(r){throw w.error("[".concat(this.getTrackId(),"] setEnabled to false error"),r.toString()),r}return n||(this._enabled=!1),void w.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}this._originMediaStreamTrack.enabled=!0;try{await un(this,Ve.NEED_ENABLE_TRACK,this)}catch(r){throw w.error("[".concat(this.getTrackId(),"] setEnabled to true error"),r.toString()),r}w.info("[".concat(this.getTrackId(),"] setEnabled to true success")),n||(this._enabled=!0)}async setMuted(t){t!==this._muted&&(this.stateCheck("muted",t),this._muted=t,this._originMediaStreamTrack.enabled=!t,w.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(t)),t?await un(this,Ve.NEED_MUTE_TRACK,this):await un(this,Ve.NEED_UNMUTE_TRACK,this))}async setSaveEncodeBitrateRatio(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this._saveEncodeBitrateRatio;if(this._saveEncodeBitrateRatio!==1&&this._encoderConfig&&this._encoderConfig.bitrateMax&&this._encoderConfig.bitrateMin){this._encoderConfig.bitrateMin=Math.floor(this._encoderConfig.bitrateMin*t),this._encoderConfig.bitrateMax=Math.floor(this._encoderConfig.bitrateMax*t),w.debug("[".concat(this.getTrackId(),"] set save encode bitrate ratio, ").concat(t)),this._saveEncodeBitrateRatio=1;try{await un(this,Ve.NEED_UPDATE_VIDEO_ENCODER,this)}catch(n){return n.throw(w)}}}async setEncoderConfiguration(t,n){if(!this._enabled)throw new de(V.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");if(t=Wo(t),B("USE_STANDARD_BITRATE_DEFAULT")&&(delete t.bitrateMax,delete t.bitrateMin),this._forceBitrateLimit&&(t.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:t.bitrateMax,t.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:t.bitrateMin),t.width||t.height||t.frameRate){const r=nT({encoderConfig:t});(Br()||ii()||Vo())&&(r.deviceId=void 0),w.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(t),JSON.stringify(r));try{await this._originMediaStreamTrack.applyConstraints(r),this.updateMediaStreamTrackResolution()}catch(i){const s=new de(V.UNEXPECTED_ERROR,i.toString());throw w.error("[".concat(this.getTrackId(),"] applyConstraints error"),s.toString()),s}}this._encoderConfig=t,this._hints.indexOf(ln.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await un(this,Ve.NEED_UPDATE_VIDEO_ENCODER,this)}catch(r){return r.throw(w)}}getStats(){return Id((()=>{w.warning("[deprecated] LocalVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalVideoStats instead")}),"localVideoTrackGetStatsWarning"),As(this,Ve.GET_STATS)||En({},Pb)}async setBeautyEffect(t){w.error("LocalVideoTrack.setBeautyEffect was deprecated, please migrate to agora-extension-beauty-effect")}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameImage(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return this._player?this._player.getCurrentFrameToUint8Array(t,n):await jb(t)}async findClosestProfile(){const{width:t,height:n,frameRate:r}=this.getMediaStreamTrackSettings(),{width:i,height:s,frameRate:o}=this._encoderConfig||{},c=Mf(this._videoWidth||t||i||0),d=Mf(this._videoHeight||n||s||0),h=(function(f,g,E){if(!Array.isArray(B("VIDEO_ENCODER_CONFIG_LIST"))||B("VIDEO_ENCODER_CONFIG_LIST").length===0)return!1;const S=Math.min(f,g);return!(S>=480)&&En(En({},B("VIDEO_ENCODER_CONFIG_LIST").find((O=>O.height>S))),{},{frameRate:E})})(c,d,Mf(r||o||15));if(h)return w.debug("[".concat(this.getTrackId(),"] find closest profile, ").concat(c,"x").concat(d," => ").concat(JSON.stringify(h))),this.setEncoderConfiguration(h)}async setBitrateLimit(t){w.debug("[".concat(this.getTrackId(),"] set bitrate limit, ").concat(JSON.stringify(t))),t&&(this._forceBitrateLimit=t,this._encoderConfig&&(this._encoderConfig.bitrateMax?this._encoderConfig.bitrateMax=this._encoderConfig.bitrateMax<t.max_bitrate?this._encoderConfig.bitrateMax:t.max_bitrate:this._encoderConfig.bitrateMax=t.max_bitrate,this._encoderConfig.bitrateMin,this._encoderConfig.bitrateMin=t.min_bitrate))}async setOptimizationMode(t){if(t!=="motion"&&t!=="detail"&&t!=="balanced")return void w.error(V.INVALID_PARAMS,"optimization mode must be motion, detail or balanced");const n=this._optimizationMode;try{this._optimizationMode=t,await un(this,Ve.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this)}catch(r){throw this._optimizationMode=n,w.error("[".concat(this.getTrackId(),"] set optimization mode failed"),r.toString()),r}w.info("[".concat(this.getTrackId(),"] set optimization mode success (").concat(t,")"))}setScalabiltyMode(t){if(t.numSpatialLayers===1&&t.numTemporalLayers!==1)return w.error(V.INVALID_PARAMS,"scalability mode currently not supported, no SVC."),void(this._scalabilityMode={numSpatialLayers:1,numTemporalLayers:1});this._scalabilityMode=t,w.info("[".concat(this.getTrackId(),"] set scalability mode success (").concat(t,")"))}updateMediaStreamTrackResolution(){X1(this._originMediaStreamTrack).then((t=>{let[n,r]=t;this._videoHeight=r,this._videoWidth=n})).catch(KS)}_updatePlayerSource(){this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}_getDefaultPlayerConfig(){return{fit:"contain"}}async setSenderConfiguration(t){if(!this._enabled)throw new de(V.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");w.debug("[".concat(this.getTrackId(),"] setSenderConfiguration applyConstraints"),JSON.stringify(t)),t=Wo(t),this._forceBitrateLimit&&(t.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:t.bitrateMax,t.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:t.bitrateMin),this._encoderConfig=t,this._hints.indexOf(ln.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await un(this,Ve.NEED_UPDATE_VIDEO_ENCODER,this)}catch(n){return n.throw(w)}}updateBitrateFromProfile(){if(!this._encoderConfig)return;const{width:t,height:n,frameRate:r}=this.getMediaStreamTrackSettings();if(!t||!n||!r)return;const{bitrateMax:i,bitrateMin:s}=this._encoderConfig;if(s==null||i==null){const{max:o,min:c}=(function(d,h,f,g,E){const S=B("BITRATE_ADAPTER_TYPE");if(S==="DEFAULT_BITRATE")return{min:g,max:E};if(E===void 0){const O=Math.floor(200*Math.pow(f/15,.6)*Math.pow(d*h/640/360,.75));E=S==="STANDARD_BITRATE"?4*O:2*O,g=g??O}else g=g??Math.floor(E/10);return{min:g,max:E}})(t,n,r,s,i);if(this._encoderConfig.bitrateMin=c,this._encoderConfig.bitrateMax=o,B("VIDEO_STANDARD_BITRATE_VERSION")&&s==null&&i==null){const[d,h]=(function(f,g,E){const S=4*Math.floor(2e5*Math.pow(E/15,.6)*Math.pow(f*g/230400,.75)),O=f*g,A=new Map([[19200,.9],[230400,.85],[518400,.75],[921600,.7],[2073600,.6],[3686400,.5]]),N=new Map([[230400,.95],[518400,.9],[921600,.85],[2073600,.8]]);let j=fs(A).call(A).next().value,U=1;if(A.has(O))j=A.get(O);else{var W;const Re=hh(W=Array.from(A.entries())).call(W,((Ct,at)=>{let[Qt]=Ct,[qt]=at;return Qt-qt})),St=Re.find((Ct=>{let[at]=Ct;return at>O}));if(St){const Ct=Re.indexOf(St);if(Ct>0){const at=Re[Ct-1],Qt=(O-at[0])/(St[0]-at[0]);j=at[1]+Qt*(St[1]-at[1])}else j=St[1]}else j=Re[Re.length-1][1]}if(N.has(O))U=N.get(O);else{var $;const Re=hh($=Array.from(N.entries())).call($,((Ct,at)=>{let[Qt]=Ct,[qt]=at;return Qt-qt})),St=Re.find((Ct=>{let[at]=Ct;return at>O}));if(St){const Ct=Re.indexOf(St);if(Ct>0){const at=Re[Ct-1],Qt=(O-at[0])/(St[0]-at[0]);U=at[1]+Qt*(St[1]-at[1])}else U=St[1]}else U=Re[Re.length-1][1]}const Z=B("VIDEO_NEW_BITRATE_RATIO");Z&&Z>0&&(j=Z/100);const Y=Math.floor(S*j),ie=Math.floor(65e4*Math.pow(f*g/230400,.5)*Math.pow(E/15,.69));let ue=Y;const ge=B("VIDEO_STANDARD_BITRATE_VERSION");return ge&&ge>0&&(ge===1?ue=S:ge===2?ue=Y:ge===3&&(ue=ie)),[Math.floor(ue/1e3),U]})(t,n,r);this._encoderConfig.bitrateMax=d,this._encoderConfig.bitrateMin=c?Math.min(c,d):d,this._saveEncodeBitrateRatio=h,w.debug("[".concat(this.getTrackId(),"] update new bitrate from profile, [w: ").concat(t,", h: ").concat(n,", fps: ").concat(r,"] => [brMax: ").concat(this._encoderConfig.bitrateMax,", brMin: ").concat(this._encoderConfig.bitrateMin,", save_bitrate_ratio: ").concat(this._saveEncodeBitrateRatio,"]"))}else w.debug("[".concat(this.getTrackId(),"] update bitrate from profile, [w: ").concat(t,", h: ").concat(n,", fps: ").concat(r,"] => [brMax: ").concat(o,", brMin: ").concat(c,"]")),this._saveEncodeBitrateRatio=1}}getVideoElementVisibleStatus(){try{var t,n;const r=this==null||(t=this._player)===null||t===void 0?void 0:t.getContainerElement(),i={track:this,element:this==null||(n=this._player)===null||n===void 0?void 0:n.getVideoElement(),slot:r?.parentElement},{element:s,slot:o}=i;if(this.isPlaying&&s instanceof HTMLVideoElement&&o instanceof HTMLElement){const c=Jx.checkOneElementVisible(s),d=Object.assign({},c);if(d.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=d.visible;const h=We.reportApiInvoke(null,{tag:Nn.TRACER,name:Gn.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});d.visible?h.onSuccess("Video is visible"):h.onSuccess("Invisible because of ".concat(d.reason))}return d}return}catch(r){throw new de(V.GET_VIDEO_ELEMENT_VISIBLE_ERROR,r.message)}}async renewMediaStreamTrack(t){}pipe(t){if(this.processor===t)return t;if(t._source)throw new de(V.INVALID_OPERATION,"Processor ".concat(t.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=t,this.processor._source=this,t.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),t}unpipe(){if(!this.processor)return;const t=this.processor;this.processor._source=void 0,this.processor=void 0,t.reset()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe()}clone(t){let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],r=this._encoderConfig;t&&(r=En(En({},r),Wo(t))),r=Sh(r);const i=hn(8,"track-video-cloned-"),s=new uW(n?this._mediaStreamTrack.clone():this._mediaStreamTrack,r,Sh(this._scalabilityMode),this._optimizationMode,i,Sh(this._hints));return t&&r&&s.setEncoderConfiguration(r),w.debug("clone video track from ".concat(this.getTrackId()," to ").concat(i,", clone ").concat(n)),s}async replaceTrack(t,n){if(!(t instanceof MediaStreamTrack))throw new de(V.INVALID_PARAMS,"track should be an instance of MediaStreamTrack");if(t.kind!=="video")throw new de(V.INVALID_PARAMS,"track should be a video MediaStreamTrack");await this._updateOriginMediaStreamTrack(t,n,!0),this.updateMediaStreamTrackResolution()}sendSeiData(t){if(Id((()=>{We.reportApiInvoke(null,{name:Gn.LOCAL_VIDEO_SEND_SEI_DATA,options:[],tag:Nn.TRACER}).onSuccess("")}),this._mediaStreamTrack.id||this.getTrackId()),!B("ENABLE_VIDEO_SEI")||!B("ENABLE_ENCODED_TRANSFORM"))return void w.warning('To send/receive SEI, please call AgoraRTC.setParameter("ENABLE_VIDEO_SEI", true) before instantiate IAgoraRtcClient');if(t instanceof Uint8Array==0)return new de(V.INVALID_PARAMS,"Invalid argument type, ILocalVideoTrack.sendSeiData() only accept Uint8Array argument.").throw();const n=this.getRTCRtpTransceiver();if(!n)return void w.warning("Video track is not published, SEI can not be send");const r=n.sender.getParameters();if(r.codecs.length===0)return;const i=r.codecs[0].mimeType.toLocaleLowerCase();i==="video/h264"||i==="video/h265"?this.safeEmit("sei-to-send",t):w.warning("SEI is not supported by ".concat(i))}bindProcessorDestinationEvents(){this.processorDestination.on(bi.ON_TRACK,(async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource(),await un(this,Ve.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await un(this,Ve.NEED_REPLACE_TRACK,this))}))}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(bi.ON_TRACK)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners(Ps.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(Ps.REQUEST_CONSTRAINTS)}},Lt(bt.prototype,"play",[FL,BL],Object.getOwnPropertyDescriptor(bt.prototype,"play"),bt.prototype),Lt(bt.prototype,"stop",[WL],Object.getOwnPropertyDescriptor(bt.prototype,"stop"),bt.prototype),Lt(bt.prototype,"setEnabled",[GL,HL,KL],Object.getOwnPropertyDescriptor(bt.prototype,"setEnabled"),bt.prototype),Lt(bt.prototype,"setMuted",[zL,YL,qL],Object.getOwnPropertyDescriptor(bt.prototype,"setMuted"),bt.prototype),Lt(bt.prototype,"setSaveEncodeBitrateRatio",[XL,JL],Object.getOwnPropertyDescriptor(bt.prototype,"setSaveEncodeBitrateRatio"),bt.prototype),Lt(bt.prototype,"setEncoderConfiguration",[QL,ZL],Object.getOwnPropertyDescriptor(bt.prototype,"setEncoderConfiguration"),bt.prototype),Lt(bt.prototype,"getStats",[$L],Object.getOwnPropertyDescriptor(bt.prototype,"getStats"),bt.prototype),Lt(bt.prototype,"setBeautyEffect",[eM,tM],Object.getOwnPropertyDescriptor(bt.prototype,"setBeautyEffect"),bt.prototype),Lt(bt.prototype,"getCurrentFrameData",[nM],Object.getOwnPropertyDescriptor(bt.prototype,"getCurrentFrameData"),bt.prototype),Lt(bt.prototype,"getCurrentFrameImage",[rM],Object.getOwnPropertyDescriptor(bt.prototype,"getCurrentFrameImage"),bt.prototype),Lt(bt.prototype,"findClosestProfile",[iM,sM],Object.getOwnPropertyDescriptor(bt.prototype,"findClosestProfile"),bt.prototype),Lt(bt.prototype,"setBitrateLimit",[oM],Object.getOwnPropertyDescriptor(bt.prototype,"setBitrateLimit"),bt.prototype),Lt(bt.prototype,"setOptimizationMode",[aM],Object.getOwnPropertyDescriptor(bt.prototype,"setOptimizationMode"),bt.prototype),Lt(bt.prototype,"setScalabiltyMode",[cM],Object.getOwnPropertyDescriptor(bt.prototype,"setScalabiltyMode"),bt.prototype),Lt(bt.prototype,"updateMediaStreamTrackResolution",[lM],Object.getOwnPropertyDescriptor(bt.prototype,"updateMediaStreamTrackResolution"),bt.prototype),Lt(bt.prototype,"pipe",[dM],Object.getOwnPropertyDescriptor(bt.prototype,"pipe"),bt.prototype),Lt(bt.prototype,"unpipe",[uM],Object.getOwnPropertyDescriptor(bt.prototype,"unpipe"),bt.prototype),Lt(bt.prototype,"close",[hM],Object.getOwnPropertyDescriptor(bt.prototype,"close"),bt.prototype),Lt(bt.prototype,"replaceTrack",[pM],Object.getOwnPropertyDescriptor(bt.prototype,"replaceTrack"),bt.prototype),bt),rT=(fM=et({argsMap:(e,t)=>[e.getTrackId(),t]}),mM=Bn(),_M=Uf("CameraVideoTrack","_enabledMutex"),gM=et({argsMap:(e,t)=>[e.getTrackId(),t]}),EM=Bn(),vM=et({argsMap:(e,t)=>[e.getTrackId(),t]}),yM=Bn(),SM=et({argsMap:e=>[e.getTrackId()]}),Ms=class hW extends Sn{get __className__(){return"CameraVideoTrack"}constructor(t,n,r,i,s,o){super(t,Wo(n.encoderConfig),i,s,o),oe(this,"_config",void 0),oe(this,"_originalConstraints",void 0),oe(this,"_constraints",void 0),oe(this,"_enabled",!0),oe(this,"_deviceName","default"),oe(this,"tryResumeVideoForIOS15_16WeChat",(async()=>{(kf()||ib())&&!(function(){const c=Mt();if(c.os!==Er.IOS||!c.osVersion)return!1;const d=c.osVersion.split(".");return Number(d[0])===15&&Number(d[1])>=2})()&&zx()&&this._enabled&&!this._isClosed&&(w.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS 15 device on WeChat.")),await this.renewMediaStreamTrack())})),this._config=n,this._originalConstraints=r,this._constraints=r,this._deviceName=t.label,this._encoderConfig=Wo(this._config.encoderConfig),on.on(Mr.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),on.on(Mr.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),this.bindProcessorContextEvents()}async setDevice(t){return typeof t=="string"?this._setDeviceById(t):t.deviceId?this._setDeviceById(t.deviceId):t.facingMode?this._setDeviceByFacingModel(t.facingMode):void 0}async _setDeviceById(t){if(w.info("[".concat(this.getTrackId(),"] set device to ").concat(t)),this._enabled)try{const n=await xs.getDeviceById(t),r={};r.video=En({},this._constraints),r.video.deviceId={exact:t},r.video.facingMode=void 0,this._originMediaStreamTrack.stop();let i=null;try{i=await ks(r,this.getTrackId())}catch(s){throw w.error("[".concat(this.getTrackId(),"] setDevice failed"),s.toString()),i=await ks({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!1),s}await this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution(),this._deviceName=n.label,this._config.cameraId=t,this._constraints.deviceId={exact:t}}catch(n){throw w.error("[".concat(this.getTrackId(),"] setDevice error"),n.toString()),n}else try{const n=await xs.getDeviceById(t);this._deviceName=n.label,this._config.cameraId=t,this._constraints.deviceId={exact:t}}catch(n){throw w.error("[".concat(this.getTrackId(),"] setDevice error"),n.toString()),n}w.info("[".concat(this.getTrackId(),"] setDevice success"))}async _setDeviceByFacingModel(t){w.info("[".concat(this.getTrackId(),"] set facingMode ").concat(t));const n={video:En(En({},this._constraints),{},{deviceId:void 0,facingMode:{exact:t}})};if(this._enabled){this._originMediaStreamTrack.stop();let r=null;try{r=await ks(n,this.getTrackId())}catch(i){throw w.error("[".concat(this.getTrackId(),"] setDeviceByFacingModel failed"),i.toString()),r=await ks({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(r.getVideoTracks()[0],!1),i}await this._updateOriginMediaStreamTrack(r.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution()}this._deviceName="",this._config.facingMode=t,this._config.cameraId=void 0,this._constraints=En({},n.video),w.info("[".concat(this.getTrackId(),"] setDeviceByFacingModel success"))}async setEnabled(t,n){if(!n){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(w.info("[".concat(this.getTrackId(),"] start setEnabled"),t),t){try{if(this.isExternalTrack)this._originMediaStreamTrack.enabled=!0;else{const r=await ks({video:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(r.getVideoTracks()[0],!1)}await un(this,Ve.NEED_ENABLE_TRACK,this)}catch(r){throw w.error("[".concat(this.getTrackId(),"] setEnabled true error"),r.toString()),r}this.updateMediaStreamTrackResolution(),w.info("[".concat(this.getTrackId(),"] setEnabled to true success")),n||(this._enabled=!0)}else{this.isExternalTrack?this._originMediaStreamTrack.enabled=!1:(this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop()),n||(this._enabled=!1);try{await un(this,Ve.NEED_DISABLE_TRACK,this)}catch(r){throw w.error("[".concat(this.getTrackId(),"] setEnabled to false error"),r.toString()),r}w.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}}async setEncoderConfiguration(t,n){if(!this._enabled)throw new de(V.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");t=Wo(t),B("USE_STANDARD_BITRATE_DEFAULT")&&(delete t.bitrateMax,delete t.bitrateMin),this._forceBitrateLimit&&(t.bitrateMax=this._forceBitrateLimit.max_bitrate||t.bitrateMax,t.bitrateMin=this._forceBitrateLimit.min_bitrate||t.bitrateMin);const r=On(this._config);r.encoderConfig=t;const i=nT(r);(Br()||ii()||Vo())&&(i.deviceId=void 0),w.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(t),JSON.stringify(i));try{await this._originMediaStreamTrack.applyConstraints(i),this.updateMediaStreamTrackResolution()}catch(s){const o=new de(V.UNEXPECTED_ERROR,s.toString());throw w.error("[".concat(this.getTrackId(),"] applyConstraints error"),o.toString()),o}this._config=r,this._constraints=i,this._originalConstraints=i,this._encoderConfig=t,this._hints.indexOf(ln.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await un(this,Ve.NEED_UPDATE_VIDEO_ENCODER,this)}catch(s){return s.throw(w)}}_getDefaultPlayerConfig(){return{mirror:!0,fit:"cover"}}onTrackEnded(){if((ii()||Vo())&&this._enabled&&!this._isClosed&&on.duringInterruption){const t=async()=>{on.off(Mr.IOS_INTERRUPTION_END,t),this._enabled&&!this._isClosed&&(w.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};on.on(Mr.IOS_INTERRUPTION_END,t)}else w.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(Gf.TRACK_ENDED)}async renewMediaStreamTrack(t){const n=t||this._constraints,r=xs.searchDeviceIdByName(this._deviceName);if(r&&!n.deviceId&&(n.deviceId={exact:r}),this._enabled){const i=await ks({video:n},this.getTrackId());this._constraints=n,await this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!0),this.updateMediaStreamTrackResolution()}}close(){super.close(),on.off(Mr.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),on.off(Mr.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat)}clone(t){let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],r=this._encoderConfig;t&&(r=En(En({},r),Wo(t))),r=Sh(r);const i=hn(8,"track-cam-cloned-"),s=new hW(n?this._mediaStreamTrack.clone():this._mediaStreamTrack,Sh(En(En({},this._config),{},{encoderConfig:r})),Sh(this._constraints),Sh(this._scalabilityMode),this._optimizationMode,i);return t&&r&&s.setEncoderConfiguration(r),w.debug("clone track from ".concat(this.getTrackId()," to ").concat(i,", clone ").concat(n)),s}bindProcessorContextEvents(){this.processorContext.on(Ps.REQUEST_UPDATE_CONSTRAINTS,(async(t,n,r)=>{try{const i=Object.assign({},this._originalConstraints,...t);await this.renewMediaStreamTrack(i),n()}catch(i){r(i)}})),this.processorContext.on(Ps.REQUEST_CONSTRAINTS,(async t=>{t(this._originMediaStreamTrack.getSettings())}))}},Lt(Ms.prototype,"setDevice",[fM,mM],Object.getOwnPropertyDescriptor(Ms.prototype,"setDevice"),Ms.prototype),Lt(Ms.prototype,"setEnabled",[_M,gM,EM],Object.getOwnPropertyDescriptor(Ms.prototype,"setEnabled"),Ms.prototype),Lt(Ms.prototype,"setEncoderConfiguration",[vM,yM],Object.getOwnPropertyDescriptor(Ms.prototype,"setEncoderConfiguration"),Ms.prototype),Lt(Ms.prototype,"close",[SM],Object.getOwnPropertyDescriptor(Ms.prototype,"close"),Ms.prototype),Ms);function Bb(e,t,n,r){n.optimizationMode&&(r&&r.width&&r.height?(n.encoderConfig=En(En({},r),{},{bitrateMin:r.bitrateMin,bitrateMax:r.bitrateMax}),n.optimizationMode!=="motion"&&n.optimizationMode!=="detail"||(t.contentHint=n.optimizationMode,t.contentHint===n.optimizationMode?w.debug("[".concat(e,"] set content hint to"),n.optimizationMode):w.debug("[".concat(e,"] set content hint failed")))):w.warning("[".concat(e,"] can not apply optimization mode bitrate config, no encoderConfig")))}var TM,RM,wM,CM,oo,bM,IM,AM,NM,OM,PM,mi;class DM extends x1{getUserId(){return this._userId}constructor(t,n,r,i){super(t,"track-".concat(t.kind,"-").concat(n,"-").concat(i.clientId,"_").concat(hn(5,""))),oe(this,"_userId",void 0),oe(this,"_uintId",void 0),oe(this,"_isDestroyed",!1),oe(this,"store",void 0),oe(this,"processor",void 0),oe(this,"processorContext",void 0),this._userId=n,this._uintId=r,this.store=i}_updateOriginMediaStreamTrack(t){this._originMediaStreamTrack=t,this._mediaStreamTrack=t,this._updatePlayerSource(),this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext})}_destroy(){this._isDestroyed=!0,w.info("[".concat(this.getTrackId(),"] is destroyed")),this.stop(),super.close()}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}}let qf=(TM=et({argsMap:(e,t,n)=>[e.getTrackId(),typeof t=="string"?t:t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",n]}),RM=et({argsMap:e=>[e.getTrackId()]}),wM=et({argsMap:(e,t)=>[e.getTrackId(),t.name]}),CM=et({argsMap:e=>[e.getTrackId()]}),Lt((oo=class extends DM{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==Qr.PLAYING)}get __className__(){return"RemoteVideoTrack"}constructor(e,t,n,r,i){super(e,t,n,r),oe(this,"_videoVisibleTimer",null),oe(this,"_previousVideoVisibleStatus",void 0),oe(this,"_clearPreviousVideoVisibleStatus",(()=>this._previousVideoVisibleStatus=void 0)),oe(this,"trackMediaType",Hf.VIDEO),oe(this,"_videoWidth",void 0),oe(this,"_videoHeight",void 0),oe(this,"_player",void 0),oe(this,"_prePlayer",void 0),oe(this,"processorDestination",void 0),oe(this,"processorContext",void 0),this._prePlayer=i,this.updateMediaStreamTrackResolution(),this.processorContext=new z1(this.getTrackId(),"remote"),this.processorDestination=new K1(this.processorContext),this.bindProcessorDestinationEvents()}getStats(){return Id((()=>{w.warning("[deprecated] RemoteVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteVideoStats instead")}),"remoteVideoTrackGetStatsWarning"),As(this,Ve.GET_STATS)||En({},D1)}play(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(this.safeEmit(so.PLAY_START),typeof e=="string"){const r=document.getElementById(e);r?e=r:(w.warning("[".concat(this.getTrackId(),'] can not find "#').concat(e,'" element, use document.body')),e=document.body)}w.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(e instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(t));const n=En(En({fit:"cover"},t),{},{trackId:this.getTrackId(),element:e});if(this._player)this._player.updateConfig(n);else{let r=!1,i=!1;e instanceof HTMLVideoElement?(this._player=new Vb(n),this._prePlayer&&(this._prePlayer.destroy(),this._prePlayer=void 0,i=!0)):this._prePlayer&&!this._prePlayer.isDestroyed?(this._player=this._prePlayer,this._prePlayer=void 0,r=this._player.videoState>0,this._player.updateConfig(n)):this._player=new Fb(n),this._player.updateVideoTrack(this._mediaStreamTrack),this._player.onFirstVideoFrameDecoded=()=>{this.store.subscribe(this.getUserId(),"video",void 0,void 0,Date.now()),this.safeEmit(so.FIRST_FRAME_DECODED),i&&this.safeEmit(so.FIRST_FRAME_RENDER)},this._player.onVideoStateChanged=s=>{this.safeEmit(so.VIDEO_STATE_CHANGED,s)},r&&(this._player.onFirstVideoFrameDecoded(),this._player.onVideoStateChanged(this._player.videoState))}this._player.play(this.store.sessionId||void 0),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval((()=>{try{const r=this.getVideoElementVisibleStatus();this.safeEmit(so.VIDEO_ELEMENT_VISIBLE_STATUS,r)}catch{}}),B("CHECK_VIDEO_VISIBLE_INTERVAL")),this.safeEmit(so.PLAY_END)}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,w.debug("[".concat(this.getTrackId(),"] stop video playback")))}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}updateMediaStreamTrackResolution(){X1(this._originMediaStreamTrack).then((e=>{let[t,n]=e;this._videoHeight=n,this._videoWidth=t})).catch(KS)}_updatePlayerSource(){w.debug("[".concat(this.getTrackId(),"] update player source track")),this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}getVideoElementVisibleStatus(){try{var e,t;const n=this==null||(e=this._player)===null||e===void 0?void 0:e.getContainerElement(),r={track:this,element:this==null||(t=this._player)===null||t===void 0?void 0:t.getVideoElement(),slot:n?.parentElement},{element:i,slot:s}=r;if(this.isPlaying&&i instanceof HTMLVideoElement&&s instanceof HTMLElement){const o=Jx.checkOneElementVisible(i),c=Object.assign({},o);if(c.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=c.visible;const d=We.reportApiInvoke(null,{tag:Nn.TRACER,name:Gn.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});c.visible?d.onSuccess("Video is visible"):d.onSuccess("Invisible because of ".concat(c.reason))}return c}return}catch(n){throw new de(V.GET_VIDEO_ELEMENT_VISIBLE_ERROR,n.message)}}pipe(e){if(this.processor===e)return e;if(e._source)throw new de(V.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),e}unpipe(){if(!this.processor)return;const e=this.processor;this.processor._source=void 0,this.processor=void 0,e.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(bi.ON_TRACK,(async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource()):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())}))}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(bi.ON_TRACK)}_destroy(){this._prePlayer&&(this._prePlayer.destroy(),this._prePlayer=void 0),super._destroy(),this.unbindProcessorDestinationEvents()}_onSei(e){this.emit(Ch.SEI_RECEIVED,e)}}).prototype,"play",[TM],Object.getOwnPropertyDescriptor(oo.prototype,"play"),oo.prototype),Lt(oo.prototype,"stop",[RM],Object.getOwnPropertyDescriptor(oo.prototype,"stop"),oo.prototype),Lt(oo.prototype,"pipe",[wM],Object.getOwnPropertyDescriptor(oo.prototype,"pipe"),oo.prototype),Lt(oo.prototype,"unpipe",[CM],Object.getOwnPropertyDescriptor(oo.prototype,"unpipe"),oo.prototype),oo),Xf=(bM=et({argsMap:(e,t)=>[e.getTrackId(),t],throttleTime:300}),IM=et({argsMap:(e,t)=>[e.getTrackId(),t]}),AM=et({argsMap:e=>[e.getTrackId()]}),NM=et({argsMap:e=>[e.getTrackId()]}),OM=et({argsMap:(e,t)=>[e.getTrackId(),t.name]}),PM=et({argsMap:e=>[e.getTrackId()]}),Lt((mi=class extends DM{get isPlaying(){return this._useAudioElement?Vi.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"RemoteAudioTrack"}constructor(e,t,n,r){super(e,t,n,r),oe(this,"trackMediaType",Hf.AUDIO),oe(this,"_source",void 0),oe(this,"_useAudioElement",!0),oe(this,"_volume",100),oe(this,"processorContext",void 0),oe(this,"processorDestination",void 0),oe(this,"_played",!1),oe(this,"_bypassWebAudio",!1),B("DISABLE_WEBAUDIO")?(this._source=new Ub,this._bypassWebAudio=!0,this._useAudioElement=!0):(this._source=new j1(e,!0),B("REMOTE_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1)),this._source.once(Os.RECEIVE_TRACK_BUFFER,(()=>{this.safeEmit(so.FIRST_FRAME_DECODED)})),this.processorContext=new q1(this._source.context,this.getTrackId(),"remote"),this.processorDestination=new Y1(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on(Os.UPDATE_SOURCE,(()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})}))}setAudioFrameCallback(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!e)return this._source.removeAllListeners(Os.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(t),this._source.removeAllListeners(Os.ON_AUDIO_BUFFER),this._source.on(Os.ON_AUDIO_BUFFER,(n=>e(n)))}setVolume(e){this._volume=e,this._useAudioElement?Vi.setVolume(this.getTrackId(),e):this._source.setVolume(e/100)}async setPlaybackDevice(e){if(!this._useAudioElement||!A1())throw new de(V.NOT_SUPPORTED,"your browser does not support setting the audio output device");await Vi.setSinkID(this.getTrackId(),e)}getVolumeLevel(){return this._source.getAccurateVolumeLevel()}getStats(){return Id((()=>{w.warning("[deprecated] RemoteAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteAudioStats instead")}),"remoteAudioTrackGetStatsWarning"),As(this,Ve.GET_STATS)||En({},P1)}play(){w.debug("[".concat(this.getTrackId(),"] start audio playback")),this._played=!0,this._useAudioElement?(w.debug("[".concat(this.getTrackId(),"] use audio element to play")),Vi.play(this._mediaStreamTrack,this.getTrackId(),this._volume,this.store.sessionId||void 0)):this._source.play()}stop(){w.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._played=!1,this._useAudioElement?Vi.stop(this.getTrackId()):this._source.stop()}_destroy(){super._destroy(),this._played=!1,this.unbindProcessorDestinationEvents(),this._source.destroy()}_isFreeze(){return this._source.isFreeze}_updatePlayerSource(){let e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];w.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&Vi.updateTrack(this.getTrackId(),this._mediaStreamTrack)}pipe(e){if(this._bypassWebAudio)throw new de(V.NOT_SUPPORTED,"can not pipe extension when WebAudio disabled");if(this.processor===e)return e;if(e._source)throw new de(V.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(this._bypassWebAudio)throw new de(V.NOT_SUPPORTED,"can not unpipe extension when WebAudio disabled");if(!this.processor)return;const t=this.processor;(e=this._source.processSourceNode)===null||e===void 0||e.disconnect(),this.processor._source=!1,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(bi.ON_TRACK,(async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(e)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())})),this.processorDestination.on(bi.ON_NODE,(e=>{this._source.processedNode=e;const t=!e;this._useAudioElement!==t&&(this._played?(this.stop(),this._useAudioElement=t,this.play()):this._useAudioElement=t)}))}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(bi.ON_TRACK),this.processorDestination.removeAllListeners(bi.ON_NODE)}}).prototype,"setVolume",[bM],Object.getOwnPropertyDescriptor(mi.prototype,"setVolume"),mi.prototype),Lt(mi.prototype,"setPlaybackDevice",[IM],Object.getOwnPropertyDescriptor(mi.prototype,"setPlaybackDevice"),mi.prototype),Lt(mi.prototype,"play",[AM],Object.getOwnPropertyDescriptor(mi.prototype,"play"),mi.prototype),Lt(mi.prototype,"stop",[NM],Object.getOwnPropertyDescriptor(mi.prototype,"stop"),mi.prototype),Lt(mi.prototype,"pipe",[OM],Object.getOwnPropertyDescriptor(mi.prototype,"pipe"),mi.prototype),Lt(mi.prototype,"unpipe",[PM],Object.getOwnPropertyDescriptor(mi.prototype,"unpipe"),mi.prototype),mi);const Ac=new class extends xn{get visibility(){return document.visibilityState}get lastHiddenTime(){return this._lastHiddenTime}get lastVisibleTime(){return this._lastVisibleTime}constructor(){super(),oe(this,"_lastHiddenTime",0),oe(this,"_lastVisibleTime",0),document.addEventListener("visibilitychange",(()=>{document.visibilityState==="hidden"?this._lastHiddenTime=performance.now():this._lastVisibleTime=performance.now(),w.debug("current web page is ".concat(document.visibilityState)),this.emit("VISIBILITY_CHANGE",document.visibilityState)}))}};class kM extends xn{constructor(t,n){super(),oe(this,"trackMediaType",Hf.DATA),oe(this,"_version",1),oe(this,"_type",3),oe(this,"_config",void 0),oe(this,"_originDataChannel",void 0),oe(this,"_dataStreamPacketHeader",new ArrayBuffer(4)),oe(this,"_dataStreamPacketHandler",{serialize:r=>r,deserialize:r=>r}),oe(this,"_datachannelEventMap",new Map),this._config=t,n&&(this._originDataChannel=n,this._bandDataChannelEvents(n)),this._initPacketHeader()}useDataStream(t){this._dataStreamPacketHandler=t}get id(){return this._config.id}get ordered(){return this._config.ordered}get maxRetransmits(){return B("DATASTREAM_MAX_RETRANSMITS")}get metadata(){return this._config.metadata}get readyState(){var t,n;return(t=(n=this._originDataChannel)===null||n===void 0?void 0:n.readyState)!==null&&t!==void 0?t:"connecting"}get _originDataChannelId(){var t,n;return(t=(n=this._originDataChannel)===null||n===void 0?void 0:n.id)!==null&&t!==void 0?t:null}getChannelId(){return this.id}getConfig(){return this._config}_close(){this._originDataChannel&&(this._unbindDataChannelEvents(this._originDataChannel),this._originDataChannel=void 0)}async _waitTillOpen(){return new ke(((t,n)=>{if(this._originDataChannel){this._originDataChannel.readyState==="open"&&t();const r=setTimeout((()=>{var i;n(new de(V.DATACHANNEL_CONNECTION_TIMEOUT,"Cannot create datachannel, id: ".concat((i=this._originDataChannel)===null||i===void 0?void 0:i.id)))}),1e4);this._originDataChannel.onopen=()=>{clearTimeout(r),this._originDataChannel&&this._bandDataChannelEvents(this._originDataChannel),t()},this._originDataChannel.onerror=()=>{throw clearTimeout(r),new de(V.DATACHANNEL_CONNECTION_TIMEOUT)}}else n(new de(V.DATACHANNEL_CONNECTION_TIMEOUT,"cannot find dataChannel"))}))}_updateOriginDataChannel(t){this._originDataChannel=t,this._bandDataChannelEvents(t)}_initPacketHeader(){const t=new DataView(this._dataStreamPacketHeader);t.setUint16(0,this._version),t.setUint8(2,this._type),t.setUint8(3,this._config.id)}_bandDataChannelEvents(t){this._unbindDataChannelEvents(t),[eT.OPEN,eT.CLOSE,eT.ERROR].forEach((n=>{const r=()=>{this.emit(n)};this._datachannelEventMap.set(n,r),t.addEventListener(n,r)}))}_unbindDataChannelEvents(t){Array.from(this._datachannelEventMap.entries()).forEach((n=>{let[r,i]=n;t.removeEventListener(r,i)})),this._datachannelEventMap.clear()}}class E9 extends kM{constructor(t){super(t),oe(this,"_messageListener",void 0),this._messageListener=n=>{if(n.data.byteLength<this._dataStreamPacketHeader.byteLength)throw Error("invalid byteLength: the byte length must exceed "+this._dataStreamPacketHeader.byteLength);const r=n.data.slice(0,this._dataStreamPacketHeader.byteLength),i=new DataView(r).getUint8(3);if(i!==this.id)return void(B("SHOW_DATASTREAM2_LOG")&&w.debug("invalid datachannel id: ".concat(i," !== ").concat(this.id)));let s=n.data.slice(this._dataStreamPacketHeader.byteLength);s=this._dataStreamPacketHandler.deserialize(s),this.emit(eT.MESSAGE,s)}}_updateOriginDataChannel(t){super._updateOriginDataChannel(t),this._bandRemoteDataChannelEvents()}_close(){this._originDataChannel&&(this._originDataChannel.removeEventListener("message",this._messageListener),super._close())}_bandRemoteDataChannelEvents(){this._originDataChannel&&this._originDataChannel.addEventListener("message",this._messageListener)}}class v9 extends kM{send(t){if(this._originDataChannel){let n=t;n=this._dataStreamPacketHandler.serialize(t);const r=new Uint8Array(this._dataStreamPacketHeader.byteLength+n.byteLength);r.set(new Uint8Array(this._dataStreamPacketHeader),0),r.set(new Uint8Array(n),this._dataStreamPacketHeader.byteLength),this._originDataChannel.send(r.buffer)}}}function iT(){const e=new Blob([atob("Y29uc3QgdD0idmlkZW8vaDI2NCIsZT0idmlkZW8vaDI2NSI7ZnVuY3Rpb24gbih0LGUsbil7bGV0IGE9bmV3IFVpbnQ4QXJyYXkodCxlLG4pLHI9W10sbz0wO2Zvcig7ci5sZW5ndGg8bjspbyszPG4mJjA9PT1hW29dJiYwPT09YVtvKzFdJiYzPT09YVtvKzJdJiYoMD09PWFbbyszXXx8MT09PWFbbyszXXx8Mj09PWFbbyszXXx8Mz09PWFbbyszXSk/KHIucHVzaChhW29dLGFbbysxXSxhW28rM10pLG8rPTQpOihyLnB1c2goYVtvXSksbysrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkocil9ZnVuY3Rpb24gYShhLHIpe3N3aXRjaChyKXtjYXNlIHQ6cmV0dXJuIGZ1bmN0aW9uKHQpe2NvbnN0IGU9bmV3IERhdGFWaWV3KHQuZGF0YSk7bGV0IGE9MDtmb3IoO2ErNDx0LmRhdGEuYnl0ZUxlbmd0aDspe2lmKDA9PT1lLmdldFVpbnQ4KGErMCkmJjA9PT1lLmdldFVpbnQ4KGErMSkmJjA9PT1lLmdldFVpbnQ4KGErMikmJjE9PT1lLmdldFVpbnQ4KGErMykmJjY9PT1lLmdldFVpbnQ4KGErNCkpe2xldCByPWErNixvPTAsaT0wO2Zvcig7MjU1PT09KGk9ZS5nZXRVaW50OChyKyspKTspbys9MjU1O28rPWk7Y29uc3Qgcz1uKHQuZGF0YSxyLG8pO3JldHVybiBuZXcgVWludDhBcnJheShzKX1hKyt9cmV0dXJuIG51bGx9KGEpO2Nhc2UgZTpyZXR1cm4gZnVuY3Rpb24odCl7Y29uc3QgZT1uZXcgRGF0YVZpZXcodC5kYXRhKTtsZXQgYT0wO2Zvcig7YSs1PHQuZGF0YS5ieXRlTGVuZ3RoOyl7aWYoMD09PWUuZ2V0VWludDgoYSswKSYmMD09PWUuZ2V0VWludDgoYSsxKSYmMD09PWUuZ2V0VWludDgoYSsyKSYmMT09PWUuZ2V0VWludDgoYSszKSYmNzg9PT1lLmdldFVpbnQ4KGErNCkmJjE9PT1lLmdldFVpbnQ4KGErNSkmJjEwMT09PWUuZ2V0VWludDgoYSs2KSl7bGV0IHI9YSs3LG89MCxpPTA7Zm9yKDsyNTU9PT0oaT1lLmdldFVpbnQ4KHIrKykpOylvKz0yNTU7bys9aTtjb25zdCBzPW4odC5kYXRhLHIsbyk7cmV0dXJuIG5ldyBVaW50OEFycmF5KHMpfWErK31yZXR1cm4gbnVsbH0oYSk7ZGVmYXVsdDpyZXR1cm4gbnVsbH19ZnVuY3Rpb24gcih0KXtjb25zdCBlPXQubGVuZ3RoO2xldCBuPVtdLGE9MDtmb3IoO2E8ZTspYSsyPGUmJjA9PT10W2FdJiYwPT09dFthKzFdJiYoMD09PXRbYSsyXXx8MT09PXRbYSsyXXx8Mj09PXRbYSsyXXx8Mz09PXRbYSsyXSk/KG4ucHVzaCh0W2FdLHRbYSsxXSwzLHRbYSsyXSksYSs9Myk6KG4ucHVzaCh0W2FdKSxhKyspO3JldHVybiBuZXcgVWludDhBcnJheShuKX1mdW5jdGlvbiBvKG4sYSxvKXtzd2l0Y2gobyl7Y2FzZSB0OnJldHVybiBmdW5jdGlvbih0LGUpe2NvbnN0IG49cihlKSxhPW4ubGVuZ3RoLG89TWF0aC5mbG9vcihhLzI1NSksaT1hJTI1NSxzPW5ldyBVaW50OEFycmF5KDYrbysxK2ErdC5ieXRlTGVuZ3RoKTtzWzBdPTAsc1sxXT0wLHNbMl09MCxzWzNdPTEsc1s0XT02LHNbNV09MTAxO2xldCBmPTA7Zm9yKDtmPG87KXNbNitmXT0yNTUsZisrO3JldHVybiBzWzYrZl09aSxmKysscy5zZXQobiw2K2YpLHMuc2V0KG5ldyBVaW50OEFycmF5KHQpLDYrZithKSxzLmJ1ZmZlcn0obixhKTtjYXNlIGU6cmV0dXJuIGZ1bmN0aW9uKHQsZSl7Y29uc3Qgbj1yKGUpLGE9bi5sZW5ndGgsbz1NYXRoLmZsb29yKGEvMjU1KSxpPWElMjU1LHM9bmV3IFVpbnQ4QXJyYXkoNytvKzErYSsxK3QuYnl0ZUxlbmd0aCk7c1swXT0wLHNbMV09MCxzWzJdPTAsc1szXT0xLHNbNF09Nzgsc1s1XT0xLHNbNl09MTAxO2xldCBmPTA7Zm9yKDtmPG87KXNbNytmXT0yNTUsZisrO3JldHVybiBzWzcrZl09aSxmKysscy5zZXQobiw3K2YpLGYrPWEsc1s3K2ZdPTEyOCxmKysscy5zZXQobmV3IFVpbnQ4QXJyYXkodCksNytmKSxzLmJ1ZmZlcn0obixhKTtkZWZhdWx0OnJldHVybiBudWxsfX1mdW5jdGlvbiBpKG4pe2lmKG4ubGVuZ3RoPDUpcmV0dXJuIiI7bGV0IGE9LTE7Zm9yKGxldCB0PTA7dDxuLmxlbmd0aC0zO3QrKyl7aWYoMD09PW5bdF0mJjA9PT1uW3QrMV0mJjE9PT1uW3QrMl0pe2E9dDticmVha31pZih0PG4ubGVuZ3RoLTQmJjA9PT1uW3RdJiYwPT09blt0KzFdJiYwPT09blt0KzJdJiYxPT09blt0KzNdKXthPXQ7YnJlYWt9fWlmKC0xPT09YSlyZXR1cm4iIjtjb25zdCByPWErKDA9PT1uW2ErMl0/NDozKTtpZihyPj1uLmxlbmd0aClyZXR1cm4iIjtjb25zdCBvPW5bcl07aWYoMTI4Jm8pcmV0dXJuIiI7aWYoKG8+PjEmNjMpPj0zMilyZXR1cm4gZTtpZihyKzE8bi5sZW5ndGgpe2lmKDA9PSgyNDgmbltyKzFdKSlyZXR1cm4gZX1yZXR1cm4oMzEmbyk8PTMxP3Q6IiJ9Y29uc3Qgcz03MSxmPTEsbD0yLHU9MSxnPTI7dmFyIGM7ZnVuY3Rpb24gZCh0LGU9ITEpe2NvbnN0IG49dC5nZXRVaW50OCgwKTtpZihuIT09cylyZXR1cm47Y29uc3QgYT10LmdldFVpbnQxNigxKSxyPWYrbCthLG89bmV3IFVpbnQ4QXJyYXkodC5ieXRlTGVuZ3RoLXIpO28uc2V0KG5ldyBVaW50OEFycmF5KHQuYnVmZmVyLHIsdC5ieXRlTGVuZ3RoLXIpKTtjb25zdCBpPXttOm4sdGx2TGVuOmEsdGx2OltdLGZyYW1lOm99O2xldCBkPWYrbDtmb3IoO2Q8cjspe2NvbnN0IG49dC5nZXRVaW50OChkKSxhPXQuZ2V0VWludDE2KGQrdSkscj11K2c7aWYobj09PWMuQVVESU9fTEVWRUwpe2xldCBvPXQuZ2V0VWludDgoZCtyKTtmb3IobGV0IGU9MTtlPGE7ZSsrKW89bzw8OHx0LmdldFVpbnQ4KGQrcitlKTtpLnRsdi5wdXNoKHt0YWc6bixsZW5ndGg6YSx2YWx1ZTplPzEyN15vPj4xOjEyNyZvfSl9ZWxzZSBpZihuPT09Yy5NRVRBREFUQXx8bj09PWMuQVVESU9fNjRfQklUX1BUUyl7Y29uc3QgZT1uZXcgVWludDhBcnJheShhKTtmb3IobGV0IG49MDtuPGE7bisrKWVbbl09dC5nZXRVaW50OChkK3Irbik7aS50bHYucHVzaCh7dGFnOm4sbGVuZ3RoOmEsdmFsdWU6ZX0pfWQrPXIrYX1yZXR1cm4gaX0hZnVuY3Rpb24odCl7dFt0LkFVRElPX0xFVkVMPTFdPSJBVURJT19MRVZFTCIsdFt0Lk1FVEFEQVRBPTJdPSJNRVRBREFUQSIsdFt0LkFVRElPXzY0X0JJVF9QVFM9M109IkFVRElPXzY0X0JJVF9QVFMifShjfHwoYz17fSkpLHNlbGYub25ydGN0cmFuc2Zvcm09dD0+e2NvbnN0IGU9dC50cmFuc2Zvcm1lcjtsZXQgbj1bXSxyPVtdO2Uub3B0aW9ucy5wb3J0Lm9ubWVzc2FnZT10PT57dC5kYXRhLnNlaSYmbi5wdXNoKHQuZGF0YS5zZWkpLHQuZGF0YS5tZXRhZGF0YSYmci5wdXNoKHQuZGF0YS5tZXRhZGF0YSl9LHNlbGYucG9zdE1lc3NhZ2UoInN0YXJ0ZWQiKTtjb25zdCBoPWUucmVhZGFibGUuZ2V0UmVhZGVyKCksVT1lLndyaXRhYmxlLmdldFdyaXRlcigpOyJzZWktcngiPT09ZS5vcHRpb25zLm5hbWU/ZnVuY3Rpb24gdChlKXtoLnJlYWQoKS50aGVuKChuPT57aWYoIW4uZG9uZSl7aWYobi52YWx1ZSBpbnN0YW5jZW9mIFJUQ0VuY29kZWRWaWRlb0ZyYW1lKXtjb25zdCB0PWkobmV3IFVpbnQ4QXJyYXkobi52YWx1ZS5kYXRhKSkscj1hKG4udmFsdWUsdCk7ciYmZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3NlaTpyfSl9VS53cml0ZShuLnZhbHVlKSxlLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSx0KGUpfX0pKX0oZSk6InNlaS10eCI9PT1lLm9wdGlvbnMubmFtZT9mdW5jdGlvbiB0KGUpe2gucmVhZCgpLnRoZW4oKGE9PntpZighYS5kb25lKXtpZihhLnZhbHVlIGluc3RhbmNlb2YgUlRDRW5jb2RlZFZpZGVvRnJhbWUpe2NvbnN0IHQ9aShuZXcgVWludDhBcnJheShhLnZhbHVlLmRhdGEpKSxlPW4uc2hpZnQoKTtpZihlKXtjb25zdCBuPW8oYS52YWx1ZS5kYXRhLGUsdCk7biYmKGEudmFsdWUuZGF0YT1uKX19VS53cml0ZShhLnZhbHVlKSxlLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSx0KGUpfX0pKX0oZSk6ImF1ZGlvLW1ldGFkYXRhLXJ4Ij09PWUub3B0aW9ucy5uYW1lP2Z1bmN0aW9uIHQoZSl7aC5yZWFkKCkudGhlbigobj0+e2lmKCFuLmRvbmUpe2lmKG4udmFsdWUgaW5zdGFuY2VvZiBSVENFbmNvZGVkQXVkaW9GcmFtZSl7Y29uc3QgdD1uZXcgRGF0YVZpZXcobi52YWx1ZS5kYXRhKSxhPXQuZ2V0VWludDgoMCk7bGV0IHI7aWYoMCE9KDEyOCZhKSYmNzEhPT1hKXtsZXQgZT1mdW5jdGlvbih0KXtpZih0LmJ5dGVMZW5ndGg8PTApcmV0dXJuW107Y29uc3QgZT1bXTtsZXQgbj0wO2Zvcig7bjx0LmJ5dGVMZW5ndGg7KXtjb25zdCBhPSgxMjgmdC5nZXRVaW50OChuKSk+Pjcscj0xMjcmdC5nZXRVaW50OChuKTtpZighKGEmJm4rNDw9dC5ieXRlTGVuZ3RoKSl7bisrO2JyZWFrfXtjb25zdCBhPXQuZ2V0VWludDMyKG4sITEpLG89KDE2Nzc2MTkyJmEpPj4xMCxpPTEwMjMmYTtlLnB1c2goe3B0OnIsdHNfb2Zmc2V0Om8sbGVuZ3RoOmksZGF0YTpuZXcgVWludDhBcnJheX0pLG4rPTR9fWxldCBhPXQuYnl0ZUxlbmd0aC1uO2Zvcihjb25zdCByIG9mIGUpe2lmKHIubGVuZ3RoPmEpcmV0dXJuIGNvbnNvbGUud2FybigiQnJva2VuIHJlZCBwYXlsb2FkIiksW107ci5sZW5ndGg+MCYmKHIuZGF0YT1uZXcgVWludDhBcnJheSh0LmJ1ZmZlcix0LmJ5dGVPZmZzZXQrbixyLmxlbmd0aCksbis9ci5sZW5ndGgsYS09ci5sZW5ndGgpfWlmKGE+MCl7Y29uc3Qgcj17cHQ6ZS5sZW5ndGg+MD9lW2UubGVuZ3RoLTFdLnB0OjAsdHNfb2Zmc2V0OjAsbGVuZ3RoOmEsZGF0YTpuZXcgVWludDhBcnJheSh0LmJ1ZmZlcix0LmJ5dGVPZmZzZXQrbixhKX07ZS5wdXNoKHIpfXJldHVybiBlfSh0KTtpZihlLmxlbmd0aD4wKXtjb25zdCB0PWZ1bmN0aW9uKHQpe2xldCBlPTA7Zm9yKGxldCBuPTA7bjx0Lmxlbmd0aDtuKyspZSs9bjx0Lmxlbmd0aC0xPzQ6MSxlKz10W25dLmxlbmd0aDtjb25zdCBuPW5ldyBVaW50OEFycmF5KGUpO2xldCBhPTA7Zm9yKGxldCBlPTA7ZTx0Lmxlbmd0aDtlKyspaWYoZTx0Lmxlbmd0aC0xKXtjb25zdCByPSgyMTQ3NDgzNjQ4fCgxMjcmdFtlXS5wdCk8PDI0fCgyNjIxNDMmdFtlXS50c19vZmZzZXQpPDwxMHwxMDIzJnRbZV0ubGVuZ3RoKT4+PjA7blthKytdPXI+PjI0JjI1NSxuW2ErK109cj4+MTYmMjU1LG5bYSsrXT1yPj44JjI1NSxuW2ErK109MjU1JnJ9ZWxzZSBuW2ErK109MTI3JnRbZV0ucHQ7Zm9yKGNvbnN0IGUgb2YgdCluLnNldChlLmRhdGEsYSksYSs9ZS5sZW5ndGg7cmV0dXJuIG59KGUubWFwKCh0PT57bGV0IGU9bmV3IFVpbnQ4QXJyYXkodC5sZW5ndGgpO2Uuc2V0KHQuZGF0YSk7Y29uc3Qgbj1kKG5ldyBEYXRhVmlldyhlLmJ1ZmZlcikpO3JldHVybiBuPy5mcmFtZSYmKHQuZGF0YT1uPy5mcmFtZSkscj1uLHR9KSkpO24udmFsdWUuZGF0YT10LmJ1ZmZlcn19ZWxzZSByPWQodCksciYmKG4udmFsdWUuZGF0YT1yLmZyYW1lLmJ1ZmZlcik7aWYocil7bGV0IHQ9ci50bHYuZmluZCgodD0+dC50YWc9PT1jLk1FVEFEQVRBKSk7aWYodCYmdC52YWx1ZSBpbnN0YW5jZW9mIFVpbnQ4QXJyYXkmJmUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHttZXRhZGF0YTp0LnZhbHVlfSksdD1yLnRsdi5maW5kKCh0PT50LnRhZz09PWMuQVVESU9fNjRfQklUX1BUUykpLHQmJnQudmFsdWUgaW5zdGFuY2VvZiBVaW50OEFycmF5JiY4PT10LnZhbHVlLmxlbmd0aCl7Y29uc3Qgbj1uZXcgRGF0YVZpZXcodC52YWx1ZS5idWZmZXIpLmdldEJpZ1VpbnQ2NCgwLCEwKTt0JiZ0LnZhbHVlIGluc3RhbmNlb2YgVWludDhBcnJheSYmZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3B0czpufSl9fX1VLndyaXRlKG4udmFsdWUpLGUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHt0cmFuc2Zvcm1lZDohMH0pLHQoZSl9fSkpfShlKToiYXVkaW8tbWV0YWRhdGEtdHgiPT09ZS5vcHRpb25zLm5hbWUmJmZ1bmN0aW9uIHQoZSl7aC5yZWFkKCkudGhlbigobj0+e2lmKCFuLmRvbmUpe2lmKGUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHtnZXRNZXRhZGF0YTohMH0pLG4udmFsdWUgaW5zdGFuY2VvZiBSVENFbmNvZGVkQXVkaW9GcmFtZSl7Y29uc3QgdD1yLnNoaWZ0KCk7dCYmKG4udmFsdWUuZGF0YT1mdW5jdGlvbih0LGUsbil7Y29uc3QgYT1uLmJ5dGVMZW5ndGgscj1hK3UrZyxvPWYrbCtyLGk9bmV3IEFycmF5QnVmZmVyKHQuYnl0ZUxlbmd0aCtvKSxjPW5ldyBEYXRhVmlldyhpKTtjLnNldFVpbnQ4KDAscyksYy5zZXRVaW50MTYoMSxyKSxjLnNldFVpbnQ4KDMsZSksYy5zZXRVaW50MTYoNCxhKTtmb3IobGV0IHQ9MDt0PGE7dCsrKWMuc2V0VWludDgoNit0LG5bdF0pO2NvbnN0IGQ9bmV3IFVpbnQ4QXJyYXkoYy5idWZmZXIpO3JldHVybiBkLnNldChuZXcgVWludDhBcnJheSh0KSxvKSxkLmJ1ZmZlcn0obi52YWx1ZS5kYXRhLGMuQVVESU9fNjRfQklUX1BUUyx0KSl9VS53cml0ZShuLnZhbHVlKSxlLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSx0KGUpfX0pKX0oZSl9LHNlbGYucG9zdE1lc3NhZ2UoInJlZ2lzdGVyZWQiKTsK")],{type:"text/javascript"});return setTimeout((()=>rS.revokeObjectURL(e)),0),new Worker(rS.createObjectURL(e))}const xM=71,Wb=1,Gb=2,Hb=1,LM=2;var Od=(function(e){return e[e.AUDIO_LEVEL=1]="AUDIO_LEVEL",e[e.METADATA=2]="METADATA",e[e.AUDIO_64_BIT_PTS=3]="AUDIO_64_BIT_PTS",e})(Od||{});function Kb(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const n=e.getUint8(0);if(n!==xM)return;const r=e.getUint16(1),i=Wb+Gb+r,s=new Uint8Array(e.byteLength-i);s.set(new Uint8Array(e.buffer,i,e.byteLength-i));const o={m:n,tlvLen:r,tlv:[],frame:s};let c=Wb+Gb;for(;c<i;){const d=e.getUint8(c),h=e.getUint16(c+Hb),f=Hb+LM;if(d===Od.AUDIO_LEVEL){let g=e.getUint8(c+f);for(let E=1;E<h;E++)g=g<<8|e.getUint8(c+f+E);o.tlv.push({tag:d,length:h,value:t?127^g>>1:127&g})}else if(d===Od.METADATA||d===Od.AUDIO_64_BIT_PTS){const g=new Uint8Array(h);for(let E=0;E<h;E++)g[E]=e.getUint8(c+f+E);o.tlv.push({tag:d,length:h,value:g})}c+=f+h}return o}const sT=new Map,oT=127,Ah=1e-10,zb=139/13,aT=new Map;function Yb(e,t,n){const r="".concat(e,"-").concat(t,"-").concat(n);let i=0;return aT.has(r)?i=aT.get(r):(i=Math.log((function(o,c){const d=o-c;c<d&&(c=d);let h=1;for(let f=o,g=1;f>c;f--,g++)h=h*f/g;return h})(t,e))+e*Math.log(.5)+(t-e)*Math.log(1-.5)-Math.log(n)+n*e,aT.set(r,i)),i<Ah&&(i=Ah),i}function MM(e,t,n){const r=t.length,i=e.length/r;let s=!1;for(let o=0,c=0;o<r;o++){let d=0;for(let h=c+i;c<h;c++)e[c]>n&&d++;t[o]!==d&&(t[o]=d,s=!0)}return s}window.cache=aT;let y9=0;class UM{constructor(t){oe(this,"id",void 0),oe(this,"immediates",[]),oe(this,"lastNonSilence",-1),oe(this,"immediateSpeechActivityScore",Ah),oe(this,"lastLevelChangedTime",Date.now()),oe(this,"levels",[]),oe(this,"longs",[]),oe(this,"longSpeechActivityScore",Ah),oe(this,"mediums",[]),oe(this,"mediumSpeechActivityScore",Ah),oe(this,"minLevel",0),oe(this,"nextMinLevel",0),oe(this,"nextMinLevelWindowLength",0),oe(this,"energyScore",0),this.id=t||"".concat(y9++),this.immediates.length=50,this.mediums.length=10,this.longs.length=1,this.levels.length=this.immediates.length}computeImmediates(){const t=this.immediates,n=this.levels,r=this.minLevel+zb;let i=!1;for(let s=0;s<t.length;++s){let o=n[s];o<r&&(o=0);const c=Math.floor(o/zb);t[s]!==c&&(t[s]=c,i=!0)}return i}computeLongs(){return MM(this.mediums,this.longs,4)}computeMediums(){return MM(this.immediates,this.mediums,7)}evaluateImmediateSpeechActivityScore(){this.immediateSpeechActivityScore=Yb(this.immediates[0],13,.78)}evaluateLongSpeechActivityScore(t){this.longSpeechActivityScore=Yb(this.longs[0],10,47),this.longSpeechActivityScore>Ah&&(this.lastNonSilence=t)}evaluateMediumSpeechActivityScore(){this.mediumSpeechActivityScore=Yb(this.mediums[0],5,24)}evaluateSpeechActivityScores(t){this.computeImmediates()&&(this.evaluateImmediateSpeechActivityScore(),this.computeMediums()&&(this.evaluateMediumSpeechActivityScore(),this.computeLongs()&&this.evaluateLongSpeechActivityScore(t)))}getLastLevelChangedTime(){return this.lastLevelChangedTime}getLevels(){var t;return"[".concat(xu(t=[...this.levels]).call(t).join(),"]")}getSpeechActivityScore(t){switch(t){case 0:return this.immediateSpeechActivityScore;case 1:return this.mediumSpeechActivityScore;case 2:return this.longSpeechActivityScore;default:throw new Error("interval "+t)}}levelChanged(t,n){if(this.lastLevelChangedTime<=n){this.lastLevelChangedTime=n;let r=t;return t<0&&(r=0),t>oT&&(r=oT),this.levels.unshift(r),this.levels.length>this.immediates.length&&this.levels.pop(),this.updateMinLevel(r),r>=this.minLevel+zb?r:r/2}return-1}levelTimedOut(){this.levelChanged(0,this.lastLevelChangedTime)}updateMinLevel(t){if(t!==0){if(this.minLevel===0||this.minLevel>t)return this.minLevel=t,this.nextMinLevel=0,void(this.nextMinLevelWindowLength=0);if(this.nextMinLevel===0)return this.nextMinLevel=t,void(this.nextMinLevelWindowLength=1);if(this.nextMinLevel>t&&(this.nextMinLevel=t),this.nextMinLevelWindowLength++,this.nextMinLevelWindowLength>=750){let n=Math.sqrt(this.minLevel*this.nextMinLevel);n<0?n=0:n>oT&&(n=oT),this.minLevel=n,this.nextMinLevel=0,this.nextMinLevelWindowLength=0}}}}class S9{constructor(t){oe(this,"algorithm",void 0),this.algorithm=t}execute(){let t=!this.algorithm;if(!t)try{const n=this.algorithm.runInDecisionMaker(this);n<=0?t=!0:setTimeout(this.execute.bind(this),n)}catch{t=!0}t&&this.algorithm&&this.algorithm.decisionMakerExited(this)}}class qb{constructor(t,n,r){oe(this,"isDominant",void 0),oe(this,"energyRanking",void 0),oe(this,"energyScore",void 0),this.isDominant=t,this.energyRanking=n,this.energyScore=r}}class T9 extends xn{constructor(t){super(),oe(this,"dominantId",null),oe(this,"lastDecisionTime",0),oe(this,"lastLevelChangedTime",0),oe(this,"lastLevelIdleTime",0),oe(this,"relativeSpeechActivities",[]),oe(this,"speakers",new Map),oe(this,"enableSilence",!1),oe(this,"timeoutToSilenceInterval",0),oe(this,"decisionMaker",null),oe(this,"loudest",[]),oe(this,"numLoudestToTrack",3),oe(this,"energyExpireTimeMs",250),oe(this,"energyAlphaPct",50),this.timeoutToSilenceInterval=t,this.enableSilence=t>0,this.relativeSpeechActivities.length=3}setLoudestConfig(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:3,n=arguments.length>1?arguments[1]:void 0,r=arguments.length>2?arguments[2]:void 0;this.numLoudestToTrack=t,n!=null&&(this.energyExpireTimeMs=n),r!=null&&(this.energyAlphaPct=r),this.loudest.length>t&&this.loudest.splice(t)}getDominantSpeaker(){return this.dominantId}isAmongLoudest(t){return this.loudest.some((n=>n.id===t))}levelChanged(t,n){const r=Date.now(),i=this.getOrCreateSpeaker(t);this.lastLevelChangedTime<r&&(this.lastLevelChangedTime=r,this.maybeStartDecisionMaker());const s=i.levelChanged(n,r);return this.updateLoudestList(i,s,r)}runInDecisionMaker(t){return this.decisionMaker!==t||this.lastDecisionTime>0&&this.lastDecisionTime-this.lastLevelChangedTime>=15e3?-1:this._runInDecisionMaker()}decisionMakerExited(t){this.decisionMaker===t&&(this.decisionMaker=null)}destroy(){this.decisionMaker=null,this.loudest.length=0,this.speakers.clear(),this.removeAllListeners()}addSpeakers(t){t.forEach((n=>{this.speakers.has(n.id)||this.speakers.set(n.id,n)}))}removeSpeakers(t){t.forEach((n=>{this.speakers.delete(n.id)}))}getOrCreateSpeaker(t){let n=this.speakers.get(t);return n||(n=new UM(t),this.speakers.set(t,n),this.maybeStartDecisionMaker()),n}updateLoudestList(t,n,r){const i=t.id===this.dominantId;if(n<0){let d=0;for(;d<this.loudest.length&&this.loudest[d]!==t;)++d;return new qb(i,d,t.energyScore)}if(t.energyScore=Math.floor((this.energyAlphaPct*n+(100-this.energyAlphaPct)*t.energyScore+50)/100),this.numLoudestToTrack===0)return new qb(i,0,t.energyScore);const s=r-this.energyExpireTimeMs;let o=0;for(;o<this.loudest.length;){const d=this.loudest[o];if(d.getLastLevelChangedTime()<s&&this.loudest.length>=this.numLoudestToTrack)this.loudest.splice(o,1);else if(d.id!==t.id)++o;else if(this.loudest.splice(o,1),this.loudest.length<this.numLoudestToTrack)break}let c=0;for(;c<this.loudest.length&&!(this.loudest[c].energyScore<t.energyScore);)++c;return c<this.numLoudestToTrack&&(this.loudest.splice(c,0,t),this.loudest.length>this.numLoudestToTrack&&this.loudest.splice(this.numLoudestToTrack,1)),new qb(i,c,t.energyScore)}maybeStartDecisionMaker(){!this.decisionMaker&&this.speakers.size>0&&(this.decisionMaker=new S9(this),this.decisionMaker.execute())}makeDecision(t){let n=null,r=null;const i=this.speakers.size;let s=null;if(i===0)s=null;else if(i===1){var o;const c=fs(o=this.speakers).call(o).next().value;this.enableSilence&&c&&(s=c.id,c.evaluateSpeechActivityScores(t),t-c.lastNonSilence>this.timeoutToSilenceInterval&&(s=null))}else{let c=this.dominantId==null?null:this.speakers.get(this.dominantId);if(c==null){const f=this.speakers.entries().next();f.value&&(s=f.value[0],c=f.value[1])}else s=c.id;c?.evaluateSpeechActivityScores(t);const d=this.relativeSpeechActivities;let h=2;for(const f of this.speakers.entries()){const[g,E]=f;if(E===c)continue;E.evaluateSpeechActivityScores(t);for(let N=0;N<d.length;++N){const j=c==null?Ah:c.getSpeechActivityScore(N);d[N]=Math.log(E.getSpeechActivityScore(N)/j)}const S=d[0],O=d[1],A=d[2];S>3&&O>2&&A>0&&O>h&&(h=O,s=g)}this.enableSilence&&c!=null&&s===c.id&&t-c.lastNonSilence>this.timeoutToSilenceInterval&&(s=null)}s==null&&!this.enableSilence||s===this.dominantId||(n=this.dominantId,this.dominantId=s,r=this.dominantId),r==null&&!this.enableSilence||r===n||this.emit("ActiveSpeakerChanged",r)}_runInDecisionMaker(){const t=Date.now(),n=300-(t-this.lastLevelIdleTime);let r=0;n<=0?(this.lastLevelIdleTime!==0&&this.timeoutIdleLevels(t),this.lastLevelIdleTime=t):r=n;let i=300-(t-this.lastDecisionTime);return i<=0&&(this.lastDecisionTime=t,this.makeDecision(t),i=300-(Date.now()-t)),i>0&&r>i&&(r=i),r}timeoutIdleLevels(t){const n=[];for(const i of fs(r=this.speakers).call(r)){var r;const s=t-i.getLastLevelChangedTime();36e5<s&&(this.dominantId==null||i.id!==this.dominantId)?n.push(i.id):300<s&&i.levelTimedOut()}n.forEach((i=>this.speakers.delete(i)))}}const Jf=new Map;let Ia=null,cT=null;const jM=3;let Nh=[];const Aa=new Map,lT=new Map;class R9{get samples(){return this.actives+this.inactives}get activeRate(){return this.actives/this.samples}constructor(t,n){oe(this,"id",void 0),oe(this,"track",void 0),oe(this,"score",0),oe(this,"active",!0),oe(this,"muted",!1),oe(this,"timer",0),oe(this,"actives",0),oe(this,"inactives",0),this.id=t,this.track=n,this.setActive(Aa.size<3)}autoCheckActive(){this.autoSetActive(),this.autoAdjustActive(),this.resetTimer(),this.actives=0,this.inactives=0}autoSetActive(){const t=this.active;this.active=this.activeRate>=.8;const{actives:n,inactives:r}=(function(){const i=[],s=[];return Array.from(fs(Aa).call(Aa)).forEach((o=>{o.active?i.push(o):s.push(o)})),{actives:i,inactives:s}})();if(n.length>3){let i;n.forEach((s=>{(!i||i.score>s.score)&&(i=s)})),i&&i.setActive(!1)}if(n.length<3&&r.length>0){let i;r.forEach((s=>{(!i||i.score<s.score)&&s.id!==this.id&&(i=s)})),i&&t&&!this.active&&(i.samples>40&&i.activeRate-this.activeRate>.4?i.setActive(!0):this.active=!0)}this.setMuted(!this.active)}setActive(t){this.active=t,this.resetTimer(),this.setMuted(!t)}autoAdjustActive(){this.active?this.autoSwitchToInactive():this.autoSwitchToActive()}autoSwitchToActive(){const t=(function(n){let r;return Array.from(fs(Aa).call(Aa)).forEach((i=>{!i.active||i.id===n||i.samples<40||(!r||i.score<r.score)&&(r=i)})),r})(this.id);t&&this.activeRate-t.activeRate>.4&&(t.setActive(!1),this.setActive(!0))}autoSwitchToInactive(){const t=(function(n){let r;return Array.from(fs(Aa).call(Aa)).forEach((i=>{i.active||i.id===n||i.samples<40||(!r||i.score>r.score)&&(r=i)})),r})(this.id);t&&t.activeRate-this.activeRate>.4&&(t.setActive(!0),this.setActive(!1))}addSample(t){t?this.actives+=1:this.inactives+=1,this.samples>66.66666666666667&&this.autoCheckActive()}setMuted(t){this.track&&(this.track.enabled=!t,this.muted=t)}resetTimer(){this.clearTimer(),this.timer=window.setTimeout((()=>{if(this.samples!==0)return this.samples<50?this.resetTimer():void this.autoCheckActive()}),1e3)}clearTimer(){this.timer&&(clearTimeout(this.timer),this.timer=0)}}let dT;function VM(e){const t=Aa.get(e);t&&(Aa.delete(e),t.clearTimer())}const uT=new Map,w9=new Map,Xb="video/h264",Jb="video/h265";function FM(e,t,n){let r=new Uint8Array(e,t,n),i=[],s=0;for(;i.length<n;)s+3<n&&r[s]===0&&r[s+1]===0&&r[s+2]===3&&(r[s+3]===0||r[s+3]===1||r[s+3]===2||r[s+3]===3)?(i.push(r[s],r[s+1],r[s+3]),s+=4):(i.push(r[s]),s++);return new Uint8Array(i)}function BM(e){const t=e.length;let n=[],r=0;for(;r<t;)r+2<t&&e[r]===0&&e[r+1]===0&&(e[r+2]===0||e[r+2]===1||e[r+2]===2||e[r+2]===3)?(n.push(e[r],e[r+1],3,e[r+2]),r+=3):(n.push(e[r]),r++);return new Uint8Array(n)}function WM(e){if(e.length<5)return"";let t=-1;for(let i=0;i<e.length-3;i++){if(e[i]===0&&e[i+1]===0&&e[i+2]===1){t=i;break}if(i<e.length-4&&e[i]===0&&e[i+1]===0&&e[i+2]===0&&e[i+3]===1){t=i;break}}if(t===-1)return"";const n=t+(e[t+2]===0?4:3);if(n>=e.length)return"";const r=e[n];return 128&r?"":(r>>1&63)>=32||n+1<e.length&&(248&e[n+1])==0?Jb:(31&r)<=31?Xb:""}const hT=new Map,iE=new Map;(function(){const e=Mt();Lr.getDisplayMedia=!(!navigator.mediaDevices||!navigator.mediaDevices.getDisplayMedia),Lr.getStreamFromExtension=e.name===Kt.CHROME&&Number(e.version)>34,Lr.supportUnifiedPlan=(function(){if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;const t=new RTCPeerConnection;let n=!1;try{t.addTransceiver("audio"),n=!0}catch{}return t.close(),n})(),Lr.supportMinBitrate=e.name===Kt.CHROME||e.name===Kt.EDGE,Lr.supportSetRtpSenderParameters=(function(){const t=Mt();return!!(window.RTCRtpSender&&window.RTCRtpSender.prototype.setParameters&&window.RTCRtpSender.prototype.getParameters)&&(!!vl()||!(!Br()&&!BS())||t.name===Kt.FIREFOX&&Number(t.version)>=64)})(),e.name===Kt.SAFARI&&(Number(e.version)>=14?Lr.supportDualStream=!0:Lr.supportDualStream=!1),Lr.webAudioMediaStreamDest=(function(){const t=Mt();return!(t.name===Kt.SAFARI&&Number(t.version)<12)})(),Lr.supportReplaceTrack=!!window.RTCRtpSender&&typeof RTCRtpSender.prototype.replaceTrack=="function",Lr.supportWebGL=typeof WebGLRenderingContext<"u",Lr.supportRequestFrame=!!window.CanvasCaptureMediaStreamTrack,vl()||(Lr.webAudioWithAEC=!0),Lr.supportShareAudio=(function(){const t=Mt();return(t.os===Er.WIN_10||t.os===Er.WIN_81||t.os===Er.WIN_7||t.os===Er.LINUX||t.os===Er.MAC_OS||t.os===Er.CHROMIUM_OS)&&t.name===Kt.CHROME&&Number(t.version)>=74})(),Lr.supportDataChannel=!!(Df(76)||tb(68)||Bx(14)),Lr.supportPCSetConfiguration=(function(){const t=window.RTCPeerConnection;return!jn()&&!!t&&t.prototype.setConfiguration instanceof Function})(),Lr.supportWebRTCEncodedTransform=Df(87)||jx()||tb(117),Lr.supportWebRTCInsertableStream=(function(){const t=Mt();return(t.name===Kt.CHROME||t.name===Kt.EDGE)&&Number(t.version)>=94&&"MediaStreamTrackGenerator"in window&&"MediaStreamTrackProcessor"in window})(),Lr.supportRequestVideoFrameCallback="requestVideoFrameCallback"in HTMLVideoElement.prototype,Lr.supportWebCrypto=typeof window<"u"&&window.crypto!==void 0&&window.crypto.subtle!==void 0,HS((()=>{Lr.supportDualStreamEncoding=(function(){const t=Mt();return!!B("DISABLE_WEBAUDIO")||t.name==="Safari"&&Number(t.version)>=14||!!(t.name==="Chrome"&&/Windows/i.test(t.os||"")&&Number(t.version)>=100&&B("CHROME_DUAL_STREAM_USE_ENCODING"))})(),w.debug("browser ua: ",navigator.userAgent),w.info("browser info: ",e),w.info("browser compatibility: ",Lr)}))})();const C9=["CHINA","GLOBAL"],GM=[[0,1,2,3,4,5,5],[0,2,2,3,4,5,5],[0,3,3,3,4,5,5],[0,4,4,4,4,5,5],[0,5,5,5,5,5,5]],Oh=[],Qf=[];function Ph(e,t){return!!t&&Oh.some((n=>n.uid===e&&n.channelName===t))}function Qb(){return Qf.length>0}var b9=rk.forEach,HM=Au("forEach")?[].forEach:function(e){return b9(this,e,arguments.length>1?arguments[1]:void 0)};Zt({target:"Array",proto:!0,forced:[].forEach!==HM},{forEach:HM});var I9=cs("Array","forEach"),A9=na,N9=Tr,O9=ee,P9=I9,Zb=Array.prototype,D9={DOMTokenList:!0,NodeList:!0},k9=function(e){var t=e.forEach;return e===Zb||O9(Zb,e)&&t===Zb.forEach||N9(D9,A9(e))?P9:t},x9=R(k9),L9=To,KM=Li;Zt({target:"Object",stat:!0,forced:C((function(){KM(1)}))},{keys:function(e){return KM(L9(e))}});var M9=R(ci.Object.keys),U9=R(tr),j9=R(ku),V9=Zt,zM=ra,F9=Fr,B9=Sr,YM=t_,W9=ec,G9=Ei,H9=MC,K9=Mn,z9=Pr,Y9=YD("slice"),q9=K9("species"),$b=Array,X9=Math.max;V9({target:"Array",proto:!0,forced:!Y9},{slice:function(e,t){var n,r,i,s=G9(this),o=W9(s),c=YM(e,o),d=YM(t===void 0?o:t,o);if(zM(s)&&(n=s.constructor,(F9(n)&&(n===$b||zM(n.prototype))||B9(n)&&(n=n[q9])===null)&&(n=void 0),n===$b||n===void 0))return z9(s,c,d);for(r=new(n===void 0?$b:n)(X9(d-c,0)),i=0;c<d;c++,i++)c in s&&H9(r,i,s[c]);return r.length=i,r}});var J9=cs("Array","slice"),Q9=ee,Z9=J9,eI=Array.prototype,$9=function(e){var t=e.slice;return e===eI||Q9(eI,e)&&t===eI.slice?Z9:t},e7=R($9);function Be(e,t,n,r,i){var s,o,c,d={};return x9(s=M9(r)).call(s,(function(h){d[h]=r[h]})),d.enumerable=!!d.enumerable,d.configurable=!!d.configurable,("value"in d||d.initializer)&&(d.writable=!0),d=U9(o=j9(c=e7(n).call(n)).call(c)).call(o,(function(h,f){return f(e,t,h)||h}),d),i&&d.initializer!==void 0&&(d.value=d.initializer?d.initializer.call(i):void 0,d.initializer=void 0),d.initializer===void 0?(GD(e,t,d),null):d}let pT=(function(e){return e[e.ACCESS_POINT=101]="ACCESS_POINT",e[e.UNILBS=201]="UNILBS",e[e.STRING_UID_ALLOCATOR=901]="STRING_UID_ALLOCATOR",e})({}),tI=(function(e){return e[e.IIIEGAL_APPID=1]="IIIEGAL_APPID",e[e.IIIEGAL_UID=2]="IIIEGAL_UID",e[e.INTERNAL_ERROR=3]="INTERNAL_ERROR",e})({}),Go=(function(e){return e[e.INVALID_VENDOR_KEY=5]="INVALID_VENDOR_KEY",e[e.INVALID_CHANNEL_NAME=7]="INVALID_CHANNEL_NAME",e[e.INTERNAL_ERROR=8]="INTERNAL_ERROR",e[e.NO_AUTHORIZED=9]="NO_AUTHORIZED",e[e.DYNAMIC_KEY_TIMEOUT=10]="DYNAMIC_KEY_TIMEOUT",e[e.NO_ACTIVE_STATUS=11]="NO_ACTIVE_STATUS",e[e.DYNAMIC_KEY_EXPIRED=13]="DYNAMIC_KEY_EXPIRED",e[e.STATIC_USE_DYNAMIC_KEY=14]="STATIC_USE_DYNAMIC_KEY",e[e.DYNAMIC_USE_STATIC_KEY=15]="DYNAMIC_USE_STATIC_KEY",e[e.USER_OVERLOAD=16]="USER_OVERLOAD",e[e.FORBIDDEN_REGION=18]="FORBIDDEN_REGION",e[e.CANNOT_MEET_AREA_DEMAND=19]="CANNOT_MEET_AREA_DEMAND",e})({}),Ii=(function(e){return e[e.NO_FLAG_SET=100]="NO_FLAG_SET",e[e.FLAG_SET_BUT_EMPTY=101]="FLAG_SET_BUT_EMPTY",e[e.INVALID_FALG_SET=102]="INVALID_FALG_SET",e[e.FLAG_SET_BUT_NO_RE=103]="FLAG_SET_BUT_NO_RE",e[e.INVALID_SERVICE_ID=104]="INVALID_SERVICE_ID",e[e.NO_SERVICE_AVAILABLE=200]="NO_SERVICE_AVAILABLE",e[e.NO_SERVICE_AVAILABLE_P2P=201]="NO_SERVICE_AVAILABLE_P2P",e[e.NO_SERVICE_AVAILABLE_VOICE=202]="NO_SERVICE_AVAILABLE_VOICE",e[e.NO_SERVICE_AVAILABLE_WEBRTC=203]="NO_SERVICE_AVAILABLE_WEBRTC",e[e.NO_SERVICE_AVAILABLE_CDS=204]="NO_SERVICE_AVAILABLE_CDS",e[e.NO_SERVICE_AVAILABLE_CDN=205]="NO_SERVICE_AVAILABLE_CDN",e[e.NO_SERVICE_AVAILABLE_TDS=206]="NO_SERVICE_AVAILABLE_TDS",e[e.NO_SERVICE_AVAILABLE_REPORT=207]="NO_SERVICE_AVAILABLE_REPORT",e[e.NO_SERVICE_AVAILABLE_APP_CENTER=208]="NO_SERVICE_AVAILABLE_APP_CENTER",e[e.NO_SERVICE_AVAILABLE_ENV0=209]="NO_SERVICE_AVAILABLE_ENV0",e[e.NO_SERVICE_AVAILABLE_VOET=210]="NO_SERVICE_AVAILABLE_VOET",e[e.NO_SERVICE_AVAILABLE_STRING_UID=211]="NO_SERVICE_AVAILABLE_STRING_UID",e[e.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS=212]="NO_SERVICE_AVAILABLE_WEBRTC_UNILBS",e[e.NO_SERVICE_AVAILABLE_UNILBS_FLV=213]="NO_SERVICE_AVAILABLE_UNILBS_FLV",e})({}),Ze=(function(e){return e[e.K_TIMESTAMP_EXPIRED=2]="K_TIMESTAMP_EXPIRED",e[e.K_CHANNEL_PERMISSION_INVALID=3]="K_CHANNEL_PERMISSION_INVALID",e[e.K_CERTIFICATE_INVALID=4]="K_CERTIFICATE_INVALID",e[e.K_CHANNEL_NAME_EMPTY=5]="K_CHANNEL_NAME_EMPTY",e[e.K_CHANNEL_NOT_FOUND=6]="K_CHANNEL_NOT_FOUND",e[e.K_TICKET_INVALID=7]="K_TICKET_INVALID",e[e.K_CHANNEL_CONFLICTED=8]="K_CHANNEL_CONFLICTED",e[e.K_SERVICE_NOT_READY=9]="K_SERVICE_NOT_READY",e[e.K_SERVICE_TOO_HEAVY=10]="K_SERVICE_TOO_HEAVY",e[e.K_UID_BANNED=14]="K_UID_BANNED",e[e.K_IP_BANNED=15]="K_IP_BANNED",e[e.K_CHANNEL_BANNED=16]="K_CHANNEL_BANNED",e[e.DATASTREAM2_NOT_AVAILABLE=27]="DATASTREAM2_NOT_AVAILABLE",e[e.K_AUTO_REBALANCE=28]="K_AUTO_REBALANCE",e[e.WARN_NO_AVAILABLE_CHANNEL=103]="WARN_NO_AVAILABLE_CHANNEL",e[e.WARN_LOOKUP_CHANNEL_TIMEOUT=104]="WARN_LOOKUP_CHANNEL_TIMEOUT",e[e.WARN_LOOKUP_CHANNEL_REJECTED=105]="WARN_LOOKUP_CHANNEL_REJECTED",e[e.WARN_OPEN_CHANNEL_TIMEOUT=106]="WARN_OPEN_CHANNEL_TIMEOUT",e[e.WARN_OPEN_CHANNEL_REJECTED=107]="WARN_OPEN_CHANNEL_REJECTED",e[e.WARN_REQUEST_DEFERRED=108]="WARN_REQUEST_DEFERRED",e[e.ERR_DYNAMIC_KEY_TIMEOUT=109]="ERR_DYNAMIC_KEY_TIMEOUT",e[e.ERR_NO_AUTHORIZED=110]="ERR_NO_AUTHORIZED",e[e.ERR_VOM_SERVICE_UNAVAILABLE=111]="ERR_VOM_SERVICE_UNAVAILABLE",e[e.ERR_NO_CHANNEL_AVAILABLE_CODE=112]="ERR_NO_CHANNEL_AVAILABLE_CODE",e[e.ERR_MASTER_VOCS_UNAVAILABLE=114]="ERR_MASTER_VOCS_UNAVAILABLE",e[e.ERR_INTERNAL_ERROR=115]="ERR_INTERNAL_ERROR",e[e.ERR_NO_ACTIVE_STATUS=116]="ERR_NO_ACTIVE_STATUS",e[e.ERR_INVALID_UID=117]="ERR_INVALID_UID",e[e.ERR_DYNAMIC_KEY_EXPIRED=118]="ERR_DYNAMIC_KEY_EXPIRED",e[e.ERR_STATIC_USE_DYANMIC_KE=119]="ERR_STATIC_USE_DYANMIC_KE",e[e.ERR_DYNAMIC_USE_STATIC_KE=120]="ERR_DYNAMIC_USE_STATIC_KE",e[e.ERR_NO_VOCS_AVAILABLE=2e3]="ERR_NO_VOCS_AVAILABLE",e[e.ERR_NO_VOS_AVAILABLE=2001]="ERR_NO_VOS_AVAILABLE",e[e.ERR_JOIN_CHANNEL_TIMEOUT=2002]="ERR_JOIN_CHANNEL_TIMEOUT",e[e.ERR_REPEAT_JOIN_CHANNEL=2003]="ERR_REPEAT_JOIN_CHANNEL",e[e.ERR_JOIN_BY_MULTI_IP=2004]="ERR_JOIN_BY_MULTI_IP",e[e.ERR_NOT_JOINED=2011]="ERR_NOT_JOINED",e[e.ERR_REPEAT_JOIN_REQUEST=2012]="ERR_REPEAT_JOIN_REQUEST",e[e.ERR_INVALID_VENDOR_KEY=2013]="ERR_INVALID_VENDOR_KEY",e[e.ERR_INVALID_CHANNEL_NAME=2014]="ERR_INVALID_CHANNEL_NAME",e[e.ERR_INVALID_STRINGUID=2015]="ERR_INVALID_STRINGUID",e[e.ERR_TOO_MANY_USERS=2016]="ERR_TOO_MANY_USERS",e[e.ERR_SET_CLIENT_ROLE_TIMEOUT=2017]="ERR_SET_CLIENT_ROLE_TIMEOUT",e[e.ERR_SET_CLIENT_ROLE_NO_PERMISSION=2018]="ERR_SET_CLIENT_ROLE_NO_PERMISSION",e[e.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE=2019]="ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",e[e.ERR_PUBLISH_REQUEST_INVALID=2020]="ERR_PUBLISH_REQUEST_INVALID",e[e.ERR_SUBSCRIBE_REQUEST_INVALID=2021]="ERR_SUBSCRIBE_REQUEST_INVALID",e[e.ERR_NOT_SUPPORTED_MESSAGE=2022]="ERR_NOT_SUPPORTED_MESSAGE",e[e.ERR_ILLEAGAL_PLUGIN=2023]="ERR_ILLEAGAL_PLUGIN",e[e.ERR_REJOIN_TOKEN_INVALID=2024]="ERR_REJOIN_TOKEN_INVALID",e[e.ERR_REJOIN_USER_NOT_JOINED=2025]="ERR_REJOIN_USER_NOT_JOINED",e[e.ERR_INVALID_OPTIONAL_INFO=2027]="ERR_INVALID_OPTIONAL_INFO",e[e.ILLEGAL_AES_PASSWORD=2028]="ILLEGAL_AES_PASSWORD",e[e.ILLEGAL_CLIENT_ROLE_LEVEL=2029]="ILLEGAL_CLIENT_ROLE_LEVEL",e[e.ERR_TOO_MANY_BROADCASTERS=2031]="ERR_TOO_MANY_BROADCASTERS",e[e.ERR_TOO_MANY_SUBSCRIBERS=2032]="ERR_TOO_MANY_SUBSCRIBERS",e[e.ERR_LICENSE_MISSING=32769]="ERR_LICENSE_MISSING",e[e.ERR_LICENSE_EXPIRED=32771]="ERR_LICENSE_EXPIRED",e[e.ERR_LICENSE_MINUTES_EXCEEDED=32773]="ERR_LICENSE_MINUTES_EXCEEDED",e[e.ERR_LICENSE_PERIOD_INVALID=32774]="ERR_LICENSE_PERIOD_INVALID",e[e.ERR_LICENSE_MULTIPLE_SDK_SERVICE=32778]="ERR_LICENSE_MULTIPLE_SDK_SERVICE",e[e.ERR_LICENSE_ILLEGAL=32783]="ERR_LICENSE_ILLEGAL",e[e.ERR_TEST_RECOVER=9e3]="ERR_TEST_RECOVER",e[e.ERR_TEST_TRYNEXT=9001]="ERR_TEST_TRYNEXT",e[e.ERR_TEST_RETRY=9002]="ERR_TEST_RETRY",e})({}),vn=(function(e){return e.CONNECTING="connecting",e.CONNECTED="connected",e.RECONNECTING="reconnecting",e.CLOSED="closed",e})({}),ct=(function(e){return e.WS_CONNECTED="ws_connected",e.WS_RECONNECTING="ws_reconnecting",e.WS_CLOSED="ws_closed",e.WS_RECONNECT_CREATE_CONNECTION="ws_reconnect_create_connection",e.ON_BINARY_DATA="on_binary_data",e.REQUEST_RECOVER="request_recover",e.REQUEST_JOIN_INFO="request_join_info",e.REQUEST_REJOIN_INFO="req_rejoin_info",e.IS_P2P_DISCONNECTED="is_p2p_dis",e.DISCONNECT_P2P="dis_p2p",e.ABORT_P2P_EXECUTION="abort_p2p_execution",e.NEED_RENEW_SESSION="need-sid",e.REPORT_JOIN_GATEWAY="report_join_gateway",e.REQUEST_TIMEOUT="request_timeout",e.REQUEST_SUCCESS="request_success",e.JOIN_RESPONSE="join_response",e.PRE_CONNECT_PC="pre_connect_pc",e.P2P_CONNECTION="p2p_connection",e.P2P_REMOTE_CANDIDATE_UPDATE="p2p_remote_candidate_update",e.P2P_SUBSCRIBE="p2p_subscribe",e.P2P_UNSUBSCRIBE="p2p_unsubscribe",e.P2P_EXCHANGE_SDP="p2p_exchange_sdp",e.P2P_ON_ADD_VIDEO_STREAM="p2p_on_add_video_stream",e.P2P_ON_ADD_AUDIO_STREAM="p2p_on_add_audio_stream",e.RECOVER_NOTIFICATION="recover_notification",e})({}),ot=(function(e){return e.PING="ping",e.PING_BACK="ping_back",e.JOIN="join_v3",e.REJOIN="rejoin_v3",e.LEAVE="leave",e.SET_CLIENT_ROLE="set_client_role",e.PUBLISH="publish",e.PUBLISH_DATASTREAM="publish_datastream",e.UNPUBLISH="unpublish",e.UNPUBLISH_DATASTREAM="unpublish_datastream",e.SUBSCRIBE="subscribe",e.PRE_SUBSCRIBE="pre_subscribe",e.SUBSCRIBE_DATASTREAM="subscribe_datastream",e.SUBSCRIBE_STREAMS="subscribe_streams",e.UNSUBSCRIBE="unsubscribe",e.UNSUBSCRIBE_DATASTREAM="unsubscribe_datastream",e.UNSUBSCRIBE_STREAMS="unsubscribe_streams",e.SUBSCRIBE_CHANGE="subscribe_change",e.TRAFFIC_STATS="traffic_stats",e.RENEW_TOKEN="renew_token",e.SWITCH_VIDEO_STREAM="switch_video_stream",e.DEFAULT_VIDEO_STREAM="default_video_stream",e.SET_FALLBACK_OPTION="set_fallback_option",e.GATEWAY_INFO="gateway_info",e.CONTROL="control",e.SEND_METADATA="send_metadata",e.DATA_STREAM="data_stream",e.PICK_SVC_LAYER="pick_svc_layer",e.RESTART_ICE="restart_ice",e.CONNECT_PC="connect_pc",e.SET_VIDEO_PROFILE="set_video_profile",e.SET_PARAMETER="set_parameter",e.SET_RTM2_FLAG="set_rtm2_flag",e.DOWNGRADE_CODEC="downgrade_codec",e})({}),sE=(function(e){return e.WRTC_STATS="wrtc_stats",e.WS_INFLATE_DATA_LENGTH="ws_inflate_data_length",e.DENOISER_STATS="denoiser_stats",e.EXTENSION_USAGE_STATS="extension_usage_stats",e})({}),Dt=(function(e){return e.ON_USER_ONLINE="on_user_online",e.ON_USER_OFFLINE="on_user_offline",e.ON_STREAM_FALLBACK_UPDATE="on_stream_fallback_update",e.ON_PUBLISH_STREAM="on_publish_stream",e.ON_UPLINK_STATS="on_uplink_stats",e.ON_P2P_LOST="on_p2p_lost",e.ON_REMOVE_STREAM="on_remove_stream",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="on_token_privilege_will_expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="on_token_privilege_did_expire",e.ON_USER_BANNED="on_user_banned",e.ON_USER_LICENSE_BANNED="on_user_license_banned",e.ON_NOTIFICATION="on_notification",e.ON_CRYPT_ERROR="on_crypt_error",e.MUTE_AUDIO="mute_audio",e.MUTE_VIDEO="mute_video",e.UNMUTE_AUDIO="unmute_audio",e.UNMUTE_VIDEO="unmute_video",e.ON_P2P_OK="on_p2p_ok",e.RECEIVE_METADATA="receive_metadata",e.ON_DATA_STREAM="on_data_stream",e.ON_RTP_CAPABILITY_CHANGE="on_rtp_capability_change",e.ON_REMOTE_DATASTREAM_UPDATE="on_remote_datastream_update",e.ON_REMOTE_FULL_DATASTREAM_INFO="on_remote_full_datastream_info",e.ENABLE_LOCAL_VIDEO="enable_local_video",e.DISABLE_LOCAL_VIDEO="disable_local_video",e.ENABLE_LOCAL_AUDIO="enable_local_audio",e.DISABLE_LOCAL_AUDIO="disable_local_audio",e.ON_PUBLISHED_USER_LIST="on_published_user_list",e})({}),Ai=(function(e){return e.SEND_ONLY="SEND_ONLY",e.RECEIVE_ONLY="RECEIVE_ONLY",e})({}),Et=(function(e){return e.CONNECTED="websocket:connected",e.RECONNECTING="websocket:reconnecting",e.WILL_RECONNECT="websocket:will_reconnect",e.CLOSED="websocket:closed",e.FAILED="websocket:failed",e.ON_MESSAGE="websocket:on_message",e.REQUEST_NEW_URLS="websocket:request_new_urls",e.RECONNECT_CREATE_CONNECTION="websocket:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="websocket:on_token_privilege_did_expire",e})({});function fT(e){if(typeof e!="string"||!/^[a-zA-Z0-9 \!\#\$\%\&\(\)\+\-\:\;\<\=\.\>\?\@\[\]\^\_\{\}\|\~\,]{1,64}$/.test(e))throw w.error("Invalid Channel Name ".concat(e)),new le(V.INVALID_PARAMS,"The length must be within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,")}function mT(e){if(t=e,!(typeof t=="number"&&Math.floor(t)===t&&0<=t&&t<=4294967295||Xx(e,1,255)))throw new le(V.INVALID_PARAMS,"[String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]");var t;typeof e=="string"&&w.warn("You input a string as the user ID, to ensure better end-user experience, Agora highly suggests not using a string as the user ID.")}let Sl=(function(e){return e.TRANSCODE="mix_streaming",e.RAW="raw_streaming",e})({});const t7={alpha:1,height:640,width:360,x:0,y:0,zOrder:0,audioChannel:0},nI={x:0,y:0,width:160,height:160,zOrder:255,alpha:1};function rI(e,t){kr(e.url,"".concat(t,".url"),1,1e3,!1),Vn(e.x)||cn(e.x,"".concat(t,".x"),0,1e4),Vn(e.y)||cn(e.y,"".concat(t,".y"),0,1e4),Vn(e.width)||cn(e.width,"".concat(t,".width"),0,1e4),Vn(e.height)||cn(e.height,"".concat(t,".height"),0,1e4),Vn(e.zOrder)||cn(e.zOrder,"".concat(t,".zOrder"),0,255),Vn(e.alpha)||cn(e.alpha,"".concat(t,".alpha"),0,1,!1)}const n7={audioBitrate:48,audioChannels:1,audioSampleRate:48e3,backgroundColor:0,height:360,lowLatency:!1,videoBitrate:400,videoCodecProfile:100,videoCodecType:1,videoFrameRate:15,videoGop:30,width:640,images:[],userConfigs:[],userConfigExtraInfo:""};let Pd=(function(e){return e.WARNING="@live_uap-warning",e.ERROR="@line_uap-error",e.PUBLISH_STREAM_STATUS="@live_uap-publish-status",e.WORKER_STATUS="@live_uap-worker-status",e.REQUEST_NEW_ADDRESS="@live_uap-request-address",e})({}),iI=(function(e){return e.REQUEST_WORKER_MANAGER_LIST="@live_req_worker_manager",e})({}),lr=(function(e){return e[e.LIVE_STREAM_RESPONSE_SUCCEED=200]="LIVE_STREAM_RESPONSE_SUCCEED",e[e.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM=454]="LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM",e[e.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR=450]="LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_BAD_STREAM=451]="LIVE_STREAM_RESPONSE_BAD_STREAM",e[e.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR=400]="LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST=404]="LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST",e[e.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED=456]="LIVE_STREAM_RESPONSE_NOT_AUTHORIZED",e[e.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE=457]="LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE",e[e.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN=429]="LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN",e[e.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH=452]="LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH",e[e.LIVE_STREAM_RESPONSE_NOT_SUPPORTED=453]="LIVE_STREAM_RESPONSE_NOT_SUPPORTED",e[e.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM=455]="LIVE_STREAM_RESPONSE_MAX_STREAM_NUM",e[e.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR=500]="LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR",e[e.LIVE_STREAM_RESPONSE_WORKER_LOST=501]="LIVE_STREAM_RESPONSE_WORKER_LOST",e[e.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT=502]="LIVE_STREAM_RESPONSE_RESOURCE_LIMIT",e[e.LIVE_STREAM_RESPONSE_WORKER_QUIT=503]="LIVE_STREAM_RESPONSE_WORKER_QUIT",e[e.ERROR_FAIL_SEND_MESSAGE=504]="ERROR_FAIL_SEND_MESSAGE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE=30]="PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT=31]="PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH=32]="PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH",e[e.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN=33]="PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN",e})({});function qM(e){if(!e.channelName)throw new le(V.INVALID_PARAMS,"invalid channelName in info");if(typeof e.uid!="number")throw new le(V.INVALID_PARAMS,"invalid uid in info, uid must be a number");return e.token&&kr(e.token,"info.token",1,2047),mT(e.uid),fT(e.channelName),!0}let Ni=(function(e){return e[e.SetSdkProfile=0]="SetSdkProfile",e[e.SetSourceChannel=1]="SetSourceChannel",e[e.SetSourceUserId=2]="SetSourceUserId",e[e.SetDestChannel=3]="SetDestChannel",e[e.StartPacketTransfer=4]="StartPacketTransfer",e[e.StopPacketTransfer=5]="StopPacketTransfer",e[e.UpdateDestChannel=6]="UpdateDestChannel",e[e.Reconnect=7]="Reconnect",e[e.SetVideoProfile=8]="SetVideoProfile",e})({}),Tl=(function(e){return e.NETWORK_DISCONNECTED="NETWORK_DISCONNECTED",e.NETWORK_CONNECTED="NETWORK_CONNECTED",e.PACKET_JOINED_SRC_CHANNEL="PACKET_JOINED_SRC_CHANNEL",e.PACKET_JOINED_DEST_CHANNEL="PACKET_JOINED_DEST_CHANNEL",e.PACKET_SENT_TO_DEST_CHANNEL="PACKET_SENT_TO_DEST_CHANNEL",e.PACKET_RECEIVED_VIDEO_FROM_SRC="PACKET_RECEIVED_VIDEO_FROM_SRC",e.PACKET_RECEIVED_AUDIO_FROM_SRC="PACKET_RECEIVED_AUDIO_FROM_SRC",e.PACKET_UPDATE_DEST_CHANNEL="PACKET_UPDATE_DEST_CHANNEL",e.PACKET_UPDATE_DEST_CHANNEL_REFUSED="PACKET_UPDATE_DEST_CHANNEL_REFUSED",e.PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE="PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE",e})({}),ts=(function(e){return e.RELAY_STATE_IDLE="RELAY_STATE_IDLE",e.RELAY_STATE_CONNECTING="RELAY_STATE_CONNECTING",e.RELAY_STATE_RUNNING="RELAY_STATE_RUNNING",e.RELAY_STATE_FAILURE="RELAY_STATE_FAILURE",e})({}),Zf=(function(e){return e.RELAY_OK="RELAY_OK",e.SERVER_CONNECTION_LOST="SERVER_CONNECTION_LOST",e.SRC_TOKEN_EXPIRED="SRC_TOKEN_EXPIRED",e.DEST_TOKEN_EXPIRED="DEST_TOKEN_EXPIRED",e})({}),tn=(function(e){return e.High="high",e.Low="low",e.Audio="audio",e.Screen="screen",e.ScreenLow="screen_low",e})({}),wr=(function(e){return e.DISCONNECT="disconnect",e.CONNECTION_STATE_CHANGE="connection-state-change",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGE="stream-type-change",e.IS_P2P_DISCONNECTED="is-p2p-dis",e.DISCONNECT_P2P="dis-p2p",e.REQUEST_NEW_GATEWAY_LIST="req-gate-url",e.NEED_RENEW_SESSION="need-sid",e.REQUEST_P2P_CONNECTION_PARAMS="request-p2p-connection-params",e.JOIN_RESPONSE="join-response",e.RESET_CONNECTION_EVENTS="reset-connection-events",e.PRE_CONNECT_PC="pre-connect_pc",e.UPDATE_GATEWAY_CONFIG="update-gateway-config",e})({}),_T=(function(e){return e.P2P_DISCONNECTED="P2P_DISCONNECTED",e.A_ROUND_WS_FAILED="A_ROUND_WS_FAILED",e.TIMEOUT="TIMEOUT",e.UNKNOWN_REASON="UNKNOWN_REASON",e})({}),vr=(function(e){return e[e.Nothing=0]="Nothing",e[e.Audio=1]="Audio",e[e.LwoVideo=2]="LwoVideo",e[e.Video=4]="Video",e[e.Data=8]="Data",e[e.DataStream0=256]="DataStream0",e[e.DataStream1=512]="DataStream1",e[e.DataStream2=1024]="DataStream2",e[e.DataStream3=2048]="DataStream3",e[e.DataStream4=4096]="DataStream4",e[e.DataStream5=8192]="DataStream5",e[e.DataStream6=16384]="DataStream6",e[e.DataStream7=32768]="DataStream7",e})({}),Jt=(function(e){return e.CHINA="CHINA",e.ASIA="ASIA",e.NORTH_AMERICA="NORTH_AMERICA",e.EUROPE="EUROPE",e.JAPAN="JAPAN",e.INDIA="INDIA",e.KOREA="KOREA",e.HKMC="HKMC",e.US="US",e.OCEANIA="OCEANIA",e.SOUTH_AMERICA="SOUTH_AMERICA",e.AFRICA="AFRICA",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="EXTENSIONS",e})({});const XM=[Jt.AFRICA,Jt.ASIA,Jt.CHINA,Jt.EUROPE,Jt.GLOBAL,Jt.INDIA,Jt.JAPAN,Jt.NORTH_AMERICA,Jt.OCEANIA,Jt.OVERSEA,Jt.SOUTH_AMERICA];let Zr=(function(e){return e.CHINA="CN",e.ASIA="AS",e.NORTH_AMERICA="NA",e.EUROPE="EU",e.JAPAN="JP",e.INDIA="IN",e.KOREA="KR",e.HKMC="HK",e.US="US",e.OCEANIA="OC",e.SOUTH_AMERICA="SA",e.AFRICA="AF",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="GLOBAL",e})({});const gT={CHINA:{},ASIA:{CODE:Zr.ASIA,WEBCS_DOMAIN:["ap-web-1-asia.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-asia.agora.io"],PROXY_CS:["proxy-ap-web-asia.agora.io"],CDS_AP:["cds-ap-web-asia.agora.io","cds-ap-web-asia2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-asia.agora.io","sua-ap-web-asia2.agora.io"],UAP_AP:["uap-ap-web-asia.agora.io","uap-ap-web-asia2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_SERVER_TYPE3:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]},NORTH_AMERICA:{CODE:Zr.NORTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-north-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-north-america.agora.io"],PROXY_CS:["proxy-ap-web-america.agora.io"],CDS_AP:["cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],UAP_AP:["uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_SERVER_TYPE3:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]},EUROPE:{CODE:Zr.EUROPE,WEBCS_DOMAIN:["ap-web-1-europe.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-europe.agora.io"],PROXY_CS:["proxy-ap-web-europe.agora.io"],CDS_AP:["cds-ap-web-europe.agora.io","cds-ap-web-europe2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-europe.agora.io","sua-ap-web-europe.agora.io"],UAP_AP:["uap-ap-web-europe.agora.io","uap-ap-web-europe2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_SERVER_TYPE3:["europe.webrtc-cloud-proxy.sd-rtn.com"]},JAPAN:{CODE:Zr.JAPAN,WEBCS_DOMAIN:["ap-web-1-japan.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-japan.agora.io"],PROXY_CS:["proxy-ap-web-japan.agora.io"],CDS_AP:["cds-ap-web-japan.agora.io","cds-ap-web-japan2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-japan.agora.io","sua-ap-web-japan2.agora.io"],UAP_AP:["uap-ap-web-japan.agora.io","uap-ap-web-japan2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_SERVER_TYPE3:["japan.webrtc-cloud-proxy.sd-rtn.com"]},INDIA:{CODE:Zr.INDIA,WEBCS_DOMAIN:["ap-web-1-india.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-india.agora.io"],PROXY_CS:["proxy-ap-web-india.agora.io"],CDS_AP:["cds-ap-web-india.agora.io","cds-ap-web-india2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-india.agora.io","sua-ap-web-india2.agora.io"],UAP_AP:["uap-ap-web-india.agora.io","uap-ap-web-india2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_SERVER_TYPE3:["india.webrtc-cloud-proxy.sd-rtn.com"]},KOREA:{CODE:Zr.KOREA,WEBCS_DOMAIN:["ap-web-1-korea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-korea.agora.io"],PROXY_CS:["proxy-ap-web-korea.agora.io"],CDS_AP:["cds-ap-web-korea.agora.io","cds-ap-web-korea2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-korea.agora.io","sua-ap-web-korea2.agora.io"],UAP_AP:["uap-ap-web-korea.agora.io","uap-ap-web-korea2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-korea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-korea.agora.io"],LOG_UPLOAD_SERVER:["logservice-korea.agora.io"],PROXY_SERVER_TYPE3:["korea.webrtc-cloud-proxy.sd-rtn.com"]},HKMC:{CODE:Zr.HKMC,WEBCS_DOMAIN:["ap-web-1-hkmc.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-hkmc.agora.io"],PROXY_CS:["proxy-ap-web-hkmc.agora.io"],CDS_AP:["cds-ap-web-hkmc.agora.io","cds-ap-web-hkmc2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-hkmc.agora.io","sua-ap-web-hkmc2.agora.io"],UAP_AP:["uap-ap-web-hkmc.agora.io","uap-ap-web-hkmc2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-hkmc.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-hkmc.agora.io"],LOG_UPLOAD_SERVER:["logservice-hkmc.agora.io"],PROXY_SERVER_TYPE3:["hkmc.webrtc-cloud-proxy.sd-rtn.com"]},US:{CODE:Zr.US,WEBCS_DOMAIN:["ap-web-1-us.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-us.agora.io"],PROXY_CS:["proxy-ap-web-us.agora.io"],CDS_AP:["cds-ap-web-us.agora.io","cds-ap-web-us2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-us.agora.io","sua-ap-web-us2.agora.io"],UAP_AP:["uap-ap-web-us.agora.io","uap-ap-web-us2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-us.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-us.agora.io"],LOG_UPLOAD_SERVER:["logservice-us.agora.io"],PROXY_SERVER_TYPE3:["us.webrtc-cloud-proxy.sd-rtn.com"]},OVERSEA:{CODE:Zr.OVERSEA,WEBCS_DOMAIN:["ap-web-1-oversea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oversea.agora.io"],PROXY_CS:["proxy-ap-web-oversea.agora.io"],CDS_AP:["cds-ap-web-oversea.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oversea.agora.io"],UAP_AP:["uap-ap-web-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.agora.io"]},GLOBAL:{CODE:Zr.GLOBAL,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-ap-web-3.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-ap-web-3.agora.io"],UAP_AP:["uap-ap-web-1.agora.io","uap-ap-web-3.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2.agora.io"],LOG_UPLOAD_SERVER:["logservice.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com"]},OCEANIA:{CODE:Zr.OCEANIA,WEBCS_DOMAIN:["ap-web-1-oceania.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oceania.agora.io"],PROXY_CS:["proxy-ap-web-oceania.agora.io"],CDS_AP:["cds-ap-web-oceania.agora.io","cds-ap-web-oceania2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oceania.agora.io","sua-ap-web-oceania2.agora.io"],UAP_AP:["uap-ap-web-oceania.agora.io","uap-ap-web-oceania2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_SERVER_TYPE3:["oceania.webrtc-cloud-proxy.sd-rtn.com"]},SOUTH_AMERICA:{CODE:Zr.SOUTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-south-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-south-america.agora.io"],PROXY_CS:["proxy-ap-web-south-america.agora.io"],CDS_AP:["cds-ap-web-south-america.agora.io","cds-ap-web-south-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-south-america.agora.io","sua-ap-web-south-america2.agora.io"],UAP_AP:["uap-ap-web-south-america.agora.io","uap-ap-web-south-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_SERVER_TYPE3:["south-america.webrtc-cloud-proxy.sd-rtn.com"]},AFRICA:{CODE:Zr.AFRICA,WEBCS_DOMAIN:["ap-web-1-africa.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-africa.agora.io"],PROXY_CS:["proxy-ap-web-africa.agora.io"],CDS_AP:["cds-ap-web-africa.agora.io","cds-ap-web-africa2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-africa.agora.io","sua-ap-web-africa2.agora.io"],UAP_AP:["uap-ap-web-africa.agora.io","uap-ap-web-africa2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_SERVER_TYPE3:["africa.webrtc-cloud-proxy.sd-rtn.com"]},EXTENSIONS:{}};Sb&&(gT.CHINA={CODE:Zr.CHINA,WEBCS_DOMAIN:["webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["proxy-web.ap.sd-rtn.com"],CDS_AP:["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-web-2.ap.sd-rtn.com","uap-web-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_SERVER_TYPE3:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]});let oE=(function(e){return e.UPDATE_BITRATE_LIMIT="update_bitrate_limit",e.UPDATE_CLIENT_ROLE_OPTIONS="update_client_role_options",e})({});function JM(e){return!!e&&!(!e.uplink||!e.id)&&e.uplink.max_bitrate!==void 0&&e.uplink.min_bitrate!==void 0}class QM extends xn{constructor(t,n){super(),x(this,"onICEConnectionStateChange",void 0),x(this,"onConnectionStateChange",void 0),x(this,"onDTLSTransportStateChange",void 0),x(this,"onDTLSTransportError",void 0),x(this,"onICETransportStateChange",void 0),x(this,"onFirstAudioReceived",void 0),x(this,"onFirstVideoReceived",void 0),x(this,"onFirstAudioDecoded",void 0),x(this,"onFirstVideoDecoded",void 0),x(this,"onFirstVideoRender",void 0),x(this,"onFirstVideoDecodedTimeout",void 0),x(this,"onSelectedLocalCandidateChanged",void 0),x(this,"onSelectedRemoteCandidateChanged",void 0),x(this,"onICECandidateError",void 0),x(this,"getLocalVideoStats",void 0)}}class ZM extends QM{constructor(t,n){super(t,n),x(this,"establishPromise",void 0)}}let Me=(function(e){return e.VIDEO="video",e.AUDIO="audio",e})({}),$r=(function(e){return e.UDP_RELAY="udp_relay",e.UDP_TCP_RELAY="udp_tcp_relay",e.TCP_RELAY="tcp_relay",e.RELAY="relay",e})({}),Rl=(function(e){return e[e.FIRST_CONNECTION=0]="FIRST_CONNECTION",e[e.UDP_TCP_RESTART=1]="UDP_TCP_RESTART",e[e.RELAY_RESTART=2]="RELAY_RESTART",e[e.TCP_RESTART=3]="TCP_RESTART",e[e.OLD_FIRST_CONNECTION=10]="OLD_FIRST_CONNECTION",e[e.OLD_RESTART=11]="OLD_RESTART",e[e.DISCONNECTED_OR_FAILED=20]="DISCONNECTED_OR_FAILED",e})({});const $M=["disconnected","failed"];let ve=(function(e){return e.LocalVideoTrack="videoTrack",e.LocalAudioTrack="audioTrack",e.LocalVideoLowTrack="videoLowTrack",e})({}),en=(function(e){return e.New="new",e.Connected="connected",e.Reconnecting="reconnecting",e.Disconnected="disconnected",e})({}),Xe=(function(e){return e.AudioMetadata="audioMetadata",e.AudioPts="audioPts",e.StateChange="stateChange",e.IceConnectionStateChange="iceConnectionStateChange",e.RequestMuteLocal="requestMuteLocal",e.RequestUnmuteLocal="requestUnmuteLocal",e.RequestRePublish="requestRePublish",e.RequestRePublishDataChannel="requestRePublishDataChannel",e.RequestReSubscribe="requestReSubscribe",e.RequestUploadStats="requestUploadStats",e.RequestUpload="requestUpload",e.MediaReconnectStart="MediaReconnectStart",e.MediaReconnectEnd="MediaReconnectEnd",e.NeedSignalRTT="NeedSignalRTT",e.RequestRestartICE="RequestRestartIce",e.PeerConnectionStateChange="PeerConnectionStateChange",e.RequestReconnect="RequestReconnect",e.RequestReconnectPC="RequestReconnectPC",e.RequestUnpublishForReconnectPC="RequestUnpublishForReconnectPC",e.P2PLost="P2PLost",e.UpdateVideoEncoder="UpdateVideoEncoder",e.ConnectionTypeChange="ConnectionTypeChange",e.RequestLowStreamParameter="RequestLowStreamParameter",e.QueryClientConnectionState="QueryClientConnectionState",e.LocalCandidate="LocalCandidate",e.RequestP2PMuteLocal="requestP2PMuteLocal",e.RequestP2PUnPublish="RequestP2PUnPublish",e.RequestP2PUnmuteRemote="RequestP2PUnmuteRemote",e.RequestP2PMuteRemote="RequestP2PMuteRemote",e.RequestP2PRestartICE="RequestP2PRestartICE",e})({}),Ho=(function(e){return e.CONNECTING="CONNECTING",e.RECONNECTING="RECONNECTING",e.CONNECTED="CONNECTED",e.CLOSED="CLOSED",e})({}),Ko=(function(e){return e[e.CONNECT_AP=0]="CONNECT_AP",e[e.AP_CONNECTED=1]="AP_CONNECTED",e[e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e[e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e[e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e[e.CONNECT_WORKER=5]="CONNECT_WORKER",e[e.WORKER_CONNECTED=6]="WORKER_CONNECTED",e[e.CLOSED=7]="CLOSED",e})({}),Cr=(function(e){return e.CONNECTION_STATE_CHANGE="connection-state-change",e.STATE_CHANGE="state-change",e.INSPECT_RESULT="inspect-result",e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e.REQUEST_NEW_WORKER_URL="request-new-worker-url",e})({}),e2=(function(e){return e.CONNECTED="transmitter:connected",e.RECONNECTING="transmitter:reconnecting",e.WILL_RECONNECT="transmitter:will_reconnect",e.CLOSED="transmitter:closed",e.FAILED="transmitter:failed",e.ON_MESSAGE="transmitter:on_message",e.REQUEST_NEW_URLS="transmitter:request_new_urls",e.RECONNECT_CREATE_CONNECTION="transmitter:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="transmitter:on_token_privilege_did_expire",e.TO_CONNECT_DATACHANNEL="transmitter:to_connect_datachannel",e.FAILBACK="transmitter:failback",e.PRE_CONNECT_PC="transmitter:pre_connect_pc",e})({}),Nc=(function(e){return e.CAMERA_CHANGED="camera-changed",e.MICROPHONE_CHANGED="microphone-changed",e.PLAYBACK_DEVICE_CHANGED="playback-device-changed",e.AUDIO_AUTOPLAY_FAILED="audio-autoplay-failed",e.AUTOPLAY_FAILED="autoplay-failed",e.AUDIO_CONTEXT_STATE_CHANGED="audio-context-state-changed",e.SECURITY_POLICY_VIOLATION="security-policy-violation",e})({}),ao=(function(e){return e.CONNECTING="CONNECTING",e.RECONNECTING="RECONNECTING",e.CONNECTED="CONNECTED",e.CLOSED="CLOSED",e})({}),Na=(function(e){return e.CONNECTION_STATE_CHANGE="connection-state-change",e.STATE_CHANGE="state-change",e.INSPECT_RESULT="inspect-result",e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e.REQUEST_NEW_WORKER_URL="request-new-worker-url",e})({}),$f=(function(e){return e[e.CONNECT_AP=0]="CONNECT_AP",e[e.AP_CONNECTED=1]="AP_CONNECTED",e[e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e[e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e[e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e[e.CONNECT_WORKER=5]="CONNECT_WORKER",e[e.WORKER_CONNECTED=6]="WORKER_CONNECTED",e[e.CLOSED=7]="CLOSED",e})({}),Kn=(function(e){return e.CALL="call",e.CANDIDATE="candidate",e.PUBLISH="publish",e.UNPUBLISH="unpublish",e.CONTROL="control",e.RESTART_ICE="restart_ice",e.ACK="ack",e.RESPONSE="response",e.JOIN="join",e.CHECK="check",e})({}),em=(function(e){return e.ABORT="abort",e})({}),Dd=(function(e){return e.MUTE_LOCAL_AUDIO="mute_local_audio",e.MUTE_LOCAL_VIDEO="mute_local_video",e.UNMUTE_LOCAL_AUDIO="unmute_local_audio",e.UNMUTE_LOCAL_VIDEO="unmute_local_video",e})({}),r7=(function(e){return e.P2P_TOKEN_TIMEOUT="p2p_token_timeout",e.P2P_TOKEN_CHANGED="p2p_token_changed",e})({});const i7={[pT.ACCESS_POINT]:{[Ii.NO_FLAG_SET]:{desc:"flag is zero",retry:!1},[Ii.FLAG_SET_BUT_EMPTY]:{desc:"flag is empty",retry:!1},[Ii.INVALID_FALG_SET]:{desc:"invalid flag",retry:!1},[Ii.FLAG_SET_BUT_NO_RE]:{desc:"flag set unilbs but no request",retry:!1},[Ii.INVALID_SERVICE_ID]:{desc:"invalid service id",retry:!1},[Ii.NO_SERVICE_AVAILABLE]:{desc:"no service available",retry:!0},[Ii.NO_SERVICE_AVAILABLE_P2P]:{desc:"no unilbs p2p service available",retry:!0},[Ii.NO_SERVICE_AVAILABLE_VOICE]:{desc:"no unilbs voice service available",retry:!0},[Ii.NO_SERVICE_AVAILABLE_WEBRTC]:{desc:"no unilbs webrtc service available",retry:!0},[Ii.NO_SERVICE_AVAILABLE_CDS]:{desc:"no cds service available",retry:!0},[Ii.NO_SERVICE_AVAILABLE_CDN]:{desc:"no cdn dispatcher service available",retry:!0},[Ii.NO_SERVICE_AVAILABLE_TDS]:{desc:"no tds service available",retry:!0},[Ii.NO_SERVICE_AVAILABLE_REPORT]:{desc:"no unilbs report service available",retry:!0},[Ii.NO_SERVICE_AVAILABLE_APP_CENTER]:{desc:"no app center service available",retry:!0},[Ii.NO_SERVICE_AVAILABLE_ENV0]:{desc:"no unilbs sig env0 service available",retry:!0},[Ii.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voet service available",retry:!0},[Ii.NO_SERVICE_AVAILABLE_STRING_UID]:{desc:"no string uid service available",retry:!0},[Ii.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS]:{desc:"no webrtc unilbs service available",retry:!0}},[pT.UNILBS]:{[Go.INVALID_VENDOR_KEY]:{desc:"invalid vendor key, can not find appid",retry:!1},[Go.INVALID_CHANNEL_NAME]:{desc:"invalid channel name",retry:!1},[Go.INTERNAL_ERROR]:{desc:"unilbs internal error",retry:!1},[Go.NO_AUTHORIZED]:{desc:"invalid token, authorized failed",retry:!1},[Go.DYNAMIC_KEY_TIMEOUT]:{desc:"dynamic key or token timeout",retry:!1},[Go.NO_ACTIVE_STATUS]:{desc:"no active status",retry:!1},[Go.DYNAMIC_KEY_EXPIRED]:{desc:"dynamic key expired",retry:!1},[Go.STATIC_USE_DYNAMIC_KEY]:{desc:"static use dynamic key",retry:!1},[Go.DYNAMIC_USE_STATIC_KEY]:{desc:"dynamic use static key",retry:!1},[Go.USER_OVERLOAD]:{desc:"amount of users over load",retry:!1},[Go.FORBIDDEN_REGION]:{desc:"the request is forbidden in this area",retry:!1},[Go.CANNOT_MEET_AREA_DEMAND]:{desc:"unable to allocate services in this area",retry:!1}},[pT.STRING_UID_ALLOCATOR]:{[tI.IIIEGAL_APPID]:{desc:"invalid appid",retry:!1},[tI.IIIEGAL_UID]:{desc:"invalid string uid",retry:!1},[tI.INTERNAL_ERROR]:{desc:"string uid allocator internal error",retry:!0}}};function tm(e){const t=i7[Math.floor(e/1e4)];if(!t)return{desc:"unknown error",retry:!1};const n=t[e%1e4];if(!n){if(Math.floor(e/1e4)===pT.ACCESS_POINT){const r=e%1e4;if(r.toString()[0]==="1")return{desc:e.toString(),retry:!1};if(r.toString()[0]==="2")return{desc:e.toString(),retry:!0}}return{desc:"unknown error",retry:!1}}return n}const s7={[Ze.K_TIMESTAMP_EXPIRED]:{desc:"K_TIMESTAMP_EXPIRED",action:"failed"},[Ze.K_CHANNEL_PERMISSION_INVALID]:{desc:"K_CHANNEL_PERMISSION_INVALID",action:"failed"},[Ze.K_CERTIFICATE_INVALID]:{desc:"K_CERTIFICATE_INVALID",action:"failed"},[Ze.K_CHANNEL_NAME_EMPTY]:{desc:"K_CHANNEL_NAME_EMPTY",action:"failed"},[Ze.K_CHANNEL_NOT_FOUND]:{desc:"K_CHANNEL_NOT_FOUND",action:"failed"},[Ze.K_TICKET_INVALID]:{desc:"K_TICKET_INVALID",action:"failed"},[Ze.K_CHANNEL_CONFLICTED]:{desc:"K_CHANNEL_CONFLICTED",action:"failed"},[Ze.K_SERVICE_NOT_READY]:{desc:"K_SERVICE_NOT_READY",action:"tryNext"},[Ze.K_SERVICE_TOO_HEAVY]:{desc:"K_SERVICE_TOO_HEAVY",action:"tryNext"},[Ze.K_UID_BANNED]:{desc:"K_UID_BANNED",action:"failed"},[Ze.K_IP_BANNED]:{desc:"K_IP_BANNED",action:"failed"},[Ze.DATASTREAM2_NOT_AVAILABLE]:{desc:"DATASTREAM2_NOT_AVAILABLE",action:"quit"},[Ze.K_AUTO_REBALANCE]:{desc:"k_AUTO_REBALANCE",action:"recover"},[Ze.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[Ze.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[Ze.WARN_NO_AVAILABLE_CHANNEL]:{desc:"WARN_NO_AVAILABLE_CHANNEL",action:"failed"},[Ze.WARN_LOOKUP_CHANNEL_TIMEOUT]:{desc:"WARN_LOOKUP_CHANNEL_TIMEOUT",action:"tryNext"},[Ze.WARN_LOOKUP_CHANNEL_REJECTED]:{desc:"WARN_LOOKUP_CHANNEL_REJECTED",action:"failed"},[Ze.WARN_OPEN_CHANNEL_TIMEOUT]:{desc:"WARN_OPEN_CHANNEL_TIMEOUT",action:"tryNext"},[Ze.WARN_OPEN_CHANNEL_REJECTED]:{desc:"WARN_OPEN_CHANNEL_REJECTED",action:"failed"},[Ze.WARN_REQUEST_DEFERRED]:{desc:"WARN_REQUEST_DEFERRED",action:"failed"},[Ze.ERR_DYNAMIC_KEY_TIMEOUT]:{desc:"ERR_DYNAMIC_KEY_TIMEOUT",action:"failed"},[Ze.ERR_NO_AUTHORIZED]:{desc:"ERR_NO_AUTHORIZED",action:"failed"},[Ze.ERR_VOM_SERVICE_UNAVAILABLE]:{desc:"ERR_VOM_SERVICE_UNAVAILABLE",action:"tryNext"},[Ze.ERR_NO_CHANNEL_AVAILABLE_CODE]:{desc:"ERR_NO_CHANNEL_AVAILABLE_CODE",action:"failed"},[Ze.ERR_MASTER_VOCS_UNAVAILABLE]:{desc:"ERR_MASTER_VOCS_UNAVAILABLE",action:"tryNext"},[Ze.ERR_INTERNAL_ERROR]:{desc:"ERR_INTERNAL_ERROR",action:"tryNext"},[Ze.ERR_NO_ACTIVE_STATUS]:{desc:"ERR_NO_ACTIVE_STATUS",action:"failed"},[Ze.ERR_INVALID_UID]:{desc:"ERR_INVALID_UID",action:"failed"},[Ze.ERR_DYNAMIC_KEY_EXPIRED]:{desc:"ERR_DYNAMIC_KEY_EXPIRED",action:"failed"},[Ze.ERR_STATIC_USE_DYANMIC_KE]:{desc:"ERR_STATIC_USE_DYANMIC_KE",action:"failed"},[Ze.ERR_DYNAMIC_USE_STATIC_KE]:{desc:"ERR_DYNAMIC_USE_STATIC_KE",action:"failed"},[Ze.ERR_NO_VOCS_AVAILABLE]:{desc:"ERR_NO_VOCS_AVAILABLE",action:"tryNext"},[Ze.ERR_NO_VOS_AVAILABLE]:{desc:"ERR_NO_VOS_AVAILABLE",action:"tryNext"},[Ze.ERR_JOIN_CHANNEL_TIMEOUT]:{desc:"ERR_JOIN_CHANNEL_TIMEOUT",action:"tryNext"},[Ze.ERR_JOIN_BY_MULTI_IP]:{desc:"ERR_JOIN_BY_MULTI_IP",action:"recover"},[Ze.ERR_NOT_JOINED]:{desc:"ERR_NOT_JOINED",action:"failed"},[Ze.ERR_REPEAT_JOIN_REQUEST]:{desc:"ERR_REPEAT_JOIN_REQUEST",action:"quit"},[Ze.ERR_REPEAT_JOIN_CHANNEL]:{desc:"ERR_REPEAT_JOIN_CHANNEL",action:"quit"},[Ze.ERR_INVALID_STRINGUID]:{desc:"ERR_INVALID_STRINGUID",action:"failed"},[Ze.ERR_TOO_MANY_USERS]:{desc:"ERR_TOO_MANY_USERS",action:"tryNext"},[Ze.ERR_SET_CLIENT_ROLE_TIMEOUT]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[Ze.ERR_SET_CLIENT_ROLE_NO_PERMISSION]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[Ze.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE]:{desc:"ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",action:"success"},[Ze.ERR_PUBLISH_REQUEST_INVALID]:{desc:"ERR_PUBLISH_REQUEST_INVALID",action:"failed"},[Ze.ERR_SUBSCRIBE_REQUEST_INVALID]:{desc:"ERR_SUBSCRIBE_REQUEST_INVALID",action:"failed"},[Ze.ERR_NOT_SUPPORTED_MESSAGE]:{desc:"ERR_NOT_SUPPORTED_MESSAGE",action:"failed"},[Ze.ERR_ILLEAGAL_PLUGIN]:{desc:"ERR_ILLEAGAL_PLUGIN",action:"failed"},[Ze.ILLEGAL_CLIENT_ROLE_LEVEL]:{desc:"ILLEGAL_CLIENT_ROLE_LEVEL",action:"failed"},[Ze.ERR_REJOIN_TOKEN_INVALID]:{desc:"ERR_REJOIN_TOKEN_INVALID",action:"failed"},[Ze.ERR_REJOIN_USER_NOT_JOINED]:{desc:"ERR_REJOIN_NOT_JOINED",action:"failed"},[Ze.ERR_INVALID_OPTIONAL_INFO]:{desc:"ERR_INVALID_OPTIONAL_INFO",action:"quit"},[Ze.ERR_TEST_RECOVER]:{desc:"ERR_TEST_RECOVER",action:"recover"},[Ze.ERR_TEST_TRYNEXT]:{desc:"ERR_TEST_TRYNEXT",action:"recover"},[Ze.ERR_TEST_RETRY]:{desc:"ERR_TEST_RETRY",action:"recover"},[Ze.ILLEGAL_AES_PASSWORD]:{desc:"ERR_TEST_RETRY",action:"failed"},[Ze.ERR_TOO_MANY_BROADCASTERS]:{desc:"ERR_TOO_MANY_BROADCASTERS",action:"failed"},[Ze.ERR_TOO_MANY_SUBSCRIBERS]:{desc:"ERR_TOO_MANY_SUBSCRIBERS",action:"failed"},[Ze.ERR_LICENSE_ILLEGAL]:{desc:"ERR_LICENSE_ILLEGAL",action:"quit"},[Ze.ERR_LICENSE_MISSING]:{desc:"ERR_LICENSE_MISSING",action:"quit"},[Ze.ERR_LICENSE_EXPIRED]:{desc:"ERR_LICENSE_EXPIRED",action:"quit"},[Ze.ERR_LICENSE_MINUTES_EXCEEDED]:{desc:"ERR_LICENSE_MINUTES_EXCEEDED",action:"quit"},[Ze.ERR_LICENSE_PERIOD_INVALID]:{desc:"ERR_LICENSE_PERIOD_INVALID",action:"quit"},[Ze.ERR_LICENSE_MULTIPLE_SDK_SERVICE]:{desc:"ERR_LICENSE_MULTIPLE_SDK_SERVICE",action:"quit"}};function aE(e){return s7[e]||{desc:"UNKNOWN_ERROR_".concat(e),action:"failed"}}function t2(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable}))),n.push.apply(n,r)}return n}function sI(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?t2(Object(n),!0).forEach((function(r){x(e,r,n[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):t2(Object(n)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))}))}return e}function oI(e,t){if(typeof e=="string")return e;const{proxy:n,host:r,port:i}=e;if(t){const s=B("JOIN_GATEWAY_FALLBACK_PORT")||443;return s===443?"wss://".concat(r,"/ws/?p=").concat(Number(i)+150):"wss://".concat(r,":").concat(s,"/ws/?p=").concat(Number(i)+150)}return n?"wss://".concat(n,"/ws/?h=").concat(r,"&p=").concat(i):"wss://".concat(r,":").concat(i)}const o7=/wss:\/\/(.+)\/ws\/\?h=(.+)&p=([0-9]+)\/?/,a7=/wss:\/\/(.+)\/ws\/\?p=([0-9]+)\/?/,c7=/wss:\/\/(.+):([0-9]+)\/?/,l7=/wss:\/\/(.[^\/]+)\/?/;let d7=0;class u7{constructor(t,n){x(this,"id",0),x(this,"store",void 0),x(this,"recordIndex",void 0),x(this,"websockets",[]),x(this,"try443PortDuration",2e3),x(this,"forceCloseWSDuration",5e3),x(this,"try443PortTimeout",null),x(this,"forceCloseTimeout",null),x(this,"isTry443PortFailed",!1),x(this,"isNormalPortFailed",!1),x(this,"useDoubleDomain",!1),x(this,"useProxy",!1),x(this,"startTime",Date.now()),this.id=++d7,this.try443PortDuration=B("JOIN_GATEWAY_TRY_443PORT_DURATION")||2e3,this.forceCloseWSDuration=t||5e3,this.store=n}closeAllWebsockets(){this.websockets.forEach((t=>{t.onopen=null,t.onclose=null,t.onmessage=null,t.close()})),this.websockets.length=0}clearTimeout(){this.forceCloseTimeout&&clearTimeout(this.forceCloseTimeout),this.try443PortTimeout&&clearTimeout(this.try443PortTimeout),this.forceCloseTimeout=null,this.try443PortTimeout=null}logger(){var t;const n=Date.now()-this.startTime;for(var r=arguments.length,i=new Array(r),s=0;s<r;s++)i[s]=arguments[s];w.debug("[choose-best-ws ".concat((t=this.store)===null||t===void 0?void 0:t.clientId," ").concat(this.id,"] ").concat(n,"ms:"),...i)}createWebSocket(t,n,r){this.logger("createWebSocket:",t,{isTry443Port:n,hasTimeoutDetection:r});const i=B("GATEWAY_DOMAINS"),s=Date.now(),o=[],c=i.find((E=>{var S;return be(S=t.host).call(S,E)}));c||(this.useDoubleDomain=!1);const d=[];if(this.useDoubleDomain)i.forEach((E=>{d.push(oI(sI(sI({},t),{},{host:t.host.replace(c,E)}),n))}));else{const E=sI({},t);if(n&&c){const S=i.find((O=>O!==c));S&&(E.host=E.host.replace(c,S))}d.push(oI(E,n))}try{d.forEach((E=>{const S=new WebSocket(E);S.binaryType="arraybuffer",o.push(S),this.logger("ws is connecting:",S.url)}))}catch(E){if(this.logger("ws create failed"),o.forEach((S=>S.close())),o.length=0,this.useDoubleDomain)return this.useDoubleDomain=!1,this.createWebSocket(t,n,r);if(!n&&Number(t.port)!==443)return this.createWebSocket(t,!0,r);throw new le(V.WS_ERR,"init websocket failed! Error: ".concat(E.toString()))}const h=Kg();this.store&&this.store.recordJoinChannelService({urls:o.map((E=>E.url)),service:"gateway"},this.recordIndex),o.forEach((E=>{E.onopen=()=>{this.logger("onopen: ws ".concat(E.url," open cost ").concat(Date.now()-s,"ms")),this.websockets.forEach((S=>{S!==E&&(S.onopen=null,S.onclose=null,S.onmessage=null,S.close(),this.logger("close backup websocket: ".concat(S.url)))})),this.websockets.length=0,h.resolve(E)},E.onclose=S=>{this.logger("onclose: ws ".concat(E.url," closed cost ").concat(Date.now()-s,"ms state: ").concat(E.readyState));const O=o.every((A=>A.readyState===WebSocket.CLOSED||A.readyState===WebSocket.CLOSING));this.logger("".concat(n?"443":"47xx"," websocket closed, all failed: ").concat(O)),O&&(n||this.isTry443PortFailed||this.useProxy)?(this.logger("onclose: all websocket is closed, ".concat(S.reason)),h.reject({code:S.code,reason:_T.A_ROUND_WS_FAILED})):!n&&O&&!this.isNormalPortFailed&&this.try443PortTimeout&&(this.logger("all 47xx websocket is closed, try 443 port"),this.clearTimeout(),g()),n?this.isTry443PortFailed=O:this.isNormalPortFailed=O},E.onmessage=S=>this.logger("".concat(E.url," onmessage: ").concat(S.data))})),this.websockets.push(...o);const f=()=>{this.websockets.forEach((E=>E.readyState!==WebSocket.OPEN&&E.close()))},g=()=>{if(h.isResolved)return f();Mt().os===Er.MAC_OS&&jn()&&f(),this.createWebSocket(t,!0,!0).then((E=>{h.resolve(E)})).catch((E=>{this.isNormalPortFailed&&h.reject(E),this.logger("try 443 port to create ws failed")})),this.forceCloseTimeout=window.setTimeout((()=>{this.logger("5s timeout close un-opens, isWebsocket created: ",h.isResolved),this.forceCloseTimeout=null,f()}),this.forceCloseWSDuration)};return r||(()=>{if(n||this.useProxy)return this.logger("add 5s timeout at ".concat(n?"try-443":"proxy"," condition")),this.forceCloseTimeout=window.setTimeout((()=>{this.forceCloseTimeout=null,f()}),this.forceCloseWSDuration);this.try443PortTimeout=window.setTimeout((()=>{this.logger("2s timeout, isWebsocket created: ",h.isResolved),this.try443PortTimeout=null,g()}),this.try443PortDuration)})(),h.promise}chooseBestWebsocket(t,n,r,i){return this.useDoubleDomain=!!n,typeof t=="string"&&(t=(function(s){let o,c,d;return[,o,c,d]=s.match(o7)||[],o||([,c,d]=s.match(a7)||[]),c&&d||([,c,d]=s.match(c7)||[]),c&&d||([,c]=s.match(l7)||[]),c||w.warning("un-destructible url: ",s),{proxy:o,host:c,port:d||"443"}})(t)),this.recordIndex=i,this.useProxy=!!t.proxy,r&&this.useProxy&&(w.warn("cannot use 443 only when use proxy"),r=!1),this.createWebSocket(t,!!r,!1).finally((()=>this.clearTimeout()))}}function n2(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable}))),n.push.apply(n,r)}return n}class r2 extends xn{get url(){return this.websocket&&this.websocket.url||this._websocketUrl}get reconnectMode(){return this._reconnectMode}set reconnectMode(t){var n;be(n=["tryNext","recover"]).call(n,t)&&this.resetReconnectCount(t),this._reconnectMode=t}get state(){return this._state}set state(t){t!==this._state&&(this._state=t,this._state==="reconnecting"?this.emit(Et.RECONNECTING,this.reconnectReason):this._state==="connected"?this.emit(Et.CONNECTED):this._state==="closed"?this.emit(Et.CLOSED):this._state==="failed"&&this.emit(Et.FAILED))}resetReconnectCount(t){w.debug("websocket reset reconnect count, reason: "+t),this.reconnectCount=0}constructor(t,n){let r=arguments.length>2&&arguments[2]!==void 0&&arguments[2],i=arguments.length>3&&arguments[3]!==void 0&&arguments[3],s=arguments.length>4&&arguments[4]!==void 0&&arguments[4],o=arguments.length>5?arguments[5]:void 0;super(),x(this,"_websocketUrl",null),x(this,"connectionID",0),x(this,"currentURLIndex",0),x(this,"urls",[]),x(this,"_reconnectMode","tryNext"),x(this,"reconnectReason",void 0),x(this,"_initMutex",void 0),x(this,"name",void 0),x(this,"_state","closed"),x(this,"reconnectInterrupter",void 0),x(this,"websocket",void 0),x(this,"retryConfig",void 0),x(this,"reconnectCount",0),x(this,"forceCloseTimeout",5e3),x(this,"onlineReconnectListener",void 0),x(this,"useCompress",void 0),x(this,"tryDoubleDomain",!1),x(this,"use443PortOnly",!1),x(this,"wsInflateLength",0),x(this,"wsDeflateLength",0),x(this,"closeEstablishingWs",(()=>{})),x(this,"store",void 0),x(this,"joinGatewayRecordIndex",void 0),this.store=o,this.name=t,this.retryConfig=(function(g){for(var E=1;E<arguments.length;E++){var S=arguments[E]!=null?arguments[E]:{};E%2?n2(Object(S),!0).forEach((function(O){x(g,O,S[O])})):Object.getOwnPropertyDescriptors?Object.defineProperties(g,Object.getOwnPropertyDescriptors(S)):n2(Object(S)).forEach((function(O){Object.defineProperty(g,O,Object.getOwnPropertyDescriptor(S,O))}))}return g})({},n),this.useCompress=r,this.tryDoubleDomain=i,this.use443PortOnly=s,this._initMutex=new Jr("websocket",o?o.clientId:void 0);const{timeout:c,timeoutFactor:d}=n,h=Math.max(300,Math.floor(3*c/5)),f=Math.max(1.2,Math.floor(8*d)/10);gs.ONLINE&&(this.retryConfig.timeout=h,this.retryConfig.timeoutFactor=f),Qn.on(xf.NETWORK_STATE_CHANGE,((g,E)=>{g!==E&&(this.resetReconnectCount("network state change: ".concat(E," -> ").concat(g)),g===gs.ONLINE?(this.retryConfig.timeout=h,this.retryConfig.timeoutFactor=f):(this.retryConfig.timeout=c,this.retryConfig.timeoutFactor=d))}))}getConnection(){return this.websocket||void 0}async init(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const r=await this._initMutex.lock();this._reconnectMode="tryNext",this.forceCloseTimeout=n,this.urls=t,this.state="connecting";try{var i;const s=Kg(),o=this.urls[this.currentURLIndex];(i=this.store)===null||i===void 0||i.beforeConnect(),(function(c){return!(QS()||B("USE_NEW_TOKEN")||!B("ENABLE_PREALLOC_PC")&&(c==null||!c.autoSubscribe||B("FORCE_DISABLE_AUTO_SUB")))})(this.store)&&this.emit(e2.PRE_CONNECT_PC),this.createWebSocketConnection(o).then(s.resolve).catch(s.reject),this.once(Et.CLOSED,(()=>{s.reject(new de(V.WS_DISCONNECT))})),this.once(Et.CONNECTED,s.resolve),await s.promise}catch{}finally{r()}}close(t,n){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this.reconnectInterrupter&&this.reconnectInterrupter(),this.websocket){this.websocket.onclose=null,this.websocket.onopen=null,this.websocket.onmessage=null;const r=this.websocket;n?setTimeout((()=>r.close()),500):r.close(),this.websocket=void 0,this._websocketUrl=null}this.state=t?"failed":"closed",this.closeEstablishingWs&&this.closeEstablishingWs()}reconnect(t,n){if(!this.websocket)return void w.warning("[".concat(this.name,"] can not reconnect, no websocket"));t!==void 0&&(this.reconnectMode=t),w.debug("[".concat(this.name,"] reconnect is triggered initiative")),typeof this.joinGatewayRecordIndex=="number"&&this.store&&this.store.recordJoinChannelService({status:"error",errors:[new Error(n)]},this.joinGatewayRecordIndex);const r=this.websocket.onclose;this.websocket.onclose=null,this.websocket.close(),r&&r.bind(this.websocket)({code:9999,reason:n})}sendMessage(t){let n=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!this.websocket||this.websocket.readyState!==WebSocket.OPEN)throw new de(V.WS_ABORT,"websocket is not ready");try{n||(t=JSON.stringify(t)),this.websocket.send(t)}catch(r){throw new de(V.WS_ERR,"send websocket message error"+r.toString())}}setWsInflateData(t){this.wsDeflateLength=this.wsDeflateLength+t.originLength,this.wsInflateLength=this.wsInflateLength+t.compressedLength}getWsInflateData(){const t=this.wsInflateLength,n=this.wsDeflateLength;return this.clearWsInflateData(),{wsInflateLength:t,wsDeflateLength:n}}clearWsInflateData(){this.wsInflateLength=0,this.wsDeflateLength=0}async createWebSocketConnection(t){var n;const r=Kg();this.connectionID+=1,this.joinGatewayRecordIndex=void 0;const i=f=>{var g;(g=this.store)===null||g===void 0||g.signalChannelOpen(),w.debug("[".concat(this.name,"] websocket opened:"),f),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),r.resolve()},s=async f=>{var g;if(w.debug("[".concat(this.name,"] websocket close ").concat((g=this.websocket)===null||g===void 0?void 0:g.url,", code: ").concat(f.code,", reason: ").concat(f.reason,", current mode: ").concat(this.reconnectMode)),this.reconnectCount>=this.retryConfig.maxRetryCount)r.reject(new de(V.WS_DISCONNECT,"websocket close: ".concat(f.code))),this.close();else{this.state==="connected"&&(this.reconnectReason=f.reason,this.state="reconnecting");const E=As(this,Et.WILL_RECONNECT,this.reconnectMode,f.reason)||this.reconnectMode,S=await this.reconnectWithAction(E);if(this.state==="closed")return void w.debug("[".concat(this.connectionID,"] ws is closed, no need to reconnect"));if(!S)return r.reject(new de(V.WS_DISCONNECT,"websocket reconnect failed: ".concat(f.code))),this.close(!0);r.resolve()}},o=f=>{this.emit(Et.ON_MESSAGE,f)},c=f=>{w.warn("[".concat(this.connectionID,"] ws open error ").concat(f))};this.websocket&&(this.websocket.onclose=null,this.websocket.close()),B("GATEWAY_WSS_ADDRESS")&&this.name.startsWith("gateway")&&(t=B("GATEWAY_WSS_ADDRESS")),w.debug("[".concat(this.name,"] start connect, url:"),t);const d=(n=this.store)===null||n===void 0?void 0:n.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"});try{var h;this._websocketUrl=oI(t);const f=await this.chooseBestWebsocketConnection(t);this.websocket=f,i&&i(this.websocket.url),this.websocket.onclose=s,this.websocket.onmessage=o,this.websocket.onerror=c,(h=this.store)===null||h===void 0||h.recordJoinChannelService({endTs:Date.now(),status:"success"},d),this.joinGatewayRecordIndex=d}catch(f){const g=this.state==="closed",E=f instanceof de,S=E&&f.code===V.WS_ABORT,O=E&&f.code===V.WS_ERR,A=E?f.message:f&&(f.reason||f.toString());w.warning("[choose-best-ws] chooseBestWebsocket error: ".concat(A)),this.store&&this.store.recordJoinChannelService({endTs:Date.now(),status:S?"aborted":"error",errors:[f]},d),g||O?(r.reject(g?new de(V.WS_DISCONNECT,"websocket is closed: ".concat(A)):new de(V.WS_ERR,"init websocket failed: ".concat(A))),O&&w.error("[".concat(this.name,"] init websocket failed: ").concat(A))):s&&s(f)}return r.promise}async reconnectWithAction(t){let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(this.reconnectCount>=this.retryConfig.maxRetryCount||this.urls.length===0||this.state==="closed")return!1;w.warning("[choose-best-ws] action: =>",t),this.onlineReconnectListener||Qn.isOnline||!Qn.onlineWaiter||(this.onlineReconnectListener=Qn.onlineWaiter.then((()=>{this.onlineReconnectListener=void 0})));let r=!0;if(this.reconnectInterrupter=()=>r=!1,n){const o=pb(this.reconnectCount,this.retryConfig);w.debug("[".concat(this.name,"] wait ").concat(o,"ms to reconnect websocket, mode: ").concat(t)),await ke.race([xr(o),this.onlineReconnectListener||new ke((()=>{}))])}if(this._state==="closed"||!r)return!1;this.reconnectCount+=1;const i=async(o,c)=>{this.emit(Et.RECONNECT_CREATE_CONNECTION,c),await this.createWebSocketConnection(o)};try{if(t==="retry")await i(this.urls[this.currentURLIndex],t);else if(t==="tryNext"){if(this.currentURLIndex+=1,this.currentURLIndex>=this.urls.length)return this.reconnectWithAction("recover",!1);w.debug("[".concat(this.name,"] websocket url length: ").concat(this.urls.length," current index: ").concat(this.currentURLIndex)),await i(this.urls[this.currentURLIndex],t)}else t==="recover"&&(w.debug("[".concat(this.name,"] request new urls")),this.resetReconnectCount("recover mode"),this.urls=await Gr(this,Et.REQUEST_NEW_URLS),this.currentURLIndex=0,await i(this.urls[this.currentURLIndex],t))}catch(o){var s;w.error("[".concat(this.name,"] reconnect failed ").concat(o&&o.toString()));const c=o==null||(s=o.data)===null||s===void 0?void 0:s.desc;return Array.isArray(c)&&be(c).call(c,"dynamic key expired")?(this.emit(Et.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):this.reconnectWithAction(t,n)}return!0}}class aI extends r2{constructor(t,n){super(t,n,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(t,n){const r=Kg(),i=(function(o,c){return new u7(o,c)})(this.forceCloseTimeout,this.store);this.closeEstablishingWs=()=>{w.debug("[choose-best-ws] close establishing websockets"),i.closeAllWebsockets(),r.reject(new de(V.WS_ABORT,"choose best websocket aborted"))};const s=B("GATEWAY_DOMAINS");return w.debug("[choose-best-ws] currentDomain: ",t,", domains: ",s,"total: ".concat(this.urls.length),"current: ".concat(this.currentURLIndex+1)),i.chooseBestWebsocket(t,this.tryDoubleDomain,this.use443PortOnly,n).then(r.resolve).catch(r.reject),r.promise.finally((()=>{this.closeEstablishingWs=void 0}))}}class cE extends r2{constructor(t,n){super(t,n,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(t,n){return new ke(((r,i)=>{let s=!1;const o=[];this.closeEstablishingWs=()=>{w.debug("[choose-best-ws] close establishing websockets"),o.forEach((O=>{O.onclose=null,O.onopen=null,O.onmessage=null,O.close()})),i(new de(V.WS_ABORT,"choose best websocket aborted"))};const c=B("GATEWAY_DOMAINS");let d;const h=t.indexOf("?h="),f=c.find((O=>h!==-1?be(t).call(t,O,h):be(t).call(t,O)));w.debug("[choose-best-ws] currentDomain: ",f,", domains: ",c);let g=!this.tryDoubleDomain||!f;if(!g&&f){var E;const O=Date.now();try{c.forEach((A=>{const N=h===-1?t.replace(f,A):t.substr(0,h)+t.substr(h).replace(f,A),j=new WebSocket(N);j.binaryType="arraybuffer",o.push(j),w.debug("[choose-best-ws] ws is connecting:",j.url)}))}catch{for(w.debug("[choose-best-ws] ws create failed, fallback to single url"),o.forEach((N=>N.close()));o.length;)o.pop();g=!0}(E=this.store)===null||E===void 0||E.recordJoinChannelService({urls:o.map((A=>A.url)),service:"gateway"},n),o.forEach((A=>{A.onopen=()=>{if(s)return;const N=Date.now()-O;w.debug("[choose-best-ws] ws open cost ".concat(N,"ms")),o.filter((j=>j!==A)).forEach((j=>{w.debug("[choose-best-ws]close backup websocket: ".concat(j.url)),j.close()})),s=!0,r(A)},A.onclose=N=>{d=N,!s&&(o.find((j=>!(j.readyState===WebSocket.CLOSED||j.readyState===WebSocket.CLOSING)))||(w.debug("[choose-best-ws] all websocket is closed"),s=!0,i(d)))},A.onmessage=N=>{w.debug("[choose-best-ws]".concat(A.url," onmessage: ").concat(N.data))}})),xr(this.forceCloseTimeout).then((()=>{o.forEach((A=>{A.readyState!==WebSocket.OPEN&&A.close()}))}))}if(g){var S;let O;w.debug("[choose-best-ws] use single url: ",t),(S=this.store)===null||S===void 0||S.recordJoinChannelService({urls:[t],service:"gateway"},n);try{O=new WebSocket(t),o.push(O),O.binaryType="arraybuffer"}catch(A){const N=new de(V.WS_ERR,"init websocket failed! Error: ".concat(A.toString()));return w.error("[".concat(this.name,"]").concat(N)),void i(N)}O.onopen=()=>{r(O)},O.onclose=A=>{i(A)},O.onmessage=A=>{w.debug("[choose-best-ws]".concat(O.url," onmessage: ").concat(A.data))},xr(this.forceCloseTimeout).then((()=>{O&&O.readyState!==WebSocket.OPEN&&O.close()}))}})).then((r=>(this.closeEstablishingWs=void 0,r))).catch((r=>{throw this.closeEstablishingWs=void 0,r}))}}class h7 extends xn{get connectionState(){return this._connectionState}set connectionState(t){t!==this._connectionState&&(this._connectionState=t,t===vn.CONNECTED?this.emit(ct.WS_CONNECTED):t===vn.RECONNECTING?this.emit(ct.WS_RECONNECTING,this._websocketReconnectReason):t===vn.CLOSED&&this.emit(ct.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(t,n){super(),x(this,"_disconnectedReason",void 0),x(this,"_websocketReconnectReason",void 0),x(this,"_connectionState",vn.CLOSED),x(this,"reconnectToken",void 0),x(this,"websocket",void 0),x(this,"openConnectionTime",void 0),x(this,"clientId",void 0),x(this,"lastMsgTime",Date.now()),x(this,"uploadCache",[]),x(this,"uploadCacheInterval",void 0),x(this,"rttRolling",new u1(5)),x(this,"pingpongTimer",void 0),x(this,"wsInflateDataTimer",void 0),x(this,"pingpongTimeoutCount",0),x(this,"ortc",void 0),x(this,"joinResponse",void 0),x(this,"multiIpOption",void 0),x(this,"initError",void 0),x(this,"spec",void 0),x(this,"store",void 0),x(this,"onWebsocketMessage",(r=>{if(r.data instanceof ArrayBuffer)return void this.emit(ct.ON_BINARY_DATA,r.data);const i=JSON.parse(r.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(i,"_id")){const s="res-@".concat(i._id);this.emit(s,i._result,i._message)}else if(Object.prototype.hasOwnProperty.call(i,"_type")){if(this.emit(i._type,i._message),i._type===Dt.ON_NOTIFICATION&&this.handleNotification(i._message),i._type===Dt.ON_USER_BANNED)switch(i._message.error_code){case 14:this.close($t.UID_BANNED);break;case 15:this.close($t.IP_BANNED);break;case 16:this.close($t.CHANNEL_BANNED)}if(i._type===Dt.ON_USER_LICENSE_BANNED)switch(i._message.error_code){case Ze.ERR_LICENSE_MISSING:this.close($t.LICENSE_MISSING);break;case Ze.ERR_LICENSE_EXPIRED:this.close($t.LICENSE_EXPIRED);break;case Ze.ERR_LICENSE_MINUTES_EXCEEDED:this.close($t.LICENSE_MINUTES_EXCEEDED);break;case Ze.ERR_LICENSE_PERIOD_INVALID:this.close($t.LICENSE_PERIOD_INVALID);break;case Ze.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close($t.LICENSE_MULTIPLE_SDK_SERVICE);break;case Ze.ERR_LICENSE_ILLEGAL:this.close($t.LICENSE_ILLEGAL);break;default:this.close()}}})),this.clientId=t.clientId,this.spec=t,this.store=n,this.websocket=new aI("gateway-".concat(this.clientId),this.spec.retryConfig,!0,B("JOIN_GATEWAY_USE_DUAL_DOMAIN"),B("JOIN_GATEWAY_USE_443PORT_ONLY"),n),this.handleWebsocketEvents(),window.addEventListener("offline",(()=>{this.connectionState===vn.CONNECTED&&this.reconnect("retry",Wr.OFFLINE)}))}async request(t,n,r,i){const s=hn(6,""),o={_id:s,_type:t,_message:n},c=this.websocket.connectionID,d=()=>new ke(((O,A)=>{if(this.connectionState===vn.CONNECTED)return O();const N=()=>{this.off(ct.WS_CLOSED,j),O()},j=()=>{this.off(ct.WS_CONNECTED,N),A(new le(V.WS_ABORT))};this.once(ct.WS_CONNECTED,N),this.once(ct.WS_CLOSED,j),t!==ot.PUBLISH&&t!==ot.PUBLISH_DATASTREAM&&t!==ot.SUBSCRIBE&&t!==ot.SUBSCRIBE_DATASTREAM&&t!==ot.UNSUBSCRIBE&&t!==ot.UNSUBSCRIBE_DATASTREAM&&t!==ot.UNPUBLISH&&t!==ot.UNPUBLISH_DATASTREAM&&t!==ot.CONTROL&&t!==ot.RESTART_ICE||this.once(ct.DISCONNECT_P2P,(()=>{A(new le(V.DISCONNECT_P2P))})),t!==ot.PUBLISH&&t!==ot.RESTART_ICE||this.once(ct.ABORT_P2P_EXECUTION,(()=>{A(new le(V.DISCONNECT_P2P))}))}));if(this.connectionState!==vn.CONNECTING&&this.connectionState!==vn.RECONNECTING||t===ot.JOIN||t===ot.REJOIN||await d(),this.websocket.sendMessage(o,!0),i)return;const h=new ke(((O,A)=>{let N=!1;const j=(W,$)=>{N=!0,O({isSuccess:W==="success",message:$||{}}),this.off(ct.WS_CLOSED,U),this.off(ct.WS_RECONNECTING,U),this.emit(ct.REQUEST_SUCCESS,t,n)};this.once("res-@".concat(s),j);const U=()=>{A(new le(V.WS_ABORT,"type: ".concat(t))),this.off(ct.WS_CLOSED,U),this.off(ct.WS_RECONNECTING,U),this.off("res-@".concat(s),j)};this.once(ct.WS_CLOSED,U),this.once(ct.WS_RECONNECTING,U),xr(B("SIGNAL_REQUEST_TIMEOUT")).then((()=>{this.websocket.connectionID!==c||N||(w.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(t)),this.emit(ct.REQUEST_TIMEOUT,t,n))}))}));let f=null;try{f=await h}catch(O){if(this.connectionState===vn.CLOSED||t===ot.LEAVE)throw new le(V.WS_ABORT);return!this.spec.forceWaitGatewayResponse||r?O.throw():t===ot.JOIN||t===ot.REJOIN?null:(await d(),await this.request(t,n))}if(f.isSuccess)return f.message;const g=Number(f.message.error_code||f.message.code),E=aE(g),S=new le(V.UNEXPECTED_RESPONSE,"".concat(E.desc,": ").concat(f.message.error_str),{code:g,data:f.message,desc:E.desc});return E.action==="success"?f.message:(w.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(t,", error_code: ").concat(g,", message: ").concat(E.desc,", action: ").concat(E.action)),g===Ze.ERR_TOO_MANY_BROADCASTERS?((t===ot.JOIN||t===ot.REJOIN)&&(this.initError=S,this.close()),S.throw()):E.action==="failed"?S.throw():E.action==="quit"?(this.initError=S,this.close(),S.throw()):(g===Ze.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=f.message.option,w.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",Wr.MULTI_IP)):this.reconnect(E.action,Wr.SERVER_ERROR),t===ot.JOIN||t===ot.REJOIN?null:await this.request(t,n)))}waitMessage(t,n){return new ke((r=>{const i=s=>{(!n||n(s))&&(this.off(t,i),r(s))};this.on(t,i)}))}uploadWRTCStats(t){if(!this.store.sessionId)return void w.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const n={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:t};this.upload(sE.WRTC_STATS,n)}upload(t,n){const r={_type:t,_message:n};try{this.websocket.sendMessage(r)}catch{const s=B("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(r),this.uploadCache.length>s&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval((()=>{if(this.connectionState!==vn.CONNECTED)return;const o=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(o._type,o._message)}),B("UPLOAD_CACHE_INTERVAL")||2e3))}}send(t,n){const r={_type:t,_message:n};this.websocket.sendMessage(r)}init(t){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new ke(((n,r)=>{this.once(ct.WS_CONNECTED,(()=>n(this.joinResponse))),this.once(ct.WS_CLOSED,(i=>r(this.initError||new le(V.WS_ABORT,i)))),this.connectionState=vn.CONNECTING,this.websocket.init(t).catch(r),this.wsInflateDataTimer&&window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=window.setInterval((()=>{this.handleWsInflateData()}),2e4)}))}close(t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=t||$t.LEAVE,this.connectionState=vn.CLOSED,w.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close()}async join(){if(!this.joinResponse){this.emit(ct.ABORT_P2P_EXECUTION),this.store.signalConnected();const t=await Gr(this,ct.REQUEST_JOIN_INFO);this.store.joinReq();const n=await this.request(ot.JOIN,t);if(this.ortc=t?.ortc,this.store.joinRep(),!n)return this.emit(ct.REPORT_JOIN_GATEWAY,_T.TIMEOUT,this.url||""),!1;this.joinResponse=n,this.emit(ct.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=vn.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}async rejoin(){if(!this.reconnectToken)throw new le(V.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const t=Jg(this,ct.REQUEST_REJOIN_INFO);t.token=this.reconnectToken;const n=await this.request(ot.REJOIN,t);return!!n&&(this.connectionState=vn.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),n.peers&&n.peers.forEach((r=>{this.emit(Dt.ON_USER_ONLINE,{uid:r.uid}),r.audio&&this.emit(Dt.ON_ADD_AUDIO_STREAM,{uid:r.uid,uint_id:r.uint_id,audio:!0,ssrcId:r.audio_ssrc}),r.video&&this.emit(Dt.ON_ADD_VIDEO_STREAM,{uid:r.uid,uint_id:r.uint_id,video:!0,ssrcId:r.video_ssrc}),r.audio_mute?this.emit(Dt.MUTE_AUDIO,{uid:r.uid}):this.emit(Dt.UNMUTE_AUDIO,{uid:r.uid}),r.video_mute?this.emit(Dt.MUTE_VIDEO,{uid:r.uid}):this.emit(Dt.UNMUTE_VIDEO,{uid:r.uid}),r.audio_enable_local?this.emit(Dt.ENABLE_LOCAL_AUDIO,{uid:r.uid}):this.emit(Dt.DISABLE_LOCAL_AUDIO,{uid:r.uid}),r.video_enable_local?this.emit(Dt.ENABLE_LOCAL_VIDEO,{uid:r.uid}):this.emit(Dt.DISABLE_LOCAL_VIDEO,{uid:r.uid}),r.audio||r.video||this.emit(Dt.ON_REMOVE_STREAM,{uid:r.uid,uint_id:r.uint_id})})),!0)}reconnect(t,n){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(t,n)}async downgradeCodec(t){if(!this.ortc)return!1;const n={downgrade_codec:t,ortc:this.ortc};return!!await this.request(ot.DOWNGRADE_CODEC,n)}handleNotification(t){w.debug("[".concat(this.clientId,"] receive notification: "),t);const n=aE(t.code);if(t.code===28&&"detail"in t&&(w.info("[".concat(this.clientId,"] receive recover notification: "),t.detail),this.emit(ct.RECOVER_NOTIFICATION,t.detail)),n.action!=="success"){if(n.action!=="failed")return n.action==="quit"?(n.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close($t.UID_BANNED),void this.close()):void this.reconnect(n.action,Wr.SERVER_ERROR);w.error("[".concat(this.clientId,"] ignore error: "),n.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const t=B("PING_PONG_TIME_OUT"),n=Date.now();this.pingpongTimeoutCount>=t&&(w.warning("[".concat(this.clientId,"] PING-PONG Timeout. Last Socket Message: ").concat(n-this.lastMsgTime,"ms")),n-this.lastMsgTime>B("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",Wr.TIMEOUT):this.request(ot.PING,void 0,!0).then((()=>{this.pingpongTimeoutCount=0;const r=Date.now()-n;this.rttRolling.add(r),B("REPORT_STATS")&&this.send(ot.PING_BACK,{pingpongElapse:r})})).catch((r=>{}))}handleWsInflateData(){const{wsInflateLength:t,wsDeflateLength:n}=this.websocket.getWsInflateData();t!==0&&n!==0&&this.upload(sE.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:n,ws_inflate_length:t})}handleWebsocketEvents(){this.websocket.on(Et.RECONNECT_CREATE_CONNECTION,(t=>{this.emit(ct.WS_RECONNECT_CREATE_CONNECTION,t)})),this.websocket.on(Et.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(Et.CLOSED,(()=>{this.connectionState=vn.CLOSED})),this.websocket.on(Et.FAILED,(()=>{this._disconnectedReason=$t.NETWORK_ERROR,this.connectionState=vn.CLOSED})),this.websocket.on(Et.RECONNECTING,(t=>{this._websocketReconnectReason=t,this.joinResponse=void 0,this.connectionState===vn.CONNECTED?this.connectionState=vn.RECONNECTING:this.connectionState=vn.CONNECTING})),this.websocket.on(Et.WILL_RECONNECT,((t,n,r)=>{const i=Jg(this,ct.IS_P2P_DISCONNECTED),s=i||t!=="retry";i&&t==="retry"&&(w.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),t="tryNext",n=_T.P2P_DISCONNECTED),s&&(w.debug("".concat(this.clientId," will renewSession, reconnect mode: ").concat(t)),this.emit(ct.REPORT_JOIN_GATEWAY,n||_T.UNKNOWN_REASON,this.url||""),this.reconnectToken=void 0,this.emit(ct.DISCONNECT_P2P)),r(t)})),this.websocket.on(Et.CONNECTED,(()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch((t=>{w.warning("[".concat(this.clientId,"] rejoin failed ").concat(t)),this.reconnect("tryNext",Wr.SERVER_ERROR)})):this.join().catch((t=>{if(this.emit(ct.REPORT_JOIN_GATEWAY,t,this.url||""),t instanceof le){if(t.code===V.UNEXPECTED_RESPONSE&&t.data.code===Ze.ERR_NO_AUTHORIZED)return this.initError=new le(V.TOKEN_EXPIRE,"dynamic key expired"),void this.close($t.TOKEN_EXPIRE);w.error("[".concat(this.clientId,"] join gateway request failed"),t.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",Wr.SERVER_ERROR):(this.initError=t,this.close())}}))})),this.websocket.on(Et.REQUEST_NEW_URLS,((t,n)=>{Gr(this,ct.REQUEST_RECOVER,this.multiIpOption).then(t).catch(n)})),this.websocket.on(Et.ON_TOKEN_PRIVILEGE_DID_EXPIRE,(()=>{this.emit(Dt.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})),this.websocket.on(e2.PRE_CONNECT_PC,(()=>{this.emit(ct.PRE_CONNECT_PC)}))}}let p7=(function(e){return e.NATIVE_RTC="native_rtc",e.NATIVE_RTM="native_rtm",e.WEB_RTC="web_rtc",e.WEB_RTM="web_rtm",e})({}),Zn=(function(e){return e[e.CHOOSE_SERVER=11]="CHOOSE_SERVER",e[e.CLOUD_PROXY=18]="CLOUD_PROXY",e[e.CLOUD_PROXY_5=20]="CLOUD_PROXY_5",e[e.CLOUD_PROXY_FALLBACK=26]="CLOUD_PROXY_FALLBACK",e})({});function i2(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable}))),n.push.apply(n,r)}return n}function ET(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?i2(Object(n),!0).forEach((function(r){x(e,r,n[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i2(Object(n)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))}))}return e}function kd(e){return e.match(/^[\.\:\d]+$/)?"".concat(e.replace(/[^\d]/g,"-"),".").concat(B("TURN_DOMAIN")):(w.debug("Cannot recognized as ip address: ".concat(e,", use as host2")),e)}function vT(e){try{const t=B("GATEWAY_DOMAINS").concat(B("TURN_DOMAIN")).find((n=>be(e).call(e,n)));return t?e.split(".".concat(t))[0].replace(/-/g,"."):e}catch{return w.debug("serverUrlToIp error, fallback to url",e),e}}function cI(e,t){e.addresses||(e.addresses=[]);const n=(function(c,d){if(B("CONNECT_GATEWAY_WITHOUT_DOMAIN"))return c.map((g=>{let{ip:E,port:S}=g;return{address:"".concat(E,":").concat(S)}}));const h=B("GATEWAY_DOMAINS");let f=h[1]&&be(d).call(d,h[1])?1:0;return c.map((g=>{let{domain_prefix:E,port:S,ip:O}=g;if(E)return{address:"".concat(E,".").concat(h[f++%h.length],":").concat(S)};const A=/^[\.\:\d]+$/.test(O),N=A?"".concat(O.replace(/[^\d]/g,"-"),".").concat(h[f++%h.length],":").concat(S):"".concat(O,":").concat(S);return A||w.debug("Cannot recognized as ip address: ".concat(O,", use as host3")),{ip:O,port:S,address:N}}))})(e.addresses,t),r=Array.isArray(e.detail)&&e.detail[18];if(r&&typeof r=="string"){const c=r.split(";");for(let d=0;d<c.length;d++){var i;const h=fi(i=c[d]).call(i);n[d]&&h&&(n[d].ip6=h)}}const s=e.detail&&e.detail.candidate;let o;if(s){const[c,d]=s.split(":");c&&d&&(o={port:Number(d),ip:c,address:"".concat(c,":").concat(d)})}return{gatewayAddrs:n,apGatewayAddress:o,uid:e.uid,cid:e.cid,cert:e.cert,vid:e.detail&&e.detail[8],uni_lbs_ip:e.detail&&e.detail[1],res:e,csIp:e.detail&&e.detail[502]}}function Es(e){return typeof e=="number"?e:e.exact||e.ideal||e.max||e.min||0}function s2(e){const t=e._encoderConfig;if(!t)return{};const n={resolution:t.width&&t.height?"".concat(Es(t.width),"x").concat(Es(t.height)):void 0,maxVideoBW:t.bitrateMax,minVideoBW:t.bitrateMin};return typeof t.frameRate=="number"?(n.maxFrameRate=t.frameRate,n.minFrameRate=t.frameRate):t.frameRate&&(n.maxFrameRate=t.frameRate.max||t.frameRate.ideal||t.frameRate.exact||t.frameRate.min,n.minFrameRate=t.frameRate.min||t.frameRate.ideal||t.frameRate.exact||t.frameRate.max),n}function o2(e){return e>=0&&e<.17?1:e>=.17&&e<.36?2:e>=.36&&e<.59?3:e>=.59&&e<=1?4:e>1?5:0}function lE(e,t){let n,r,i;switch(t){case Zn.CHOOSE_SERVER:r=4096,i="choose server";break;case Zn.CLOUD_PROXY:r=1048576,i="proxy";break;case Zn.CLOUD_PROXY_5:r=4194304,i="proxy5";break;case Zn.CLOUD_PROXY_FALLBACK:r=4194310,i="proxy fallback";break;default:throw new le(V.UNEXPECTED_ERROR,"multi unlibs response transformer get unknown service id",{csIp:e.detail&&e.detail[502],retry:!1})}if(e.response_body.forEach((s=>{s.buffer&&s.buffer.flag===r&&(n={code:s.buffer.code,addresses:(s.buffer.edges_services||[]).map((o=>ET(ET({},o),{},{ticket:s.buffer.cert}))),server_ts:e.enter_ts,uid:s.buffer.uid,cid:s.buffer.cid,cname:s.buffer.cname,detail:ET(ET({},s.buffer.detail),e.detail),flag:s.buffer.flag,opid:e.opid,cert:s.buffer.cert})})),!n)throw new le(V.MULTI_UNILBS_RESPONSE_ERROR,"cannot parse response ".concat(i," from multi unilbs response"),{csIp:e.detail&&e.detail[502]});return n}async function a2(e,t){return await ke.all(e.addresses.map((async n=>({address:kd(n.ip),tcpport:n.port,udpport:n.port,username:t&&B("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?t.toString():Hr.username,password:t&&B("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?await lb(t.toString()):Hr.password}))))}function lI(e,t){const n=t.getMediaStreamTrack(!0).getSettings(),r=t.videoHeight||n.height,i=t.videoWidth||n.width;return r&&i?Math.max(Math.min(r,i)/Math.min(Es(e.height),Es(e.width)),1):(w.warning("can't get ori-track's height, default scale down 4 times for low stream"),4)}function xd(e){let{candidateType:t,relayProtocol:n,type:r,address:i,port:s,protocol:o}=e;const c={candidateType:t,relayProtocol:n,protocol:o};if(r!=="local-candidate"){const d=i.split(".");d.length>=4&&(d[1]="*",d[2]="*"),c.address=d.join("."),c.port=s}return c}function Dh(e){const t=e.split(":"),n=e.split(/[-.]/),r=be(e).call(e,"-")?"-":".";let i=e;return t.length>1?n.length>1?(n[1]="**",i=n[0]+r+"**:"+t[t.length-1]):i=t.length>2?t[0]+r+"**:"+t[t.length-1]:"**:"+t[t.length-1]:n.length>1&&(i=n[0]+r+"**"),i}function yT(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:B("SVC_MODE");if(B("ENABLE_SVC"))return(function(t){return t in qS})(e)?e:qS.L1T3}const c2={[Me.VIDEO]:[{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"},{key:"video-orientation",extensionName:"urn:3gpp:video-orientation"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"playout-delay",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/playout-delay"},{key:"video-content-type",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-content-type"},{key:"color-space",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/color-space"},{key:"video-timing",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-timing"}],[Me.AUDIO]:[{key:"ssrc-audio-level",extensionName:"urn:ietf:params:rtp-hdrext:ssrc-audio-level"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"}]};function ST(e,t,n){t.forEach((r=>{var i;const s=c2[e].find((c=>{var d;let{key:h}=c;return be(d=r.extensionName).call(d,h)}));if(!s)return;const o=n.find((c=>{let{extensionName:d}=c;return be(d).call(d,s.key)}));o&&be(i=o.extensionName).call(i,"gdpr_forbidden")&&(r.extensionName=o.extensionName)}))}function nm(e,t){t.forEach((n=>{var r;const i=c2[e].find((s=>{var o;let{key:c}=s;return be(o=n.extensionName).call(o,c)}));be(r=n.extensionName).call(r,"gdpr_forbidden")&&i&&(n.extensionName=i.extensionName)}))}function l2(e){return e==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"||be(e).call(e,"abs-send-time")}function TT(e){return e==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"||be(e).call(e,"draft-holmer-rmcat-transport-wide-cc-extensions-01")}function d2(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable}))),n.push.apply(n,r)}return n}function u2(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?d2(Object(n),!0).forEach((function(r){x(e,r,n[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):d2(Object(n)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))}))}return e}function dE(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},r=arguments.length>3?arguments[3]:void 0;const{filterRTX:i,filterVideoFec:s,filterAudioFec:o,filterAudioCodec:c,filterVideoCodec:d,unsupportedVideoUplinkCodec:h,unsupportedVideoDownlinkCodec:f}=t,{useXR:g}=n;let E=[],S=[],O=[],A=[],N=!1,j=!1;if($i(e).mediaDescriptions.forEach((W=>{r&&r!==W.attributes.direction||(W.media.mediaType!=="video"||N||(S=W.attributes.payloads,A=W.attributes.extmaps,N=!0),W.media.mediaType!=="audio"||j||(E=W.attributes.payloads,O=W.attributes.extmaps,j=!0))})),!A||S.length===0)throw new Error("Cannot get video capabilities from SDP.");if(!O||E.length===0)throw new Error("Cannot get audio capabilities from SDP.");if(S.forEach((W=>{var $;($=W.rtpMap)!==null&&$!==void 0&&$.clockRate&&(W.rtpMap.clockRate=parseInt(W.rtpMap.clockRate)),g&&W.rtcpFeedbacks.push({type:"rrtr"})})),E.forEach((W=>{var $;($=W.rtpMap)!==null&&$!==void 0&&$.clockRate&&(W.rtpMap.clockRate=parseInt(W.rtpMap.clockRate)),g&&W.rtcpFeedbacks.push({type:"rrtr"})})),i&&(E=E.filter((W=>{var $;return(($=W.rtpMap)===null||$===void 0?void 0:$.encodingName.toLowerCase())!=="rtx"})),S=S.filter((W=>{var $;return(($=W.rtpMap)===null||$===void 0?void 0:$.encodingName.toLowerCase())!=="rtx"}))),s){const W=S.filter((Y=>{var ie;return/(red)|(ulpfec)|(flexfec)/i.test(((ie=Y.rtpMap)===null||ie===void 0?void 0:ie.encodingName)||"")})),$=Md(W,S).map((Y=>Y.payloadType)),Z=[...W.map((Y=>Y.payloadType)),...$];S=S.filter((Y=>!be(Z).call(Z,Y.payloadType)))}if(o&&(E=E.filter((W=>{var $;return!/(red)|(ulpfec)|(flexfec)/i.test((($=W.rtpMap)===null||$===void 0?void 0:$.encodingName)||"")}))),c&&c?.length>0&&(E=E.filter((W=>{var $;return be(c).call(c,(($=W.rtpMap)===null||$===void 0?void 0:$.encodingName.toLowerCase())||"")}))),d&&d?.length>0){const W=S.filter(($=>{var Z;return be(d).call(d,((Z=$.rtpMap)===null||Z===void 0?void 0:Z.encodingName.toLowerCase())||"")}));S=W.concat(i?[]:Md(W,S))}const U=B("UNSUPPORTED_VIDEO_CODEC");if(U&&U.length>0){const W=S.filter((Y=>Y.rtpMap&&be(U).call(U,Y.rtpMap.encodingName.toLowerCase()))),$=Md(W,S),Z=W.concat($).map((Y=>Y.payloadType));S=S.filter((Y=>!be(Z).call(Z,Y.payloadType))),w.debug("unsupportedVideoCodec: ".concat(U,", toBeRemoved: ").concat(Z))}if(h&&h.length>0&&r==="sendonly"){const W=S.filter((Y=>Y.rtpMap&&be(h).call(h,Y.rtpMap.encodingName.toLowerCase()))),$=Md(W,S),Z=W.concat($).map((Y=>Y.payloadType));S=S.filter((Y=>!be(Z).call(Z,Y.payloadType))),w.debug("unsupportedVideoUplinkCodec: ".concat(h,", toBeRemoved: ").concat(Z))}if(f&&f.length>0&&r==="recvonly"){const W=S.filter((Y=>Y.rtpMap&&be(f).call(f,Y.rtpMap.encodingName.toLowerCase()))),$=Md(W,S),Z=W.concat($).map((Y=>Y.payloadType));S=S.filter((Y=>!be(Z).call(Z,Y.payloadType))),w.debug("unsupportedVideoDownlinkCodec: ".concat(f,", toBeRemoved: ").concat(Z))}return{audioCodecs:E,videoCodecs:S,audioExtensions:O,videoExtensions:A}}function Ld(e){const t=$i(e);let n,r;for(const i of t.mediaDescriptions){if(!n){const s=i.attributes.iceUfrag,o=i.attributes.icePwd;if(!s||!o)throw new Error("Cannot get iceUfrag or icePwd from SDP.");n={iceUfrag:s,icePwd:o}}if(!r){const s=i.attributes.fingerprints;s.length>0&&(r={fingerprints:s})}}if(!r&&t.attributes.fingerprints.length>0&&(r={fingerprints:t.attributes.fingerprints}),!r||!n)throw new Error("Cannot get iceParameters or dtlsParameters from SDP.");return{iceParameters:n,dtlsParameters:r}}function h2(e,t){const n=[],r=e.attributes.ssrcGroups.filter((o=>o.semantic==="FID")),i=e.attributes.ssrcGroups.find((o=>o.semantic==="SIM")),s=e.attributes.ssrcs;if(i)i.ssrcIds.forEach((o=>{var c;const d=(c=r.find((h=>h.ssrcIds[0]===o)))===null||c===void 0?void 0:c.ssrcIds[1];n.push({ssrcId:o,rtx:t?d:void 0})}));else if(r.length>0){const o=r[0].ssrcIds[0],c=r[0].ssrcIds[1];n.push({ssrcId:o,rtx:t?c:void 0})}else{if(s.length===0)throw new Error("No ssrcs found on local media description.");n.push({ssrcId:s[0].ssrcId})}return n}function p2(e,t,n){const{cname:r}=e;let i=[];t&&(i=f2(t)),i.length===0&&(i=e.iceParameters.candidates.map((f=>({foundation:f.foundation,componentId:"1",transport:f.protocol,priority:f.priority.toString(),connectionAddress:f.ip,port:f.port.toString(),type:f.type,extension:{}}))),w.debug("Using candidates from gateway."));const s={fingerprints:e.dtlsParameters.fingerprints.map((f=>({hashFunction:f.algorithm,fingerprint:f.fingerprint})))},o={iceUfrag:e.iceParameters.iceUfrag,icePwd:e.iceParameters.icePwd};let c;switch(e.dtlsParameters.role){case"server":c="passive";break;case"client":c="active";break;case"auto":c="actpass"}const d=wT(e.rtpCapabilities),h=[];return Array.isArray(n)&&n.length>0&&n.forEach((f=>{h.push({kind:Me.VIDEO,ssrcMsg:[{ssrcId:f.v,rtx:f.v_rtx}],mslabel:"".concat(f.v,"_").concat(f.a)},{kind:Me.AUDIO,ssrcMsg:[{ssrcId:f.a}],mslabel:"".concat(f.v,"_").concat(f.a)})})),{dtlsParameters:s,iceParameters:o,candidates:i,rtpCapabilities:d,setup:c,cname:r,preSSRCs:h}}function f2(e){let t=[];return e.ip&&typeof e.port=="number"&&(t=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:e.ip,port:e.port.toString(),type:"host",extension:{}}],w.debug("Using remote candidate from AP ".concat(Dh(e.ip),":").concat(e.port)),e.ip6&&(t.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:e.ip6,port:e.port.toString(),type:"host",extension:{}}),w.debug("Using IPV6 remote candidate from AP ".concat(Dh(e.ip6),":").concat(e.port)))),t}function uE(e,t,n){const r=[],i=[];return e.forEach((s=>{let{ssrcId:o,rtx:c}=s;const d=hn(8,"track-"),h={ssrcId:o,attributes:u2({label:d,mslabel:n=n||hn(10,""),msid:"".concat(n," ").concat(d)},t&&{cname:t})};if(r.push(h),c!==void 0){const f={ssrcId:c,attributes:u2({label:d,mslabel:n,msid:"".concat(n," ").concat(d)},t&&{cname:t})};r.push(f),i.push({semantic:"FID",ssrcIds:[o,c]})}})),e.length>1&&i.push({semantic:"SIM",ssrcIds:e.map((s=>{let{ssrcId:o}=s;return o}))}),{ssrcs:r,ssrcGroups:i}}function rm(e,t){t instanceof Wn&&e.attributes.payloads.forEach((n=>{var r;const i=(r=n.rtpMap)===null||r===void 0?void 0:r.encodingName.toLowerCase();if(!i||["opus","pcmu","pcma","g722"].indexOf(i)===-1)return;n.fmtp||(n.fmtp={parameters:{}}),i==="opus"&&typeof B("OPUS_PTIME")=="number"?n.fmtp.parameters.ptime=B("OPUS_PTIME"):n.fmtp.parameters.minptime="10",n.fmtp.parameters.useinbandfec="1";const s=t._encoderConfig;s&&(i!=="pcmu"&&i!=="pcma"&&i!=="g722"&&(s.bitrate&&!jn()&&(n.fmtp.parameters.maxaveragebitrate="".concat(Math.floor(1e3*s.bitrate))),s.sampleRate&&(n.fmtp.parameters.maxplaybackrate="".concat(s.sampleRate),n.fmtp.parameters["sprop-maxcapturerate"]="".concat(s.sampleRate)),s.stereo&&(n.fmtp.parameters.stereo="1",n.fmtp.parameters["sprop-stereo"]="1")),t instanceof rE&&i==="opus"&&t._config.DTX&&(n.fmtp.parameters.usedtx="1"))}))}function dI(e){const t=e.attributes.unrecognized.findIndex((n=>n.attField==="x-google-flag"&&n.attValue==="conference"));t!==-1&&e.attributes.unrecognized.splice(t,1)}function uI(e,t){var n;if(!(t instanceof Sn&&t._encoderConfig&&t._hints.indexOf(ln.SCREEN_TRACK)===-1))return;const r=t._encoderConfig;Bt().supportMinBitrate&&r.bitrateMin&&e.attributes.payloads.forEach((i=>{var s,o;be(s=["h264","h265","vp8","vp9","av1"]).call(s,((o=i.rtpMap)===null||o===void 0?void 0:o.encodingName.toLowerCase())||"")&&(i.fmtp||(i.fmtp={parameters:{}}),i.fmtp.parameters["x-google-min-bitrate"]="".concat(r.bitrateMin))})),Bt().supportMinBitrate&&!be(n=t._hints).call(n,ln.LOW_STREAM)&&r.bitrateMax&&e.attributes.payloads.forEach((i=>{var s,o;be(s=["h264","h265","vp8","vp9","av1"]).call(s,((o=i.rtpMap)===null||o===void 0?void 0:o.encodingName.toLowerCase())||"")&&(i.fmtp||(i.fmtp={parameters:{}}),i.fmtp.parameters["x-google-start-bitrate"]="".concat(B("X_GOOGLE_START_BITRATE")||Math.floor(r.bitrateMax)))}))}function m2(e){if(e.media.mediaType!=="video")return;const t=Mt();if(t.name!==Kt.SAFARI&&t.os!==Er.IOS)return;const n=e.attributes.extmaps.findIndex((r=>/video-orientation/g.test(r.extensionName)));n!==-1&&e.attributes.extmaps.splice(n,1)}function RT(e,t,n){if(!t)return;let r,i;if(e.media.mediaType==="video"?(r=n.videoExtensions,i=n.videoCodecs):(r=n.audioExtensions,i=n.audioCodecs),t.twcc===!0){const s=r.find((o=>TT(o.extensionName)));if(s){const o=s.extensionName;e.attributes.extmaps.find((d=>TT(d.extensionName)))||e.attributes.extmaps.push({entry:s.entry,extensionName:o}),(function(d,h){return h.filter((f=>!!d.find((g=>g.payloadType===f.payloadType&&!!g.rtcpFeedbacks.find((E=>E.type==="transport-cc"))))))})(i,e.attributes.payloads).forEach((d=>{d.rtcpFeedbacks.find((h=>h.type==="transport-cc"))||d.rtcpFeedbacks.push({type:"transport-cc"})}))}}else if(t.twcc===!1){const s=e.attributes.extmaps.findIndex((o=>TT(o.extensionName)));s!==-1&&e.attributes.extmaps.splice(s,1),e.attributes.payloads.forEach((o=>{const c=o.rtcpFeedbacks.findIndex((d=>d.type==="transport-cc"));c!==-1&&o.rtcpFeedbacks.splice(c,1)}))}if(t.remb===!0){const s=r.find((o=>l2(o.extensionName)));if(s){const o=s.extensionName;e.attributes.extmaps.find((d=>d.extensionName===o))||e.attributes.extmaps.push({entry:s.entry,extensionName:o}),(function(d,h){return h.filter((f=>!!d.find((g=>g.payloadType===f.payloadType&&!!g.rtcpFeedbacks.find((E=>E.type==="goog-remb"))))))})(i,e.attributes.payloads).forEach((d=>{d.rtcpFeedbacks.find((h=>h.type==="goog-remb"))||d.rtcpFeedbacks.push({type:"goog-remb"})}))}}else if(t.remb===!1){const s=e.attributes.extmaps.findIndex((o=>l2(o.extensionName)));s!==-1&&e.attributes.extmaps.splice(s,1),e.attributes.payloads.forEach((o=>{const c=o.rtcpFeedbacks.findIndex((d=>d.type==="goog-remb"));c!==-1&&o.rtcpFeedbacks.splice(c,1)}))}}function _2(e,t,n){if(jn()||e.media.mediaType!=="video"||!(t instanceof Sn)||n!=="vp9"&&n!=="vp8"||n==="vp8"&&!B("SIMULCAST")||n==="vp9"&&B("ENABLE_SVC")||t._scalabilityMode===void 0||t._scalabilityMode.numSpatialLayers<=1)return;const r=n==="vp8"?2:t._scalabilityMode.numSpatialLayers,i=e.attributes.ssrcs[0],s=e.attributes.ssrcGroups.find((c=>c.semantic==="FID"&&c.ssrcIds[0]===i.ssrcId)),o={semantic:"SIM",ssrcIds:[i.ssrcId]};for(let c=1;c<r;c++)e.attributes.ssrcs.push({ssrcId:i.ssrcId+c,attributes:On(i.attributes)}),o.ssrcIds.push(i.ssrcId+c),s&&(e.attributes.ssrcs.push({ssrcId:s.ssrcIds[1]+c,attributes:On(i.attributes)}),e.attributes.ssrcGroups.push({semantic:"FID",ssrcIds:[i.ssrcId+c,s.ssrcIds[1]+c]}));e.attributes.ssrcGroups.unshift(o)}async function g2(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=new RTCPeerConnection;n.addTransceiver("video",{direction:"sendonly"}),n.addTransceiver("audio",{direction:"sendonly"}),n.addTransceiver("video",{direction:"recvonly"}),n.addTransceiver("audio",{direction:"recvonly"});const r=(await n.createOffer()).sdp,{send:i,recv:s,sendrecv:o}=(function(){let c=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},h=arguments.length>2?arguments[2]:void 0;const f=dE(h,c,d,"sendonly"),g=dE(h,c,d,"recvonly"),E={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},S={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},O={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(zo(f,g,"videoExtensions",E,S,O),zo(f,g,"videoCodecs",E,S,O),zo(f,g,"audioExtensions",E,S,O),zo(f,g,"audioCodecs",E,S,O),B("RAISE_H264_BASELINE_PRIORITY")){const A=[],N=[];if(O.videoCodecs.forEach(((j,U)=>{var W;if(((W=j.rtpMap)===null||W===void 0?void 0:W.encodingName.toLocaleLowerCase())==="h264"){var $,Z;const Y=O.videoCodecs[U+1],ie=Y&&T2(j,Y),ue=($=j.fmtp)===null||$===void 0?void 0:$.parameters["profile-level-id"],ge=(Z=j.fmtp)===null||Z===void 0?void 0:Z.parameters["packetization-mode"];!ue||ue!==B("FIRST_H264_PROFILE_LEVEL_ID")||B("FIRST_PACKETIZATION_MODE")&&ge!==B("FIRST_PACKETIZATION_MODE")?ie?N.push([j,Y]):N.push([j]):ie?A.push([j,Y]):A.push([j])}})),A.length>0&&N.length>0){w.debug("raising H264 baseline profile priority"),O.videoCodecs.forEach(((U,W)=>{var $;if((($=U.rtpMap)===null||$===void 0?void 0:$.encodingName.toLocaleLowerCase())==="h264"){const Z=T2(U,O.videoCodecs[W+1]),Y=A.shift()||N.shift()||[];Y.length>0&&(Z?O.videoCodecs.splice(W,2,...Y):O.videoCodecs.splice(W,1,...Y))}}));const j=S.videoCodecs.filter((U=>{var W,$;return((W=U.rtpMap)===null||W===void 0?void 0:W.encodingName.toLocaleLowerCase())==="h264"&&(($=U.fmtp)===null||$===void 0?void 0:$.parameters["profile-level-id"])!==B("FIRST_H264_PROFILE_LEVEL_ID")}));if(j.length>0){const U=Md(j,S.videoCodecs).map(($=>$.payloadType)),W=[...j.map(($=>$.payloadType)),...U];S.videoCodecs=S.videoCodecs.filter(($=>!be(W).call(W,$.payloadType)))}B("FILTER_SEND_H264_BASELINE")&&(E.videoCodecs=E.videoCodecs.filter((U=>{var W,$;return!(((W=U.rtpMap)===null||W===void 0?void 0:W.encodingName.toLocaleLowerCase())==="h264"&&(($=U.fmtp)===null||$===void 0?void 0:$.parameters["profile-level-id"])!==B("FIRST_H264_PROFILE_LEVEL_ID"))})))}return{send:E,recv:S,sendrecv:O}}return{send:E,recv:S,sendrecv:O}})(e,t,r);try{n.close()}catch{}return{send:i,recv:s,sendrecv:o}}function E2(){const e={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},t=dE(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"recvonly"),n={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},r={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},i={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(zo(e,t,"videoExtensions",n,r,i),zo(e,t,"videoCodecs",n,r,i),zo(e,t,"audioExtensions",n,r,i),zo(e,t,"audioCodecs",n,r,i),B("RAISE_H264_BASELINE_PRIORITY")){const s=i.videoCodecs.findIndex((o=>o.rtpMap&&o.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&o.fmtp&&o.fmtp.parameters["profile-level-id"]==="42001f"));if(s!==-1){const o=i.videoCodecs.findIndex((c=>c.rtpMap&&c.rtpMap.encodingName.toLocaleLowerCase()==="h264"));if(o<s){w.debug("raising H264 baseline profile priority");const c=i.videoCodecs[s];i.videoCodecs.splice(s,1),i.videoCodecs.splice(o,0,c)}o!==-1&&(r.videoCodecs=r.videoCodecs.filter((c=>!(c.rtpMap&&c.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&c.fmtp&&c.fmtp.parameters["profile-level-id"]!=="42001f"))))}}return{send:n,recv:r,sendrecv:i}}function zo(e,t,n,r,i,s){if(n==="videoExtensions"||n==="audioExtensions"){const o=[];return e[n].forEach((c=>{t[n].some(((d,h)=>{if(c.entry===d.entry&&c.extensionName===d.extensionName)return o.push(h),!0}))?s[n].push(c):r[n].push(c)})),void t[n].forEach(((c,d)=>{o.indexOf(d)===-1&&i[n].push(c)}))}if(n==="videoCodecs"||n==="audioCodecs"){const o=[];return e[n].forEach((c=>{t[n].some(((d,h)=>{if(c.payloadType===d.payloadType&&JSON.stringify(c)===JSON.stringify(d))return o.push(h),!0}))?s[n].push(c):r[n].push(c)})),void t[n].forEach(((c,d)=>{o.indexOf(d)===-1&&i[n].push(c)}))}}function wT(e){const{send:t,recv:n,sendrecv:r}=e;if(!r){if(!t||!n)throw new Error("cannot merge rtp capabilities because one of send or recv is empty!");return{send:t,recv:n}}let i,s;return t?(i={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},i.audioCodecs=[...t.audioCodecs,...r.audioCodecs],i.videoCodecs=[...t.videoCodecs,...r.videoCodecs],i.audioExtensions=[...t.audioExtensions,...r.audioExtensions],i.videoExtensions=[...t.videoExtensions,...r.videoExtensions]):i=r,n?(s={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},s.audioCodecs=[...n.audioCodecs,...r.audioCodecs],s.videoCodecs=[...n.videoCodecs,...r.videoCodecs],s.audioExtensions=[...n.audioExtensions,...r.audioExtensions],s.videoExtensions=[...n.videoExtensions,...r.videoExtensions]):s=r,{send:i,recv:s}}function im(e){e.media.mediaType==="audio"&&e.attributes.payloads.filter((t=>{var n;return((n=t.rtpMap)===null||n===void 0?void 0:n.encodingName.toLowerCase())==="opus"})).forEach((t=>{t.fmtp||(t.fmtp={parameters:{}}),t.fmtp.parameters.stereo="1",t.fmtp.parameters["sprop-stereo"]="1"}))}function hE(e,t,n,r){let i=[];if(e===Me.VIDEO){if(B("H264_PROFILE_LEVEL_ID")&&r==="h264"&&(i=t.videoCodecs.filter((s=>{var o;return be(o=s.rtpMap&&s.rtpMap.encodingName.toLowerCase()||"").call(o,r)&&s&&s.fmtp&&s.fmtp.parameters["profile-level-id"]===B("H264_PROFILE_LEVEL_ID")}))),!Array.isArray(i)||i.length===0){let s=[];const o=[],c=[],d=[];if(n.videoCodecs.forEach((h=>{const f=h.rtpMap&&h.rtpMap.encodingName.toLowerCase()||"";be(f).call(f,r)?s.push(h):be(f).call(f,"vp9")?o.push(h):be(f).call(f,"vp8")?c.push(h):be(f).call(f,"h264")&&d.push(h)})),s.length===0){let h="";o.length!==0?(s=o,h="vp9"):c.length!==0?(s=c,h="vp8"):d.length!==0&&(s=d,h="h264"),w.warning("codec ".concat(r," not included in rtpCapabilities, fallback to default payloads: ").concat(h))}s.length!==0&&(i=t.videoCodecs.filter((h=>s.some((f=>f.payloadType===h.payloadType)))))}if(i.length===0&&(w.warning("codec ".concat(r," not included in rtpCapabilities, fallback to default payloads: ").concat(t.videoCodecs[0].rtpMap&&t.videoCodecs[0].rtpMap.encodingName)),i=t.videoCodecs),B("USE_PUB_RTX")||B("USE_SUB_RTX")){const s=Md(i,t.videoCodecs);i=[...i,...s]}}else{i=t.audioCodecs.filter((o=>{var c;return be(c=o.rtpMap&&o.rtpMap.encodingName.toLowerCase()||"").call(c,r)}));const s=t.audioCodecs.filter((o=>{var c;return be(c=o.rtpMap&&o.rtpMap.encodingName.toLowerCase()||"").call(c,"red")}));i.length===0&&(w.warning("codec ".concat(r," not included in rtpCapabilities, fallback to opus")),i=t.audioCodecs.filter((o=>{var c;return be(c=o.rtpMap&&o.rtpMap.encodingName.toLowerCase()||"").call(c,"opus")}))),B("ENABLE_AUDIO_RED")&&s.length!==0&&(i=[...s,...i])}return i}function Md(e,t){const n=e.map((r=>r.payloadType.toString()));return t.filter((r=>r.rtpMap&&r.rtpMap.encodingName==="rtx"&&r.fmtp&&r.fmtp.parameters.apt&&be(n).call(n,r.fmtp&&r.fmtp.parameters.apt)))}async function Ud(e,t,n){const r=t.toString(),i=y2(r,"offer","remote","exchangeSDP");await e.setRemoteDescription({type:"offer",sdp:r});const s=await e.createAnswer();if(!s.sdp)throw new Error("cannot get answer sdp");let o=s.sdp;o=v2(o,n||{}),i?.(o||""),await e.setLocalDescription({type:"answer",sdp:o})}function v2(e,t,n){const r=$i(e),{useXR:i}=t;return r.mediaDescriptions.forEach((s=>{var o;s.attributes.mid&&(Array.isArray(n)&&!be(n).call(n,s.attributes.mid)||(s.media.mediaType==="audio"&&im(s),i&&be(o=["audio","video"]).call(o,s.media.mediaType)&&s.attributes.payloads.forEach((c=>{c.rtcpFeedbacks.findIndex((d=>d.type==="rrtr"))===-1&&c.rtcpFeedbacks.push({type:"rrtr"})}))))})),Nd(r)}function y2(e,t,n,r){if(B("SDP_LOGGING"))return w.upload("exchanging ".concat(n," ").concat(t," SDP during P2PConnection.").concat(r,`
`),e),t==="offer"?i=>{y2(i,"answer",n==="local"?"remote":"local",r)}:void 0}function S2(e){const t=B("COMPATIBLE_SDP_EXTENSION");return!!(Array.isArray(t)&&t.length>0)&&t.some((n=>be(e).call(e,n)))}function T2(e,t){try{var n;return((n=e.fmtp)===null||n===void 0?void 0:n.parameters.apt)===t.payloadType.toString()}catch{return!1}}function R2(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable}))),n.push.apply(n,r)}return n}function Us(e,t){return typeof B(e)===t?B(e):void 0}function f7(){try{const e=B("EXPERIMENTS")||{};return typeof e=="string"||Array.isArray(e)?{}:(function(t){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?R2(Object(r),!0).forEach((function(i){x(t,i,r[i])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):R2(Object(r)).forEach((function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(r,i))}))}return t})({},e)}catch(e){return w.debug("handle gateway attributes failed: ",e),{}}}const w2={};function jd(e){(!(arguments.length>1&&arguments[1]!==void 0)||arguments[1])&&w.debug("install service ".concat(e.name)),w2[e.name]=e}function wl(e){const t=w2[e];if(!t)throw new de(V.INVALID_OPERATION,"".concat(e," not found, please use AgoraRTC.use(").concat(e,"Service) to load it first"));return t}function C2(e,t){return wl("DataStream").create(e,t)}function CT(){return wl("InterceptFrame").create()}function b2(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable}))),n.push.apply(n,r)}return n}function si(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?b2(Object(n),!0).forEach((function(r){x(e,r,n[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):b2(Object(n)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))}))}return e}const hI=new Map;class m7 extends xn{get state(){return this._state}set state(t){if(t===this._state)return;const n=this._state;this._state=t,t==="DISCONNECTED"&&this._disconnectedReason?this.emit(wr.CONNECTION_STATE_CHANGE,t,n,this._disconnectedReason):this.emit(wr.CONNECTION_STATE_CHANGE,t,n)}get joinGatewayStartTime(){return this._joinGatewayStartTime}set joinGatewayStartTime(t){w.debug("[".concat(this.store.clientId,"] set joinGatewayStartTime at ").concat(t)),this._joinGatewayStartTime=t}constructor(t,n){var r,i,s;super(),x(this,"store",void 0),x(this,"joinInfo",void 0),x(this,"key",void 0),x(this,"ntpOffset",0),x(this,"signal",void 0),x(this,"role",void 0),x(this,"isPreallocation",void 0),x(this,"isPreSub",void 0),x(this,"inChannelInfo",{joinAt:null,duration:0}),x(this,"spec",void 0),x(this,"_state","DISCONNECTED"),x(this,"_statsCollector",void 0),x(this,"_disconnectedReason",void 0),x(this,"isSignalRecover",!1),x(this,"hasChangeBGPAddress",!1),x(this,"trafficStatsInterval",void 0),x(this,"networkQualityInterval",void 0),x(this,"_joinGatewayStartTime",0),x(this,"_signalTimeout",!1),x(this,"_clientRoleOptions",void 0),x(this,"_isProactiveJoin",!1),this.store=t,this.spec=n,this.signal=this.store.useP2P?(r={spec:si(si({},n),{},{retryConfig:n.websocketRetryConfig}),store:t},(i=(s=wl("P2PChannel")).createSubmodule)===null||i===void 0?void 0:i.call(s,r)):new h7(si(si({},n),{},{retryConfig:n.websocketRetryConfig}),t),this._statsCollector=n.statsCollector,this.role=n.role||"audience",this._clientRoleOptions=n.clientRoleOptions,this.handleSignalEvents()}async join(t,n,r){this.store.joinGatewayStart(),t.cloudProxyServer!=="disabled"&&(this.hasChangeBGPAddress=!0);const i=Date.now();let s=hI.get(t.cname);if(s||(s=new Map,hI.set(t.cname,s)),this._isProactiveJoin=!0,s.has(t.uid)){const h=new le(V.UID_CONFLICT);throw We.joinGateway(t.sid,{lts:i,succ:!1,ec:h.code,addr:null,uid:t.uid,cid:t.cid,firstSuccess:this._isProactiveJoin,isProxy:!!t.proxyServer,signalChannel:"0",preload:t.preload}),h}s.set(t.uid,!0),this.joinInfo=t,this.key=n;let o=0;this.joinGatewayStartTime=i;const c=t.proxyServer;try{w.debug("[".concat(this.store.clientId,"] use websocket join uid ").concat(o));const h=t.gatewayAddrs.map((f=>{let{address:g}=f;const[E,S]=g.split(":"),O={host:E,port:S};return t.proxyServer&&(O.proxy=t.proxyServer),O}));o=(await this.signal.init(h)).uid,w.debug("[".concat(this.store.clientId,"] websocket join uid ").concat(o," cost ").concat(Date.now()-this.joinGatewayStartTime))}catch(h){var d;throw w.error("[".concat(this.store.clientId,"] User join failed"),h.toString()),We.joinGateway(t.sid,{lts:i,succ:!1,ec:((d=h.data)===null||d===void 0?void 0:d.desc)||h.code,errorMsg:h.message,addr:this.signal.url,uid:t.uid,cid:t.cid,firstSuccess:this._isProactiveJoin,isProxy:!!c,signalChannel:"0",preload:t.preload}),s.delete(t.uid),this.signal.close(),h}return this.state="CONNECTED",this.inChannelInfo.joinAt=Date.now(),w.debug("[".concat(this.store.clientId,"] Connected to gateway server")),this.trafficStatsInterval=window.setInterval((()=>{this.updateTrafficStats().catch((h=>{w.warning("[".concat(this.store.clientId,"] get traffic stats error"),h.toString())}))}),3e3),this.networkQualityInterval=window.setInterval((()=>{navigator&&navigator.onLine!==void 0&&!navigator.onLine?this.emit(wr.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6}):this._signalTimeout?this.emit(wr.NETWORK_QUALITY,{downlinkNetworkQuality:5,uplinkNetworkQuality:5}):this.state==="CONNECTED"&&this._statsCollector.trafficStats?this.emit(wr.NETWORK_QUALITY,{uplinkNetworkQuality:o2(this._statsCollector.trafficStats.B_unq),downlinkNetworkQuality:o2(this._statsCollector.trafficStats.B_dnq)}):this.emit(wr.NETWORK_QUALITY,{uplinkNetworkQuality:0,downlinkNetworkQuality:0})}),2e3),this.store.joinGatewayEnd(),o}async leave(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0],n=arguments.length>1?arguments[1]:void 0;if(this.state!=="DISCONNECTED"){n!==$t.FALLBACK&&(this.state="DISCONNECTING");try{t||this.signal.connectionState!==vn.CONNECTED||await(function(r,i){return i===1/0?r:ke.race([r,FY(i)])})(this.signal.request(ot.LEAVE,void 0,!0),3e3)}catch(r){w.warning("[".concat(this.store.clientId,"] leave request failed, ignore"),r)}this.signal.close(n),n!==$t.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}}async publish(t,n,r){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new le(V.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const i={state:"offer",p2p_id:this.store.p2pId,ortc:n,mode:this.spec.mode,extend:B("PUB_EXTEND"),twcc:!!B("PUBLISH_TWCC"),rtx:!!B("USE_PUB_RTX")};try{return(await this.signal.request(ot.PUBLISH,i,!0))._message}catch(s){if(r&&s.data&&s.data.code===Ze.ERR_PUBLISH_REQUEST_INVALID)return w.warning("[".concat(this.store.clientId,"] receive publish error code, retry"),s.toString()),await this.tryUnpubBeforeRepub(t,n),this.publish(t,n,!1);throw s}}async publishDataChannel(t,n,r){var i;if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new le(V.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const s={stream_id:n.streamId,ordered:n.ordered?1:0,max_retrans_times:(i=n.maxRetransmits)!==null&&i!==void 0?i:10,channel_id:n.channelId,metadata:n.metadata};try{await this.signal.request(ot.PUBLISH_DATASTREAM,s,!0)}catch(o){if(r&&o.data&&o.data.code===Ze.ERR_PUBLISH_REQUEST_INVALID)return w.warning("[".concat(this.store.clientId,"] receive publish datachannels error code, retry"),o.toString()),await this.tryUnpubDataChannelBeforeRepub(t,n),this.publishDataChannel(t,n,!1);throw o}}async unpublish(t,n){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new le(V.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await this.signal.request(ot.UNPUBLISH,{stream_id:n,ortc:t},!0)}catch(r){w.warning("[".concat(this.store.clientId,"] unpublish warning: "),r)}}async unpublishDataChannel(t){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new le(V.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await ke.all(t.map((n=>this.signal.request(ot.UNPUBLISH_DATASTREAM,{channel_id:n},!0))))}catch(n){w.warning("unpublish datachannels warning: ",n)}}async presubscribe(t,n,r){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new le(V.INVALID_OPERATION,"can not presubscribe when connection state is ".concat(this.state));const i={stream_id:t,stream_type:n,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!B("SUBSCRIBE_TWCC"),rtx:!!B("USE_SUB_RTX")||void 0,extend:B("SUB_EXTEND"),svc:Array.isArray(B("SVC"))&&B("SVC").length!==0?B("SVC"):void 0};try{return await this.signal.request(ot.PRE_SUBSCRIBE,i,!0)}catch(s){if(r&&s.data&&s.data.code===Ze.ERR_SUBSCRIBE_REQUEST_INVALID)return w.warning("[".concat(this.store.clientId,"] pre-subscribe error, retry"),s.toString()),this.presubscribe(t,n,!1);throw s}}async subscribe(t,n,r){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new le(V.INVALID_OPERATION,"can not subscribe when connection state is ".concat(this.state));const i={stream_id:t,stream_type:n.stream_type,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!B("SUBSCRIBE_TWCC"),rtx:!!B("USE_SUB_RTX"),extend:B("SUB_EXTEND"),ssrcId:n.ssrcId,svc:Array.isArray(B("SVC"))&&B("SVC").length!==0?B("SVC"):void 0};try{return(await this.signal.request(ot.SUBSCRIBE,i,!0))._message}catch(s){if(r&&s.data&&s.data.code===Ze.ERR_SUBSCRIBE_REQUEST_INVALID)return w.warning("[".concat(this.store.clientId,"] receiver subscribe error code, retry"),s.toString()),await this.tryUnsubBeforeResub(t,n),await this.subscribe(t,n,!1);throw s}}async subscribeDataChannel(t,n,r){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new le(V.INVALID_OPERATION,"can not subscribe datachannel when connection state is ".concat(this.state));const i={uid:t,stream_id:n.id,channel_id:n.datachannelId};try{return void await this.signal.request(ot.SUBSCRIBE_DATASTREAM,i,!0)}catch(s){if(r&&s.data&&s.data.code===Ze.ERR_SUBSCRIBE_REQUEST_INVALID)return w.warning("[".concat(this.store.clientId,"] receiver subscribe datachannel error code, retry"),s.toString()),await this.tryUnsubDataChannelBeforeResub(t,n),await this.subscribeDataChannel(t,n,!1);throw s}}async subscribeAll(t,n){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new le(V.INVALID_OPERATION,"can not massSubscribe when connection state is ".concat(this.state));const r={p2p_id:this.store.p2pId,users:t,dtx:!1,rtx:!!B("USE_SUB_RTX"),twcc:!!B("SUBSCRIBE_TWCC"),svc:Array.isArray(B("SVC"))&&B("SVC").length!==0?B("SVC"):void 0};try{return await this.signal.request(ot.SUBSCRIBE_STREAMS,r,!0)}catch(i){if(n&&i.data&&i.data.code===Ze.ERR_SUBSCRIBE_REQUEST_INVALID)return w.warning("[".concat(this.store.clientId,"] receiver massSubscribe error code, retry"),i.toString()),await this.tryMassUnsubBeforeResub(t),await this.subscribeAll(t,!1);throw i}}async setVideoProfile(t){const n=(function(r){if(!(r.bitrateMax&&r.bitrateMin&&r.frameRate&&r.height&&r.width))return;let i=r.frameRate,s=r.width,o=r.height,c=!0;return typeof i!="number"&&(i=i.exact||i.ideal||i.max||i.min||0,i||(c=!1)),typeof s!="number"&&(s=s.exact||s.ideal||s.max||s.min||0,s||(c=!1)),typeof o!="number"&&(o=o.exact||o.ideal||o.max||o.min||0,i||(c=!1)),c?{stream_type:0,width:s,height:o,fps:i,start_bps:1e3*r.bitrateMax,min_bps:1e3*r.bitrateMin,target_bps:1e3*r.bitrateMax}:void 0})(t);if(n)return this.signal.request(ot.SET_VIDEO_PROFILE,n);w.debug("[".concat(this.store.clientId,"] encoder config is not complete, do not report to gateway"))}async unsubscribe(t,n){try{await this.signal.request(ot.UNSUBSCRIBE,{p2p_id:this.store.p2pId,ortc:t,stream_id:n},!0)}catch(r){w.warning("[".concat(this.store.clientId,"] unsubscribe warning: "),r)}}async unsubscribeDataChannel(t,n){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new le(V.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await ke.all(t.map((r=>this.signal.request(ot.UNSUBSCRIBE_DATASTREAM,{stream_id:r,uid:n},!0))))}catch(r){w.warning("unsubscribeDataChannel warning: ",r)}}async massUnsubscribe(t){try{await this.signal.request(ot.UNSUBSCRIBE_STREAMS,t,!0)}catch(n){w.warning("[".concat(this.store.clientId,"] massUnsubscribeAll warning: "),n)}}async reconnectPC(t){const{iceParameters:n,dtlsParameters:r,rtpCapabilities:i}=t;return{gatewayEstablishParams:await this.signal.request(ot.CONNECT_PC,{p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:{iceParameters:n,dtlsParameters:r,rtpCapabilities:i}},!0),gatewayAddress:this.getCurrentGatewayAddress()}}getGatewayInfo(){return this.signal.request(ot.GATEWAY_INFO)}async renewToken(t){await this.signal.request(ot.RENEW_TOKEN,t),this.key=t.token}updateClientRole(t,n){n&&(this._clientRoleOptions=Object.assign({},n)),B("CLIENT_ROLE_OPTIONS")&&(w.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(B("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," ")),this._clientRoleOptions=Object.assign({},B("CLIENT_ROLE_OPTIONS"))),this.role=t}async setClientRole(t,n){if(n&&(this._clientRoleOptions=Object.assign({},n)),B("CLIENT_ROLE_OPTIONS")&&(this._clientRoleOptions=Object.assign({},B("CLIENT_ROLE_OPTIONS")),w.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(B("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," "))),this.state!=="CONNECTED")return void(this.role=t);let r,i=0;t==="audience"?this._clientRoleOptions&&this._clientRoleOptions.delay?(r=this._clientRoleOptions.delay,i=1):i=this._clientRoleOptions&&this._clientRoleOptions.level?this._clientRoleOptions.level:2:i=0;const s=Object.assign({},n);delete s.delay,delete s.level,await this.signal.request(ot.SET_CLIENT_ROLE,si(si({role:t,level:i,delay:r},s),{},{client_ts:Date.now()})),this.role=t}async setRemoteVideoStreamType(t,n){await this.signal.request(ot.SWITCH_VIDEO_STREAM,{stream_id:t,stream_type:n})}async setDefaultRemoteVideoStreamType(t){await this.signal.request(ot.DEFAULT_VIDEO_STREAM,{stream_type:t})}async setStreamFallbackOption(t,n){await this.signal.request(ot.SET_FALLBACK_OPTION,{stream_id:t,fallback_type:n})}async pickSVCLayer(t,n){await this.signal.request(ot.PICK_SVC_LAYER,{stream_id:t,spatial_layer:n.spatialLayer,temporal_layer:n.temporalLayer})}async setRTM2Flag(t){await this.signal.request(ot.SET_RTM2_FLAG,{rtm2_flag:t})}async sendExtensionMessage(t,n,r){if(this.store.useP2P)return this.signal.sendExtensionMessage(t,n,r)}getInChannelInfo(){return this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt),si({},this.inChannelInfo)}async getGatewayVersion(){return(await this.signal.request(ot.GATEWAY_INFO)).version}reset(){if(this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt,this.inChannelInfo.joinAt=null),this.trafficStatsInterval&&(window.clearInterval(this.trafficStatsInterval),this.trafficStatsInterval=void 0),this.joinInfo){const t=hI.get(this.joinInfo.cname);t&&t.delete(this.joinInfo.uid)}this.joinInfo=void 0,this.key=void 0,this.networkQualityInterval&&(window.clearInterval(this.networkQualityInterval),this.networkQualityInterval=void 0)}updateTurnConfigFromSignal(){if(!this.joinInfo)return;const t=(function(n){let r;return r=n.startsWith("dc")?n.match(/(dc\:\/\/)?([^:]+):(\d+)/):n.match(/(wss\:\/\/)?([^:]+):(\d+)/),r?{username:Hr.username,password:Hr.password,turnServerURL:r[2],tcpport:parseInt(r[3])+30,udpport:parseInt(r[3])+30,forceturn:!1}:null})((this.joinInfo.cloudProxyServer==="disabled"?this.signal.url:this.joinInfo.gatewayAddrs[this.signal.currentURLIndex].address)||"");this.joinInfo.turnServer.serversFromGateway=[],t&&this.joinInfo.turnServer.mode!=="off"&&this.joinInfo.cloudProxyServer==="disabled"&&this.joinInfo.turnServer.serversFromGateway.push(si(si({},Hr),{},{turnServerURL:t.turnServerURL,tcpport:t.tcpport,udpport:t.udpport,username:this.joinInfo.uid.toString(),password:this.joinInfo.token}))}async updateTrafficStats(){if(this.state!=="CONNECTED")return;const t=await this.signal.request(ot.TRAFFIC_STATS,void 0,!0);t.timestamp=Date.now(),t.ntp_offset!=null&&(this.ntpOffset=t.ntp_offset),t.peer_delay.forEach((n=>{const r=this._statsCollector.trafficStats&&this._statsCollector.trafficStats.peer_delay.find((i=>i.peer_uid===n.peer_uid));r&&r.B_st!==n.B_st&&HS((()=>{this.emit(wr.STREAM_TYPE_CHANGE,n.peer_uid,n.B_st)}))})),this._statsCollector.updateTrafficStats(t)}getJoinMessage(t){var n,r;if(!this.joinInfo||!this.key)throw new le(V.UNEXPECTED_ERROR,"can not generate join message, no join info");const i=Object.assign({},this.joinInfo.apResponse);let s=B("REPORT_APP_SCENARIO");if(typeof s!="string")try{s=JSON.stringify(s)}catch{s=void 0}var o;s&&s.length>128&&(s=void 0),this.store.hasStartJoinChannel=!0,this.store.isABTestSuccess||this.emit(wr.UPDATE_GATEWAY_CONFIG),o=this.store.clientId,be(Qf).call(Qf,o)||Qf.push(o);const c=Ib(this.store),d=!((n=this.isPreallocation)===null||n===void 0||!n.call(this)),h=N1(this.store),f=f7(),g=Df(87)||jx()||tb(117),E=((function(){const O=Mt();if(O.name!==Kt.SAFARI||!O.browserVersion)return!1;const A=O.browserVersion.split(".");return Number(A[0])>18||Number(A[0])===18&&Number(A[1])>=4})()||Wx(18,4,!1))&&nb(18,6,!0)&&this.spec.codec==="h264"&&B("ENABLE_ABSSENDTIME_AS_SENTTS"),S=si({license:this.joinInfo.license,p2p_id:this.store.p2pId,session_id:this.joinInfo.sid,app_id:this.joinInfo.appId,channel_key:this.key,channel_name:this.joinInfo.cname,sdk_version:ro,browser:navigator.userAgent,process_id:B("PROCESS_ID"),mode:this.store.useP2P?"p2p":this.spec.mode,codec:this.spec.codec,role:this.role,has_changed_gateway:this.hasChangeBGPAddress,ap_response:i,extend:B("JOIN_EXTEND"),details:{6:this.joinInfo.stringUid,cservice_map:this.joinInfo.cloudProxyServer==="proxy3"?"1":this.joinInfo.cloudProxyServer==="proxy5"?"2":void 0},features:{rejoin:!0},optionalInfo:this.joinInfo.optionalInfo,appScenario:s,attributes:{userAttributes:si(si({enableEncodedTransform:(!!B("ENABLE_AUDIO_METADATA")||!!B("ENABLE_AUDIO_PTS"))&&g||!!B("ENABLE_AUDIO_TOPN")&&$0(Kt.CHROME,87,116)||void 0,enableAudioMetadata:!!B("ENABLE_AUDIO_METADATA")&&g,enableAudioPts:!!B("ENABLE_AUDIO_PTS")&&g,topnSmoothLevel:B("TOPN_SMOOTH_LEVEL"),topnNewSpeakerDelay:B("TOPN_NEW_SPEAKER_DELAY"),topnSwitchHoldMs:B("TOPN_SWITCH_HOLD_MS"),topnAudioGain:B("TOPN_AUDIO_GAIN"),enablePublishedUserList:B("ENABLE_PUBLISHED_USER_LIST"),maxSubscription:B("MAX_SUBSCRIPTION"),subscribeAudioFilterTopN:Us("SUBSCRIBE_AUDIO_FILTER_TOPN","number"),enablePublishAudioFilter:Us("ENABLE_PUBLISH_AUDIO_FILTER","boolean"),enableUserLicenseCheck:Us("ENABLE_USER_LICENSE_CHECK","boolean"),enableRTX:B("USE_PUB_RTX")===!0||B("USE_SUB_RTX")===!0||void 0,disableFEC:B("DISABLE_FEC"),enableNTPReport:!!B("ENABLE_NTP_REPORT")||void 0,enableInstantVideo:h,enableFulllinkAvSync:!!B("ENABLE_FULL_LINK_AV_SYNC")||void 0,enableDataStream2:Us("ENABLE_DATASTREAM_2","boolean"),enableAutFeedback:!!B("FORCE_ENABLE_AUT_CC")||!QS()&&(!!B("ENABLE_AUT_FEEDBACK")||void 0),rtm2Flag:typeof this.joinInfo.rtmFlag=="number"?this.joinInfo.rtmFlag:void 0,enableUserAutoRebalanceCheck:!!B("ENABLE_USER_AUTO_REBALANCE_CHECK"),enableXR:Us("USE_XR","boolean"),enableLossbasedBwe:Us("ENABLE_LOSSBASED_BWE","boolean"),enableAutCC:!!B("FORCE_ENABLE_AUT_CC")||!QS()&&(!!B("ENABLE_AUT_CC")||void 0),enableCCFallback:Us("ENABLE_CC_FALLBACK","boolean"),enablePreallocPC:d,preSubNum:c?Us("PRE_SUB_NUM","number"):void 0,enablePubTWCC:Us("PUBLISH_TWCC","boolean"),enableSubTWCC:Us("SUBSCRIBE_TWCC","boolean"),enablePubRTX:Us("USE_PUB_RTX","boolean"),enableSubRTX:Us("USE_SUB_RTX","boolean"),enableSubSVC:B("ENABLE_SVC")?B("ENABLE_SVC_DEFAULT_CODECS"):Array.isArray(B("SVC"))&&B("SVC").length!==0?B("SVC"):void 0,enableSvcExtended:B("ENABLE_SVC")&&Array.isArray(B("SVC_EXTENDED"))&&B("SVC_EXTENDED").length!==0?B("SVC_EXTENDED"):void 0},f),{},{audioDuplicate:Us("ENABLE_AUDIO_RED","boolean")?(r=Us("AUDIO_DUPLICATE_NUM","number"))!==null&&r!==void 0?r:2:void 0,senttsUsesAbsSendTime:!!E||void 0})},join_ts:this.joinGatewayStartTime},t);return this.joinInfo.stringUid&&(S.string_uid=this.joinInfo.stringUid),this.joinInfo.aesmode&&this.joinInfo.aespassword&&(S.aes_mode=this.joinInfo.aesmode,B("ENCRYPT_AES")?(S.aes_secret=this.joinInfo.aespassword,S.aes_encrypt=!0):S.aes_secret=this.joinInfo.aespassword,this.joinInfo.aessalt&&(S.aes_salt=this.joinInfo.aessalt)),i.addresses[this.signal.websocket.currentURLIndex]&&(S.ap_response.ticket=i.addresses[this.signal.websocket.currentURLIndex].ticket,delete i.addresses),this.joinInfo.defaultVideoStream!==void 0&&(S.default_video_stream=this.joinInfo.defaultVideoStream),S}getRejoinMessage(){if(!this.joinInfo)throw new le(V.UNEXPECTED_ERROR,"can not generate rejoin message, no join info");return{session_id:this.joinInfo.sid,channel_name:this.joinInfo.cname,cid:this.joinInfo.cid,uid:this.joinInfo.uid,vid:Number(this.joinInfo.vid)}}handleSignalEvents(){this.signal.on(ct.WS_RECONNECT_CREATE_CONNECTION,(t=>{this.joinGatewayStartTime=Date.now()})),this.signal.on(ct.WS_RECONNECTING,(t=>{this.joinInfo&&We.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:t||Wr.NETWORK_ERROR}),this.joinInfo&&(this.state="RECONNECTING",We.sessionInit(this.joinInfo.sid,{lts:new Date().getTime(),extend:this.isSignalRecover?{recover:!0}:{rejoin:!0},cname:this.joinInfo.cname,appid:this.joinInfo.appId,mode:this.spec.mode,stringUid:this.joinInfo.stringUid,channelProfile:this.spec.mode==="live"?1:0,channelMode:0,lsid:this.joinInfo.sid,clientRole:this.role==="audience"?2:1,buildFormat:1}),this.isSignalRecover=!1,this.joinGatewayStartTime=Date.now())})),this.signal.on(ct.WS_CLOSED,(t=>{let n;switch(t){case $t.LEAVE:n=Wr.LEAVE;break;case $t.UID_BANNED:case $t.IP_BANNED:case $t.CHANNEL_BANNED:case $t.SERVER_ERROR:n=Wr.SERVER_ERROR;break;case $t.FALLBACK:n=Wr.FALLBACK;break;case $t.LICENSE_MISSING:case $t.LICENSE_EXPIRED:case $t.LICENSE_MINUTES_EXCEEDED:case $t.LICENSE_PERIOD_INVALID:case $t.LICENSE_MULTIPLE_SDK_SERVICE:case $t.LICENSE_ILLEGAL:case $t.TOKEN_EXPIRE:n=t;break;default:n=Wr.NETWORK_ERROR}w.debug("[".concat(this.store.clientId,"] [signal] websocket closed, reason: ").concat(n||"undefined -> "+Wr.NETWORK_ERROR)),this.joinInfo&&We.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:t===$t.LEAVE?1:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:n}),this._disconnectedReason=t,t!==$t.FALLBACK&&(this.state="DISCONNECTED"),this.reset()})),this.signal.on(ct.WS_CONNECTED,(()=>{if(this.updateTurnConfigFromSignal(),this.state="CONNECTED",this.joinInfo){if(this.role==="audience"){const t=B("CLIENT_ROLE_OPTIONS")||this._clientRoleOptions;t&&(t.level||t.delay)&&(w.debug("[".concat(this.store.clientId,"] patch to send set client role, role: ").concat(this.role,", mode: ").concat(this.spec.mode,", level: ").concat(t.level,", delay: ").concat(t.delay)),this.setClientRole(this.role,t))}if(We.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!0,ec:null,vid:this.joinInfo.vid,addr:this.signal.url,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload,isABTestSuccess:this.store.isABTestSuccess}),this._isProactiveJoin=!1,this.joinInfo.useLocalAccessPoint&&this.joinInfo.setLocalAPVersion===1){const t=this.signal.url&&this.signal.url.match(/wss\:\/\/([^:]+):(\d+)/);if(!t)return void w.error("[".concat(this.store.clientId,"] set local access point after joined failed: ").concat(t));sn("EVENT_REPORT_DOMAIN",t[1]),sn("EVENT_REPORT_BACKUP_DOMAIN",t[1]),sn("LOG_UPLOAD_SERVER","".concat(t[1],":6444"))}}})),this.signal.on(Dt.ON_UPLINK_STATS,(t=>{this._statsCollector.updateUplinkStats(t)})),this.signal.on(ct.REQUEST_RECOVER,((t,n,r)=>{if(!this.joinInfo)return r(new le(V.UNEXPECTED_ERROR,"gateway: can not recover, no join info"));t&&(this.joinInfo.multiIP=t,this.hasChangeBGPAddress=!0),this.isSignalRecover=!0,Gr(this,wr.REQUEST_NEW_GATEWAY_LIST).then(n).catch(r)})),this.signal.on(ct.REQUEST_JOIN_INFO,(async(t,n,r)=>{var i,s,o;if(this.updateTurnConfigFromSignal(),this.store.useP2P)return void t(this.getJoinMessage({ortc:{}}));const c=On((i=this.joinInfo)===null||i===void 0?void 0:i.turnServer);if(B("NEW_TURN_MODE")&&c&&((s=this.joinInfo)===null||s===void 0?void 0:s.cloudProxyServer)==="disabled"){var d;let E=c.servers.map((A=>"turnServerURL"in A&&B("USE_TURN_IP")?si(si({},A),{},{turnServerURL:vT(A.turnServerURL)}):A)),S=(d=c.serversFromGateway)===null||d===void 0?void 0:d.map((A=>B("USE_TURN_IP")?si(si({},A),{},{turnServerURL:vT(A.turnServerURL)}):A));const O=this.signal.currentURLIndex;E.length>0&&(E=[E[O%E.length]],c.servers=E),Array.isArray(S)&&S.length>0&&(S=[S[0]],c.serversFromGateway=S),w.debug("[".concat(this.store.clientId,"] use single turn, use turn server index: ").concat(O))}const{iceParameters:h,dtlsParameters:f,rtpCapabilities:g}=await Gr(this,wr.REQUEST_P2P_CONNECTION_PARAMS,{turnServer:c,cloudProxyServer:(o=this.joinInfo)===null||o===void 0?void 0:o.cloudProxyServer});try{t(this.getJoinMessage({ortc:{iceParameters:h,dtlsParameters:f,rtpCapabilities:g,version:"2"}}))}catch(E){n(E)}})),this.signal.on(ct.REQUEST_REJOIN_INFO,(t=>{t(this.getRejoinMessage())})),this.signal.on(ct.REPORT_JOIN_GATEWAY,((t,n)=>{if(!this.joinInfo)return;let r,i="";var s;t instanceof le?(r=((s=t.data)===null||s===void 0?void 0:s.desc)||t.code,i=t.message):r=t,We.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!1,ec:r,errorMsg:i,addr:n,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload})})),this.signal.on(ct.IS_P2P_DISCONNECTED,(t=>{t(Jg(this,wr.IS_P2P_DISCONNECTED))})),this.signal.on(ct.DISCONNECT_P2P,(()=>{this.emit(wr.DISCONNECT_P2P)})),this.signal.on(ct.REQUEST_SUCCESS,(()=>{this._signalTimeout=!1})),this.signal.on(ct.REQUEST_TIMEOUT,(()=>{this._signalTimeout=!0})),this.signal.on(ct.JOIN_RESPONSE,(t=>{const n=this.getCurrentGatewayAddress();this.emit(wr.JOIN_RESPONSE,t,n)})),this.signal.on(ct.PRE_CONNECT_PC,(async()=>{if(this.joinInfo){var t,n;this.updateTurnConfigFromSignal();const i=this.getCurrentGatewayAddress(),s=On((t=this.joinInfo)===null||t===void 0?void 0:t.turnServer);if(B("NEW_TURN_MODE")&&s&&((n=this.joinInfo)===null||n===void 0?void 0:n.cloudProxyServer)==="disabled"){var r;let c=s.servers.map((f=>"turnServerURL"in f&&B("USE_TURN_IP")?si(si({},f),{},{turnServerURL:vT(f.turnServerURL)}):f)),d=(r=s.serversFromGateway)===null||r===void 0?void 0:r.map((f=>B("USE_TURN_IP")?si(si({},f),{},{turnServerURL:vT(f.turnServerURL)}):f));const h=this.signal.currentURLIndex;c.length>0&&(c=[c[h%c.length]],s.servers=c),Array.isArray(d)&&d.length>0&&(d=[d[0]],s.serversFromGateway=d),w.debug("[".concat(this.store.clientId,"] use single turn, use turn server index: ").concat(h,",in pre pc"))}const o=B("FINGERPRINT")||this.joinInfo.apResponse.addresses[this.signal.currentURLIndex].fingerprint;if(i&&o){const c=f2(i);this.emit(wr.PRE_CONNECT_PC,{candidates:c,fingerprint:o,turnServer:s})}}})),this.signal.on(ct.RECOVER_NOTIFICATION,(t=>{this.joinInfo&&typeof B("AP_REQUEST_DETAIL")=="string"&&(this.joinInfo.apRequestDetail="".concat(B("AP_REQUEST_DETAIL"),";").concat(t))}))}async tryUnsubBeforeResub(t,n){try{await this.signal.request(ot.UNSUBSCRIBE,{p2p_id:this.store.p2pId,stream_id:t,ortc:[n]},!0)}catch(r){throw w.warning("[".concat(this.store.clientId,"] tryUnsubBeforeResub warning"),r),r}}async tryUnsubDataChannelBeforeResub(t,n){try{await this.signal.request(ot.UNSUBSCRIBE,{stream_id:n.id},!0)}catch(r){throw w.warning("unsubscribe datachannel warning",r),r}}async tryUnpubBeforeRepub(t,n){try{await this.signal.request(ot.UNPUBLISH,{stream_id:t,ortc:n},!0)}catch(r){throw w.warning("[".concat(this.store.clientId,"] tryUnpubBeforeRepub warning: "),r),r}}async tryUnpubDataChannelBeforeRepub(t,n){try{await this.signal.request(ot.UNPUBLISH_DATASTREAM,{channnel_id:n.channelId},!0)}catch(r){throw w.warning("unpublish datastream warning: ",r),r}}async tryMassUnsubBeforeResub(t){const n={users:t.map((r=>({stream_id:r.stream_id,stream_type:r.stream_type})))};try{await this.signal.request(ot.UNSUBSCRIBE_STREAMS,n,!0)}catch(r){throw w.warning("[".concat(this.store.clientId,"] tryMassUnsubBeforeResub warning"),r),r}}async muteLocal(t,n){const r={action:t.find((i=>i.stream_type===tn.Audio))?"mute_local_audio":"mute_local_video",p2p_id:this.store.p2pId,ortc:t,stream_id:n};try{await this.signal.request(ot.CONTROL,r,!0,!0)}catch(i){throw w.warning("[".concat(this.store.clientId,"] gateway muteLocal warning: "),i),i}}async unmuteLocal(t,n){const r={action:t.find((i=>i.stream_type===tn.Audio))?"unmute_local_audio":"unmute_local_video",p2p_id:this.store.p2pId,ortc:t,stream_id:n};try{await this.signal.request(ot.CONTROL,r,!0,!0)}catch(i){throw w.warning("[".concat(this.store.clientId,"] gateway unmuteLocal warning: "),i),i}}async muteRemote(t,n){const r={action:t===Me.AUDIO?"mute_remote_audio":"mute_remote_video",p2p_id:this.store.p2pId,stream_id:n};try{await this.signal.request(ot.CONTROL,r,!0,!0)}catch(i){throw w.warning("[".concat(this.store.clientId,"] gateway muteRemote warning: "),i),i}}async unmuteRemote(t,n){const r={action:t===Me.AUDIO?"unmute_remote_audio":"unmute_remote_video",p2p_id:this.store.p2pId,stream_id:n};try{await this.signal.request(ot.CONTROL,r,!0,!0)}catch(i){throw w.warning("[".concat(this.store.clientId,"] gateway unmuteRemote warning: "),i),i}}uploadWRTCStats(t){this.signal.uploadWRTCStats(t)}upload(t,n){this.signal.upload(t,n)}getSignalRTT(){return this.signal.rtt}async restartICE(t){const n={p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:t};try{return await this.signal.request(ot.RESTART_ICE,n,!0)}catch(r){throw w.warning("[".concat(this.store.clientId,"] P2PChannel.restartICE warning: "),r),r}}reconnect(t,n){this.state==="CONNECTED"&&this.signal.reconnect(t||void 0,n||Wr.P2P_FAILED)}getCurrentGatewayAddress(){var t,n;if(!B("GATEWAY_WSS_ADDRESS"))return B("USE_CANDIDATE_FROM_AP_DETAIL")&&(t=this.joinInfo)!==null&&t!==void 0&&t.apGatewayAddress?(w.debug("[".concat(this.store.clientId,"] use candidate from ap detail, ").concat(JSON.stringify(this.joinInfo.apGatewayAddress))),this.joinInfo.apGatewayAddress):(n=this.joinInfo)!==null&&n!==void 0&&n.gatewayAddrs?this.joinInfo.gatewayAddrs[this.signal.currentURLIndex]:void 0}async setPublishAudioFilterEnabled(t){await this.signal.request(ot.SET_PARAMETER,{enablePublishAudioFilter:t})}downgradeCodec(t){this.signal.downgradeCodec(t)}}let bT=0,pI=0;function Oa(e,t,n,r){return new ke(((i,s)=>{t.timeout=t.timeout||B("HTTP_CONNECT_TIMEOUT"),t.responseType=t.responseType||"json",t.data&&!n?(t.data=JSON.stringify(t.data),bT+=wc(t.data)):n&&(t.data.size?bT+=t.data.size:t.data instanceof FormData?bT+=i1(t.data):bT+=wc(JSON.stringify(t.data))),t.headers=t.headers||{},t.headers["Content-Type"]=t.headers["Content-Type"]||"application/json",t.method="POST",t.url=e,ji.request(t).then((o=>{typeof o.data=="string"?pI+=wc(o.data):o.data instanceof ArrayBuffer||o.data instanceof Uint8Array?pI+=o.data.byteLength:pI+=wc(JSON.stringify(o.data)),r&&i({data:o.data,headers:o.headers}),i(o.data)})).catch((o=>{ji.isCancel(o)?s(new le(V.OPERATION_ABORTED,"cancel token canceled")):o.code==="ECONNABORTED"?s(new le(V.NETWORK_TIMEOUT,o.message)):o.response?s(new le(V.NETWORK_RESPONSE_ERROR,o.response.status)):s(new le(V.NETWORK_ERROR,o.message))}))}))}/*! formdata-polyfill. MIT License. Jimmy W?rting <https://jimmy.warting.se/opensource> */(function(){var e;function t(_e){var Ae=0;return function(){return Ae<_e.length?{done:!1,value:_e[Ae++]}:{done:!0}}}var n=typeof Object.defineProperties=="function"?Object.defineProperty:function(_e,Ae,je){return _e==Array.prototype||_e==Object.prototype||(_e[Ae]=je.value),_e},r,i=(function(_e){_e=[typeof globalThis=="object"&&globalThis,_e,typeof window=="object"&&window,typeof self=="object"&&self,typeof y=="object"&&y];for(var Ae=0;Ae<_e.length;++Ae){var je=_e[Ae];if(je&&je.Math==Math)return je}throw Error("Cannot find global object")})(this);function s(_e,Ae){if(Ae)e:{var je=i;_e=_e.split(".");for(var Ee=0;Ee<_e.length-1;Ee++){var b=_e[Ee];if(!(b in je))break e;je=je[b]}(Ae=Ae(Ee=je[_e=_e[_e.length-1]]))!=Ee&&Ae!=null&&n(je,_e,{configurable:!0,writable:!0,value:Ae})}}function o(_e){return(_e={next:_e})[Symbol.iterator]=function(){return this},_e}function c(_e){var Ae=typeof Symbol<"u"&&Symbol.iterator&&_e[Symbol.iterator];return Ae?Ae.call(_e):{next:t(_e)}}if(s("Symbol",(function(_e){function Ae(b,z){this.A=b,n(this,"description",{configurable:!0,writable:!0,value:z})}if(_e)return _e;Ae.prototype.toString=function(){return this.A};var je="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",Ee=0;return function b(z){if(this instanceof b)throw new TypeError("Symbol is not a constructor");return new Ae(je+(z||"")+"_"+Ee++,z)}})),s("Symbol.iterator",(function(_e){if(_e)return _e;_e=Symbol("Symbol.iterator");for(var Ae="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),je=0;je<Ae.length;je++){var Ee=i[Ae[je]];typeof Ee=="function"&&typeof Ee.prototype[_e]!="function"&&n(Ee.prototype,_e,{configurable:!0,writable:!0,value:function(){return o(t(this))}})}return _e})),typeof Object.setPrototypeOf=="function")r=Object.setPrototypeOf;else{var d;e:{var h={};try{h.__proto__={a:!0},d=h.a;break e}catch{}d=!1}r=d?function(_e,Ae){if(_e.__proto__=Ae,_e.__proto__!==Ae)throw new TypeError(_e+" is not extensible");return _e}:null}var f=r;function g(){this.m=!1,this.j=null,this.v=void 0,this.h=1,this.u=this.C=0,this.l=null}function E(_e){if(_e.m)throw new TypeError("Generator is already running");_e.m=!0}function S(_e,Ae){return _e.h=3,{value:Ae}}function O(_e){this.g=new g,this.G=_e}function A(_e,Ae,je,Ee){try{var b=Ae.call(_e.g.j,je);if(!(b instanceof Object))throw new TypeError("Iterator result "+b+" is not an object");if(!b.done)return _e.g.m=!1,b;var z=b.value}catch(Q){return _e.g.j=null,_e.g.s(Q),N(_e)}return _e.g.j=null,Ee.call(_e.g,z),N(_e)}function N(_e){for(;_e.g.h;)try{var Ae=_e.G(_e.g);if(Ae)return _e.g.m=!1,{value:Ae.value,done:!1}}catch(je){_e.g.v=void 0,_e.g.s(je)}if(_e.g.m=!1,_e.g.l){if(Ae=_e.g.l,_e.g.l=null,Ae.F)throw Ae.D;return{value:Ae.return,done:!0}}return{value:void 0,done:!0}}function j(_e){this.next=function(Ae){return _e.o(Ae)},this.throw=function(Ae){return _e.s(Ae)},this.return=function(Ae){return(function(je,Ee){E(je.g);var b=je.g.j;return b?A(je,"return"in b?b.return:function(z){return{value:z,done:!0}},Ee,je.g.return):(je.g.return(Ee),N(je))})(_e,Ae)},this[Symbol.iterator]=function(){return this}}function U(_e,Ae){return Ae=new j(new O(Ae)),f&&_e.prototype&&f(Ae,_e.prototype),Ae}if(g.prototype.o=function(_e){this.v=_e},g.prototype.s=function(_e){this.l={D:_e,F:!0},this.h=this.C||this.u},g.prototype.return=function(_e){this.l={return:_e},this.h=this.u},O.prototype.o=function(_e){return E(this.g),this.g.j?A(this,this.g.j.next,_e,this.g.o):(this.g.o(_e),N(this))},O.prototype.s=function(_e){return E(this.g),this.g.j?A(this,this.g.j.throw,_e,this.g.o):(this.g.s(_e),N(this))},s("Array.prototype.entries",(function(_e){return _e||function(){return(function(Ae,je){Ae instanceof String&&(Ae+="");var Ee=0,b=!1,z={next:function(){if(!b&&Ee<Ae.length){var Q=Ee++;return{value:je(Q,Ae[Q]),done:!1}}return b=!0,{done:!0,value:void 0}}};return z[Symbol.iterator]=function(){return z},z})(this,(function(Ae,je){return[Ae,je]}))}})),typeof Blob<"u"&&(typeof FormData>"u"||!FormData.prototype.keys)){var W=function(_e,Ae){for(var je=0;je<_e.length;je++)Ae(_e[je])},$=function(_e){return _e.replace(/\r?\n|\r/g,`\r
`)},Z=function(_e,Ae,je){return Ae instanceof Blob?(je=je!==void 0?je+"":typeof Ae.name=="string"?Ae.name:"blob",Ae.name===je&&Object.prototype.toString.call(Ae)!=="[object Blob]"||(Ae=new File([Ae],je)),[String(_e),Ae]):[String(_e),String(Ae)]},Y=function(_e,Ae){if(_e.length<Ae)throw new TypeError(Ae+" argument required, but only "+_e.length+" present.")},ie=typeof globalThis=="object"?globalThis:typeof window=="object"?window:typeof self=="object"?self:this,ue=ie.FormData,ge=ie.XMLHttpRequest&&ie.XMLHttpRequest.prototype.send,Re=ie.Request&&ie.fetch,St=ie.navigator&&ie.navigator.sendBeacon,Ct=ie.Element&&ie.Element.prototype,at=ie.Symbol&&Symbol.toStringTag;at&&(Blob.prototype[at]||(Blob.prototype[at]="Blob"),"File"in ie&&!File.prototype[at]&&(File.prototype[at]="File"));try{new File([],"")}catch{ie.File=function(Ae,je,Ee){return Ae=new Blob(Ae,Ee||{}),Object.defineProperties(Ae,{name:{value:je},lastModified:{value:+(Ee&&Ee.lastModified!==void 0?new Date(Ee.lastModified):new Date)},toString:{value:function(){return"[object File]"}}}),at&&Object.defineProperty(Ae,at,{value:"File"}),Ae}}var Qt=function(_e){return _e.replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22")},qt=function(_e){this.i=[];var Ae=this;_e&&W(_e.elements,(function(je){if(je.name&&!je.disabled&&je.type!=="submit"&&je.type!=="button"&&!je.matches("form fieldset[disabled] *"))if(je.type==="file"){var Ee=je.files&&je.files.length?je.files:[new File([],"",{type:"application/octet-stream"})];W(Ee,(function(b){Ae.append(je.name,b)}))}else je.type==="select-multiple"||je.type==="select-one"?W(je.options,(function(b){!b.disabled&&b.selected&&Ae.append(je.name,b.value)})):je.type==="checkbox"||je.type==="radio"?je.checked&&Ae.append(je.name,je.value):(Ee=je.type==="textarea"?$(je.value):je.value,Ae.append(je.name,Ee))}))};if((e=qt.prototype).append=function(_e,Ae,je){Y(arguments,2),this.i.push(Z(_e,Ae,je))},e.delete=function(_e){Y(arguments,1);var Ae=[];_e=String(_e),W(this.i,(function(je){je[0]!==_e&&Ae.push(je)})),this.i=Ae},e.entries=function _e(){var Ae,je=this;return U(_e,(function(Ee){if(Ee.h==1&&(Ae=0),Ee.h!=3)return Ae<je.i.length?Ee=S(Ee,je.i[Ae]):(Ee.h=0,Ee=void 0),Ee;Ae++,Ee.h=2}))},e.forEach=function(_e,Ae){Y(arguments,1);for(var je=c(this),Ee=je.next();!Ee.done;Ee=je.next()){var b=c(Ee.value);Ee=b.next().value,b=b.next().value,_e.call(Ae,b,Ee,this)}},e.get=function(_e){Y(arguments,1);var Ae=this.i;_e=String(_e);for(var je=0;je<Ae.length;je++)if(Ae[je][0]===_e)return Ae[je][1];return null},e.getAll=function(_e){Y(arguments,1);var Ae=[];return _e=String(_e),W(this.i,(function(je){je[0]===_e&&Ae.push(je[1])})),Ae},e.has=function(_e){Y(arguments,1),_e=String(_e);for(var Ae=0;Ae<this.i.length;Ae++)if(this.i[Ae][0]===_e)return!0;return!1},e.keys=function _e(){var Ae,je,Ee,b,z=this;return U(_e,(function(Q){if(Q.h==1&&(Ae=c(z),je=Ae.next()),Q.h!=3)return je.done?void(Q.h=0):(Ee=je.value,b=c(Ee),S(Q,b.next().value));je=Ae.next(),Q.h=2}))},e.set=function(_e,Ae,je){Y(arguments,2),_e=String(_e);var Ee=[],b=Z(_e,Ae,je),z=!0;W(this.i,(function(Q){Q[0]===_e?z&&(z=!Ee.push(b)):Ee.push(Q)})),z&&Ee.push(b),this.i=Ee},e.values=function _e(){var Ae,je,Ee,b,z=this;return U(_e,(function(Q){if(Q.h==1&&(Ae=c(z),je=Ae.next()),Q.h!=3)return je.done?void(Q.h=0):(Ee=je.value,(b=c(Ee)).next(),S(Q,b.next().value));je=Ae.next(),Q.h=2}))},qt.prototype._asNative=function(){for(var _e=new ue,Ae=c(this),je=Ae.next();!je.done;je=Ae.next()){var Ee=c(je.value);je=Ee.next().value,Ee=Ee.next().value,_e.append(je,Ee)}return _e},qt.prototype._blob=function(){var _e="----formdata-polyfill-"+Math.random(),Ae=[],je="--"+_e+`\r
Content-Disposition: form-data; name="`;return this.forEach((function(Ee,b){return typeof Ee=="string"?Ae.push(je+Qt($(b))+`"\r
\r
`+$(Ee)+`\r
`):Ae.push(je+Qt($(b))+'"; filename="'+Qt(Ee.name)+`"\r
Content-Type: `+(Ee.type||"application/octet-stream")+`\r
\r
`,Ee,`\r
`)})),Ae.push("--"+_e+"--"),new Blob(Ae,{type:"multipart/form-data; boundary="+_e})},qt.prototype[Symbol.iterator]=function(){return this.entries()},qt.prototype.toString=function(){return"[object FormData]"},Ct&&!Ct.matches&&(Ct.matches=Ct.matchesSelector||Ct.mozMatchesSelector||Ct.msMatchesSelector||Ct.oMatchesSelector||Ct.webkitMatchesSelector||function(_e){for(var Ae=(_e=(this.document||this.ownerDocument).querySelectorAll(_e)).length;0<=--Ae&&_e.item(Ae)!==this;);return-1<Ae}),at&&(qt.prototype[at]="FormData"),ge){var ti=ie.XMLHttpRequest.prototype.setRequestHeader;ie.XMLHttpRequest.prototype.setRequestHeader=function(_e,Ae){ti.call(this,_e,Ae),_e.toLowerCase()==="content-type"&&(this.B=!0)},ie.XMLHttpRequest.prototype.send=function(_e){_e instanceof qt?(_e=_e._blob(),this.B||this.setRequestHeader("Content-Type",_e.type),ge.call(this,_e)):ge.call(this,_e)}}Re&&(ie.fetch=function(_e,Ae){return Ae&&Ae.body&&Ae.body instanceof qt&&(Ae.body=Ae.body._blob()),Re.call(this,_e,Ae)}),St&&(ie.navigator.sendBeacon=function(_e,Ae){return Ae instanceof qt&&(Ae=Ae._asNative()),St.call(this,_e,Ae)}),ie.FormData=qt}})();const pE=()=>{const e=B("AREAS");return e.length===0&&e.push(Jt.GLOBAL),Yi(e).call(e,((t,n,r)=>{const i=I2(n);return i?r===0?i:"".concat(t,",").concat(i):t}),"")},I2=e=>e===Jt.OVERSEA?"".concat(Zr.ASIA,",").concat(Zr.EUROPE,",").concat(Zr.AFRICA,",").concat(Zr.NORTH_AMERICA,",").concat(Zr.SOUTH_AMERICA,",").concat(Zr.OCEANIA):Zr[e],_7=e=>{const t={CODE:"",WEBCS_DOMAIN:[],WEBCS_DOMAIN_BACKUP_LIST:[],PROXY_CS:[],CDS_AP:[],ACCOUNT_REGISTER:[],UAP_AP:[],EVENT_REPORT_DOMAIN:[],EVENT_REPORT_BACKUP_DOMAIN:[],LOG_UPLOAD_SERVER:[],PROXY_SERVER_TYPE3:[]};return e.map((n=>{const r=gT[n],i=Object.keys(r);i&&i.map((s=>{s!=="CODE"&&(t[s]=t[s].concat(r[s]))}))})),t},IT={GLOBAL:{ASIA:[Jt.CHINA,Jt.JAPAN,Jt.INDIA,Jt.KOREA,Jt.HKMC],EUROPE:[],NORTH_AMERICA:[Jt.US],SOUTH_AMERICA:[],OCEANIA:[],AFRICA:[]}},AT=Object.keys(IT[Jt.GLOBAL]),fI=[Jt.CHINA,Jt.NORTH_AMERICA,Jt.EUROPE,Jt.ASIA,Jt.JAPAN,Jt.INDIA,Jt.OCEANIA,Jt.SOUTH_AMERICA,Jt.AFRICA,Jt.KOREA,Jt.HKMC,Jt.US],g7=function(e,t){let n=[];if(be(e).call(e,Jt.GLOBAL)){const s=[Jt.GLOBAL,Jt.OVERSEA],o=Object.keys(gT);if(t===Jt.GLOBAL)throw new le(V.INVALID_PARAMS,"GLOBAL is an invalid excludedArea value");if(t===Jt.CHINA)n=[Jt.OVERSEA];else if(i=t,be(AT).call(AT,i)){const c=(r=t,IT[Jt.GLOBAL][r]||[]),d=[...s,t,...c];n=o.filter((h=>!be(d).call(d,h)))}else if((function(c){let d=!1;return AT.forEach((h=>{var f;be(f=IT[Jt.GLOBAL][h]).call(f,c)&&(d=!0)})),d})(t)){const c=(function(h){let f;return AT.forEach((g=>{var E;be(E=IT[Jt.GLOBAL][g]).call(E,h)&&(f=g)})),f})(t),d=[...s,c,t];n=o.filter((h=>!be(d).call(d,h)))}else n=e;n=(function(c){const d=[];return fI.forEach((h=>{be(c).call(c,h)&&d.push(h)})),d.concat(c.filter((h=>!be(fI).call(fI,h))))})(n)}else n=e;var r,i;return n};function A2(e){var t,n;if(!e&&be(t=B("AREAS")).call(t,Jt.EXTENSIONS))return w.debug("update area from ap : reset"),void mI(C9,!0);if(!be(n=B("AREAS")).call(n,Jt.GLOBAL)||!e)return;let r=gT.EXTENSIONS;r&&(r={CODE:I2(Jt.EXTENSIONS),WEBCS_DOMAIN:["ap-web-1-".concat(e,".agora.io")],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-".concat(e,".ap.sd-rtn.com")],PROXY_CS:["proxy-ap-web-".concat(e,".agora.io")],CDS_AP:["cds-ap-web-1-".concat(e,".agora.io"),"cds-ap-web-2-".concat(e,".ap.sd-rtn.com")],ACCOUNT_REGISTER:["sua-ap-web-1-".concat(e,".agora.io"),"sua-ap-web-2-".concat(e,".ap.sd-rtn.com")],UAP_AP:["uap-ap-web-1-".concat(e,".agora.io"),"uap-ap-web-2-".concat(e,".ap.sd-rtn.com")],EVENT_REPORT_DOMAIN:["statscollector-1-".concat(e,".agora.io")],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-".concat(e,".agora.io")],LOG_UPLOAD_SERVER:["logservice-".concat(e,".agora.io")],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy-".concat(e,".agora.io")]},w.debug("update area from ap success: ".concat(e,",config is "),r),sn("AREAS",[Jt.EXTENSIONS],!0),Object.keys(r).map((i=>{i==="LOG_UPLOAD_SERVER"||i==="EVENT_REPORT_DOMAIN"||i==="EVENT_REPORT_BACKUP_DOMAIN"||i==="PROXY_SERVER_TYPE3"?sn(i,r[i][0]):sn(i,r[i])})))}function mI(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const n=We.reportApiInvoke(null,{name:Gn.SET_AREA,options:e,tag:Nn.TRACER});try{let r=[];if(typeof e=="string"&&(r=[e]),Array.isArray(e)&&(e.forEach((s=>{if(!be(XM).call(XM,s))throw new le(V.INVALID_PARAMS,"invalid area code")})),r=e),Object.prototype.toString.call(e)==="[object Object]"){const{areaCode:s,excludedArea:o}=e;if(!s)throw new le(V.INVALID_PARAMS,"area code is needed");let c=s;typeof s=="string"&&(c=[s]),r=o?g7(c,o):c}if(!t){if(ba.AREAS){const s=new le(V.PROHIBITED_OPERATION,"setArea is prohibited because of config-distribute");return n.onError(s),void w.warning("setArea is prohibited because of config-distribute")}if(be(r).call(r,Jt.GLOBAL)&&B("AREAS")===Jt.EXTENSIONS){const s=new le(V.PROHIBITED_OPERATION,"setArea is prohibited because of ap extensions");return n.onError(s),void w.warning("setArea is prohibited because of ap extensions")}}sn("AREAS",r,t);const i=_7(r);Object.keys(i).map((s=>{s==="LOG_UPLOAD_SERVER"||s==="EVENT_REPORT_DOMAIN"||s==="EVENT_REPORT_BACKUP_DOMAIN"||s==="PROXY_SERVER_TYPE3"?sn(s,i[s][0]):sn(s,i[s])})),w.debug("set area success:",r.join(","))}catch(r){throw n.onError(r),r}n.onSuccess()}function N2(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable}))),n.push.apply(n,r)}return n}function Oc(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?N2(Object(n),!0).forEach((function(r){x(e,r,n[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):N2(Object(n)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))}))}return e}let _I=1;function E7(e,t,n,r,i){_I+=1;const s={sid:n.sid,command:"convergeAllocateEdge",uid:"666",appId:n.appId,ts:Math.floor(Date.now()/1e3),seq:_I,requestId:_I,version:ro,cname:n.cname},o={service_name:t,json_body:JSON.stringify(s)};let c,d,h=e[0];return Ca((async()=>{c=Date.now();const f=await Oa(h,{data:o,cancelToken:r,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"}});if(d=Date.now()-c,f.code!==0){const S=new le(V.UNEXPECTED_RESPONSE,"live streaming ap error, code"+f.code,{retry:!0,responseTime:d});throw w.error(S.toString()),S}const g=JSON.parse(f.json_body);if(g.code!==200){const S=new le(V.UNEXPECTED_RESPONSE,"live streaming app center error, code: ".concat(g.code,", reason: ").concat(g.reason),{code:g.code,responseTime:d});throw w.error(S.toString()),S}if(!g.servers||g.servers.length===0){const S=new le(V.UNEXPECTED_RESPONSE,"live streaming app center empty server",{code:g.code,responseTime:d});throw w.error(S.toString()),S}const E=(function(S,O){return{addressList:S.servers.map((A=>"wss://".concat(A.address.replace(/\./g,"-"),".").concat(B("WORKER_DOMAIN"),":").concat(A.wss,"?serviceName=").concat(encodeURIComponent(O)))),workerToken:S.workerToken,vid:S.vid}})(g,t);return B("LIVE_STREAMING_ADDRESS")&&(E.addressList=B("LIVE_STREAMING_ADDRESS")instanceof Array?B("LIVE_STREAMING_ADDRESS"):[B("LIVE_STREAMING_ADDRESS")]),Oc(Oc({},E),{},{responseTime:d})}),((f,g)=>(We.apworkerEvent(n.sid,{success:!0,sc:200,serviceName:t,responseDetail:JSON.stringify(f.addressList),firstSuccess:g===0,responseTime:d,serverIp:e[g%e.length]}),!1)),((f,g)=>(We.apworkerEvent(n.sid,{success:!1,sc:f.data&&f.data.code||200,serviceName:t,responseTime:d,serverIp:e[g%e.length]}),!!(f.code!==V.OPERATION_ABORTED&&f.code!==V.UNEXPECTED_RESPONSE||f.data&&f.data.retry)&&(h=e[(g+1)%e.length],!0))),i)}let gI=1;function O2(e,t,n,r){let{url:i,areaCode:s}=e;const{clientId:o,sid:c}=t,d=Date.now();let h;const f=t.role,[g,E]=vI(t,s,[Zn.CHOOSE_SERVER]);let S=Qn.networkState;return Ca((async()=>{S&&Qn.networkState===gs.OFFLINE&&Qn.onlineWaiter&&await ke.race([Qn.onlineWaiter,xr(r&&r.maxRetryTimeout||rr.maxRetryTimeout)]),S=Qn.networkState;const{data:O,headers:A}=await Oa(i,{data:g,cancelToken:n,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);h=A.http3==="1"?1:-1,We.reportResourceTiming(i,c),D2(O,i,t,d,[Zn.CHOOSE_SERVER],h);const N=lE(O,Zn.CHOOSE_SERVER);return EI(N),cI(N,i)}),(O=>(O&&We.joinChooseServer(c,{role:f,lts:d,succ:!0,csAddr:i,opid:E,serverList:O.gatewayAddrs.map((A=>A.address)),ec:null,cid:O.cid.toString(),uid:O.uid.toString(),csIp:O.csIp,unilbsServerIds:[Zn.CHOOSE_SERVER].toString(),isHttp3:h,corssRegionTagReq:t.apRequestDetail,corssRegionTagRes:O.res.detail&&O.res.detail[38]}),!1)),(O=>O.code!==V.OPERATION_ABORTED&&(O.code===V.CAN_NOT_GET_GATEWAY_SERVER?O.data.retry:(We.joinChooseServer(c,{role:f,lts:d,succ:!1,csAddr:i,serverList:null,opid:E,ec:O.code,csIp:O.data&&O.data.csIp,unilbsServerIds:[Zn.CHOOSE_SERVER].toString(),extend:JSON.stringify({networkState:S}),isHttp3:h,corssRegionTagReq:t.apRequestDetail}),w.warning("[".concat(o||"sid-".concat(c.slice(0,6)),"] Choose server network error, retry"),O),!0))),r)}function P2(e,t,n,r){let i,{url:s,areaCode:o,serviceIds:c}=e;const d=Date.now(),h=t.role,[f,g]=vI(t,o,c);let E;return Ca((async()=>{E&&Qn.networkState===gs.OFFLINE&&Qn.onlineWaiter&&await ke.race([Qn.onlineWaiter,xr(r&&r.maxRetryTimeout||rr.maxRetryTimeout)]),E=Qn.networkState;const{data:S,headers:O}=await Oa(s,{data:f,cancelToken:n,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);i=O.http3==="1"?1:-1,We.reportResourceTiming(s,t.sid),D2(S,s,t,d,c,i);const A=lE(S,Zn.CHOOSE_SERVER),N=lE(S,t.cloudProxyServer==="proxy5"?Zn.CLOUD_PROXY_5:t.cloudProxyServer==="proxy3"||t.cloudProxyServer==="proxy4"?Zn.CLOUD_PROXY:Zn.CLOUD_PROXY_FALLBACK),j=performance.getEntriesByName(s),U=j[j.length-1];let W;return U&&(W={name:U.name,protocol:"nextHopProtocol"in U?U.nextHopProtocol:"",dnscost:"domainLookupEnd"in U&&"domainLookupStart"in U&&typeof U.domainLookupEnd=="number"&&typeof U.domainLookupStart=="number"?U.domainLookupEnd-U.domainLookupStart:-1,tcpTlsCost:"connectEnd"in U&&"connectStart"in U&&typeof U.connectEnd=="number"&&typeof U.connectStart=="number"?U.connectEnd-U.connectStart:-1,reqCost:"requestStart"in U&&typeof U.requestStart=="number"&&"responseEnd"in U&&typeof U.responseEnd=="number"?U.responseEnd-U.requestStart:-1,handleCost:"leave_ts"in S&&"enter_ts"in S&&typeof S.leave_ts=="number"&&typeof S.enter_ts=="number"?S.leave_ts-S.enter_ts:-1}),EI(A),{gatewayInfo:cI(A,s),proxyInfo:N,url:s,resourceTimingInfo:W}}),(S=>(S.gatewayInfo&&We.joinChooseServer(t.sid,{role:h,lts:d,succ:!0,csAddr:s,serverList:S.gatewayInfo.gatewayAddrs.map((O=>O.address)),ec:null,opid:g,cid:S.gatewayInfo.cid.toString(),uid:S.gatewayInfo.uid.toString(),csIp:S.gatewayInfo.csIp,unilbsServerIds:c.toString(),isHttp3:i,corssRegionTagReq:t.apRequestDetail,corssRegionTagRes:S.gatewayInfo.res.detail&&S.gatewayInfo.res.detail[38],resourceTimingInfo:S.resourceTimingInfo?JSON.stringify(S.resourceTimingInfo):void 0}),S.proxyInfo&&We.joinWebProxyAP(t.sid,{lts:d,sucess:1,apServerAddr:s,turnServerAddrList:S.proxyInfo.addresses.map((O=>O.ip)).join(","),errorCode:null,eventType:t.cloudProxyServer,unilbsServerIds:c.toString()}),!1)),(S=>S.code!==V.OPERATION_ABORTED&&(S.code===V.CAN_NOT_GET_GATEWAY_SERVER?S.data.retry:(We.joinWebProxyAP(t.sid,{lts:d,sucess:0,apServerAddr:s,turnServerAddrList:null,errorCode:S.code,eventType:t.cloudProxyServer,unilbsServerIds:c.toString(),extend:JSON.stringify({networkState:E})}),w.warning("[".concat(t.clientId,"] multi unilbs network error, retry"),S),!0))),r)}const D2=(e,t,n,r,i,s)=>{const{sid:o,clientId:c,cloudProxyServer:d}=n,h=[],f=g=>{g.flag===4096?We.joinChooseServer(o,{role:n.role,lts:r,succ:!1,csAddr:t,opid:e.opid,serverList:null,ec:g.error.message,csIp:g.error.data&&g.error.data.csIp,unilbsServerIds:i.toString(),isHttp3:s,corssRegionTagReq:n.apRequestDetail}):g.flag!==1048576&&g.flag!==4194304&&g.flag!==4194310||We.joinWebProxyAP(o,{lts:r,sucess:0,apServerAddr:t,turnServerAddrList:null,errorCode:g.error.code,eventType:d,unilbsServerIds:i.toString()})};if(e.response_body.forEach((g=>{const E=g.buffer.code;if(g.uri===23&&E===0&&!g.buffer.edges_services)if(g.buffer.flag===4194310)w.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers"),g.buffer.edges_services=[];else{const S={error:new le(V.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:e.detail[502]}),flag:g.buffer.flag};h.push(S),f(S)}if(E!==0){const S=tm(E),O={error:new le(V.CAN_NOT_GET_GATEWAY_SERVER,S.desc,{desc:S.desc,retry:S.retry,csIp:e.detail[502]}),flag:g.buffer.flag};g.buffer.flag===4194310?w.warning(O.error.toString()):h.push(O),f(O)}})),h.length)throw w.warning("[".concat(c||"sid-".concat(o.slice(0,6)),"] multi unilbs ").concat(t," failed, ").concat(h.map((g=>"flag: ".concat(g.flag,", message: ").concat(g.error.message,", retry: ").concat(g.error.data.retry))).join(" | "))),new le(V.CAN_NOT_GET_GATEWAY_SERVER,h.map((g=>"flag: ".concat(g.flag,", message: ").concat(g.error.message))).join(" | "),{retry:!!h.find((g=>g.error.data.retry)),csIp:e.detail[502],desc:[...new Set(h.map((g=>{var E;return g==null||(E=g.error)===null||E===void 0||(E=E.data)===null||E===void 0?void 0:E.desc})).filter((g=>!!g)))]})},EI=e=>{var t,n,r,i;if(e.addresses&&e.addresses.length===0&&e.code===0)throw new le(V.CAN_NOT_GET_GATEWAY_SERVER,"void gateway address",{retry:!0,csIp:e.detail&&e.detail[502]});if(B("AP_AREA")&&((r=e.detail)!==null&&r!==void 0&&r[23]&&typeof((i=e.detail)===null||i===void 0?void 0:i[23])=="string"?A2(e.detail[23].toLowerCase()):A2()),(t=e.detail)!==null&&t!==void 0&&t[19]&&typeof((n=e.detail)===null||n===void 0?void 0:n[19])=="string"){const o=e.detail[19],c=o?.split(";");for(let d=0;d<c.length;d++){var s;const h=fi(s=c[d]).call(s);e.addresses[d]&&c&&(e.addresses[d].fingerprint=h)}}if(B("GATEWAY_ADDRESS")&&B("GATEWAY_ADDRESS").length>0){w.debug("assign gateway address to",B("GATEWAY_ADDRESS"));const o=B("GATEWAY_ADDRESS").map((c=>{var d,h;const f=(d=(h=e.addresses.find((g=>g.ip===c.ip&&g.port===c.port)))===null||h===void 0?void 0:h.fingerprint)!==null&&d!==void 0?d:"";return{ip:c.ip,port:c.port,ticket:e.addresses[0]&&e.addresses[0].ticket,fingerprint:f}}));e.addresses=o}},v7=(e,t)=>{if(e.response_body&&e.response_body.length){const n=e.response_body[0];if(n.buffer.code!==0){const r=tm(n.buffer.code);throw new le(V.UPDATE_TICKET_FAILED,"[".concat(n.buffer.code,"]: ").concat(r.desc),{retry:r.retry})}return n.buffer.ticket}throw w.debug("update ticket request received ap response without response body:",t),new le(V.UPDATE_TICKET_FAILED,"cannot find response body from ap response",{retry:!1})},vI=(e,t,n)=>{const r=Math.floor(Math.random()*1e12),i=e.role==="host"?"1":e.role==="audience"?"2":void 0,s={appid:e.appId,client_ts:Date.now(),opid:r,sid:e.sid,request_bodies:[{uri:22,buffer:{cname:e.cname,detail:Oc(Oc(Oc({6:e.stringUid,11:t,12:B("USE_NEW_TOKEN")?"1":void 0},i?{17:i}:{}),{},{22:t},e.apRequestDetail?{33:e.apRequestDetail}:{}),e.apRTM?{26:"RTM2"}:{}),key:e.token,service_ids:n,uid:e.uid||0}}]};s.request_bodies.forEach((c=>{e.multiIP&&e.multiIP.gateway_ip&&(c.buffer.detail[5]=JSON.stringify({vocs_ip:[e.multiIP.uni_lbs_ip],vos_ip:[e.multiIP.gateway_ip]}))}));const o=new FormData;return o.append("request",JSON.stringify(s)),[o,r]},y7=(e,t)=>{const n=Math.floor(Math.random()*1e12),r={appid:e.appId,client_ts:Date.now(),opid:n,sid:e.sid,request_bodies:[{uri:28,buffer:{cname:e.cname,detail:{1:"",6:e.stringUid,12:"1"},token:e.token,service_ids:t,uid:e.uid||0,edges_services:e.apResponse.addresses.map((s=>({ip:s.ip,port:s.port})))}}]},i=new FormData;return i.append("request",JSON.stringify(r)),[i,n]};let sm=0;function om(e){return ke.all(e.map((t=>t.then((n=>{throw n}),(n=>n))))).then((t=>{throw t}),(t=>t))}const fE=async e=>{let{fragementLength:t,referenceList:n,asyncMapHandler:r,allFailedhandler:i,promisesCollector:s}=e,o=0;const c=t;let d,h=0;const f=async()=>{const g=(()=>{const E=o*c,S=E+c;return n.slice(E,S).map(r)})();s&&s.push(...g);try{d=await om(g)}catch(E){if(h+=c,o++,!(h>=n.length))return void await f();i(E)}g.forEach((E=>E.cancel()))};return await f(),d},k2=async e=>{let{referenceList:t,asyncMapHandler:n,closeFn:r}=e;const i=t.length;let s=0;const o=async()=>{const c=n(t.shift());try{return await c}catch(d){if(s++,s>=i||r!=null&&r(d))throw d;return o()}};return o()};async function S7(){if(typeof VideoDecoder>"u")return!0;let e;const t=[18,0,10,13,0,0,0,3,180,253,144,6,136,8,8,8,32,50,85,16,66,128,2,8,32,132,0,8,0,180,90,204,169,166,242,109,241,190,143,149,160,133,4,144,43,122,168,159,120,159,205,39,82,131,57,52,87,187,68,23,248,134,204,226,97,17,49,183,55,236,219,249,221,98,208,215,190,59,179,167,213,47,1,246,150,14,194,245,159,83,35,64,103,218,38,21,82,3,135,21,185,84,248,134],n=[18,0,10,13,0,0,0,3,180,253,144,6,136,8,8,8,32,50,87,16,66,128,2,8,32,132,0,8,0,180,90,204,169,166,242,109,241,190,143,148,62,134,140,92,172,141,77,35,94,181,164,65,169,65,156,154,43,221,162,11,252,67,102,113,48,136,137,219,62,43,113,239,23,126,250,186,252,10,138,218,25,193,244,74,68,194,209,107,23,52,206,199,78,72,98,103,151,71,96,62,51,210,158,72,231,158],r=[18,0,10,13,0,0,0,3,180,253,144,6,136,8,8,8,32,50,87,16,66,128,2,8,32,132,0,8,0,180,90,204,169,166,242,109,241,190,143,143,233,163,51,196,98,95,151,224,22,134,33,240,150,248,67,18,34,196,142,81,238,173,140,80,205,232,132,144,67,12,131,157,4,171,243,86,122,35,6,166,184,243,85,126,13,206,103,152,62,168,160,187,2,241,138,52,211,72,121,128,151,63,147,128,19,42],i=[18,0,50,138,1,48,192,64,253,248,65,17,67,192,32,0,16,0,0,0,0,0,0,0,195,12,48,144,64,32,0,209,75,61,9,204,25,115,79,226,115,63,63,208,70,210,220,153,126,241,237,37,107,195,153,1,99,112,230,189,209,169,130,10,11,22,167,215,159,205,197,7,183,162,26,48,254,141,134,103,32,16,235,45,1,15,18,119,169,110,206,251,51,115,202,60,148,1,46,39,109,25,28,86,168,15,77,211,239,2,58,43,146,26,230,184,81,48,140,226,226,250,222,146,171,133,164,13,188,180,64,122,142,146,32,208,238,170,193,35,53,44,225],s=[18,0,50,107,48,0,133,125,248,65,26,195,64,62,32,31,16,0,0,0,0,0,1,4,16,64,144,64,32,0,204,24,122,65,56,165,18,52,206,218,4,187,51,97,9,29,191,90,253,106,185,31,197,155,52,205,245,185,203,131,20,226,25,124,95,113,220,113,141,15,15,104,211,144,152,237,150,157,127,51,143,24,231,218,171,255,176,241,128,229,149,150,148,66,245,228,91,27,182,228,136,61,182,237,133,45,220,24,103,214,152],o=[18,0,50,122,48,1,9,253,248,65,26,67,64,62,32,31,16,0,0,0,0,0,1,4,16,64,144,64,32,0,198,182,231,242,220,235,163,140,12,36,36,166,46,132,210,4,71,23,218,132,27,30,17,45,244,79,31,243,195,136,100,169,76,88,142,85,204,217,121,168,29,163,198,17,251,223,73,12,212,244,139,123,151,179,75,216,96,208,136,40,229,42,59,149,10,116,228,85,99,93,221,108,255,140,248,20,30,167,122,109,206,164,108,197,110,251,23,243,133,160,63,13,207,177,12,128];return await new ke(((d,h)=>{let f;(async function(){e&&e.state!=="closed"||await(async function(){e=new VideoDecoder({output:E=>{E.close(),clearTimeout(f),d(!0)},error:E=>{clearTimeout(f),d(!1)}}),await e.configure({codec:"av01.0.05M.08",width:160,height:90})})();const g=[t,n,r,i,s,o];for(let E=0;E<g.length;E++){const S=new EncodedVideoChunk({type:E==0?"key":"delta",timestamp:33333*E,duration:33333,data:new Uint8Array(g[E])});try{await e.decode(S)}catch{return void d(!1)}}})(),f=setTimeout((()=>{d(!1)}),5e3)}))}async function yI(e,t,n,r){return{gatewayInfo:await(async function(s,o,c,d){let h=null;const f=[],g=async()=>{const S=B("WEBCS_DOMAIN").slice(0,B("AJAX_REQUEST_CONCURRENT")).map((N=>({url:s.proxyServer?"https://".concat(s.proxyServer,"/ap/?url=").concat(N+"/api/v2/transpond/webrtc?v=2"):"https://".concat(N,"/api/v2/transpond/webrtc?v=2"),areaCode:pE()}))),O=d.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:S.map((N=>N.url))}),A=await fE({fragementLength:B("FRAGEMENT_LENGTH"),referenceList:S,asyncMapHandler:N=>(w.debug("[".concat(s.clientId,"] Connect to choose_server:"),N.url),O2(N,s,o,c)),allFailedhandler:N=>{throw d.recordJoinChannelService({endTs:Date.now(),status:"error",errors:N},O),N[0]},promisesCollector:f});return d.recordJoinChannelService({endTs:Date.now(),status:"success"},O),A},E=async()=>{if(await xr(1e3),h!==null)return h;const S=B("WEBCS_DOMAIN_BACKUP_LIST").map((N=>({url:s.proxyServer?"https://".concat(s.proxyServer,"/ap/?url=").concat(N+"/api/v2/transpond/webrtc?v=2"):"https://".concat(N,"/api/v2/transpond/webrtc?v=2"),areaCode:pE()}))),O=d.recordJoinChannelService({endTs:void 0,startTs:Date.now(),status:"pending",service:"chooseServer",urls:S.map((N=>N.url))}),A=await fE({fragementLength:B("FRAGEMENT_LENGTH"),referenceList:S,asyncMapHandler:N=>(w.debug("[".concat(s.clientId,"] Connect to backup choose_server:"),N.url),O2(N,s,o,c)),allFailedhandler:N=>{throw d.recordJoinChannelService({endTs:Date.now(),status:"error",errors:N},O),N[0]},promisesCollector:f});return d.recordJoinChannelService({endTs:Date.now(),status:"success"},O),A};try{return h=await om([g(),E()]),f.length&&f.forEach((S=>S.cancel&&typeof S.cancel=="function"&&S.cancel())),h}catch(S){throw S[0]}})(e,t,n,r)}}async function x2(e,t,n,r,i){const s=e.cloudProxyServer;if(s==="disabled"){if(e.useLocalAccessPoint)return await yI(e,t,n,i);if(B("JOIN_WITH_FALLBACK_MEDIA_PROXY")){const{gatewayInfo:E,proxyInfo:S}=await U2(e,t,n,i);if(e.turnServer&&e.turnServer.mode!=="auto")return{gatewayInfo:E};const O=S.map((A=>({turnServerURL:A.address,tcpport:A.tcpport||Hr.tcpport,udpport:A.udpport||Hr.udpport,username:A.username||Hr.username,password:A.password||Hr.password,forceturn:!1,security:!0})));if(i.useP2P){var o;const A=(o=e.uid)!==null&&o!==void 0?o:E.uid,N="glb:".concat(A.toString()),j=await lb(N),U=S.map((W=>({turnServerURL:W.address,tcpport:W.tcpport||Hr.tcpport,udpport:W.udpport||Hr.udpport,username:N,password:j,forceturn:!1,security:!0})));O.push(...U)}return e.turnServer={mode:"manual",servers:O},{gatewayInfo:E}}return await yI(e,t,n,i)}const{proxyInfo:c,gatewayInfo:d}=await U2(e,t,n,i),h={gatewayInfo:d},f=c.map((E=>({turnServerURL:E.address,tcpport:s==="proxy3"?void 0:E.tcpport?E.tcpport:Hr.tcpport,udpport:s==="proxy4"?void 0:E.udpport?E.udpport:Hr.udpport,username:E.username||Hr.username,password:E.password||Hr.password,forceturn:s!=="proxy4",security:s==="proxy5"})));if(i.useP2P){var g;const E=(g=e.uid)!==null&&g!==void 0?g:d.uid,S="glb:".concat(E.toString()),O=await lb(S),A=c.map((N=>({turnServerURL:N.address,tcpport:s==="proxy3"?void 0:N.tcpport||Hr.tcpport,udpport:s==="proxy4"?void 0:N.udpport||Hr.udpport,username:S,password:O,forceturn:s!=="proxy4",security:s==="proxy5"})));f.push(...A)}return e.turnServer={mode:"manual",servers:f},w.debug("[".concat(e.clientId,"] set proxy server: ").concat(e.proxyServer,", mode: ").concat(s)),h}async function L2(e,t,n,r,i){const s=B("ACCOUNT_REGISTER").slice(0,B("AJAX_REQUEST_CONCURRENT"));let o=[];o=t.proxyServer?s.map((d=>"https://".concat(t.proxyServer,"/ap/?url=").concat(d+"/api/v1"))):s.map((d=>"https://".concat(d,"/api/v1")));const c=i?.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"stringUID",urls:o});try{const d=await(async function(h,f,g,E,S){const O=Date.now(),A={sid:g.sid,opid:10,appid:g.appId,string_uid:f};let N=h[0];const j=await Ca((()=>Oa(N+"".concat(N.indexOf("?")===-1?"?":"&","action=stringuid"),{data:A,cancelToken:E,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}})),((U,W)=>{if(U.code===0){if(U.uid<=0||U.uid>=Math.pow(2,32))throw w.error("Invalid Uint Uid ".concat(f," => ").concat(U.uid),U),We.reqUserAccount(A.sid,{lts:O,success:!1,serverAddr:N,stringUid:A.string_uid,uid:U.uid,errorCode:V.INVALID_UINT_UID_FROM_STRING_UID,extend:A}),new le(V.INVALID_UINT_UID_FROM_STRING_UID);return We.reqUserAccount(A.sid,{lts:O,success:!0,serverAddr:N,stringUid:A.string_uid,uid:U.uid,errorCode:null,extend:A}),!1}const $=tm(U.code);return $.retry&&(N=h[(W+1)%h.length]),We.reqUserAccount(A.sid,{lts:O,success:!1,serverAddr:N,stringUid:A.string_uid,uid:U.uid,errorCode:$.desc,extend:A}),$.retry}),((U,W)=>U.code!==V.OPERATION_ABORTED&&(We.reqUserAccount(A.sid,{lts:O,success:!1,serverAddr:N,stringUid:A.string_uid,uid:null,errorCode:U.code,extend:A}),N=h[(W+1)%h.length],!0)),S);if(j.code!==0){const U=tm(j.code);throw new le(V.UNEXPECTED_RESPONSE,U.desc)}return j})(o,e,t,n,r);return i?.recordJoinChannelService({status:"success",endTs:Date.now()},c),d.uid}catch(d){throw i?.recordJoinChannelService({status:"error",endTs:Date.now(),errors:[d]},c),d}}async function T7(e,t,n){const r=B("ACCOUNT_REGISTER");let i=[];i=t.proxyServer?r.map((s=>"https://".concat(t.proxyServer,"/ap/?url=").concat(s+"/api/v1"))):r.map((s=>"https://".concat(s,"/api/v1")));try{return await k2({referenceList:i,asyncMapHandler:o=>(async function(c,d,h,f){const g=Date.now(),E={sid:h.sid,opid:10,appid:h.appId,string_uid:d};try{const S=await Oa(c+"".concat(c.indexOf("?")===-1?"?":"&","action=stringuid"),{data:E,cancelToken:f,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}});if(S.code!==0){const O=tm(S.code);throw new le(V.UNEXPECTED_RESPONSE,"preload sua error:".concat(O.desc),O)}if(S.uid<=0||S.uid>=Math.pow(2,32))throw new le(V.INVALID_UINT_UID_FROM_STRING_UID);return{requestTime:g,url:c,req:E,uid:S.uid,elapse:Date.now()-g}}catch(S){throw S}})(o,e,t,n),closeFn:o=>o.code===V.OPERATION_ABORTED||o.code===V.UNEXPECTED_RESPONSE&&!o.data.retry})}catch(s){throw s}}async function R7(e,t,n){const r=B("CDS_AP").slice(0,B("AJAX_REQUEST_CONCURRENT")).map((d=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(d+"/api/v1"):"https://".concat(d,"/api/v1?action=config"))),i=r.map((d=>(function(h,f,g,E){const S=Mt(),O={flag:64,cipher_method:0,features:Oc(Oc(Oc(Oc(Oc({install_id:yb(),device:S.name,system:S.os,system_general:navigator.userAgent,vendor:f.appId,version:ro,cname:f.cname,session_id:f.sid,proxyServer:f.proxyServer,sdk_type:p7.WEB_RTC,browser_name:S.name,browser_version:S.version,user_agent:navigator.userAgent,channel_name:f.cname},f.stringUid&&{string_uid:f.stringUid}),f.uid&&{uid:f.uid+""}),S.os&&{os_name:S.os}),S.osVersion&&{os_version:S.osVersion}),{},{detail:""})};return Ca((()=>Oa(h,{data:O,timeout:1e3,cancelToken:g,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":54}})),void 0,(A=>A.code!==V.OPERATION_ABORTED),E)})(d,e,t,n)));let s=null,o=null,c={};try{s=await om(i)}catch(d){if(d.code===V.OPERATION_ABORTED)throw d;o=d}if(i.forEach((d=>d.cancel())),We.reportApiInvoke(e.sid,{name:Gn.REQUEST_CONFIG_DISTRIBUTE,options:{error:o,res:s}}).onSuccess(),s&&s.test_tags)try{c=(function(d){if(!d.test_tags)return{};const h=d.test_tags,f=Object.keys(h),g={};return f.forEach((E=>{var S;const O=fi(S=E.slice(4)).call(S),A=JSON.parse(h[E]),N=A[1];g[O]={tag:A[0]||"",value:N}})),g})(s)}catch{}return c}async function M2(e,t){const n=B("WEBCS_DOMAIN").concat(B("WEBCS_DOMAIN_BACKUP_LIST")).map((r=>({url:"https://".concat(r,"/api/v2/transpond/webrtc?v=2"),areaCode:pE(),serviceIds:[Zn.CHOOSE_SERVER,Zn.CLOUD_PROXY_FALLBACK]})));try{return await k2({referenceList:n,asyncMapHandler:i=>(async function(s,o,c){let d,{url:h,areaCode:f,serviceIds:g}=s;const E=Date.now(),[S,O]=vI(o,f,g);let A=Qn.networkState;try{A&&Qn.networkState===gs.OFFLINE&&Qn.onlineWaiter&&await ke.race([Qn.onlineWaiter,xr(rr.maxRetryTimeout)]),A=Qn.networkState;const{data:N,headers:j}=await Oa(h,{data:S,cancelToken:c,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);d=j.http3==="1"?1:-1,(Z=>{const Y=[];if(Z.response_body.forEach((ie=>{const ue=ie.buffer.code;if(ie.uri===23&&ue===0&&!ie.buffer.edges_services)if(ie.buffer.flag===4194310)ie.buffer.edges_services=[];else{const ge={error:new le(V.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:Z.detail[502]}),flag:ie.buffer.flag};Y.push(ge)}if(ue!==0){const ge=tm(ue),Re={error:new le(V.CAN_NOT_GET_GATEWAY_SERVER,ge.desc,{desc:ge.desc,retry:ge.retry,csIp:Z.detail[502]}),flag:ie.buffer.flag};ie.buffer.flag===4194310?w.warning(Re.error.toString()):Y.push(Re)}})),Y.length)throw new le(V.CAN_NOT_GET_GATEWAY_SERVER,Y.map((ie=>"flag: ".concat(ie.flag,", message: ").concat(ie.error.message))).join(" | "),{retry:!!Y.find((ie=>ie.error.data.retry)),csIp:Z.detail[502],desc:[...new Set(Y.map((ie=>{var ue;return ie==null||(ue=ie.error)===null||ue===void 0||(ue=ue.data)===null||ue===void 0?void 0:ue.desc})).filter((ie=>!!ie)))]})})(N);const W=lE(N,Zn.CHOOSE_SERVER),$=lE(N,Zn.CLOUD_PROXY_FALLBACK);return EI(W),{gatewayInfo:cI(W,h),proxyInfo:$,opid:O,requestTime:E,url:h,isHttp3:d,elapse:Date.now()-E}}catch(N){throw N}})(i,e,t),closeFn:i=>i.code===V.OPERATION_ABORTED||i.code===V.CAN_NOT_GET_GATEWAY_SERVER&&!i.data.retry})}catch(r){throw r}}async function U2(e,t,n,r){const i=B("PROXY_SERVER_TYPE3"),s=(S,O,A)=>{let N=A||i;return Array.isArray(N)&&(N=O%2==0&&i[1]||i[0]),"https://".concat(N,"/ap/?url=").concat(S)};let o=null;const c=[],d=async()=>{const S=B("WEBCS_DOMAIN").slice(0,B("AJAX_REQUEST_CONCURRENT")).map(((N,j)=>{let U;return U=e.cloudProxyServer==="disabled"&&e.proxyServer?s("".concat(N,"/api/v2/transpond/webrtc?v=2"),j,e.proxyServer):e.cloudProxyServer==="disabled"||e.cloudProxyServer==="fallback"?"https://".concat(N,"/api/v2/transpond/webrtc?v=2"):s("".concat(N,"/api/v2/transpond/webrtc?v=2"),j),{url:U,areaCode:pE(),serviceIds:[Zn.CHOOSE_SERVER,e.cloudProxyServer==="proxy5"?Zn.CLOUD_PROXY_5:e.cloudProxyServer==="proxy3"||e.cloudProxyServer==="proxy4"?Zn.CLOUD_PROXY:Zn.CLOUD_PROXY_FALLBACK]}})),O=r.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:S.map((N=>N.url))}),A=await fE({fragementLength:B("FRAGEMENT_LENGTH"),referenceList:S,asyncMapHandler:N=>(w.debug("[".concat(e.clientId,"] Connect to choose_server:"),N.url),P2(N,e,t,n)),allFailedhandler:N=>{throw r.recordJoinChannelService({endTs:Date.now(),status:"error",errors:N},O),N[0]},promisesCollector:c});return r.recordJoinChannelService({endTs:Date.now(),status:"success"},O),A},h=async()=>{if(await xr(1e3),o!==null)return o;const S=B("WEBCS_DOMAIN_BACKUP_LIST").map(((N,j)=>{let U;return U=e.cloudProxyServer==="disabled"&&e.proxyServer?s("".concat(N,"/api/v2/transpond/webrtc?v=2"),j,e.proxyServer):e.cloudProxyServer==="disabled"||e.cloudProxyServer==="fallback"?"https://".concat(N,"/api/v2/transpond/webrtc?v=2"):s("".concat(N,"/api/v2/transpond/webrtc?v=2"),j),{url:U,areaCode:pE(),serviceIds:[Zn.CHOOSE_SERVER,e.cloudProxyServer==="proxy5"?Zn.CLOUD_PROXY_5:e.cloudProxyServer==="proxy3"||e.cloudProxyServer==="proxy4"?Zn.CLOUD_PROXY:Zn.CLOUD_PROXY_FALLBACK]}})),O=r.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:S.map((N=>N.url))}),A=await fE({fragementLength:B("FRAGEMENT_LENGTH"),referenceList:S,asyncMapHandler:N=>(w.debug("[".concat(e.clientId,"] Connect to backup choose_server:"),N.url),P2(N,e,t,n)),allFailedhandler:N=>{throw r.recordJoinChannelService({endTs:Date.now(),status:"error",errors:N},O),N[0]},promisesCollector:c});return r.recordJoinChannelService({endTs:Date.now(),status:"success"},O),A};let f,g,E;try{({gatewayInfo:f,proxyInfo:g,url:E}=await om([d(),h()]))}catch(S){throw S[0]}if(c.length&&c.forEach((S=>S.cancel&&typeof S.cancel=="function"&&S.cancel())),!f||!g)throw new le(V.UNEXPECTED_ERROR,"missing gateway or proxy response").print();if(e.apUrl=E,e.cloudProxyServer!=="disabled"&&Array.isArray(i)&&E){const S=/^https?:\/\/(.+?)(\/.*)?$/.exec(E)[1];be(i).call(i,S)&&(e.proxyServer=S,w.setProxyServer(S),We.setProxyServer(S))}return o={gatewayInfo:f,proxyInfo:await a2(g,f.uid)},o}async function w7(e,t,n){const r=B("UAP_AP").slice(0,B("AJAX_REQUEST_CONCURRENT")).map((s=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(s+"/api/v1?action=uap"):"https://".concat(s,"/api/v1?action=uap"))),i=r.map((s=>(function(o,c,d,h){const f={command:"convergeAllocateEdge",sid:c.sid,appId:c.appId,token:c.token,ts:Date.now(),version:ro,cname:c.cname,uid:c.uid.toString(),requestId:gI,seq:gI};gI+=1;const g={service_name:"tele_channel",json_body:JSON.stringify(f)};return Ca((async()=>{const E=await Oa(o,{data:g,cancelToken:d,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":61}});if(E.code!==0){const O=new le(V.UNEXPECTED_RESPONSE,"cross channel ap error, code"+E.code,{retry:!0});throw w.error(O.toString()),O}const S=JSON.parse(E.json_body);if(S.code!==200){const O=new le(V.UNEXPECTED_RESPONSE,"cross channel app center error, code: ".concat(S.code,", reason: ").concat(S.reason));throw w.error(O.toString()),O}if(!S.servers||S.servers.length===0){const O=new le(V.UNEXPECTED_RESPONSE,"cross channel app center empty server");throw w.error(O.toString()),O}return{vid:S.vid,workerToken:S.workerToken,addressList:(B("CHANNEL_MEDIA_RELAY_SERVERS")||S.servers).map((O=>"wss://".concat(O.address.replace(/\./g,"-"),".").concat(B("WORKER_DOMAIN"),":").concat(O.wss)))}}),void 0,(E=>!!(E.code!==V.OPERATION_ABORTED&&E.code!==V.UNEXPECTED_RESPONSE||E.data&&E.data.retry)),h)})(s,e,t,n)));try{const s=await om(i);return i.forEach((o=>o.cancel())),s}catch(s){throw s[0]}}async function C7(e,t,n){let r=null;const i=[],s=async o=>{const c=B(o?"WEBCS_DOMAIN_BACKUP_LIST":"WEBCS_DOMAIN").map((d=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(d+"/api/v2/transpond/webrtc?v=2"):"https://".concat(d,"/api/v2/transpond/webrtc?v=2")));return o&&(await xr(1e3),r!==null)?r:await fE({fragementLength:B("FRAGEMENT_LENGTH"),referenceList:c,asyncMapHandler:d=>(w.debug("[".concat(e.clientId,"] update ticket, Connect to ").concat(o?"backup":""," choose_server:"),d),(function(h,f,g,E){const[S]=y7(f,[Zn.CHOOSE_SERVER]);let O=Qn.networkState;return Ca((async()=>{O&&Qn.networkState===gs.OFFLINE&&Qn.onlineWaiter&&await ke.race([Qn.onlineWaiter,xr(E&&E.maxRetryTimeout||rr.maxRetryTimeout)]),O=Qn.networkState;const A=await Oa(h,{data:S,cancelToken:g,headers:{"Content-Type":"multipart/form-data;"}},!0);return v7(A,h)}),(()=>!1),(A=>A.code!==V.OPERATION_ABORTED&&(A.code===V.UPDATE_TICKET_FAILED?A.data.retry:(w.warning("[".concat(f.clientId,"] update ticket network error, retry"),A),!0))),E)})(d,e,t,n)),allFailedhandler:d=>{throw d[0]},promisesCollector:i})};try{return r=await om([s(!1),s(!0)]),i.length&&i.forEach((o=>o.cancel&&typeof o.cancel=="function"&&o.cancel())),r}catch(o){throw o[0]}}function j2(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable}))),n.push.apply(n,r)}return n}function SI(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?j2(Object(n),!0).forEach((function(r){x(e,r,n[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):j2(Object(n)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))}))}return e}class b7 extends xn{get isSuccess(){return!!this.configs}constructor(t,n){super(),x(this,"configs",void 0),x(this,"store",void 0),x(this,"joinInfo",void 0),x(this,"cancelToken",void 0),x(this,"retryConfig",{timeout:3e3,timeoutFactor:1.5,maxRetryCount:1,maxRetryTimeout:1e4}),x(this,"interval",void 0),x(this,"mutex",void 0),x(this,"mutableParamsRead",!1),x(this,"configCache",{}),x(this,"limit_bitrate",void 0),this.mutex=new Jr("config-distribute",t),this.store=n}startGetConfigDistribute(t,n){this.joinInfo=t,this.cancelToken=n,this.interval&&this.stopGetConfigDistribute(),B("ENABLE_CONFIG_DISTRIBUTE")&&(this.updateConfigDistribute(),this.interval=window.setInterval((()=>{this.updateConfigDistribute()}),B("CONFIG_DISTRIBUTE_INTERVAL")))}stopGetConfigDistribute(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.joinInfo=void 0,this.cancelToken=void 0,this.configs=void 0,this.limit_bitrate=void 0}async awaitConfigDistributeComplete(){this.mutex.isLocked&&(await this.mutex.lock())()}async updateConfigDistribute(){if(this.mutableParamsRead||(this.mutableParamsRead=!0,We.reportApiInvoke(null,{options:void 0,name:Gn.LOAD_CONFIG_FROM_LOCALSTORAGE,tag:Nn.TRACER}).onSuccess(JSON.stringify(ba))),!this.joinInfo||!this.cancelToken||!this.retryConfig)return void w.debug("[config-distribute] get config distribute interrupted have no joininfo");let t;const n=await this.mutex.lock();try{t=await R7(this.joinInfo,this.cancelToken,this.retryConfig),w.debug("[config-distribute] get config distribute",JSON.stringify(t));const r=(function(i){var s;const o=hh(s=Object.keys(i).filter((h=>/^webrtc_ng_global_parameter/.test(h)))).call(s);for(let h=0;h<o.length;h++)for(let f=o.length-1;f>h;f--){const g=o[f],E=i[g].value;if(typeof E.__priority=="number"){const S=E.__priority,O=o[f-1],A=i[O].value;if(typeof A.__priority=="number"){if(!(S>A.__priority))continue;{const N=g;o[f]=o[f-1],o[f-1]=N}}else{const N=g;o[f]=o[f-1],o[f-1]=N}}}const c=Date.now();let d={};return o.forEach((h=>{const f=i[h].value.__expires;f&&f<=c||(d[h]=i[h])})),d})(t);this.cacheGlobalParameterConfig(r),this.store.hasStartJoinChannel||(this.store.isABTestSuccess=!0),this.configs=r}catch(r){const i=new le(V.NETWORK_RESPONSE_ERROR,r);w.warning("[config-distribute] ".concat(i.toString()))}finally{n()}}getBitrateLimit(){return this.limit_bitrate||void 0}handleBitrateLimit(t){JM(t)&&(this.limit_bitrate?this.limit_bitrate&&this.limit_bitrate.id!==t.id&&this.emit(oE.UPDATE_BITRATE_LIMIT,t):this.emit(oE.UPDATE_BITRATE_LIMIT,t))}getLowStreamConfigDistribute(){return this.limit_bitrate&&SI({},this.limit_bitrate.low_stream_uplink)}handleABTestConfigDistribute(t){try{const n={},r=Object.keys(t),i=[];r.forEach((s=>{const o=t[s].value;n[s]=o;const c=o.__id;if(c&&this.configCache[s]&&this.configCache[s].__id===c)return;const d=o.__type,h=t[s].value,f=t[s].tag;let g=0;d?d===y1.REALTIME&&(g=1):Object.keys(h).some((E=>Object.prototype.hasOwnProperty.call(wb,E)||!Qb()&&Object.prototype.hasOwnProperty.call(XS,E)?(g=1,!0):void 0)),i.push({tag:f,isApplied:g,feature:s,params:JSON.stringify(o)})})),i.forEach((s=>{let{tag:o,feature:c,params:d,isApplied:h}=s;this.store.sessionId&&We.abTest(this.store.sessionId,{intSucc:1,isApplied:h,tag:o,feature:c,params:d,cid:this.store.cid,uid:this.store.intUid})})),this.configCache=n}catch(n){w.debug("handleABTestConfigDistribute error",n)}}cacheGlobalParameterConfig(t){const n=(function(i){const s={};return Object.keys(i).forEach((o=>{const c=i[o].value,d=c.__expires,h=c.__type;Object.keys(c).forEach((f=>{f==="__id"||f==="__type"||f==="__priority"||f==="__expires"||Object.prototype.hasOwnProperty.call(s,f)||(s[f]=SI(SI({value:c[f]},d&&{expires:d}),h&&{type:h}))}))})),s})(t);try{var r;const i=(r=n.LIMIT_BITRATE)===null||r===void 0?void 0:r.value;delete n.LIMIT_BITRATE,i&&JM(i)&&this.handleBitrateLimit(i),this.limit_bitrate=i,this.handleGlobalParameterConfig(n),this.handleABTestConfigDistribute(t),(function(c){try{const d=Date.now();Object.keys(c).forEach((h=>{const{value:f,type:g,expires:E}=c[h];E&&E<=d||((g===y1.REALTIME||Object.prototype.hasOwnProperty.call(wb,h))&&(ba[h]=f,bn[h]=f,w.debug("Update realtime parameters from config distribute",h,f)),g||Qb()||!Object.prototype.hasOwnProperty.call(XS,h)||(ba[h]=f,bn[h]=f,w.debug("Update gateway parameters from config distribute",h,f)))}))}catch(d){w.error("Error update config immediately: ".concat(c),d.message)}})(n);const s=JSON.stringify(n),o=window.btoa(s);window.localStorage.setItem("websdk_ng_global_parameter",o),w.debug("Caching global parameters ".concat(s))}catch(i){w.error("Error caching global parameters:",i.message)}}handleGlobalParameterConfig(t){try{const n=Date.now();Object.keys(t).forEach((r=>{if(r==="CLIENT_ROLE_OPTIONS"&&Object.prototype.hasOwnProperty.call(bn,r)){const{value:i,expires:s}=t[r];if(s&&s<=n)return;(function(o,c){try{return typeof o=="object"&&typeof c=="object"&&JSON.stringify(o)===JSON.stringify(c)}catch{return!1}})(bn[r],i)||(ba[r]=i,bn[r]=i,this.emit(oE.UPDATE_CLIENT_ROLE_OPTIONS,i),w.debug("Updating client role options: ".concat(JSON.stringify(i))))}}))}catch(n){w.error("Error handling global parameter config:",n.message)}}}class I7 extends xn{constructor(){super(...arguments),x(this,"resultStorage",new Map)}setLocalAudioStats(t,n,r){this.record("AUDIO_INPUT_LEVEL_TOO_LOW",t,this.checkAudioInputLevel(r,n)),this.record("SEND_AUDIO_BITRATE_TOO_LOW",t,this.checkSendAudioBitrate(r,n))}setLocalVideoStats(t,n,r){this.record("SEND_VIDEO_BITRATE_TOO_LOW",t,this.checkSendVideoBitrate(r,n)),this.record("FRAMERATE_INPUT_TOO_LOW",t,this.checkFramerateInput(r,n)),this.record("FRAMERATE_SENT_TOO_LOW",t,this.checkFramerateSent(r)),!n.muted&&this.record("VIDEO_ENCODE_FAILED",t,this.checResolutionSent(r))}setRemoteAudioStats(t,n){const r=t.getUserId();this.record("AUDIO_OUTPUT_LEVEL_TOO_LOW",r,this.checkAudioOutputLevel(n))}setRemoteVideoStats(t,n){const r=t.getUserId();this.record("RECV_VIDEO_DECODE_FAILED",r,this.checkVideoDecode(n))}record(t,n,r){if(B("STATS_UPDATE_INTERVAL")>500)return;this.resultStorage.has(t)||this.resultStorage.set(t,{result:[],isPrevNormal:!0});const i=this.resultStorage.get(t);if(!i)return;i.result.push(r);const s=t==="VIDEO_ENCODE_FAILED"?B("ENCODE_EXCEPTION_TIMES"):5;if(i.result.length>=s){var o;const c=be(o=i.result).call(o,!0);i.isPrevNormal&&!c&&this.emit("exception",TI[t],t,n),!i.isPrevNormal&&c&&this.emit("exception",TI[t]+2e3,t+"_RECOVER",n),i.isPrevNormal=c,i.result=[]}}checkAudioOutputLevel(t){return!(t.receiveBitrate>0&&t.receiveLevel===0)}checkAudioInputLevel(t,n){return n instanceof cr&&!n.isActive||!!n.muted||t.sendVolumeLevel!==0}checkFramerateInput(t,n){let r=null;n._encoderConfig&&n._encoderConfig.frameRate&&(r=Es(n._encoderConfig.frameRate));const i=t.captureFrameRate;return!r||!i||!(r>10&&i<5||r<10&&r>=5&&i<=1)}checkFramerateSent(t){return!(t.captureFrameRate&&t.sendFrameRate&&t.captureFrameRate>5&&t.sendFrameRate<=1)}checResolutionSent(t){var n;return!(!t.codecType||be(n=B("ENCODE_EXCEPTION_VALIDATE_CODEC")).call(n,t.codecType.toLocaleLowerCase()))||!t.captureFrameRate||t.sendFrameRate!==0||t.sendResolutionWidth!==0||t.sendResolutionHeight!==0}checkSendVideoBitrate(t,n){return!!n.muted||t.sendBitrate!==0}checkSendAudioBitrate(t,n){return n instanceof cr&&!n.isActive||!!n.muted||t.sendBitrate!==0}checkVideoDecode(t){return t.receiveBitrate===0||t.decodeFrameRate!==0}}const TI={FRAMERATE_INPUT_TOO_LOW:1001,FRAMERATE_SENT_TOO_LOW:1002,SEND_VIDEO_BITRATE_TOO_LOW:1003,RECV_VIDEO_DECODE_FAILED:1005,AUDIO_INPUT_LEVEL_TOO_LOW:2001,AUDIO_OUTPUT_LEVEL_TOO_LOW:2002,SEND_AUDIO_BITRATE_TOO_LOW:2003,VIDEO_ENCODE_FAILED:2004},ei=new class{markSubscribeStart(e,t){performance.mark("agora-web-sdk/".concat(e,"/subscribe-").concat(t))}markPublishStart(e,t){performance.mark("agora-web-sdk/".concat(e,"/publish-").concat(t))}measureFromSubscribeStart(e,t){const n=performance.getEntriesByName("agora-web-sdk/".concat(e,"/subscribe-").concat(t));if(n.length>0){const r=n[n.length-1];return Math.round(performance.now()-r.startTime)}return 0}measureFromPublishStart(e,t){const n=performance.getEntriesByName("agora-web-sdk/".concat(e,"/publish-").concat(t));if(n.length>0){const r=n[n.length-1];return Math.round(performance.now()-r.startTime)}return 0}};function V2(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable}))),n.push.apply(n,r)}return n}function kh(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?V2(Object(n),!0).forEach((function(r){x(e,r,n[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):V2(Object(n)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))}))}return e}class mE{constructor(t){x(this,"store",void 0),x(this,"onStatsException",void 0),x(this,"onUploadPublishDuration",void 0),x(this,"onStatsChanged",void 0),x(this,"onVideoCodecChanged",void 0),x(this,"localStats",new Map),x(this,"remoteStats",new Map),x(this,"updateStatsInterval",void 0),x(this,"trafficStats",void 0),x(this,"trafficStatsPeerList",[]),x(this,"uplinkStats",void 0),x(this,"exceptionMonitor",void 0),x(this,"p2pChannel",void 0),x(this,"scalabilityMode",qS.L1T1),x(this,"updateStats",(()=>{this.p2pChannel&&(this.updateRemoteStats(this.p2pChannel),this.updateLocalStats(this.p2pChannel))})),this.store=t,this.exceptionMonitor=new I7,this.exceptionMonitor.on("exception",((n,r,i)=>{this.onStatsException&&this.onStatsException(n,r,i)}))}startUpdateStats(){this.updateStatsInterval||(this.updateStatsInterval=window.setInterval(this.updateStats,1e3))}stopUpdateStats(){this.updateStatsInterval&&(window.clearInterval(this.updateStatsInterval),this.updateStatsInterval=void 0)}reset(){this.localStats=new Map,this.remoteStats=new Map,this.trafficStats=void 0,this.trafficStatsPeerList=[],this.uplinkStats=void 0}getLocalAudioTrackStats(){return this.localStats.get(ve.LocalAudioTrack)||kh({},Ob)}getLocalVideoTrackStats(){return this.localStats.get(ve.LocalVideoTrack)||kh({},Pb)}getRemoteAudioTrackStats(t){const n=(s,o)=>{if(!this.trafficStats)return o;const c=this.trafficStats.peer_delay.find((d=>d.peer_uid===s));return c&&(o.publishDuration=c.B_ppad+(Date.now()-this.trafficStats.timestamp)),o},r={};if(t){var i;const s=(i=this.remoteStats.get(t))===null||i===void 0?void 0:i.audioStats;s&&(r[t]=n(t,s))}else Array.from(this.remoteStats.entries()).forEach((s=>{let[o,{audioStats:c}]=s;c&&(r[o]=n(o,c))}));return r}getRemoteNetworkQualityStats(t){const n={};if(t){var r;const i=(r=this.remoteStats.get(t))===null||r===void 0?void 0:r.networkStats;i&&(n[t]=i)}else Array.from(this.remoteStats.entries()).forEach((i=>{let[s,{networkStats:o}]=i;o&&(n[s]=o)}));return n}getRemoteVideoTrackStats(t){const n=(s,o)=>{if(!this.trafficStats)return o;const c=this.trafficStats.peer_delay.find((d=>d.peer_uid===s));return c&&(o.publishDuration=c.B_ppvd+(Date.now()-this.trafficStats.timestamp)),o},r={};if(t){var i;const s=(i=this.remoteStats.get(t))===null||i===void 0?void 0:i.videoStats;s&&(r[t]=n(t,s))}else Array.from(this.remoteStats.entries()).forEach((s=>{let[o,{videoStats:c}]=s;c&&(r[o]=n(o,c))}));return r}getRTCStats(){let t=0,n=0,r=0,i=0;const s=this.localStats.get(ve.LocalAudioTrack);s&&(t+=s.sendBytes,n+=s.sendBitrate);const o=this.localStats.get(ve.LocalVideoTrack);o&&(t+=o.sendBytes,n+=o.sendBitrate);const c=this.localStats.get(ve.LocalVideoLowTrack);c&&(t+=c.sendBytes,n+=c.sendBitrate),this.remoteStats.forEach((h=>{let{audioStats:f,videoStats:g}=h;f&&(r+=f.receiveBytes,i+=f.receiveBitrate),g&&(r+=g.receiveBytes,i+=g.receiveBitrate)}));let d=1;return this.trafficStats&&(d+=this.trafficStats.peer_delay.length),{Duration:0,UserCount:d,SendBitrate:n,SendBytes:t,RecvBytes:r,RecvBitrate:i,OutgoingAvailableBandwidth:this.uplinkStats?this.uplinkStats.B_uab/1e3:0,RTT:this.trafficStats?2*this.trafficStats.B_acd:0}}addLocalStats(t){this.localStats.set(t,void 0)}removeLocalStats(t){t?this.localStats.delete(t):this.localStats.clear()}addRemoteStats(t){this.remoteStats.set(t,{})}removeRemoteStats(t){t?this.remoteStats.delete(t):this.remoteStats.clear()}addP2PChannel(t){this.p2pChannel=t}updateTrafficStats(t){t.peer_delay=t.peer_delay.filter((n=>n.B_ppad!==void 0||n.B_ppvd!==void 0)),t.peer_delay.filter((n=>this.trafficStatsPeerList.indexOf(n.peer_uid)===-1)).forEach((n=>{var r;const i=(r=this.p2pChannel)===null||r===void 0?void 0:r.getRemoteMedia(n.peer_uid),s=i!=null&&i.videoSSRC?ei.measureFromSubscribeStart(this.store.clientId,i.videoSSRC):0,o=i!=null&&i.audioSSRC?ei.measureFromSubscribeStart(this.store.clientId,i.audioSSRC):0;n.B_ppad!==void 0&&n.B_ppvd!==void 0&&(this.onUploadPublishDuration&&this.onUploadPublishDuration(n.peer_uid,n.B_ppad,n.B_ppvd,s>o?s:o),this.trafficStatsPeerList.push(n.peer_uid))})),this.trafficStats=t}updateUplinkStats(t){this.uplinkStats&&this.uplinkStats.B_fir!==t.B_fir&&w.debug("[".concat(this.store.clientId,"]: Period fir changes to ").concat(t.B_fir)),this.uplinkStats=t}static isRemoteVideoFreeze(t,n,r){if(!t)return!1;const i=!!r&&n.framesDecodeFreezeTime>r.framesDecodeFreezeTime,s=!r||n.framesDecodeCount>r.framesDecodeCount;return i||!s}static isRemoteAudioFreeze(t){return!!t&&t._isFreeze()}isLocalVideoFreeze(t){return!(!t.inputFrame||!t.sentFrame)&&t.inputFrame.frameRate>5&&t.sentFrame.frameRate<3}updateLocalStats(t){Array.from(this.localStats.entries()).forEach((n=>{let[r,i]=n;switch(r){case ve.LocalVideoTrack:case ve.LocalVideoLowTrack:{const c=i,d=kh({},Pb),h=t.getStats(),f=t.getLocalMedia(r);if(h){const g=h.videoSend.find((E=>E.ssrc===f?.ssrcs[0].ssrcId));if(g){const E=t.getLocalVideoSize(),S=t.getEncoderConfig(ve.LocalVideoTrack);var s;(g.codec==="H264"||g.codec==="H265"||g.codec==="VP8"||g.codec==="VP9"||g.codec==="AV1X"||g.codec==="AV1")&&(d.codecType=g.codec,c?.codecType!==g.codec&&((s=this.onVideoCodecChanged)===null||s===void 0||s.call(this,g.codec.toLocaleLowerCase()))),d.sendBytes=g.bytes,d.sendBitrate=c?8*Math.max(0,d.sendBytes-c.sendBytes):0,g.inputFrame?(d.captureFrameRate=g.inputFrame.frameRate,d.captureResolutionHeight=g.inputFrame.height,d.captureResolutionWidth=g.inputFrame.width):E&&(d.captureResolutionWidth=E.width,d.captureResolutionHeight=E.height),g.sentFrame?(d.sendFrameRate=g.sentFrame.frameRate,d.sendResolutionHeight=g.sentFrame.height,d.sendResolutionWidth=g.sentFrame.width):E&&(d.sendResolutionWidth=E.width,d.sendResolutionHeight=E.height),g.avgEncodeMs&&(d.encodeDelay=g.avgEncodeMs),S&&S.bitrateMax?d.targetSendBitrate=1e3*S.bitrateMax:g.targetBitrate&&(d.targetSendBitrate=g.targetBitrate),d.sendPackets=g.packets,d.sendPacketsLost=g.packetsLost,d.sendJitterMs=g.jitterMs,d.sendRttMs=g.rttMs,d.totalDuration=c?c.totalDuration+1:1,d.totalFreezeTime=c?c.totalFreezeTime:0,this.isLocalVideoFreeze(g)&&(d.totalFreezeTime+=1),g.scalabilityMode&&this.scalabilityMode!==g.scalabilityMode&&(w.debug("[".concat(this.store.clientId,"]: The scalabilityMode of the video sending stream is ").concat(g.scalabilityMode)),this.scalabilityMode=g.scalabilityMode)}this.trafficStats&&(d.currentPacketLossRate=(this.trafficStats.B_pvlr4||0)/100)}var o;this.localStats.set(r,d),(c?.sendResolutionWidth!==d.sendResolutionWidth||c?.sendResolutionHeight!==d.sendResolutionHeight)&&((o=this.onStatsChanged)===null||o===void 0||o.call(this,"resolution",{width:d.sendResolutionWidth,height:d.sendResolutionHeight})),d&&f&&this.exceptionMonitor.setLocalVideoStats(this.store.uid,f.track,d);break}case ve.LocalAudioTrack:{const c=i,d=kh({},Ob),h=t.getStats(),f=t.getLocalMedia(r);if(h){const g=h.audioSend.find((E=>E.ssrc===f?.ssrcs[0].ssrcId));if(g){if(g.codec!=="opus"&&g.codec!=="aac"&&g.codec!=="PCMU"&&g.codec!=="PCMA"&&g.codec!=="G722"||(d.codecType=g.codec),g.inputLevel)d.sendVolumeLevel=Math.round(32767*g.inputLevel);else{const E=t.getLocalAudioVolume();E&&(d.sendVolumeLevel=Math.round(32767*E))}d.sendBytes=g.bytes,d.sendPackets=g.packets,d.sendPacketsLost=g.packetsLost,d.sendJitterMs=g.jitterMs,d.sendRttMs=g.rttMs,d.sendBitrate=c?8*Math.max(0,d.sendBytes-c.sendBytes):0}}this.trafficStats&&(d.currentPacketLossRate=(this.trafficStats.B_palr4||0)/100),this.localStats.set(ve.LocalAudioTrack,d),d&&f&&this.exceptionMonitor.setLocalAudioStats(this.store.uid,f.track,d);break}}}))}updateRemoteStats(t){Array.from(this.remoteStats.entries()).forEach((n=>{var r,i;let[s,{videoStats:o,audioStats:c,videoPcStats:d}]=n;const h=c,f=o,g=d,E=kh({},P1),S=kh({},D1),O=kh({},d9),{audioTrack:A,videoTrack:N,audioSSRC:j,videoSSRC:U}=t.getRemoteMedia(s);let W;W=this.store.useP2P?t.getStats(!0):t.getStats();const $=(r=W)===null||r===void 0?void 0:r.audioRecv.find((ue=>ue.ssrc===j)),Z=(i=W)===null||i===void 0?void 0:i.videoRecv.find((ue=>ue.ssrc===U)),Y=this.trafficStats&&this.trafficStats.peer_delay.find((ue=>ue.peer_uid===s));if($&&($.codec!=="opus"&&$.codec!=="aac"&&$.codec!=="PCMU"&&$.codec!=="PCMA"&&$.codec!=="G722"||(E.codecType=$.codec),$.outputLevel?E.receiveLevel=Math.round(32767*$.outputLevel):A&&(E.receiveLevel=Math.round(32767*A.getVolumeLevel())),E.receiveBytes=$.bytes,E.receivePackets=$.packets,E.receivePacketsLost=$.packetsLost,E.receivePacketsDiscarded=$.packetsDiscarded,E.packetLossRate=E.receivePacketsLost/(E.receivePackets+E.receivePacketsLost),E.receiveBitrate=h?8*Math.max(0,E.receiveBytes-h.receiveBytes):0,E.totalDuration=h?h.totalDuration+1:1,E.totalFreezeTime=h?h.totalFreezeTime:0,E.freezeRate=E.totalFreezeTime/E.totalDuration,E.receiveDelay=$.jitterBufferMs,E.totalDuration>10&&mE.isRemoteAudioFreeze(A)&&(E.totalFreezeTime+=1)),Z){var ie;Z.codec!=="H264"&&Z.codec!=="H265"&&Z.codec!=="VP8"&&Z.codec!=="VP9"&&Z.codec!=="AV1X"&&Z.codec!=="AV1"||(S.codecType=Z.codec),S.receiveBytes=Z.bytes,S.receiveBitrate=f?8*Math.max(0,S.receiveBytes-f.receiveBytes):0,S.decodeFrameRate=Z.decodeFrameRate<0?0:Z.decodeFrameRate,S.renderFrameRate=Z.decodeFrameRate<0?0:Z.decodeFrameRate,Z.outputFrame&&(S.renderFrameRate=Z.outputFrame.frameRate),Z.receivedFrame?(S.receiveFrameRate=Z.receivedFrame.frameRate,S.receiveResolutionHeight=Z.receivedFrame.height,S.receiveResolutionWidth=Z.receivedFrame.width):N&&(S.receiveResolutionHeight=N._videoHeight||0,S.receiveResolutionWidth=N._videoWidth||0),Z.framesRateFirefox!==void 0&&(S.receiveFrameRate=Math.round(Z.framesRateFirefox)),S.receivePackets=Z.packets,S.receivePacketsLost=Z.packetsLost,S.packetLossRate=S.receivePacketsLost/(S.receivePackets+S.receivePacketsLost);const ue=f?f.totalFreezeTime:0,ge=f?f.totalDuration:0;S.totalDuration=f?f.totalDuration+1:1,S.totalFreezeTime=(ie=Z.totalFreezesDuration)!==null&&ie!==void 0?ie:ue||0,S.receiveDelay=Z.jitterBufferMs||0;const Re=!!U&&t.getRemoteVideoIsReady(U);Z.totalFreezesDuration===void 0&&N&&Re&&mE.isRemoteVideoFreeze(N,Z,g)&&(S.totalFreezeTime+=1),S.freezeRate=Math.max(0,Math.min((S.totalFreezeTime-ue)/(S.totalDuration-ge),1))}Y&&(E.end2EndDelay=Y.B_ad,S.end2EndDelay=Y.B_vd,E.transportDelay=Y.B_ed,S.transportDelay=Y.B_ed,E.currentPacketLossRate=Y.B_ealr4/100,S.currentPacketLossRate=Y.B_evlr4/100,O.uplinkNetworkQuality=Y.B_punq?Y.B_punq:0,O.downlinkNetworkQuality=Y.B_pdnq?Y.B_pdnq:0),this.remoteStats.set(s,{audioStats:E,videoStats:S,videoPcStats:Z,networkStats:O}),A&&this.exceptionMonitor.setRemoteAudioStats(A,E),N&&this.exceptionMonitor.setRemoteVideoStats(N,S)}))}}class F2{constructor(){x(this,"destChannelMediaInfos",new Map),x(this,"srcChannelMediaInfo",void 0)}setSrcChannelInfo(t){qM(t),this.srcChannelMediaInfo=t}addDestChannelInfo(t){qM(t),this.destChannelMediaInfos.set(t.channelName,t)}removeDestChannelInfo(t){fT(t),this.destChannelMediaInfos.delete(t)}getSrcChannelMediaInfo(){return this.srcChannelMediaInfo}getDestChannelMediaInfo(){return this.destChannelMediaInfos}}function B2(e){if(!(e instanceof F2))return new le(V.INVALID_PARAMS,"Config should be instance of [ChannelMediaRelayConfiguration]").throw();const t=e.getSrcChannelMediaInfo(),n=e.getDestChannelMediaInfo();if(!t)return new le(V.INVALID_PARAMS,"srcChannelMediaInfo should not be empty").throw();if(n.size===0)return new le(V.INVALID_PARAMS,"destChannelMediaInfo should not be empty").throw()}class Vd{get hasVideo(){return this._video_enabled_&&!this._video_muted_&&this._video_added_}get hasAudio(){return this._audio_enabled_&&!this._audio_muted_&&this._audio_added_}get audioTrack(){if(this.hasAudio||this._audio_pre_subscribed)return this._audioTrack}get videoTrack(){if(this.hasVideo||this._video_pre_subscribed)return this._videoTrack}get dataChannels(){return this._dataChannels}constructor(t,n){x(this,"uid",void 0),x(this,"_uintid",void 0),x(this,"_trust_in_room_",!0),x(this,"_trust_audio_enabled_state_",!0),x(this,"_trust_video_enabled_state_",!0),x(this,"_trust_audio_mute_state_",!0),x(this,"_trust_video_mute_state_",!0),x(this,"_audio_muted_",!1),x(this,"_video_muted_",!1),x(this,"_audio_enabled_",!0),x(this,"_video_enabled_",!0),x(this,"_audio_added_",!1),x(this,"_video_added_",!1),x(this,"_is_pre_created",!1),x(this,"_video_pre_subscribed",!1),x(this,"_audio_pre_subscribed",!1),x(this,"_trust_video_stream_added_state_",!0),x(this,"_trust_audio_stream_added_state_",!0),x(this,"_audioTrack",void 0),x(this,"_videoTrack",void 0),x(this,"_dataChannels",[]),x(this,"_audioSSRC",void 0),x(this,"_videoSSRC",void 0),x(this,"_audioOrtc",void 0),x(this,"_videoOrtc",void 0),x(this,"_cname",void 0),x(this,"_rtxSsrcId",void 0),x(this,"_videoMid",void 0),x(this,"_audioMid",void 0),this.uid=t,this._uintid=n}}function W2(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable}))),n.push.apply(n,r)}return n}function RI(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?W2(Object(n),!0).forEach((function(r){x(e,r,n[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):W2(Object(n)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))}))}return e}const NT="9",wI=2e4,OT=4e4;function G2(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable}))),n.push.apply(n,r)}return n}function Cl(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?G2(Object(n),!0).forEach((function(r){x(e,r,n[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):G2(Object(n)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))}))}return e}var am=(function(e){return e[e.DOWN=0]="DOWN",e[e.UP=1]="UP",e})(am||{});const PT=new Map;function H2(e,t,n,r){let{scale:i}=e;if(i===0&&r===am.UP||i>=t.length-1&&r===am.DOWN)return e;let s=Cl(Cl({},e),{},{scale:r===am.DOWN?++i:--i});switch(n){case"maintain-framerate":s=Cl(Cl({},s),t[i].motion);break;case"maintain-resolution":s=Cl(Cl({},s),t[i].detail);break;case"balanced":s=Cl(Cl({},s),t[i].balanced)}return s}function K2(e,t){if(t){const n={overUse:0,underUse:0,adaptationList:z2(t)};PT.set(e,n)}else PT.delete(e)}function z2(e){const t=Cl({},e),{bitrateMax:n,frameRate:r,scaleResolutionDownBy:i,bitrateMin:s}=t,{MIN_FRAME_RATE:o,MAX_THRESHOLD_FRAMERATE:c,MAX_SCALE:d,BITRATE_MIN_THRESHOLD:h,BITRATE_MAX_THRESHOLD:f,BWE_SCALE_UP_THRESHOLD:g,BWE_SCALE_DOWN_THRESHOLD:E,PERF_SCALE_DOWN_THRESHOLD:S,PERF_SCALE_UP_THRESHOLD:O,BALANCE_BITRATE_FACTOR:A,BALANCE_FRAMERATE_FACTOR:N,BALANCE_RESOLUTION_FACTOR:j,MOTION_RESOLUTION_FACTOR:U,MOTION_BITRATE_FACTOR:W,DETAIL_FRAMERATE_FACTOR:$,DETAIL_BITRATE_FACTOR:Z}=Tb,Y=Math.min(t.frameRate,c),ie=[{scale:0,threshold:{bwe_down:Math.round(Math.pow(E,1)*n),bwe_up:n,fps_down:Math.round(Math.pow(S,1)*Y),fps_up:r},balanced:{scaleResolutionDownBy:1,frameRate:r,bitrateMax:n,bitrateMin:s},motion:{scaleResolutionDownBy:1,frameRate:r,bitrateMax:n,bitrateMin:s},detail:{scaleResolutionDownBy:1,frameRate:r,bitrateMax:n,bitrateMin:s}}];for(let ue=1;ue<=d;ue++){const ge={bwe_up:Math.round(Math.pow(g,ue)*n),bwe_down:Math.round(Math.pow(E,ue+1)*n),fps_up:Math.round(Math.pow(O,ue)*Y),fps_down:Math.round(Math.pow(S,ue+1)*Y)},Re={scaleResolutionDownBy:i/Math.pow(j,ue),frameRate:Math.max(Math.round(Math.pow(N,ue)*r),o),bitrateMax:Math.max(Math.round(Math.pow(A,ue)*n),f),bitrateMin:Math.max(Math.round(Math.pow(A,ue)*s),h)},St={scaleResolutionDownBy:i/Math.pow(U,ue),frameRate:r,bitrateMax:Math.max(Math.round(Math.pow(W,ue)*n),f),bitrateMin:Math.max(Math.round(Math.pow(W,ue)*s),h)},Ct={scaleResolutionDownBy:1,frameRate:Math.max(Math.round(Math.pow($,ue)*r),o),bitrateMax:Math.max(Math.round(Math.pow(Z,ue)*n),f),bitrateMin:Math.max(Math.round(Math.pow(Z,ue)*s),h)};ie.push({scale:ue,threshold:ge,balanced:Re,motion:St,detail:Ct})}return ie}function A7(e,t,n,r,i,s){const o=PT.get(e)||{overUse:0,underUse:0,adaptationList:z2(i)},{adaptationList:c}=o;PT.set(e,o);const{OVERUSE_TIMES_THRESHOLD:d,UNDERUSE_TIMES_THRESHOLD:h}=Tb,{scale:f}=r;let g,E;return typeof t=="number"&&t>0&&(function(S,O,A,N){if(O>=A.length)return!1;let{threshold:{fps_down:j}}=A[O];return B("FORCE_AG_HIGH_FRAMERATE")&&N==="maintain-framerate"&&(j=A[0].threshold.fps_down),S<j})(t,f,c,s)&&(o.overUse++,E=Zg.CPU,o.overUse>d)||typeof n=="number"&&n>0&&(function(S,O,A){if(O>=A.length)return!1;const{threshold:{bwe_down:N}}=A[O];return S<N})(n,f,c)&&(o.overUse++,E=Zg.BANDWIDTH,o.overUse>d)?(o.overUse=0,o.underUse=0,g=H2(r,c,s,am.DOWN),[g,E]):(typeof t=="number"&&t>0&&typeof n=="number"&&n>0&&(function(S,O,A,N){if(O===0)return;let{threshold:{fps_up:j}}=A[O];return B("FORCE_AG_HIGH_FRAMERATE")&&N==="maintain-framerate"&&(j=A[1].threshold.fps_up),S>j})(t,f,c,s)&&(function(S,O,A){if(O===0)return;const{threshold:{bwe_up:N}}=A[O];return S>N})(n,f,c)&&(o.underUse++,o.underUse>h&&(o.overUse=0,o.underUse=0,g=H2(r,c,s,am.UP),g.scale===0&&(E=Zg.NONE))),[g,E])}function Y2(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable}))),n.push.apply(n,r)}return n}function CI(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Y2(Object(n),!0).forEach((function(r){x(e,r,n[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Y2(Object(n)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))}))}return e}const DT=new Map;function kT(e,t){const n=DT.get(e);if(n){const{timer:r}=n;window.clearTimeout(r),DT.delete(e)}t.qualityLimitationReason=Zg.NONE,K2(e)}function N7(e,t){var n;let r;switch(t){case ve.LocalAudioTrack:r=tn.Audio;break;case ve.LocalVideoTrack:r=be(n=e._hints).call(n,ln.SCREEN_TRACK)?tn.Screen:tn.High;break;case ve.LocalVideoLowTrack:r=tn.Low}return r}function bI(e){const t=Bt();if(e.some((n=>n._bypassWebAudio)))throw new de(V.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");if(!t.webAudioMediaStreamDest)throw new de(V.NOT_SUPPORTED,"cannot publish multiple tracks because your browser does not support audio mixing")}function II(e,t){bI(e);const n=new cr;return e.forEach((r=>n.addAudioTrack(r))),n}const O7=!Bt().supportUnifiedPlan||B("CHROME_FORCE_PLAN_B")&&vl();function xT(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var n;return O7?(n={spec:t,store:e},wl("PlanBConnection").create(n)):new co(t,e)}function AI(e){return e&&(e.iceConnectionState==="disconnected"||e.iceConnectionState==="checking"||e.iceConnectionState==="failed")}function q2(e){try{if(e.iceServers)return!1;if(e.turnServer&&e.turnServer.mode!=="off"){if(Xg(e.turnServer.servers))return!1;if(B("FORCE_TURN_TCP")||e.turnServer.servers.concat(e.turnServer.serversFromGateway||[]).some((t=>t.forceturn)))return!0}return!1}catch{return!1}}var Ut;function X2(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable}))),n.push.apply(n,r)}return n}function Pa(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?X2(Object(n),!0).forEach((function(r){x(e,r,n[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):X2(Object(n)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))}))}return e}let co=(Ut=class qh extends ZM{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var t,n;return(t=(n=this.peerConnection.getReceivers()[0])===null||n===void 0||(n=n.transport)===null||n===void 0?void 0:n.state)!==null&&t!==void 0?t:null}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.send.videoCodecs.map((t=>t.rtpMap&&t.rtpMap.encodingName.toLowerCase()||"")).filter((t=>{var n;return be(n=Object.keys(eE)).call(n,t)})))]}constructor(t,n){super(t,n),x(this,"id",hn(5,"connection-")),x(this,"store",void 0),x(this,"peerConnection",void 0),x(this,"forceTurn",!1),x(this,"remoteSDP",void 0),x(this,"initialOffer",void 0),x(this,"transportEventReceiver",void 0),x(this,"statsFilter",void 0),x(this,"extension",{useXR:B("USE_XR")}),x(this,"localCapabilities",void 0),x(this,"remoteCodecs",void 0),x(this,"localCandidateCount",0),x(this,"allCandidatesReceived",!1),x(this,"isPreallocation",!1),x(this,"preMediaMap",new Map),x(this,"dataStreamChannelMap",new Map),x(this,"establishPromise",void 0),x(this,"recoveredDataChannelIds",[]),x(this,"currentDataChannelId",1),x(this,"supportAV1RtpSpec",!1),x(this,"mutex",void 0),x(this,"qualityLimitationReason",Zg.NONE),x(this,"isFirstConnected",!1),this.store=n,this.forceTurn=q2(t),this.mutex=new Jr("P2PConnection-mutex",n.clientId),this.peerConnection=new RTCPeerConnection(qh.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.isFirstConnected=!1,this.statsFilter=vb(this.peerConnection,B("STATS_UPDATE_INTERVAL"),void 0,jn()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,t.isPreallocation&&(this.isPreallocation=!0),this.establishPromise=this.establish()}getPreMedia(t){return this.preMediaMap.get(t)}isPreSub(){return this.preMediaMap.size>0}async updateRemoteRTPCapabilities(t,n){if(this.remoteCodecs=n,!this.remoteSDP)return void w.debug("[P2PConnection] cannot updateRemoteRTPCapabilities before remote SDP created, local codecs: ".concat(this.localCodecs,", codecs: ").concat(n));if(this.remoteSDP.updateRemoteCodec(t,n,this.store.codec)){const r=await this.peerConnection.createOffer(),i=this.logSDPExchange(r.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(r);const s=this.remoteSDP.toString();i?.(s),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}else w.debug("[P2PConnection] updateRemoteRTPCapabilities no need to exchange SDP.")}async establish(){try{this.peerConnection.addTransceiver("video",{direction:"recvonly"}),this.peerConnection.addTransceiver("audio",{direction:"recvonly"});const r=await this.peerConnection.createOffer();if(!r.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const i=Ld(r.sdp),s=await g2({filterRTX:!B("USE_PUB_RTX")&&!B("USE_SUB_RTX"),filterVideoFec:B("FILTER_VIDEO_FEC"),filterAudioFec:B("FILTER_AUDIO_FEC"),filterVideoCodec:B("FILTER_VIDEO_CODEC"),unsupportedVideoUplinkCodec:B("UNSUPPORTED_VIDEO_UPLINK_CODEC"),unsupportedVideoDownlinkCodec:B("UNSUPPORTED_VIDEO_DOWNLINK_CODEC")},this.extension);if(this.localCapabilities=wT(s),this.initialOffer=r,B("ENABLE_SVC")&&this.store.codec=="av1"){const c=await(async function(){try{const d=new RTCPeerConnection;d.addTransceiver("video",{direction:"sendonly",sendEncodings:[{scalabilityMode:qS.L1T3}]});const h=await d.createOffer();if(!h.sdp)return void d.close();const f=$i(h.sdp).mediaDescriptions[0];if(!f)return;const g=f.attributes.extmaps.find((E=>E.extensionName==="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension"));return d.close(),g}catch{return}})();var t;c&&(this.supportAV1RtpSpec=!0,(t=s.send)===null||t===void 0||t.videoExtensions.push(c))}let o;return r.sdp&&S2(r.sdp)&&(o=On(s),(n=o).send&&(nm(Me.VIDEO,n.send.videoExtensions),nm(Me.AUDIO,n.send.audioExtensions)),n.recv&&(nm(Me.VIDEO,n.recv.videoExtensions),nm(Me.AUDIO,n.recv.audioExtensions)),n.sendrecv&&(nm(Me.VIDEO,n.sendrecv.videoExtensions),nm(Me.AUDIO,n.sendrecv.audioExtensions))),Pa(Pa({},i),{},{rtpCapabilities:o||s,offerSDP:r.sdp})}catch(r){throw new de(V.GET_LOCAL_CONNECTION_PARAMS_FAILED,r.toString())}var n}async connect(t){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.initialOffer.sdp&&S2(this.initialOffer.sdp)&&(n=t.rtpCapabilities,r=this.localCapabilities,n.send&&(ST(Me.VIDEO,n.send.videoExtensions,r.send.videoExtensions),ST(Me.AUDIO,n.send.audioExtensions,r.send.audioExtensions)),n.recv&&(ST(Me.VIDEO,n.recv.videoExtensions,r.recv.videoExtensions),ST(Me.AUDIO,n.recv.audioExtensions,r.recv.audioExtensions))),this.remoteSDP=new class{get localCapabilities(){return On(this._localCapabilities)}get rtpCapabilities(){return On(this._rtpCapabilities)}get candidates(){return On(this._candidates)}get iceParameters(){return On(this._iceParameters)}get dtlsParameters(){return On(this._dtlsParameters)}constructor(d){let h=arguments.length>1&&arguments[1]!==void 0&&arguments[1],f=arguments.length>2&&arguments[2]!==void 0&&arguments[2];x(this,"sessionDesc",void 0),x(this,"_localCapabilities",void 0),x(this,"_rtpCapabilities",void 0),x(this,"_candidates",void 0),x(this,"_originCandidates",void 0),x(this,"_iceParameters",void 0),x(this,"_isUseExtmapAllowMixed",void 0),x(this,"_isUseLocalCodecs",void 0),x(this,"_dtlsParameters",void 0),x(this,"setup",void 0),x(this,"currentMidIndex",void 0),x(this,"cname",void 0),x(this,"useLocalCodecsMids",[]),x(this,"preloadSsrcs",[]),x(this,"firefoxSsrcMidMap",new Map),this._isUseExtmapAllowMixed=h,this._isUseLocalCodecs=f,d=On(d);const{iceParameters:g,dtlsParameters:E,candidates:S,rtpCapabilities:O,setup:A,localCapabilities:N,cname:j}=d;this._rtpCapabilities=O,this._candidates=S,this._originCandidates=On(S),this._iceParameters=g,this._dtlsParameters=E,this._localCapabilities=N,this.setup=A,this.cname=j,[this.sessionDesc]=this.updateRemoteRTPCapabilities(O),this.currentMidIndex=this.sessionDesc.mediaDescriptions.length-1}checkPreloadSsrcs(d){return d.length===this.preloadSsrcs.length&&d.every((h=>{var f;return be(f=this.preloadSsrcs).call(f,h)}))}preloadRemoteMedia(d){let h=0;const f=[],g=[];for(;d>0;){const E=[RI({ssrcId:OT+h},B("USE_SUB_RTX")?{rtx:OT+h+1}:{})],S="".concat(OT+h,"_").concat(wI+h),{ssrcs:O,ssrcGroups:A}=uE(E,this.cname,B("SYNC_GROUP")?S:void 0),N=this.preCreateOrRecycleSendMedia("video",O,A,void 0),j=[{ssrcId:wI+h}],U="".concat(OT+h,"_").concat(wI+h),{ssrcs:W,ssrcGroups:$}=uE(j,this.cname,B("SYNC_GROUP")?U:void 0),Z=this.preCreateOrRecycleSendMedia("audio",W,$,void 0);d--,h+=2,f.push(N,Z),g.push(O[0].ssrcId,W[0].ssrcId)}return this.useLocalCodecsMids.push(...f),this.preloadSsrcs=g,{mids:f,preSSRCs:g,isAvailable:!0}}preCreateOrRecycleSendMedia(d,h,f,g){const E=this.rtpCapabilities.send.videoCodecs,S=this._isUseLocalCodecs||E.length===0?this.localCapabilities.recv:this.rtpCapabilities.send;w.debug("create or recycle send media without remote rtp capabilities, ssrcs ",h[0].ssrcId);const O=d===Me.VIDEO?S.videoCodecs:S.audioCodecs,A=d===Me.VIDEO?S.videoExtensions:S.audioExtensions;this.currentMidIndex+=1;const N="".concat(this.currentMidIndex);let j={media:{mediaType:d,port:NT,protos:["UDP","TLS","RTP","SAVPF"],fmts:O.map((U=>U.payloadType.toString(10)))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:A,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:h,ssrcGroups:f,rtcpFeedbackWildcards:[],payloads:O,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(N)}};return j=this.mungSendMediaDesc(j,g),this.sessionDesc.mediaDescriptions.push(j),this.updateBundleMids(),N}toString(){return Nd(this.sessionDesc)}send(d,h,f,g){const{ssrcs:E,ssrcGroups:S}=uE(h,this.cname,B("SYNC_GROUP")?f:void 0),O=this.findPreloadMediaDesc(E);if(O){if(jn()&&this.firefoxSsrcMidMap.set(E[0].ssrcId,O.attributes.mid),g&&(g.twcc||g.remb)){const A=this.sessionDesc.mediaDescriptions.indexOf(O);return this.sessionDesc.mediaDescriptions[A]=this.mungSendMediaDesc(O,g),{mid:O.attributes.mid,needExchangeSDP:!0}}return{mid:O.attributes.mid,needExchangeSDP:!1}}{const A=this.findAvailableMediaIndex(d,E);let N;return A===-1||A===1&&(Br()||(function(){const j=Mt();return!(j.name!==Kt.CHROME||!j.osVersion)&&Number(j.version)<=90})()||B("ENABLE_ENCODED_TRANSFORM")&&El())||A===0&&!(function(j){const U=Mt();return!(U.name!==Kt.FIREFOX||!U.osVersion)&&Number(U.version)===j})(138)&&B("USE_SUB_RTX")||Hx()?(N=this.createOrRecycleSendMedia(d,E,S,"sendonly",g),this.updateBundleMids()):(N=On(this.sessionDesc.mediaDescriptions[A]),N.attributes.direction="sendonly",N.attributes.ssrcs=E,N.attributes.ssrcGroups=S,this.sessionDesc.mediaDescriptions[A]=this.mungSendMediaDesc(N,g)),jn()&&this.firefoxSsrcMidMap.set(E[0].ssrcId,N.attributes.mid),{mid:N.attributes.mid,needExchangeSDP:!0}}}sendDataChannel(){const{mediaDesc:d,needExchangeSDP:h}=this.createOrRecycleDataChannel();return this.updateBundleMids(),{mid:d.attributes.mid,needExchangeSDP:h}}batchSend(d){const h=d.map((E=>{let{kind:S,ssrcMsg:O,mslabel:A}=E;return this.send(S,O,A)})),f=[];let g=!1;return h.forEach((E=>{let{mid:S,needExchangeSDP:O}=E;O&&(g=!0),f.push(S)})),{mids:f,needExchangeSDP:g}}stopSending(d){const h=this.sessionDesc.mediaDescriptions.filter((f=>f.attributes.mid&&d.indexOf(f.attributes.mid)!==-1));if(h.length!==d.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");h.forEach((f=>{f.attributes.mid==="0"||jn()||Hx()?f.attributes.ssrcs=[]:(f.attributes.ssrcs=[],f.attributes.direction="inactive",f.media.port="0")})),this.updateBundleMids()}mute(d){const h=this.sessionDesc.mediaDescriptions.find((f=>f.attributes.mid===d));if(!h)throw new Error("mediaDescription not found with ".concat(d," in remote SDP when calling RemoteSDP.mute."));h.attributes.direction="inactive"}unmute(d){const h=this.sessionDesc.mediaDescriptions.find((f=>f.attributes.mid===d));if(!h)throw new Error("mediaDescription not found with ".concat(d," in remote SDP when calling RemoteSDP.unmute."));h.attributes.direction="sendonly"}muteRemote(d){const h=this.sessionDesc.mediaDescriptions.filter((f=>be(d).call(d,f.attributes.mid||"")));if(h.length!==d.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");h.forEach((f=>{f.attributes.direction="inactive"}))}unmuteRemote(d){const h=this.sessionDesc.mediaDescriptions.filter((f=>be(d).call(d,f.attributes.mid||"")));if(h.length!==d.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");h.forEach((f=>{f.attributes.direction="recvonly"}))}receive(d,h,f,g){d.forEach(((E,S)=>{this.createOrRecycleRecvMedia(E,[],"recvonly",h,f,g[S])})),this.updateBundleMids()}stopReceiving(d){const h=this.sessionDesc.mediaDescriptions.filter((f=>d.indexOf(f.attributes.mid)!==-1));if(h.length!==d.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");h.forEach((f=>{f.media.port="0",f.attributes.direction="inactive"})),this.updateBundleMids()}updateRemoteRTPCapabilities(d){const h=this.sessionDesc||$i((f=this._isUseExtmapAllowMixed,`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=ice-lite`.concat(f?`
a=extmap-allow-mixed`:"",`
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`)));var f;this._rtpCapabilities=d;let g=!1;const E=this.rtpCapabilities.send,S=this.localCapabilities.send,O=this.localCapabilities.recv,A=O.videoCodecs,N=O.audioCodecs,j=O.videoExtensions,U=O.audioExtensions;for(const Y of h.mediaDescriptions){var W;if(Y.attributes.direction!=="sendonly"||typeof Y.attributes.mid!="string"||!be(W=this.useLocalCodecsMids).call(W,Y.attributes.mid)){if(g=!0,Y.attributes.iceUfrag=this._iceParameters.iceUfrag,Y.attributes.icePwd=this._iceParameters.icePwd,Y.attributes.fingerprints=this._dtlsParameters.fingerprints,Y.attributes.candidates=this._candidates,Y.attributes.setup=this.setup,Y.media.mediaType==="application"&&(Y.attributes.sctpPort="5000"),Y.media.mediaType==="video")if(this._isUseLocalCodecs&&Y.attributes.direction==="sendonly"){var $;Y.media.fmts=A.map((ue=>ue.payloadType.toString(10))),Y.attributes.payloads=A,Y.attributes.extmaps=j;const ie=Y.attributes.mid;typeof ie!="string"||be($=this.useLocalCodecsMids).call($,ie)||this.useLocalCodecsMids.push(ie)}else if(E.videoCodecs.length===0){const ie=S.videoCodecs.filter((ue=>{var ge,Re;return(ge=ue.rtpMap)===null||ge===void 0?void 0:be(Re=ge.encodingName.toLowerCase()).call(Re,"vp8")}))||[S.videoCodecs[0]];Y.media.fmts=ie.map((ue=>ue.payloadType.toString(10))),Y.attributes.payloads=ie,Y.attributes.extmaps=[]}else Y.media.fmts=E.videoCodecs.map((ie=>ie.payloadType.toString(10))),Y.attributes.payloads=E.videoCodecs,Y.attributes.extmaps=E.videoExtensions;if(Y.media.mediaType==="audio")if(this._isUseLocalCodecs&&Y.attributes.direction==="sendonly"){var Z;Y.media.fmts=N.map((ue=>ue.payloadType.toString(10))),Y.attributes.payloads=N,Y.attributes.extmaps=U;const ie=Y.attributes.mid;typeof ie!="string"||be(Z=this.useLocalCodecsMids).call(Z,ie)||this.useLocalCodecsMids.push(ie)}else if(E.audioCodecs.length===0){const ie=S.audioCodecs.filter((ue=>{var ge,Re;return(ge=ue.rtpMap)===null||ge===void 0?void 0:be(Re=ge.encodingName.toLowerCase()).call(Re,"opus")}))||[S.audioCodecs[0]];Y.media.fmts=ie.map((ue=>ue.payloadType.toString(10))),Y.attributes.payloads=ie,Y.attributes.extmaps=[]}else Y.media.fmts=E.audioCodecs.map((ie=>ie.payloadType.toString(10))),Y.attributes.payloads=E.audioCodecs,Y.attributes.extmaps=E.audioExtensions,im(Y)}}return this.sessionDesc=h,this.currentMidIndex=h.mediaDescriptions.length-1,[this.sessionDesc,g]}updateCandidates(d){const h=this._originCandidates.filter((g=>g.transport==="udp")),f=[];if(h.forEach((g=>{f.push(RI(RI({},g),{},{foundation:"tcpcandidate",priority:Number(g.priority)-1+"",transport:"tcp",port:Number(g.port)+90+""}))})),h.length!==0){switch(d){case $r.TCP_RELAY:this._candidates=f;break;case $r.UDP_TCP_RELAY:case $r.RELAY:this._candidates=[...h,...f];break;default:this._candidates=h}for(const g of this.sessionDesc.mediaDescriptions)g.attributes.candidates=this.candidates}}restartICE(d){d=On(d),this._iceParameters=d,this.sessionDesc.mediaDescriptions.forEach((h=>{h.attributes.iceUfrag=d.iceUfrag,h.attributes.icePwd=d.icePwd}))}predictReceivingMids(d){const h=[];for(let f=0;f<d;f++)h.push((this.currentMidIndex+f+1).toString(10));return h}findAvailableMediaIndex(d,h){return this.sessionDesc.mediaDescriptions.findIndex((f=>{const g=f.media.mediaType===d&&f.media.port!=="0"&&(f.attributes.direction==="sendonly"||f.attributes.direction==="sendrecv")&&f.attributes.ssrcs.length===0;if(jn()){if(g){const E=this.firefoxSsrcMidMap.get(h[0].ssrcId);return!(E||f.attributes.mid!=="0"&&f.attributes.mid!=="1")||!(!E||E!==f.attributes.mid)}return!1}return g}))}createOrRecycleDataChannel(){for(const f of this.sessionDesc.mediaDescriptions)if(f.media.mediaType==="application")return{mediaDesc:f,needExchangeSDP:!1};this.currentMidIndex+=1;const d="".concat(this.currentMidIndex),h={media:{mediaType:"application",port:NT,protos:["UDP","DTLS","SCTP"],fmts:["webrtc-datachannel"]},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:[],fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[],rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,mid:"".concat(d),sctpPort:"5000"}};return this.sessionDesc.mediaDescriptions.push(h),{mediaDesc:h,needExchangeSDP:!0}}createOrRecycleRecvMedia(d,h,f,g,E,S){const O=d._mediaStreamTrack.kind,A=this.rtpCapabilities.recv,N=hE(O,A,this.localCapabilities.send,O===Me.VIDEO?g:E),j=O===Me.VIDEO?A.videoExtensions:A.audioExtensions;this.currentMidIndex+=1;const U="".concat(this.currentMidIndex);let W={media:{mediaType:O,port:NT,protos:["UDP","TLS","RTP","SAVPF"],fmts:N.map((Z=>Z.payloadType.toString(10)))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:j,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:h,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:N,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:f,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(U)}};W=this.mungRecvMediaDsec(W,d,S);const $=this.findFirstClosedMedia(O);if($){const Z=this.sessionDesc.mediaDescriptions.indexOf($);this.sessionDesc.mediaDescriptions[Z]=W}else this.sessionDesc.mediaDescriptions.push(W);return W}updateRemoteDtlsParameters(d){const h=new Set(this._dtlsParameters.fingerprints.map((E=>E.fingerprint))),f=new Set(d.map((E=>E.fingerprint)));let g=!1;h.size!==f.size&&(g=!0);for(const E of h)f.has(E)||(g=!0);return g}updateRemoteCodec(d,h,f){const g=[...new Set(this._rtpCapabilities.recv.videoCodecs.map((W=>W.rtpMap&&W.rtpMap.encodingName.toLowerCase()||"")).filter((W=>{var $;return be($=Object.keys(eE)).call($,W)})))],E=new Set(h);if(g.every((W=>E.has(W))))return w.debug("codecs has not changed, no need to updateRemoteCodec, codecs: ".concat(h)),!1;const S=this._rtpCapabilities.recv.videoCodecs.filter((W=>h.some(($=>{var Z;return be(Z=W.rtpMap&&W.rtpMap.encodingName.toLowerCase()||"").call(Z,$)}))));if(S.length===0)return w.debug("updateRemoteCodec failed, because cannot find matched codec, remoteCapabilities codecs: ".concat(g," codecs: ").concat(h)),!1;const O=[...new Set(S.map((W=>W.rtpMap&&W.rtpMap.encodingName.toLowerCase()||"")))];let A;if(w.debug("updateRemoteCodec, from ".concat(g," to ").concat(O)),d.length===0)A=this.sessionDesc.mediaDescriptions.filter((W=>W.media.mediaType==="video"&&W.attributes.direction==="recvonly"));else if(A=this.sessionDesc.mediaDescriptions.filter((W=>W.attributes.mid&&W.media.mediaType==="video"&&be(d).call(d,W.attributes.mid)&&W.attributes.direction==="recvonly")),A.length!==d.length)return w.debug("updateRemoteCodec failed, because cannot find mids, mids: ".concat(d,", codecs: ").concat(h)),!1;if(B("USE_PUB_RTX")||B("USE_SUB_RTX")){const W=Md(S,this.rtpCapabilities.recv.videoCodecs);S.push(...W)}this._rtpCapabilities.recv.videoCodecs=S;const N=this.localCapabilities.send,j=this.rtpCapabilities.recv,U=hE(Me.VIDEO,j,N,f);return A.forEach((W=>{const $=U.map((Z=>Z.payloadType.toString(10)));w.debug("updateRemoteCodec mid: ".concat(W.attributes.mid,", from"),W.attributes.payloads,"to",U),W.attributes.payloads=U,W.media.fmts=$})),!0}createOrRecycleSendMedia(d,h,f,g,E){const S=this.rtpCapabilities.send.videoCodecs,O=this._isUseLocalCodecs||S.length===0?this.localCapabilities.recv:this.rtpCapabilities.send,A=d===Me.VIDEO?O.videoCodecs:O.audioCodecs,N=d===Me.VIDEO?O.videoExtensions:O.audioExtensions;this.currentMidIndex+=1;const j="".concat(this.currentMidIndex);let U={media:{mediaType:d,port:NT,protos:["UDP","TLS","RTP","SAVPF"],fmts:A.map(($=>$.payloadType.toString(10)))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:N,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:h,ssrcGroups:f,rtcpFeedbackWildcards:[],payloads:A,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:g,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(j)}};U=this.mungSendMediaDesc(U,E);const W=this.findFirstClosedMedia(d);if(W){const $=this.sessionDesc.mediaDescriptions.indexOf(W);this.sessionDesc.mediaDescriptions[$]=U}else this.sessionDesc.mediaDescriptions.push(U);return U}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter((d=>d.media.port!=="0")).map((d=>d.attributes.mid))}mungRecvMediaDsec(d,h,f){const g=On(d);return dI(g),rm(g,h),uI(g,h),m2(g),RT(g,f,this.localCapabilities.send),g}mungSendMediaDesc(d,h){const f=On(d);return RT(f,h,this.localCapabilities.recv),im(f),f}updateRecvMedia(d,h){const f=this.sessionDesc.mediaDescriptions.findIndex((g=>g.attributes.mid===d));if(f!==-1){const g=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[f],h);this.sessionDesc.mediaDescriptions[f]=g}}bumpMid(d){this.currentMidIndex+=d}findFirstClosedMedia(d){return this.sessionDesc.mediaDescriptions.find((h=>jn()?h.media.port==="0"&&h.media.mediaType===d:h.media.port==="0"))}findPreloadMediaDesc(d){return this.sessionDesc.mediaDescriptions.find((h=>{var f;return((f=h.attributes)===null||f===void 0||(f=f.ssrcs[0])===null||f===void 0?void 0:f.ssrcId)===d[0].ssrcId}))}getSSRC(d){var h;return(h=this.sessionDesc.mediaDescriptions.find((f=>f.attributes.mid===d)))===null||h===void 0?void 0:h.attributes.ssrcs}}(Pa(Pa({},t),{},{localCapabilities:this.localCapabilities}),this.supportAV1RtpSpec,!(!B("ENABLE_PRE_SUB_WITH_PRE_PC")||!B("PRE_USE_LOCAL_CODECS"))&&Ib(this.store)),t.preallocation&&(this.isPreallocation=!0),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);const i=this.remoteSDP.toString(),s=v2(this.initialOffer.sdp,this.extension),o=this.logSDPExchange(s||"","offer","local","connect");this.store.descriptionStart(),await this.peerConnection.setLocalDescription({type:"offer",sdp:s}),o?.(i),await this.peerConnection.setRemoteDescription({type:"answer",sdp:i});const c=this.peerConnection.getTransceivers()[0];if(c!=null&&c.receiver&&this.tryBindTransportEvents(c.receiver),Ib(this.store))if(t.preallocation&&B("ENABLE_PRE_SUB_WITH_PRE_PC")){const d=B("PRE_SUB_NUM"),{mids:h,preSSRCs:f}=this.remoteSDP.preloadRemoteMedia(d);await Ud(this.peerConnection,this.remoteSDP,this.extension),w.debug("[".concat(this.store.clientId,"] [P2PConnection] preload media, in pre pc,add preload ssrcs ").concat(f)),this.presetMedia(h,f)}else{const{preSSRCs:d=[]}=t,h=d.map((g=>g.ssrcMsg[0].ssrcId));if(d.length===0)return;const{mids:f}=this.remoteSDP.batchSend(d.map((g=>Object.assign({},g))));await Ud(this.peerConnection,this.remoteSDP,this.extension),w.debug("[P2PConnection.connect] preload media, after join, add preload ssrcs ".concat(h)),this.presetMedia(f,h)}}catch(i){throw new de(V.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(i.toString()))}var n,r}presetMedia(t,n){t.forEach(((r,i)=>{this.peerConnection.getTransceivers().forEach((s=>{if(s.mid!=null&&r===s.mid&&s.receiver.track){const o=s.receiver.track;let c;o.kind==="video"&&B("ENABLE_PRE_RENDER")&&(c=new Fb({trackId:"track-".concat(o.kind,"-unknown-").concat(this.store.clientId,"_").concat(hn(5,""))},!0),c.updateVideoTrack(o),c.onFirstVideoFrameRender=()=>{var d;const h=this.preMediaMap.get(n[i]);h&&(h.firstVideoRender=Date.now()),(d=this.onFirstVideoRender)===null||d===void 0||d.call(this,n[i])},c.play(this.store.sessionId||void 0)),this.preMediaMap.set(n[i],{mid:r,track:o,player:c,transceiver:s})}})),this.store.peerReceiver()}))}checkDtlsParameters(t){return!!this.remoteSDP&&t.length>0&&this.remoteSDP.updateRemoteDtlsParameters(t)}async updateRemoteConnect(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateRemoteConnect before remote SDP created");let n=!1;const{rtpCapabilities:r}=t;if([,n]=this.remoteSDP.updateRemoteRTPCapabilities(r),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0){const o=this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);n=n||o}const{preSSRCs:i=[]}=t,s=i.map((o=>o.ssrcMsg[0].ssrcId));if(!this.remoteSDP.checkPreloadSsrcs(s)){const o=[],c=[];if(Array.from(this.preMediaMap.entries()).every((d=>{let[h,{mid:f,player:g,track:E}]=d;return o.push(f),c.push(h),this.preMediaMap.delete(h),g&&g.destroy(),!0})),o.length>0&&(this.remoteSDP.stopSending(o),await Ud(this.peerConnection,this.remoteSDP,this.extension),w.warn("[P2PConnection.updateRemoteConnect] preload media, failed, del preload ssrcs ".concat(c)),We.reportApiInvoke(this.store.sessionId,{name:Gn.PRELOAD_MEDIA_FAILED,options:[i,c],tag:Nn.TRACER}).onSuccess()),i.length>0){const{mids:d}=this.remoteSDP.batchSend(i.map((h=>Object.assign({},h))));await Ud(this.peerConnection,this.remoteSDP,this.extension),w.debug("[P2PConnection.updateRemoteConnect] preload media, after join, add preload ssrcs ".concat(s)),this.presetMedia(d,s)}}n?(await Ud(this.peerConnection,this.remoteSDP,this.extension),w.debug("[P2PConnection] updateRemoteConnect by exchanging SDP.")):w.debug("[P2PConnection] updateRemoteConnect no need to exchange SDP, because no need to update remote codecs (use local codecs)")}catch(n){throw new de(V.EXCHANGE_SDP_FAILED,"P2PConnection.updateRemoteConnect failed; ".concat(n.toString()))}}send(t,n,r){var i=this;return no((function*(){const s=yield Ft(i.mutex.lock("From P2PConnection.send"));try{if(!i.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const o=[],c=yT();t.forEach((N=>{const j=i.peerConnection.addTransceiver(N._mediaStreamTrack,Pa({direction:"sendonly"},N.trackMediaType==="video"&&i.supportAV1RtpSpec&&c?{sendEncodings:[{scalabilityMode:c}]}:{}));o.push(j),N._updateRtpTransceiver(j)})),jn()&&B("SIMULCAST")===!0&&(yield Ft(i.applySimulcastForFirefox(o,t)));const d=yield Ft(i.peerConnection.createOffer()),h=i.remoteSDP.predictReceivingMids(t.length),f=i.mungSendOfferSDP(d.sdp,t,h),g=$i(f),E=h.map((N=>{const j=g.mediaDescriptions.find((U=>U.attributes.mid===N));if(!j)throw new Error("Cannot extract ssrc from mediaDescription.");return h2(j,B("USE_PUB_RTX"))}));let S;try{S=yield E}catch(N){S=[],i.remoteSDP.receive(t,n,r,S);const j=i.remoteSDP.toString();throw yield Ft(i.peerConnection.setLocalDescription({type:"offer",sdp:f})),yield Ft(i.peerConnection.setRemoteDescription({type:"answer",sdp:j})),yield Ft(i.stopSending(h,!0)),N}i.remoteSDP.receive(t,n,r,S);const O=i.remoteSDP.toString(),A=i.logSDPExchange(f,"offer","local","send");return yield Ft(i.peerConnection.setLocalDescription({type:"offer",sdp:f})),yield Ft(i.applySimulcastEncodings(o,t)),yield Ft(i.applySendEncodings(o,t)),A?.(O),yield Ft(i.peerConnection.setRemoteDescription({type:"answer",sdp:O})),o.map(((N,j)=>{const U=h[j];return{localSSRC:E[j],id:U,transceiver:N}}))}catch(o){throw o instanceof de?o:new de(V.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(o.toString()))}finally{s()}}))()}async createDataChannels(t,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.createDataChannels before remote SDP created");let r=this.dataStreamChannelMap.get(t);if(r&&r.readyState==="open")w.debug("[P2PConnection] Channels are already available and can be reused directly.");else{const s=this.currentDataChannelId<1023?this.currentDataChannelId++:this.recoveredDataChannelIds.shift();if(typeof s!="number")throw new Error("create DataChannel error, because cannot get dc id");r=this.peerConnection.createDataChannel("datastream-channel",{id:s,negotiated:!0,ordered:!1,maxRetransmits:B("DATASTREAM_MAX_RETRANSMITS")}),r.binaryType="arraybuffer",this.dataStreamChannelMap.set(t,r)}n.forEach((s=>{s._updateOriginDataChannel(r)}));const{needExchangeSDP:i}=this.remoteSDP.sendDataChannel();if(i){const s=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:s});const o=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(o),w.debug("[P2PConnection] createDataChannels by exchanging SDP.")}else w.debug("[P2PConnection] createDataChannels no need to exchange SDP.");return}catch(r){throw r instanceof de?r:new de(V.EXCHANGE_SDP_FAILED,"P2PConnection.createDataChannels failed; ".concat(r.toString()))}}async stopDataChannels(t){try{const n=this.dataStreamChannelMap.get(t);return n&&(n.id&&this.recoveredDataChannelIds.push(n.id),n.close()),void this.dataStreamChannelMap.delete(t)}catch(n){throw n instanceof de?n:new de(V.DATACHANNEL_FAILED,"P2PConnection.stopDataChannels failed; ".concat(n.toString()))}}async stopSending(t,n){const r=n?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const i=this.peerConnection.getTransceivers().filter((d=>t.indexOf(d.mid)!==-1));if(i.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");i.map((d=>{var h;kT(this.id+d.mid,this),d.direction="inactive",(h=d.stop)===null||h===void 0||h.call(d)}));const s=await this.peerConnection.createOffer(),o=this.logSDPExchange(s.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(s),this.remoteSDP.stopReceiving(t);const c=this.remoteSDP.toString();o?.(c),await this.peerConnection.setRemoteDescription({type:"answer",sdp:c})}catch(i){throw new de(V.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(i.toString()))}finally{r&&r()}}async receive(t,n,r,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));const{mid:s,needExchangeSDP:o}=this.remoteSDP.send(t,n,r,i);o&&(await Ud(this.peerConnection,this.remoteSDP,this.extension),w.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," by exchanging SDP.")));const c=this.peerConnection.getTransceivers().find((d=>d.mid===s));if(!c)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:c.receiver.track,id:s,transceiver:c}}catch(s){throw new de(V.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(s.toString()))}}async batchReceive(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const{mids:n,needExchangeSDP:r}=this.remoteSDP.batchSend(t);return r&&(await Ud(this.peerConnection,this.remoteSDP,this.extension),w.debug("[".concat(this.store.clientId,"] [P2PConnection] batchReceive by exchanging SDP."))),n.map((i=>{const s=this.peerConnection.getTransceivers().find((o=>o.mid===i));if(!s)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:s.receiver.track,id:i,transceiver:s}}))}catch(n){throw new de(V.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(n.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");t.forEach((s=>{Array.from(this.preMediaMap.entries()).some((o=>{let[c,{mid:d,player:h}]=o;if(d===s)return this.preMediaMap.delete(c),h&&h.destroy(),!0}))})),this.remoteSDP.stopSending(t);const n=this.remoteSDP.toString(),r=this.logSDPExchange(n,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const i=await this.peerConnection.createAnswer();r?.(i.sdp||""),await this.peerConnection.setLocalDescription(i)}catch(n){throw new de(V.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n.toString()))}}async muteRemote(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteRemote mid=".concat(t," before remote SDP created."));this.remoteSDP.mute(t);const n=this.remoteSDP.toString(),r=this.logSDPExchange(n,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const i=await this.peerConnection.createAnswer();r?.(i.sdp||""),await this.peerConnection.setLocalDescription(i)}catch(n){throw new de(V.EXCHANGE_SDP_FAILED,"P2PConnection.muteRemote failed; ".concat(n.toString()))}}async unmuteRemote(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteRemote mid=".concat(t," before remote SDP created."));this.remoteSDP.unmute(t);const n=this.remoteSDP.toString(),r=this.logSDPExchange(n,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const i=await this.peerConnection.createAnswer();r?.(i.sdp||""),await this.peerConnection.setLocalDescription(i)}catch(n){throw new de(V.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteRemote failed; ".concat(n.toString()))}}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter((o=>o.mid&&t.indexOf(o.mid)!==-1));if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map((o=>{o.direction="inactive"}));const r=await this.peerConnection.createOffer(),i=this.logSDPExchange(r.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(r),this.remoteSDP.muteRemote(t);const s=this.remoteSDP.toString();i?.(s),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(n){throw new de(V.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(n.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter((o=>o.mid&&t.indexOf(o.mid)!==-1));if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map((async(o,c)=>{o.direction="sendonly"}));const r=await this.peerConnection.createOffer(),i=this.logSDPExchange(r.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(r),this.remoteSDP.unmuteRemote(t),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec(t,this.remoteCodecs,this.store.codec);const s=this.remoteSDP.toString();i?.(s),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(n){throw new de(V.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(n.toString()))}}restartICE(t){var n=this;return no((function*(){const r=yield Ft(n.mutex.lock("From P2PConnection.restartICE"));try{if(!n.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const i=Bt().supportPCSetConfiguration,s=B("FORCE_TURN_TCP")||n.forceTurn;if(t===$r.RELAY&&!i)return;if(i&&!s){const g=t===$r.RELAY?"relay":"all",E=n.peerConnection.getConfiguration();E.iceTransportPolicy!==g&&(w.debug("[".concat(n.store.clientId,"] restartICE change iceTransportPolicy from [").concat(E.iceTransportPolicy,"] to [").concat(g,"]")),E.iceTransportPolicy=g,n.peerConnection.setConfiguration(E))}n.remoteSDP.updateCandidates(t);const o=yield Ft(n.peerConnection.createOffer({iceRestart:!0}));if(!o.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const c=Ld(o.sdp),{remoteIceParameters:d}=yield c.iceParameters;n.remoteSDP.restartICE(d);const h=n.remoteSDP.toString(),f=n.logSDPExchange(o.sdp||"","offer","local","restartICE");n.store.descriptionStart(),yield Ft(n.peerConnection.setLocalDescription(o)),f?.(h),yield Ft(n.peerConnection.setRemoteDescription({type:"answer",sdp:h}))}catch(i){w.warning("[".concat(n.store.clientId,"] restart ICE failed, abort operation"),i)}finally{r()}}))()}async extendCandidate(){if(!this.remoteSDP||this.isFirstConnected)return;const t=await this.mutex.lock("From P2PConnection.extendCandidate");try{this.remoteSDP.updateCandidates($r.TCP_RELAY),await Ud(this.peerConnection,this.remoteSDP,this.extension)}catch(n){w.warning("[".concat(this.store.clientId,"] extend candidate failed, abort operation"),n)}finally{t()}}close(){var t;this.peerConnection.getTransceivers().forEach((n=>{kT(this.id+n.mid,this)})),this.preMediaMap.forEach((n=>{let{player:r}=n;r&&r.destroy()})),this.preMediaMap.clear(),this.peerConnection.close(),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear(),this.recoveredDataChannelIds=[],this.currentDataChannelId=1}getStats(){return Pa(Pa({},this.statsFilter.getStats()),{},{qualityLimitationReason:this.qualityLimitationReason})}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const r=await this.peerConnection.createOffer(),i=this.mungSendOfferSDP(r.sdp,[n],[t]);this.remoteSDP.updateRecvMedia(t,n);const s=this.remoteSDP.toString(),o=this.logSDPExchange(i,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:i}),o?.(s),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(r){throw new de(V.EXCHANGE_SDP_FAILED,r.toString())}}async updateSendParameters(t,n){const r=this.peerConnection.getTransceivers().filter((i=>i.mid===t));r.length===1&&(this.isVP8Simulcast(n)?jn()||await this.applySimulcastEncodings(r,[n]):await this.applySendEncodings(r,[n]))}setStatsRemoteVideoIsReady(t,n){this.statsFilter.setVideoIsReady2(t,n)}async replaceTrack(t,n){const r=this.peerConnection.getTransceivers().find((i=>i.mid===n));r&&await r.sender.replaceTrack(t._mediaStreamTrack)}async getSelectedCandidatePair(){const t=this.peerConnection.getReceivers();if(t.length>0&&t[0].transport&&t[0].transport.iceTransport&&t[0].transport.iceTransport.getSelectedCandidatePair&&t[0].transport.iceTransport.getSelectedCandidatePair()){const n=t[0].transport.iceTransport,{local:r,remote:i}=n.getSelectedCandidatePair();return{local:Pa(Pa({},Cc),{},{candidateType:r.type,protocol:r.protocol,address:r.address,port:r.port}),remote:Pa(Pa({},Cc),{},{candidateType:i.type,protocol:i.protocol,address:i.address,port:i.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t;(t=this.onICEConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;this.peerConnection.connectionState==="connected"&&(this.isFirstConnected=!0),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidateerror=t=>{if(t&&(t.errorCode||t.errorText)){var n;const r="code: ".concat(t.errorCode,", message: ").concat(t.errorText),i=t.port?"local: ".concat(t.port):"",s=Dh(t.url||"");w.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICECandidateError(").concat(r,"), url: ").concat(s||"",", host_candidate:").concat(i)),(n=this.onICECandidateError)===null||n===void 0||n.call(this,r)}},this.peerConnection.onicegatheringstatechange=t=>{t&&t.target&&"iceGatheringState"in t.target&&w.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] RTCPeerConnection.onicegatheringstatechange(").concat(t.target.iceGatheringState,")"))},this.peerConnection.onicecandidate=t=>{t.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,w.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout((()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,w.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))}),B("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){const n={iceServers:[]},r=t.cloudProxyServer||"disabled";return t.iceServers?n.iceServers=t.iceServers:t.turnServer&&(Xg(t.turnServer.servers)?n.iceServers=t.turnServer.servers:B("NEW_TURN_MODE")&&n.iceServers&&r==="disabled"?(B("USE_TURN_SERVER_OF_GATEWAY")?t.turnServer.serversFromGateway&&n.iceServers.push(...qh.newTurnServerConfigToIceServers(t.turnServer.serversFromGateway)):n.iceServers.push(...qh.newTurnServerConfigToIceServers(t.turnServer.servers)),B("NEW_FORCE_TURN")&&(n.iceTransportPolicy="relay")):t.turnServer.mode!=="off"&&(n.iceServers&&n.iceServers.push(...qh.turnServerConfigToIceServers(t.turnServer.servers)),B("USE_TURN_SERVER_OF_GATEWAY")&&n.iceServers&&t.turnServer.serversFromGateway&&n.iceServers.push(...qh.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),B("FORCE_TURN_TCP")?n.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach((i=>{i.forceturn&&(n.iceTransportPolicy="relay")})))),B("ENABLE_ENCODED_TRANSFORM")&&Bt().supportWebRTCEncodedTransform&&(n.encodedInsertableStreams=!0),n}static turnServerConfigToIceServers(t){const n=[];return t.forEach((r=>{r.security?r.tcpport&&n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turns:".concat(kd(r.turnServerURL),":").concat(r.tcpport,"?transport=tcp")}):(r.udpport&&!B("FORCE_TURN_TCP")&&n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":").concat(r.udpport,"?transport=udp")}),r.tcpport&&n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":").concat(r.tcpport,"?transport=tcp")}))})),n}static newTurnServerConfigToIceServers(t){const n=[];return t.forEach((r=>{const i=B("NEW_TURN_MODE");i===1?n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":3478?transport=udp")}):i===2?n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":3478?transport=tcp")}):i===3?n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turns:".concat(kd(r.turnServerURL),":443?transport=tcp")}):i===4&&(n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":3478?transport=udp")}),n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":3478?transport=tcp")}),n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turns:".concat(kd(r.turnServerURL),":443?transport=tcp")}))})),n}tryBindTransportEvents(t){const n=t.transport;if(n){this.transportEventReceiver=t,n.onstatechange=()=>{var i;n!=null&&n.state&&((i=this.onDTLSTransportStateChange)===null||i===void 0||i.call(this,n.state))},n.onerror=i=>{var s;(s=this.onDTLSTransportError)===null||s===void 0||s.call(this,"error"in i?i.error:i)};const r=n.iceTransport;r&&(r.onstatechange=()=>{const i=n?.iceTransport.state;var s;i&&((s=this.onICETransportStateChange)===null||s===void 0||s.call(this,i))},r.getSelectedCandidatePair&&(r.onselectedcandidatepairchange=()=>{if(r.getSelectedCandidatePair()){const{local:i,remote:s}=r.getSelectedCandidatePair()||{};if(i&&s){const o=i.address+":"+i.port,c=s.address+":"+s.port;w.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify(Dh(o)),", remote ").concat(JSON.stringify(Dh(c))))}}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(t,n){var r,i;if(n||(n=this.peerConnection.getSenders().find((N=>N.track===t._mediaStreamTrack))),!n)return w.warn("[".concat(t.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(t))return w.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!Bt().supportSetRtpSenderParameters)return w.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const s={},o={};switch(t._optimizationMode){case"motion":s.degradationPreference="maintain-framerate";break;case"detail":s.degradationPreference="maintain-resolution";break;case"balanced":s.degradationPreference="balanced"}const c=(function(A,N){return A.getTransceivers().find((j=>j.sender.track===N||j.receiver.track===N))})(this.peerConnection,t._mediaStreamTrack),d=m9(t);if((function(A){var N;return!(!B("ENABLE_AG_ADAPTATION")||!(A instanceof rT||be(N=A._hints).call(N,ln.CUSTOM_TRACK))||!B("FORCE_SUPPORT_AG_ADAPTATION")&&!(Wx(14,0,!1)&&Gx(17,4)||Bx(14)&&nb(17,4,!0)))})(t)&&c&&n&&d&&this.getLocalVideoStats&&be(r=["vp8","vp9"]).call(r,this.store.codec)){var h;const A=s.degradationPreference||(be(h=t._hints).call(h,ln.CUSTOM_TRACK)?B("CUSTOM_ADAPTATION_DEFAULT_MODE"):"maintain-framerate");(function(N,j,U,W,$,Z){if(kT(N,U),$(j),W!=="balanced"&&W!=="maintain-framerate"&&W!=="maintain-resolution")return;let Y=-1;K2(N,j);const ie=window.setInterval((()=>{const ge=DT.get(N);if(!B("ENABLE_AG_ADAPTATION")||!ge)return kT(N,U),void $(j);const Re=Z();if(Re.sendPackets>0&&Re.OutgoingAvailableBandwidth>0){if(Y===-1)return void(Y=Date.now());if(Date.now()-Y<1e3)return;const St=Re.sendFrameRate,Ct=Re.OutgoingAvailableBandwidth,[at,Qt]=A7(N,St,Ct,ge.adaptationConfig,j,W);Qt&&(U.qualityLimitationReason=Qt),at&&ge.adaptationConfig.scale!==at.scale&&(w.debug("[".concat(N,"] applyAdaptation: ").concat(U.qualityLimitationReason,`
           sendFps `).concat(St,", bwe ").concat(Ct,", switch from ").concat(ge.adaptationConfig.scale," to ").concat(at.scale," ")),ge.adaptationConfig=CI(CI({},ge.adaptationConfig),at),$(at))}}),B("CHECK_LOCAL_STATS_INTERVAL")),ue=CI({},j);DT.set(N,{timer:ie,adaptationConfig:ue,originConfig:j,adaptationFunc:$}),w.debug("[".concat(N,"] start adaptation, originConfig: ").concat(JSON.stringify(j),", degradationPreference: ").concat(W))})(this.id+c.mid,d,this,A,(N=>{n&&this.updateAdaptation(n,N)}),this.getLocalVideoStats.bind(this))}if(t._encoderConfig){var f;const{bitrateMax:A,frameRate:N,scaleResolutionDownBy:j}=t._encoderConfig;A&&(o.maxBitrate=1e3*A),(be(f=t._hints).call(f,ln.LOW_STREAM)||t.isUseScaleResolutionDownBy)&&(N&&(o.maxFramerate=Es(N)),j&&j>=1&&(o.scaleResolutionDownBy=j))}const{maxFramerate:g}=B("ENCODER_CONFIG_LIMIT");if(g&&typeof g=="number"&&(o.maxFramerate=o.maxFramerate?Math.min(o.maxFramerate,g):g),B("DSCP_TYPE")&&vl()){var E;const A=B("DSCP_TYPE");be(E=["very-low","low","medium","high"]).call(E,A)&&(o.networkPriority=A)}const S=n.getParameters(),O=(i=S.encodings)===null||i===void 0?void 0:i[0];jn()&&!O&&(s.encodings=[o]),O&&Object.assign(O,o),Object.assign(S,s),w.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(S.encodings))),await n.setParameters(S),await(async function(A,N,j){try{var U;if(!Bt().supportSetRtpSenderParameters||!(function(ie){return ie==="vp9"||ie==="av1"})(A)||!B("ENABLE_SVC"))return;const W={},$={},Z=N.getParameters(),Y=(U=Z.encodings)===null||U===void 0?void 0:U[0];$.scalabilityMode=yT(j),Y&&Object.assign(Y,$),Object.assign(Z,W),await N.setParameters(Z),w.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode success: ".concat(JSON.stringify(Z.encodings)))}catch(W){w.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode failed",W)}})(this.store.codec,n,B("SVC_MODE"))}async updateAdaptation(t,n){var r,i;if(!t)return w.debug("[updateAdaptation] no rtpSender found");if(!Bt().supportSetRtpSenderParameters)return w.debug("[updateAdaptation] Browser not support set rtp-sender parameters");const s={},{bitrateMax:o,frameRate:c,scaleResolutionDownBy:d}=n;o&&(s.maxBitrate=1e3*o),c&&(s.maxFramerate=Es(c)),d&&d>=1&&be(r=["vp8","vp9"]).call(r,this.store.codec)&&(s.scaleResolutionDownBy=d);const h=t.getParameters(),f=(i=h.encodings)===null||i===void 0?void 0:i[0];f&&Object.assign(f,s),Object.assign(h,{});try{await t.setParameters(h),w.debug("[updateAdaptation] updateRtpSenderEncodings: ".concat(JSON.stringify(h.encodings)))}catch(g){!("transport"in t)||t.transport&&t.transport.state==="connected"?this.peerConnectionState!=="connected"?w.debug("[updateAdaptation] peerConnection not connected}"):w.debug("[updateAdaptation] updateRtpSenderEncodings failed",g):w.debug("[updateAdaptation] rtpSender transport not connected}")}}async applySendEncodings(t,n){try{if(!Bt().supportSetRtpSenderParameters||t.length!==n.length)return;for(let r=0;r<t.length;r++){const i=t[r],s=n[r];s instanceof Sn&&!this.isVP8Simulcast(s)&&await this.updateRtpSenderEncodings(s,i.sender)}}catch{w.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(t,n,r){const i=$i(t);return n.forEach(((s,o)=>{const c=r[o],d=i.mediaDescriptions.find((h=>h.attributes.mid===c));d&&(rm(d,s),_2(d,s,this.store.codec))})),Nd(i)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var n;(n=this.onFirstAudioReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var n;(n=this.onFirstVideoReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var n;(n=this.onFirstAudioDecoded)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,n,r)=>{var i;(i=this.onFirstVideoDecoded)===null||i===void 0||i.call(this,t,n,r)},this.statsFilter.onSelectedLocalCandidateChanged=(t,n)=>{var r;(r=this.onSelectedLocalCandidateChanged)===null||r===void 0||r.call(this,t,n)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,n)=>{var r;(r=this.onSelectedRemoteCandidateChanged)===null||r===void 0||r.call(this,t,n)},this.statsFilter.onFirstVideoDecodedTimeout=t=>{var n;(n=this.onFirstVideoDecodedTimeout)===null||n===void 0||n.call(this,t)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(t,n){if(t.length===n.length)for(let d=0;d<t.length;d++){var r,i,s,o,c;const h=t[d],f=n[d];if(f instanceof Sn&&!be(r=f._hints).call(r,ln.LOW_STREAM)&&(i=f._encoderConfig)!==null&&i!==void 0&&i.bitrateMax&&((s=f._encoderConfig)===null||s===void 0?void 0:s.bitrateMax)>200&&(o=f._scalabilityMode)!==null&&o!==void 0&&o.numSpatialLayers&&((c=f._scalabilityMode)===null||c===void 0?void 0:c.numSpatialLayers)>1&&this.store.codec==="vp8"){const g={},E={high:1e3*(f._encoderConfig.bitrateMax-50),medium:5e4};g.encodings=[{rid:"m",active:!0,maxBitrate:E.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:E.high}];const S=h.sender.getParameters();await h.sender.setParameters(Object.assign(S,g))}}}async applySimulcastEncodings(t,n){if(!jn()&&t.length===n.length)for(let r=0;r<t.length;r++){const i=n[r];if(i instanceof Sn&&this.isVP8Simulcast(i)){const s=t[r],o={},c={high:1e3*(i._encoderConfig.bitrateMax-50),medium:5e4};o.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:c.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:c.medium,scaleResolutionDownBy:4}];const d=s.sender.getParameters();await s.sender.setParameters(Object.assign(d,o))}}}isVP8Simulcast(t){var n,r,i,s,o;return!!(t instanceof Sn&&B("SIMULCAST")&&this.store.codec==="vp8"&&!be(n=t._hints).call(n,ln.LOW_STREAM)&&(r=t._encoderConfig)!==null&&r!==void 0&&r.bitrateMax&&((i=t._encoderConfig)===null||i===void 0?void 0:i.bitrateMax)>200&&(s=t._scalabilityMode)!==null&&s!==void 0&&s.numSpatialLayers&&((o=t._scalabilityMode)===null||o===void 0?void 0:o.numSpatialLayers)>1)}logSDPExchange(t,n,r,i){if(B("SDP_LOGGING"))return w.upload("[".concat(this.store.clientId,"] exchanging ").concat(r," ").concat(n," SDP during P2PConnection.").concat(i,`
`),t),n==="offer"?s=>{this.logSDPExchange(s,"answer",r==="local"?"remote":"local",i)}:void 0}async getRemoteSSRC(t){if(!this.remoteSDP)return;const n=this.remoteSDP.getSSRC(t);return n&&n.length!==0?n[0].ssrcId:void 0}setConfiguration(t){if(Bt().supportPCSetConfiguration){const n=qh.resolvePCConfiguration(t);this.peerConnection.setConfiguration(n)}t.isPreallocation&&(this.isPreallocation=!0)}},Be(Ut.prototype,"updateRemoteRTPCapabilities",[Fi],Object.getOwnPropertyDescriptor(Ut.prototype,"updateRemoteRTPCapabilities"),Ut.prototype),Be(Ut.prototype,"connect",[Fi],Object.getOwnPropertyDescriptor(Ut.prototype,"connect"),Ut.prototype),Be(Ut.prototype,"updateRemoteConnect",[Fi],Object.getOwnPropertyDescriptor(Ut.prototype,"updateRemoteConnect"),Ut.prototype),Be(Ut.prototype,"createDataChannels",[Fi],Object.getOwnPropertyDescriptor(Ut.prototype,"createDataChannels"),Ut.prototype),Be(Ut.prototype,"receive",[Fi],Object.getOwnPropertyDescriptor(Ut.prototype,"receive"),Ut.prototype),Be(Ut.prototype,"batchReceive",[Fi],Object.getOwnPropertyDescriptor(Ut.prototype,"batchReceive"),Ut.prototype),Be(Ut.prototype,"stopReceiving",[Fi],Object.getOwnPropertyDescriptor(Ut.prototype,"stopReceiving"),Ut.prototype),Be(Ut.prototype,"muteRemote",[Fi],Object.getOwnPropertyDescriptor(Ut.prototype,"muteRemote"),Ut.prototype),Be(Ut.prototype,"unmuteRemote",[Fi],Object.getOwnPropertyDescriptor(Ut.prototype,"unmuteRemote"),Ut.prototype),Be(Ut.prototype,"muteLocal",[Fi],Object.getOwnPropertyDescriptor(Ut.prototype,"muteLocal"),Ut.prototype),Be(Ut.prototype,"unmuteLocal",[Fi],Object.getOwnPropertyDescriptor(Ut.prototype,"unmuteLocal"),Ut.prototype),Be(Ut.prototype,"close",[Fi],Object.getOwnPropertyDescriptor(Ut.prototype,"close"),Ut.prototype),Be(Ut.prototype,"updateEncoderConfig",[Fi],Object.getOwnPropertyDescriptor(Ut.prototype,"updateEncoderConfig"),Ut.prototype),Be(Ut.prototype,"updateSendParameters",[Fi],Object.getOwnPropertyDescriptor(Ut.prototype,"updateSendParameters"),Ut.prototype),Be(Ut.prototype,"replaceTrack",[Fi],Object.getOwnPropertyDescriptor(Ut.prototype,"replaceTrack"),Ut.prototype),Be(Ut.prototype,"updateAdaptation",[Fi],Object.getOwnPropertyDescriptor(Ut.prototype,"updateAdaptation"),Ut.prototype),Be(Ut.prototype,"getRemoteSSRC",[Fi],Object.getOwnPropertyDescriptor(Ut.prototype,"getRemoteSSRC"),Ut.prototype),Ut);function Fi(e,t,n){const r=e[t];if(typeof r!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const i=this.mutex,s=await i.lock("From P2PConnection.".concat(t));try{for(var o=arguments.length,c=new Array(o),d=0;d<o;d++)c[d]=arguments[d];return await r.apply(this,c)}finally{s()}},n}function NI(e,t){let n=document.createElement("video"),r=document.createElement("canvas");n.setAttribute("style","display:none"),r.setAttribute("style","display:none"),n.setAttribute("muted",""),n.muted=!0,n.setAttribute("autoplay",""),n.autoplay=!0,n.setAttribute("playsinline",""),r.width=Es(t.width),r.height=Es(t.height);const i=Es(t.framerate||15);document.body.append(n),document.body.append(r);let s=e._mediaStreamTrack;n.srcObject=new MediaStream([s]),n.play();const o=r.getContext("2d");if(!o)throw new le(V.UNEXPECTED_ERROR,"can not get canvas context");const c=Bt(),d=r.captureStream(c.supportRequestFrame?0:i).getVideoTracks()[0];d.canvas||(d.canvas=r),r.startCapture=()=>{if(!n)return r.stopCapture&&r.stopCapture();if(n.paused&&n.play(),n.videoHeight>2&&n.videoWidth>2){const f=n.videoWidth,g=n.videoHeight/f,E=r.width*g;Math.abs(E-r.height)>=2&&(w.debug("adjust low stream resolution","".concat(r.width,"x").concat(r.height," -> ").concat(r.width,"x").concat(E)),r.height=E)}o.drawImage(n,0,0,r.width,r.height),d.requestFrame&&d.requestFrame(),s!==e._mediaStreamTrack&&(s=e._mediaStreamTrack,n.srcObject=new MediaStream([s]))},r.stopCapture=xb((()=>r.startCapture&&r.startCapture()),i);const h=d.stop;return d.stop=()=>{h.call(d),n&&(n.remove(),n.srcObject=null,n=null),r&&(r.width=0,r.remove(),r.stopCapture&&r.stopCapture(),r.startCapture=void 0,r.stopCapture=void 0,r=null),w.debug("clean low stream renderer")},d}var J2=(function(e){return e[e.Video_Send_Type=190]="Video_Send_Type",e})(J2||{}),Da=(function(e){return e[e.Video_Send_Qp_Sum=2143]="Video_Send_Qp_Sum",e[e.Video_Send_Freeze=2082]="Video_Send_Freeze",e[e.Video_Recv_Qp_Sum=2144]="Video_Recv_Qp_Sum",e[e.Video_Recv_Freeze=2084]="Video_Recv_Freeze",e[e.Video_Render_Freeze_Time=2109]="Video_Render_Freeze_Time",e[e.Video_Render_Freeze_Time_Render=2147]="Video_Render_Freeze_Time_Render",e[e.Video_Render_Freeze_Time_Render2=2223]="Video_Render_Freeze_Time_Render2",e[e.Audio_Recv_Freeze=2083]="Audio_Recv_Freeze",e})(Da||{}),ut=(function(e){return e[e.Video_Send_Retransmit=2062]="Video_Send_Retransmit",e[e.Video_Send_Target_Encoded=2064]="Video_Send_Target_Encoded",e[e.Video_Send_Actual_Encoded=2060]="Video_Send_Actual_Encoded",e[e.Video_Send_Transmit=2066]="Video_Send_Transmit",e[e.Video_Send_Bandwidth=2061]="Video_Send_Bandwidth",e[e.Video_Capture_Height=2033]="Video_Capture_Height",e[e.Video_Capture_Width=2035]="Video_Capture_Width",e[e.Video_Capture_Frame_Rate=2034]="Video_Capture_Frame_Rate",e[e.Video_Send_Low_Height=2073]="Video_Send_Low_Height",e[e.Video_Send_Low_Frame_Rate=2075]="Video_Send_Low_Frame_Rate",e[e.Video_Send_Low_Width=2077]="Video_Send_Low_Width",e[e.Video_Send_Low_Bitrate=2069]="Video_Send_Low_Bitrate",e[e.Video_Send_Low_Package_Lost=2070]="Video_Send_Low_Package_Lost",e[e.Video_Send_Low_Package_Rate=2071]="Video_Send_Low_Package_Rate",e[e.Video_Send_Frame_Rate=2002]="Video_Send_Frame_Rate",e[e.Video_Send_Width=2003]="Video_Send_Width",e[e.Video_Send_Height=2004]="Video_Send_Height",e[e.Video_Send_Disabled=2095]="Video_Send_Disabled",e[e.Video_Send_Adaptation=2032]="Video_Send_Adaptation",e[e.Video_Send_Player_Status=2128]="Video_Send_Player_Status",e[e.Video_Send_Nacks=2009]="Video_Send_Nacks",e[e.Video_Send_Plis=2010]="Video_Send_Plis",e[e.Video_Send_Firs=2011]="Video_Send_Firs",e[e.Video_Send_Avg_Encode=2007]="Video_Send_Avg_Encode",e[e.Video_Send_Huge_Frame_Sent=2174]="Video_Send_Huge_Frame_Sent",e[e.Video_Send_Bytes_Retransmit=2173]="Video_Send_Bytes_Retransmit",e[e.Video_Send_Packages_Retransmit=2172]="Video_Send_Packages_Retransmit",e[e.Video_Send_Key_Frames_Encoded=2207]="Video_Send_Key_Frames_Encoded",e[e.Video_Send_Bitrate=2012]="Video_Send_Bitrate",e[e.Video_Send_Package_Rate=2031]="Video_Send_Package_Rate",e[e.Video_Send_Package_Lost=2005]="Video_Send_Package_Lost",e[e.Audio_Capture_PCM_Level=2104]="Audio_Capture_PCM_Level",e[e.Audio_Send_Level=2038]="Audio_Send_Level",e[e.Audio_Send_Bitrate=2039]="Audio_Send_Bitrate",e[e.Audio_Send_Package_Rate=2040]="Audio_Send_Package_Rate",e[e.Audio_Send_AEC_Return_Loss=2041]="Audio_Send_AEC_Return_Loss",e[e.Audio_Send_AEC_Return_Loss_Enhancement=2042]="Audio_Send_AEC_Return_Loss_Enhancement",e[e.Audio_Send_Freeze=2081]="Audio_Send_Freeze",e[e.Audio_Send_Disabled=2096]="Audio_Send_Disabled",e[e.Audio_Send_Bytes_Retransmit=2179]="Audio_Send_Bytes_Retransmit",e[e.Audio_Send_Packages_Retransmit=2180]="Audio_Send_Packages_Retransmit",e[e.Video_Recv_Height=2019]="Video_Recv_Height",e[e.Video_Recv_Width=2018]="Video_Recv_Width",e[e.Video_Recv_Frame_Rate_Output=2155]="Video_Recv_Frame_Rate_Output",e[e.Video_Recv_Jitter_Buffer=2023]="Video_Recv_Jitter_Buffer",e[e.Video_Recv_Current_Delay=2024]="Video_Recv_Current_Delay",e[e.Video_Recv_Nacks=2026]="Video_Recv_Nacks",e[e.Video_Recv_Plis=2027]="Video_Recv_Plis",e[e.Video_Recv_Firs=2028]="Video_Recv_Firs",e[e.Video_Recv_Disabled=2101]="Video_Recv_Disabled",e[e.Video_Recv_Player_Status=2129]="Video_Recv_Player_Status",e[e.Video_Recv_I_Frame_Delay=2149]="Video_Recv_I_Frame_Delay",e[e.Video_Render_Frame_Rate_Render=2022]="Video_Render_Frame_Rate_Render",e[e.Video_Render_Freeze_Duration=2156]="Video_Render_Freeze_Duration",e[e.Audio_Render_Level=2043]="Audio_Render_Level",e[e.Audio_Render_Freeze_Time_80ms=2226]="Audio_Render_Freeze_Time_80ms",e[e.Audio_Render_Freeze_Time_200ms=2227]="Audio_Render_Freeze_Time_200ms",e[e.Audio_Render_Freeze_Samples_80ms=2228]="Audio_Render_Freeze_Samples_80ms",e[e.Audio_Render_Freeze_Samples_200ms=2229]="Audio_Render_Freeze_Samples_200ms",e[e.Audio_Recv_PCM_Level=2105]="Audio_Recv_PCM_Level",e[e.Audio_Recv_Disabled=2102]="Audio_Recv_Disabled",e[e.Audio_Recv_Jitter_Buffer=2054]="Audio_Recv_Jitter_Buffer",e[e.Audio_Recv_Current_Delay=2047]="Audio_Recv_Current_Delay",e[e.Audio_Recv_Player_Status=2130]="Audio_Recv_Player_Status",e[e.Audio_Recv_Bitrate=2044]="Audio_Recv_Bitrate",e[e.Audio_Recv_Concealed_Samples=2148]="Audio_Recv_Concealed_Samples",e[e.Audio_Recv_Total_Samples_Received=2224]="Audio_Recv_Total_Samples_Received",e})(ut||{}),Ur=(function(e){return e[e.Video_Render_Frame_Rate_Decode=2021]="Video_Render_Frame_Rate_Decode",e[e.Video_Recv_Frame_Rate=2020]="Video_Recv_Frame_Rate",e[e.Video_Recv_Frame_Dropped=2181]="Video_Recv_Frame_Dropped",e[e.Video_Recv_Bytes_Retransmit=2175]="Video_Recv_Bytes_Retransmit",e[e.Video_Recv_Packages_Retransmit=2176]="Video_Recv_Packages_Retransmit",e[e.Video_Recv_Packages_Discarded=2198]="Video_Recv_Packages_Discarded",e[e.Video_Recv_Avg_Decode=2200]="Video_Recv_Avg_Decode",e[e.Video_Recv_Avg_Processing_Delay=2202]="Video_Recv_Avg_Processing_Delay",e[e.Video_Recv_Avg_Assembly_Time=2203]="Video_Recv_Avg_Assembly_Time",e[e.Video_Recv_Avg_Inter_Frame_Delay=2204]="Video_Recv_Avg_Inter_Frame_Delay",e[e.Video_Recv_Key_Frames_Decoded=2206]="Video_Recv_Key_Frames_Decoded",e[e.Video_Recv_Package_Lost=2014]="Video_Recv_Package_Lost",e[e.Video_Recv_Bitrate=2029]="Video_Recv_Bitrate",e[e.Video_Recv_Package_Rate=2078]="Video_Recv_Package_Rate",e[e.Audio_Recv_Jitter=2055]="Audio_Recv_Jitter",e[e.Audio_Recv_Bytes_Retransmit=2178]="Audio_Recv_Bytes_Retransmit",e[e.Audio_Recv_Packages_Retransmit=2177]="Audio_Recv_Packages_Retransmit",e[e.Audio_Recv_Packages_Discarded=2199]="Audio_Recv_Packages_Discarded",e[e.Audio_Recv_Avg_Processing_Delay=2201]="Audio_Recv_Avg_Processing_Delay",e[e.Audio_Recv_Package_Rate=2046]="Audio_Recv_Package_Rate",e[e.Audio_Recv_Package_Lost=2045]="Audio_Recv_Package_Lost",e})(Ur||{}),Bi=(function(e){return e[e.RTT=2006]="RTT",e[e.CONN_TYPE=801]="CONN_TYPE",e[e.STATS_UPDATE_INTERVAL=2205]="STATS_UPDATE_INTERVAL",e})(Bi||{}),LT=(function(e){return e[e.RTC_PEER_CONNECTION_STATE=2219]="RTC_PEER_CONNECTION_STATE",e})(LT||{});const xh=1e3,MT=6,_E=3,P7=Math.max(MT,_E,60);function $e(e,t,n){n!=null&&Number.isFinite(n)&&(e[t]=Math.round(Math.max(0,n)))}function Q2(e){const t={[Bi.CONN_TYPE]:0,[Bi.RTT]:e.rtt,[Bi.STATS_UPDATE_INTERVAL]:e.updateInterval?Math.round(Math.max(0,e.updateInterval)):void 0};switch(e.selectedCandidatePair.localCandidate.candidateType){case"relay":{const n=e.selectedCandidatePair.localCandidate.relayProtocol;n==="udp"&&(t[Bi.CONN_TYPE]=1),n==="tcp"&&(t[Bi.CONN_TYPE]=3),n==="tls"&&(t[Bi.CONN_TYPE]=4);break}case"srflx":t[Bi.CONN_TYPE]=2;break;case"unknown":t[Bi.CONN_TYPE]=5;break;default:t[Bi.CONN_TYPE]=0}return t}function Z2(e){let t=0;switch(e){case"none":t=0;break;case"cpu":t=1;break;case"bandwidth":t=2;break;case"other":t=3}return t}class $2 extends xn{constructor(t){super(),x(this,"store",void 0),x(this,"uploadWRTCStatsTimer",void 0),x(this,"uploadOutboundDenoiserStatsTimer",void 0),x(this,"uploadExtStatsTimer",void 0),x(this,"uploadExtUsageStatsTimer",void 0),x(this,"uploadInboundExtStatsTimer",void 0),x(this,"requestStats",void 0),x(this,"requestTransportStats",void 0),x(this,"requestLocalMedia",void 0),x(this,"requestRemoteMedia",void 0),x(this,"requestAllTracks",void 0),x(this,"requestVideoIsReady",void 0),x(this,"requestUploadStats",void 0),x(this,"requestUpload",void 0),x(this,"uploadOutboundStarted",!1),x(this,"uploadInboundStarted",!1),x(this,"uploadTransportStarted",!1),x(this,"uploadBaseStatsStarted",!1),x(this,"uploadExtensionUsageStarted",!1),x(this,"lastRecvStats",void 0),x(this,"lastSendStats",void 0),x(this,"lastRefRecvStats",void 0),x(this,"lastRefSendStats",void 0),x(this,"lastNormalRecvStats",void 0),x(this,"lastNormalSendStats",void 0),x(this,"lastExtendStats",{}),x(this,"needUploadStats",{}),x(this,"needUploadRenderFreezeTime",!0),x(this,"lastUploadCompensateTime",-1),x(this,"uploadCompensateDeltaTime",0),this.store=t}uploadWRTCStats(t){if(!this.requestStats||!this.requestUploadStats)return;const n=t%_E==0,r=t%MT==0,i=t%60==0;let s,o;if(this.uploadTransportStarted&&(s=this.requestStats(),this.store.useP2P&&(o=this.requestStats(!0))),!s&&this.uploadOutboundStarted&&(s=this.requestStats()),!o&&this.uploadInboundStarted&&(o=this.requestStats(!0)),s||o){var c;const d={};if(this.uploadTransportStarted&&s){const f=this.getTransportStats(s,o,n);f&&(d.misc=[f])}if(this.uploadOutboundStarted&&s){const f=this.getOutboundStats(s,r?this.lastNormalSendStats:void 0,n?this.lastRefSendStats:void 0,this.lastSendStats,i);f&&(d.outbound=[f])}if(this.uploadInboundStarted&&o){this.uploadCompensateStats(t);const f=this.getInboundStats(o,r?this.lastNormalRecvStats:void 0,n?this.lastRefRecvStats:void 0,this.lastRecvStats);f&&(d.inbound=f)}const h=(c=this.requestTransportStats)===null||c===void 0?void 0:c.call(this).connectState;h&&(Array.isArray(d.misc)?d.misc[0]&&d.misc[0].addition&&(d.misc[0].addition[LT.RTC_PEER_CONNECTION_STATE]=Eb[h]):d.misc=[{addition:{[LT.RTC_PEER_CONNECTION_STATE]:Eb[h]}}]),this.needUploadStats.sendType&&(Array.isArray(d.outbound)&&d.outbound[0]&&d.outbound[0].high&&(d.outbound[0].high[J2.Video_Send_Type]=this.needUploadStats.sendType),this.needUploadStats.sendType=void 0),this.requestUploadStats(d)}this.lastRecvStats=o,this.lastSendStats=s,r&&(this.lastNormalRecvStats=o,this.lastNormalSendStats=s),n&&(this.lastRefRecvStats=o,this.lastRefSendStats=s)}startUploadWRTCStats(){if(this.uploadWRTCStatsTimer)return;this.uploadBaseStatsStarted=!0;let t=1;this.uploadWRTCStatsTimer=window.setInterval((()=>{if(!this.uploadTransportStarted&&!this.uploadInboundStarted&&!this.uploadOutboundStarted){if(this.uploadBaseStatsStarted){var n,r;const i=(n=this.requestTransportStats)===null||n===void 0?void 0:n.call(this);return void(i&&((r=this.requestUploadStats)===null||r===void 0||r.call(this,{misc:[{addition:{[LT.RTC_PEER_CONNECTION_STATE]:Eb[i.connectState]}}]})))}return this.stopUploadWRTCStats()}this.uploadWRTCStats(t),++t===P7+1&&(t=1)}),xh)}uploadCompensateStats(t){if(!this.requestStats||!this.requestUploadStats||!this.requestRemoteMedia)return;const n=t%_E==0&&this.needUploadRenderFreezeTime;if(!this.uploadInboundStarted||!n)return;if(this.lastUploadCompensateTime===-1)return void(this.lastUploadCompensateTime=Date.now());const r=Math.max(-6e3,Date.now()-this.lastUploadCompensateTime-6e3);if(this.uploadCompensateDeltaTime+=r,this.lastUploadCompensateTime=Date.now(),this.uploadCompensateDeltaTime<6e3)return;const i=Math.min(Math.floor(this.uploadCompensateDeltaTime/6e3),10);this.uploadCompensateDeltaTime-=6e3*i;const s=this.requestStats(!0);new Array(i).fill(0).forEach((()=>{if(!this.requestStats||!this.requestUploadStats||!this.requestRemoteMedia)return;const o={};if(this.uploadInboundStarted&&s){const c=this.requestRemoteMedia()||[],d=[];c.forEach((h=>{let[f,g]=h;const E={peer:f.uid};if(f._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(f._videoSSRC)&&g.has(Me.VIDEO)&&f.videoTrack){const S=(function(O,A,N){if(!A.videoRecv.find((U=>U.ssrc===O)))return;const j={};if(N&&N._player){const U=N._player,{renderFreezeAccTime2:W,videoElementStatus:$}=U;if(Ac.visibility==="visible"&&$===Qr.PLAYING&&Bt().supportRequestVideoFrameCallback){const Z=Math.min(6e3,W);U.renderFreezeAccTime2=Math.max(0,W-Z),$e(j,Da.Video_Render_Freeze_Time_Render2,Z),B("USE_NEW_RENDER_FREEZE_TIME")&&$e(j,Da.Video_Render_Freeze_Time_Render,Z)}}return j})(f._videoSSRC,s,f.videoTrack);S&&(E.video=S)}E.video&&d.push(E)})),d.length>0&&(o.inbound=d,this.requestUploadStats(o))}}))}stopUploadWRTCStats(){window.clearInterval(this.uploadWRTCStatsTimer),this.uploadWRTCStatsTimer=void 0,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0),this.lastRefSendStats&&(this.lastRefSendStats.videoSend=[],this.lastRefSendStats.audioSend=[],this.lastRefSendStats=void 0),this.lastRefRecvStats&&(this.lastRefRecvStats.videoRecv=[],this.lastRefRecvStats.audioRecv=[],this.lastRefRecvStats=void 0),this.lastNormalSendStats&&(this.lastNormalSendStats.videoSend=[],this.lastNormalSendStats.audioSend=[],this.lastNormalSendStats=void 0),this.lastNormalRecvStats&&(this.lastNormalRecvStats.videoRecv=[],this.lastNormalRecvStats.audioRecv=[],this.lastNormalRecvStats=void 0),this.lastExtendStats={},this.needUploadStats={},this.lastUploadCompensateTime=-1,this.uploadCompensateDeltaTime=0,this.needUploadRenderFreezeTime=!0}getTransportStats(t,n,r){if(!this.requestStats)return;if(!r)return t.rtt==null?void 0:{addition:{[Bi.RTT]:t.rtt,[Bi.CONN_TYPE]:void 0,[Bi.STATS_UPDATE_INTERVAL]:t.updateInterval||void 0}};const i=Q2(t);if(this.store.useP2P){if(n){const s=Q2(n);i[Bi.CONN_TYPE]+=s[Bi.CONN_TYPE]<<3}i[Bi.CONN_TYPE]+=110}else i[Bi.CONN_TYPE]+=100;return{addition:i}}getOutboundStats(t,n,r,i,s){if(!this.requestUploadStats||!this.requestLocalMedia)return;const o=this.requestLocalMedia();if(!o||o.length===0)return;let c,d,h;return o.forEach((f=>{let[g,{track:E,ssrcs:S}]=f;switch(g){case ve.LocalVideoLowTrack:case ve.LocalVideoTrack:if(g===ve.LocalVideoTrack){var O;const A=(function(W,$,Z,Y,ie,ue){const ge=$.videoSend.find((at=>at.ssrc===W));if(!ge)return;const Re={},{sentFrame:St,inputFrame:Ct}=ge;if(Y&&($e(Re,Da.Video_Send_Qp_Sum,ge.qpSumPerFrame),Ct&&St)){const at=Ct.frameRate,Qt=St.frameRate;Re[Da.Video_Send_Freeze]=(function(qt,ti){let _e=!0;return _e=!(qt<=5)&&(qt<=10?ti<3:qt<=20?ti<4:ti<5),_e})(at,Qt)?1:0}if(ie){switch(St&&($e(Re,ut.Video_Send_Height,St.height),$e(Re,ut.Video_Send_Width,St.width),$e(Re,ut.Video_Send_Frame_Rate,St.frameRate)),Re[ut.Video_Send_Disabled]=Z._originMediaStreamTrack&&!Z._originMediaStreamTrack.enabled||Z._mediaStreamTrack&&!Z._mediaStreamTrack.enabled?1:0,ge.adaptionChangeReason){case"none":Re[ut.Video_Send_Adaptation]=0;break;case"cpu":Re[ut.Video_Send_Adaptation]=1;break;case"bandwidth":Re[ut.Video_Send_Adaptation]=2;break;case"other":Re[ut.Video_Send_Adaptation]=3}let at=0;ge.adaptionChangeReason&&(at+=Z2(ge.adaptionChangeReason)),$.qualityLimitationReason&&(at+=Z2($.qualityLimitationReason)<<3),Re[ut.Video_Send_Adaptation]=at,Re[ut.Video_Send_Player_Status]=Db[Z._player?Z._player.videoElementStatus:"uninit"],$e(Re,ut.Video_Send_Nacks,ge.nacksCount),$e(Re,ut.Video_Send_Plis,ge.plisCount),$e(Re,ut.Video_Send_Firs,ge.firsCount),$e(Re,ut.Video_Send_Avg_Encode,ge.avgEncodeMs),$e(Re,ut.Video_Send_Huge_Frame_Sent,ge.hugeFramesSent),$e(Re,ut.Video_Send_Bytes_Retransmit,ge.retransmittedBytesSent),$e(Re,ut.Video_Send_Packages_Retransmit,ge.retransmittedPacketsSent),$e(Re,ut.Video_Send_Key_Frames_Encoded,ge.keyFramesEncoded);const Qt=ie.videoSend.find((qt=>qt.ssrc===W));if(Qt){let qt=xh*_E;Qt.timestamp&&ge.timestamp&&(qt=ge.timestamp-Qt.timestamp),Qt.packets!=null&&ge.packets!=null&&$e(Re,ut.Video_Send_Package_Rate,1e3*(ge.packets-Qt.packets)/qt),ge.packetsLost!=null&&Qt.packetsLost!=null&&$e(Re,ut.Video_Send_Package_Lost,ge.packetsLost-Qt.packetsLost),Qt.bytes!=null&&ge.bytes!=null&&$e(Re,ut.Video_Send_Bitrate,8*(ge.bytes-Qt.bytes)/qt)}}return Re})(S[0].ssrcId,t,E,n,r),N=E.__className__==="CameraVideoTrack"?3:be(O=E._hints).call(O,ln.SCREEN_TRACK)?7:10;(this.lastExtendStats.sendType!==N||s)&&(this.needUploadStats={sendType:N},this.lastExtendStats.sendType=N);const j=E&&(function(W,$,Z,Y){const ie=$.videoSend.find((ge=>ge.ssrc===W));if(!ie)return null;const ue={};if(Y){const ge=ie.inputFrame,Re=ge&&ge.height||Z.videoHeight||0,St=ge&&ge.width||Z.videoWidth||0,Ct=ge&&ge.frameRate||0;$e(ue,ut.Video_Capture_Height,Re),$e(ue,ut.Video_Capture_Width,St),$e(ue,ut.Video_Capture_Frame_Rate,Ct)}return ue})(S[0].ssrcId,t,E,!!r),U=(function(W,$){const Z={};return $&&($e(Z,ut.Video_Send_Retransmit,W.bitrate.retransmit),$e(Z,ut.Video_Send_Target_Encoded,W.bitrate.targetEncoded),$e(Z,ut.Video_Send_Actual_Encoded,W.bitrate.actualEncoded),$e(Z,ut.Video_Send_Transmit,W.bitrate.transmit),$e(Z,ut.Video_Send_Bandwidth,W.sendBandwidth)),Z})(t,!!r);d=Object.assign({},A,j,U)}else h=(function(A,N,j,U,W){const $=N.videoSend.find((Y=>Y.ssrc===A));if(!$)return;const Z={};if(U){const Y=$.sentFrame;Y&&($e(Z,ut.Video_Send_Low_Height,Y.height),$e(Z,ut.Video_Send_Low_Width,Y.width),$e(Z,ut.Video_Send_Low_Frame_Rate,Y.frameRate));const ie=U.videoSend.find((ue=>ue.ssrc===A));if(ie){let ue=xh*MT;ie.timestamp&&$.timestamp&&(ue=$.timestamp-ie.timestamp),ie.packets!=null&&$.packets!=null&&$e(Z,ut.Video_Send_Low_Package_Rate,1e3*($.packets-ie.packets)/ue),$.packetsLost!=null&&ie.packetsLost!=null&&$e(Z,ut.Video_Send_Low_Package_Lost,$.packetsLost-ie.packetsLost),ie.bytes!=null&&$.bytes!=null&&$e(Z,ut.Video_Send_Low_Bitrate,8*($.bytes-ie.bytes)/ue)}}return Z})(S[0].ssrcId,t,0,r);break;case ve.LocalAudioTrack:c=E&&(function(A,N,j,U,W,$){const Z=N.audioSend.find((ie=>ie.ssrc===A));if(!Z)return;const Y={};if(W){Y[ut.Audio_Send_Disabled]=j._originMediaStreamTrack&&!j._originMediaStreamTrack.enabled||j._mediaStreamTrack&&!j._mediaStreamTrack.enabled?1:0;const ie=100*j._source.getAccurateVolumeLevel(),ue=Z.inputLevel;if(ue!=null){const Re=Math.ceil(50*Math.log10(100*ue+1));$e(Y,ut.Audio_Send_Level,Re)}$e(Y,ut.Audio_Capture_PCM_Level,ie),$e(Y,ut.Audio_Send_AEC_Return_Loss,Z.aecReturnLoss),$e(Y,ut.Audio_Send_AEC_Return_Loss_Enhancement,Z.aecReturnLossEnhancement),$e(Y,ut.Audio_Send_Bytes_Retransmit,Z.retransmittedBytesSent),$e(Y,ut.Audio_Send_Packages_Retransmit,Z.retransmittedPacketsSent),Y[ut.Audio_Send_Freeze]=0;const ge=W.audioSend.find((Re=>Re.ssrc===A));if(ge){let Re=xh*MT;ge.timestamp&&Z.timestamp&&(Re=Z.timestamp-ge.timestamp),ge.bytes!=null&&Z.bytes!=null&&$e(Y,ut.Audio_Send_Bitrate,8*(Z.bytes-ge.bytes)/Re),ge.packets!=null&&Z.packets!=null&&$e(Y,ut.Audio_Send_Package_Rate,1e3*(Z.packets-ge.packets)/Re)}}return Y})(S[0].ssrcId,t,E,0,r)}})),{high:d,low:h,audio:c}}getInboundStats(t,n,r,i){if(!this.requestRemoteMedia)return;const s=this.requestRemoteMedia()||[],o=[];return s.forEach((c=>{let[d,h]=c;const f={peer:d.uid};if(h.has(Me.VIDEO)&&d.videoTrack){const g=d._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(d._videoSSRC)||!1,E=d.videoTrack?(function(S,O,A,N,j,U,W,$){const Z=O.videoRecv.find((at=>at.ssrc===S));if(!Z)return;const Y={},{receivedFrame:ie,outputFrame:ue,decodeFrameRate:ge}=Z;$e(Y,Ur.Video_Render_Frame_Rate_Decode,ge),Z.framesRateFirefox&&$e(Y,Ur.Video_Recv_Frame_Rate,Z.framesRateFirefox),ie&&$e(Y,Ur.Video_Recv_Frame_Rate,ie.frameRate),$e(Y,Ur.Video_Recv_Frame_Dropped,Z.framesDroppedCount),$e(Y,Ur.Video_Recv_Bytes_Retransmit,Z.retransmittedBytesReceived),$e(Y,Ur.Video_Recv_Packages_Retransmit,Z.retransmittedPacketsReceived),$e(Y,Ur.Video_Recv_Packages_Discarded,Z.packetsDiscarded),$e(Y,Ur.Video_Recv_Avg_Decode,Z.avgDecodeMs),$e(Y,Ur.Video_Recv_Avg_Processing_Delay,Z.avgProcessingDelayMs),$e(Y,Ur.Video_Recv_Avg_Assembly_Time,Z.avgFramesAssembledFromMultiplePacketsMs),$e(Y,Ur.Video_Recv_Avg_Inter_Frame_Delay,Z.avgInterFrameDelayMs),$e(Y,Ur.Video_Recv_Key_Frames_Decoded,Z.keyFramesDecoded);const Re=$&&$.videoRecv.find((at=>at.ssrc===S));if(Re){const at=O.timestamp-$.timestamp||xh;Z.packetsLost!=null&&Re.packetsLost!=null&&$e(Y,Ur.Video_Recv_Package_Lost,Z.packetsLost-Re.packetsLost),Re.bytes!=null&&Z.bytes!=null&&$e(Y,Ur.Video_Recv_Bitrate,8*(Z.bytes-Re.bytes)/at),Re.packets!=null&&Z.packets!=null&&$e(Y,Ur.Video_Recv_Package_Rate,1e3*(Z.packets-Re.packets)/at)}const St=U&&U.videoRecv.find((at=>at.ssrc===S));if(St&&($e(Y,Da.Video_Recv_Qp_Sum,Z.qpSumPerFrame),Y[Da.Video_Recv_Freeze]=N&&mE.isRemoteVideoFreeze(A,Z,St)?1:0),W){var Ct;const at=W.videoRecv.find((qt=>qt.ssrc===S));ie?($e(Y,ut.Video_Recv_Height,ie.height),$e(Y,ut.Video_Recv_Width,ie.width)):A&&($e(Y,ut.Video_Recv_Height,A._videoHeight||0),$e(Y,ut.Video_Recv_Width,A._videoWidth||0)),ue&&$e(Y,ut.Video_Recv_Frame_Rate_Output,ue.frameRate);const Qt=(Ct=A._player)===null||Ct===void 0?void 0:Ct.rendFrameRate.toFixed(0);if(Qt&&$e(Y,ut.Video_Render_Frame_Rate_Render,+Qt),$e(Y,ut.Video_Recv_Jitter_Buffer,Z.jitterBufferMs),$e(Y,ut.Video_Recv_Current_Delay,Z.currentDelayMs),$e(Y,ut.Video_Recv_Firs,Z.firsCount),$e(Y,ut.Video_Recv_Nacks,Z.nacksCount),$e(Y,ut.Video_Recv_Plis,Z.plisCount),A){Y[ut.Video_Recv_Disabled]=A._originMediaStreamTrack.enabled&&A._mediaStreamTrack.enabled?0:1;const qt=A._player;if(qt){const{freezeTimeCounterList:ti,renderFreezeAccTime:_e,renderFreezeAccTime2:Ae,videoElementStatus:je}=qt;if(ti&&ti.length>0&&$e(Y,Da.Video_Render_Freeze_Time,ti.splice(0,1)[0]),j&&Ac.visibility==="visible"&&je===Qr.PLAYING&&Bt().supportRequestVideoFrameCallback){const Ee=Math.min(6e3,Ae);qt.renderFreezeAccTime2=Math.max(0,Ae-Ee),$e(Y,Da.Video_Render_Freeze_Time_Render2,Ee);const b=Math.min(6e3,_e);qt.renderFreezeAccTime=Math.max(0,_e-b),$e(Y,Da.Video_Render_Freeze_Time_Render,B("USE_NEW_RENDER_FREEZE_TIME")?Ee:b)}if(typeof Z.totalFreezesDuration=="number"){const Ee=at&&at.totalFreezesDuration?Z.totalFreezesDuration-at.totalFreezesDuration:Z.totalFreezesDuration;$e(Y,ut.Video_Render_Freeze_Duration,1e3*Ee)}}}if(Y[ut.Video_Recv_Player_Status]=Db[A._player?A._player.videoElementStatus:"uninit"],at&&Z.totalInterFrameDelay!==void 0&&Z.totalSquaredInterFrameDelay!==void 0&&at.totalInterFrameDelay!==void 0&&at.totalSquaredInterFrameDelay!==void 0){const qt=Z.totalInterFrameDelay-at.totalInterFrameDelay,ti=Z.totalSquaredInterFrameDelay-at.totalSquaredInterFrameDelay,_e=Z.framesDecodeCount-at.framesDecodeCount,Ae=qt/_e*1e3,je=Math.round(1e3*Math.sqrt((ti-Math.pow(qt,2)/_e)/_e));!isNaN(je)&&Ae+je>Math.max(3*Ae,Ae+150)&&(Y[ut.Video_Recv_I_Frame_Delay]=je)}}return Y})(d._videoSSRC,t,d.videoTrack,g===!0,this.needUploadRenderFreezeTime,n,r,i):void 0;E&&(f.video=E)}if(h.has(Me.AUDIO)&&d.audioTrack){const g=d.audioTrack?(function(E,S,O,A,N,j){const U=S.audioRecv.find((Y=>Y.ssrc===E));if(!U)return;const W={};$e(W,Ur.Audio_Recv_Jitter,U.jitterMs),$e(W,Ur.Audio_Recv_Bytes_Retransmit,U.retransmittedBytesReceived),$e(W,Ur.Audio_Recv_Packages_Retransmit,U.retransmittedPacketsReceived),$e(W,Ur.Audio_Recv_Packages_Discarded,U.packetsDiscarded),$e(W,Ur.Audio_Recv_Avg_Processing_Delay,U.avgProcessingDelayMs);const $=j&&j.audioRecv.find((Y=>Y.ssrc===E));if($){const Y=xh;U.packets!=null&&$.packets!=null&&$e(W,Ur.Audio_Recv_Package_Rate,1e3*(U.packets-$.packets)/Y),U.packetsLost!=null&&$.packetsLost!=null&&$e(W,Ur.Audio_Recv_Package_Lost,U.packetsLost-$.packetsLost)}if(A){const{receivedFrames:Y,droppedFrames:ie}=U;Y!=null&&ie!=null&&(W[Da.Audio_Recv_Freeze]=(Z=Y)===0||100*ie/Z>20?1:0)}var Z;if(N){const Y=100*O._source.getAccurateVolumeLevel(),ie=U.outputLevel;if(ie!=null){const ge=Math.ceil(50*Math.log10(100*ie+1));$e(W,ut.Audio_Render_Level,ge)}$e(W,ut.Audio_Recv_PCM_Level,Y),O&&(W[ut.Audio_Recv_Disabled]=O._originMediaStreamTrack.enabled&&O._mediaStreamTrack.enabled?0:1),$e(W,ut.Audio_Recv_Jitter_Buffer,U.jitterBufferMs),$e(W,ut.Audio_Recv_Current_Delay,U.jitterBufferMs),W[ut.Audio_Recv_Player_Status]=Db[Vi.getPlayerState(O.getTrackId())];const ue=N.audioRecv.find((ge=>ge.ssrc===E));if(ue){ue.bytes!=null&&U.bytes!=null&&$e(W,ut.Audio_Recv_Bitrate,8*(U.bytes-ue.bytes)/(xh*_E));const ge=U.concealedSamples-ue.concealedSamples;ge>0&&$e(W,ut.Audio_Recv_Concealed_Samples,ge);const Re=U.totalSamplesReceived-ue.totalSamplesReceived;Re>0&&$e(W,ut.Audio_Recv_Total_Samples_Received,Re);const St=U.freezeSamples80-ue.freezeSamples80;St>0&&$e(W,ut.Audio_Render_Freeze_Samples_80ms,St);const Ct=U.freezeSamples200-ue.freezeSamples200;Ct>0&&$e(W,ut.Audio_Render_Freeze_Samples_200ms,Ct);const at=U.freezeMs80-ue.freezeMs80;$e(W,ut.Audio_Render_Freeze_Time_80ms,at<0?0:at);const Qt=U.freezeMs200-ue.freezeMs200;$e(W,ut.Audio_Render_Freeze_Time_200ms,Qt<0?0:Qt)}}return W})(d._audioSSRC,t,d.audioTrack,n,r,i):void 0;g&&(f.audio=g)}(f.video||f.audio)&&o.push(f)})),this.needUploadRenderFreezeTime=!this.needUploadRenderFreezeTime,o}startUploadTransportStats(){this.uploadTransportStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats()}stopUploadTransportStats(){this.uploadTransportStarted=!1}startUploadOutboundStats(){this.uploadOutboundStarted||(this.uploadOutboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=window.setInterval((()=>{if(!this.requestAllTracks||!this.requestUpload)return;const t=(this.requestAllTracks()||[]).find((n=>n instanceof rE));if(t&&t._external.getDenoiserStats){const n=t._external.getDenoiserStats();n&&this.requestUpload(sE.DENOISER_STATS,n)}}),2e3),this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=window.setInterval((()=>{!this.requestAllTracks||!this.requestUpload||this.requestAllTracks().forEach((t=>{t.getProcessorStats().forEach((n=>{this.requestUpload&&this.requestUpload(n.type,n.stats)}))}))}),2e3))}stopUploadOutboundStats(){this.uploadOutboundStarted&&(this.uploadOutboundStarted=!1,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRefSendStats&&(this.lastRefSendStats.videoSend=[],this.lastRefSendStats.audioSend=[],this.lastRefSendStats=void 0),this.lastNormalSendStats&&(this.lastNormalSendStats.videoSend=[],this.lastNormalSendStats.audioSend=[],this.lastNormalSendStats=void 0),this.lastExtendStats={},this.needUploadStats={},this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=void 0,this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=void 0)}startUploadInboundStats(){this.uploadInboundStarted||(this.uploadInboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=window.setInterval((()=>{!this.requestUpload||!this.requestRemoteMedia||(this.requestRemoteMedia()||[]).forEach((t=>{let[n,r]=t;r.has(Me.VIDEO)&&n.videoTrack&&n.videoTrack.getProcessorStats().forEach((i=>{this.requestUpload&&this.requestUpload(i.type,i.stats)})),r.has(Me.AUDIO)&&n.audioTrack&&n.audioTrack.getProcessorStats().forEach((i=>{this.requestUpload&&this.requestUpload(i.type,i.stats)}))}))}),2e3))}stopUploadInboundStats(){this.uploadInboundStarted&&(this.uploadInboundStarted=!1,this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0),this.lastRefRecvStats&&(this.lastRefRecvStats.videoRecv=[],this.lastRefRecvStats.audioRecv=[],this.lastRefRecvStats=void 0),this.lastNormalRecvStats&&(this.lastNormalRecvStats.videoRecv=[],this.lastNormalRecvStats.audioRecv=[],this.lastNormalRecvStats=void 0),this.lastUploadCompensateTime=-1,this.uploadCompensateDeltaTime=0,this.needUploadRenderFreezeTime=!0,this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=void 0)}startUploadExtensionUsageStats(){if(this.uploadExtensionUsageStarted)return;this.uploadExtensionUsageStarted=!0,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer);const t=new Map;this.uploadExtUsageStatsTimer=window.setInterval((async()=>{const n=Date.now(),r={connectionInterval:B("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3,details:[],lts:n};let i=[];const s=this.requestAllTracks&&this.requestAllTracks()||[];for(const h of s)!h.muted&&h.enabled&&(i=i.concat(await h.getProcessorUsage()));const o=this.requestRemoteMedia&&this.requestRemoteMedia()||[];for(const[h,f]of o)f.has(Me.VIDEO)&&h.videoTrack&&(i=i.concat(await h.videoTrack.getProcessorUsage())),f.has(Me.AUDIO)&&h.audioTrack&&(i=i.concat(await h.audioTrack.getProcessorUsage()));if(i.length===0)return;r.details=(function(h,f){const g={};for(const{id:A,value:N,level:j,direction:U}of h){var E;const W=(E=f.get(A))!==null&&E!==void 0?E:0,$=N===2?W+B("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3:W;var S,O;f.set(A,$),g[A]?(N===2&&(g[A].value=N),j>g[A].level&&(g[A].level=j),U==="remote"&&(g[A].remoteUidCount+=1),g[A].totalTs=(S=f.get(A))!==null&&S!==void 0?S:0):g[A]={value:N,level:j,remoteUidCount:U==="local"?0:1,totalTs:(O=f.get(A))!==null&&O!==void 0?O:0}}return Object.keys(g).map((A=>{const{level:N,value:j,totalTs:U}=g[A];return{id:A,level:N,value:j,totalTs:U}}))})(i,t);const c=Date.now(),d=c>n?c:n+1;this.requestUpload&&this.requestUpload(sE.EXTENSION_USAGE_STATS,{usageStats:r,sendTs:d})}),B("EXTENSION_USAGE_UPLOAD_INTERVAL"))}stopUploadExtensionUsageStats(){this.uploadExtensionUsageStarted&&(this.uploadExtensionUsageStarted=!1,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer),this.uploadExtUsageStatsTimer=void 0)}stopUploadBaseStats(){this.uploadBaseStatsStarted=!1}}const D7=B("ICE_RESTART_INTERVAL");let UT=new Map,cm=new Map,Fd=[$r.UDP_TCP_RELAY,$r.TCP_RELAY,$r.RELAY],OI=B("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&Bt().supportPCSetConfiguration;function eU(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const n=UT.get(e.id);n&&(window.clearTimeout(n),UT.delete(e.id));const r=cm.get(e.id);t&&r&&r.index===Fd.length-1&&(w.debug("[".concat(e.id,"] reset ICE restart policy")),cm.delete(e.id))}function tU(e,t,n){if(UT.size===0&&cm.size===0&&(Array.isArray(B("RESTART_SEQUENCE"))&&B("RESTART_SEQUENCE").length>0&&!(function(c,d){if(c.length!==d.length)return!1;for(let h=0;h<c.length;h+=1){const f=c[h];if(c.filter((g=>g===f)).length!==d.filter((g=>g===f)).length)return!1}return!0})(Fd,B("RESTART_SEQUENCE"))&&(Fd=B("RESTART_SEQUENCE").filter((c=>{var d;if(be(d=Object.values($r)).call(d,c))return!0})),w.debug("use reconnection policy from config distribution, queues: ".concat(Fd.join(" => ")))),OI=B("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&Bt().supportPCSetConfiguration),Fd.length===0)return void n();let r,{index:i=0,type:s}=cm.get(e.id)||{};if(OI&&s===$r.RELAY)return void n();let o=s&&i>=Fd.length-1;if(OI)s=$r.RELAY;else{if(o)return void n();s?(i++,s=Fd[i]):(s=Fd[0],i=0)}w.debug("[".concat(e.id,"] choose ICE restart policy: ").concat(s,", index: ").concat(i)),t(s),cm.set(e.id,{index:i,type:s}),r=window.setTimeout((()=>tU(e,t,n)),D7),UT.set(e.id,r)}var It;function nU(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable}))),n.push.apply(n,r)}return n}function Pc(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?nU(Object(n),!0).forEach((function(r){x(e,r,n[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):nU(Object(n)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))}))}return e}function rU(e){var t,n,r,i=2;for(typeof Symbol<"u"&&(n=K0,r=Symbol.iterator);i--;){if(n&&(t=e[n])!=null)return t.call(e);if(r&&(t=e[r])!=null)return new jT(t.call(e));n="@@asyncIterator",r="@@iterator"}throw new TypeError("Object is not async iterable")}function jT(e){function t(n){if(Object(n)!==n)return ke.reject(new TypeError(n+" is not an object."));var r=n.done;return ke.resolve(n.value).then((function(i){return{value:i,done:r}}))}return jT=function(n){this.s=n,this.n=n.next},jT.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(n){var r=this.s.return;return r===void 0?ke.resolve({value:n,done:!0}):t(r.apply(this.s,arguments))},throw:function(n){var r=this.s.return;return r===void 0?ke.reject(n):t(r.apply(this.s,arguments))}},new jT(e)}let gE=(It=class extends xn{get state(){return this._state}set state(e){const t=this._state;this._state=e,this.emit(Xe.StateChange,t,this._state)}constructor(e,t){super(),x(this,"isPlanB",void 0),x(this,"store",void 0),x(this,"statsUploader",void 0),x(this,"connection",void 0),x(this,"localTrackMap",new Map),x(this,"remoteUserMap",new Map),x(this,"localDataChannels",[]),x(this,"remoteDataChannelMap",new Map),x(this,"pendingLocalTracks",[]),x(this,"pendingRemoteTracks",[]),x(this,"pendingLocalDataChannels",[]),x(this,"pendingRemoteDataChannels",[]),x(this,"statsCollector",void 0),x(this,"shouldForwardP2PCreation",void 0),x(this,"iceFailedCount",0),x(this,"dtlsFailedCount",0),x(this,"mutex",void 0),x(this,"_state",en.Disconnected),x(this,"_pcStatsUploadType",B("NEW_ICE_RESTART")?Rl.FIRST_CONNECTION:Rl.OLD_FIRST_CONNECTION),x(this,"_isStartRestartIce",!1),x(this,"_restartTimer",void 0),x(this,"_isTryConnecting",!1),x(this,"_iceError",null),x(this,"_forceTurn",!1),x(this,"_isWaitPcToRePub",!1),x(this,"handleMuteLocalTrack",(async(n,r,i)=>{const s=await this.mutex.lock("Locking from P2PChannel.handleMuteLocalTrack");try{if(!this.connection||this.state!==en.Connected)return void i(new de(V.INVALID_OPERATION,"Cannot call P2PChannel.handleMuteLocalTrack before connection established."));const o=this.filterTobeMutedTracks(n);if(o.length===0)return void r();const c=o.find((h=>h[0]==="videoLowTrack"));if(c){const h=c[1];this.store.enableInstantMuteRestore?(h.track._originMediaStreamTrack.enabled=!1,w.info("[".concat(this.store.clientId,"] P2PChannel muteLocalLowTrack without close sender because enableInstantMuteRestore is true"))):h.track._originMediaStreamTrack.stop()}this.store.enableInstantMuteRestore?w.info("[".concat(this.store.clientId,"] P2PChannel muteLocalTrack without close sender because enableInstantMuteRestore is true")):await this.connection.muteLocal(o.map((h=>{let[,{id:f}]=h;return f})));const d=this.createMuteMessage(o);await un(this,Xe.RequestMuteLocal,d),r()}catch(o){i(o)}finally{s()}})),x(this,"handleUnmuteLocalTrack",(async(n,r,i)=>{const s=await this.mutex.lock("Locking from P2PChannel.handleUnmuteLocalTrack");try{if(!this.connection||this.state!==en.Connected)return void i(new de(V.INVALID_OPERATION,"Cannot call P2PChannel.handleUnmuteLocalTrack before connection established."));const o=this.filterTobeUnmutedTracks(n);if(o.length===0)return void r();const c=o.find((h=>h[0]==="videoLowTrack"));if(c){const h=c[1];if(this.store.enableInstantMuteRestore)h.track._originMediaStreamTrack.enabled=!0,w.info("[".concat(this.store.clientId,"] P2PChannel unmuteLocalLowTrack without close sender because enableInstantMuteRestore is true"));else{if(h.track._originMediaStreamTrack.stop(),!B("DISABLE_DUAL_STREAM_USE_ENCODING")&&Bt().supportDualStreamEncoding){const f=n._mediaStreamTrack.clone();h.track._mediaStreamTrack=f,h.track._originMediaStreamTrack=f}else{const f=NI(n,Jg(this,Xe.RequestLowStreamParameter));h.track._mediaStreamTrack=f,h.track._originMediaStreamTrack=f}await new ke(((f,g)=>{this.handleReplaceTrack(h.track,f,g,!0)}))}}this.store.enableInstantMuteRestore?w.info("[".concat(this.store.clientId,"] P2PChannel unmuteLocalTrack without close sender because enableInstantMuteRestore is true")):await this.connection.unmuteLocal(o.map((h=>{let[,{id:f}]=h;return f})));const d=this.createUnmuteMessage(o);await un(this,Xe.RequestUnmuteLocal,d),r()}catch(o){i(o)}finally{s()}})),x(this,"handleUpdateVideoEncoder",(async(n,r,i,s)=>{let o;s||(o=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoEncoder"));try{const d=this.localTrackMap.get(ve.LocalVideoTrack);if(!this.connection||!d||d.track!==n||this.state!==en.Connected)return void r();const{id:h,track:f}=d;await this.connection.updateSendParameters(h,f),await this.connection.updateEncoderConfig(h,f),this.emit(Xe.UpdateVideoEncoder,f),r()}catch(d){i(d)}finally{var c;(c=o)===null||c===void 0||c()}})),x(this,"handleUpdateVideoSendParameters",(async(n,r,i)=>{const s=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoSendParameters");try{const o=this.localTrackMap.get(ve.LocalVideoTrack);if(!this.connection||!o||o.track!==n||this.state!==en.Connected)return void r();const{id:c,track:d}=o;await this.connection.updateSendParameters(c,d),r()}catch(o){i(o)}finally{s()}})),x(this,"handleReplaceMixingTrack",(async(n,r,i,s)=>{if(!this.connection||this.state!==en.Connected)return void r();const o=II([n]);let c;w.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(o.getTrackId(),"]")),typeof s=="boolean"&&s||(c=await this.mutex.lock("From P2PChannel.handleReplaceMixingTrack"));try{await this.replaceTrack(n,o),r()}catch(h){i(h)}finally{var d;(d=c)===null||d===void 0||d()}})),x(this,"handleReplaceTrack",(async(n,r,i,s)=>{let o;w.debug("[".concat(this.store.clientId,"] P2PChannel handleReplaceTrack for [track-id-").concat(n.getTrackId(),"]")),typeof s=="boolean"&&s||(o=await this.mutex.lock("From P2PChannel.handleReplaceTrack"));try{var c;const h=Array.from(this.localTrackMap.entries()).find((f=>{let[,{track:g}]=f;return n===g}));if(!this.connection||!h||this.state!==en.Connected)return void r();if(await((c=this.connection)===null||c===void 0?void 0:c.replaceTrack(n,h[1].id)),this.isPlanB){const f=h[1];f.id=n._mediaStreamTrack.id,this.localTrackMap.set(h[0],f)}if(h[0]===ve.LocalVideoTrack&&!B("DISABLE_DUAL_STREAM_USE_ENCODING")&&Bt().supportDualStreamEncoding){const f=this.localTrackMap.get(ve.LocalVideoLowTrack);if(f){const g=n._mediaStreamTrack.clone();f.track._originMediaStreamTrack.stop(),f.track._mediaStreamTrack=g,f.track._originMediaStreamTrack=g,await new ke(((E,S)=>{this.handleReplaceTrack(f.track,E,S,!0)}))}}r()}catch(h){i(h)}finally{var d;(d=o)===null||d===void 0||d()}})),x(this,"handleGetRTCStats",(n=>{n(this.statsCollector.getRTCStats())})),x(this,"handleGetLocalVideoStats",(n=>{n(this.statsCollector.getLocalVideoTrackStats())})),x(this,"handleGetLocalAudioStats",(n=>{n(this.statsCollector.getLocalAudioTrackStats())})),x(this,"handleGetRemoteVideoStats",(n=>this.statsCollector.getRemoteVideoTrackStats(n.uid)[n.uid])),x(this,"handleGetRemoteAudioStats",(n=>this.statsCollector.getRemoteAudioTrackStats(n.uid)[n.uid])),this.store=e,this.statsCollector=t,this.statsCollector.addP2PChannel(this),this.statsUploader=new $2(this.store),this.bindStatsUploaderEvents(),this.mutex=new Jr("P2PChannel-mutex",this.store.clientId),this.isPlanB=!Bt().supportUnifiedPlan||B("CHROME_FORCE_PLAN_B")&&vl(),this.shouldForwardP2PCreation=B("FORWARD_P2P_CREATION")&&Bt().supportPCSetConfiguration&&sb(),this.shouldForwardP2PCreation&&(this.connection=xT(this.store),this.emit(Xe.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection))}async startP2PConnection(e,t){var n;this.state=en.New,this._forceTurn=q2(e),w.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] forceTurn: ").concat(this._forceTurn));const r=this.shouldForwardP2PCreation&&((n=this.connection)===null||n===void 0?void 0:n.peerConnectionState)==="closed";if((!this.shouldForwardP2PCreation||r||t)&&((r||t)&&this.connection&&(w.warning("[".concat(this.store.clientId,"] P2PChannel.startP2PConnection ForwardP2P closed.")),this.resetConnection(this.connection)),this.connection=xT(this.store,e),this.emit(Xe.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),!this.connection)throw new de(V.UNEXPECTED_ERROR,"Cannot P2PChannel.startConnection before P2PConnection initialization .");return this._pcStatsUploadType=B("NEW_ICE_RESTART")?Rl.FIRST_CONNECTION:Rl.OLD_FIRST_CONNECTION,this._isTryConnecting=!0,this._isStartRestartIce=!1,this._iceError=null,this.connection.setConfiguration(e),this.connection.establishPromise}async connect(e){if(!this.connection)throw new de(V.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");if(this.isPreallocation()&&this.state===en.Connected){if(this.connection instanceof co&&this.connection.checkDtlsParameters(e.dtlsParameters.fingerprints))return w.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] dtls parameters mismatch, try next.")),We.reportApiInvoke(this.store.sessionId,{name:Gn.MISMATCH_DTLS_PARAMETERS,options:[e.dtlsParameters.fingerprints],tag:Nn.TRACER}).onSuccess(),void setTimeout((()=>{this.emit(Xe.RequestReconnect)}));await this.connection.updateRemoteConnect(e)}else this.store.peerConnectionStart(),await this.connection.connect(e),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=en.Connected}updateRemoteRTPCapabilities(e){const t=Array.from(this.localTrackMap.entries()).filter((i=>{var s;let[o]=i;return be(s=[ve.LocalVideoLowTrack,ve.LocalVideoTrack]).call(s,o)})),n=t.map((i=>{let[,{id:s}]=i;return s})),r=t.map((i=>{let[s]=i;return s}));if(this.connection instanceof co){if(We.updateRemoteRTPCapabilities(this.store.sessionId,{trackTypes:JSON.stringify(r),localCodecs:JSON.stringify(this.connection.localCodecs),remoteCodecs:JSON.stringify(e)}),!be(e).call(e,this.store.codec)){const i=["vp9","vp8","h264"].find((s=>be(e).call(e,s)));i&&(this.store.codec=i,w.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId," updateRemoteRTPCapabilities] default codec is not available, hence the fallback to ").concat(i,".")))}this.connection.updateRemoteRTPCapabilities(n,e)}}async getEstablishParams(){var e;if(this.connection instanceof co&&this.connection.peerConnectionState!=="closed"&&be(e=[en.New,en.Connected]).call(e,this.state))return this.connection.establishPromise}async publishDataChannel(e){if(!this.connection||this.state!==en.Connected){if(this.state===en.Disconnected)throw new de(V.UNEXPECTED_ERROR,"PeerConnection already disconnected.");return e.forEach((n=>{var r;be(r=this.pendingLocalDataChannels).call(r,n)||this.pendingLocalDataChannels.push(n)})),[]}const t=this.filterTobePublishedDataChannels(e);return t.length===0?[]:(t.forEach((n=>{const r=Date.now();this.store.publish(n.id.toString(),"datachannel",r)})),await this.connection.createDataChannels(this.store.uid,t),t.forEach((n=>{this.localDataChannels.push(n);const r=Date.now();this.store.publish(n.id+"","datachannel",void 0,r)})),e.map((n=>({streamId:n.id,ordered:n.ordered,maxRetransmits:n.maxRetransmits,metadata:n.metadata,channelId:n._originDataChannelId}))))}publish(e,t,n){var r=this;return no((function*(){const i=yield Ft(r.mutex.lock("From P2PChannel.publish"));try{var s;const o=r.connection&&be(s=["disconnected","failed"]).call(s,r.connection.peerConnectionState);if(!r.connection||r.state!==en.Connected||o){if(r.state===en.Disconnected)throw new de(V.UNEXPECTED_ERROR,"PeerConnection already disconnected.");r.throwIfTrackTypeNotMatch(e);const d=e.filter((h=>r.pendingLocalTracks.indexOf(h)===-1));return r.pendingLocalTracks=r.pendingLocalTracks.concat(d),void(o&&(r._isWaitPcToRePub=!0))}r.store.pubId=r.store.pubId+1,ei.markPublishStart(r.store.clientId,r.store.pubId);const c=r.filterTobePublishedTracks(e,t,n);if(c.length===0)return void(yield Ft(r.tryToUnmuteAudio(e)));yield*OS(rU(r.doPublish(r.connection,c)))}finally{i()}}))()}doPublish(e,t){var n=this;return no((function*(){t.forEach((E=>{let{track:S,type:O}=E;const A=Date.now();n.store.publish(S.getTrackId(),O===ve.LocalAudioTrack?"audio":"video",A)})),n.bindLocalTrackEvents(t);const r=t.map((E=>{let{track:S}=E;return S})),i=yield Ft(e.send(r,n.store.codec,n.store.audioCodec)),s=(yield Ft(i.next())).value,o=n.createGatewayPublishMessage(t,s);let c;try{c=yield o}catch(E){throw i.throw(E),E?.code===V.WS_ABORT&&t.forEach((S=>{let{track:O}=S;n.pendingLocalTracks.indexOf(O)===-1&&n.pendingLocalTracks.push(O)})),n.unbindLocalTrackEvents(t),E}const d=n.mapPubResToRemoteConfig(o,c,r),h=(yield Ft(i.next(d))).value;if(n.state===en.Disconnected)throw new de(V.UNEXPECTED_ERROR,"PeerConnection already disconnected.");B("ENABLE_VIDEO_SEI");const f=B("ENABLE_ENCODED_TRANSFORM"),g=B("ENABLE_AUDIO_METADATA");r.forEach((async E=>{const S=E.getRTCRtpTransceiver();if(!S||!f)return;const{interceptLocalVideoFrame:O,interceptLocalAudioFrame:A}=CT();E.trackMediaType===Me.VIDEO?await O(S.sender,E):E.trackMediaType===Me.AUDIO&&await A(S.sender,{metadata:g?()=>{const N=E.metadata.shift();return N&&N.value}:void 0})})),t.forEach((E=>{let{type:S}=E;n.statsCollector.addLocalStats(S)})),n.assignLocalTracks(t,h),n.statsUploader.startUploadOutboundStats(),t.forEach((E=>{let{track:S,type:O}=E;const A=Date.now();n.store.publish(S.getTrackId(),O===ve.LocalAudioTrack?"audio":"video",void 0,A)}))}))()}async updateVideoStreamParameter(e,t){const n=this.localTrackMap.get(t);if(!n||!this.connection)return;if(!(n.track instanceof Sn))return w.warn("[updateVideoStreamParameter]: track is not an instance of LocalVideoTrack");const{track:r}=n,i=(function(s,o){const c={};return s.height&&s.width&&(c.scaleResolutionDownBy=lI(s,o)),c.maxFramerate=s.framerate?Es(s.framerate):void 0,c.maxBitrate=s.bitrate?1e3*s.bitrate:void 0,c})(e,r);if(r._encoderConfig||(r._encoderConfig={}),t!==ve.LocalVideoLowTrack||!B("DISABLE_DUAL_STREAM_USE_ENCODING")&&Bt().supportDualStreamEncoding)i.scaleResolutionDownBy!=null&&(r._encoderConfig.scaleResolutionDownBy=i.scaleResolutionDownBy);else{const s=r._originMediaStreamTrack;if(!s.canvas)return w.warn("[".concat(r.getTrackId(),"] no canvas on track"));(function(o,c){const d=o.canvas;c.width&&(d.width=Es(c.width)),c.height&&(d.height=Es(c.height)),c.framerate&&(d.stopCapture&&d.stopCapture(),d.stopCapture=xb((()=>{!d.startCapture&&d.stopCapture&&d.stopCapture(),d.startCapture&&d.startCapture()}),Es(c.framerate)))})(s,e)}i.maxBitrate!=null&&(r._encoderConfig.bitrateMax=i.maxBitrate/1e3),i.maxFramerate!=null&&(r._encoderConfig.frameRate&&typeof r._encoderConfig.frameRate=="object"?r._encoderConfig.frameRate.max=i.maxFramerate:r._encoderConfig.frameRate={max:i.maxFramerate}),w.debug("[".concat(r.getTrackId(),"] LowStreamEncoderConfig: , ").concat(JSON.stringify(r._encoderConfig))),await this.connection.updateRtpSenderEncodings(r)}publishLowStream(e){var t=this;return no((function*(){if(!t.connection||t.state!==en.Connected)return;const n=yield Ft(t.mutex.lock("Locking from P2PChannel.publishLowStream"));try{const i=t.localTrackMap.get(ve.LocalVideoTrack);if(!i)throw new de(V.UNEXPECTED_ERROR,"Could not find high stream");if(t.localTrackMap.has(ve.LocalVideoLowTrack))throw new de(V.UNEXPECTED_ERROR,"[".concat(t.store.clientId,"] Can't publish low stream when stream already publish"));const s=[{track:t.getLowVideoTrack(i.track,e),type:ve.LocalVideoLowTrack}];if(yield*OS(rU(t.doPublish(t.connection,s))),i.track.muted||!i.track.enabled){var r;const o=(r=t.localTrackMap.get(ve.LocalVideoLowTrack))===null||r===void 0?void 0:r.id;o!==void 0&&(yield Ft(t.connection.muteLocal([o])))}}finally{n()}}))()}async republish(){this.pendingLocalTracks.length>0&&(w.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await Gr(this,Xe.RequestRePublish,this.pendingLocalTracks),this.emit(Xe.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[]),this.pendingLocalDataChannels.length>0&&(w.debug("Emit P2PChannelEvents.RequestRePublishDataChannel to republish datachannels."),await Gr(this,Xe.RequestRePublishDataChannel,this.pendingLocalDataChannels),this.pendingLocalDataChannels=[]),this._isWaitPcToRePub=!1}async reSubscribe(e){for(let t=this.pendingRemoteTracks.length-1;t>=0;t--){const{user:n,kind:r}=this.pendingRemoteTracks[t];(r!==Me.AUDIO||n._audio_added_&&n._audioSSRC)&&(r!==Me.VIDEO||n._video_added_&&n._videoSSRC)||this.pendingRemoteTracks.splice(t,1)}if(e)await Gr(this,Xe.RequestReSubscribe,this.pendingRemoteTracks);else for(const{user:t,kind:n}of this.pendingRemoteTracks)await this.subscribe(t,n,n===Me.VIDEO?t._videoSSRC:t._audioSSRC);this.pendingRemoteTracks.forEach((t=>{let{user:n}=t;this.emit(Xe.MediaReconnectEnd,n.uid)})),this.pendingRemoteTracks=[]}async unpublish(e){if(!this.connection||this.state!==en.Connected)return void e.forEach((r=>{const i=this.pendingLocalTracks.indexOf(r);i!==-1&&this.pendingLocalTracks.splice(i,1)}));const t=this.filterTobeUnpublishedTracks(e);if(t.length===0)return;const n=t.find((r=>r[0]==="videoLowTrack"));return n&&n[1].track.close(),this.doUnpublish(this.connection,t)}async unpublishDataChannel(e){if(!this.connection||this.state!==en.Connected)return void e.forEach((n=>{const r=this.pendingLocalDataChannels.indexOf(n);r!==-1&&this.pendingLocalDataChannels.splice(r,1)}));const t=this.filterTobeUnpublishedDataChannels(e);return t.length!==0?(t.forEach((n=>{const r=this.localDataChannels.indexOf(n);r!==-1&&this.localDataChannels.splice(r,1)})),this.localDataChannels.length===0&&await this.connection.stopDataChannels(this.store.uid),t.map((n=>n.id))):void 0}async unpublishLowStream(){if(!this.connection||this.state!==en.Connected)return;const e=this.localTrackMap.get(ve.LocalVideoLowTrack);if(!e)return;e.track.close();const t=[[ve.LocalVideoLowTrack,e]];return this.doUnpublish(this.connection,t)}async doUnpublish(e,t){const n=this.createGatewayUnpublishMessage(t);return await e.stopSending(t.map((r=>{let[,{id:i}]=r;return i}))),this.withdrawLocalTracks(t),this.unbindLocalTrackEvents(t.map((r=>{let[i,{track:s}]=r;return{type:i,track:s}}))),t.forEach((r=>{let[i]=r;this.statsCollector.removeLocalStats(i)})),this.localTrackMap.size===0&&this.statsUploader.stopUploadOutboundStats(),n}async subscribeDataChannel(e,t){if(!this.connection||this.state!==en.Connected)throw new de(V.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");const n=t.filter((r=>{var i;return!((i=this.remoteDataChannelMap.get(e))!==null&&i!==void 0&&i.get(r.id))}));if(n.length!==0)return await this.connection.createDataChannels(e.uid,n),n.forEach((r=>{var i;this.remoteDataChannelMap.has(e)?(i=this.remoteDataChannelMap.get(e))===null||i===void 0||i.set(r.id,r):this.remoteDataChannelMap.set(e,new Map([[r.id,r]]));const s=this.pendingRemoteDataChannels.findIndex((o=>{let{user:c,id:d}=o;return c.uid===e.uid&&d===r.id}));s!==-1&&this.pendingRemoteDataChannels.splice(s,1)})),n.map((r=>r.id))}async subscribe(e,t,n,r,i){var s;if(!this.connection||this.state!==en.Connected)throw new de(V.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");if((s=this.remoteUserMap.get(e))!==null&&s!==void 0&&s.has(t))return;let o,c,d,h;const f=this.connection.getPreMedia(n);if(f)w.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] preSSRCMap has ssrcId: ").concat(n,", no need to send sub to gateway.")),d=f.transceiver,o=f.track,c=f.mid,h=f.player,f.firstVideoRender&&this.store.firstVideoFrameDecoded(e.uid,{firstPreRender:f.firstVideoRender});else if(i){const S=i.find((A=>{let{stream_type:N}=A;return N===t}));if(!S)throw new de(V.UNEXPECTED_ERROR,"Cannot subscribe to remote ".concat(t," for user: ").concat(e.uid," because subscribe answer from gateway does not contain stream_type: ").concat(t,"."));const O=await this.connection.receive(t,S.ssrcs,String(e._uintid),S.attributes);this.connection instanceof co&&(d=O.transceiver),o=O.track,c=O.id}else{const S=await this.connection.receive(t,[{ssrcId:n,rtx:r}],String(e._uintid),void 0);this.connection instanceof co&&(d=S.transceiver),o=S.track,c=S.id}if(t===Me.AUDIO?(e._audioTrack?e._audioTrack._updateOriginMediaStreamTrack(o):(e._audioTrack=new Xf(o,e.uid,e._uintid,this.store),w.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(e._audioTrack.getTrackId()))),d&&e._audioTrack._updateRtpTransceiver(d),this.bindRemoteTrackEvents(e,e._audioTrack)):(e._videoTrack?e._videoTrack._updateOriginMediaStreamTrack(o):(e._videoTrack=new qf(o,e.uid,e._uintid,this.store,h),w.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(e._videoTrack.getTrackId())),e._videoTrack.once(so.PLAY_START,(()=>{this.store.firstVideoFrameDecoded(e.uid,{playStart:Date.now()})})),e._videoTrack.once(so.PLAY_END,(()=>{this.store.firstVideoFrameDecoded(e.uid,{playEnd:Date.now()}),this.reportVideoFirstFrameRender(e)})),h?e._videoTrack.once(so.FIRST_FRAME_RENDER,(()=>{this.store.firstVideoFrameDecoded(e.uid,{firstRender:Date.now()}),this.reportVideoFirstFrameRender(e)})):e._videoTrack.once(so.FIRST_FRAME_DECODED,(()=>{this.store.firstVideoFrameDecoded(e.uid,{firstRender:Date.now()}),this.reportVideoFirstFrameRender(e)}))),d&&e._videoTrack._updateRtpTransceiver(d),this.bindRemoteTrackEvents(e,e._videoTrack)),d&&B("ENABLE_ENCODED_TRANSFORM")){const{interceptRemoteVideoFrame:S,interceptRemoteAudioFrame:O}=CT();t==Me.VIDEO?await S(d.receiver,{onSei:B("ENABLE_VIDEO_SEI")&&(A=>{var N;return(N=e._videoTrack)===null||N===void 0?void 0:N._onSei(A)})}):t==Me.AUDIO&&await O(d.receiver,{enableTopn:!!B("ENABLE_AUDIO_TOPN"),enableMetadata:!!B("ENABLE_AUDIO_METADATA"),enablePts:!!B("ENABLE_AUDIO_PTS"),onMetadata:A=>{this.safeEmit(Xe.AudioMetadata,A)},onPts:A=>{this.safeEmit(Xe.AudioPts,A)}})}const g=this.remoteUserMap.get(e);g?g.set(t,c):this.remoteUserMap.set(e,new Map([[t,c]])),this.statsCollector.addRemoteStats(e.uid),this.statsUploader.startUploadInboundStats();const E=this.pendingRemoteTracks.findIndex((S=>{let{user:O,kind:A}=S;return O.uid===e.uid&&t===A}));E!==-1&&(this.pendingRemoteTracks.splice(E,1),this.emit(Xe.MediaReconnectEnd,e.uid))}async massSubscribe(e){return this.massSubscribeNoLock(e)}async massSubscribeNoLock(e){if(!this.connection||this.state!==en.Connected)throw new de(V.INVALID_OPERATION,"Cannot subscribeAll remote users when peerConnection disconnected.");e=e.filter((i=>{var s;let{user:o,mediaType:c}=i;return!((s=this.remoteUserMap.get(o))!==null&&s!==void 0&&s.has(c))}));const t=[],n=new Map;e.forEach((i=>{if(!this.connection)return;const s=this.connection.getPreMedia(i.ssrcId);if(s){const{track:o,mid:c,transceiver:d,player:h}=s;n.set(i.ssrcId,{track:o,id:c,transceiver:d,player:h})}else t.push(i)}));const r=await this.connection.batchReceive(t.map((i=>{let{user:s,mediaType:o,ssrcId:c,rtxSsrcId:d}=i;return{kind:o,ssrcMsg:[{ssrcId:c,rtx:d}],mslabel:String(s._uintid)}})));t.forEach(((i,s)=>{n.set(i.ssrcId,r[s])}));for(const{user:i,mediaType:s,ssrcId:o}of e){const c=n.get(o);if(!c)return void w.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] cannot find ").concat(i.uid," subscribe data,").concat(s,", ").concat(o));const{track:d,id:h,transceiver:f,player:g}=c;if(f&&B("ENABLE_ENCODED_TRANSFORM")){const{interceptRemoteVideoFrame:O,interceptRemoteAudioFrame:A}=CT();s==Me.VIDEO?await O(f.receiver,{onSei:B("ENABLE_VIDEO_SEI")&&(N=>{var j;return(j=i._videoTrack)===null||j===void 0?void 0:j._onSei(N)})}):s==Me.AUDIO&&await A(f.receiver,{enableTopn:!!B("ENABLE_AUDIO_TOPN"),enableMetadata:!!B("ENABLE_AUDIO_METADATA"),enablePts:!!B("ENABLE_AUDIO_PTS"),onMetadata:N=>{this.safeEmit(Xe.AudioMetadata,N)},onPts:N=>{this.safeEmit(Xe.AudioPts,N)}})}if(s===Me.AUDIO?(i._audioTrack?i._audioTrack._updateOriginMediaStreamTrack(d):(i._audioTrack=new Xf(d,i.uid,i._uintid,this.store),w.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(i._audioTrack.getTrackId()))),f&&i._audioTrack._updateRtpTransceiver(f),this.bindRemoteTrackEvents(i,i._audioTrack)):(i._videoTrack?i._videoTrack._updateOriginMediaStreamTrack(d):(i._videoTrack=new qf(d,i.uid,i._uintid,this.store,g),w.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(i._videoTrack.getTrackId()))),f&&i._videoTrack._updateRtpTransceiver(f),this.bindRemoteTrackEvents(i,i._videoTrack)),B("ENABLE_VIDEO_SEI")&&f){const{interceptRemoteVideoFrame:O,interceptRemoteAudioFrame:A}=CT();s==Me.VIDEO?await O(f.receiver,{onSei:N=>{var j;(j=i._videoTrack)===null||j===void 0||j._onSei(N)}}):s==Me.AUDIO&&await A(f.receiver)}const E=this.remoteUserMap.get(i);E?E.set(s,h):this.remoteUserMap.set(i,new Map([[s,h]])),this.statsCollector.addRemoteStats(i.uid),this.statsUploader.startUploadInboundStats();const S=this.pendingRemoteTracks.findIndex((O=>{let{user:A,kind:N}=O;return A.uid===i.uid&&s===N}));S!==-1&&(this.pendingRemoteTracks.splice(S,1),this.emit(Xe.MediaReconnectEnd,i.uid))}}async unsubscribe(e,t,n){const r=this.pendingRemoteTracks.filter((o=>{let{user:c,kind:d}=o;return t!==void 0?c.uid===e.uid&&t===d:c.uid===e.uid}));if(r.forEach((o=>{const c=this.pendingRemoteTracks.indexOf(o);this.pendingRemoteTracks.splice(c,1)})),this.connection&&this.state===en.Connected||n||r.forEach((o=>{let{kind:c}=o;var d;if(c===Me.AUDIO)(d=e._audioTrack)===null||d===void 0||d._destroy(),e._audioTrack=void 0;else if(c===Me.VIDEO){var h;(h=e._videoTrack)===null||h===void 0||h._destroy(),e._videoTrack=void 0}})),!this.connection||this.state!==en.Connected)return;const i=this.filterTobeUnSubscribedTracks(e,t);if(i.length===0)return;await this.connection.stopReceiving(i.map((o=>{let[,{id:c}]=o;return c})));const s=this.createUnsubscribeMessage(i);return this.withdrawRemoteTracks(i),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),i.forEach((o=>{let[c,{kind:d}]=o;var h,f;if(d===Me.VIDEO&&c._videoSSRC&&((h=this.connection)===null||h===void 0||h.setStatsRemoteVideoIsReady(c._videoSSRC,!1)),d===Me.VIDEO)this.unbindRemoteTrackEvents(c._videoTrack),n||((f=c._videoTrack)===null||f===void 0||f._destroy(),c._videoTrack=void 0);else if(d===Me.AUDIO){var g;this.unbindRemoteTrackEvents(c._audioTrack),!n&&((g=c._audioTrack)===null||g===void 0||g._destroy(),c._audioTrack=void 0)}})),s}async unsubscribeDataChannel(e,t){if(t.forEach((i=>{const s=this.pendingRemoteDataChannels.findIndex((o=>o.id===i.id));s!==-1&&this.pendingRemoteDataChannels.splice(s,1)})),!this.connection)return;const n=this.filterTobeUnSubscribedDataChannels(e,t);if(n.length===0)return;t.forEach((i=>{i._close()}));const r=this.remoteDataChannelMap.get(e);return n.forEach((i=>{r&&r.delete(i.id)})),r&&r.size===0&&(this.remoteDataChannelMap.delete(e),await this.connection.stopDataChannels(e.uid)),n.map((i=>i.id))}async massUnsubscribe(e){return this.massUnsubscribeNoLock(e)}async massUnsubscribeNoLock(e){let t=[];for(const{user:i,mediaType:s}of e){const o=this.pendingRemoteTracks.filter((c=>{let{user:d,kind:h}=c;return s!==void 0?d.uid===i.uid&&s===h:d.uid===i.uid}));o.forEach((c=>{const d=this.pendingRemoteTracks.indexOf(c);this.pendingRemoteTracks.splice(d,1)})),t=t.concat(o)}if(!this.connection||this.state!==en.Connected)return void t.forEach((i=>{let{user:s,kind:o}=i;var c;if(o===Me.AUDIO)(c=s._audioTrack)===null||c===void 0||c._destroy(),s._audioTrack=void 0;else if(o===Me.VIDEO){var d;(d=s._videoTrack)===null||d===void 0||d._destroy(),s._videoTrack=void 0}}));const n=Yi(e).call(e,((i,s)=>{let{user:o,mediaType:c}=s;const d=this.filterTobeUnSubscribedTracks(o,c);return i.concat(d)}),[]);if(n.length===0)return;await this.connection.stopReceiving(n.map((i=>{let[,{id:s}]=i;return s})));const r=this.createUnsubscribeAllMessage(n);return this.withdrawRemoteTracks(n),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),n.forEach((i=>{let[s,{kind:o}]=i;var c,d;if(o===Me.VIDEO&&s._videoSSRC&&((c=this.connection)===null||c===void 0||c.setStatsRemoteVideoIsReady(s._videoSSRC,!1)),o===Me.VIDEO)this.unbindRemoteTrackEvents(s._videoTrack),(d=s._videoTrack)===null||d===void 0||d._destroy(),s._videoTrack=void 0;else if(o===Me.AUDIO){var h;this.unbindRemoteTrackEvents(s._audioTrack),(h=s._audioTrack)===null||h===void 0||h._destroy(),s._audioTrack=void 0}})),r}isPreSubScribe(e){return!this.connection||this.state!==en.Connected?!1:!!this.connection.getPreMedia(e)}async muteRemote(e,t){if(!this.connection)return;const n=this.remoteUserMap.get(e);if(!n)return void w.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid,"."));if(!n.get(t))return void w.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."));const r=t===Me.VIDEO?e._videoSSRC:e._audioSSRC;r!==void 0&&this.connection.setStatsRemoteVideoIsReady(r,!1)}async unmuteRemote(e,t){return this.unmuteRemoteNoLock(e,t)}async unmuteRemoteNoLock(e,t){if(!this.connection)return;const n=this.remoteUserMap.get(e);if(!n)return void w.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid,"."));n.get(t)||w.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."))}addAudioMetadata(e){const t=this.localTrackMap.get(ve.LocalAudioTrack),n=t&&t.track;n&&n.metadata.push(e)}getAllTracks(e){const t=this.localTrackMap.get(ve.LocalAudioTrack);if(t?.track instanceof cr){const n=t.track;return Array.from(this.localTrackMap.entries()).filter((r=>{let[i]=r;return i!==ve.LocalAudioTrack})).filter((r=>{let[i]=r;return!(e&&i===ve.LocalVideoLowTrack)})).map((r=>{let[,{track:i}]=r;return i})).concat(n.trackList)}return Array.from(this.localTrackMap.entries()).filter((n=>{let[r]=n;return!(e&&r===ve.LocalVideoLowTrack)})).map((n=>{let[,{track:r}]=n;return r}))}getAllDataChannels(){return this.localDataChannels}reportPublishEvent(e,t,n,r,i){if(e){const o=this.localTrackMap.get(ve.LocalAudioTrack),c=r?this.localTrackMap.get(ve.LocalVideoLowTrack):this.localTrackMap.get(ve.LocalVideoTrack);We.publish(this.store.sessionId,{eventElapse:ei.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:o?.track.getTrackLabel(),videoName:c?.track.getTrackLabel(),screenshare:c?.track._hints.indexOf(ln.SCREEN_TRACK)!==-1,audio:!!o,video:!!c,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:i})}else{var s;n||(n=[]);const o=n.find((d=>d instanceof Wn)),c=r?(s=this.localTrackMap.get(ve.LocalVideoTrack))===null||s===void 0?void 0:s.track:n.find((d=>d instanceof Sn));We.publish(this.store.sessionId,{eventElapse:ei.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:o?.getTrackLabel(),videoName:c?.getTrackLabel(),screenshare:c?._hints.indexOf(ln.SCREEN_TRACK)!==-1,audio:!!o,video:!!c,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:i})}}reportSubscribeEvent(e,t,n,r){const i=r===Me.VIDEO?n._videoSSRC:n._audioSSRC;i&&We.subscribe(this.store.sessionId,{succ:e,ec:t,video:r===Me.VIDEO,audio:r===Me.AUDIO,peerid:n.uid,subscribeRequestid:i,p2pid:this.store.p2pId,eventElapse:ei.measureFromSubscribeStart(this.store.clientId,i),preSsrc:this.isPreSubScribe(i)})}reset(){w.debug("[".concat(this.store.clientId,"] P2PChannel.reset")),this.mutex=new Jr("P2PChannel-mutex",this.store.clientId),this.connection&&(this.resetConnection(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=xT(this.store),this.emit(Xe.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.statsUploader.stopUploadBaseStats(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const e=this.localTrackMap.get(ve.LocalAudioTrack);if(e?.track instanceof cr){if(e.track.trackList.length>0){const t=e.track;e.track.trackList.forEach((n=>{t.removeAudioTrack(n)}))}e.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.iceFailedCount=0,this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.localDataChannels=[],this.remoteDataChannelMap.clear(),this.pendingLocalDataChannels=[],this.pendingRemoteDataChannels=[],this.state=en.Disconnected}getStats(){var e;return(e=this.connection)===null||e===void 0?void 0:e.getStats()}getRemoteVideoIsReady(e){var t;return((t=this.connection)===null||t===void 0?void 0:t.getRemoteVideoIsReady(e))||!1}getLocalAudioVolume(){const e=this.localTrackMap.get(ve.LocalAudioTrack);if(e)return e.track.getVolumeLevel()}getLocalVideoSize(){const e=this.localTrackMap.get(ve.LocalVideoTrack);if(e)return{width:e.track.videoWidth||0,height:e.track.videoHeight||0}}getEncoderConfig(e){const t=this.localTrackMap.get(e);return t&&t.track instanceof Sn||t&&t.track instanceof Wn?t.track._encoderConfig:void 0}getLocalMedia(e){return this.localTrackMap.get(e)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(e,t){if(!e)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(e);return!!n&&(!t||n.has(t))}async hasRemoteMediaWithLock(e,t){if(!e)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(e);return!!n&&(!t||n.has(t))}getRemoteMedia(e){var t;const n=Array.from(es(t=this.remoteUserMap).call(t)).find((r=>r.uid===e));return n?{audioTrack:n.audioTrack,audioSSRC:n._audioSSRC,videoTrack:n.videoTrack,videoSSRC:n._videoSSRC}:{}}getAudioLevels(){let e=Array.from(this.remoteUserMap.entries()).map((n=>{let[r]=n;return{uid:r.uid,level:r.audioTrack?100*r.audioTrack._source.getAccurateVolumeLevel():0}}));const t=this.localTrackMap.get(ve.LocalAudioTrack);return t&&e.push({level:100*t.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e=hh(e).call(e,((n,r)=>n.level-r.level)),e}async disconnectForReconnect(){this.connection&&(w.debug("[".concat(this.store.clientId,"] P2PChannel.disconnectForReconnect closing P2PConnection")),this.state=en.Reconnecting,B("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach((e=>{let[t]=e;var n;t._videoTrack&&t._videoTrack._player&&((n=t._videoTrack._player.getVideoElement())===null||n===void 0||n.pause(),t._videoTrack._player.isKeepLastFrame=!0,t._videoTrack._originMediaStreamTrack.stop())})),this.resetConnection(this.connection),this.connection=void 0,this.shouldForwardP2PCreation&&(this.connection=xT(this.store),this.emit(Xe.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach((e=>{var t;let[n,{track:r}]=e;switch(n){case ve.LocalVideoTrack:be(t=r._hints).call(t,ln.LOW_STREAM)?r.close():this.pendingLocalTracks.push(r);break;case ve.LocalAudioTrack:r instanceof cr?this.pendingLocalTracks=this.pendingLocalTracks.concat(r.trackList):this.pendingLocalTracks.push(r);case ve.LocalVideoLowTrack:}})),this.emit(Xe.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach((e=>{let[t,n]=e;Array.from(es(n).call(n)).forEach((r=>{this.setPendingRemoteMedia(t,r)})),this.emit(Xe.MediaReconnectStart,t.uid)})),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.localDataChannels.length!==0&&(this.localDataChannels.forEach((e=>{this.pendingLocalDataChannels.push(e)})),this.localDataChannels.length=0),this.remoteDataChannelMap.size!==0&&(Array.from(this.remoteDataChannelMap.entries()).forEach((e=>{let[t,n]=e;Array.from(es(n).call(n)).forEach((r=>{this.setPendingRemoteDataChannel(t,r)}))})),this.remoteDataChannelMap.clear()),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),w.debug("[".concat(this.store.clientId,"] P2PChannel disconnected, waiting to reconnect.")))}hasPendingRemoteDataChannel(e,t){for(const n of this.pendingRemoteDataChannels){const{user:r,id:i}=n;if((e instanceof Vd?e.uid:e)===r.uid&&i===t)return!0}return!1}setPendingRemoteDataChannel(e,t){this.hasPendingRemoteDataChannel(e,t)||this.pendingRemoteDataChannels.push({user:e,id:t})}hasPendingRemoteMedia(e,t){for(const n of this.pendingRemoteTracks){const{user:r,kind:i}=n;if((e instanceof Vd?e.uid:e)===r.uid&&t===i)return!0}return!1}setPendingRemoteMedia(e,t){this.hasPendingRemoteMedia(e,t)||this.pendingRemoteTracks.push({user:e,kind:t})}restartICE(e){var t=this;return no((function*(){if(!t.connection||t.state!==en.Connected)return;const n=yield Ft(t.mutex.lock("From P2PChannel.restartICE"));let r;try{r=yield Ft(t.connection.restartICE(e));const s=yield Ft(r.next());if(s.done)return;const o=s.value,c=yield o;switch(AI(t.connection)&&t.reportPCStats(Date.now(),!1,t._pcStatsUploadType),e){case $r.UDP_TCP_RELAY:t._pcStatsUploadType=Rl.UDP_TCP_RESTART;break;case $r.TCP_RELAY:t._pcStatsUploadType=Rl.TCP_RESTART;break;case $r.RELAY:t._pcStatsUploadType=Rl.RELAY_RESTART;break;default:t._pcStatsUploadType=Rl.OLD_RESTART}t._isTryConnecting=!0,r.next(c)}catch(s){var i;(i=r)===null||i===void 0||i.throw(s)}finally{n()}}))()}getUplinkNetworkQuality(){if(!this.connection)return 0;const e=this.connection.getStats(),t=this.localTrackMap.get(ve.LocalVideoTrack),n=this.localTrackMap.get(ve.LocalAudioTrack),r=e.videoSend.find((S=>S.ssrc===t?.ssrcs[0].ssrcId)),i=e.audioSend.find((S=>S.ssrc===n?.ssrcs[0].ssrcId));if(!r||!i)return 1;const s=As(this,Xe.NeedSignalRTT),o=r?r.rttMs:void 0,c=i?i.rttMs:void 0,d=o&&c?(o+c)/2:o||c,h=(d&&s?(d+s)/2:d||s)||0,f=100*e.sendPacketLossRate*.7/50+.3*h/1500,g=f<.17?1:f<.36?2:f<.59?3:f<.1?4:5,E=t?.track;if(E&&E._encoderConfig&&E._hints.indexOf(ln.SCREEN_TRACK)===-1){const S=E._encoderConfig.bitrateMax,O=e.bitrate.actualEncoded;if(S&&O){const A=(1e3*S-O)/(1e3*S);return GM[A<.15?0:A<.3?1:A<.45?2:A<.6?3:4][g]}}return g}getDownlinkNetworkQuality(){if(!this.connection)return 0;const e=this.connection.getStats();let t=0;return Array.from(this.remoteUserMap.entries()).forEach((n=>{let[r]=n;const i=r._audioSSRC,s=r._videoSSRC,o=e.audioRecv.find((O=>O.ssrc===i)),c=e.videoRecv.find((O=>O.ssrc===s));if(!o&&!c)return void(t+=1);const d=As(this,Xe.NeedSignalRTT),h=e.rtt,f=(h&&d?(h+d)/2:h||d)||0,g=o?o.jitterMs:void 0,E=e.recvPacketLossRate;let S=.7*E*100/50+.3*f/1500;g&&(S=.6*E*100/50+.2*f/1500+.2*g/400),t+=S<.1?1:S<.17?2:S<.36?3:S<.59?4:5})),this.remoteUserMap.size>0?Math.round(t/this.remoteUserMap.size):t}async muteLocalTrack(e){return new ke(((t,n)=>{this.handleMuteLocalTrack(e,t,n)}))}async replaceTrack(e,t){var n;if(w.debug("[".concat(this.store.clientId,"] P2PChannel replaceTrack from [").concat(e.getTrackId(),"] to [").concat(t.getTrackId(),"]")),!this.connection||this.state!==en.Connected)return;const r=Array.from(this.localTrackMap.entries()).find((s=>{let[,{track:o}]=s;return e===o}));if(!r)return;const i=r[0];if(e!==t&&(this.unbindLocalTrackEvents([{track:e,type:i}]),this.bindLocalTrackEvents([{track:t,type:i}]),r[1].track=t),await((n=this.connection)===null||n===void 0?void 0:n.replaceTrack(t,r[1].id)),this.isPlanB){const s=r[1];s.id=t._mediaStreamTrack.id,this.localTrackMap.set(i,s)}if(i===ve.LocalVideoTrack&&!B("DISABLE_DUAL_STREAM_USE_ENCODING")&&Bt().supportDualStreamEncoding){const s=this.localTrackMap.get(ve.LocalVideoLowTrack);if(s){const o=e._mediaStreamTrack.clone();s.track._originMediaStreamTrack.stop(),s.track._mediaStreamTrack=o,s.track._originMediaStreamTrack=o,await new ke(((c,d)=>{this.handleReplaceTrack(s.track,c,d,!0)}))}}}filterTobePublishedTracks(e,t,n){const r=[],i=this.getAllTracks();e=Lf(e=e.filter((d=>i.indexOf(d)===-1)));let s,o=!1;const c=this.localTrackMap.get(ve.LocalAudioTrack);for(const d of e){if(d instanceof Sn&&(this.localTrackMap.has(ve.LocalVideoTrack)||o?new de(V.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(r.push({track:d,type:ve.LocalVideoTrack}),o=!0),t)){const h=this.getLowVideoTrack(d,n);r.push({track:h,type:ve.LocalVideoLowTrack})}if(d instanceof Wn)if(c){const h=c.track;if(h instanceof cr)bI([d]),h.addAudioTrack(d),this.bindLocalAudioTrackEvents(d,!0);else{const f=II([h,d]);w.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(f.getTrackId(),"]")),this.replaceTrack(h,f)}}else s instanceof cr?(bI([d]),s.addAudioTrack(d)):s||!d._useAudioElement&&Bt().webAudioMediaStreamDest&&!d._bypassWebAudio?s=II(s?[d,s]:[d]):s=d}return s&&(w.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will send audioTrack [").concat(s.getTrackId(),"]")),r.push({track:s,type:ve.LocalAudioTrack})),r}filterTobeUnpublishedTracks(e){const t=[],n=this.getAllTracks();e=Lf(e=e.filter((r=>n.indexOf(r)!==-1)));for(const r of e){if(r instanceof Wn){const i=this.localTrackMap.get(ve.LocalAudioTrack);if(!i)continue;i.track instanceof cr?(i.track.removeAudioTrack(r),this.unbindLocalAudioTrackEvents(r),i.track.trackList.length===0&&(t.push([ve.LocalAudioTrack,i]),i.track.close())):t.push([ve.LocalAudioTrack,i])}if(r instanceof Sn){const i=this.localTrackMap.get(ve.LocalVideoTrack);if(!i)continue;t.push([ve.LocalVideoTrack,i]);const s=this.localTrackMap.get(ve.LocalVideoLowTrack);s&&t.push([ve.LocalVideoLowTrack,s])}}return t}filterTobePublishedDataChannels(e){return e=(e=Lf(e)).filter((t=>this.localDataChannels.findIndex((n=>n.id===t.id))===-1))}filterTobeUnpublishedDataChannels(e){return e=(e=(e=Lf(e)).filter((t=>this.localDataChannels.indexOf(t)!==-1))).filter((t=>t._originDataChannel))}bindLocalTrackEvents(e){e.forEach((t=>{let{track:n,type:r}=t;switch(r){case ve.LocalVideoTrack:n.addListener(Ve.GET_STATS,this.handleGetLocalVideoStats),n.addListener(Ve.GET_RTC_STATS,this.handleGetRTCStats),n.addListener(Ve.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(Ve.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(Ve.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n.addListener(Ve.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),n.addListener(Ve.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.addListener(Ve.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(Ve.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case ve.LocalAudioTrack:this.bindLocalAudioTrackEvents(n);case ve.LocalVideoLowTrack:}}))}bindLocalAudioTrackEvents(e,t){e instanceof cr?e.trackList.forEach((n=>{n.addListener(Ve.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(Ve.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(Ve.GET_STATS,this.handleGetLocalAudioStats),n.addListener(Ve.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(Ve.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)})):(e.addListener(Ve.GET_STATS,this.handleGetLocalAudioStats),e.addListener(Ve.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(Ve.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(Ve.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(Ve.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),t||(e.addListener(Ve.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.addListener(Ve.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack)))}unbindLocalTrackEvents(e){e||(e=Array.from(this.localTrackMap.entries()).map((t=>{let[n,{track:r}]=t;return{track:r,type:n}}))),e.forEach((t=>{let{track:n,type:r}=t;switch(r){case ve.LocalVideoTrack:n.off(Ve.GET_STATS,this.handleGetLocalVideoStats),n.off(Ve.GET_RTC_STATS,this.handleGetRTCStats),n.off(Ve.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.off(Ve.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.off(Ve.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n.off(Ve.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),n.off(Ve.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.off(Ve.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.off(Ve.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case ve.LocalAudioTrack:this.unbindLocalAudioTrackEvents(n);case ve.LocalVideoLowTrack:}}))}unbindLocalAudioTrackEvents(e){e instanceof cr?e.trackList.forEach((t=>{t.off(Ve.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(Ve.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(Ve.GET_STATS,this.handleGetLocalAudioStats),t.off(Ve.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(Ve.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)})):(e.off(Ve.GET_STATS,this.handleGetLocalAudioStats),e.off(Ve.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(Ve.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(Ve.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(Ve.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack),e.off(Ve.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(Ve.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(e,t){t instanceof qf&&t.addListener(Ve.GET_STATS,(n=>{n(this.handleGetRemoteVideoStats(e))})),t instanceof Xf&&t.addListener(Ve.GET_STATS,(n=>{n(this.handleGetRemoteAudioStats(e))}))}unbindRemoteTrackEvents(e){e&&e.removeAllListeners(Ve.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach((e=>{let[t,n]=e;n.has(Me.AUDIO)&&this.unbindRemoteTrackEvents(t._audioTrack),n.has(Me.VIDEO)&&this.unbindRemoteTrackEvents(t._videoTrack)}))}createGatewayPublishMessage(e,t){return e.map(((n,r)=>{var i;let s,o,{track:c,type:d}=n;switch(d){case ve.LocalAudioTrack:s=tn.Audio,o={dtx:c instanceof rE&&c._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1};break;case ve.LocalVideoTrack:s=be(i=c._hints).call(i,ln.SCREEN_TRACK)?tn.Screen:tn.High,o=Pc(Pc({},s2(c)),{},{codec:this.store.codec,svc_mode:yT()});break;case ve.LocalVideoLowTrack:s=tn.Low,o=Pc(Pc({},s2(c)),{},{codec:this.store.codec,svc_mode:yT()})}return{stream_type:s,attributes:o,ssrcs:t[r]}}))}createGatewayUnpublishMessage(e){return e.map((t=>{var n;let r,[i,{track:s,ssrcs:o,id:c}]=t;switch(i){case ve.LocalVideoTrack:r=be(n=s._hints).call(n,ln.SCREEN_TRACK)?tn.Screen:tn.High;break;case ve.LocalAudioTrack:r=tn.Audio;break;case ve.LocalVideoLowTrack:r=tn.Low}return{stream_type:r,ssrcs:o,mid:c}}))}assignLocalTracks(e,t){e.forEach(((n,r)=>{let{track:i,type:s}=n;this.localTrackMap.set(s,{track:i,id:t[r].id,ssrcs:t[r].localSSRC})}))}withdrawLocalTracks(e){e.forEach((t=>{let[n]=t;this.localTrackMap.delete(n)}))}bindConnectionEvents(e){e.onConnectionStateChange=async t=>{if(w.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onConnectionStateChange(").concat(t,")")),this.emit(Xe.PeerConnectionStateChange,t),t==="connecting"&&e instanceof co&&!jn()&&B("FIRST_TCP_CANDIDATE")&&window.setTimeout((()=>{t==="connecting"&&e.extendCandidate()}),B("FIRST_TCP_CANDIDATE_INTERVAL")),t!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),t==="connected"&&(this._restartTimer&&(window.clearTimeout(this._restartTimer),this._restartTimer=void 0),e instanceof co&&eU(e,!0),this._isTryConnecting&&this.reportPCStats(Date.now(),!0,this._pcStatsUploadType),this._isTryConnecting=!1,this._isStartRestartIce=!1,this._pcStatsUploadType=Rl.DISCONNECTED_OR_FAILED,As(this,Xe.QueryClientConnectionState)==="CONNECTED"&&this._isWaitPcToRePub)){const n=this.pendingLocalTracks.map((i=>i.getTrackId())),r=this.pendingLocalDataChannels.map((i=>"dc_".concat(i.id)));We.reportApiInvoke(this.store.sessionId,{name:Gn.REPUB_AFTER_PC_CONNECTED,options:n.concat(r),tag:Nn.TRACER}).onSuccess(),this.republish()}if(B("NEW_ICE_RESTART")&&e instanceof co&&!jn()&&!this._forceTurn){if(be($M).call($M,t)){if(this._isStartRestartIce)return;this._isStartRestartIce=!0;const n=i=>{AI(e)&&(w.debug("[".concat(this.store.clientId,"] [P2PChannel] try to restartICE, type is ").concat(i)),As(this,Xe.QueryClientConnectionState)==="CONNECTED"&&this.emit(Xe.RequestRestartICE,i))},r=()=>{AI(e)&&(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),w.debug("[".concat(this.store.clientId,"] P2PConnection disconnected timeout, force reconnect")),setTimeout((()=>this.emit(Xe.P2PLost)),0),this.iceFailedCount+=1,this.requestReconnect())};return void(this._restartTimer=window.setTimeout((()=>{tU(e,n,r)}),800))}}else{if(t==="disconnected"&&e.iceConnectionState==="disconnected")return setTimeout((()=>{e.iceConnectionState==="disconnected"&&B("ICE_RESTART")&&As(this,Xe.QueryClientConnectionState)==="CONNECTED"&&this.emit(Xe.RequestRestartICE)}),800),void setTimeout((()=>{e.peerConnectionState==="disconnected"&&(w.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection disconnected timeout 4000ms, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isTryConnecting=!1,setTimeout((()=>this.emit(Xe.P2PLost)),0),this.iceFailedCount+=1,this.requestReconnect())}),4e3);t==="failed"&&(w.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection state failed, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),setTimeout((()=>this.emit(Xe.P2PLost)),0),this.iceFailedCount+=1,await this.requestReconnect())}},e.onICEConnectionStateChange=t=>{t!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),w.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(t,")")),We.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:t,tag:Nn.TRACER}).onSuccess(),this.emit(Xe.IceConnectionStateChange,t)},e.onICETransportStateChange=t=>{w.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(t,")"))},e.onDTLSTransportStateChange=t=>{w.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(t,")"))},e.onDTLSTransportError=t=>{w.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(t,")"))},e.onFirstAudioDecoded=t=>{var n;const r=Array.from(es(n=this.remoteUserMap).call(n)).find((s=>s._audioSSRC===t));var i;r&&(this.store.subscribe(r.uid,"audio",void 0,void 0,void 0,Date.now()),(i=r.audioTrack)===null||i===void 0||i.emit(so.FIRST_FRAME_DECODED),We.firstRemoteFrame(this.store.sessionId,fr.FIRST_AUDIO_DECODE,In.FIRST_AUDIO_DECODE,{peer:r._uintid,subscribeElapse:ei.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId}))},e.onFirstAudioReceived=t=>{var n;const r=Array.from(es(n=this.remoteUserMap).call(n)).find((i=>i._audioSSRC===t));r&&We.firstRemoteFrame(this.store.sessionId,fr.FIRST_AUDIO_RECEIVED,In.FIRST_AUDIO_RECEIVED,{peer:r._uintid,subscribeElapse:ei.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onFirstVideoDecoded=(t,n,r)=>{var i;const s=Array.from(es(i=this.remoteUserMap).call(i)).find((o=>o._videoSSRC===t));s&&this.store.firstVideoFrameDecoded(s.uid,{firstDecoded:Date.now()}),this.reportVideoFirstFrameDecoded(t,n,r)},e.onFirstVideoRender=t=>{var n;const r=Array.from(es(n=this.remoteUserMap).call(n)).find((i=>i._videoSSRC===t));r&&(this.store.firstVideoFrameDecoded(r.uid,{firstPreRender:Date.now()}),this.reportVideoFirstFrameRender(r))},e.onFirstVideoReceived=t=>{var n;const r=Array.from(es(n=this.remoteUserMap).call(n)).find((i=>i._videoSSRC===t));r&&(this.store.firstVideoFrameDecoded(r.uid,{firstReceived:Date.now()}),We.firstRemoteFrame(this.store.sessionId,fr.FIRST_VIDEO_RECEIVED,In.FIRST_VIDEO_RECEIVED,{peer:r._uintid,subscribeElapse:ei.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId}))},e.onSelectedLocalCandidateChanged=(t,n)=>{const r=t.candidateType==="relay",i=n.candidateType==="relay";n.candidateType!=="unknown"&&r===i||this.emit(Xe.ConnectionTypeChange,r),w.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(xd(n))," -> ").concat(JSON.stringify(xd(t)),")"))},e.onSelectedRemoteCandidateChanged=(t,n)=>{w.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(xd(n))," -> ").concat(JSON.stringify(xd(t)),")"))},e.onFirstVideoDecodedTimeout=t=>{this.reportVideoFirstFrameDecoded(t,void 0,void 0,!0)},e.getLocalVideoStats=()=>{const t=this.statsCollector.getLocalVideoTrackStats(),n=this.statsCollector.getRTCStats();return Pc(Pc({},t),n)},e.onICECandidateError=t=>{this._iceError=t}}resetConnection(e){e instanceof co&&(function(t){cm.delete(t.id),eU(t)})(e),e.close(),this.emit(Xe.PeerConnectionStateChange,"closed"),(function(t){t.onConnectionStateChange=void 0,t.onICEConnectionStateChange=void 0,t.onICETransportStateChange=void 0,t.onDTLSTransportStateChange=void 0,t.onDTLSTransportError=void 0,t.onFirstAudioDecoded=void 0,t.onFirstAudioReceived=void 0,t.onFirstVideoDecoded=void 0,t.onFirstVideoReceived=void 0,t.onSelectedLocalCandidateChanged=void 0,t.onSelectedRemoteCandidateChanged=void 0,t.onFirstVideoDecodedTimeout=void 0,t.getLocalVideoStats=void 0})(e),this._isWaitPcToRePub=!1}filterTobeMutedTracks(e){const t=[];if(this.getAllTracks().indexOf(e)===-1)return t;const n=this.localTrackMap.get(ve.LocalAudioTrack);if(e instanceof Wn&&n?.track instanceof cr)return n.track.isActive||t.push([ve.LocalAudioTrack,n]),t;const r=Array.from(this.localTrackMap.entries()).find((i=>{let[,{track:s}]=i;return e===s}));if(r&&(t.push(r),r[0]===ve.LocalVideoTrack)){const i=this.localTrackMap.get(ve.LocalVideoLowTrack);i&&t.push([ve.LocalVideoLowTrack,i])}return t}filterTobeUnmutedTracks(e){const t=[],n=this.localTrackMap.get(ve.LocalAudioTrack);if(e instanceof Wn&&n?.track instanceof cr)return n.track.isActive&&t.push([ve.LocalAudioTrack,n]),t;const r=Array.from(this.localTrackMap.entries()).find((i=>{let[,{track:s}]=i;return e===s}));if(r)if(r[0]===ve.LocalVideoTrack){t.push(r);const i=this.localTrackMap.get(ve.LocalVideoLowTrack);i&&t.push([ve.LocalVideoLowTrack,i])}else t.push(r);return t}createMuteMessage(e){return e.map((t=>{var n;let r,[i,{track:s,ssrcs:o,id:c}]=t;switch(i){case ve.LocalAudioTrack:r=tn.Audio;break;case ve.LocalVideoTrack:r=be(n=s._hints).call(n,ln.SCREEN_TRACK)?tn.Screen:tn.High;break;case ve.LocalVideoLowTrack:r=tn.Low}return{stream_type:r,ssrcs:o,mid:c}}))}createUnmuteMessage(e){return e.map((t=>{var n;let r,[i,{track:s,ssrcs:o,id:c}]=t;switch(i){case ve.LocalAudioTrack:r=tn.Audio;break;case ve.LocalVideoTrack:r=be(n=s._hints).call(n,ln.SCREEN_TRACK)?tn.Screen:tn.High;break;case ve.LocalVideoLowTrack:r=tn.Low}return{stream_type:r,ssrcs:o,mid:c}}))}filterTobeUnSubscribedTracks(e,t){const n=[],r=this.remoteUserMap.get(e);if(!r)return n;if(t){const i=r.get(t);if(!i)return n;n.push([e,{kind:t,id:i}])}else Array.from(r.entries()).forEach((i=>{let[s,o]=i;n.push([e,{kind:s,id:o}])}));return n}filterTobeUnSubscribedDataChannels(e,t){const n=[];return t.forEach((r=>{var i;(i=this.remoteDataChannelMap.get(e))!==null&&i!==void 0&&i.has(r.id)&&n.push(r)})),n}createUnsubscribeMessage(e){const t=[];return e.forEach((n=>{let[r,{kind:i,id:s}]=n;switch(i){case Me.VIDEO:return void(r._videoSSRC&&t.push({stream_type:Me.VIDEO,ssrcId:r._videoSSRC}));case Me.AUDIO:return void(r._audioSSRC&&t.push({stream_type:Me.AUDIO,ssrcId:r._audioSSRC}))}})),t}createUnsubscribeAllMessage(e){const t=new Map;return e.forEach((n=>{let[r,{kind:i}]=n;if(t.has(r)){let s=t.get(r);i===Me.VIDEO?s|=vr.Video:s|=vr.Audio,t.set(r,s)}else i===Me.VIDEO?t.set(r,vr.Video):t.set(r,vr.Audio)})),{users:Array.from(t.entries()).map((n=>{let[r,i]=n;return{stream_id:r.uid,stream_type:i}}))}}withdrawRemoteTracks(e){e.forEach((t=>{let[n,{kind:r}]=t;const i=this.remoteUserMap.get(n);i&&(i.delete(r),Array.from(i.entries()).length===0&&this.remoteUserMap.delete(n))}))}async updateBitrateLimit(e){const t=this.localTrackMap.get(ve.LocalVideoTrack),n=this.localTrackMap.get(ve.LocalVideoLowTrack);t&&(await t.track.setBitrateLimit(e.uplink),await new ke(((r,i)=>{this.handleUpdateVideoEncoder(t.track,r,i,!0)}))),n&&e.low_stream_uplink&&(await n.track.setBitrateLimit({max_bitrate:e.low_stream_uplink.bitrate,min_bitrate:e.low_stream_uplink.bitrate||0}),await new ke(((r,i)=>{this.handleUpdateVideoEncoder(n.track,r,i,!0)})))}isP2PDisconnected(){return this.connection?this.connection.peerConnectionState!=="connected":!0}isPreallocation(){return this.connection instanceof co&&this.connection.isPreallocation}isPreSub(){return this.connection instanceof co&&this.connection.isPreSub()}mapPubResToRemoteConfig(e,t,n){return e.map(((r,i)=>{var s;let{stream_type:o}=r;const c=(s=t.find((d=>{let{stream_type:h}=d;return o===h})))===null||s===void 0?void 0:s.attributes;if(c&&B("DISABLE_SCREEN_SHARE_REMB")){const d=n[i]._hints;(be(d).call(d,ln.SCREEN_TRACK)||be(d).call(d,ln.SCREEN_LOW_TRACK))&&(c.remb=!1,w.debug("disable remb for screen share, hints:",d))}return c}))}async tryToUnmuteAudio(e){for(let n=0;n<e.length;n++)if(e[n]instanceof Wn){var t;const r=this.filterTobeUnmutedTracks(e[n]);if(r.length===0)continue;await((t=this.connection)===null||t===void 0?void 0:t.unmuteLocal(r.map((s=>{let[,{id:o}]=s;return o}))));const i=this.createUnmuteMessage(r);return void await un(this,Xe.RequestUnmuteLocal,i)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=()=>this.getStats(),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=e=>{var t;return!((t=this.connection)===null||t===void 0||!t.getRemoteVideoIsReady(e))},this.statsUploader.requestUpload=(e,t)=>this.emit(Xe.RequestUpload,e,t),this.statsUploader.requestUploadStats=e=>this.emit(Xe.RequestUploadStats,e),this.statsUploader.requestAllTracks=()=>this.getAllTracks(),this.statsUploader.requestTransportStats=()=>{var e;return{connectState:((e=this.connection)===null||e===void 0?void 0:e.peerConnectionState)||"closed"}}}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await xr(pb(this.dtlsFailedCount,rr)),this.emit(Xe.RequestReconnect)}async reconnectP2P(){const e=Array.from(this.localTrackMap.entries()),t=this.createGatewayUnpublishMessage(e);Array.from(this.remoteUserMap.entries()),t.length>0&&await Gr(this,Xe.RequestUnpublishForReconnectPC,t),this.disconnectForReconnect(),this.emit(Xe.RequestReconnectPC)}canPublishLowStream(){return this.localTrackMap.has(ve.LocalVideoTrack)||this.pendingLocalTracks.some((e=>e instanceof Sn))}throwIfTrackTypeNotMatch(e){if(e.filter((t=>t instanceof Sn)).length>1)throw new de(V.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e.filter((t=>t instanceof Wn)).length>1&&(e.some((t=>t instanceof Wn&&t._bypassWebAudio))||!Bt().webAudioMediaStreamDest))throw new de(V.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const t of e){if(t instanceof Sn&&this.pendingLocalTracks.some((n=>n instanceof Sn)))throw new de(V.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t instanceof Wn&&this.pendingLocalTracks.some((n=>n instanceof Wn))&&(!Bt().webAudioMediaStreamDest||t._bypassWebAudio||this.pendingLocalTracks.some((n=>n instanceof Wn&&n._bypassWebAudio))))throw new de(V.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(e,t){var n;const r=!B("DISABLE_DUAL_STREAM_USE_ENCODING")&&Bt().supportDualStreamEncoding,i=Pc(Pc({},{width:160,height:120,framerate:15,bitrate:50}),t);let s;s=r?e._mediaStreamTrack.clone():NI(e,i);const o=hn(8,"track-low-"),c=new Sn(s,Pc(Pc({},r&&{scaleResolutionDownBy:lI(i,e)}),{},{frameRate:i.framerate,bitrateMax:i.bitrate,bitrateMin:i.bitrate}),void 0,void 0,o);return c.on(Ch.TRANSCEIVER_UPDATED,(d=>{e._updateRtpTransceiver(d,Wf.LOW_STREAM)})),c._hints.push(ln.LOW_STREAM),be(n=e._hints).call(n,ln.SCREEN_TRACK)&&c._hints.push(ln.SCREEN_LOW_TRACK),e.on("sei-to-send",(d=>{c.emit("sei-to-send",d)})),e.addListener(Ve.NEED_CLOSE,(()=>{c.close()})),c}async globalLock(){return this.mutex.lock("From P2PChannel.globalLock")}async reportPCStats(e,t,n){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;if(this.connection&&this.connection instanceof co){var i,s,o,c;const d=this.store.keyMetrics.descriptionStart||0,{iceConnectionState:h,dtlsTransportState:f,peerConnectionState:g}=this.connection,{local:E,remote:S}=await this.connection.getSelectedCandidatePair();We.pcStats(this.store.sessionId,{startTime:d,eventElapse:e-d||0,iceconnectionsate:h,dtlsstate:f,connectionstate:g,intSucc:t?1:2,error:this._iceError||r||"",selectedLocalCandidateProtocol:(i=E?.protocol)!==null&&i!==void 0?i:"",selectedLocalCandidateType:(s=E.candidateType)!==null&&s!==void 0?s:"",selectedLocalCandidateAddress:"".concat(E.address,":").concat(E.port),selectedRemoteCandidateProtocol:(o=S.protocol)!==null&&o!==void 0?o:"",selectedRemoteCandidateType:(c=S.candidateType)!==null&&c!==void 0?c:"",selectedRemoteCandidateAddress:"".concat(S.address,":").concat(S.port),restartCnt:n,preallocation:this.connection.isPreallocation}),this._iceError=null}}reportVideoFirstFrameRender(e){const t=this.store.keyMetrics,n=t.firstVideoFrameDecoded.find((f=>f.userId===e.uid));if(!n)return;const{isInternalUpload:r,isExternalUpload:i}=n;if(r&&i)return;const{subscribeEnd:s,firstPreRender:o,peerPublishDuration:c,peerPubStatusMs:d}=n;let{firstRender:h=0}=n;if(s&&(h||o)&&c&&d){n.isInternalUpload=!0;const{playEnd:f}=n;f&&(n.isExternalUpload=!0);const{firstPreRender:g=0}=n;h=g||h;const E=e.videoTrack,S={peer:e._uintid,width:E?._videoWidth||0,height:E?._videoHeight||0,ssrc:e._videoSSRC||0,p2pid:this.store.p2pId,peerPublishDuration:c,peerPubStatusMs:d,joinChannelStart:t.joinStart||0,preloadStart:t.preloadStart||0,preloadEnd:t.preloadEnd||0,apStart:t.requestAPStart||0,apEnd:t.requestAPEnd||0,suaEnd:t.requestSUAEnd||0,beforeConnect:t.beforeConnect||0,peerReceiver:t.peerReceiver||0,ice:t.iceConnectionEnd||0,pc:t.peerConnectionEnd||0,signalConnected:t.signalConnected||0,joinReq:t.joinReq||0,joinRes:t.joinRep||0,userJoinNotify:n.userJoinNotify||0,videoAddNotify:n.videoAddNotify||0,subscribeStart:n.subscribeStart||0,subscribeEnd:n.subscribeEnd||0,firstReceived:n.firstReceived||0,firstDecoded:n.firstDecoded||0,firstPreRender:g||0,firstRender:f?Math.max(h,f):Math.max(h,s),playStart:n.playStart||0,playEnd:n.playEnd||0,isPreSub:!(!e._videoSSRC||!this.isPreSubScribe(e._videoSSRC)),isPrePc:this.isPreallocation(),isPreInstantVideo:N1(this.store)};We.firstXLAPeerFirstVideoFrame(this.store.sessionId,S)}}reportVideoFirstFrameDecoded(e,t,n,r){var i;const s=Array.from(es(i=this.remoteUserMap).call(i)).find((o=>o._videoSSRC===e));if(s){r||this.store.subscribe(s.uid,"video",void 0,void 0,void 0,void 0,Date.now());const o=this.store.keyMetrics,c=o.subscribe.find((d=>d.userId===s.uid&&d.type==="video"));We.firstRemoteVideoDecode(this.store.sessionId,fr.FIRST_VIDEO_DECODE,In.FIRST_VIDEO_DECODE,{peer:s._uintid,videowidth:t,videoheight:n,subscribeElapse:ei.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId,apEnd:o.requestAPEnd||0,apStart:o.requestAPStart||0,joinGwEnd:o.joinGatewayEnd||0,joinGwStart:o.joinGatewayStart||0,pcEnd:o.peerConnectionEnd||0,pcStart:o.peerConnectionStart||0,subscriberEnd:c?.subscribeEnd||0,subscriberStart:c?.subscribeStart||0,videoAddNotify:c?.streamAdded||0,state:r?1:0,firstFrame:c?.firstFrame||0})}}async remoteMediaSsrcChanged(e,t,n){if(!this.connection)return!1;const r=this.remoteUserMap.get(e);if(!r)return!1;const i=r.get(t);if(!i)return!1;const s=await this.connection.getRemoteSSRC(i);return s!==void 0&&s!==n}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach((e=>{let[t,{track:n}]=e;t===ve.LocalVideoLowTrack?n._updateRtpTransceiver(void 0,Wf.LOW_STREAM):n._updateRtpTransceiver(void 0)}))}},Be(It.prototype,"startP2PConnection",[_i],Object.getOwnPropertyDescriptor(It.prototype,"startP2PConnection"),It.prototype),Be(It.prototype,"connect",[_i],Object.getOwnPropertyDescriptor(It.prototype,"connect"),It.prototype),Be(It.prototype,"updateRemoteRTPCapabilities",[_i],Object.getOwnPropertyDescriptor(It.prototype,"updateRemoteRTPCapabilities"),It.prototype),Be(It.prototype,"publishDataChannel",[_i],Object.getOwnPropertyDescriptor(It.prototype,"publishDataChannel"),It.prototype),Be(It.prototype,"unpublish",[_i],Object.getOwnPropertyDescriptor(It.prototype,"unpublish"),It.prototype),Be(It.prototype,"unpublishDataChannel",[_i],Object.getOwnPropertyDescriptor(It.prototype,"unpublishDataChannel"),It.prototype),Be(It.prototype,"unpublishLowStream",[_i],Object.getOwnPropertyDescriptor(It.prototype,"unpublishLowStream"),It.prototype),Be(It.prototype,"subscribeDataChannel",[_i],Object.getOwnPropertyDescriptor(It.prototype,"subscribeDataChannel"),It.prototype),Be(It.prototype,"subscribe",[_i],Object.getOwnPropertyDescriptor(It.prototype,"subscribe"),It.prototype),Be(It.prototype,"massSubscribe",[_i],Object.getOwnPropertyDescriptor(It.prototype,"massSubscribe"),It.prototype),Be(It.prototype,"unsubscribe",[_i],Object.getOwnPropertyDescriptor(It.prototype,"unsubscribe"),It.prototype),Be(It.prototype,"unsubscribeDataChannel",[_i],Object.getOwnPropertyDescriptor(It.prototype,"unsubscribeDataChannel"),It.prototype),Be(It.prototype,"massUnsubscribe",[_i],Object.getOwnPropertyDescriptor(It.prototype,"massUnsubscribe"),It.prototype),Be(It.prototype,"muteRemote",[_i],Object.getOwnPropertyDescriptor(It.prototype,"muteRemote"),It.prototype),Be(It.prototype,"unmuteRemote",[_i],Object.getOwnPropertyDescriptor(It.prototype,"unmuteRemote"),It.prototype),Be(It.prototype,"hasRemoteMediaWithLock",[_i],Object.getOwnPropertyDescriptor(It.prototype,"hasRemoteMediaWithLock"),It.prototype),Be(It.prototype,"disconnectForReconnect",[_i],Object.getOwnPropertyDescriptor(It.prototype,"disconnectForReconnect"),It.prototype),Be(It.prototype,"updateBitrateLimit",[_i],Object.getOwnPropertyDescriptor(It.prototype,"updateBitrateLimit"),It.prototype),Be(It.prototype,"remoteMediaSsrcChanged",[_i],Object.getOwnPropertyDescriptor(It.prototype,"remoteMediaSsrcChanged"),It.prototype),It);function _i(e,t,n){const r=e[t];if(typeof r!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const i=this.mutex,s=await i.lock("From P2PChannel.".concat(t));try{for(var o=arguments.length,c=new Array(o),d=0;d<o;d++)c[d]=arguments[d];return await r.apply(this,c)}finally{s()}},n}function iU(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable}))),n.push.apply(n,r)}return n}function sU(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?iU(Object(n),!0).forEach((function(r){x(e,r,n[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):iU(Object(n)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))}))}return e}const k7=Date.now(),x7=20,PI=new Map,VT=new Map;async function oU(e){const t=PI.get(e),n=Array.isArray(t)&&t[t.length-1],r=VT.get(e);if(!n)return void(r.isSyncing=!1);const i={uid:n.uid,payload:n.payload};r.firstRecvTs===0&&(r.firstRecvTs=n.recvTs,r.firstSendTs=n.sendTs);const s=n.sendTs-r.firstSendTs,o=s-(Date.now()-r.firstRecvTs);o>0&&(r.firstRecvTs=Date.now()-s);let c=n.mediaDelay+o;c<=0?(t.pop(),aU(n.context,i),c=0):c=Math.min(c,x7),setTimeout((()=>t.length&&oU(e)),c)}function aU(e,t){e.safeEmit(Ot.STREAM_MESSAGE,t.uid,t.payload),e.onStreamMessage&&e.onStreamMessage(t)}function L7(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0;if(!e.syncWithAudio)return aU(n,{uid:e.uid,payload:e.payload});const r="".concat(n.id,"-").concat(e.uid),i=PI.get(r)||[],s=i.findIndex((h=>e.sendTs>=h.sendTs)),o=sU(sU({},e),{},{context:n,mediaDelay:t,recvTs:Date.now()});s===-1?i.push(o):i.splice(s,0,o),PI.set(r,i);let c=!1;var d;VT.has(r)?c=!((d=VT.get(r))===null||d===void 0||!d.isSyncing):VT.set(r,{isSyncing:c,firstRecvTs:0,firstSendTs:0}),c||oU(r)}const M7=Mt().name;function cU(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable}))),n.push.apply(n,r)}return n}function lU(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?cU(Object(n),!0).forEach((function(r){x(e,r,n[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):cU(Object(n)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))}))}return e}const lm="websdk_ng_cache_parameter",U7=B("MAX_PRELOAD_ASYNC_LENGTH"),j7=1e4,Lh=new Map,Mh=[];let DI=null,kI=0,xI=0;const FT=new Map,V7=(function(e,t){const n=[];let r=0;const i=async()=>{const s=n.shift();s&&await s(),n.length>0&&r<t?i():r--};return async function(){for(var s=arguments.length,o=new Array(s),c=0;c<s;c++)o[c]=arguments[c];return new ke((async(d,h)=>{n.push((async()=>{try{const f=await e(...o);d(f)}catch(f){h(f)}})),r<t&&(r++,i())}))}})(dU,U7),LI=ji.CancelToken.source();async function dU(e,t,n,r,i,s){try{if(!B("ENABLE_PRELOAD"))return;if(!Bt().supportWebCrypto)return void Id((()=>{w.warn("Your browser does not support preloading, this feature  be run in a secure environment")}),"preload_webcrypto_not_supported");if(!n&&n!==null)throw new de(V.INVALID_PARAMS,"Invalid token: ".concat(n,". If you don not use token, set it to null"));n&&kr(n,"token",1,2047),kr(e,"appid",1,2047),fT(t),r&&mT(r);const o=Rh();w.debug("preload channel ".concat(t,", uid is ").concat(r));const c={appId:e,cname:t,token:n||e,uid:typeof r!="string"?r:null,sid:o,proxyServer:i};let d,h;typeof r=="string"?(c.stringUid=r,[h,d]=await ke.all([T7(r,{sid:o,appId:e},LI.token),M2(lU(lU({},c),{},{token:n||e,uid:0}),LI.token)]),c.uid=h.uid,d.gatewayInfo.uid=c.uid,d.gatewayInfo.res.uid=c.uid):(s&&(c.stringUid=s),d=await M2(c,LI.token));const f={sid:o,appId:e,cname:t,token:n||e,uid:c.stringUid||r,intUid:c.uid||d.gatewayInfo.uid,stringUid:c.stringUid,ts:Date.now(),sua:h,ap:d};await(async function(g){let E;try{g.uid&&hU({appId:g.appId,cname:g.cname,token:g.token,uid:g.uid,stringUid:g.stringUid});const S=_U(g),O=await(async function(N,j){try{const U=await window.crypto.subtle.importKey("raw",n1(j),"AES-GCM",!1,["encrypt"]),W=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:new Uint8Array(1)},U,Th(window.btoa(JSON.stringify(N))));return Ad(new Uint8Array(W))}catch{return}})(g,g.token||g.appId);if(!O)return;E=mU(lm);const A=E?JSON.parse(E):[];A.push({[S]:O}),A.length>B("AP_CACHE_NUM")&&A.shift(),BT(lm,JSON.stringify(A))}catch(S){w.warn("Error caching server parameters:",S.message),BT(lm,"")}})(f),kI++}catch(o){throw xI++,(function(c){DI||(DI=window.setTimeout((()=>{let h="";FT.forEach(((f,g)=>{h+="".concat(g,": ").concat(f," ;")})),We.reportApiInvoke(null,{name:Gn.PRELOAD,options:{success:kI,failed:xI,err:h}}).onError(c),kI=0,xI=0,FT.clear(),DI=null}),j7));const d=FT.get(c.code)||0;FT.set(c.code,d+1)})(o),o}}async function uU(e){try{if(B("AP_REQUEST_DETAIL")||B("ENABLE_ROLE_SELECT_EDGE"))return;const t=hU(e);if(!t||e.cloudProxyServer!=="disabled")return;const n=await(async function(r,i){try{const s=await window.crypto.subtle.importKey("raw",n1(i),"AES-GCM",!1,["decrypt"]),o=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:new Uint8Array(1)},s,Th(r));return JSON.parse(window.atob(Ad(new Uint8Array(o))))}catch{return}})(t,e.token||e.appId);if(!n||!(function(r,i){return r.cname===i.cname&&r.appId===i.appId&&r.token===i.token?i.stringUid?r.stringUid===i.stringUid:typeof i.uid=="number"?r.uid===i.uid:r.uid==i.uid:!1})(n,e))return;if(n&&Date.now()-n.ts<B("AP_CACHE_LIFETIME"))return n}catch(t){w.warn("Error get preloadInfo",t.message)}}function hU(e){let t;try{if(t=mU(lm),!t)return;const n=JSON.parse(t),r=_U(e),i=(function(o,c){for(let d=o.length-1;d>=0;d--)if(c(o[d]))return d;return-1})(n,(o=>r in o));if(i===-1)return;const s=n.splice(i,1)[0];return BT(lm,JSON.stringify(n)),s[r]}catch(n){w.warn("Error delete preload info: ".concat(t),n.message),BT(lm,"")}}function MI(e){if(e){let t=Lh.get(e);t&&(window.clearTimeout(t),t=null,Lh.delete(e)),be(Mh).call(Mh,e)||e.cloudProxyServer!=="disabled"||Mh.push(e)}if(Lh.size<B("AP_CACHE_NUM")&&Mh.length>0){const t=Mh.shift();Lh.set(t,window.setTimeout((async()=>{const{appId:n,cname:r,token:i,stringUid:s,uid:o,proxyServer:c}=t;try{await V7(n,r,i,o,c,s),Lh.has(t)&&MI(t)}catch(d){w.warn("update preload failed",d.message),pU(t)}}),B("AP_UPDATE_INTERVAL")))}}function pU(e){const t=Mh.indexOf(e);t!==-1&&Mh.splice(t,1);let n=Lh.get(e);n&&(window.clearTimeout(n),n=null,Lh.delete(e),MI())}function fU(e,t){const n=e.sua,r=e.ap;t&&n&&We.reqUserAccount(e.sid,{lts:n.requestTime,elapse:n.elapse,success:!0,serverAddr:n.url,stringUid:t,uid:e.intUid,errorCode:null,extend:n.req}),We.reportResourceTiming(e.ap.url,e.sid),We.joinWebProxyAP(e.sid,{lts:r.requestTime,elapse:r.elapse,sucess:1,apServerAddr:r.url,turnServerAddrList:r.proxyInfo.addresses.map((i=>i.ip)).join(","),eventType:"disabled",unilbsServerIds:[Zn.CHOOSE_SERVER,Zn.CLOUD_PROXY_FALLBACK].toString()}),We.joinChooseServer(e.sid,{lts:r.requestTime,elapse:r.elapse,succ:!0,csAddr:r.url,opid:r.opid,serverList:r.gatewayInfo.gatewayAddrs.map((i=>i.address)),ec:null,cid:r.gatewayInfo.cid.toString(),uid:r.gatewayInfo.uid.toString(),csIp:r.gatewayInfo.csIp,unilbsServerIds:[Zn.CHOOSE_SERVER].toString(),isHttp3:r.isHttp3})}function mU(e){return window.atob(window.localStorage.getItem(e)||"")}function BT(e,t){window.localStorage.setItem(e,window.btoa(t))}function _U(e){let t="".concat(e.appId,"_").concat(e.cname);return typeof e.uid=="string"&&(t+="_s_".concat(e.uid)),typeof e.uid=="number"&&(t+="_".concat(e.uid)),e.token&&(t+="_".concat(e.token)),l1(t)}function F7(e){let t=(function(){const n=G7.pop();return n?(n.offset=n.limit=0,n):{bytes:new Uint8Array(64),offset:0,limit:0}})();return(function(n,r){let i=n.appId;i!==void 0&&($n(r,10),Bd(r,i));let s=n.cid;s!==void 0&&($n(r,16),$n(r,s));let o=n.cname;o!==void 0&&($n(r,26),Bd(r,o));let c=n.deviceId;c!==void 0&&($n(r,34),Bd(r,c));let d=n.elapse;d!==void 0&&($n(r,40),Wd(r,d));let h=n.fileSize;h!==void 0&&($n(r,48),Wd(r,dm(h)));let f=n.height;f!==void 0&&($n(r,56),Wd(r,dm(f)));let g=n.jpg;g!==void 0&&($n(r,66),$n(r,g.length),EU(r,g));let E=n.networkType;E!==void 0&&($n(r,72),Wd(r,dm(E)));let S=n.osType;S!==void 0&&($n(r,80),Wd(r,dm(S)));let O=n.requestId;O!==void 0&&($n(r,90),Bd(r,O));let A=n.sdkVersion;A!==void 0&&($n(r,98),Bd(r,A));let N=n.sequence;N!==void 0&&($n(r,104),Wd(r,dm(N)));let j=n.sid;j!==void 0&&($n(r,114),Bd(r,j));let U=n.timestamp;U!==void 0&&($n(r,120),Wd(r,U));let W=n.uid;W!==void 0&&($n(r,128),$n(r,W));let $=n.vid;$!==void 0&&($n(r,136),$n(r,$));let Z=n.width;Z!==void 0&&($n(r,144),Wd(r,dm(Z)));let Y=n.service;Y!==void 0&&($n(r,152),$n(r,Y));let ie=n.callbackData;ie!==void 0&&($n(r,162),$n(r,ie.length),EU(r,ie));let ue=n.ticket;ue!==void 0&&($n(r,170),Bd(r,ue));let ge=n.vendorConfigs;ge!==void 0&&($n(r,178),Bd(r,ge))})(e,t),(function(n){let r=n.bytes,i=n.limit;return r.length===i?r:r.subarray(0,i)})(t)}function B7(e){return(function(n){let r={};e:for(;!H7(n);){let i=EE(n);switch(i>>>3){case 0:break e;case 1:r.code=EE(n);break;case 2:r.msg=vU(n,EE(n));break;case 3:r.requestId=vU(n,EE(n));break;case 4:r.timestamp=K7(n,!1);break;default:W7(n,7&i)}}return r})({bytes:t=e,offset:0,limit:t.length});var t}function W7(e,t){switch(t){case 0:for(;128&Yo(e););break;case 2:UI(e,EE(e));break;case 5:UI(e,4);break;case 1:UI(e,8);break;default:throw new Error("Unimplemented type: "+t)}}function dm(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}let G7=[];function UI(e,t){if(e.offset+t>e.limit)throw new Error("Skip past limit");e.offset+=t}function H7(e){return e.offset>=e.limit}function WT(e,t){let n=e.bytes,r=e.offset,i=e.limit,s=r+t;if(s>n.length){let o=new Uint8Array(2*s);o.set(n),e.bytes=o}return e.offset=s,s>i&&(e.limit=s),r}function gU(e,t){let n=e.offset;if(n+t>e.limit)throw new Error("Read past limit");return e.offset+=t,n}function EU(e,t){let n=WT(e,t.length);e.bytes.set(t,n)}function vU(e,t){let n=gU(e,t),r=String.fromCharCode,i=e.bytes,s="�",o="";for(let c=0;c<t;c++){let d,h,f,g,E=i[c+n];(128&E)==0?o+=r(E):(224&E)==192?c+1>=t?o+=s:(d=i[c+n+1],(192&d)!=128?o+=s:(g=(31&E)<<6|63&d,g<128?o+=s:(o+=r(g),c++))):(240&E)==224?c+2>=t?o+=s:(d=i[c+n+1],h=i[c+n+2],(49344&(d|h<<8))!=32896?o+=s:(g=(15&E)<<12|(63&d)<<6|63&h,g<2048||g>=55296&&g<=57343?o+=s:(o+=r(g),c+=2))):(248&E)==240?c+3>=t?o+=s:(d=i[c+n+1],h=i[c+n+2],f=i[c+n+3],(12632256&(d|h<<8|f<<16))!=8421504?o+=s:(g=(7&E)<<18|(63&d)<<12|(63&h)<<6|63&f,g<65536||g>1114111?o+=s:(g-=65536,o+=r(55296+(g>>10),56320+(1023&g)),c+=3))):o+=s}return o}function Bd(e,t){let n=t.length,r=0;for(let o=0;o<n;o++){let c=t.charCodeAt(o);c>=55296&&c<=56319&&o+1<n&&(c=(c<<10)+t.charCodeAt(++o)-56613888),r+=c<128?1:c<2048?2:c<65536?3:4}$n(e,r);let i=WT(e,r),s=e.bytes;for(let o=0;o<n;o++){let c=t.charCodeAt(o);c>=55296&&c<=56319&&o+1<n&&(c=(c<<10)+t.charCodeAt(++o)-56613888),c<128?s[i++]=c:(c<2048?s[i++]=c>>6&31|192:(c<65536?s[i++]=c>>12&15|224:(s[i++]=c>>18&7|240,s[i++]=c>>12&63|128),s[i++]=c>>6&63|128),s[i++]=63&c|128)}}function Yo(e){return e.bytes[gU(e,1)]}function yU(e,t){let n=WT(e,1);e.bytes[n]=t}function EE(e){let t,n=0,r=0;do t=Yo(e),n<32&&(r|=(127&t)<<n),n+=7;while(128&t);return r}function $n(e,t){for(t>>>=0;t>=128;)yU(e,127&t|128),t>>>=7;yU(e,t)}function K7(e,t){let n,r=0,i=0,s=0;return n=Yo(e),r=127&n,128&n&&(n=Yo(e),r|=(127&n)<<7,128&n&&(n=Yo(e),r|=(127&n)<<14,128&n&&(n=Yo(e),r|=(127&n)<<21,128&n&&(n=Yo(e),i=127&n,128&n&&(n=Yo(e),i|=(127&n)<<7,128&n&&(n=Yo(e),i|=(127&n)<<14,128&n&&(n=Yo(e),i|=(127&n)<<21,128&n&&(n=Yo(e),s=127&n,128&n&&(n=Yo(e),s|=(127&n)<<7))))))))),{low:r|i<<28,high:i>>>4|s<<24,unsigned:t}}function Wd(e,t){let n=t.low>>>0,r=(t.low>>>28|t.high<<4)>>>0,i=t.high>>>24,s=i===0?r===0?n<16384?n<128?1:2:n<1<<21?3:4:r<16384?r<128?5:6:r<1<<21?7:8:i<128?9:10,o=WT(e,s),c=e.bytes;switch(s){case 10:c[o+9]=i>>>7&1;case 9:c[o+8]=s!==9?128|i:127&i;case 8:c[o+7]=s!==8?r>>>21|128:r>>>21&127;case 7:c[o+6]=s!==7?r>>>14|128:r>>>14&127;case 6:c[o+5]=s!==6?r>>>7|128:r>>>7&127;case 5:c[o+4]=s!==5?128|r:127&r;case 4:c[o+3]=s!==4?n>>>21|128:n>>>21&127;case 3:c[o+2]=s!==3?n>>>14|128:n>>>14&127;case 2:c[o+1]=s!==2?n>>>7|128:n>>>7&127;case 1:c[o]=s!==1?128|n:127&n}}const SU={},TU={},GT=4294967296,z7=GT*GT,RU=z7/2;CU(0,!0);const wU=CU(0),Y7=vE(0,-2147483648,!1),q7=vE(-1,2147483647,!1);function CU(e,t){let n,r,i;return t?(i=0<=(e>>>=0)&&e<256)&&(r=TU[e],r)?r:(n=vE(e,0,!0),i&&(TU[e]=n),n):(i=-128<=(e|=0)&&e<128)&&(r=SU[e],r)?r:(n=vE(e,e<0?-1:0,!1),i&&(SU[e]=n),n)}function vE(e,t,n){return{low:0|e,high:0|t,unsigned:!!n}}function bU(e,t){if(isNaN(e))return wU;{if(e<=-RU)return Y7;if(e+1>=RU)return q7}return e<0?wU:vE(e%GT|0,e/GT|0,t)}function IU(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable}))),n.push.apply(n,r)}return n}class jI extends xn{get connectionState(){return this._connectionState}set connectionState(t){if(this._connectionState===t)return;const n=this._connectionState;this._connectionState=t,this.emit(Na.CONNECTION_STATE_CHANGE,t,n)}get quality(){return this._quality}set quality(t){this._quality=t>1?1:t<.1?.1:t,this._qualityTimer&&(window.clearTimeout(this._qualityTimer),this._qualityTimer=null),this._quality>=1||(this._qualityTimer=window.setTimeout((()=>{this.quality=this._quality/this._qualityRatio}),6e4))}constructor(t){var n;super(),x(this,"name","AgoraRTCImageModeration"),x(this,"_connectionState",ao.CONNECTING),x(this,"_sequence",0),x(this,"_moderationStartTime",void 0),x(this,"_workerConnection",void 0),x(this,"_workerMessageLengthLimit",void 0),x(this,"_qualityRatio",void 0),x(this,"_connectInfo",void 0),x(this,"_cancelTokenSource",ji.CancelToken.source()),x(this,"_retryConfig",void 0),x(this,"_moderationInterval",void 0),x(this,"_moderationTimer",null),x(this,"_moderationMode",1),x(this,"_quality",1),x(this,"_qualityTimer",null),x(this,"_ticket",void 0),x(this,"_moderationIntervalMinimum",void 0),x(this,"_uploadFailedNum",0),x(this,"_uploadNum",0),x(this,"_uploadTimer",null),x(this,"_extraInfo",void 0),x(this,"_vendor",""),x(this,"_encoder",new TextEncoder),x(this,"_moderationId",void 0),x(this,"inspectImage",(()=>{if(this.connectionState!==ao.CONNECTED)throw new le(V.OPERATION_ABORTED,"image moderation service connection status is ".concat(this.connectionState));this._moderationTimer&&(window.clearInterval(this._moderationTimer),this._moderationTimer=null),this._moderationTimer=window.setInterval((()=>{this.connectionState===ao.CONNECTED?this.requestToInspectImage():w.debug("[".concat(this._moderationId,"] Moderation State is not connected , "),this.connectionState)}),this._moderationInterval<this._moderationIntervalMinimum?this._moderationIntervalMinimum:this._moderationInterval),this.requestToInspectImage()})),this._moderationId=hn(5,"image-moderation-"),this._workerMessageLengthLimit=B("IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT"),this._moderationIntervalMinimum=B("IMAGE_MODERATION_INTERVAL_MINIMUM"),this._moderationInterval=(n=t.interval)!==null&&n!==void 0?n:1e3,t.extraInfo&&(this._extraInfo=this._encoder.encode(t.extraInfo)),t.vendor&&(this._vendor=t.vendor),this._qualityRatio=B("IMAGE_MODERATION_QUALITY_RATIO"),this._moderationStartTime=Number(Date.now()),this._workerConnection=new cE("worker-"+this._moderationId,rr),this.on(Na.STATE_CHANGE,((r,i)=>{w.debug("[".concat(this._moderationId,"] Moderation operation :").concat($f[r]," ").concat(i||""))})),this.handleWorkerEvents()}async init(t,n){this.emit(Na.STATE_CHANGE,$f.CONNECT_AP),this._connectInfo=t;const r=this._cancelTokenSource.token;return this._retryConfig=n,new ke(((i,s)=>{this.on(Na.CONNECTION_STATE_CHANGE,((o,c)=>{o===ao.CONNECTED&&i()})),this.requestAP(t,r,n).then((o=>{this.connectWorker(o)})).catch((o=>{s(o)}))}))}updateConfig(t){var n;this._moderationInterval=(n=t.interval)!==null&&n!==void 0?n:1e3,t.extraInfo&&(this._extraInfo=this._encoder.encode(t.extraInfo)),t.vendor&&(this._vendor=t.vendor),w.debug("[".concat(this._moderationId,"] updateConfig: ").concat(JSON.stringify(t))),this.connectionState===ao.CONNECTED&&this.inspectImage()}async requestAP(t,n,r){const i=B("WEBCS_DOMAIN").map((d=>"https://".concat(d,"/api/v1"))),s=await(function(d,h,f,g){let{appId:E,areaCode:S,cname:O,sid:A,token:N,uid:j}=h;sm++;const U="moderation_plugin",W={service_name:U,json_body:JSON.stringify({appId:E,areaCode:S,cname:O,command:"allocateEdge",requestId:sm,seq:sm,sid:A,appToken:N,ts:Date.now(),uid:j+""})};let $,Z,Y=d[0];return Ca((async()=>{$=Date.now();const ie=await Oa(Y,{data:W,cancelToken:f,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(Z=Date.now()-$,ie.code!==0){const Re=new le(V.UNEXPECTED_RESPONSE,"moderation plugin ap error, code"+ie.code,{retry:!0,responseTime:Z});throw w.error(Re.toString()),Re}const ue=JSON.parse(ie.json_body);if(ue.code!==200){const Re=new le(V.UNEXPECTED_RESPONSE,"moderation plugin ap error, code: ".concat(ue.code,", reason: ").concat(ue.reason),{code:ue.code,responseTime:Z});throw w.error(Re.toString()),Re}if(!ue.servers||!Array.isArray(ue.servers)||ue.servers.length===0){const Re=new le(V.UNEXPECTED_RESPONSE,"moderation plugin ap empty server",{code:ue.code,responseTime:Z});throw w.error(Re.toString()),Re}if(!ue.servers.some((Re=>!!Re.wss))){const Re=new le(V.UNEXPECTED_RESPONSE,"moderation plugin ap empty port",{code:ue.code,responseTime:Z});throw w.error(Re.toString()),Re}const ge=B("IMAGE_MODERATION_WORKER_HOST");return{addressList:ue.servers.map((Re=>{let{address:St,wss:Ct}=Re;if(St&&Ct)return"wss://".concat(St.replace(/\./g,"-"),".").concat(ge,":").concat(Ct,"/moderation")})).filter((Re=>!!Re)),workerToken:ue.workerToken,vid:ue.vid,ticket:ue.appTicket,responseTime:Z}}),((ie,ue)=>(We.apworkerEvent(A,{success:!0,sc:200,serviceName:U,responseDetail:JSON.stringify(ie.addressList),firstSuccess:ue===0,responseTime:Z,serverIp:d[ue%d.length]}),!1)),((ie,ue)=>(We.apworkerEvent(A,{success:!1,sc:ie.data&&ie.data.code||200,serviceName:U,responseTime:Z,serverIp:d[ue%d.length]}),!!(ie.code!==V.OPERATION_ABORTED&&ie.code!==V.UNEXPECTED_RESPONSE||ie.data&&ie.data.retry)&&(Y=d[(ue+1)%d.length],!0))),g)})(i,t,n,r);this.emit(Na.STATE_CHANGE,$f.AP_CONNECTED);const{addressList:o,ticket:c}=s;return this._ticket=c,o}async connectWorker(t){this.emit(Na.STATE_CHANGE,$f.CONNECT_WORKER),await this._workerConnection.init(t,1e4)}handleWorkerEvents(){this._workerConnection.on(Et.CONNECTED,(async()=>{this.emit(Na.STATE_CHANGE,$f.WORKER_CONNECTED,this._workerConnection.url),this.connectionState=ao.CONNECTED})),this._workerConnection.on(Et.CLOSED,(()=>{this.connectionState=ao.CLOSED})),this._workerConnection.on(Et.FAILED,(()=>{this.connectionState=ao.CLOSED})),this._workerConnection.on(Et.RECONNECTING,(()=>{this.connectionState=this.connectionState===ao.CONNECTED?ao.RECONNECTING:ao.CONNECTING})),this._workerConnection.on(Et.ON_MESSAGE,(async t=>{if(t.data instanceof ArrayBuffer){const n=B7(new Uint8Array(t.data));B("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&w.debug("[".concat(this._moderationId,"] Response message for worker of image moderation "),JSON.stringify(n)),this._uploadNum++,n.code===void 0||n.code===0||(this._uploadFailedNum++,w.error("[".concat(this._moderationId,"] Error response from worke, code is ").concat(n.code,", msg is ").concat(n.msg)),this._uploadTimer||(this._uploadTimer=window.setTimeout((()=>{We.reportApiInvoke(this._connectInfo.sid||null,{name:Gn.IMAGE_MODERATION_UPLOAD,options:[this._uploadFailedNum,this._uploadNum,n.code],tag:Nn.TRACER}).onError(new le(V.IMAGE_MODERATION_UPLOAD_FAILED,n.msg)),this._uploadTimer=null}),B("IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL"))))}else w.error("[".concat(this._moderationId,"] Unexpected message type from worker"))})),this._workerConnection.on(Et.WILL_RECONNECT,((t,n,r)=>{t==="recover"&&r(t),r("tryNext")})),this._workerConnection.on(Et.REQUEST_NEW_URLS,((t,n)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(t).catch(n)}))}static intToLong(t){return{low:t|=0,high:t>>31,unsigned:t>=0}}async requestToInspectImage(){const t=As(this,Na.CLIENT_LOCAL_VIDEO_TRACK),n={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(t){if(!t.isPlaying)return void(B("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&w.debug("Only the track being played can be inspected"));this._sequence++;const r=await this.generateRequestData(t,n);this._workerConnection.sendMessage(r,!0,!0)}else B("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&w.debug("Only the track being published can be inspected")}async generateRequestData(t,n){let{appId:r,cname:i,cid:s,vid:o,sid:c,uid:d}=n;const h=Date.now(),f=await t.getCurrentFrameImage("image/jpeg",this.quality),g=await Z1(f,r,i),E=this._sequence+"-"+s+"-"+d+"-"+h+"-"+hn(12,""),S={appId:r,cid:s,cname:i,deviceId:"",elapse:jI.intToLong(Number(h-this._moderationStartTime)),fileSize:f.buffer.byteLength,height:f.height,width:f.width,jpg:g,networkType:6,osType:7,requestId:E,sdkVersion:"4.24.0",sequence:this._sequence,sid:c,timestamp:bU(h),uid:d,vid:o,service:this._moderationMode,ticket:this._ticket,callbackData:this._extraInfo,vendorConfigs:this._vendor};this._extraInfo===void 0&&delete S.callbackData;const O=F7(S);if(O.byteLength<this._workerMessageLengthLimit){if(B("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")){const A=(function(N){for(var j=1;j<arguments.length;j++){var U=arguments[j]!=null?arguments[j]:{};j%2?IU(Object(U),!0).forEach((function(W){x(N,W,U[W])})):Object.getOwnPropertyDescriptors?Object.defineProperties(N,Object.getOwnPropertyDescriptors(U)):IU(Object(U)).forEach((function(W){Object.defineProperty(N,W,Object.getOwnPropertyDescriptor(U,W))}))}return N})({},S);delete A.jpg,w.debug("[".concat(this._moderationId,"] Request message for worker of image moderation service: "),JSON.stringify(A))}return O}{const A=this.quality*this._qualityRatio;return this.quality=A,await this.generateRequestData(t,{appId:r,cname:i,cid:s,vid:o,sid:c,uid:d})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=ji.CancelToken.source(),this._workerConnection&&this._workerConnection.close(),this._moderationTimer&&window.clearInterval(this._moderationTimer),this._moderationTimer=null,this._uploadTimer&&window.clearTimeout(this._uploadTimer),this._uploadTimer=null,this.connectionState=ao.CLOSED,this.emit(Na.STATE_CHANGE,$f.CLOSED)}}function AU(e){if(cn(e.interval,"interval",1e3,1/0),e&&e.extraInfo&&e.extraInfo.length>1024)throw new le(V.INVALID_PARAMS,"config.extraInfo length cannot exceed 1024 bytes");if(e&&e.vendor&&e.vendor.length>1024)throw new le(V.INVALID_PARAMS,"config.vendor length cannot exceed 1024 bytes")}const X7={name:"ImageModeration",create:function(e){let{config:t}=e;return AU(t),new jI(t)}};var NU,OU,PU,DU,kU,xU,LU,MU,UU,jU,VU,FU,BU,WU,GU,HU,KU,zU,YU,qU,XU,JU,QU,ZU,$U,ej,tj,nj,rj,ij,sj,oj,aj,cj,lj,dj,uj,hj,pj,fj,mj,xe;function _j(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable}))),n.push.apply(n,r)}return n}function qo(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?_j(Object(n),!0).forEach((function(r){x(e,r,n[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):_j(Object(n)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))}))}return e}Jr.setLogger(w);let J7=(NU=et(),OU=et({argsMap:(e,t)=>{if(!Array.isArray(t)){if(!(t instanceof Kf))return[t];t=[t]}return t.map((n=>n?Object(n).toString():"null"))}}),PU=et({argsMap:(e,t)=>(t||(t=[]),Array.isArray(t)||t.trackMediaType!==Hf.DATA?(Array.isArray(t)||(t=[t]),t.map((n=>n.getTrackId()))):[t.getChannelId()])}),DU=et({argsMap:(e,t,n,r)=>[typeof t=="object"?t.uid:t,n,r]}),kU=et({argsMap:(e,t,n)=>[t,n]}),xU=et({argsMap:(e,t)=>t.map((n=>{let{user:r,mediaType:i}=n;return[r?.uid,i]}))}),LU=et({argsMap:(e,t,n,r)=>[typeof t=="object"?t.uid:t,n,r]}),MU=et({argsMap:(e,t)=>t.map((n=>{let{user:r,mediaType:i}=n;return{uid:r?.uid,mediaType:i}}))}),UU=et(),jU=et(),VU=et(),FU=et(),BU=et(),WU=et(),GU=et(),HU=et(),KU=et(),zU=et(),YU=et(),qU=et(),XU=et(),JU=et(),QU=et(),ZU=et({argsMap:(e,t)=>[t]}),$U=et(),ej=et(),tj=et(),nj=et(),rj=et(),ij=et(),sj=et(),oj=et(),aj=et({argsMap:(e,t)=>(Array.isArray(t)||(t=[t]),[JSON.stringify(t)])}),cj=et(),lj=et(),dj=et(),uj=et(),hj=et(),pj=et(),fj=et({reportResult:!0}),mj=et(),xe=class extends xn{get connectionState(){return this._gateway.state}get remoteUsers(){return this._users}get localTracks(){return this._p2pChannel.getAllTracks(!0)}get uid(){return this._uid}get channelName(){return this._channelName}get localDataChannels(){return this._p2pChannel.getAllDataChannels()}get mode(){return this._config.mode}get role(){var e;return((e=this._config)===null||e===void 0?void 0:e.role)||"audience"}get codec(){return this._config.codec}get audioCodec(){return this._config.audioCodec||"opus"}get isStringUID(){return!!this._joinInfo&&!!this._joinInfo.stringUid}get __className__(){return"Client"}constructor(e,t){let n;if(super(),x(this,"store",void 0),x(this,"_uid",void 0),x(this,"_channelName",void 0),x(this,"_uintUid",void 0),x(this,"_users",[]),x(this,"_config",void 0),x(this,"_clientId",void 0),x(this,"_appId",void 0),x(this,"_sessionId",null),x(this,"_key",void 0),x(this,"_rtmConfig",{}),x(this,"_joinInfo",void 0),x(this,"_gateway",void 0),x(this,"_statsCollector",void 0),x(this,"_configDistribute",void 0),x(this,"_leaveMutex",void 0),x(this,"_publishMutex",void 0),x(this,"_renewTokenMutex",void 0),x(this,"_subscribeMutex",void 0),x(this,"_encryptionMode","none"),x(this,"_encryptionSecret",null),x(this,"_encryptionSalt",null),x(this,"_encryptDataStream",!1),x(this,"_encryptDataStreamKey",null),x(this,"_encryptDataStreamIv",null),x(this,"_proxyServer",void 0),x(this,"_turnServer",{servers:[],mode:"auto"}),x(this,"_cloudProxyServerMode","disabled"),x(this,"_isDualStreamEnabled",!1),x(this,"_defaultStreamFallbackType",void 0),x(this,"_lowStreamParameter",void 0),x(this,"_streamFallbackTypeCacheMap",new Map),x(this,"_remoteStreamTypeCacheMap",new Map),x(this,"_axiosCancelSource",ji.CancelToken.source()),x(this,"_audioVolumeIndicationInterval",void 0),x(this,"_networkQualityInterval",void 0),x(this,"_userOfflineTimeout",void 0),x(this,"_streamRemovedTimeout",void 0),x(this,"_liveTranscodeStreamingClient",void 0),x(this,"_liveRawStreamingClient",void 0),x(this,"_channelMediaRelayClient",void 0),x(this,"_networkQualitySensitivity","normal"),x(this,"_p2pChannel",void 0),x(this,"_useLocalAccessPoint",!1),x(this,"_setLocalAPVersion",void 0),x(this,"_joinAndNotLeaveYet",!1),x(this,"_numberOfJoinCount",0),x(this,"_joinResponse",null),x(this,"_remoteDefaultVideoStreamType",void 0),x(this,"_inspect",void 0),x(this,"_moderation",void 0),x(this,"_license",void 0),x(this,"_pendingPublishedUsers",[]),x(this,"ntpAlignErrorCount",0),x(this,"remoteInboundOffset",0),x(this,"_peerConnectionState",void 0),x(this,"_handleLocalTrackEnable",((i,s,o)=>{this.publish(i,!1).then(s).catch(o)})),x(this,"_handleLocalTrackDisable",((i,s,o)=>{this.unpublish(i).then(s).catch(o)})),x(this,"_handleUserOnline",(i=>{if(B("BLOCK_LOCAL_CLIENT")&&Ph(i.uid,this.channelName))return void w.debug("[".concat(i.uid,"] will be ignored in local"));this.isStringUID&&typeof i.uid!="string"&&w.error("[".concat(this._clientId,"] StringUID is Mixed with UintUID"));const s=this._users.find((o=>o.uid===i.uid));if(s)s._trust_in_room_=!0,s._is_pre_created&&(s._is_pre_created=!1,this.safeEmit(Ot.USER_JOINED,s));else{const o=new Vd(i.uid,i.uint_id||i.uid);this._users.push(o),w.debug("[".concat(this._clientId,"] user online"),i.uid),this.store.firstVideoFrameDecoded(o.uid,{userJoinNotify:Date.now()}),this.safeEmit(Ot.USER_JOINED,o)}})),x(this,"_handleUserOffline",(i=>{if(B("BLOCK_LOCAL_CLIENT")&&Ph(i.uid,this.channelName))return;const s=this._users.find((o=>o.uid===i.uid));s&&(this._handleRemoveStream(i),this._handleRemoveDataChannels(i),s._audio_pre_subscribed||s._video_pre_subscribed?s._is_pre_created=!0:GS(this._users,s),this._remoteStreamTypeCacheMap.delete(s.uid),this._streamFallbackTypeCacheMap.delete(s.uid),w.debug("[".concat(this._clientId,"] user offline"),i.uid,"reason:",i.reason),this.safeEmit(Ot.USER_LEAVED,s,i.reason))})),x(this,"_handleAddAudioOrVideoStream",((i,s,o,c,d,h,f,g)=>{if(B("BLOCK_LOCAL_CLIENT")&&Ph(s,this.channelName))return;const E=this._users.find((O=>O.uid===s));if(!E)return void w.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));w.debug("[".concat(this._clientId,"] stream added with uid ").concat(s,", type ").concat(i)),this.store.subscribe(E.uid,i,void 0,void 0,void 0,Date.now()),i==="video"&&this.store.firstVideoFrameDecoded(E.uid,{videoAddNotify:Date.now()});const S=i==="audio"?E.hasAudio:E.hasVideo;if(E._uintid||(E._uintid=h||s),i==="audio"?E._trust_audio_stream_added_state_=!0:E._trust_video_stream_added_state_=!0,i==="audio"?(E._audio_added_=!0,o!==void 0&&(E._audioSSRC=o),c!==void 0&&(E._cname=c),f&&(E._audioOrtc=f)):(E._video_added_=!0,o!==void 0&&(E._videoSSRC=o),c!==void 0&&(E._cname=c),g!==void 0&&(E._rtxSsrcId=g),f&&(E._videoOrtc=f)),(i==="audio"?E.hasAudio:E.hasVideo)&&!S&&(w.info("[".concat(this._clientId,"] remote user ").concat(E.uid," published ").concat(i)),this.safeEmit(Ot.USER_PUBLISHED,E,i)),i==="video"?We.onGatewayStream(this._sessionId,fr.ON_ADD_VIDEO_STREAM,In.ON_ADD_VIDEO_STREAM,{peer:h||s,ssrc:E._videoSSRC}):We.onGatewayStream(this._sessionId,fr.ON_ADD_AUDIO_STREAM,In.ON_ADD_AUDIO_STREAM,{peer:h||s,ssrc:E._audioSSRC}),this._p2pChannel.remoteMediaSsrcChanged(E,i,o).then((O=>{if(O&&(w.debug("[".concat(this._clientId,"] resubscribe ").concat(i," for user ").concat(E.uid," after rejoin because SSRC id changed.")),this._p2pChannel instanceof gE))return this._p2pChannel.unsubscribe(E,i,!0).then((()=>this._subscribe(E,i,!0).catch((A=>{w.error("[".concat(this._clientId,"] resubscribe error"),A.toString())}))))})),this._p2pChannel.hasPendingRemoteMedia(E,i)&&(w.debug("[".concat(this._clientId,"] resubscribe ").concat(i," for user ").concat(E.uid," after reconnect.")),this._subscribe(E,i,!0).catch((O=>{w.error("[".concat(this._clientId,"] resubscribe error"),O.toString())}))),i==="video"&&!Br()&&!ii()){const O=this._getEncodingName(d);O?.toLocaleLowerCase()==eE.av1&&S7().then((A=>{A||this._gateway.downgradeCodec(O)}))}})),x(this,"_handleRemoveStream",(i=>{if(B("BLOCK_LOCAL_CLIENT")&&Ph(i.uid,this.channelName))return;const s=this._users.find((c=>c.uid===i.uid));if(!s)return void w.warning("[".concat(this._clientId,"] can not find target user!(on_remove_stream)"));w.debug("[".concat(this._clientId,"] stream removed with uid ").concat(i.uid));let o=()=>{};s.hasAudio&&s.hasVideo?o=()=>{w.info("[".concat(this._clientId,"] remote user ").concat(s.uid," unpublished audio track")),this.safeEmit(Ot.USER_UNPUBLISHED,s,"audio"),w.info("[".concat(this._clientId,"] remote user ").concat(s.uid," unpublished video track")),this.safeEmit(Ot.USER_UNPUBLISHED,s,"video")}:s.hasVideo?o=()=>{w.info("[".concat(this._clientId,"] remote user ").concat(s.uid," unpublished video track")),this.safeEmit(Ot.USER_UNPUBLISHED,s,"video")}:s.hasAudio&&(o=()=>{w.info("[".concat(this._clientId,"] remote user ").concat(s.uid," unpublished audio track")),this.safeEmit(Ot.USER_UNPUBLISHED,s,"audio")}),s._video_pre_subscribed||s._audio_pre_subscribed||(s._trust_audio_stream_added_state_=!0,s._trust_video_stream_added_state_=!0,s._audio_added_=!1,s._video_added_=!1,this._p2pChannel instanceof gE&&this._p2pChannel.unsubscribe(s).then((c=>{if(c)return this._gateway.unsubscribe(c,s.uid)})),s._audioSSRC=void 0,s._videoSSRC=void 0,s._audioOrtc=void 0,s._videoOrtc=void 0,s._rtxSsrcId=void 0),We.onGatewayStream(this._sessionId,fr.ON_REMOVE_STREAM,In.ON_REMOVE_STREAM,{peer:i.uint_id||i.uid}),o()})),x(this,"_handleSetStreamLocalEnable",((i,s,o)=>{if(B("BLOCK_LOCAL_CLIENT")&&Ph(s,this.channelName))return;const c=this._users.find((f=>f.uid===s));if(!c)return void w.error("[".concat(this._clientId,"] can not find target user!(disable_local)"));w.debug("[".concat(this._clientId,"] local ").concat(i," ").concat(o?"enabled":"disabled"," with uid ").concat(s));const d=i==="audio"?c.hasAudio:c.hasVideo;if(i==="audio"){c._trust_audio_enabled_state_=!0;const f=c._audio_enabled_;if(c._audio_enabled_=o,c._audio_enabled_===f)return;{const g=c._audio_enabled_?"enable-local-audio":"disable-local-audio";w.debug("[".concat(this._clientId,"] user-info-updated, uid: ").concat(s,", msg: ").concat(g)),this.safeEmit(Ot.USER_INFO_UPDATED,s,g)}}else{c._trust_video_enabled_state_=!0;const f=c._video_enabled_;if(c._video_enabled_=o,c._video_enabled_===f)return;{const g=c._video_enabled_?"enable-local-video":"disable-local-video";w.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(s,", msg: ").concat(g)),this.safeEmit(Ot.USER_INFO_UPDATED,s,g)}}const h=i==="audio"?c.hasAudio:c.hasVideo;return d!==h?!d&&h?(w.info("[".concat(this._clientId,"] remote user ").concat(s," published ").concat(i)),void this.safeEmit(Ot.USER_PUBLISHED,c,i)):(i==="video"&&c._videoTrack&&c._videoTrack._destroy(),i==="audio"&&c._audioTrack,this._p2pChannel.muteRemote(c,i),w.info("[".concat(this._clientId,"] remote user ").concat(s," unpublished ").concat(i)),void this.safeEmit(Ot.USER_UNPUBLISHED,c,i)):void 0})),x(this,"_handleMuteStream",((i,s,o)=>{if(B("BLOCK_LOCAL_CLIENT")&&Ph(i,this.channelName))return;w.debug("[".concat(this._clientId,"] receive mute message"),i,s,o);const c=this._users.find((f=>f.uid===i));if(!c)return void w.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(i));const d=s==="audio"?c.hasAudio:c.hasVideo;if(s==="audio"){c._trust_audio_mute_state_=!0;const f=c._audio_muted_;if(c._audio_muted_=o,c._audio_muted_===f)return;{const g=c._audio_muted_?"mute-audio":"unmute-audio";w.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(i,", msg: ").concat(g)),this.safeEmit(Ot.USER_INFO_UPDATED,i,g)}}else{c._trust_video_mute_state_=!0;const f=c._video_muted_;if(c._video_muted_=o,c._video_muted_===f)return;{const g=c._video_muted_?"mute-video":"unmute-video";w.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(i,", msg: ").concat(g)),this.safeEmit(Ot.USER_INFO_UPDATED,i,g)}}const h=s==="audio"?c.hasAudio:c.hasVideo;if(d!==h){if(!d&&h)return(s==="audio"?c._audioSSRC:c._videoSSRC)?(w.info("[".concat(this._clientId,"] remote user ").concat(i," published ").concat(s)),void this.safeEmit(Ot.USER_PUBLISHED,c,s)):void w.warning("[".concat(this._clientId,"] remote user ").concat(i," receive ").concat(s," unmute message  before add stream message, ").concat(s," SSRC doesn't exist yet."));s==="video"&&c._videoTrack&&!c._video_pre_subscribed&&c._videoTrack._destroy(),s==="audio"&&c._audioTrack,this._p2pChannel.muteRemote(c,s),w.info("[".concat(this._clientId,"] remote user ").concat(i," unpublished ").concat(s)),this.safeEmit(Ot.USER_UNPUBLISHED,c,s)}})),x(this,"_handleP2PLost",(async i=>{w.debug("[".concat(this._clientId,"] receive p2p lost"),i),parseInt(i.p2pid,10)===this.store.p2pId?await this._p2pChannel.requestReconnect():w.warning("[".concat(this._clientId,"] P2PLost stream not found"),i)})),x(this,"_handleTokenWillExpire",(()=>{w.debug("[".concat(this._clientId,"] received message onTokenPrivilegeWillExpire")),this.safeEmit(Ot.ON_TOKEN_PRIVILEGE_WILL_EXPIRE)})),x(this,"_handleBeforeUnload",(i=>{i.type==="beforeunload"&&i.returnValue!==void 0&&i.returnValue!==""||(this.leave(),w.info("[".concat(this._clientId,"] auto leave onbeforeunload or pagehide")))})),x(this,"_handleUpdateNetworkQuality",(()=>{if(this._networkQualitySensitivity==="normal")return;if(navigator&&navigator.onLine!==void 0&&!navigator.onLine)return void this.safeEmit(Ot.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6});const i={downlinkNetworkQuality:0,uplinkNetworkQuality:0};i.uplinkNetworkQuality=this._p2pChannel.getUplinkNetworkQuality(),i.downlinkNetworkQuality=this._p2pChannel.getDownlinkNetworkQuality(),this.safeEmit(Ot.NETWORK_QUALITY,i)})),x(this,"_handleP2PAddAudioOrVideoStream",((i,s,o,c)=>{const d=this._users.find((f=>f.uid===s));if(!d)return void w.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));w.debug("[".concat(this._clientId,"] stream added with uid ").concat(s,", type ").concat(i)),this.store.subscribe(d.uid,i,void 0,void 0,void 0,Date.now());const h=i==="audio"?d.hasAudio:d.hasVideo;i==="audio"?d._trust_audio_stream_added_state_=!0:d._trust_video_stream_added_state_=!0,i==="audio"?(d._audio_added_=!0,o!==void 0&&(d._audioSSRC=o),c!==void 0&&(d._audioMid=c)):(d._video_added_=!0,o!==void 0&&(d._videoSSRC=o),c!==void 0&&(d._videoMid=c)),(i==="audio"?d.hasAudio:d.hasVideo)&&!h&&(w.info("[".concat(this._clientId,"] remote user ").concat(d.uid," published ").concat(i)),this.safeEmit(Ot.USER_PUBLISHED,d,i)),this._p2pChannel.hasPendingRemoteMedia(d,i)&&(w.debug("[".concat(this._clientId,"] resubscribe ").concat(i," for user ").concat(d.uid," after reconnect.")),this._subscribe(d,i,!0).catch((f=>{w.error("[".concat(this._clientId,"] resubscribe error"),f.toString())})))})),this._config=e,this._clientId=t||hn(5,"client-"),this.store=new class{constructor(i,s,o,c){lt(this,"state",void 0),this.state={codec:i,audioCodec:s,mode:o,clientId:c,sessionId:null,p2pId:0,dcId:0,pubId:0,subId:0,keyMetrics:{publish:[],subscribe:[],firstVideoFrameDecoded:[]},joinChannelServiceRecords:[],cloudProxyServerMode:"disabled",useP2P:!1,p2pTransport:wh.Default,hasStartJoinChannel:!1,isABTestSuccess:!1,autoSubscribe:!1,enableInstantMuteRestore:!1}}dispatch(i){this.state=(function(s,o){switch(o.type){case dt.SET_SESSION_ID:return we(we({},s),{},{sessionId:o.sessionId});case dt.SET_P2P_ID:return we(we({},s),{},{p2pId:o.p2pId});case dt.SET_UID:return we(we({},s),{},{uid:o.uid});case dt.SET_INT_UID:return we(we({},s),{},{intUid:o.intUid});case dt.SET_PUB_ID:return we(we({},s),{},{pubId:o.pubId});case dt.KEY_METRIC_CLIENT_CREATED:return we(we({},s),{},{keyMetrics:we(we({},s.keyMetrics),{},{clientCreated:o.metric})});case dt.KEY_METRIC_JOIN_START:return we(we({},s),{},{keyMetrics:we(we({},s.keyMetrics),{},{joinStart:o.metric})});case dt.KEY_METRIC_PRELOAD_START:return we(we({},s),{},{keyMetrics:we(we({},s.keyMetrics),{},{preloadStart:o.metric})});case dt.KEY_METRIC_PRELOAD_END:return we(we({},s),{},{keyMetrics:we(we({},s.keyMetrics),{},{preloadEnd:o.metric})});case dt.KEY_METRIC_JOIN_END:return we(we({},s),{},{keyMetrics:we(we({},s.keyMetrics),{},{joinEnd:o.metric})});case dt.KEY_METRIC_REQUEST_AP_START:return we(we({},s),{},{keyMetrics:we(we({},s.keyMetrics),{},{requestAPStart:o.metric})});case dt.KEY_METRIC_REQUEST_AP_END:return we(we({},s),{},{keyMetrics:we(we({},s.keyMetrics),{},{requestAPEnd:o.metric})});case dt.KEY_METRIC_REQUEST_SUA_END:return we(we({},s),{},{keyMetrics:we(we({},s.keyMetrics),{},{requestSUAEnd:o.metric})});case dt.KEY_METRIC_BEFORE_CONNECT:return we(we({},s),{},{keyMetrics:we(we({},s.keyMetrics),{},{beforeConnect:o.metric})});case dt.KEY_METRIC_PEER_RECEIVER:return we(we({},s),{},{keyMetrics:we(we({},s.keyMetrics),{},{peerReceiver:o.metric})});case dt.KEY_METRIC_SIGNAL_CONNECTED:return we(we({},s),{},{keyMetrics:we(we({},s.keyMetrics),{},{signalConnected:o.metric})});case dt.KEY_METRIC_JOIN_REQ:return we(we({},s),{},{keyMetrics:we(we({},s.keyMetrics),{},{joinReq:o.metric})});case dt.KEY_METRIC_JOIN_REP:return we(we({},s),{},{keyMetrics:we(we({},s.keyMetrics),{},{joinRep:o.metric})});case dt.KEY_METRIC_JOIN_GATEWAY_START:return we(we({},s),{},{keyMetrics:we(we({},s.keyMetrics),{},{joinGatewayStart:o.metric})});case dt.KEY_METRIC_JOIN_GATEWAY_END:return we(we({},s),{},{keyMetrics:we(we({},s.keyMetrics),{},{joinGatewayEnd:o.metric})});case dt.KEY_METRIC_PEER_CONNECTION_START:return we(we({},s),{},{keyMetrics:we(we({},s.keyMetrics),{},{peerConnectionStart:o.metric})});case dt.KEY_METRIC_PEER_CONNECTION_END:return we(we({},s),{},{keyMetrics:we(we({},s.keyMetrics),{},{peerConnectionEnd:o.metric})});case dt.KEY_METRIC_DESCRIPTION_START:return we(we({},s),{},{keyMetrics:we(we({},s.keyMetrics),{},{descriptionStart:o.metric})});case dt.KEY_METRIC_SIGNAL_CHANNEL_OPEN:return we(we({},s),{},{keyMetrics:we(we({},s.keyMetrics),{},{signalChannelOpen:o.metric})});case dt.KEY_METRIC_ICE_CONNECTION_END:return we(we({},s),{},{keyMetrics:we(we({},s.keyMetrics),{},{iceConnectionEnd:o.metric})});case dt.KEY_METRIC_PUBLISH:{const c=s.keyMetrics.publish,d=c.findIndex((h=>h.trackId===o.metric.trackId));return d!==-1?(c[d]=we(we({},c[d]),o.metric),we(we({},s),{},{keyMetrics:we(we({},s.keyMetrics),{},{publish:[...c]})})):we(we({},s),{},{keyMetrics:we(we({},s.keyMetrics),{},{publish:[...s.keyMetrics.publish,o.metric]})})}case dt.KEY_METRIC_SUBSCRIBE:{const c=s.keyMetrics.subscribe,d=c.findIndex((h=>h.userId===o.metric.userId&&h.type===o.metric.type));return d!==-1?(c[d]=we(we({},c[d]),o.metric),we(we({},s),{},{keyMetrics:we(we({},s.keyMetrics),{},{subscribe:[...c]})})):we(we({},s),{},{keyMetrics:we(we({},s.keyMetrics),{},{subscribe:[...s.keyMetrics.subscribe,o.metric]})})}case dt.KEY_METRIC_FIRST_VIDEO_FRAME_DECODED:{const c=s.keyMetrics.firstVideoFrameDecoded,d=c.findIndex((h=>h.userId===o.metric.userId));return d!==-1?(c[d]=we(we({},c[d]),o.metric),we(we({},s),{},{keyMetrics:we(we({},s.keyMetrics),{},{firstVideoFrameDecoded:[...c]})})):we(we({},s),{},{keyMetrics:we(we({},s.keyMetrics),{},{firstVideoFrameDecoded:[...s.keyMetrics.firstVideoFrameDecoded,o.metric]})})}case dt.RESET_FIRST_VIDEO_FRAME_DECODED:return s.keyMetrics.firstVideoFrameDecoded=[],s;case dt.SET_CLOUD_PROXY_SERVER_MODE:return s.cloudProxyServerMode=o.mode,s;case dt.RECORD_JOIN_CHANNEL_SERVICE:return typeof o.index!="number"?s.joinChannelServiceRecords=[...s.joinChannelServiceRecords,o.record]:(s.joinChannelServiceRecords[o.index]=we(we({},s.joinChannelServiceRecords[o.index]),o.record),s.joinChannelServiceRecords=[...s.joinChannelServiceRecords]),s;case dt.RESET_JOIN_CHANNEL_SERVICE_RECORDS:return s.joinChannelServiceRecords=[],s;case dt.RESET_KEY_METRICS:return s.keyMetrics={publish:[],subscribe:[],firstVideoFrameDecoded:[]},s;case dt.SET_USE_P2P:return we(we({},s),{},{useP2P:o.val});case dt.SET_TRANSPORT_TYPE:return we(we({},s),{},{p2pTransport:o.val});default:return s}})(this.state,i)}set autoSubscribe(i){this.state.autoSubscribe=i}get autoSubscribe(){return this.state.autoSubscribe}set enableInstantMuteRestore(i){this.state.enableInstantMuteRestore=i}get enableInstantMuteRestore(){return this.state.enableInstantMuteRestore}set sessionId(i){this.dispatch({type:dt.SET_SESSION_ID,sessionId:i})}get sessionId(){return this.state.sessionId}set cid(i){this.state.cid=i}get cid(){return this.state.cid}set codec(i){this.state.codec=i}get codec(){return this.state.codec}get mode(){return this.state.mode}get audioCodec(){return this.state.audioCodec}get clientId(){return this.state.clientId}set p2pId(i){this.dispatch({type:dt.SET_P2P_ID,p2pId:i})}get p2pId(){return this.state.p2pId}set dcId(i){this.dispatch({type:dt.SET_DC_ID,dcId:i})}get dcId(){return this.state.dcId}set uid(i){this.dispatch({type:dt.SET_UID,uid:i})}get uid(){return this.state.uid}set intUid(i){this.dispatch({type:dt.SET_INT_UID,intUid:i})}get intUid(){return this.state.intUid}set pubId(i){this.dispatch({type:dt.SET_PUB_ID,pubId:i})}get pubId(){return this.state.pubId}set cloudProxyServerMode(i){this.dispatch({type:dt.SET_CLOUD_PROXY_SERVER_MODE,mode:i})}get cloudProxyServerMode(){return this.state.cloudProxyServerMode}set useP2P(i){this.dispatch({type:dt.SET_USE_P2P,val:i})}get useP2P(){return this.state.useP2P}set p2pTransport(i){this.dispatch({type:dt.SET_TRANSPORT_TYPE,val:i})}get p2pTransport(){return this.state.p2pTransport}set hasStartJoinChannel(i){this.state.hasStartJoinChannel=i}get hasStartJoinChannel(){return this.state.hasStartJoinChannel}set isABTestSuccess(i){this.state.isABTestSuccess=i}get isABTestSuccess(){return this.state.isABTestSuccess}clientCreated(){this.dispatch({type:dt.KEY_METRIC_CLIENT_CREATED,metric:Date.now()})}joinStart(){this.dispatch({type:dt.KEY_METRIC_JOIN_START,metric:Date.now()})}preloadStart(){this.dispatch({type:dt.KEY_METRIC_PRELOAD_START,metric:Date.now()})}preloadEnd(){this.dispatch({type:dt.KEY_METRIC_PRELOAD_END,metric:Date.now()})}joinEnd(){this.dispatch({type:dt.KEY_METRIC_JOIN_END,metric:Date.now()})}requestAPStart(){this.dispatch({type:dt.KEY_METRIC_REQUEST_AP_START,metric:Date.now()})}requestAPEnd(){this.dispatch({type:dt.KEY_METRIC_REQUEST_AP_END,metric:Date.now()})}requestSUAEnd(){this.dispatch({type:dt.KEY_METRIC_REQUEST_SUA_END,metric:Date.now()})}beforeConnect(){this.dispatch({type:dt.KEY_METRIC_BEFORE_CONNECT,metric:Date.now()})}peerReceiver(){this.dispatch({type:dt.KEY_METRIC_PEER_RECEIVER,metric:Date.now()})}signalConnected(){this.dispatch({type:dt.KEY_METRIC_SIGNAL_CONNECTED,metric:Date.now()})}joinReq(){this.dispatch({type:dt.KEY_METRIC_JOIN_REQ,metric:Date.now()})}joinRep(){this.dispatch({type:dt.KEY_METRIC_JOIN_REP,metric:Date.now()})}joinGatewayStart(){this.dispatch({type:dt.KEY_METRIC_JOIN_GATEWAY_START,metric:Date.now()})}joinGatewayEnd(){this.dispatch({type:dt.KEY_METRIC_JOIN_GATEWAY_END,metric:Date.now()})}peerConnectionStart(){this.dispatch({type:dt.KEY_METRIC_PEER_CONNECTION_START,metric:Date.now()})}peerConnectionEnd(){this.dispatch({type:dt.KEY_METRIC_PEER_CONNECTION_END,metric:Date.now()})}firstVideoFrameDecoded(i,s){this.dispatch({type:dt.KEY_METRIC_FIRST_VIDEO_FRAME_DECODED,metric:we({userId:i},s)})}descriptionStart(){this.dispatch({type:dt.KEY_METRIC_DESCRIPTION_START,metric:Date.now()})}signalChannelOpen(){this.dispatch({type:dt.KEY_METRIC_SIGNAL_CHANNEL_OPEN,metric:Date.now()})}iceConnectionEnd(){this.dispatch({type:dt.KEY_METRIC_ICE_CONNECTION_END,metric:Date.now()})}publish(i,s,o,c){this.dispatch({type:dt.KEY_METRIC_PUBLISH,metric:we(we({trackId:i,type:s},o&&{publishStart:o}),c&&{publishEnd:c})})}subscribe(i,s,o,c,d,h,f){this.dispatch({type:dt.KEY_METRIC_SUBSCRIBE,metric:we(we(we(we(we({userId:i,type:s},o&&{subscribeStart:o}),c&&{subscribeEnd:c}),d&&{firstFrame:d}),h&&{streamAdded:h}),f&&{firstDecoded:f})})}massSubscribe(i,s,o,c){i.forEach((d=>{this.dispatch({type:dt.KEY_METRIC_SUBSCRIBE,metric:we(we(we({userId:d.userId,type:d.type},s&&{subscribeStart:s}),o&&{subscribeEnd:o}),c&&{firstFrame:c})})}))}get keyMetrics(){return this.state.keyMetrics}recordJoinChannelService(i,s){i.service==="gateway"&&Array.isArray(i.urls)&&(i.urls=i.urls.map((o=>o.replace(/(\d+)-\d+-\d+-(\d+)/,"$1-*-*-$2"))));try{return typeof s!="number"?(this.dispatch({type:dt.RECORD_JOIN_CHANNEL_SERVICE,record:we(we({},i),{},{sessionId:this.sessionId,cloudProxyMode:this.cloudProxyServerMode,uid:this.uid})}),this.state.joinChannelServiceRecords.length-1):(s<0||s>=this.state.joinChannelServiceRecords.length||this.dispatch({type:dt.RECORD_JOIN_CHANNEL_SERVICE,record:i,index:s}),s)}catch{return 0}}resetJoinChannelServiceRecords(){this.dispatch({type:dt.RESET_JOIN_CHANNEL_SERVICE_RECORDS})}resetKeyMetrics(){this.dispatch({type:dt.RESET_KEY_METRICS})}resetFirstVideoFrameDecoded(){this.dispatch({type:dt.RESET_FIRST_VIDEO_FRAME_DECODED})}get joinChannelServiceRecords(){try{return this.state.joinChannelServiceRecords}catch{return[]}}}(e.codec,e.audioCodec,e.mode,this._clientId),this._leaveMutex=new Jr("client-leave",this._clientId),this._publishMutex=new Jr("client-publish",this._clientId),this._renewTokenMutex=new Jr("client-renewtoken",this._clientId),this._subscribeMutex=new Jr("client-subscribe",this._clientId),this.store.clientCreated(),e.proxyServer&&this.setProxyServer(e.proxyServer,!0),e.turnServer&&this.setTurnServer(e.turnServer,!0),w.info("[".concat(this._clientId,"] Initializing AgoraRTC client v").concat(ro," build: ").concat(Rb,", mode: ").concat(this.mode,", codec: ").concat(this.codec)),e.clientRoleOptions)try{db(e.clientRoleOptions),n=Object.assign({},e.clientRoleOptions)}catch(i){w.warning("[".concat(this._clientId,"] ").concat(i.toString()))}var r;this._statsCollector=new mE(this.store),this._statsCollector.onStatsException=(i,s,o)=>{w.warn("[".concat(this._clientId,"] receive exception msg, code: ").concat(i,", msg: ").concat(s,", uid: ").concat(o)),i===TI.VIDEO_ENCODE_FAILED&&this.localTracks.forEach((c=>{c instanceof rT&&B("ENABLE_ENCODE_EXCEPTION")&&c.findClosestProfile()})),this.safeEmit(Ot.EXCEPTION,{code:i,msg:s,uid:o})},this._statsCollector.onUploadPublishDuration=(i,s,o,c)=>{const d=this._users.find((h=>h.uid===i));d&&(this.store.keyMetrics&&(this.store.firstVideoFrameDecoded(d._uintid,{peerPublishDuration:o,peerPubStatusMs:Date.now()}),this._p2pChannel.reportVideoFirstFrameRender(d)),We.peerPublishStatus(this._sessionId,{subscribeElapse:c,audioPublishDuration:s,videoPublishDuration:o,peer:d._uintid}))},this._statsCollector.onVideoCodecChanged=i=>{if(B("VIDEO_STANDARD_BITRATE_VERSION")&&(i==="av1"||i==="h265"||i==="h264")){const s=this.localTracks.find((o=>o instanceof Sn));s&&s._saveEncodeBitrateRatio!==1&&s.setSaveEncodeBitrateRatio(i==="h264"?B("BASELINE_MORE_H264_BITRATE_RATIO"):void 0)}},this.store.useP2P=e.mode==="p2p",this._gateway=new m7(this.store,{clientId:this._clientId,mode:this.mode,codec:this.codec,websocketRetryConfig:e.websocketRetryConfig||rr,httpRetryConfig:e.httpRetryConfig||rr,forceWaitGatewayResponse:e.forceWaitGatewayResponse===void 0||e.forceWaitGatewayResponse,statsCollector:this._statsCollector,role:e.role,clientRoleOptions:n}),this._configDistribute=new b7(this._clientId,this.store),this.store.useP2P?(this._p2pChannel=(r={store:this.store,statsCollector:this._statsCollector},wl("P2PChannel").create(r)),this._handleP2PEvents()):this._p2pChannel=new gE(this.store,this._statsCollector),this._handleP2PChannelEvents(),this._handleGatewayEvents(),this._handleGatewaySignalEvents()}async joinMeta(e,t,n,r,i){let s=!(arguments.length>5&&arguments[5]!==void 0)||arguments[5],o=arguments.length>6&&arguments[6]!==void 0&&arguments[6];sn("JOIN_GATEWAY_USE_443PORT_ONLY",s),sn("JOIN_GATEWAY_USE_DUAL_DOMAIN",o);const c=this._gateway.signal.websocket;return c instanceof aI&&(c.use443PortOnly=s,c.tryDoubleDomain=o),(async function(d,h,f){jS.get(d)||jS.set(d,[]),VS.get(d)||VS.set(d,h),Rc.get(d)||Rc.set(d,0);const g=jS.get(d),E=VS.get(d);if(!g||!E)throw new Error("concurrent: deferQueue or maxConcurrency is null");if(Rc.get(d)===E){const j=Kg();g.push(j),await j.promise}Rc.set(d,Rc.get(d)+1);for(var S=arguments.length,O=new Array(S>3?S-3:0),A=3;A<S;A++)O[A-3]=arguments[A];const N=await f(...O);return Rc.set(d,Rc.get(d)-1),Rc.get(d)===E-1&&g.length>0&&(g[0].resolve(),g.shift()),Rc.get(d)===0&&(jS.set(d,[]),VS.set(d,0),Rc.set(d,0)),N})("client.join",B("JOIN_MAX_CONCURRENCY"),this.join.bind(this),e,t,n,r,i)}async join(e,t,n,r,i){const s=++this._numberOfJoinCount;this.store.joinStart(),r&&(this.store.uid=r);const o=(zS||zS||(zS=(window.location.protocol.split(":")[0]||"").toUpperCase(),zS))==="HTTPS",c=h1()?window.isSecureContext:"Browser Not Support";(!h1()&&!o||!window.isSecureContext)&&w.warning("The website must be running in a secure context (About secure context: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts ), otherwise the media collection will be restricted by the browser");let d;We.setAppId(e);try{if(!n&&n!==null)throw new le(V.INVALID_PARAMS,"Invalid token: ".concat(n,". If you don not use token, set it to null"));if(n&&kr(n,"token",1,2047),kr(e,"appid",1,2047),fT(t),r&&mT(r),i)if(typeof i=="string")kr(i,"optionalInfo",1,256),d=i;else{if(typeof i!="object")throw new le(V.INVALID_PARAMS,"Invalid options: options is not a string or object");{const{autoSubscribe:N,enableInstantMuteRestore:j}=i;N&&(wa(N,"autoSubscribe"),w.info("[".concat(this._clientId,"] join: autoSubscribe: ").concat(N)),this.store.autoSubscribe=N),j&&(wa(j,"enableInstantMuteRestore"),w.info("[".concat(this._clientId,"] join: enableInstantMuteRestore: ").concat(j)),this.store.enableInstantMuteRestore=j)}}}catch(N){throw We.reportApiInvoke(Rh(),{name:Gn.JOIN,options:[e,t,n,r],states:{isHttps:o,isSecureContext:c},tag:Nn.TRACER}).onError(N),N}if(this._leaveMutex.isLocked&&(w.debug("[".concat(this._clientId,"] join: waiting leave operation")),(await this._leaveMutex.lock())(),w.debug("[".concat(this._clientId,"] join: continue"))),this._joinAndNotLeaveYet=!0,this.connectionState!=="DISCONNECTED"){const N=new le(V.INVALID_OPERATION,"[".concat(this._clientId,"] Client already in connecting/connected state"));throw We.reportApiInvoke(Rh(),{name:Gn.JOIN,options:[e,t,n,r],states:{isHttps:o,isSecureContext:c},tag:Nn.TRACER}).onError(N),N}this._gateway.state="CONNECTING",this.store.preloadStart();const h=await uU({appId:e,cname:t,uid:r,stringUid:typeof r=="string"?r:void 0,token:n||e,cloudProxyServer:this._cloudProxyServerMode});if(this.store.preloadEnd(),!this._joinAndNotLeaveYet)throw new le(V.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));const f=h?.sid||Rh();w.info("[".concat(this._clientId,"] start join channel ").concat(t,", join number: ").concat(s)),this._sessionId||(this._sessionId=f,this.store.sessionId=this._sessionId);const g=We.reportApiInvoke(f,{id:this._clientId,name:Gn.JOIN,options:[e,t,n,r],states:{isHttps:o,isSecureContext:c},tag:Nn.TRACER}),E=qo(qo(qo({},this._rtmConfig),{},{role:this.role,clientId:this._clientId,appId:e,sid:this._sessionId,cname:t,uid:typeof r!="string"?r:null,turnServer:this._turnServer,proxyServer:this._proxyServer,token:n||e,cloudProxyServer:this._cloudProxyServerMode,optionalInfo:d,license:this._license,useLocalAccessPoint:this._useLocalAccessPoint,preload:!!h},this._remoteDefaultVideoStreamType!==void 0&&{defaultVideoStream:this._remoteDefaultVideoStreamType}),{},{apRequestDetail:B("AP_REQUEST_DETAIL")||void 0});if(this._useLocalAccessPoint&&(E.setLocalAPVersion=this._setLocalAPVersion),typeof r=="string"&&(E.stringUid=r,this._uintUid?(E.uid=this._uintUid,this._uintUid=void 0):E.uid=0),this._encryptionMode!=="none"&&this._encryptionSecret){if(E.aesmode=this._encryptionMode,E.aespassword=await(async N=>{const j=(function(Z){const Y=window.atob(`MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDCMnXAHkKIGAM+x4N22gCI+Wyu
STM9ztkT3uYslTT2PuKmZfPzhH6kVdO7PTjGCOZnAsyb3oTtWat0KcxQ4jxvqQV+
HvYl3iI1Yd4vl2c3qRMJPLtRDfNxa2Mcxgq7e9aEUibzdd0st+OJAy3tOj/Y0aVy
xQiYDz3vqa6bP29adwIDAQAB`),ie=new Uint8Array(new ArrayBuffer(Y.length));for(let ue=0;ue<Y.length;ue+=1)ie[ue]=Y.charCodeAt(ue);return ie})(),U=await window.crypto.subtle.importKey("spki",j,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]),W=cb(N),$=await window.crypto.subtle.encrypt({name:"RSA-OAEP"},U,W);return(function(Z){let Y="";for(let ie=0;ie<Z.length;ie+=1)Y+=String.fromCharCode(Z[ie]);return window.btoa(Y)})(new Uint8Array($))})(this._encryptionSecret),!this._joinAndNotLeaveYet)throw new le(V.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));this._encryptionSalt&&(E.aessalt=this._encryptionSalt)}if(this._encryptDataStream&&(this._encryptionMode==="aes-128-gcm2"||this._encryptionMode==="aes-256-gcm2"))if(this._encryptionSalt&&this._encryptionSecret)if(window.crypto.subtle){const N=new TextEncoder,j=B("USE_PURE_ENCRYPTION_MASTER_KEY")?N.encode(E.appId+this._encryptionSecret+this._encryptionSecret):N.encode(E.appId+E.cname+this._encryptionSecret);this._encryptDataStreamIv=await(async function(U,W,$){const Z=await window.crypto.subtle.importKey("raw",W,"PBKDF2",!1,["deriveBits","deriveKey"]),Y=U==="aes-128-gcm2"?128:256,ie=await window.crypto.subtle.deriveBits({name:"PBKDF2",iterations:T1,hash:"SHA-256",salt:$},Z,Y+KY);return new Uint8Array(ie).subarray(Y/8)})(this._encryptionMode,j,Th(this._encryptionSalt)),this._encryptDataStreamKey=await(async function(U,W,$){const Z=await window.crypto.subtle.importKey("raw",W,"PBKDF2",!1,["deriveBits","deriveKey"]),Y=U==="aes-128-gcm2"?128:256;return await window.crypto.subtle.deriveKey({name:"PBKDF2",iterations:T1,hash:"SHA-256",salt:$},Z,{name:"AES-GCM",length:Y},!0,["encrypt","decrypt"])})(this._encryptionMode,j,Th(this._encryptionSalt))}else c?w.warning("[".concat(this._clientId,"] encrypt datastream must be running in a secure context, fallback to plain data stream")):w.warning("[".concat(this._clientId,"] current browser do not support WebCrypto ,fallback to plain data stream")),this._encryptDataStream=!1;else this._encryptDataStream=!1,w.debug("[".concat(this._clientId,"] no salt / secret, cannot support encrypt data stream, fallback to plain data stream"));this._startSession(this._sessionId,{channel:t,appId:e,stringUid:E.stringUid});const S=this._sessionId;setTimeout((()=>{this.connectionState==="CONNECTING"&&S===this._sessionId&&We.joinChannelTimeout(this._sessionId,5)}),5e3);try{var O;let N;const j=E.cloudProxyServer;if(be(O=["proxy3","proxy4","proxy5"]).call(O,j)){const Y=B("PROXY_SERVER_TYPE3");Array.isArray(Y)?E.proxyServer=Y[0]:E.proxyServer=Y}if(We.setProxyServer(E.proxyServer),w.setProxyServer(E.proxyServer),this.store.requestAPStart(),h){if(w.debug("[".concat(this._clientId,"] get serverInfo Success from Preload Cache ").concat(E.stringUid?", ".concat(E.stringUid," => ").concat(h.intUid):""," ")),E.stringUid&&!E.uid&&(E.uid=h.intUid),N={gatewayInfo:h.ap.gatewayInfo},B("JOIN_WITH_FALLBACK_MEDIA_PROXY")&&E.turnServer.mode==="auto")if(h.ap.proxyInfo.addresses.length===0)w.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers");else{const Y=(await a2(h.ap.proxyInfo,h.ap.gatewayInfo.uid)).map((ie=>({turnServerURL:ie.address,tcpport:ie.tcpport||Hr.tcpport,udpport:ie.udpport||Hr.udpport,username:ie.username||Hr.username,password:ie.password||Hr.password,forceturn:!1,security:!0})));E.turnServer={mode:"manual",servers:Y}}fU(h,E.stringUid)}else{if(E.stringUid&&!E.uid){let Y;[Y,N]=await ke.all([L2(E.stringUid,E,this._axiosCancelSource.token,this._config.httpRetryConfig||rr,this.store).finally((()=>{this.store.requestSUAEnd()})),x2(E,this._axiosCancelSource.token,this._config.httpRetryConfig||rr,!0,this.store).finally((()=>{this.store.requestAPEnd()}))]),w.debug("[".concat(this._clientId,"] getUserAccount Success ").concat(E.stringUid," => ").concat(Y)),E.uid=Y,N.gatewayInfo.uid=Y,N.gatewayInfo.res.uid=Y}else N=await x2(E,this._axiosCancelSource.token,this._config.httpRetryConfig||rr,!0,this.store);if(!this._joinAndNotLeaveYet)throw new le(V.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"))}this.store.requestAPEnd(),setTimeout((()=>{this._configDistribute.startGetConfigDistribute(E,this._axiosCancelSource.token),this._configDistribute.on(oE.UPDATE_BITRATE_LIMIT,(Y=>{this._p2pChannel.updateBitrateLimit(Y)})),this._configDistribute.on(oE.UPDATE_CLIENT_ROLE_OPTIONS,(Y=>{this._setClientRoleOptions(Y)}))}),0),this._key=n||e;const U=N.gatewayInfo,W=E.uid?E.uid:U.uid;this._joinInfo=qo(qo({},E),{},{cid:U.cid,uid:W,vid:U.vid,apResponse:U.res,apGatewayAddress:U.apGatewayAddress,uni_lbs_ip:U.uni_lbs_ip,gatewayAddrs:U.gatewayAddrs}),this.store.intUid=W,this.store.cid=U.cid;const $=await this._joinGateway();if(!this._joinAndNotLeaveYet)throw new le(V.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));g.onSuccess($),this._appId=e,this._channelName=E.cname,this._uid=$,this.store.uid=$,setTimeout((()=>{this._networkQualityInterval&&window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=window.setInterval(this._handleUpdateNetworkQuality,2e3),window.addEventListener(Br()?"beforeunload":"pagehide",this._handleBeforeUnload),this._statsCollector.startUpdateStats()}),0);const Z=E.stringUid?"string uid: ".concat(E.stringUid,",uid: ").concat(E.uid):"uid: ".concat(this._uid);return w.info("[".concat(this._clientId,"] Joining channel success: channel: ").concat(t,",").concat(Z)),setTimeout((()=>{w.startUpload()}),5e3),this.store.joinEnd(),A=this,be(Oh).call(Oh,A)||Oh.push(A),this._cloudProxyServerMode==="disabled"&&Bt().supportWebCrypto&&B("ENABLE_PRELOAD")&&MI(this._joinInfo),$}catch(N){const j=Array.isArray(N)?N[0]:N;throw j&&j.code===V.OPERATION_ABORTED?w.warning("[".concat(this._clientId,"] join number: ").concat(s,", Joining channel failed, rollback"),j):w.error("[".concat(this._clientId,"] join number: ").concat(s,", Joining channel failed, rollback"),j),j.code!==V.OPERATION_ABORTED&&this._numberOfJoinCount===s&&(this._gateway.state="DISCONNECTED",this._reset()),g.onError(j),j}var A}_joinGateway(){if(!this._joinInfo||!this._key)throw new le(V.INVALID_OPERATION);return this._gateway.join(this._joinInfo,this._key,!(this._joinInfo.cloudProxyServer!=="disabled"||this._joinInfo.proxyServer||!B("JOIN_WITH_FALLBACK_SIGNAL_PROXY")))}async leave(){w.info("[".concat(this._clientId,"] Leaving channel")),window.removeEventListener(Br()?"beforeunload":"pagehide",this._handleBeforeUnload),this._reset(),(function(t){const n=Oh.indexOf(t);n!==-1&&Oh.splice(n,1)})(this),this._statsCollector.stopUpdateStats();const e=await this._leaveMutex.lock();if(this.connectionState==="DISCONNECTED")return w.info("[".concat(this._clientId,"] Leaving channel repeated, success")),void e();await this._gateway.leave(this.connectionState!=="CONNECTED",$t.LEAVE),w.info("[".concat(this._clientId,"] Leaving channel success")),this._joinAndNotLeaveYet=!1,this.store.resetJoinChannelServiceRecords(),e()}async publish(e){let t=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!Array.isArray(e)){if(!(e instanceof Kf))return this._publishDataChannel(e);e=[e]}if(e.length===0)throw new le(V.INVALID_PARAMS,"param list is empty");const n=e;if(this._gateway.role==="audience")throw new le(V.INVALID_OPERATION,"audience can not publish stream");for(const i of n){if(!(i instanceof Kf))throw new le(V.INVALID_PARAMS,"parameter is not local track");if(!i._enabled&&t)throw new le(V.TRACK_IS_DISABLED,"can not publish a disabled track: ".concat(i.getTrackId()))}w.info("[".concat(this._clientId,"] Publishing tracks, id ").concat(n.map((i=>"".concat(i.getTrackId()," ")))));const r=await this._publishMutex.lock();await this._configDistribute.awaitConfigDistributeComplete(),t&&n.forEach((i=>{const s=this._configDistribute.getBitrateLimit();i instanceof Sn&&s&&i.setBitrateLimit(s.uplink)}));try{await this._publishHighStream(n),w.info("[".concat(this._clientId,"] Publish success, id ").concat(n.map((i=>"".concat(i.getTrackId()," ")))))}catch(i){throw w.error("[".concat(this._clientId,"] publish error"),i.toString()),i}finally{r()}}async _publishDataChannel(e){if(e==null)throw new le(V.INVALID_PARAMS,"parameter is not local track or datachannel config, config is ".concat(JSON.stringify(e)));cn(e.id,"id",0,65535,!0),wa(e.ordered,"ordered"),kr(e.metadata,"metadata",0,512),w.info("[".concat(this._clientId,"] Publishing datachannels, id ").concat(e.id));const t=await this._publishMutex.lock();try{if(this._p2pChannel.getAllDataChannels().findIndex((i=>i.id===e.id))!==-1)throw new le(V.INVALID_PARAMS,"Invalid id: ".concat(e.id,". If you want to republish the datachannel, unpublish first"));if(!this._joinInfo||this._uid===void 0)throw new le(V.INVALID_OPERATION,"Can't publish datachannel, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new le(V.INVALID_OPERATION,"can not publish datachannel in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&B("FORCE_TURN")&&!B("TURN_ENABLE_TCP")&&!B("TURN_ENABLE_UDP"))throw new le(V.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");const n=(function(i){return C2(i,!1)})(e),r=await this._p2pChannel.publishDataChannel([n]);if(r.length>0){if(typeof n._originDataChannelId!="number")throw w.error("[".concat(this._clientId,"] can not publish with mediaType datachannel, cannot get RTCDatachannel id")),new le(V.CREATE_DATACHANNEL_ERROR);try{await ke.all(r.map((i=>this._uid&&this._gateway.publishDataChannel(this._uid,i,!0)))),await n._waitTillOpen()}catch(i){if(i.code!==V.DISCONNECT_P2P)throw i}}return w.info("[".concat(this._clientId,"] Publish dataChannels success, id ").concat(n.id)),n}catch(n){throw w.error("[".concat(this._clientId,"] publish datachannels error"),n.toString()),n}finally{t()}}async unpublish(e){if(!this._joinInfo||this._uid===void 0)throw new le(V.INVALID_OPERATION,"Can't unpublish stream, haven't joined yet!");let t=[];if(e)if(Array.isArray(e))t=e;else{if(!(e instanceof Kf))return this._unpublishDataChannel([e]);t=[e]}else this.store.useP2P||await this._unpublishDataChannel(),t=this._p2pChannel.getAllTracks(!0);w.info("[".concat(this._clientId,"] Unpublish tracks, tracks ").concat(t.map((r=>"".concat(r.getTrackId()," ")))," "));const n=await this._publishMutex.lock();try{if(this.store.useP2P){const r=await this._p2pChannel.unpublish(t);r&&await this._gateway.sendExtensionMessage(Kn.UNPUBLISH,{unpubMsg:r},!0)}else{const r=await this._p2pChannel.unpublish(t);r&&await this._gateway.unpublish(r,this._uid),w.info("[".concat(this._clientId,"] Unpublish success,tracks ").concat(t.map((i=>"".concat(i.getTrackId())))))}}catch(r){throw w.error("[".concat(this._clientId,"] unpublish error"),r.toString()),r}finally{n&&n()}}async _unpublishDataChannel(e){e!==void 0&&e.length!==0||(e=this._p2pChannel.getAllDataChannels()),w.info("[".concat(this._clientId,"] Unpublish datachannels, datachannels ").concat(e.map((n=>"".concat(n.id," ")))," "));const t=await this._publishMutex.lock();try{const n=await this._p2pChannel.unpublishDataChannel(e);n&&await this._gateway.unpublishDataChannel(n),w.info("[".concat(this._clientId,"] Unpublish dataChannel success,dataChannel ").concat(e.map((r=>"".concat(r.id)))))}catch(n){throw w.error("[".concat(this._clientId,"] unpublish dataChannel error"),n.toString()),n}finally{t&&t()}}async subscribe(e,t,n){if(!(e instanceof Vd)){const r=this.remoteUsers.find((i=>i.uid===e));if(!r)throw new le(V.INVALID_REMOTE_USER,"user is not in the channel");e=r}return t==="datachannel"?this._subscribeDataChannel(e,n):this._subscribe(e,t)}async presubscribe(e,t){if(pr(t,"mediaType",["audio","video"]),this.store.useP2P)throw new le(V.INVALID_OPERATION,"can't presub at p2p mode");if(!this._joinInfo)throw new le(V.INVALID_OPERATION,"can't presub when not join");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new le(V.INVALID_OPERATION,"can't presub in ".concat(this.connectionState," state"));const n=t===Me.AUDIO,r=t===Me.VIDEO,i=await this._subscribeMutex.lock();try{const{ssrcId:s,ortc:o,rtxSsrcId:c,cname:d,uint_id:h}=await this._gateway.presubscribe(e,t,!0);if(s==null)throw new le(V.UNEXPECTED_RESPONSE,"no ssrc id");let f=this._users.find((E=>E.uid===e));f||(f=new Vd(e,h||e),f._is_pre_created=!0,this._users.push(f)),d&&(f._cname=d),f._uintid||(f._uintid=h||e),n&&(f._audioSSRC=s,f._audio_pre_subscribed=!0,o&&(f._audioOrtc=o)),r&&(f._videoSSRC=s,f._video_pre_subscribed=!0,o&&(f._videoOrtc=o),c!=null&&(f._rtxSsrcId=c)),w.info("[".concat(this._clientId,"] presub succeed ssrc: ").concat(s)),await this._p2pChannel.subscribe(f,t,s,c,o);const g=n?f._audioTrack:f._videoTrack;if(!g)throw new le(V.UNEXPECTED_ERROR,"can not find remote track in user");return n&&(f._trust_audio_stream_added_state_=!0,f._audio_added_=!0),r&&(f._trust_video_stream_added_state_=!0,f._video_added_=!0),g}catch(s){throw w.error("[".concat(this._clientId,"] presub user ").concat(e," error"),s),s}finally{i()}}async _subscribeDataChannel(e,t){var n;if(cn(t,"channelId",0,65535,!0),!this._joinInfo)throw new le(V.INVALID_OPERATION,"Can't subscribe datachannel, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new le(V.INVALID_OPERATION,"Can't subscribe datachannel in ".concat(this.connectionState," state"));if(!this._users.find((c=>c===e)))throw w.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),new le(V.INVALID_REMOTE_USER,"user is not in the channel");if(!e.hasAudio&&!e.hasVideo&&e._dataChannels.length===0)throw w.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),new le(V.INVALID_REMOTE_USER,"user is not published");const i=(n=e._dataChannels)===null||n===void 0?void 0:n.find((c=>c.id===t));if(!i)throw w.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType datachannel, remote datachannel is not published")),new le(V.REMOTE_USER_IS_NOT_PUBLISHED);const s=await this._subscribeMutex.lock();w.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: datachannel"));try{const c=await this._p2pChannel.subscribeDataChannel(e,[i]);if(c&&be(c).call(c,i.id))try{var o;if(typeof i._originDataChannelId!="number")throw w.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType datachannel, cannot get RTCDatachannel")),new le(V.CREATE_DATACHANNEL_ERROR);const d={id:i.id,datachannelId:i._originDataChannelId,ordered:i.ordered,maxRetransmits:i.maxRetransmits,metadata:(o=i.metadata)!==null&&o!==void 0?o:""};await this._gateway.subscribeDataChannel(e.uid,d,!0),await i._waitTillOpen()}catch(d){if(d?.code!==V.WS_ABORT)throw await this._p2pChannel.unsubscribeDataChannel(e,[i]),d;await this._p2pChannel.unsubscribeDataChannel(e,[i]),this._p2pChannel.setPendingRemoteDataChannel(e,i.id)}return w.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: datachannel")),i}finally{s()}}async _p2pSubscribe(e,t,n){if(pr(t,"mediaType",["audio","video"]),!this._joinInfo)throw new le(V.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new le(V.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find((s=>s===e))){const s=new le(V.INVALID_REMOTE_USER,"user is not in the channel");throw w.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),s}if(!e.hasAudio&&!e.hasVideo){const s=new le(V.INVALID_REMOTE_USER,"user is not published");throw w.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),s}if(!n&&(t==="audio"&&!e.hasAudio||t==="video"&&!e.hasVideo)){const s=new le(V.REMOTE_USER_IS_NOT_PUBLISHED);throw w.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType ").concat(t,", remote track is not published")),s}const i=await this._subscribeMutex.lock();w.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: ").concat(t));try{if(await this._p2pChannel.hasRemoteMediaWithLock(e,t))await this._p2pChannel.unmuteRemote(e,t);else try{const o=t==="audio"?e._audioSSRC:e._videoSSRC,c=t==="audio"?e._audioMid:e._videoMid;this.store.subscribe(e.uid,t,Date.now()),this.store.useP2P&&await this._p2pChannel.subscribe(e,t,o,c)}catch(o){throw o}w.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: ").concat(t)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(e.uid,this._defaultStreamFallbackType).catch((o=>{w.warning("[".concat(this._clientId,"] auto set fallback failed"),o)}));const s=t==="audio"?e._audioTrack:e._videoTrack;if(!s)throw new le(V.UNEXPECTED_ERROR,"can not find remote track in user object");return s}catch(s){throw w.error("[".concat(this._clientId,"] subscribe user ").concat(e.uid," error"),s),s}finally{i()}}async _subscribe(e,t,n){if(this.store.useP2P)return this._p2pSubscribe(e,t);if(pr(t,"mediaType",["audio","video"]),!this._joinInfo)throw new le(V.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new le(V.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find((h=>h===e))){const h=new le(V.INVALID_REMOTE_USER,"user is not in the channel");throw w.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),h}if(!e.hasAudio&&!e.hasVideo){const h=new le(V.INVALID_REMOTE_USER,"user is not published");throw w.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),h}if(!(n||(t!=="audio"||e.hasAudio&&e._audioSSRC!==void 0)&&(t!=="video"||e.hasVideo&&e._videoSSRC!==void 0))){const h=new le(V.REMOTE_USER_IS_NOT_PUBLISHED);throw w.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType ").concat(t,", remote track is not published")),h}let i=t==="audio"?e._audioSSRC:e._videoSSRC,s=t==="audio"?e._audioOrtc:e._videoOrtc,o=t==="video"?e._rtxSsrcId:void 0,c={stream_type:t==="audio"?Me.AUDIO:Me.VIDEO,ssrcId:i};t==="video"&&this.store.firstVideoFrameDecoded(e.uid,{subscribeStart:Date.now()});const d=await this._subscribeMutex.lock();w.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: ").concat(t));try{if(await this._p2pChannel.hasRemoteMediaWithLock(e,t))await this._p2pChannel.unmuteRemote(e,t);else try{const f=t==="audio"?e._audioSSRC:e._videoSSRC;f!==void 0&&f!==i&&(i=f,s=t==="audio"?e._audioOrtc:e._videoOrtc,o=t==="video"?e._rtxSsrcId:void 0,c={stream_type:t==="audio"?Me.AUDIO:Me.VIDEO,ssrcId:i}),ei.markSubscribeStart(this.store.clientId,i),this.store.subscribe(e.uid,t,Date.now()),await this._p2pChannel.subscribe(e,t,i,o,s);try{this._p2pChannel.isPreSubScribe(i)||await this._gateway.subscribe(e.uid,c,!0)}catch(g){if(g?.code!==V.WS_ABORT)throw await this._p2pChannel.unsubscribe(e,t),g;await this._p2pChannel.unsubscribe(e,t,!0),this._p2pChannel.setPendingRemoteMedia(e,t)}this.store.subscribe(e.uid,t,void 0,Date.now()),this._p2pChannel.reportSubscribeEvent(!0,null,e,t)}catch(f){throw this._p2pChannel.reportSubscribeEvent(!1,f?.code,e,t),f}w.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: ").concat(t)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(e.uid,this._defaultStreamFallbackType).catch((f=>{w.warning("[".concat(this._clientId,"] auto set fallback failed"),f)}));const h=t==="audio"?e._audioTrack:e._videoTrack;if(!h)throw new le(V.UNEXPECTED_ERROR,"can not find remote track in user object");return t==="video"&&(this.store.firstVideoFrameDecoded(e.uid,{subscribeEnd:Date.now()}),this._p2pChannel.reportVideoFirstFrameRender(e)),h}catch(h){throw w.error("[".concat(this._clientId,"] subscribe user ").concat(e.uid," error"),h),h}finally{d()}}async massSubscribe(e){if(yl(e,"subscribeList"),!this._joinInfo)throw new le(V.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new le(V.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));const t=Date.now(),n=new Map,r=await this._subscribeMutex.lock();w.info("[".concat(this._clientId,"]start massSubscribe user ").concat(e.map((c=>{let{user:d,mediaType:h}=c;return"user: ".concat(d?.uid,", mediaType: ").concat(h)})).join("; ")));const i=(e=[...e]).map((c=>{let{user:d,mediaType:h}=c;return{user:d,mediaType:h}})),s=await this._p2pChannel.globalLock();try{var o;for(let d=e.length-1;d>=0;d--){const h=e[d],{user:f,mediaType:g}=h;if(pr(g,"mediaType",["audio","video"]),!f){const A=new le(V.INVALID_PARAMS,"user property does not exist in subscribeList item");throw w.error("[".concat(this._clientId,"] user property does not exist in subscribeList item")),A}if(!this._users.find((A=>A===f))){const A=new le(V.INVALID_REMOTE_USER,"user is not in the channel");w.error("[".concat(this._clientId,"] can not massSubscribe ").concat(f.uid,", this user is not in the channel")),i[d].error=A,e.splice(d,1);continue}if(g==="audio"&&(!f.hasAudio||f._audioSSRC===void 0)||g==="video"&&(!f.hasVideo||f._videoSSRC===void 0)){const A=new le(V.REMOTE_USER_IS_NOT_PUBLISHED);w.error("[".concat(this._clientId,"] can not subscribe ").concat(f.uid," with mediaType ").concat(g,", remote user is not published")),i[d].error=A,e.splice(d,1);continue}const S=vr.Video|vr.LwoVideo,O=n.get(f);if(O){if(g==="video"?O&S:O&vr.Audio){e.splice(d,1),w.warning("[".concat(this._clientId,"] repeat massSubscribe user:").concat(f.uid,", mediaType:").concat(g," twice"));continue}n.set(f,O|(g==="video"?S:vr.Audio))}else n.set(f,g==="video"?S:vr.Audio)}for(let d=e.length-1;d>=0;d--){const h=e[d],{user:f,mediaType:g}=h,E=vr.Video|vr.LwoVideo;if(this._p2pChannel.hasRemoteMedia(f,g)){await this._p2pChannel.unmuteRemoteNoLock(f,g);const S=n.get(f);n.set(f,g==="video"?S^E:S^vr.Audio),e.splice(d,1)}}this.store.massSubscribe(e.map((d=>({userId:d.user.uid,type:d.mediaType}))),t);let c=Yi(o=Array.from(n.entries())).call(o,((d,h)=>{let[f,g]=h;if(g===0)return d;const E={stream_id:f.uid,stream_type:g};return g&vr.Audio&&(E.audio_ssrc=f._audioSSRC),g&vr.Video&&(E.video_ssrc=f._videoSSRC),d.push(E),d}),[]);try{e.length>0&&await this._p2pChannel.massSubscribeNoLock(e.map((h=>{let{user:f,mediaType:g}=h;return{user:f,mediaType:g,ssrcId:g===Me.VIDEO?f._videoSSRC:f._audioSSRC,rtxSsrcId:g===Me.VIDEO?f._rtxSsrcId:void 0}})));const d=new Map;if(c=c.filter((h=>h.video_ssrc&&!this._p2pChannel.isPreSubScribe(h.video_ssrc)||h.audio_ssrc&&!this._p2pChannel.isPreSubScribe(h.audio_ssrc)||!h.video_ssrc&&!h.audio_ssrc)),c.length>0){const h=await this._gateway.subscribeAll(c,!0);(h?.users||[]).forEach((f=>{let{stream_id:g,video_error_code:E,audio_error_code:S,error_code:O}=f;(E||S||O)&&d.set(g,{video_error_code:E,audio_error_code:S,error_code:O})}))}if(Array.from(d.entries()).length>0){const h=[];Array.from(d.entries()).forEach((f=>{let[g,E]=f;const S=this.remoteUsers.find((O=>O.uid===g));if(S){let O;E.error_code||E.video_error_code&&E.audio_error_code?O=void 0:E.video_error_code?O=Me.VIDEO:E.audio_error_code&&(O=Me.AUDIO),h.push({user:S,mediaType:O})}})),h.length>0&&await this._p2pChannel.massUnsubscribeNoLock(h)}for(const h of i){const f=d.get(h.user.uid);if(f){const g=f.error_code||h.mediaType==="audio"&&f.audio_error_code||h.mediaType==="video"&&f.video_error_code;if(g){const E=aE(g);w.error("user:".concat(h.user.uid," mediaType:").concat(h.mediaType," has massSubscribe error ").concat(E.desc)),h.error=new le(V.SUBSCRIBE_FAILED,"code ".concat(g,": ").concat(E.desc))}}h.error||(h.mediaType==="video"?h.track=h.user.videoTrack:h.track=h.user.audioTrack)}return this.store.massSubscribe(i.filter((h=>!h.error)).map((h=>({userId:h.user.uid,type:h.mediaType}))),void 0,Date.now()),i.forEach((h=>{var f;We.subscribe(this.store.sessionId,{succ:!!h.error,ec:((f=h.error)===null||f===void 0?void 0:f.code)||null,video:h.mediaType===Me.VIDEO,audio:h.mediaType===Me.AUDIO,peerid:h.user.uid,subscribeRequestid:h.mediaType===Me.VIDEO?h.user._videoSSRC:h.user._audioSSRC,p2pid:this.store.p2pId,eventElapse:Math.floor(performance.now()-t),preSsrc:this._p2pChannel.isPreSubScribe(h.user._videoSSRC)},!0)})),w.info("[".concat(this._clientId,"] massSubscribe success ").concat(e.map((h=>{let{user:f,mediaType:g}=h;return"user: ".concat(f?.uid,", mediaType: ").concat(g)})).join("; "))),i}catch(d){throw await this._p2pChannel.massUnsubscribeNoLock(e),d}}finally{s(),r()}}async unsubscribe(e,t,n){if(!(e instanceof Vd)){const s=this.remoteUsers.find((o=>o.uid===e));if(!s)throw new le(V.INVALID_REMOTE_USER,"user is not in the channel");e=s}if(t||this.store.useP2P){if(t==="datachannel")return this._unsubscribeDataChannel(e,n)}else await this._unsubscribeDataChannel(e,n);if(t&&pr(t,"mediaType",["audio","video"]),!this._joinInfo)throw new le(V.INVALID_OPERATION,"Can't unsubscribe stream, haven't joined yet!");if(!this._users.find((s=>s===e))){const s=new le(V.INVALID_REMOTE_USER,"user is not in the channel");throw w.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid,", user is not in the channel")),s}w.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(e.uid,", mediaType: ").concat(t));const i=await this._subscribeMutex.lock();try{if(this.store.useP2P)await this._p2pChannel.unsubscribe(e,t);else{const s=await this._p2pChannel.unsubscribe(e,t);s&&await this._gateway.unsubscribe(s,e.uid),t&&t!=="audio"||(e._audio_pre_subscribed=!1),t&&t!=="video"||(e._video_pre_subscribed=!1),e._is_pre_created&&GS(this._users,e),w.info("[".concat(this._clientId,"] unsubscribe success uid: ").concat(e.uid,", mediaType: ").concat(t))}}catch(s){if(s.code===V.DISCONNECT_P2P)return void w.warning("disconnecting p2p, abort unsubscribe request.");throw w.error("[".concat(this._clientId,"] unsubscribe user ").concat(e.uid," error"),s.toString()),s}finally{i()}}async _unsubscribeDataChannel(e,t){if(t&&cn(t,"id",0,65535,!0),!this._joinInfo)throw new le(V.INVALID_OPERATION,"Can't unsubscribe datachannel, haven't joined yet!");if(!this._users.find((i=>i===e))){const i=new le(V.INVALID_REMOTE_USER,"user is not in the channel");throw w.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid,", user is not in the channel")),i}let r;if(typeof t=="number"){const i=e._dataChannels.find((s=>s.id===t));i&&(r=[i])}else r=e._dataChannels;if(r===void 0){const i=new le(V.REMOTE_USER_IS_NOT_PUBLISHED);throw w.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid," with channelId ").concat(t,", remote datachannel is not published")),i}w.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(e.uid,", mediaType: datachannel, ids: ").concat(r.map((i=>i.id))));try{const i=await this._p2pChannel.unsubscribeDataChannel(e,r);i&&await this._gateway.unsubscribeDataChannel(i,e.uid),w.info("[".concat(this._clientId,"] unsubscribe datachannel success uid: ").concat(e.uid,", mediaType: datachannel, ids: ").concat(i))}catch(i){if(i.code===V.DISCONNECT_P2P)return void w.warning("disconnecting p2p, abort unsubscribe request.");throw w.error("[".concat(this._clientId,"] unsubscribe user ").concat(e.uid," error"),i.toString()),i}}async massUnsubscribe(e){if(yl(e,"unsubscribeList"),!this._joinInfo)throw new le(V.INVALID_OPERATION,"Can't unsubscribeAll stream, haven't joined yet!");w.info("[".concat(this._clientId,"] start massUnsubscribe ").concat(e.map((n=>{let{user:r,mediaType:i}=n;return"user: ".concat(r?.uid,", mediaType: ").concat(i,";")})).join())),e=[...e];const t=new Map;for(let n=e.length-1;n>=0;n--){const{user:r,mediaType:i}=e[n];if(!r){const c=new le(V.INVALID_PARAMS,"user property does not exist in unsubscribeList item");throw w.error("[".concat(this._clientId,"] user property does not exist in unsubscribeList item")),c}if(pr(i,"mediaType",["video","audio",void 0]),!this._users.find((c=>c===r))){w.warning("[".concat(this._clientId,"] can not unsubscribe ").concat(r.uid,", user is not in the channel")),e.splice(n,1);continue}const o=vr.Video|vr.LwoVideo;if(t.has(r)){const c=t.get(r);let d;switch(i){case"video":d=c&o;break;case"audio":d=c&vr.Audio;break;default:d=c&(vr.Audio|o)}if(d){w.warning("[".concat(this._clientId,"] repeat massUnsubscribe user:").concat(r.uid,",mediaType:").concat(i," twice.")),e.splice(n,1);continue}i?i==="audio"?t.set(r,c|vr.Audio):i==="video"&&t.set(r,c|o):t.set(r,c|vr.Audio|o)}else i?i==="audio"?t.set(r,vr.Audio):i==="video"&&t.set(r,o):t.set(r,vr.Audio|o)}try{const n=await this._p2pChannel.massUnsubscribe(e);n&&await this._gateway.massUnsubscribe(n),w.info("[".concat(this._clientId,"] massUnsubscribe success ").concat(e.map((r=>{let{user:i,mediaType:s}=r;return"user: ".concat(i?.uid,", mediaType: ").concat(s,";")})).join()))}catch(n){if(n.code===V.DISCONNECT_P2P)return void w.warning("[".concat(this._clientId,"] disconnecting p2p, abort unsubscribe request."));throw w.error("[".concat(this._clientId,"] massUnsubscribe error"),n.toString()),n}}async setLowStreamParameter(e){(function(n){if(!n)throw new de(V.INVALID_PARAMS);Vn(n.width)||ob(n.width,"streamParameter.width"),Vn(n.height)||ob(n.height,"streamParameter.height"),Vn(n.framerate)||ob(n.framerate,"streamParameter.framerate"),Vn(n.bitrate)||cn(n.bitrate,"streamParameter.bitrate")})(e),(!e.width&&e.height||e.width&&!e.height)&&w.warning("[".concat(this._clientId,"] The width and height parameters take effect only when both are set")),w.info("[".concat(this._clientId,"] set low stream parameter to"),JSON.stringify(e));const t=this._configDistribute.getLowStreamConfigDistribute();if(t&&t.bitrate&&e.bitrate&&t.bitrate<e.bitrate&&(e.bitrate=t.bitrate),this._lowStreamParameter=e,this._isDualStreamEnabled)return this._p2pChannel.updateVideoStreamParameter(e,ve.LocalVideoLowTrack)}async enableDualStream(){if(!Bt().supportDualStream)throw We.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),new le(V.NOT_SUPPORTED,"Your browser is not support dual stream");if(this._isDualStreamEnabled)throw new le(V.INVALID_OPERATION,"Dual stream is already enabled");if(this._p2pChannel.canPublishLowStream())try{await this._publishLowStream()}catch(e){throw We.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),e}this._isDualStreamEnabled=!0,We.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!0}),w.info("[".concat(this._clientId,"] enable dual stream"))}async disableDualStream(){if(this._isDualStreamEnabled){if(!this._joinInfo)throw new le(V.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this._p2pChannel.getLocalMedia(ve.LocalVideoLowTrack))try{const e=await this._p2pChannel.unpublishLowStream();e&&await this._gateway.unpublish(e,this._joinInfo.stringUid||this._joinInfo.uid)}catch(e){throw We.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!1}),e}this._isDualStreamEnabled=!1,We.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!0}),w.info("[".concat(this._clientId,"] disable dual stream"))}}async setClientRole(e,t){if((function(r){pr(r,"role",["audience","host"])})(e),t&&db(t),this.mode==="rtc"||this.mode==="p2p")throw w.warning("[".concat(this._clientId,"]").concat(this.mode," mode can not use setClientRole")),new le(V.INVALID_OPERATION,"".concat(this.mode," mode can not use setClientRole"));if(t&&t.level&&e==="host")throw new le(V.INVALID_OPERATION,"host mode can not set audience latency level");if(e==="audience"&&this._p2pChannel.hasLocalMedia())throw new le(V.INVALID_OPERATION,"can not set client role to audience when publishing stream");const n=this._config.role;this._joinInfo&&(this._joinInfo.role=e),e!==n&&B("ENABLE_ROLE_SELECT_EDGE")?(this._gateway.updateClientRole(e,t),this._config.role=e,this._gateway.reconnect("recover",Wr.REGIONAL_DISTRIBUTION)):(await this._gateway.setClientRole(e,t),this._config.role=e),w.info("[".concat(this._clientId,"] set client role to ").concat(e,", level: ").concat(t&&t.level))}async _setClientRoleOptions(e){if(this.mode==="rtc"||this.mode==="p2p"||this._config.role!=="audience"||this._p2pChannel.hasLocalMedia())return;let t=!1;try{e&&db(e),await this._gateway.setClientRole(this._config.role,e),t=!0}catch{}finally{w.info("[".concat(this._clientId,"] set client role options ").concat(t?"succeed":"failed",", options is ").concat(e))}}getRemoteInboundOffset(){var e;const t=(e=this._p2pChannel.getStats())===null||e===void 0?void 0:e.audioSend[0];if(!t||!t.timestamp)return 0;const n=t.timestamp-Date.now();return Math.abs(n)>1e3+t.rttMs+100?this.ntpAlignErrorCount+=1:this.ntpAlignErrorCount=0,this.ntpAlignErrorCount>=3?n:0}getNtpWallTimeInMs(){return document.visibilityState==="visible"&&(this.remoteInboundOffset=this.getRemoteInboundOffset()),this.remoteInboundOffset+Date.now()+this._gateway.ntpOffset}setProxyServer(e,t){if(kr(e,"proxyServer"),!t){if(this.connectionState!=="DISCONNECTED")throw new le(V.INVALID_OPERATION,"Set proxy server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new le(V.INVALID_OPERATION,"You have already set the proxy")}this._proxyServer=e,We.setProxyServer(this._proxyServer),w.setProxyServer(this._proxyServer),w.info("[".concat(this._clientId,"] Set proxy server ").concat(t?"by initialize call":""," success."))}setTurnServer(e,t){if(Array.isArray(e)||(e=[e]),!t){if(this.connectionState!=="DISCONNECTED")throw new le(V.INVALID_OPERATION,"Set turn server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new le(V.INVALID_OPERATION,"You have already set the proxy")}if(Xg(e))return this._turnServer={servers:e,mode:"original-manual"},void w.info("[".concat(this._clientId,"] Set original turnserver ").concat(t?"by initialize call":""," success: ").concat(e.map((n=>n.urls)).join(","),"."));e.forEach((n=>e1(n))),this._turnServer={servers:e,mode:"manual"},w.info("[".concat(this._clientId,"] Set turnserver ").concat(t?"by initialize call":""," success."))}setLicense(e){if(this.connectionState!=="DISCONNECTED")throw new le(V.INVALID_OPERATION,"you should set license before join channel");if(kr(e,"license",32,32),!/^[A-Za-z\d]+$/.test(e))throw new le(V.INVALID_PARAMS,"license should only contains characters from A-Z a-z 0-9");this._license=e,w.info("[".concat(this._clientId,"] set license success"),e)}startProxyServer(e){if(this.connectionState!=="DISCONNECTED")throw new le(V.INVALID_OPERATION,"Start proxy server before join channel");if(this._proxyServer||this._turnServer.mode==="manual"||this._useLocalAccessPoint)throw new le(V.INVALID_OPERATION,"You have already set the proxy");const t=[3,4,5];let n;switch(e===void 0&&(e=3),e){case 1:case 2:throw new le(V.NOT_SUPPORTED,"proxy mode 1/2 has been deprecated and not supported.");case 3:n="proxy3";break;case 4:n="proxy4";break;case 5:n="proxy5";break;default:throw new le(V.INVALID_PARAMS,"proxy server mode must be ".concat(t.join("|")))}this._cloudProxyServerMode=n,this.store.cloudProxyServerMode=n,w.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode)}stopProxyServer(){if(this.connectionState!=="DISCONNECTED")throw new le(V.INVALID_OPERATION,"Stop proxy server after leave channel");We.setProxyServer(),w.setProxyServer(),this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled",w.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),this._proxyServer=void 0,this._turnServer={mode:"auto",servers:[]}}setLocalAccessPointsV2(e){if(!e.accessPoints)throw new le(V.INVALID_PARAMS,"accessPoints is required.");yl(e.accessPoints.serverList,"accessPoints.serverList"),kr(e.accessPoints.domain,"accessPoints.domain");const t=(E,S)=>{cn(E,S,0,65535,!0)};let n=443;if(e.accessPoints.port&&(t(e.accessPoints.port,"accessPoints.port"),n=e.accessPoints.port),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new le(V.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");B("CLOSE_AFB_FOR_LOCAL_AP")&&(sn("JOIN_WITH_FALLBACK_SIGNAL_PROXY",!1),sn("JOIN_WITH_FALLBACK_MEDIA_PROXY",!1));const r=/^((\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.){3}(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/,i=e.accessPoints.domain,s=e.accessPoints.serverList.map((E=>r.test(E)?"".concat(E.replace(/\./g,"-"),".").concat(i):E)),o=s.map((E=>"".concat(E,":").concat(n)));this._useLocalAccessPoint=!0,this._setLocalAPVersion=2,sn("WEBCS_DOMAIN",o),sn("WEBCS_DOMAIN_BACKUP_LIST",o),sn("GATEWAY_DOMAINS",[i]),e.report&&e.report.hostname&&Array.isArray(e.report.hostname)&&e.report.hostname.length?(yl(e.report.hostname,"report.hostname"),sn("EVENT_REPORT_DOMAIN",e.report.hostname[0]),sn("EVENT_REPORT_BACKUP_DOMAIN",e.report.hostname[1]||e.report.hostname[0])):(sn("EVENT_REPORT_DOMAIN",s[0]),sn("EVENT_REPORT_BACKUP_DOMAIN",s[1]||s[0]));let c=6443;e.report&&e.report.port&&(t(e.report.port,"report.port"),c=e.report.port),sn("STATS_COLLECTOR_PORT",c),e.report?sn("ENABLE_EVENT_REPORT",!0):sn("ENABLE_EVENT_REPORT",!1);let d="";e.log&&e.log.hostname&&Array.isArray(e.log.hostname)&&e.log.hostname.length?(yl(e.log.hostname,"log.hostname"),d=e.log.hostname[0]):d=s[0];let h=6444;e.log&&e.log.port&&(t(e.log.port,"log.port"),h=e.log.port),sn("LOG_UPLOAD_SERVER","".concat(d,":").concat(h));let f=[];e.cds&&e.cds.hostname&&Array.isArray(e.cds.hostname)&&e.cds.hostname.length?(yl(e.cds.hostname,"cds.hostname"),f=e.cds.hostname):f=s;let g=443;e.cds&&e.cds.port&&(t(e.cds.port,"cds.port"),g=e.cds.port),sn("CDS_AP",f.map((E=>"".concat(E,":").concat(g)))),e.cds?sn("ENABLE_CONFIG_DISTRIBUTE",!0):sn("ENABLE_CONFIG_DISTRIBUTE",!1),w.info("set local access point v2 success")}setLocalAccessPoints(e,t){if(yl(e,"serverList"),kr(t,"domain"),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new le(V.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");const n=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;e=e.map((r=>n.test(r)?"".concat(r.replace(/\./g,"-"),".").concat(t):r)),this._useLocalAccessPoint=!0,this._setLocalAPVersion=1,sn("WEBCS_DOMAIN",e),sn("WEBCS_DOMAIN_BACKUP_LIST",e),sn("GATEWAY_DOMAINS",[t]),sn("EVENT_REPORT_DOMAIN",e[0]),sn("EVENT_REPORT_BACKUP_DOMAIN",e[1]||e[0]),sn("LOG_UPLOAD_SERVER","".concat(e[0],":6444")),w.info("[".concat(this._clientId,"] set local access point success"))}async setRemoteDefaultVideoStreamType(e){if(pr(e,"streamType",[0,1,4,5,6,7,8,9]),this._remoteDefaultVideoStreamType=e,this._joinInfo)try{await this._gateway.setDefaultRemoteVideoStreamType(e),this._joinInfo.defaultVideoStream=this._remoteDefaultVideoStreamType}catch(t){throw w.error("[".concat(this._clientId,"] set default remote video stream type error"),t.toString()),t}else w.debug("[".concat(this._clientId,"] haven't joined yet, cache remoteDefaultVideoStreamType ").concat(e))}async setRemoteVideoStreamType(e,t){pr(t,"streamType",[0,1,4,5,6,7,8,9]);try{await this._gateway.setRemoteVideoStreamType(e,t),setTimeout((()=>{const n=this._users.find((r=>r.uid===e));n&&n.videoTrack&&n.videoTrack.updateMediaStreamTrackResolution()}),2e3)}catch(n){throw w.error("[".concat(this._clientId,"] set remote video stream type error"),n.toString()),n}w.info("[".concat(this._clientId,"] set remote ").concat(e," video stream type to ").concat(t)),this._remoteStreamTypeCacheMap.set(e,t)}async setStreamFallbackOption(e,t){pr(t,"fallbackType",[0,1,2,3,4,5,6,7,8]);try{await this._gateway.setStreamFallbackOption(e,t)}catch(n){throw w.error("[".concat(this._clientId,"] set stream fallback option"),n.toString()),n}w.info("[".concat(this._clientId,"] set remote ").concat(e," stream fallback type to ").concat(t)),this._streamFallbackTypeCacheMap.set(e,t)}setEncryptionConfig(e,t,n,r){(function(s){pr(s,"encryptionMode",["aes-128-xts","aes-256-xts","aes-128-ecb","sm4-128-ecb","aes-128-gcm","aes-256-gcm","aes-128-gcm2","aes-256-gcm2","none"])})(e),kr(t,"secret");const i=["aes-128-gcm2","aes-256-gcm2"];if(be(i).call(i,e)){if(!n||!(n instanceof Uint8Array&&n.length===32))throw new le(V.INVALID_PARAMS,"salt must be an Uint8Array and exactly equal to 32 bytes")}else if(n)throw new le(V.INVALID_PARAMS,"current encrypt mode does not need salt");if(r){if(wa(r,"encryptDataStream"),!be(i).call(i,e))throw new le(V.INVALID_PARAMS,"current encrypt mode does not support data stream");this._encryptDataStream=!0}new RegExp(`^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*,.<>?/:;'"|{}\\[\\]])(?=.{8,})`).test(t)||w.warning(`The secret is not strong:
      The secret must contain at least 1 lowercase alphabetical character,
      The secret must contain at least 1 uppercase alphabetical character,
      The secret must contain at least 1 numeric character,
      The secret must contain at least one special character,
      The secret must be eight characters or longer.
      `),this._encryptionMode=e,this._encryptionSecret=t,n&&(this._encryptionSalt=Ad(n))}async renewToken(e){if(kr(e,"token",1,2047),!this._key||!this._joinInfo)throw new le(V.INVALID_OPERATION,"renewToken should not be called before user join");const t=this._key;this._key=e,this._joinInfo&&(this._joinInfo.token=e);const n=await this._renewTokenMutex.lock();try{if(B("USE_NEW_TOKEN")){w.debug("[".concat(this._clientId,"] start renew token with ticket from unilbs"));const r=await C7(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||rr);w.debug("[".concat(this._clientId,"] get ticket from unilbs success")),await this._gateway.renewToken({token:e,ticket:r})}else w.debug("[".concat(this._clientId,"] start renew token without ticket")),await this._gateway.renewToken({token:e});w.debug("[".concat(this._clientId,"] renewToken success"))}catch(r){throw this._key=t,this._joinInfo.token=t,w.error("[".concat(this._clientId,"] renewToken failed"),r.toString()),r}finally{n()}}enableAudioVolumeIndicator(){this._audioVolumeIndicationInterval?w.warning("you have already enabled audio volume indicator!"):this._audioVolumeIndicationInterval=window.setInterval((()=>{const e=this._p2pChannel.getAudioLevels();this.safeEmit(Ot.VOLUME_INDICATOR,e)}),B("AUDIO_VOLUME_INDICATION_INTERVAL")||2e3)}getRTCStats(){const e=this._statsCollector.getRTCStats(),t=this._gateway.getInChannelInfo();return e.Duration=Math.round(t.duration/1e3),e}async startLiveStreaming(e,t){if(!t){if(this.codec!=="h264")throw new le(V.LIVE_STREAMING_INVALID_RAW_STREAM,"raw streaming is only support h264");if(!this._p2pChannel.hasLocalMedia())throw new le(V.LIVE_STREAMING_INVALID_RAW_STREAM,"can not find stream to raw streaming")}if(this._liveRawStreamingClient&&this._liveRawStreamingClient.hasUrl(e)||this._liveTranscodeStreamingClient&&this._liveTranscodeStreamingClient.hasUrl(e))throw new le(V.LIVE_STREAMING_TASK_CONFLICT);const n=t?Sl.TRANSCODE:Sl.RAW;return this._createLiveStreamingClient(n).startLiveStreamingTask(e,n)}setLiveTranscoding(e){return this._createLiveStreamingClient(Sl.TRANSCODE).setTranscodingConfig(e)}async stopLiveStreaming(e){const t=[this._liveRawStreamingClient,this._liveTranscodeStreamingClient].filter((n=>n&&n.hasUrl(e)));if(!t.length)throw new le(V.INVALID_PARAMS,"can not find live streaming url to stop");await ke.all(t.map((n=>n&&n.stopLiveStreamingTask(e))))}async startChannelMediaRelay(e){B2(e),await this._createChannelMediaRelayClient().startChannelMediaRelay(e)}async updateChannelMediaRelay(e){B2(e),await this._createChannelMediaRelayClient().updateChannelMediaRelay(e)}async stopChannelMediaRelay(){await this._createChannelMediaRelayClient().stopChannelMediaRelay(),this._statsCollector.onStatsChanged&&(this._statsCollector.onStatsChanged=void 0)}sendAudioMetadata(e){this._p2pChannel instanceof gE&&this._p2pChannel.addAudioMetadata(e)}async sendStreamMessage(e){var t;let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!this._joinInfo)throw new le(V.INVALID_OPERATION,"can not send data stream, not joined");if((typeof e=="string"||e instanceof Uint8Array)&&(e={payload:e}),typeof e.payload=="string"){const i=new TextEncoder;e.payload=i.encode(e.payload)}let r=!1;if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&be(t=["aes-128-gcm2","aes-256-gcm2"]).call(t,this._encryptionMode)&&(r=!0,e.payload=await(async function(i,s,o){var c;const d=Yi(c=Array.from(o)).call(c,((A,N)=>A+N),0),h={serverTs:0,seq:zY++,length:o.length,checkSum:d},f=new Uint8Array(c1(d,2)),g=new ArrayBuffer(Vf),E=new DataView(g);E.setUint32(0,h.serverTs),E.setUint16(4,h.seq),E.setUint16(6,h.length),E.setUint16(8,h.checkSum);const S=16-o.length%16;o=r1(o,new Uint8Array(S));const O=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:i,tagLength:S1,additionalData:f},s,o);return r1(new Uint8Array(g),new Uint8Array(O))})(this._encryptDataStreamIv,this._encryptDataStreamKey,e.payload)),new Blob([e.payload]).size>1024)throw new le(V.INVALID_PARAMS,r?"encrypted stream message out of range.":"stream message out of range.");return this._gateway.signal.request(ot.DATA_STREAM,{payload:Ad(e.payload),syncWithAudio:e.syncWithAudio,sendTs:Date.now()-k7},!n)}sendMetadata(e){if(!this._joinInfo)throw new le(V.INVALID_OPERATION,"can not send metadata, not joined");if(new Blob([e]).size>1024)throw new le(V.METADATA_OUT_OF_RANGE);return this._gateway.signal.request(ot.SEND_METADATA,{session_id:this._joinInfo.sid,metadata:Ad(e)})}async sendCustomReportMessage(e){if(Array.isArray(e)||(e=[e]),e.forEach(t9),!this._joinInfo)throw new le(V.INVALID_OPERATION,"can not send custom report, not joined");await We.sendCustomReportMessage(this._joinInfo.sid,e)}getLocalAudioStats(){return this._statsCollector.getLocalAudioTrackStats()}getRemoteAudioStats(){return this._statsCollector.getRemoteAudioTrackStats()}getLocalVideoStats(){return this._statsCollector.getLocalVideoTrackStats()}getRemoteVideoStats(){return this._statsCollector.getRemoteVideoTrackStats()}getRemoteNetworkQuality(){const e=this._statsCollector.getRemoteNetworkQualityStats();if(B("DELETE_NEQ_AFTER_USER_LEAVE")){const t=this._users.map((n=>n.uid+""));Object.keys(e).forEach((n=>{be(t).call(t,n)||delete e[n]}))}return e}async pickSVCLayer(e,t){pr(t.spatialLayer,"spatialLayer",[0,1,2,3]),pr(t.temporalLayer,"temporalLayer",[0,1,2,3]);try{await this._gateway.pickSVCLayer(e,t)}catch(n){throw w.error("[".concat(this._clientId,"] pick SVC layer failed"),n.toString()),n}}async setRTMConfig(e){const{apRTM:t=!1,rtmFlag:n}=e;if(wa(t,"apRTM"),cn(n,"rtmFlag",0),this._rtmConfig.apRTM=t,this._rtmConfig.rtmFlag=n,w.debug("[".concat(this._clientId,"] setRTMconfig ").concat(JSON.stringify(e)," in ").concat(this.connectionState," state")),(this.connectionState==="CONNECTED"||this.connectionState==="RECONNECTING")&&this._joinInfo)return this._joinInfo.apRTM=t,this._joinInfo.rtmFlag=n,this._gateway.setRTM2Flag(n)}_reset(){if(w.debug("[".concat(this._clientId,"] reset client")),(function(e){const t=Qf.indexOf(e);t!==-1&&Qf.splice(t,1)})(this._clientId),this.store.hasStartJoinChannel=!1,this.store.isABTestSuccess=!1,this.store.autoSubscribe=!1,this._axiosCancelSource.cancel(),this._axiosCancelSource=ji.CancelToken.source(),this._streamFallbackTypeCacheMap=new Map,this._remoteStreamTypeCacheMap=new Map,this._configDistribute.stopGetConfigDistribute(),this._joinInfo&&pU(this._joinInfo),this._joinInfo=void 0,this._proxyServer=void 0,this._defaultStreamFallbackType=void 0,this._sessionId&&We.removeSid(this._sessionId),this._sessionId=null,this.store.sessionId=null,this.store.resetFirstVideoFrameDecoded(),this._statsCollector.reset(),this._key=void 0,this._appId=void 0,this._uid=void 0,this.store.uid=void 0,this._channelName=void 0,this._encryptionMode="none",this._encryptionSecret=null,this._encryptionSalt=null,this._encryptDataStreamKey=null,this._encryptDataStreamIv=null,this._pendingPublishedUsers=[],this._users.forEach((e=>{e._audioTrack&&e._audioTrack._destroy(),e._videoTrack&&e._videoTrack._destroy(),e._dataChannels&&(e._dataChannels.forEach((t=>t._close())),e._dataChannels.length=0)})),this._users=[],this._audioVolumeIndicationInterval&&(window.clearInterval(this._audioVolumeIndicationInterval),this._audioVolumeIndicationInterval=void 0),this._cloudProxyServerMode==="fallback"&&(this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled"),this._p2pChannel.reset(),this._publishMutex=new Jr("client-publish",this._clientId),this._subscribeMutex=new Jr("client-subscribe",this._clientId),this._networkQualityInterval&&(window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=void 0),this._liveRawStreamingClient&&(this._liveRawStreamingClient.terminate(),this._liveRawStreamingClient.removeAllListeners(),this._liveRawStreamingClient=void 0),this._liveTranscodeStreamingClient&&(this._liveTranscodeStreamingClient.terminate(),this._liveTranscodeStreamingClient.removeAllListeners(),this._liveTranscodeStreamingClient=void 0),this._channelMediaRelayClient&&(this._channelMediaRelayClient.dispose(),this._channelMediaRelayClient=void 0),this._inspect)try{this._inspect.close(),this._inspect=void 0}catch{}if(this._moderation)try{this.setImageModeration(!1)}catch{}}_startSession(e,t){var n;const r=e||Rh();e?w.debug("[".concat(this._clientId,"] new Session ").concat(r)):w.debug("[".concat(this._clientId,"] renewSession ").concat(this._sessionId," => ").concat(r));const i=e?"":this._sessionId||"";this._sessionId=r,this.store.sessionId=r,We.addSid(r);const s={lts:new Date().getTime(),mode:this.mode,buildFormat:1,stringUid:t?.stringUid||((n=this._joinInfo)===null||n===void 0?void 0:n.stringUid),channelProfile:this.mode==="live"?1:0,channelMode:0,isABTestSuccess:Number(this._configDistribute.isSuccess),lsid:i,clientRole:this.role==="audience"?2:1};We.sessionInit(this._sessionId,qo({cname:t.channel,appid:t.appId},s)),this._joinInfo&&(this._joinInfo.sid=r),this._gateway.joinInfo&&(this._gateway.joinInfo.sid=r)}async _publishHighStream(e){if(!this._joinInfo||this._uid===void 0)throw new le(V.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new le(V.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&B("FORCE_TURN")&&!B("TURN_ENABLE_TCP")&&!B("TURN_ENABLE_UDP"))throw new le(V.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");w.debug("[".concat(this._clientId,"] publish high stream"));try{const n=await this._p2pChannel.publish(e,this._isDualStreamEnabled,this._lowStreamParameter);if(this.store.useP2P){const r=(await n.next()).value;if(r){try{await this._gateway.sendExtensionMessage(Kn.PUBLISH,r,!0)}catch(i){throw n.throw(i),i}await n.next()}this._p2pChannel.reportPublishEvent(!0,null)}else{const r=(await n.next()).value;if(r){var t;let i;try{i=await this._gateway.publish(this._uid,r,!0)}catch(s){if(s.code!==V.DISCONNECT_P2P)throw n.throw(s),s}await n.next(((t=i)===null||t===void 0?void 0:t.ortc)||[])}this._p2pChannel.reportPublishEvent(!0,null);for(const i of e)i instanceof Sn&&i._encoderConfig&&this._gateway.setVideoProfile(i._encoderConfig).catch((s=>{w.debug("[".concat(this._clientId,"] stop setVideoProfile, because websocket is closed"))})),!i.muted&&i.enabled||await this._p2pChannel.muteLocalTrack(i)}}catch(n){if(this._p2pChannel.reportPublishEvent(!1,n?.code,e),n?.code===V.WS_ABORT)return;throw n}}async _publishLowStream(){if(!this._joinInfo||this._uid===void 0)throw new le(V.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new le(V.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));w.debug("[".concat(this._clientId,"] publish low stream"));const e=this._configDistribute.getLowStreamConfigDistribute();e&&e.bitrate&&(this._lowStreamParameter||(this._lowStreamParameter={width:160,height:120,framerate:15,bitrate:50}),this._lowStreamParameter&&this._lowStreamParameter.bitrate&&e.bitrate<this._lowStreamParameter.bitrate&&(this._lowStreamParameter.bitrate=e.bitrate));try{const n=await this._p2pChannel.publishLowStream(this._lowStreamParameter),r=(await n.next()).value;if(r){var t;let i;try{i=await this._gateway.publish(this._uid,r,!0)}catch(s){if(s.code!==V.DISCONNECT_P2P)throw n.throw(s),s}n.next(((t=i)===null||t===void 0?void 0:t.ortc)||[]),this._p2pChannel.reportPublishEvent(!0,null,void 0,!0)}}catch(n){if(this._p2pChannel.reportPublishEvent(!1,n?.code,void 0,!0),n?.code===V.WS_ABORT)return;throw n}}_createLiveStreamingClient(e){const t=()=>{if(!this._joinInfo||!this._appId)return new le(V.INVALID_OPERATION,"can not create live streaming client, please join channel first").throw();const n=(r={joinInfo:this._joinInfo,appId:this._appId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig},wl("LiveStreaming").create(r));var r;return n.onLiveStreamError=(i,s)=>{We.reportApiInvoke(this._sessionId,{name:Gn.ON_LIVE_STREAM_ERROR,options:[i,s],tag:Nn.TRACER}).onSuccess(),this.safeEmit(Ot.LIVE_STREAMING_ERROR,i,s)},n.onLiveStreamWarning=(i,s)=>{We.reportApiInvoke(this._sessionId,{name:Gn.ON_LIVE_STREAM_WARNING,options:[i,s],tag:Nn.TRACER}).onSuccess(),this.safeEmit(Ot.LIVE_STREAMING_WARNING,i,s)},n.on(iI.REQUEST_WORKER_MANAGER_LIST,((i,s,o)=>{if(!this._joinInfo)return o(new le(V.INVALID_OPERATION,"can not find join info to get worker manager"));(async function(c,d,h,f){const g=B("UAP_AP").slice(0,B("AJAX_REQUEST_CONCURRENT")).map((E=>d.proxyServer?"https://".concat(d.proxyServer,"/ap/?url=").concat(E+"/api/v1?action=uap"):"https://".concat(E,"/api/v1?action=uap")));return await E7(g,c,d,h,f)})(i,this._joinInfo,this._axiosCancelSource.token,rr).then(s).catch(o)})),n};return e===Sl.RAW?(this._liveRawStreamingClient=this._liveRawStreamingClient||t(),this._liveRawStreamingClient):(this._liveTranscodeStreamingClient=this._liveTranscodeStreamingClient||t(),this._liveTranscodeStreamingClient)}_createChannelMediaRelayClient(){if(!this._joinInfo)return new le(V.INVALID_OPERATION,"can not create channel media relay client, please join channel first").throw();if(!this._channelMediaRelayClient){const{sendResolutionWidth:t,sendResolutionHeight:n}=this.getLocalVideoStats(),r=(e={joinInfo:this._joinInfo,clientId:this._clientId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig,resolution:{width:t,height:n}},wl("ChannelMediaRelay").create(e));r.on("state",(i=>{i===ts.RELAY_STATE_FAILURE&&r&&r.dispose(),this.safeEmit(Ot.CHANNEL_MEDIA_RELAY_STATE,i)})),r.on("event",(i=>{this.safeEmit(Ot.CHANNEL_MEDIA_RELAY_EVENT,i)})),this._channelMediaRelayClient=r,this._statsCollector.onStatsChanged=(i,s)=>{var o;i==="resolution"&&((o=this._channelMediaRelayClient)===null||o===void 0||o.setVideoProfile(s))}}var e;return this._channelMediaRelayClient}_handleUpdateDataChannel(e,t){const{added:n,deleted:r}=e,i=[];if(t){const s=[];this._users.forEach((o=>{o._dataChannels.forEach((c=>{n.every((d=>d.uid!==o._uintid||d.stream_id!==c.id))&&s.push({uid:o._uintid,stream_id:c.id,ordered:c.ordered,max_retrans_times:c.maxRetransmits,metadata:c.metadata})}))})),s.length>0&&this._handleUpdateDataChannel({added:[],deleted:s})}Array.isArray(n)&&n.length>0&&n.forEach((s=>{const{uid:o,stream_id:c,ordered:d,max_retrans_times:h,metadata:f}=s,g=this._users.find((E=>E._uintid===o));if(!g)return void w.error("[".concat(this._clientId,"] can not find target user!(on_add_data_channel)"));if(w.debug("[".concat(this._clientId,"] data_channel added with uid ").concat(o)),be(i).call(i,g)||i.push(g),g._uintid||(g._uintid=o),g._dataChannels.findIndex((E=>E.id===s.stream_id))===-1){const E={id:c,ordered:!!d,maxRetransmits:h,metadata:f},S=(function(O){return C2(O,!0)})(E);g._dataChannels.push(S),w.info("[".concat(this._clientId,"] remote user ").concat(g.uid," published datachannel")),t||this.safeEmit(Ot.USER_PUBLISHED,g,"datachannel",E)}this._p2pChannel.hasPendingRemoteDataChannel(g,s.stream_id)&&(w.debug("[".concat(this._clientId,"] resubscribe datachannel for user ").concat(g.uid," after reconnect.")),this._subscribeDataChannel(g,s.stream_id).catch((E=>{w.error("[".concat(this._clientId,"] resubscribe datachannel error"),E.toString())})))})),t&&(this.safeEmit(Ot.PUBLISHED_USER_LIST,this._pendingPublishedUsers),this._pendingPublishedUsers=[]),Array.isArray(r)&&r.length>0&&r.forEach((s=>{const{uid:o,stream_id:c}=s,d=this._users.find((f=>f._uintid===o));if(!d)return void w.error("[".concat(this._clientId,"] can not find target user!(on_delete_data_channel)"));const h=d._dataChannels.find((f=>f.id===s.stream_id));h&&(w.debug("[".concat(this._clientId,"] data_stream delete with uid ").concat(o)),this._p2pChannel.unsubscribeDataChannel(d,[h]).then((f=>{if(d._dataChannels=d._dataChannels.filter((g=>g!==h)),f)return this._gateway.unsubscribeDataChannel(f,d.uid)})),w.info("[".concat(this._clientId,"] remote user ").concat(o," unpublished datachannel ,id:").concat(h.id)),this.safeEmit(Ot.USER_UNPUBLISHED,d,"datachannel",h._config))}))}_getEncodingName(e){var t;if(!this._joinResponse)return;const n=(t=this._joinResponse.ortc.rtpCapabilities.sendrecv)===null||t===void 0?void 0:t.videoCodecs;if(n)for(const i of n){var r;if(i.payloadType===e)return i==null||(r=i.rtpMap)===null||r===void 0?void 0:r.encodingName}}_handleRemoveDataChannels(e){const t=this._users.find((n=>n.uid===e.uid));if(t){if(t._dataChannels!==void 0&&t._dataChannels.length>0){w.debug("[".concat(this._clientId,"] datachannel removed with uid ").concat(e.uid));const n=()=>{w.info("[".concat(this._clientId,"] remote user ").concat(t.uid," unpublished datachannel")),t._dataChannels.forEach((r=>{this.safeEmit(Ot.USER_UNPUBLISHED,t,"datachannel",r._config)}))};this._p2pChannel.unsubscribeDataChannel(t,t._dataChannels).then((r=>{if(r)return this._gateway.unsubscribeDataChannel(r,t.uid)})),n()}}else w.warning("[".concat(this._clientId,"] can not find target user!(on_remove_datachannel)"))}_handleGatewayEvents(){this._gateway.on(wr.UPDATE_GATEWAY_CONFIG,(()=>{(function(){let e;try{e=window.localStorage.getItem("websdk_ng_global_parameter")}catch(t){return void w.error("Error loading sdk config",t.message)}if(e)try{const t=JSON.parse(window.atob(e)),n=Date.now();Object.keys(t).forEach((r=>{const{value:i,type:s,expires:o}=t[r];o&&o<=n||s||Qb()||!Object.prototype.hasOwnProperty.call(XS,r)||(ba[r]=i,bn[r]=i,w.debug("Update gateway parameters from config distribute",r,i))}))}catch(t){w.error("Error update config from local cache",t.message)}})()})),this._gateway.on(wr.DISCONNECT_P2P,(async()=>{await this._p2pChannel.disconnectForReconnect()})),this._gateway.on(wr.CONNECTION_STATE_CHANGE,((e,t,n)=>{var r;if(n===$t.FALLBACK)return;const i=()=>{this.safeEmit(Ot.CONNECTION_STATE_CHANGE,e,t,n)};if(We.reportApiInvoke(this._sessionId||((r=this._gateway.joinInfo)===null||r===void 0?void 0:r.sid)||null,{name:Gn.CONNECTION_STATE_CHANGE,options:[e,t,n],tag:Nn.TRACER}).onSuccess(JSON.stringify({cur:e,prev:t,reason:n})),w.info("[".concat(this._clientId,"] signal connection state change: ").concat(t," -> ").concat(e)),e==="DISCONNECTED")return this._reset(),void i();if(e==="RECONNECTING")this._users.forEach((o=>{o._trust_in_room_=!1,o._trust_audio_enabled_state_=!1,o._trust_video_enabled_state_=!1,o._trust_audio_mute_state_=!1,o._trust_video_mute_state_=!1,o._trust_audio_stream_added_state_=!1,o._trust_video_stream_added_state_=!1,o._is_pre_created||(o._audio_pre_subscribed||(o._audioSSRC=void 0,o._audioOrtc=void 0),o._video_pre_subscribed||(o._videoSSRC=void 0,o._videoOrtc=void 0,o._rtxSsrcId=void 0),o._cname=void 0)})),this._userOfflineTimeout&&window.clearTimeout(this._userOfflineTimeout),this._streamRemovedTimeout&&window.clearTimeout(this._streamRemovedTimeout),this._userOfflineTimeout=void 0,this._streamRemovedTimeout=void 0;else if(e==="CONNECTED"){var s;this._streamFallbackTypeCacheMap.forEach(((o,c)=>{this._gateway.setStreamFallbackOption(c,o).catch((d=>{w.warning("[".concat(this._clientId,"] auto set stream fallback option failed"),d)}))})),this._remoteStreamTypeCacheMap.forEach(((o,c)=>{this._gateway.setRemoteVideoStreamType(c,o).catch((d=>{w.warning("[".concat(this._clientId,"] auto set remote stream type failed"),d)}))})),this._remoteDefaultVideoStreamType!==void 0&&((s=this._joinInfo)===null||s===void 0?void 0:s.defaultVideoStream)===void 0&&this.setRemoteDefaultVideoStreamType(this._remoteDefaultVideoStreamType).then((()=>{w.debug("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway connected"))})).catch((o=>{w.error("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway failed, ").concat(o))})),this.store.useP2P||(this._p2pChannel.republish(),this._userOfflineTimeout=window.setTimeout((()=>{this.connectionState==="CONNECTED"&&(this._userOfflineTimeout=void 0,this._users.filter((o=>!o._trust_in_room_)).forEach((o=>{w.debug("[".concat(this._clientId,"] user offline timeout, emit user offline ").concat(o.uid)),this._handleUserOffline({uid:o.uid})})))}),3e3),this._streamRemovedTimeout=window.setTimeout((()=>{this.connectionState==="CONNECTED"&&(this._streamRemovedTimeout=void 0,this._users.forEach((o=>{o._trust_audio_mute_state_||(w.debug("[".concat(this._clientId,"] auto dispatch audio unmute event ").concat(o.uid)),this._handleMuteStream(o.uid,Me.AUDIO,!1)),o._trust_video_mute_state_||(w.debug("[".concat(this._clientId,"] auto dispatch video unmute event ").concat(o.uid)),this._handleMuteStream(o.uid,Me.VIDEO,!1)),o._trust_audio_enabled_state_||(w.debug("[".concat(this._clientId,"] auto dispatch enable local audio ").concat(o.uid)),this._handleSetStreamLocalEnable("audio",o.uid,!0)),o._trust_video_enabled_state_||(w.debug("[".concat(this._clientId,"] auto dispatch enable local video ").concat(o.uid)),this._handleSetStreamLocalEnable("video",o.uid,!0)),o._trust_video_stream_added_state_||(w.debug("[".concat(this._clientId,"] auto dispatch reset video stream added ").concat(o.uid)),this._handleResetAddStream(o,"video")),o._trust_audio_stream_added_state_||(w.debug("[".concat(this._clientId,"] auto dispatch reset audio stream added ").concat(o.uid)),this._handleResetAddStream(o,"audio")),o._video_added_||o._audio_added_||(w.debug("[".concat(this._clientId,"] auto dispatch stream remove ").concat(o.uid)),this._handleRemoveStream({uid:o.uid,uint_id:o._uintid}))})))}),1e3))}i()})),this._gateway.on(wr.REQUEST_NEW_GATEWAY_LIST,(async(e,t)=>{if(!this._joinInfo)return t(new le(V.UNEXPECTED_ERROR,"can not recover, no join info"));try{let n;const r=await uU(qo(qo({},this._joinInfo),{},{uid:this._joinInfo.uid,stringUid:void 0}));r?(n=r.ap,fU(r),this._joinInfo.preload=!0):(n=await yI(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||rr,this.store),this._joinInfo.preload=!1),this._joinInfo&&(this._joinInfo.apResponse=n.gatewayInfo.res,this._joinInfo.gatewayAddrs=n.gatewayInfo.gatewayAddrs,this._joinInfo.uni_lbs_ip=n.gatewayInfo.uni_lbs_ip);const i=[];n.gatewayInfo.gatewayAddrs.forEach((s=>{let{address:o}=s;const[c,d]=o.split(":");this._joinInfo&&this._joinInfo.proxyServer?i.push({proxy:this._joinInfo.proxyServer,host:c,port:d}):i.push({host:c,port:d})})),e(i)}catch(n){t(n)}})),this._gateway.on(wr.NETWORK_QUALITY,(e=>{this._networkQualitySensitivity==="normal"&&this.safeEmit(Ot.NETWORK_QUALITY,e)})),this._gateway.on(wr.STREAM_TYPE_CHANGE,((e,t)=>{this.safeEmit(Ot.STREAM_TYPE_CHANGED,e,t),We.reportApiInvoke(this._sessionId,{name:Gn.STREAM_TYPE_CHANGE,options:[e,t],tag:Nn.TRACER}).onSuccess(JSON.stringify({uid:e,streamType:t}))})),this._gateway.isPreSub=()=>"isPreSub"in this._p2pChannel&&this._p2pChannel.isPreSub(),this._gateway.isPreallocation=()=>"isPreallocation"in this._p2pChannel&&this._p2pChannel.isPreallocation(),this._gateway.on(wr.IS_P2P_DISCONNECTED,(e=>{this._p2pChannel.isP2PDisconnected()?e(!0):this._p2pChannel.hasLocalMedia()||this._p2pChannel.hasRemoteMedia()?e(!1):e(!0)})),this._gateway.on(wr.REQUEST_P2P_CONNECTION_PARAMS,(async(e,t,n)=>{try{let r=await this._p2pChannel.getEstablishParams();r&&"isPreallocation"in this._p2pChannel&&this._p2pChannel.isPreallocation()||(r=await this._p2pChannel.startP2PConnection(e)),t(r)}catch(r){n(r)}})),this._gateway.on(wr.JOIN_RESPONSE,((e,t)=>{if(this.store.useP2P)return;let n;this._joinResponse=e,e.attributes?n=e.attributes.userAttributes.preSubSsrcs:w.debug("no attributes in joinResponse");const r=p2(e.ortc,t,n);this._p2pChannel.connect(r)})),this._gateway.on(wr.PRE_CONNECT_PC,(async e=>{const{candidates:t,fingerprint:n,turnServer:r}=e;if(this._joinInfo&&t.length>0&&!this._p2pChannel.isPlanB){const{cert:s,cid:o}=this._joinInfo.apResponse,c="".concat(o,"_").concat(s);if(c.length<4||c.length>256)return;await this._p2pChannel.startP2PConnection({turnServer:r,cloudProxyServer:this._joinInfo.cloudProxyServer,isPreallocation:!0});try{var i;await this._p2pChannel.connect({iceParameters:{iceUfrag:"".concat(o,"_").concat(s),icePwd:"".concat(o,"_").concat(s)},dtlsParameters:{fingerprints:[{hashFunction:"sha-256",fingerprint:(i=B("FINGERPRINT"))!==null&&i!==void 0?i:n}]},candidates:t,rtpCapabilities:{send:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},recv:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]}},setup:"active",cname:"o/i14u9pJrxRKAsu",preallocation:!0})}catch(d){d.code&&d.code===V.EXCHANGE_SDP_FAILED&&await this._p2pChannel.startP2PConnection({turnServer:r,cloudProxyServer:this._joinInfo.cloudProxyServer},!0)}}}))}_handleGatewaySignalEvents(){this._gateway.signal.on(Dt.ON_USER_ONLINE,this._handleUserOnline),this._gateway.signal.on(Dt.ON_USER_OFFLINE,this._handleUserOffline),this._gateway.signal.on(Dt.ON_ADD_AUDIO_STREAM,(e=>this._handleAddAudioOrVideoStream("audio",e.uid,e.ssrcId,e.cname,e.pt,e.uint_id,e.ortc))),this._gateway.signal.on(Dt.ON_ADD_VIDEO_STREAM,(e=>this._handleAddAudioOrVideoStream("video",e.uid,e.ssrcId,e.cname,e.pt,e.uint_id,e.ortc,e.rtxSsrcId))),this._gateway.signal.on(Dt.ON_REMOTE_DATASTREAM_UPDATE,(e=>{this._handleUpdateDataChannel(e)})),this._gateway.signal.on(Dt.ON_REMOTE_FULL_DATASTREAM_INFO,(e=>{this._handleUpdateDataChannel({added:e.datastreams||[],deleted:[]},!0)})),this._gateway.signal.on(Dt.ON_REMOVE_STREAM,this._handleRemoveStream),this._gateway.signal.on(Dt.ON_P2P_LOST,this._handleP2PLost),this._gateway.signal.on(Dt.MUTE_AUDIO,(e=>this._handleMuteStream(e.uid,Me.AUDIO,!0))),this._gateway.signal.on(Dt.UNMUTE_AUDIO,(e=>this._handleMuteStream(e.uid,Me.AUDIO,!1))),this._gateway.signal.on(Dt.MUTE_VIDEO,(e=>this._handleMuteStream(e.uid,Me.VIDEO,!0))),this._gateway.signal.on(Dt.UNMUTE_VIDEO,(e=>this._handleMuteStream(e.uid,Me.VIDEO,!1))),this._gateway.signal.on(Dt.RECEIVE_METADATA,(e=>{const t=Th(e.metadata);this.safeEmit(Ot.RECEIVE_METADATA,e.uid,t)})),this._gateway.signal.on(Dt.ON_DATA_STREAM,(async e=>{var t;if(!e)return;let n=Th(e.payload);if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&be(t=["aes-128-gcm2","aes-256-gcm2"]).call(t,this._encryptionMode)){if(e.payload.length<Vf)throw new le(V.UNEXPECTED_RESPONSE,"payload length ".concat(e.payload.length," is less than header length ").concat(Vf));n=await(async function(s,o,c){const d=c.subarray(0,Vf),h=d.slice(8,Vf),f=(h[0]<<8)+h[1],g=(d[6]<<8)+d[7],E=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:s,tagLength:S1,additionalData:new Uint8Array(c1(f,2))},o,c.subarray(Vf));return new Uint8Array(E).subarray(0,g)})(this._encryptDataStreamIv,this._encryptDataStreamKey,n)}let r=0;if(e.ordered||e.syncWithAudio){const i=this._p2pChannel.getStats(),s=this.remoteUsers.find((c=>c.uid===e.uid)),o=i?.audioRecv.find((c=>c.ssrc===s?._audioSSRC));r=o?.jitterBufferMs}(r==null||Number.isNaN(r))&&(r=0),L7(qo(qo({},e),{},{payload:n}),r,{id:this._clientId,onStreamMessage:typeof this.onStreamMessage=="function"?this.onStreamMessage.bind(this):void 0,safeEmit:this.safeEmit.bind(this)})})),this._gateway.signal.on(Dt.ON_CRYPT_ERROR,(()=>{Id((()=>{w.warning("[".concat(this._clientId,"] on crypt error")),this.safeEmit(Ot.CRYPT_ERROR)}),this._sessionId)})),this._gateway.signal.on(Dt.ON_TOKEN_PRIVILEGE_WILL_EXPIRE,this._handleTokenWillExpire),this._gateway.signal.on(Dt.ON_TOKEN_PRIVILEGE_DID_EXPIRE,(()=>{w.warning("[".concat(this._clientId,"] received message onTokenPrivilegeDidExpire, please get new token and join again")),this._gateway.leave(!0,$t.TOKEN_EXPIRE),this.safeEmit(Ot.ON_TOKEN_PRIVILEGE_DID_EXPIRE),this._reset()})),this._gateway.signal.on(Dt.ON_STREAM_FALLBACK_UPDATE,(e=>{w.debug("[".concat(this._clientId,"] stream fallback peerId: ").concat(e.stream_id,", attr: ").concat(e.stream_type)),this.safeEmit(Ot.STREAM_FALLBACK,e.stream_id,e.stream_type===1?"fallback":"recover")})),this._gateway.signal.on(Dt.ON_PUBLISH_STREAM,(e=>{this.uid===this._uid&&(this._p2pChannel.reportPublishEvent(!0,null,void 0,!1,JSON.stringify({proxy:e.proxy})),w.info("[".concat(this._clientId,"] on publish stream, ").concat(JSON.stringify(e))))})),this._gateway.signal.on(Dt.ENABLE_LOCAL_VIDEO,(e=>{this._handleSetStreamLocalEnable("video",e.uid,!0)})),this._gateway.signal.on(Dt.DISABLE_LOCAL_VIDEO,(e=>{this._handleSetStreamLocalEnable("video",e.uid,!1)})),this._gateway.signal.on(ct.REQUEST_TIMEOUT,((e,t)=>{if(this._joinInfo)switch(e){case ot.PUBLISH:{if(!t)return;const i=t.ortc;if(i){var n,r;const s=i.some((d=>{let{stream_type:h}=d;return h===tn.Audio})),o=i.some((d=>{let{stream_type:h}=d;return h!==tn.Audio})),c=i.some((d=>{let{stream_type:h}=d;return h===tn.Screen||h===tn.ScreenLow}));t.state==="offer"&&We.publish(this._joinInfo.sid,{eventElapse:ei.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:!1,ec:V.TIMEOUT,audio:s,video:o,p2pid:t.p2p_id,publishRequestid:this.store.pubId,screenshare:c,audioName:s?(n=i.find((d=>{let{stream_type:h}=d;return h===tn.Audio})))===null||n===void 0||(n=n.ssrcs[0])===null||n===void 0?void 0:n.ssrcId.toString():void 0,videoName:o?(r=i.find((d=>{let{stream_type:h}=d;return h!==tn.Audio})))===null||r===void 0||(r=r.ssrcs[0])===null||r===void 0?void 0:r.ssrcId.toString():void 0})}break}case ot.SUBSCRIBE:t&&We.subscribe(this._joinInfo.sid,{succ:!1,ec:V.TIMEOUT,audio:t.stream_type===Me.AUDIO,video:t.stream_type===Me.VIDEO,peerid:t.stream_id,subscribeRequestid:t.ssrcId,p2pid:this.store.p2pId,eventElapse:ei.measureFromSubscribeStart(this.store.clientId,t.ssrcId),preSsrc:this._p2pChannel.isPreSubScribe(t.ssrcId)})}})),this._gateway.signal.on(Dt.ON_P2P_OK,(e=>{this.uid,this._uid})),this._gateway.signal.on(Dt.ON_PUBLISHED_USER_LIST,(e=>{if(e==null||!e.users)return;B("BLOCK_LOCAL_CLIENT")&&(e.users=e.users.filter((r=>!Ph(r.string_id||r.stream_id,this.channelName))));const t=[],n=[];for(const r of e.users){let i=this._users.find((f=>f._uintid===r.stream_id));i?i._trust_in_room_=!0:(i=new Vd(r.string_id||r.stream_id,r.stream_id),this._users.push(i),this.store.firstVideoFrameDecoded(i.uid,{userJoinNotify:Date.now()}),this.getListeners(Ot.PUBLISHED_USER_LIST).length===0&&(w.debug("[".concat(this._clientId,"] user online"),r.stream_id),this.safeEmit(Ot.USER_JOINED,i)));const s=vr.Audio&r.stream_type,o=(vr.Video|vr.LwoVideo)&r.stream_type,c=(65280&r.stream_type)!=0,d=s&&i.hasAudio,h=o&&i.hasVideo;o&&(i._trust_video_stream_added_state_=!0,i._video_added_=!0,i._videoSSRC=r.video_ssrc,i._rtxSsrcId=r.video_rtx),s&&(i._trust_audio_stream_added_state_=!0,i._audio_added_=!0,i._audioSSRC=r.audio_ssrc),s&&!d&&this.getListeners(Ot.PUBLISHED_USER_LIST).length===0&&(w.info("[".concat(this._clientId,"] remote user ").concat(i.uid," published audio")),this.safeEmit(Ot.USER_PUBLISHED,i,"audio")),o&&!h&&this.getListeners(Ot.PUBLISHED_USER_LIST).length===0&&(w.info("[".concat(this._clientId,"] remote user ").concat(i.uid," published video")),this.safeEmit(Ot.USER_PUBLISHED,i,"video")),(s&&!d||o&&!h||c)&&t.push(i),o&&this._p2pChannel.hasPendingRemoteMedia(i,"video")&&n.push({user:i,mediaType:"video"}),s&&this._p2pChannel.hasPendingRemoteMedia(i,"audio")&&n.push({user:i,mediaType:"audio"})}n.length>0&&(w.debug("[".concat(this._clientId,"] RE massSubscribe after reconnect ").concat(n.map((r=>"user: ".concat(r.user.uid,", mediaType: ").concat(r.mediaType))).join("; ")," ")),this.massSubscribe(n).catch((r=>{w.error("[".concat(this._clientId,"] mass resubscribe error"),r.toString())}))),this.getListeners(Ot.PUBLISHED_USER_LIST).length>0?B("ENABLE_DATASTREAM_2")?this._pendingPublishedUsers=t:(w.info("[".concat(this._clientId,"] client emit user-list event, users: ").concat(t.map((r=>r.uid)).join(", "))),this.safeEmit(Ot.PUBLISHED_USER_LIST,t)):w.info("[".concat(this._clientId,"] client not emit user-list event case there is no user-list listener, users: ").concat(t.map((r=>r.uid)).join(", ")))})),this._gateway.signal.on(Dt.ON_RTP_CAPABILITY_CHANGE,(e=>{const{video_codec:t}=e;this._p2pChannel instanceof gE&&this._p2pChannel.updateRemoteRTPCapabilities(t.map((n=>n.toLowerCase())).filter((n=>{var r;return be(r=Object.keys(eE)).call(r,n)})))}))}_handleP2PEvents(){this._gateway.signal.on(Dt.ON_USER_OFFLINE,(()=>{this._p2pChannel.disconnectForReconnect()})),this._gateway.signal.on(Kn.PUBLISH,((e,t,n)=>{const{uid:r}=e;e.forEach((i=>{const{kind:s,ssrcs:o,mid:c,isMuted:d}=i;this._handleP2PAddAudioOrVideoStream(s,r,o[0].ssrcId,c);const h=this._users.find((f=>f.uid===r));return h&&this.store.useP2P?this._p2pChannel.mockSubscribe(h,s,o[0].ssrcId,c).then((()=>{t()})).catch(n):t(),this._handleMuteStream(r,s,!!d)}))})),this._gateway.signal.on(Kn.CALL,(async(e,t,n)=>{if(this.store.useP2P)try{var r;t(await this._p2pChannel.startP2P({turnServer:(r=this._joinInfo)===null||r===void 0?void 0:r.turnServer},e))}catch(i){n(i)}})),this._gateway.signal.on(ct.P2P_CONNECTION,(async e=>{this.store.useP2P&&(await this._p2pChannel).p2pConnect(e)})),this._gateway.signal.on(Kn.UNPUBLISH,(async(e,t,n)=>{if(this.store.useP2P){const{unpubMsg:r,uid:i}=e,s=this._users.find((o=>o.uid===i));if(!s)return w.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(i)),void t();try{r.forEach((async o=>{let{stream_type:c}=o;const d=c===tn.Audio?Me.AUDIO:Me.VIDEO;await this._p2pChannel.unsubscribe(s,d),this._handleMuteStream(i,d,!0)})),t()}catch(o){n(o)}}})),this._gateway.signal.on(Kn.CONTROL,(async(e,t)=>{const{action:n}=e;switch(n){case Dd.MUTE_LOCAL_VIDEO:this._handleMuteStream(t,Me.VIDEO,!0);break;case Dd.MUTE_LOCAL_AUDIO:this._handleMuteStream(t,Me.AUDIO,!0);break;case Dd.UNMUTE_LOCAL_VIDEO:this._handleP2PAddAudioOrVideoStream("video",t),this._handleMuteStream(t,Me.VIDEO,!1);break;case Dd.UNMUTE_LOCAL_AUDIO:this._handleP2PAddAudioOrVideoStream("audio",t),this._handleMuteStream(t,Me.AUDIO,!1)}})),this._gateway.signal.on(Kn.RESTART_ICE,(async(e,t,n)=>{if(this.store.useP2P)try{const{direction:r,iceParameter:i}=e;r!==Ai.SEND_ONLY||i?t(await this._p2pChannel.restartICE(r,i)):(this._p2pChannel.handleDisconnect(r),t())}catch(r){n(r)}})),this._gateway.signal.on(Kn.CANDIDATE,(e=>{if(this.store.useP2P){const{candidate:t,direction:n}=e;this._p2pChannel.addRemoteCandidate(t,n)}})),this._p2pChannel.on(Xe.RequestP2PRestartICE,(async(e,t,n)=>{try{const{direction:r}=e;t(await this._gateway.sendExtensionMessage(Kn.RESTART_ICE,e,r===Ai.SEND_ONLY))}catch(r){n(r)}})),this._p2pChannel.on(Xe.LocalCandidate,(e=>{this._gateway.sendExtensionMessage(Kn.CANDIDATE,JSON.stringify(e),!0)})),this._p2pChannel.on(Xe.RequestP2PMuteLocal,(async(e,t,n)=>{try{await this._gateway.sendExtensionMessage(Kn.CONTROL,e,!0),t()}catch(r){n(r)}})),this._p2pChannel.on(Xe.RequestP2PUnmuteRemote,(async(e,t,n)=>{if(this._joinInfo)try{await this._gateway.unmuteRemote(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(r){r.code===V.DISCONNECT_P2P?t():n(r)}else t()})),this._p2pChannel.on(Xe.RequestP2PMuteRemote,(async(e,t,n)=>{if(this._joinInfo)try{await this._gateway.muteRemote(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(r){r.code===V.DISCONNECT_P2P?t():n(r)}else t()})),this._p2pChannel.on(Xe.StateChange,((e,t)=>{t===en.Connected&&this._p2pChannel.republish()}))}_handleP2PChannelEvents(){this._p2pChannel.on(Xe.PeerConnectionStateChange,(e=>{const t=this._peerConnectionState;e!==t&&(this.safeEmit(Ot.PEERCONNECTION_STATE_CHANGE,e,t),this._peerConnectionState=e)})),this._p2pChannel.on(Xe.RequestMuteLocal,(async(e,t,n)=>{if(this._joinInfo)try{await this._gateway.muteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(r){r.code===V.DISCONNECT_P2P?t():n(r)}else t()})),this._p2pChannel.on(Xe.RequestUnmuteLocal,(async(e,t,n)=>{if(this._joinInfo)try{await this._gateway.unmuteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(r){r.code===V.DISCONNECT_P2P?t():n(r)}else t()})),this._p2pChannel.on(Xe.RequestRePublish,((e,t,n)=>{this.publish(e,!1).then(t).catch(n)})),this._p2pChannel.on(Xe.RequestRePublishDataChannel,((e,t,n)=>{ke.all(e.map((async r=>{const i=await this._p2pChannel.publishDataChannel([r]);try{i.forEach((s=>{this._uid&&this._gateway.publishDataChannel(this._uid,s,!0)}))}catch(s){if(s.code!==V.DISCONNECT_P2P)throw s}}))).then(t).catch(n)})),this._p2pChannel.on(Xe.RequestReSubscribe,(async(e,t,n)=>{try{for(const{user:r,kind:i}of e)i===Me.VIDEO?await this.subscribe(r,"video"):await this.subscribe(r,"audio");t()}catch(r){n(r)}})),this._p2pChannel.on(Xe.RequestUpload,((e,t)=>{this._gateway.upload(e,t)})),this._p2pChannel.on(Xe.RequestUploadStats,(e=>{this._gateway.uploadWRTCStats(e)})),this._p2pChannel.on(Xe.MediaReconnectStart,(e=>{this.safeEmit(Ot.MEDIA_RECONNECT_START,e)})),this._p2pChannel.on(Xe.MediaReconnectEnd,(e=>{this.safeEmit(Ot.MEDIA_RECONNECT_END,e)})),this._p2pChannel.on(Xe.NeedSignalRTT,(e=>{e(this._gateway.getSignalRTT())})),this._p2pChannel.on(Xe.RequestRestartICE,(async e=>{if(this.store.useP2P)return;const t=await this._p2pChannel.restartICE(e),n=await t.next();if(n.done)return;const r=n.value;let i;try{i=await this._gateway.restartICE({iceParameters:r})}catch(o){return void t.throw(o)}const{iceParameters:s}=(function(o){const c=o.iceParameters;return{iceParameters:{iceUfrag:c.iceUfrag,icePwd:c.icePwd}}})(i);await t.next({remoteIceParameters:s})})),this._p2pChannel.on(Xe.RequestReconnect,(async()=>{this._gateway.reconnect()})),this._p2pChannel.on(Xe.RequestReconnectPC,(async()=>{var e;const{iceParameters:t,dtlsParameters:n,rtpCapabilities:r}=await this._p2pChannel.startP2PConnection({turnServer:(e=this._joinInfo)===null||e===void 0?void 0:e.turnServer}),{gatewayEstablishParams:i,gatewayAddress:s}=await this._gateway.reconnectPC({iceParameters:t,dtlsParameters:n,rtpCapabilities:r}),o=p2(i,s);await this._p2pChannel.connect(o),await this._p2pChannel.republish(),await this._p2pChannel.reSubscribe()})),this._p2pChannel.on(Xe.RequestUnpublishForReconnectPC,(async(e,t,n)=>{this._joinInfo&&this._uid!==void 0?(await this._gateway.unpublish(e,this._uid),t()):n()})),this._p2pChannel.on(Xe.P2PLost,(()=>{this.safeEmit(Ot.P2P_LOST,this.store.uid)})),this._p2pChannel.on(Xe.UpdateVideoEncoder,(e=>{e._encoderConfig&&this._gateway.setVideoProfile(e._encoderConfig)})),this._p2pChannel.on(Xe.ConnectionTypeChange,(e=>{this.safeEmit(Ot.IS_USING_CLOUD_PROXY,e)})),this._p2pChannel.on(Xe.RequestLowStreamParameter,(e=>{e(this._lowStreamParameter||{width:160,height:120,framerate:15,bitrate:50})})),this._p2pChannel.on(Xe.QueryClientConnectionState,(e=>{e(this.connectionState)})),this._p2pChannel.on(Xe.AudioMetadata,(e=>{this.safeEmit(Ot.AUDIO_METADATA,e)})),this._p2pChannel.on(Xe.AudioPts,(e=>{this.safeEmit(Ot.AUDIO_PTS,Number(e))}))}getKeyMetrics(){return this.store.keyMetrics}async enableContentInspect(e){if(!this._joinInfo||this.connectionState!=="CONNECTED")throw new le(V.INVALID_OPERATION,"[".concat(this._clientId,"] can not create content inspect, please join channel first"));if(this._inspect)throw new le(V.INVALID_OPERATION,"[".concat(this._clientId,"] Inspect content service already in connecting/connected state"));try{const n=(t={config:e},wl("ContentInspect").create(t));this._inspect=n,this.handleVideoInspectEvents(n);const{appId:r,cname:i,sid:s,token:o,uid:c,cid:d,vid:h}=this._joinInfo;await n.init({appId:r,areaCode:"",cname:i,sid:s,token:o,uid:c,cid:d,vid:h?Number(h):0},rr)}catch(n){throw Array.isArray(n)?n[0]:n}var t}handleVideoInspectEvents(e){e.on(Cr.CONNECTION_STATE_CHANGE,((t,n)=>{if(this.safeEmit(Ot.CONTENT_INSPECT_CONNECTION_STATE_CHANGE,t,n),n===Ho.CONNECTED){if(this.connectionState!=="CONNECTED")return void this.safeEmit(Ot.CONTENT_INSPECT_ERROR,new le(V.OPERATION_ABORTED,"Content inspect was cancelled because it left the channel"));e.inspectImage()}})),e.on(Cr.INSPECT_RESULT,((t,n)=>{var r;if(n?.code===V.INVALID_OPERATION&&this.connectionState==="DISCONNECTED")return w.debug("Stop inspect content because that has left channel"),this==null||(r=this._inspect)===null||r===void 0||r.close(),void(this._inspect=void 0);this.safeEmit(Ot.CONTENT_INSPECT_RESULT,t,n)})),e.on(Cr.CLIENT_LOCAL_VIDEO_TRACK,(t=>{t(this.localTracks.filter((n=>n.trackMediaType==="video"))[0])}))}async disableContentInspect(){if(!this._inspect)throw new le(V.INVALID_OPERATION,"[".concat(this._clientId,"] inspectVideoContent not started"));try{this._inspect.close(),this._inspect=void 0}catch(e){throw Array.isArray(e)?e[0]:e}}async setImageModeration(e,t){if(wa(e,"enabled"),e){if(!t)throw new le(V.INVALID_PARAMS,"config is required");if(AU(t),!this._joinInfo)throw new le(V.INVALID_OPERATION,"can not create image moderation, please join channel first");try{if(this._moderation)this._moderation.updateConfig(t);else{const r=(n={config:t},wl("ImageModeration").create(n));this._moderation=r,this.handleImageModerationEvents(r);const{appId:i,cname:s,sid:o,token:c,uid:d,cid:h,vid:f}=this._joinInfo;await r.init({appId:i,areaCode:"",cname:s,sid:o,token:c,uid:d,cid:h,vid:f?Number(f):0},rr)}}catch(r){throw Array.isArray(r)?r[0]:r}}else{var n;if(!this._moderation)throw new le(V.INVALID_OPERATION,"[".concat(this._clientId,"] image moderation not started"));try{this._moderation.close(),this._moderation.removeAllListeners(),this._moderation=void 0}catch(r){throw Array.isArray(r)?r[0]:r}}}handleImageModerationEvents(e){e.on(Na.CONNECTION_STATE_CHANGE,((t,n)=>{if(this.safeEmit(Ot.IMAGE_MODERATION_CONNECTION_STATE_CHANGE,t,n),t===ao.CONNECTED){if(this.connectionState!=="CONNECTED")throw this.setImageModeration(!1),new le(V.OPERATION_ABORTED,"Image moderation was cancelled because it left the channel");e.inspectImage()}})),e.on(Na.CLIENT_LOCAL_VIDEO_TRACK,(t=>{t(this.localTracks.filter((n=>n.trackMediaType==="video"))[0])}))}setP2PTransport(e){if((function(t){pr(t,"transport",["default","auto","relay","sd-rtn"])})(e),this.mode!=="p2p")throw new le(V.INVALID_OPERATION,"only p2p mode can set p2pTransport");this.store.p2pTransport=e,w.info("[".concat(this._clientId,"] set client p2pTransport to ").concat(e))}getJoinChannelServiceRecords(){return w.debug("getJoinChannelServiceRecords"),this.store.joinChannelServiceRecords}async setPublishAudioFilterEnabled(e){wa(e,"enabled"),sn("ENABLE_PUBLISH_AUDIO_FILTER",e),this._joinInfo&&await this._gateway.setPublishAudioFilterEnabled(e)}_handleResetAddStream(e,t){switch(t){case"audio":e._audio_added_=!1,e._trust_audio_stream_added_state_=!0;break;case"video":e._video_added_=!1,e._trust_video_stream_added_state_=!0}}},Be(xe.prototype,"leave",[NU],Object.getOwnPropertyDescriptor(xe.prototype,"leave"),xe.prototype),Be(xe.prototype,"publish",[OU],Object.getOwnPropertyDescriptor(xe.prototype,"publish"),xe.prototype),Be(xe.prototype,"unpublish",[PU],Object.getOwnPropertyDescriptor(xe.prototype,"unpublish"),xe.prototype),Be(xe.prototype,"subscribe",[DU],Object.getOwnPropertyDescriptor(xe.prototype,"subscribe"),xe.prototype),Be(xe.prototype,"presubscribe",[kU],Object.getOwnPropertyDescriptor(xe.prototype,"presubscribe"),xe.prototype),Be(xe.prototype,"massSubscribe",[xU],Object.getOwnPropertyDescriptor(xe.prototype,"massSubscribe"),xe.prototype),Be(xe.prototype,"unsubscribe",[LU],Object.getOwnPropertyDescriptor(xe.prototype,"unsubscribe"),xe.prototype),Be(xe.prototype,"massUnsubscribe",[MU],Object.getOwnPropertyDescriptor(xe.prototype,"massUnsubscribe"),xe.prototype),Be(xe.prototype,"setLowStreamParameter",[UU],Object.getOwnPropertyDescriptor(xe.prototype,"setLowStreamParameter"),xe.prototype),Be(xe.prototype,"enableDualStream",[jU],Object.getOwnPropertyDescriptor(xe.prototype,"enableDualStream"),xe.prototype),Be(xe.prototype,"disableDualStream",[VU],Object.getOwnPropertyDescriptor(xe.prototype,"disableDualStream"),xe.prototype),Be(xe.prototype,"setClientRole",[FU],Object.getOwnPropertyDescriptor(xe.prototype,"setClientRole"),xe.prototype),Be(xe.prototype,"_setClientRoleOptions",[BU],Object.getOwnPropertyDescriptor(xe.prototype,"_setClientRoleOptions"),xe.prototype),Be(xe.prototype,"setProxyServer",[WU],Object.getOwnPropertyDescriptor(xe.prototype,"setProxyServer"),xe.prototype),Be(xe.prototype,"setTurnServer",[GU],Object.getOwnPropertyDescriptor(xe.prototype,"setTurnServer"),xe.prototype),Be(xe.prototype,"setLicense",[HU],Object.getOwnPropertyDescriptor(xe.prototype,"setLicense"),xe.prototype),Be(xe.prototype,"startProxyServer",[KU],Object.getOwnPropertyDescriptor(xe.prototype,"startProxyServer"),xe.prototype),Be(xe.prototype,"stopProxyServer",[zU],Object.getOwnPropertyDescriptor(xe.prototype,"stopProxyServer"),xe.prototype),Be(xe.prototype,"setLocalAccessPointsV2",[YU],Object.getOwnPropertyDescriptor(xe.prototype,"setLocalAccessPointsV2"),xe.prototype),Be(xe.prototype,"setLocalAccessPoints",[qU],Object.getOwnPropertyDescriptor(xe.prototype,"setLocalAccessPoints"),xe.prototype),Be(xe.prototype,"setRemoteDefaultVideoStreamType",[XU],Object.getOwnPropertyDescriptor(xe.prototype,"setRemoteDefaultVideoStreamType"),xe.prototype),Be(xe.prototype,"setRemoteVideoStreamType",[JU],Object.getOwnPropertyDescriptor(xe.prototype,"setRemoteVideoStreamType"),xe.prototype),Be(xe.prototype,"setStreamFallbackOption",[QU],Object.getOwnPropertyDescriptor(xe.prototype,"setStreamFallbackOption"),xe.prototype),Be(xe.prototype,"setEncryptionConfig",[ZU],Object.getOwnPropertyDescriptor(xe.prototype,"setEncryptionConfig"),xe.prototype),Be(xe.prototype,"renewToken",[$U],Object.getOwnPropertyDescriptor(xe.prototype,"renewToken"),xe.prototype),Be(xe.prototype,"enableAudioVolumeIndicator",[ej],Object.getOwnPropertyDescriptor(xe.prototype,"enableAudioVolumeIndicator"),xe.prototype),Be(xe.prototype,"startLiveStreaming",[tj],Object.getOwnPropertyDescriptor(xe.prototype,"startLiveStreaming"),xe.prototype),Be(xe.prototype,"setLiveTranscoding",[nj],Object.getOwnPropertyDescriptor(xe.prototype,"setLiveTranscoding"),xe.prototype),Be(xe.prototype,"stopLiveStreaming",[rj],Object.getOwnPropertyDescriptor(xe.prototype,"stopLiveStreaming"),xe.prototype),Be(xe.prototype,"startChannelMediaRelay",[ij],Object.getOwnPropertyDescriptor(xe.prototype,"startChannelMediaRelay"),xe.prototype),Be(xe.prototype,"updateChannelMediaRelay",[sj],Object.getOwnPropertyDescriptor(xe.prototype,"updateChannelMediaRelay"),xe.prototype),Be(xe.prototype,"stopChannelMediaRelay",[oj],Object.getOwnPropertyDescriptor(xe.prototype,"stopChannelMediaRelay"),xe.prototype),Be(xe.prototype,"sendCustomReportMessage",[aj],Object.getOwnPropertyDescriptor(xe.prototype,"sendCustomReportMessage"),xe.prototype),Be(xe.prototype,"pickSVCLayer",[cj],Object.getOwnPropertyDescriptor(xe.prototype,"pickSVCLayer"),xe.prototype),Be(xe.prototype,"setRTMConfig",[lj],Object.getOwnPropertyDescriptor(xe.prototype,"setRTMConfig"),xe.prototype),Be(xe.prototype,"enableContentInspect",[dj],Object.getOwnPropertyDescriptor(xe.prototype,"enableContentInspect"),xe.prototype),Be(xe.prototype,"disableContentInspect",[uj],Object.getOwnPropertyDescriptor(xe.prototype,"disableContentInspect"),xe.prototype),Be(xe.prototype,"setImageModeration",[hj],Object.getOwnPropertyDescriptor(xe.prototype,"setImageModeration"),xe.prototype),Be(xe.prototype,"setP2PTransport",[pj],Object.getOwnPropertyDescriptor(xe.prototype,"setP2PTransport"),xe.prototype),Be(xe.prototype,"getJoinChannelServiceRecords",[fj],Object.getOwnPropertyDescriptor(xe.prototype,"getJoinChannelServiceRecords"),xe.prototype),Be(xe.prototype,"setPublishAudioFilterEnabled",[mj],Object.getOwnPropertyDescriptor(xe.prototype,"setPublishAudioFilterEnabled"),xe.prototype),xe);class yE{constructor(t,n){x(this,"id",0),x(this,"element",void 0),x(this,"peerPair",void 0),x(this,"context",void 0),x(this,"audioPlayerElement",void 0),x(this,"audioTrack",void 0),yE.count+=1,this.id=yE.count,this.element=t,this.context=n}initPeers(){this.peerPair=[new RTCPeerConnection,new RTCPeerConnection],this.peerPair[1].ontrack=t=>{const n=document.createElement("audio");n.srcObject=new MediaStream([t.track]),n.play(),this.audioPlayerElement=n}}async switchSdp(){if(!this.peerPair)return;const t=async(r,i)=>{const s=i==="offer"?await r.createOffer():await r.createAnswer();return await r.setLocalDescription(s),r.iceGatheringState==="complete"?r.localDescription:new ke((o=>{r.onicegatheringstatechange=()=>{r.iceGatheringState==="complete"&&o(r.localDescription)}}))},n=async(r,i)=>await r.setRemoteDescription(i);try{const r=await t(this.peerPair[0],"offer");await n(this.peerPair[1],r);const i=await t(this.peerPair[1],"answer");await n(this.peerPair[0],i)}catch(r){throw new le(V.LOCAL_AEC_ERROR,r.toString()).print()}}async getTracksFromMediaElement(t){if(this.audioTrack)return this.audioTrack;let n;try{t instanceof HTMLVideoElement&&(t.captureStream?t.captureStream():t.mozCaptureStream()),n=this.context.createMediaStreamDestination(),this.context.createMediaElementSource(t).connect(n)}catch(i){throw new le(V.LOCAL_AEC_ERROR,i.toString()).print()}if(!n)throw new le(V.LOCAL_AEC_ERROR,"no dest node when local aec").print();const r=n.stream.getAudioTracks()[0];return this.audioTrack=r,r}getElement(){return this.element}async startEchoCancellation(){this.context.resume(),this.peerPair&&this.close(),this.initPeers();const t=this.element,n=await this.getTracksFromMediaElement(t);this.peerPair&&this.peerPair[0].addTrack(n),await this.switchSdp()}close(){w.debug("close echo cancellation unit, id is",this.id),this.audioPlayerElement&&this.audioPlayerElement.pause(),this.peerPair&&this.peerPair.forEach((t=>{t.close()})),this.peerPair=void 0,this.audioPlayerElement=void 0}}var gj,HT;x(yE,"count",0);const Q7=window.AudioContext||window.webkitAudioContext,Z7=new(gj=et({report:We}),Be((HT=class{constructor(){x(this,"units",[]),x(this,"context",void 0)}processExternalMediaAEC(e){if(!this._doesEnvironmentNeedAEC())return w.debug("the system does not need to process local aec"),-1;this.context||(this.context=new Q7);let t=this.units.find((n=>n&&n.getElement()===e));return t||(t=new yE(e,this.context),this.units.push(t)),t.startEchoCancellation(),w.debug("start processing local audio echo cancellation, id is",t.id),t.id}_doesEnvironmentNeedAEC(){return Mt().name!==Kt.SAFARI}}).prototype,"processExternalMediaAEC",[gj],Object.getOwnPropertyDescriptor(HT.prototype,"processExternalMediaAEC"),HT.prototype),HT);function Ej(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable}))),n.push.apply(n,r)}return n}function vj(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Ej(Object(n),!0).forEach((function(r){x(e,r,n[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ej(Object(n)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))}))}return e}const VI=window||document;function yj(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];if(!VI)return;const n=ir._cspEventHandlerPointer;if(n&&t)return void console.error(n,t);const r=i=>{if(!(i&&i.blockedURI&&(ir.onSecurityPolicyViolation||ir.getListeners(Nc.SECURITY_POLICY_VIOLATION).length>0)))return;const s=i.blockedURI;B("CSP_DETECTED_HOSTNAME_LIST").some((o=>be(s).call(s,o)))&&(ir.onSecurityPolicyViolation&&typeof ir.onSecurityPolicyViolation=="function"&&ir.onSecurityPolicyViolation(i),ir.getListeners(Nc.SECURITY_POLICY_VIOLATION).length>0&&ir.safeEmit(Nc.SECURITY_POLICY_VIOLATION,i))};n&&VI.removeEventListener("securitypolicyviolation",n),(t||e&&typeof e=="function"||ir.getListeners(Nc.SECURITY_POLICY_VIOLATION).length>0)&&VI.addEventListener("securitypolicyviolation",r),ir._cspEventHandlerPointer=r}var $7=ee,eq=tx,Sj=RegExp.prototype,tq=function(e){return e===Sj||$7(Sj,e)?eq(e):e.flags},gi=R(tq);function um(e){let t=e.length;for(;--t>=0;)e[t]=0}const FI=256,Tj=286,SE=30,TE=15,BI=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),KT=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),nq=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),Rj=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),bl=new Array(576);um(bl);const RE=new Array(60);um(RE);const wE=new Array(512);um(wE);const CE=new Array(256);um(CE);const WI=new Array(29);um(WI);const zT=new Array(SE);function GI(e,t,n,r,i){this.static_tree=e,this.extra_bits=t,this.extra_base=n,this.elems=r,this.max_length=i,this.has_stree=e&&e.length}let wj,Cj,bj;function HI(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}um(zT);const Ij=e=>e<256?wE[e]:wE[256+(e>>>7)],bE=(e,t)=>{e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255},js=(e,t,n)=>{e.bi_valid>16-n?(e.bi_buf|=t<<e.bi_valid&65535,bE(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=n-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=n)},Dc=(e,t,n)=>{js(e,n[2*t],n[2*t+1])},Aj=(e,t)=>{let n=0;do n|=1&e,e>>>=1,n<<=1;while(--t>0);return n>>>1},Nj=(e,t,n)=>{const r=new Array(16);let i,s,o=0;for(i=1;i<=TE;i++)o=o+n[i-1]<<1,r[i]=o;for(s=0;s<=t;s++){let c=e[2*s+1];c!==0&&(e[2*s]=Aj(r[c]++,c))}},Oj=e=>{let t;for(t=0;t<Tj;t++)e.dyn_ltree[2*t]=0;for(t=0;t<SE;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.sym_next=e.matches=0},Pj=e=>{e.bi_valid>8?bE(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},Dj=(e,t,n,r)=>{const i=2*t,s=2*n;return e[i]<e[s]||e[i]===e[s]&&r[t]<=r[n]},KI=(e,t,n)=>{const r=e.heap[n];let i=n<<1;for(;i<=e.heap_len&&(i<e.heap_len&&Dj(t,e.heap[i+1],e.heap[i],e.depth)&&i++,!Dj(t,r,e.heap[i],e.depth));)e.heap[n]=e.heap[i],n=i,i<<=1;e.heap[n]=r},kj=(e,t,n)=>{let r,i,s,o,c=0;if(e.sym_next!==0)do r=255&e.pending_buf[e.sym_buf+c++],r+=(255&e.pending_buf[e.sym_buf+c++])<<8,i=e.pending_buf[e.sym_buf+c++],r===0?Dc(e,i,t):(s=CE[i],Dc(e,s+FI+1,t),o=BI[s],o!==0&&(i-=WI[s],js(e,i,o)),r--,s=Ij(r),Dc(e,s,n),o=KT[s],o!==0&&(r-=zT[s],js(e,r,o)));while(c<e.sym_next);Dc(e,256,t)},zI=(e,t)=>{const n=t.dyn_tree,r=t.stat_desc.static_tree,i=t.stat_desc.has_stree,s=t.stat_desc.elems;let o,c,d,h=-1;for(e.heap_len=0,e.heap_max=573,o=0;o<s;o++)n[2*o]!==0?(e.heap[++e.heap_len]=h=o,e.depth[o]=0):n[2*o+1]=0;for(;e.heap_len<2;)d=e.heap[++e.heap_len]=h<2?++h:0,n[2*d]=1,e.depth[d]=0,e.opt_len--,i&&(e.static_len-=r[2*d+1]);for(t.max_code=h,o=e.heap_len>>1;o>=1;o--)KI(e,n,o);d=s;do o=e.heap[1],e.heap[1]=e.heap[e.heap_len--],KI(e,n,1),c=e.heap[1],e.heap[--e.heap_max]=o,e.heap[--e.heap_max]=c,n[2*d]=n[2*o]+n[2*c],e.depth[d]=(e.depth[o]>=e.depth[c]?e.depth[o]:e.depth[c])+1,n[2*o+1]=n[2*c+1]=d,e.heap[1]=d++,KI(e,n,1);while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],((f,g)=>{const E=g.dyn_tree,S=g.max_code,O=g.stat_desc.static_tree,A=g.stat_desc.has_stree,N=g.stat_desc.extra_bits,j=g.stat_desc.extra_base,U=g.stat_desc.max_length;let W,$,Z,Y,ie,ue,ge=0;for(Y=0;Y<=TE;Y++)f.bl_count[Y]=0;for(E[2*f.heap[f.heap_max]+1]=0,W=f.heap_max+1;W<573;W++)$=f.heap[W],Y=E[2*E[2*$+1]+1]+1,Y>U&&(Y=U,ge++),E[2*$+1]=Y,$>S||(f.bl_count[Y]++,ie=0,$>=j&&(ie=N[$-j]),ue=E[2*$],f.opt_len+=ue*(Y+ie),A&&(f.static_len+=ue*(O[2*$+1]+ie)));if(ge!==0){do{for(Y=U-1;f.bl_count[Y]===0;)Y--;f.bl_count[Y]--,f.bl_count[Y+1]+=2,f.bl_count[U]--,ge-=2}while(ge>0);for(Y=U;Y!==0;Y--)for($=f.bl_count[Y];$!==0;)Z=f.heap[--W],Z>S||(E[2*Z+1]!==Y&&(f.opt_len+=(Y-E[2*Z+1])*E[2*Z],E[2*Z+1]=Y),$--)}})(e,t),Nj(n,h,e.bl_count)},xj=(e,t,n)=>{let r,i,s=-1,o=t[1],c=0,d=7,h=4;for(o===0&&(d=138,h=3),t[2*(n+1)+1]=65535,r=0;r<=n;r++)i=o,o=t[2*(r+1)+1],++c<d&&i===o||(c<h?e.bl_tree[2*i]+=c:i!==0?(i!==s&&e.bl_tree[2*i]++,e.bl_tree[32]++):c<=10?e.bl_tree[34]++:e.bl_tree[36]++,c=0,s=i,o===0?(d=138,h=3):i===o?(d=6,h=3):(d=7,h=4))},Lj=(e,t,n)=>{let r,i,s=-1,o=t[1],c=0,d=7,h=4;for(o===0&&(d=138,h=3),r=0;r<=n;r++)if(i=o,o=t[2*(r+1)+1],!(++c<d&&i===o)){if(c<h)do Dc(e,i,e.bl_tree);while(--c!=0);else i!==0?(i!==s&&(Dc(e,i,e.bl_tree),c--),Dc(e,16,e.bl_tree),js(e,c-3,2)):c<=10?(Dc(e,17,e.bl_tree),js(e,c-3,3)):(Dc(e,18,e.bl_tree),js(e,c-11,7));c=0,s=i,o===0?(d=138,h=3):i===o?(d=6,h=3):(d=7,h=4)}};let Mj=!1;const Uj=(e,t,n,r)=>{js(e,0+(r?1:0),3),Pj(e),bE(e,n),bE(e,~n),n&&e.pending_buf.set(e.window.subarray(t,t+n),e.pending),e.pending+=n};var rq=e=>{Mj||((()=>{let t,n,r,i,s;const o=new Array(16);for(r=0,i=0;i<28;i++)for(WI[i]=r,t=0;t<1<<BI[i];t++)CE[r++]=i;for(CE[r-1]=i,s=0,i=0;i<16;i++)for(zT[i]=s,t=0;t<1<<KT[i];t++)wE[s++]=i;for(s>>=7;i<SE;i++)for(zT[i]=s<<7,t=0;t<1<<KT[i]-7;t++)wE[256+s++]=i;for(n=0;n<=TE;n++)o[n]=0;for(t=0;t<=143;)bl[2*t+1]=8,t++,o[8]++;for(;t<=255;)bl[2*t+1]=9,t++,o[9]++;for(;t<=279;)bl[2*t+1]=7,t++,o[7]++;for(;t<=287;)bl[2*t+1]=8,t++,o[8]++;for(Nj(bl,287,o),t=0;t<SE;t++)RE[2*t+1]=5,RE[2*t]=Aj(t,5);wj=new GI(bl,BI,257,Tj,TE),Cj=new GI(RE,KT,0,SE,TE),bj=new GI(new Array(0),nq,0,19,7)})(),Mj=!0),e.l_desc=new HI(e.dyn_ltree,wj),e.d_desc=new HI(e.dyn_dtree,Cj),e.bl_desc=new HI(e.bl_tree,bj),e.bi_buf=0,e.bi_valid=0,Oj(e)},iq=(e,t,n,r)=>{let i,s,o=0;e.level>0?(e.strm.data_type===2&&(e.strm.data_type=(c=>{let d,h=4093624447;for(d=0;d<=31;d++,h>>>=1)if(1&h&&c.dyn_ltree[2*d]!==0)return 0;if(c.dyn_ltree[18]!==0||c.dyn_ltree[20]!==0||c.dyn_ltree[26]!==0)return 1;for(d=32;d<FI;d++)if(c.dyn_ltree[2*d]!==0)return 1;return 0})(e)),zI(e,e.l_desc),zI(e,e.d_desc),o=(c=>{let d;for(xj(c,c.dyn_ltree,c.l_desc.max_code),xj(c,c.dyn_dtree,c.d_desc.max_code),zI(c,c.bl_desc),d=18;d>=3&&c.bl_tree[2*Rj[d]+1]===0;d--);return c.opt_len+=3*(d+1)+5+5+4,d})(e),i=e.opt_len+3+7>>>3,s=e.static_len+3+7>>>3,s<=i&&(i=s)):i=s=n+5,n+4<=i&&t!==-1?Uj(e,t,n,r):e.strategy===4||s===i?(js(e,2+(r?1:0),3),kj(e,bl,RE)):(js(e,4+(r?1:0),3),((c,d,h,f)=>{let g;for(js(c,d-257,5),js(c,h-1,5),js(c,f-4,4),g=0;g<f;g++)js(c,c.bl_tree[2*Rj[g]+1],3);Lj(c,c.dyn_ltree,d-1),Lj(c,c.dyn_dtree,h-1)})(e,e.l_desc.max_code+1,e.d_desc.max_code+1,o+1),kj(e,e.dyn_ltree,e.dyn_dtree)),Oj(e),r&&Pj(e)},sq=(e,t,n)=>(e.pending_buf[e.sym_buf+e.sym_next++]=t,e.pending_buf[e.sym_buf+e.sym_next++]=t>>8,e.pending_buf[e.sym_buf+e.sym_next++]=n,t===0?e.dyn_ltree[2*n]++:(e.matches++,t--,e.dyn_ltree[2*(CE[n]+FI+1)]++,e.dyn_dtree[2*Ij(t)]++),e.sym_next===e.sym_end),oq=e=>{js(e,2,3),Dc(e,256,bl),(t=>{t.bi_valid===16?(bE(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)})(e)},aq={_tr_init:rq,_tr_stored_block:Uj,_tr_flush_block:iq,_tr_tally:sq,_tr_align:oq},IE=(e,t,n,r)=>{let i=65535&e|0,s=e>>>16&65535|0,o=0;for(;n!==0;){o=n>2e3?2e3:n,n-=o;do i=i+t[r++]|0,s=s+i|0;while(--o);i%=65521,s%=65521}return i|s<<16|0};const cq=new Uint32Array((()=>{let e,t=[];for(var n=0;n<256;n++){e=n;for(var r=0;r<8;r++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e}return t})());var Oi=(e,t,n,r)=>{const i=cq,s=r+n;e^=-1;for(let o=r;o<s;o++)e=e>>>8^i[255&(e^t[o])];return-1^e},Uh={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},YT={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:lq,_tr_stored_block:YI,_tr_flush_block:dq,_tr_tally:Gd,_tr_align:uq}=aq,{Z_NO_FLUSH:Hd,Z_PARTIAL_FLUSH:hq,Z_FULL_FLUSH:pq,Z_FINISH:Xo,Z_BLOCK:jj,Z_OK:Wi,Z_STREAM_END:Vj,Z_STREAM_ERROR:kc,Z_DATA_ERROR:fq,Z_BUF_ERROR:qI,Z_DEFAULT_COMPRESSION:mq,Z_FILTERED:_q,Z_HUFFMAN_ONLY:qT,Z_RLE:gq,Z_FIXED:Eq,Z_DEFAULT_STRATEGY:vq,Z_UNKNOWN:yq,Z_DEFLATED:XT}=YT,XI=286,Sq=30,Tq=19,Rq=2*XI+1,wq=15,jh=258,xc=262,hm=42,Vh=113,AE=666,Fh=(e,t)=>(e.msg=Uh[t],t),Fj=e=>2*e-(e>4?9:0),Kd=e=>{let t=e.length;for(;--t>=0;)e[t]=0},Cq=e=>{let t,n,r,i=e.w_size;t=e.hash_size,r=t;do n=e.head[--r],e.head[r]=n>=i?n-i:0;while(--t);t=i,r=t;do n=e.prev[--r],e.prev[r]=n>=i?n-i:0;while(--t)};let zd=(e,t,n)=>(t<<e.hash_shift^n)&e.hash_mask;const lo=e=>{const t=e.state;let n=t.pending;n>e.avail_out&&(n=e.avail_out),n!==0&&(e.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+n),e.next_out),e.next_out+=n,t.pending_out+=n,e.total_out+=n,e.avail_out-=n,t.pending-=n,t.pending===0&&(t.pending_out=0))},uo=(e,t)=>{dq(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,lo(e.strm)},Hn=(e,t)=>{e.pending_buf[e.pending++]=t},NE=(e,t)=>{e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t},JI=(e,t,n,r)=>{let i=e.avail_in;return i>r&&(i=r),i===0?0:(e.avail_in-=i,t.set(e.input.subarray(e.next_in,e.next_in+i),n),e.state.wrap===1?e.adler=IE(e.adler,t,i,n):e.state.wrap===2&&(e.adler=Oi(e.adler,t,i,n)),e.next_in+=i,e.total_in+=i,i)},Bj=(e,t)=>{let n,r,i=e.max_chain_length,s=e.strstart,o=e.prev_length,c=e.nice_match;const d=e.strstart>e.w_size-xc?e.strstart-(e.w_size-xc):0,h=e.window,f=e.w_mask,g=e.prev,E=e.strstart+jh;let S=h[s+o-1],O=h[s+o];e.prev_length>=e.good_match&&(i>>=2),c>e.lookahead&&(c=e.lookahead);do if(n=t,h[n+o]===O&&h[n+o-1]===S&&h[n]===h[s]&&h[++n]===h[s+1]){s+=2,n++;do;while(h[++s]===h[++n]&&h[++s]===h[++n]&&h[++s]===h[++n]&&h[++s]===h[++n]&&h[++s]===h[++n]&&h[++s]===h[++n]&&h[++s]===h[++n]&&h[++s]===h[++n]&&s<E);if(r=jh-(E-s),s=E-jh,r>o){if(e.match_start=t,o=r,r>=c)break;S=h[s+o-1],O=h[s+o]}}while((t=g[t&f])>d&&--i!=0);return o<=e.lookahead?o:e.lookahead},pm=e=>{const t=e.w_size;let n,r,i;do{if(r=e.window_size-e.lookahead-e.strstart,e.strstart>=t+(t-xc)&&(e.window.set(e.window.subarray(t,t+t-r),0),e.match_start-=t,e.strstart-=t,e.block_start-=t,e.insert>e.strstart&&(e.insert=e.strstart),Cq(e),r+=t),e.strm.avail_in===0)break;if(n=JI(e.strm,e.window,e.strstart+e.lookahead,r),e.lookahead+=n,e.lookahead+e.insert>=3)for(i=e.strstart-e.insert,e.ins_h=e.window[i],e.ins_h=zd(e,e.ins_h,e.window[i+1]);e.insert&&(e.ins_h=zd(e,e.ins_h,e.window[i+3-1]),e.prev[i&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=i,i++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<xc&&e.strm.avail_in!==0)},Wj=(e,t)=>{let n,r,i,s=e.pending_buf_size-5>e.w_size?e.w_size:e.pending_buf_size-5,o=0,c=e.strm.avail_in;do{if(n=65535,i=e.bi_valid+42>>3,e.strm.avail_out<i||(i=e.strm.avail_out-i,r=e.strstart-e.block_start,n>r+e.strm.avail_in&&(n=r+e.strm.avail_in),n>i&&(n=i),n<s&&(n===0&&t!==Xo||t===Hd||n!==r+e.strm.avail_in)))break;o=t===Xo&&n===r+e.strm.avail_in?1:0,YI(e,0,0,o),e.pending_buf[e.pending-4]=n,e.pending_buf[e.pending-3]=n>>8,e.pending_buf[e.pending-2]=~n,e.pending_buf[e.pending-1]=~n>>8,lo(e.strm),r&&(r>n&&(r=n),e.strm.output.set(e.window.subarray(e.block_start,e.block_start+r),e.strm.next_out),e.strm.next_out+=r,e.strm.avail_out-=r,e.strm.total_out+=r,e.block_start+=r,n-=r),n&&(JI(e.strm,e.strm.output,e.strm.next_out,n),e.strm.next_out+=n,e.strm.avail_out-=n,e.strm.total_out+=n)}while(o===0);return c-=e.strm.avail_in,c&&(c>=e.w_size?(e.matches=2,e.window.set(e.strm.input.subarray(e.strm.next_in-e.w_size,e.strm.next_in),0),e.strstart=e.w_size,e.insert=e.strstart):(e.window_size-e.strstart<=c&&(e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,e.insert>e.strstart&&(e.insert=e.strstart)),e.window.set(e.strm.input.subarray(e.strm.next_in-c,e.strm.next_in),e.strstart),e.strstart+=c,e.insert+=c>e.w_size-e.insert?e.w_size-e.insert:c),e.block_start=e.strstart),e.high_water<e.strstart&&(e.high_water=e.strstart),o?4:t!==Hd&&t!==Xo&&e.strm.avail_in===0&&e.strstart===e.block_start?2:(i=e.window_size-e.strstart,e.strm.avail_in>i&&e.block_start>=e.w_size&&(e.block_start-=e.w_size,e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,i+=e.w_size,e.insert>e.strstart&&(e.insert=e.strstart)),i>e.strm.avail_in&&(i=e.strm.avail_in),i&&(JI(e.strm,e.window,e.strstart,i),e.strstart+=i,e.insert+=i>e.w_size-e.insert?e.w_size-e.insert:i),e.high_water<e.strstart&&(e.high_water=e.strstart),i=e.bi_valid+42>>3,i=e.pending_buf_size-i>65535?65535:e.pending_buf_size-i,s=i>e.w_size?e.w_size:i,r=e.strstart-e.block_start,(r>=s||(r||t===Xo)&&t!==Hd&&e.strm.avail_in===0&&r<=i)&&(n=r>i?i:r,o=t===Xo&&e.strm.avail_in===0&&n===r?1:0,YI(e,e.block_start,n,o),e.block_start+=n,lo(e.strm)),o?3:1)},QI=(e,t)=>{let n,r;for(;;){if(e.lookahead<xc){if(pm(e),e.lookahead<xc&&t===Hd)return 1;if(e.lookahead===0)break}if(n=0,e.lookahead>=3&&(e.ins_h=zd(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),n!==0&&e.strstart-n<=e.w_size-xc&&(e.match_length=Bj(e,n)),e.match_length>=3)if(r=Gd(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do e.strstart++,e.ins_h=zd(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart;while(--e.match_length!=0);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=zd(e,e.ins_h,e.window[e.strstart+1]);else r=Gd(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(r&&(uo(e,!1),e.strm.avail_out===0))return 1}return e.insert=e.strstart<2?e.strstart:2,t===Xo?(uo(e,!0),e.strm.avail_out===0?3:4):e.sym_next&&(uo(e,!1),e.strm.avail_out===0)?1:2},fm=(e,t)=>{let n,r,i;for(;;){if(e.lookahead<xc){if(pm(e),e.lookahead<xc&&t===Hd)return 1;if(e.lookahead===0)break}if(n=0,e.lookahead>=3&&(e.ins_h=zd(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,n!==0&&e.prev_length<e.max_lazy_match&&e.strstart-n<=e.w_size-xc&&(e.match_length=Bj(e,n),e.match_length<=5&&(e.strategy===_q||e.match_length===3&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){i=e.strstart+e.lookahead-3,r=Gd(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do++e.strstart<=i&&(e.ins_h=zd(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart);while(--e.prev_length!=0);if(e.match_available=0,e.match_length=2,e.strstart++,r&&(uo(e,!1),e.strm.avail_out===0))return 1}else if(e.match_available){if(r=Gd(e,0,e.window[e.strstart-1]),r&&uo(e,!1),e.strstart++,e.lookahead--,e.strm.avail_out===0)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(r=Gd(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,t===Xo?(uo(e,!0),e.strm.avail_out===0?3:4):e.sym_next&&(uo(e,!1),e.strm.avail_out===0)?1:2};function Lc(e,t,n,r,i){this.good_length=e,this.max_lazy=t,this.nice_length=n,this.max_chain=r,this.func=i}const OE=[new Lc(0,0,0,0,Wj),new Lc(4,4,8,4,QI),new Lc(4,5,16,8,QI),new Lc(4,6,32,32,QI),new Lc(4,4,16,16,fm),new Lc(8,16,32,32,fm),new Lc(8,16,128,128,fm),new Lc(8,32,128,256,fm),new Lc(32,128,258,1024,fm),new Lc(32,258,258,4096,fm)];function bq(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=XT,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(2*Rq),this.dyn_dtree=new Uint16Array(2*(2*Sq+1)),this.bl_tree=new Uint16Array(2*(2*Tq+1)),Kd(this.dyn_ltree),Kd(this.dyn_dtree),Kd(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(wq+1),this.heap=new Uint16Array(2*XI+1),Kd(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*XI+1),Kd(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const PE=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.status!==hm&&t.status!==57&&t.status!==69&&t.status!==73&&t.status!==91&&t.status!==103&&t.status!==Vh&&t.status!==AE?1:0},Gj=e=>{if(PE(e))return Fh(e,kc);e.total_in=e.total_out=0,e.data_type=yq;const t=e.state;return t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap===2?57:t.wrap?hm:Vh,e.adler=t.wrap===2?0:1,t.last_flush=-2,lq(t),Wi},Hj=e=>{const t=Gj(e);return t===Wi&&(n=>{n.window_size=2*n.w_size,Kd(n.head),n.max_lazy_match=OE[n.level].max_lazy,n.good_match=OE[n.level].good_length,n.nice_match=OE[n.level].nice_length,n.max_chain_length=OE[n.level].max_chain,n.strstart=0,n.block_start=0,n.lookahead=0,n.insert=0,n.match_length=n.prev_length=2,n.match_available=0,n.ins_h=0})(e.state),t},Kj=(e,t,n,r,i,s)=>{if(!e)return kc;let o=1;if(t===mq&&(t=6),r<0?(o=0,r=-r):r>15&&(o=2,r-=16),i<1||i>9||n!==XT||r<8||r>15||t<0||t>9||s<0||s>Eq||r===8&&o!==1)return Fh(e,kc);r===8&&(r=9);const c=new bq;return e.state=c,c.strm=e,c.status=hm,c.wrap=o,c.gzhead=null,c.w_bits=r,c.w_size=1<<c.w_bits,c.w_mask=c.w_size-1,c.hash_bits=i+7,c.hash_size=1<<c.hash_bits,c.hash_mask=c.hash_size-1,c.hash_shift=~~((c.hash_bits+3-1)/3),c.window=new Uint8Array(2*c.w_size),c.head=new Uint16Array(c.hash_size),c.prev=new Uint16Array(c.w_size),c.lit_bufsize=1<<i+6,c.pending_buf_size=4*c.lit_bufsize,c.pending_buf=new Uint8Array(c.pending_buf_size),c.sym_buf=c.lit_bufsize,c.sym_end=3*(c.lit_bufsize-1),c.level=t,c.strategy=s,c.method=n,Hj(e)};var Iq=(e,t)=>{if(PE(e)||t>jj||t<0)return e?Fh(e,kc):kc;const n=e.state;if(!e.output||e.avail_in!==0&&!e.input||n.status===AE&&t!==Xo)return Fh(e,e.avail_out===0?qI:kc);const r=n.last_flush;if(n.last_flush=t,n.pending!==0){if(lo(e),e.avail_out===0)return n.last_flush=-1,Wi}else if(e.avail_in===0&&Fj(t)<=Fj(r)&&t!==Xo)return Fh(e,qI);if(n.status===AE&&e.avail_in!==0)return Fh(e,qI);if(n.status===hm&&n.wrap===0&&(n.status=Vh),n.status===hm){let i=XT+(n.w_bits-8<<4)<<8,s=-1;if(s=n.strategy>=qT||n.level<2?0:n.level<6?1:n.level===6?2:3,i|=s<<6,n.strstart!==0&&(i|=32),i+=31-i%31,NE(n,i),n.strstart!==0&&(NE(n,e.adler>>>16),NE(n,65535&e.adler)),e.adler=1,n.status=Vh,lo(e),n.pending!==0)return n.last_flush=-1,Wi}if(n.status===57){if(e.adler=0,Hn(n,31),Hn(n,139),Hn(n,8),n.gzhead)Hn(n,(n.gzhead.text?1:0)+(n.gzhead.hcrc?2:0)+(n.gzhead.extra?4:0)+(n.gzhead.name?8:0)+(n.gzhead.comment?16:0)),Hn(n,255&n.gzhead.time),Hn(n,n.gzhead.time>>8&255),Hn(n,n.gzhead.time>>16&255),Hn(n,n.gzhead.time>>24&255),Hn(n,n.level===9?2:n.strategy>=qT||n.level<2?4:0),Hn(n,255&n.gzhead.os),n.gzhead.extra&&n.gzhead.extra.length&&(Hn(n,255&n.gzhead.extra.length),Hn(n,n.gzhead.extra.length>>8&255)),n.gzhead.hcrc&&(e.adler=Oi(e.adler,n.pending_buf,n.pending,0)),n.gzindex=0,n.status=69;else if(Hn(n,0),Hn(n,0),Hn(n,0),Hn(n,0),Hn(n,0),Hn(n,n.level===9?2:n.strategy>=qT||n.level<2?4:0),Hn(n,3),n.status=Vh,lo(e),n.pending!==0)return n.last_flush=-1,Wi}if(n.status===69){if(n.gzhead.extra){let i=n.pending,s=(65535&n.gzhead.extra.length)-n.gzindex;for(;n.pending+s>n.pending_buf_size;){let c=n.pending_buf_size-n.pending;if(n.pending_buf.set(n.gzhead.extra.subarray(n.gzindex,n.gzindex+c),n.pending),n.pending=n.pending_buf_size,n.gzhead.hcrc&&n.pending>i&&(e.adler=Oi(e.adler,n.pending_buf,n.pending-i,i)),n.gzindex+=c,lo(e),n.pending!==0)return n.last_flush=-1,Wi;i=0,s-=c}let o=new Uint8Array(n.gzhead.extra);n.pending_buf.set(o.subarray(n.gzindex,n.gzindex+s),n.pending),n.pending+=s,n.gzhead.hcrc&&n.pending>i&&(e.adler=Oi(e.adler,n.pending_buf,n.pending-i,i)),n.gzindex=0}n.status=73}if(n.status===73){if(n.gzhead.name){let i,s=n.pending;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>s&&(e.adler=Oi(e.adler,n.pending_buf,n.pending-s,s)),lo(e),n.pending!==0)return n.last_flush=-1,Wi;s=0}i=n.gzindex<n.gzhead.name.length?255&n.gzhead.name.charCodeAt(n.gzindex++):0,Hn(n,i)}while(i!==0);n.gzhead.hcrc&&n.pending>s&&(e.adler=Oi(e.adler,n.pending_buf,n.pending-s,s)),n.gzindex=0}n.status=91}if(n.status===91){if(n.gzhead.comment){let i,s=n.pending;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>s&&(e.adler=Oi(e.adler,n.pending_buf,n.pending-s,s)),lo(e),n.pending!==0)return n.last_flush=-1,Wi;s=0}i=n.gzindex<n.gzhead.comment.length?255&n.gzhead.comment.charCodeAt(n.gzindex++):0,Hn(n,i)}while(i!==0);n.gzhead.hcrc&&n.pending>s&&(e.adler=Oi(e.adler,n.pending_buf,n.pending-s,s))}n.status=103}if(n.status===103){if(n.gzhead.hcrc){if(n.pending+2>n.pending_buf_size&&(lo(e),n.pending!==0))return n.last_flush=-1,Wi;Hn(n,255&e.adler),Hn(n,e.adler>>8&255),e.adler=0}if(n.status=Vh,lo(e),n.pending!==0)return n.last_flush=-1,Wi}if(e.avail_in!==0||n.lookahead!==0||t!==Hd&&n.status!==AE){let i=n.level===0?Wj(n,t):n.strategy===qT?((s,o)=>{let c;for(;;){if(s.lookahead===0&&(pm(s),s.lookahead===0)){if(o===Hd)return 1;break}if(s.match_length=0,c=Gd(s,0,s.window[s.strstart]),s.lookahead--,s.strstart++,c&&(uo(s,!1),s.strm.avail_out===0))return 1}return s.insert=0,o===Xo?(uo(s,!0),s.strm.avail_out===0?3:4):s.sym_next&&(uo(s,!1),s.strm.avail_out===0)?1:2})(n,t):n.strategy===gq?((s,o)=>{let c,d,h,f;const g=s.window;for(;;){if(s.lookahead<=jh){if(pm(s),s.lookahead<=jh&&o===Hd)return 1;if(s.lookahead===0)break}if(s.match_length=0,s.lookahead>=3&&s.strstart>0&&(h=s.strstart-1,d=g[h],d===g[++h]&&d===g[++h]&&d===g[++h])){f=s.strstart+jh;do;while(d===g[++h]&&d===g[++h]&&d===g[++h]&&d===g[++h]&&d===g[++h]&&d===g[++h]&&d===g[++h]&&d===g[++h]&&h<f);s.match_length=jh-(f-h),s.match_length>s.lookahead&&(s.match_length=s.lookahead)}if(s.match_length>=3?(c=Gd(s,1,s.match_length-3),s.lookahead-=s.match_length,s.strstart+=s.match_length,s.match_length=0):(c=Gd(s,0,s.window[s.strstart]),s.lookahead--,s.strstart++),c&&(uo(s,!1),s.strm.avail_out===0))return 1}return s.insert=0,o===Xo?(uo(s,!0),s.strm.avail_out===0?3:4):s.sym_next&&(uo(s,!1),s.strm.avail_out===0)?1:2})(n,t):OE[n.level].func(n,t);if(i!==3&&i!==4||(n.status=AE),i===1||i===3)return e.avail_out===0&&(n.last_flush=-1),Wi;if(i===2&&(t===hq?uq(n):t!==jj&&(YI(n,0,0,!1),t===pq&&(Kd(n.head),n.lookahead===0&&(n.strstart=0,n.block_start=0,n.insert=0))),lo(e),e.avail_out===0))return n.last_flush=-1,Wi}return t!==Xo?Wi:n.wrap<=0?Vj:(n.wrap===2?(Hn(n,255&e.adler),Hn(n,e.adler>>8&255),Hn(n,e.adler>>16&255),Hn(n,e.adler>>24&255),Hn(n,255&e.total_in),Hn(n,e.total_in>>8&255),Hn(n,e.total_in>>16&255),Hn(n,e.total_in>>24&255)):(NE(n,e.adler>>>16),NE(n,65535&e.adler)),lo(e),n.wrap>0&&(n.wrap=-n.wrap),n.pending!==0?Wi:Vj)},Aq=(e,t)=>{let n=t.length;if(PE(e))return kc;const r=e.state,i=r.wrap;if(i===2||i===1&&r.status!==hm||r.lookahead)return kc;if(i===1&&(e.adler=IE(e.adler,t,n,0)),r.wrap=0,n>=r.w_size){i===0&&(Kd(r.head),r.strstart=0,r.block_start=0,r.insert=0);let d=new Uint8Array(r.w_size);d.set(t.subarray(n-r.w_size,n),0),t=d,n=r.w_size}const s=e.avail_in,o=e.next_in,c=e.input;for(e.avail_in=n,e.next_in=0,e.input=t,pm(r);r.lookahead>=3;){let d=r.strstart,h=r.lookahead-2;do r.ins_h=zd(r,r.ins_h,r.window[d+3-1]),r.prev[d&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=d,d++;while(--h);r.strstart=d,r.lookahead=2,pm(r)}return r.strstart+=r.lookahead,r.block_start=r.strstart,r.insert=r.lookahead,r.lookahead=0,r.match_length=r.prev_length=2,r.match_available=0,e.next_in=o,e.input=c,e.avail_in=s,r.wrap=i,Wi},DE={deflateInit:(e,t)=>Kj(e,t,XT,15,8,vq),deflateInit2:Kj,deflateReset:Hj,deflateResetKeep:Gj,deflateSetHeader:(e,t)=>PE(e)||e.state.wrap!==2?kc:(e.state.gzhead=t,Wi),deflate:Iq,deflateEnd:e=>{if(PE(e))return kc;const t=e.state.status;return e.state=null,t===Vh?Fh(e,fq):Wi},deflateSetDictionary:Aq,deflateInfo:"pako deflate (from Nodeca project)"};const Nq=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var JT={assign:function(e){const t=Array.prototype.slice.call(arguments,1);for(;t.length;){const n=t.shift();if(n){if(typeof n!="object")throw new TypeError(n+"must be non-object");for(const r in n)Nq(n,r)&&(e[r]=n[r])}}return e},flattenChunks:e=>{let t=0;for(let r=0,i=e.length;r<i;r++)t+=e[r].length;const n=new Uint8Array(t);for(let r=0,i=0,s=e.length;r<s;r++){let o=e[r];n.set(o,i),i+=o.length}return n}};let zj=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{zj=!1}const kE=new Uint8Array(256);for(let e=0;e<256;e++)kE[e]=e>=252?6:e>=248?5:e>=240?4:e>=224?3:e>=192?2:1;kE[254]=kE[254]=1;var xE={string2buf:e=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(e);let t,n,r,i,s,o=e.length,c=0;for(i=0;i<o;i++)n=e.charCodeAt(i),(64512&n)==55296&&i+1<o&&(r=e.charCodeAt(i+1),(64512&r)==56320&&(n=65536+(n-55296<<10)+(r-56320),i++)),c+=n<128?1:n<2048?2:n<65536?3:4;for(t=new Uint8Array(c),s=0,i=0;s<c;i++)n=e.charCodeAt(i),(64512&n)==55296&&i+1<o&&(r=e.charCodeAt(i+1),(64512&r)==56320&&(n=65536+(n-55296<<10)+(r-56320),i++)),n<128?t[s++]=n:n<2048?(t[s++]=192|n>>>6,t[s++]=128|63&n):n<65536?(t[s++]=224|n>>>12,t[s++]=128|n>>>6&63,t[s++]=128|63&n):(t[s++]=240|n>>>18,t[s++]=128|n>>>12&63,t[s++]=128|n>>>6&63,t[s++]=128|63&n);return t},buf2string:(e,t)=>{const n=t||e.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(e.subarray(0,t));let r,i;const s=new Array(2*n);for(i=0,r=0;r<n;){let o=e[r++];if(o<128){s[i++]=o;continue}let c=kE[o];if(c>4)s[i++]=65533,r+=c-1;else{for(o&=c===2?31:c===3?15:7;c>1&&r<n;)o=o<<6|63&e[r++],c--;c>1?s[i++]=65533:o<65536?s[i++]=o:(o-=65536,s[i++]=55296|o>>10&1023,s[i++]=56320|1023&o)}}return((o,c)=>{if(c<65534&&o.subarray&&zj)return String.fromCharCode.apply(null,o.length===c?o:o.subarray(0,c));let d="";for(let h=0;h<c;h++)d+=String.fromCharCode(o[h]);return d})(s,i)},utf8border:(e,t)=>{(t=t||e.length)>e.length&&(t=e.length);let n=t-1;for(;n>=0&&(192&e[n])==128;)n--;return n<0||n===0?t:n+kE[e[n]]>t?n:t}},Yj=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const qj=Object.prototype.toString,{Z_NO_FLUSH:Oq,Z_SYNC_FLUSH:Pq,Z_FULL_FLUSH:Dq,Z_FINISH:kq,Z_OK:QT,Z_STREAM_END:xq,Z_DEFAULT_COMPRESSION:Lq,Z_DEFAULT_STRATEGY:Mq,Z_DEFLATED:Uq}=YT;function ZT(e){this.options=JT.assign({level:Lq,method:Uq,chunkSize:16384,windowBits:15,memLevel:8,strategy:Mq},e||{});let t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Yj,this.strm.avail_out=0;let n=DE.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(n!==QT)throw new Error(Uh[n]);if(t.header&&DE.deflateSetHeader(this.strm,t.header),t.dictionary){let r;if(r=typeof t.dictionary=="string"?xE.string2buf(t.dictionary):qj.call(t.dictionary)==="[object ArrayBuffer]"?new Uint8Array(t.dictionary):t.dictionary,n=DE.deflateSetDictionary(this.strm,r),n!==QT)throw new Error(Uh[n]);this._dict_set=!0}}function jq(e,t){const n=new ZT(t);if(n.push(e,!0),n.err)throw n.msg||Uh[n.err];return n.result}ZT.prototype.push=function(e,t){const n=this.strm,r=this.options.chunkSize;let i,s;if(this.ended)return!1;for(s=t===~~t?t:t===!0?kq:Oq,typeof e=="string"?n.input=xE.string2buf(e):qj.call(e)==="[object ArrayBuffer]"?n.input=new Uint8Array(e):n.input=e,n.next_in=0,n.avail_in=n.input.length;;)if(n.avail_out===0&&(n.output=new Uint8Array(r),n.next_out=0,n.avail_out=r),(s===Pq||s===Dq)&&n.avail_out<=6)this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;else{if(i=DE.deflate(n,s),i===xq)return n.next_out>0&&this.onData(n.output.subarray(0,n.next_out)),i=DE.deflateEnd(this.strm),this.onEnd(i),this.ended=!0,i===QT;if(n.avail_out!==0){if(s>0&&n.next_out>0)this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;else if(n.avail_in===0)break}else this.onData(n.output)}return!0},ZT.prototype.onData=function(e){this.chunks.push(e)},ZT.prototype.onEnd=function(e){e===QT&&(this.result=JT.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var Vq={deflate:jq};const $T=16209;var Fq=function(e,t){let n,r,i,s,o,c,d,h,f,g,E,S,O,A,N,j,U,W,$,Z,Y,ie,ue,ge;const Re=e.state;n=e.next_in,ue=e.input,r=n+(e.avail_in-5),i=e.next_out,ge=e.output,s=i-(t-e.avail_out),o=i+(e.avail_out-257),c=Re.dmax,d=Re.wsize,h=Re.whave,f=Re.wnext,g=Re.window,E=Re.hold,S=Re.bits,O=Re.lencode,A=Re.distcode,N=(1<<Re.lenbits)-1,j=(1<<Re.distbits)-1;e:do{S<15&&(E+=ue[n++]<<S,S+=8,E+=ue[n++]<<S,S+=8),U=O[E&N];t:for(;;){if(W=U>>>24,E>>>=W,S-=W,W=U>>>16&255,W===0)ge[i++]=65535&U;else{if(!(16&W)){if((64&W)==0){U=O[(65535&U)+(E&(1<<W)-1)];continue t}if(32&W){Re.mode=16191;break e}e.msg="invalid literal/length code",Re.mode=$T;break e}$=65535&U,W&=15,W&&(S<W&&(E+=ue[n++]<<S,S+=8),$+=E&(1<<W)-1,E>>>=W,S-=W),S<15&&(E+=ue[n++]<<S,S+=8,E+=ue[n++]<<S,S+=8),U=A[E&j];n:for(;;){if(W=U>>>24,E>>>=W,S-=W,W=U>>>16&255,!(16&W)){if((64&W)==0){U=A[(65535&U)+(E&(1<<W)-1)];continue n}e.msg="invalid distance code",Re.mode=$T;break e}if(Z=65535&U,W&=15,S<W&&(E+=ue[n++]<<S,S+=8,S<W&&(E+=ue[n++]<<S,S+=8)),Z+=E&(1<<W)-1,Z>c){e.msg="invalid distance too far back",Re.mode=$T;break e}if(E>>>=W,S-=W,W=i-s,Z>W){if(W=Z-W,W>h&&Re.sane){e.msg="invalid distance too far back",Re.mode=$T;break e}if(Y=0,ie=g,f===0){if(Y+=d-W,W<$){$-=W;do ge[i++]=g[Y++];while(--W);Y=i-Z,ie=ge}}else if(f<W){if(Y+=d+f-W,W-=f,W<$){$-=W;do ge[i++]=g[Y++];while(--W);if(Y=0,f<$){W=f,$-=W;do ge[i++]=g[Y++];while(--W);Y=i-Z,ie=ge}}}else if(Y+=f-W,W<$){$-=W;do ge[i++]=g[Y++];while(--W);Y=i-Z,ie=ge}for(;$>2;)ge[i++]=ie[Y++],ge[i++]=ie[Y++],ge[i++]=ie[Y++],$-=3;$&&(ge[i++]=ie[Y++],$>1&&(ge[i++]=ie[Y++]))}else{Y=i-Z;do ge[i++]=ge[Y++],ge[i++]=ge[Y++],ge[i++]=ge[Y++],$-=3;while($>2);$&&(ge[i++]=ge[Y++],$>1&&(ge[i++]=ge[Y++]))}break}}break}}while(n<r&&i<o);$=S>>3,n-=$,S-=$<<3,E&=(1<<S)-1,e.next_in=n,e.next_out=i,e.avail_in=n<r?r-n+5:5-(n-r),e.avail_out=i<o?o-i+257:257-(i-o),Re.hold=E,Re.bits=S};const eR=15,Bq=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),Wq=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),Gq=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),Hq=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var LE=(e,t,n,r,i,s,o,c)=>{const d=c.bits;let h,f,g,E,S,O,A=0,N=0,j=0,U=0,W=0,$=0,Z=0,Y=0,ie=0,ue=0,ge=null;const Re=new Uint16Array(16),St=new Uint16Array(16);let Ct,at,Qt,qt=null;for(A=0;A<=eR;A++)Re[A]=0;for(N=0;N<r;N++)Re[t[n+N]]++;for(W=d,U=eR;U>=1&&Re[U]===0;U--);if(W>U&&(W=U),U===0)return i[s++]=20971520,i[s++]=20971520,c.bits=1,0;for(j=1;j<U&&Re[j]===0;j++);for(W<j&&(W=j),Y=1,A=1;A<=eR;A++)if(Y<<=1,Y-=Re[A],Y<0)return-1;if(Y>0&&(e===0||U!==1))return-1;for(St[1]=0,A=1;A<eR;A++)St[A+1]=St[A]+Re[A];for(N=0;N<r;N++)t[n+N]!==0&&(o[St[t[n+N]]++]=N);if(e===0?(ge=qt=o,O=20):e===1?(ge=Bq,qt=Wq,O=257):(ge=Gq,qt=Hq,O=0),ue=0,N=0,A=j,S=s,$=W,Z=0,g=-1,ie=1<<W,E=ie-1,e===1&&ie>852||e===2&&ie>592)return 1;for(;;){Ct=A-Z,o[N]+1<O?(at=0,Qt=o[N]):o[N]>=O?(at=qt[o[N]-O],Qt=ge[o[N]-O]):(at=96,Qt=0),h=1<<A-Z,f=1<<$,j=f;do f-=h,i[S+(ue>>Z)+f]=Ct<<24|at<<16|Qt|0;while(f!==0);for(h=1<<A-1;ue&h;)h>>=1;if(h!==0?(ue&=h-1,ue+=h):ue=0,N++,--Re[A]==0){if(A===U)break;A=t[n+o[N]]}if(A>W&&(ue&E)!==g){for(Z===0&&(Z=W),S+=j,$=A-Z,Y=1<<$;$+Z<U&&(Y-=Re[$+Z],!(Y<=0));)$++,Y<<=1;if(ie+=1<<$,e===1&&ie>852||e===2&&ie>592)return 1;g=ue&E,i[g]=W<<24|$<<16|S-s|0}}return ue!==0&&(i[S+ue]=A-Z<<24|64<<16|0),c.bits=W,0};const{Z_FINISH:Xj,Z_BLOCK:Kq,Z_TREES:tR,Z_OK:Bh,Z_STREAM_END:zq,Z_NEED_DICT:Yq,Z_STREAM_ERROR:Jo,Z_DATA_ERROR:Jj,Z_MEM_ERROR:Qj,Z_BUF_ERROR:qq,Z_DEFLATED:Zj}=YT,nR=16180,rR=16190,Il=16191,ZI=16192,$I=16194,iR=16199,sR=16200,eA=16206,br=16209,$j=e=>(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24);function Xq(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const Wh=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.mode<nR||t.mode>16211?1:0},eV=e=>{if(Wh(e))return Jo;const t=e.state;return e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=nR,t.last=0,t.havedict=0,t.flags=-1,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(852),t.distcode=t.distdyn=new Int32Array(592),t.sane=1,t.back=-1,Bh},tV=e=>{if(Wh(e))return Jo;const t=e.state;return t.wsize=0,t.whave=0,t.wnext=0,eV(e)},nV=(e,t)=>{let n;if(Wh(e))return Jo;const r=e.state;return t<0?(n=0,t=-t):(n=5+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?Jo:(r.window!==null&&r.wbits!==t&&(r.window=null),r.wrap=n,r.wbits=t,tV(e))},rV=(e,t)=>{if(!e)return Jo;const n=new Xq;e.state=n,n.strm=e,n.window=null,n.mode=nR;const r=nV(e,t);return r!==Bh&&(e.state=null),r};let tA,nA,iV=!0;const Jq=e=>{if(iV){tA=new Int32Array(512),nA=new Int32Array(32);let t=0;for(;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(LE(1,e.lens,0,288,tA,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;LE(2,e.lens,0,32,nA,0,e.work,{bits:5}),iV=!1}e.lencode=tA,e.lenbits=9,e.distcode=nA,e.distbits=5},sV=(e,t,n,r)=>{let i;const s=e.state;return s.window===null&&(s.wsize=1<<s.wbits,s.wnext=0,s.whave=0,s.window=new Uint8Array(s.wsize)),r>=s.wsize?(s.window.set(t.subarray(n-s.wsize,n),0),s.wnext=0,s.whave=s.wsize):(i=s.wsize-s.wnext,i>r&&(i=r),s.window.set(t.subarray(n-r,n-r+i),s.wnext),(r-=i)?(s.window.set(t.subarray(n-r,n),0),s.wnext=r,s.whave=s.wsize):(s.wnext+=i,s.wnext===s.wsize&&(s.wnext=0),s.whave<s.wsize&&(s.whave+=i))),0};var Qq=(e,t)=>{let n,r,i,s,o,c,d,h,f,g,E,S,O,A,N,j,U,W,$,Z,Y,ie,ue=0;const ge=new Uint8Array(4);let Re,St;const Ct=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(Wh(e)||!e.output||!e.input&&e.avail_in!==0)return Jo;n=e.state,n.mode===Il&&(n.mode=ZI),o=e.next_out,i=e.output,d=e.avail_out,s=e.next_in,r=e.input,c=e.avail_in,h=n.hold,f=n.bits,g=c,E=d,ie=Bh;e:for(;;)switch(n.mode){case nR:if(n.wrap===0){n.mode=ZI;break}for(;f<16;){if(c===0)break e;c--,h+=r[s++]<<f,f+=8}if(2&n.wrap&&h===35615){n.wbits===0&&(n.wbits=15),n.check=0,ge[0]=255&h,ge[1]=h>>>8&255,n.check=Oi(n.check,ge,2,0),h=0,f=0,n.mode=16181;break}if(n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&h)<<8)+(h>>8))%31){e.msg="incorrect header check",n.mode=br;break}if((15&h)!==Zj){e.msg="unknown compression method",n.mode=br;break}if(h>>>=4,f-=4,Y=8+(15&h),n.wbits===0&&(n.wbits=Y),Y>15||Y>n.wbits){e.msg="invalid window size",n.mode=br;break}n.dmax=1<<n.wbits,n.flags=0,e.adler=n.check=1,n.mode=512&h?16189:Il,h=0,f=0;break;case 16181:for(;f<16;){if(c===0)break e;c--,h+=r[s++]<<f,f+=8}if(n.flags=h,(255&gi(n))!==Zj){e.msg="unknown compression method",n.mode=br;break}if(57344&gi(n)){e.msg="unknown header flags set",n.mode=br;break}n.head&&(n.head.text=h>>8&1),512&gi(n)&&4&n.wrap&&(ge[0]=255&h,ge[1]=h>>>8&255,n.check=Oi(n.check,ge,2,0)),h=0,f=0,n.mode=16182;case 16182:for(;f<32;){if(c===0)break e;c--,h+=r[s++]<<f,f+=8}n.head&&(n.head.time=h),512&gi(n)&&4&n.wrap&&(ge[0]=255&h,ge[1]=h>>>8&255,ge[2]=h>>>16&255,ge[3]=h>>>24&255,n.check=Oi(n.check,ge,4,0)),h=0,f=0,n.mode=16183;case 16183:for(;f<16;){if(c===0)break e;c--,h+=r[s++]<<f,f+=8}n.head&&(n.head.xflags=255&h,n.head.os=h>>8),512&gi(n)&&4&n.wrap&&(ge[0]=255&h,ge[1]=h>>>8&255,n.check=Oi(n.check,ge,2,0)),h=0,f=0,n.mode=16184;case 16184:if(1024&gi(n)){for(;f<16;){if(c===0)break e;c--,h+=r[s++]<<f,f+=8}n.length=h,n.head&&(n.head.extra_len=h),512&gi(n)&&4&n.wrap&&(ge[0]=255&h,ge[1]=h>>>8&255,n.check=Oi(n.check,ge,2,0)),h=0,f=0}else n.head&&(n.head.extra=null);n.mode=16185;case 16185:if(1024&gi(n)&&(S=n.length,S>c&&(S=c),S&&(n.head&&(Y=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Uint8Array(n.head.extra_len)),n.head.extra.set(r.subarray(s,s+S),Y)),512&gi(n)&&4&n.wrap&&(n.check=Oi(n.check,r,S,s)),c-=S,s+=S,n.length-=S),n.length))break e;n.length=0,n.mode=16186;case 16186:if(2048&gi(n)){if(c===0)break e;S=0;do Y=r[s+S++],n.head&&Y&&n.length<65536&&(n.head.name+=String.fromCharCode(Y));while(Y&&S<c);if(512&gi(n)&&4&n.wrap&&(n.check=Oi(n.check,r,S,s)),c-=S,s+=S,Y)break e}else n.head&&(n.head.name=null);n.length=0,n.mode=16187;case 16187:if(4096&gi(n)){if(c===0)break e;S=0;do Y=r[s+S++],n.head&&Y&&n.length<65536&&(n.head.comment+=String.fromCharCode(Y));while(Y&&S<c);if(512&gi(n)&&4&n.wrap&&(n.check=Oi(n.check,r,S,s)),c-=S,s+=S,Y)break e}else n.head&&(n.head.comment=null);n.mode=16188;case 16188:if(512&gi(n)){for(;f<16;){if(c===0)break e;c--,h+=r[s++]<<f,f+=8}if(4&n.wrap&&h!==(65535&n.check)){e.msg="header crc mismatch",n.mode=br;break}h=0,f=0}n.head&&(n.head.hcrc=gi(n)>>9&1,n.head.done=!0),e.adler=n.check=0,n.mode=Il;break;case 16189:for(;f<32;){if(c===0)break e;c--,h+=r[s++]<<f,f+=8}e.adler=n.check=$j(h),h=0,f=0,n.mode=rR;case rR:if(n.havedict===0)return e.next_out=o,e.avail_out=d,e.next_in=s,e.avail_in=c,n.hold=h,n.bits=f,Yq;e.adler=n.check=1,n.mode=Il;case Il:if(t===Kq||t===tR)break e;case ZI:if(n.last){h>>>=7&f,f-=7&f,n.mode=eA;break}for(;f<3;){if(c===0)break e;c--,h+=r[s++]<<f,f+=8}switch(n.last=1&h,h>>>=1,f-=1,3&h){case 0:n.mode=16193;break;case 1:if(Jq(n),n.mode=iR,t===tR){h>>>=2,f-=2;break e}break;case 2:n.mode=16196;break;case 3:e.msg="invalid block type",n.mode=br}h>>>=2,f-=2;break;case 16193:for(h>>>=7&f,f-=7&f;f<32;){if(c===0)break e;c--,h+=r[s++]<<f,f+=8}if((65535&h)!=(h>>>16^65535)){e.msg="invalid stored block lengths",n.mode=br;break}if(n.length=65535&h,h=0,f=0,n.mode=$I,t===tR)break e;case $I:n.mode=16195;case 16195:if(S=n.length,S){if(S>c&&(S=c),S>d&&(S=d),S===0)break e;i.set(r.subarray(s,s+S),o),c-=S,s+=S,d-=S,o+=S,n.length-=S;break}n.mode=Il;break;case 16196:for(;f<14;){if(c===0)break e;c--,h+=r[s++]<<f,f+=8}if(n.nlen=257+(31&h),h>>>=5,f-=5,n.ndist=1+(31&h),h>>>=5,f-=5,n.ncode=4+(15&h),h>>>=4,f-=4,n.nlen>286||n.ndist>30){e.msg="too many length or distance symbols",n.mode=br;break}n.have=0,n.mode=16197;case 16197:for(;n.have<n.ncode;){for(;f<3;){if(c===0)break e;c--,h+=r[s++]<<f,f+=8}n.lens[Ct[n.have++]]=7&h,h>>>=3,f-=3}for(;n.have<19;)n.lens[Ct[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,Re={bits:n.lenbits},ie=LE(0,n.lens,0,19,n.lencode,0,n.work,Re),n.lenbits=Re.bits,ie){e.msg="invalid code lengths set",n.mode=br;break}n.have=0,n.mode=16198;case 16198:for(;n.have<n.nlen+n.ndist;){for(;ue=n.lencode[h&(1<<n.lenbits)-1],N=ue>>>24,j=ue>>>16&255,U=65535&ue,!(N<=f);){if(c===0)break e;c--,h+=r[s++]<<f,f+=8}if(U<16)h>>>=N,f-=N,n.lens[n.have++]=U;else{if(U===16){for(St=N+2;f<St;){if(c===0)break e;c--,h+=r[s++]<<f,f+=8}if(h>>>=N,f-=N,n.have===0){e.msg="invalid bit length repeat",n.mode=br;break}Y=n.lens[n.have-1],S=3+(3&h),h>>>=2,f-=2}else if(U===17){for(St=N+3;f<St;){if(c===0)break e;c--,h+=r[s++]<<f,f+=8}h>>>=N,f-=N,Y=0,S=3+(7&h),h>>>=3,f-=3}else{for(St=N+7;f<St;){if(c===0)break e;c--,h+=r[s++]<<f,f+=8}h>>>=N,f-=N,Y=0,S=11+(127&h),h>>>=7,f-=7}if(n.have+S>n.nlen+n.ndist){e.msg="invalid bit length repeat",n.mode=br;break}for(;S--;)n.lens[n.have++]=Y}}if(n.mode===br)break;if(n.lens[256]===0){e.msg="invalid code -- missing end-of-block",n.mode=br;break}if(n.lenbits=9,Re={bits:n.lenbits},ie=LE(1,n.lens,0,n.nlen,n.lencode,0,n.work,Re),n.lenbits=Re.bits,ie){e.msg="invalid literal/lengths set",n.mode=br;break}if(n.distbits=6,n.distcode=n.distdyn,Re={bits:n.distbits},ie=LE(2,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,Re),n.distbits=Re.bits,ie){e.msg="invalid distances set",n.mode=br;break}if(n.mode=iR,t===tR)break e;case iR:n.mode=sR;case sR:if(c>=6&&d>=258){e.next_out=o,e.avail_out=d,e.next_in=s,e.avail_in=c,n.hold=h,n.bits=f,Fq(e,E),o=e.next_out,i=e.output,d=e.avail_out,s=e.next_in,r=e.input,c=e.avail_in,h=n.hold,f=n.bits,n.mode===Il&&(n.back=-1);break}for(n.back=0;ue=n.lencode[h&(1<<n.lenbits)-1],N=ue>>>24,j=ue>>>16&255,U=65535&ue,!(N<=f);){if(c===0)break e;c--,h+=r[s++]<<f,f+=8}if(j&&(240&j)==0){for(W=N,$=j,Z=U;ue=n.lencode[Z+((h&(1<<W+$)-1)>>W)],N=ue>>>24,j=ue>>>16&255,U=65535&ue,!(W+N<=f);){if(c===0)break e;c--,h+=r[s++]<<f,f+=8}h>>>=W,f-=W,n.back+=W}if(h>>>=N,f-=N,n.back+=N,n.length=U,j===0){n.mode=16205;break}if(32&j){n.back=-1,n.mode=Il;break}if(64&j){e.msg="invalid literal/length code",n.mode=br;break}n.extra=15&j,n.mode=16201;case 16201:if(n.extra){for(St=n.extra;f<St;){if(c===0)break e;c--,h+=r[s++]<<f,f+=8}n.length+=h&(1<<n.extra)-1,h>>>=n.extra,f-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=16202;case 16202:for(;ue=n.distcode[h&(1<<n.distbits)-1],N=ue>>>24,j=ue>>>16&255,U=65535&ue,!(N<=f);){if(c===0)break e;c--,h+=r[s++]<<f,f+=8}if((240&j)==0){for(W=N,$=j,Z=U;ue=n.distcode[Z+((h&(1<<W+$)-1)>>W)],N=ue>>>24,j=ue>>>16&255,U=65535&ue,!(W+N<=f);){if(c===0)break e;c--,h+=r[s++]<<f,f+=8}h>>>=W,f-=W,n.back+=W}if(h>>>=N,f-=N,n.back+=N,64&j){e.msg="invalid distance code",n.mode=br;break}n.offset=U,n.extra=15&j,n.mode=16203;case 16203:if(n.extra){for(St=n.extra;f<St;){if(c===0)break e;c--,h+=r[s++]<<f,f+=8}n.offset+=h&(1<<n.extra)-1,h>>>=n.extra,f-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){e.msg="invalid distance too far back",n.mode=br;break}n.mode=16204;case 16204:if(d===0)break e;if(S=E-d,n.offset>S){if(S=n.offset-S,S>n.whave&&n.sane){e.msg="invalid distance too far back",n.mode=br;break}S>n.wnext?(S-=n.wnext,O=n.wsize-S):O=n.wnext-S,S>n.length&&(S=n.length),A=n.window}else A=i,O=o-n.offset,S=n.length;S>d&&(S=d),d-=S,n.length-=S;do i[o++]=A[O++];while(--S);n.length===0&&(n.mode=sR);break;case 16205:if(d===0)break e;i[o++]=n.length,d--,n.mode=sR;break;case eA:if(n.wrap){for(;f<32;){if(c===0)break e;c--,h|=r[s++]<<f,f+=8}if(E-=d,e.total_out+=E,n.total+=E,4&n.wrap&&E&&(e.adler=n.check=gi(n)?Oi(n.check,i,E,o-E):IE(n.check,i,E,o-E)),E=d,4&n.wrap&&(gi(n)?h:$j(h))!==n.check){e.msg="incorrect data check",n.mode=br;break}h=0,f=0}n.mode=16207;case 16207:if(n.wrap&&gi(n)){for(;f<32;){if(c===0)break e;c--,h+=r[s++]<<f,f+=8}if(4&n.wrap&&h!==(4294967295&n.total)){e.msg="incorrect length check",n.mode=br;break}h=0,f=0}n.mode=16208;case 16208:ie=zq;break e;case br:ie=Jj;break e;case 16210:return Qj;default:return Jo}return e.next_out=o,e.avail_out=d,e.next_in=s,e.avail_in=c,n.hold=h,n.bits=f,(n.wsize||E!==e.avail_out&&n.mode<br&&(n.mode<eA||t!==Xj))&&sV(e,e.output,e.next_out,E-e.avail_out),g-=e.avail_in,E-=e.avail_out,e.total_in+=g,e.total_out+=E,n.total+=E,4&n.wrap&&E&&(e.adler=n.check=gi(n)?Oi(n.check,i,E,e.next_out-E):IE(n.check,i,E,e.next_out-E)),e.data_type=n.bits+(n.last?64:0)+(n.mode===Il?128:0)+(n.mode===iR||n.mode===$I?256:0),(g===0&&E===0||t===Xj)&&ie===Bh&&(ie=qq),ie},Al={inflateReset:tV,inflateReset2:nV,inflateResetKeep:eV,inflateInit:e=>rV(e,15),inflateInit2:rV,inflate:Qq,inflateEnd:e=>{if(Wh(e))return Jo;let t=e.state;return t.window&&(t.window=null),e.state=null,Bh},inflateGetHeader:(e,t)=>{if(Wh(e))return Jo;const n=e.state;return(2&n.wrap)==0?Jo:(n.head=t,t.done=!1,Bh)},inflateSetDictionary:(e,t)=>{const n=t.length;let r,i,s;return Wh(e)?Jo:(r=e.state,r.wrap!==0&&r.mode!==rR?Jo:r.mode===rR&&(i=1,i=IE(i,t,n,0),i!==r.check)?Jj:(s=sV(e,t,n,n),s?(r.mode=16210,Qj):(r.havedict=1,Bh)))},inflateInfo:"pako inflate (from Nodeca project)"},Zq=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const oV=Object.prototype.toString,{Z_NO_FLUSH:$q,Z_FINISH:eX,Z_OK:ME,Z_STREAM_END:rA,Z_NEED_DICT:iA,Z_STREAM_ERROR:tX,Z_DATA_ERROR:aV,Z_MEM_ERROR:nX}=YT;function oR(e){this.options=JT.assign({chunkSize:65536,windowBits:15,to:""},e||{});const t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,t.windowBits===0&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&(15&t.windowBits)==0&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Yj,this.strm.avail_out=0;let n=Al.inflateInit2(this.strm,t.windowBits);if(n!==ME)throw new Error(Uh[n]);if(this.header=new Zq,Al.inflateGetHeader(this.strm,this.header),t.dictionary&&(typeof t.dictionary=="string"?t.dictionary=xE.string2buf(t.dictionary):oV.call(t.dictionary)==="[object ArrayBuffer]"&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(n=Al.inflateSetDictionary(this.strm,t.dictionary),n!==ME)))throw new Error(Uh[n])}function rX(e,t){const n=new oR(t);if(n.push(e),n.err)throw n.msg||Uh[n.err];return n.result}oR.prototype.push=function(e,t){const n=this.strm,r=this.options.chunkSize,i=this.options.dictionary;let s,o,c;if(this.ended)return!1;for(o=t===~~t?t:t===!0?eX:$q,oV.call(e)==="[object ArrayBuffer]"?n.input=new Uint8Array(e):n.input=e,n.next_in=0,n.avail_in=n.input.length;;){for(n.avail_out===0&&(n.output=new Uint8Array(r),n.next_out=0,n.avail_out=r),s=Al.inflate(n,o),s===iA&&i&&(s=Al.inflateSetDictionary(n,i),s===ME?s=Al.inflate(n,o):s===aV&&(s=iA));n.avail_in>0&&s===rA&&n.state.wrap>0&&e[n.next_in]!==0;)Al.inflateReset(n),s=Al.inflate(n,o);switch(s){case tX:case aV:case iA:case nX:return this.onEnd(s),this.ended=!0,!1}if(c=n.avail_out,n.next_out&&(n.avail_out===0||s===rA))if(this.options.to==="string"){let d=xE.utf8border(n.output,n.next_out),h=n.next_out-d,f=xE.buf2string(n.output,d);n.next_out=h,n.avail_out=r-h,h&&n.output.set(n.output.subarray(d,d+h),0),this.onData(f)}else this.onData(n.output.length===n.next_out?n.output:n.output.subarray(0,n.next_out));if(s!==ME||c!==0){if(s===rA)return s=Al.inflateEnd(this.strm),this.onEnd(s),this.ended=!0,!0;if(n.avail_in===0)break}}return!0},oR.prototype.onData=function(e){this.chunks.push(e)},oR.prototype.onEnd=function(e){e===ME&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=JT.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var iX={inflate:rX};const{deflate:sX}=Vq,{inflate:oX}=iX;var aX=sX,cX=oX,cV=(function(e){return e[e.ONE_BYTE=0]="ONE_BYTE",e[e.TWO_BYTE=1]="TWO_BYTE",e})(cV||{});class lX{constructor(){x(this,"_sequence",0),x(this,"_startTime",Date.now()),x(this,"isUseOneByte",!0)}get startTime(){const t=Date.now()-this._startTime;return t<Math.pow(2,16)?t:(this._startTime+=Math.pow(2,16),this.startTime)}get sequence(){return this._sequence<Math.pow(2,32)?this._sequence++:(this._sequence-=Math.pow(2,32),this.sequence)}serialize(t){const n={commonPacketHeader:{length:0,reserved:0,extension:0,sequence:this.sequence},commonStreamHeader:this.startTime,extension:void 0,payload:t};if(t.byteLength>128){const c=new Uint8Array(4);c.set([1,0,0,0]);const d={id:0,length:4,data:c.buffer},h={profile:this.isUseOneByte?0:1,length:this.isUseOneByte?5:6,datas:[d]};n.commonPacketHeader.extension=1,n.extension=h,n.payload=this.compress(t),n.commonPacketHeader.length=8+(n.extension.length+2)+n.payload.byteLength}else n.commonPacketHeader.length=8+n.payload.byteLength;B("SHOW_DATASTREAM2_LOG")&&w.debug("send data header: ".concat(JSON.stringify(n.commonPacketHeader)));const r=new ArrayBuffer(n.commonPacketHeader.length),i=new Uint8Array(r),s=new DataView(r);let o=0;if(s.setUint16(o,n.commonPacketHeader.extension<<15|n.commonPacketHeader.reserved<<14|n.commonPacketHeader.length,!0),o+=2,s.setUint32(o,n.commonPacketHeader.sequence,!0),o+=4,s.setUint16(o,n.commonStreamHeader,!0),o+=2,n.extension){const c=this.serializeExtension(n.extension);i.set(new Uint8Array(c),o),o+=c.byteLength}if(i.set(new Uint8Array(n.payload),o),o+=n.payload.byteLength,o!==n.commonPacketHeader.length)throw Error("serialize error!");return r}deserialize(t){if(t.byteLength<4)return new ArrayBuffer(0);const n=new DataView(t);let r=0;const i=n.getUint16(r,!0);r+=2;const s={length:16383&i,reserved:(16384&i)>>14,extension:(32768&i)>>15,sequence:n.getUint16(r+2,!0)<<16|n.getUint16(r,!0)};let o,c;if(r+=4,B("SHOW_DATASTREAM2_LOG")&&w.debug("receive data header: ".concat(JSON.stringify(s))),n.getUint16(r,!0),r+=2,s.extension){c=this.deserializeExtension(t.slice(r)),r+=2+c.length,o=t.slice(r);let d=!1;if(c.datas.length>0){const h=c.datas.find((f=>f.id===0));h&&(d=(1&new DataView(h.data).getUint32(0,!0))==1)}o=d?this.decompress(o):o}else o=t.slice(8);return o}serializeExtension(t){const{profile:n,length:r,datas:i}=t,s=new ArrayBuffer(r+2),o=new Uint8Array(s),c=new DataView(s);let d=0;if(c.setUint8(d++,n),c.setUint8(d++,r),i.forEach((h=>{n?(c.setUint8(d++,h.id),c.setUint8(d++,h.length),o.set(new Uint8Array(h.data),d),d+=h.data.byteLength):(c.setUint8(d++,h.id|h.length<<4),o.set(new Uint8Array(h.data),d),d+=h.data.byteLength)})),d!==r+2)throw Error("serialize extension error, is ".concat(d,"!==").concat(r+2));return s}deserializeExtension(t){const n=new DataView(t);let r=0;const i=n.getUint8(r);r++;const s=n.getUint8(r);r++;const o=i===cV.TWO_BYTE,c=[],d=new DataView(t,2);let h=0;for(;h<s;){let f=0,g=0,E=new ArrayBuffer(0);o?(f=d.getUint8(h),h++,g=d.getUint8(h),h++):(f=15&d.getUint8(h),g=d.getUint8(h)>>4,h++),g>0&&(E=d.buffer.slice(h+2,h+2+g),h+=E.byteLength),c.push({id:f,length:g,data:E})}if(h!==s)throw Error("parse error");return{profile:i,length:s,datas:c}}decompress(t){return cX(new Uint8Array(t))}compress(t){return aX(new Uint8Array(t))}}const dX={name:"DataStream",create:(e,t)=>{const n=t?new E9(e):new v9(e);return n.useDataStream(new lX),n}};class uX extends xn{constructor(t,n,r){super(),x(this,"ws",void 0),x(this,"requestId",1),x(this,"heartBeatTimer",void 0),x(this,"joinInfo",void 0),x(this,"clientId",void 0),x(this,"onOpen",(()=>{this.emit("open"),this.startHeartBeatCheck()})),x(this,"onClose",(i=>{this.emit("close"),this.dispose()})),x(this,"onMessage",(i=>{const s=JSON.parse(i.data);if(!s||s.command!=="serverResponse"||!s.requestId)return s&&s.command==="serverStatus"&&s.serverStatus&&s.serverStatus.command?(this.emit("status",s.serverStatus),void this.emit(s.serverStatus.command,s.serverStatus)):void 0;this.emit("req_".concat(s.requestId),s)})),this.joinInfo=t,this.clientId=n,this.ws=new cE("cross-channel-".concat(this.clientId),r),this.ws.on(Et.RECONNECTING,(()=>{this.ws.reconnectMode="retry",this.emit("reconnecting")})),this.ws.on(Et.CONNECTED,this.onOpen),this.ws.on(Et.ON_MESSAGE,this.onMessage),this.ws.on(Et.CLOSED,this.onClose)}isConnect(){return this.ws.state==="connected"}sendMessage(t){const n=this.requestId++;return t.requestId=n,t.seq=n,this.ws.sendMessage(t),n}waitStatus(t){return new ke(((n,r)=>{const i=window.setTimeout((()=>{r(new le(V.TIMEOUT,"wait status timeout, status: ".concat(t)))}),5e3);this.once(t,(s=>{window.clearTimeout(i),s.state&&s.state!==0?r(new le(V.CROSS_CHANNEL_WAIT_STATUS_ERROR,"wait status error, status: ".concat(t))):n(void 0)})),this.once("dispose",(()=>{window.clearTimeout(i),r(new le(V.WS_ABORT))}))}))}async request(t){if(this.ws.state==="closed")throw new le(V.WS_DISCONNECT);const n=()=>new ke(((o,c)=>{this.ws.once(Et.CLOSED,(()=>c(new le(V.WS_ABORT)))),this.ws.once(Et.CONNECTED,o)}));this.ws.state!=="connected"&&await n();const r=this.sendMessage(t),i=new ke(((o,c)=>{const d=()=>{c(new le(V.WS_ABORT))};this.ws.once(Et.RECONNECTING,d),this.ws.once(Et.CLOSED,d),this.once("req_".concat(r),o),xr(3e3).then((()=>{this.removeAllListeners("req_".concat(r)),this.ws.off(Et.RECONNECTING,d),this.ws.off(Et.CLOSED,d),c(new le(V.TIMEOUT,"cross channel ws request timeout"))}))})),s=await i;if(!s||s.code!==200)throw new le(V.CROSS_CHANNEL_SERVER_ERROR_RESPONSE,"response: ".concat(JSON.stringify(s)));return s}async connect(t){this.ws.removeAllListeners(Et.REQUEST_NEW_URLS),this.ws.on(Et.REQUEST_NEW_URLS,(n=>{n(t)})),await this.ws.init(t)}dispose(){this.clearHeartBeatCheck(),this.emit("dispose"),this.removeAllListeners(),this.ws.close()}sendPing(t){const n=this.requestId++;return t.requestId=n,this.ws.sendMessage(t),n}startHeartBeatCheck(){this.heartBeatTimer&&window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=window.setInterval((()=>{this.sendPing({command:"ping",appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sid:this.joinInfo.sid,ts:+new Date,requestId:0})}),3e3)}clearHeartBeatCheck(){window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=void 0}}class hX extends xn{set state(t){t!==this._state&&(t!==ts.RELAY_STATE_FAILURE&&(this.errorCode=Zf.RELAY_OK),this.emit("state",t,this.errorCode),this._state=t)}get state(){return this._state}constructor(t,n,r,i,s){super(),x(this,"joinInfo",void 0),x(this,"sid",void 0),x(this,"clientId",void 0),x(this,"cancelToken",ji.CancelToken.source()),x(this,"workerToken",void 0),x(this,"requestId",0),x(this,"signal",void 0),x(this,"prevChannelMediaConfig",void 0),x(this,"httpRetryConfig",void 0),x(this,"_resolution",void 0),x(this,"_state",ts.RELAY_STATE_IDLE),x(this,"errorCode",Zf.RELAY_OK),x(this,"onStatus",(o=>{w.debug("[".concat(this.clientId,"] ChannelMediaStatus: ").concat(JSON.stringify(o))),o&&o.command&&(o.command==="onAudioPacketReceived"&&this.emit("event",Tl.PACKET_RECEIVED_AUDIO_FROM_SRC),o.command==="onVideoPacketReceived"&&this.emit("event",Tl.PACKET_RECEIVED_VIDEO_FROM_SRC),o.command==="onSrcTokenPrivilegeDidExpire"&&(this.errorCode=Zf.SRC_TOKEN_EXPIRED,this.state=ts.RELAY_STATE_FAILURE),o.command==="onDestTokenPrivilegeDidExpire"&&(this.errorCode=Zf.DEST_TOKEN_EXPIRED,this.state=ts.RELAY_STATE_FAILURE))})),x(this,"onReconnect",(async()=>{w.debug("[".concat(this.clientId,"] ChannelMediaSocket disconnect, reconnecting")),this.emit("event",Tl.NETWORK_DISCONNECTED),this.state=ts.RELAY_STATE_IDLE,this.prevChannelMediaConfig&&this.sendStartRelayMessage(this.prevChannelMediaConfig).catch((o=>{this.state!==ts.RELAY_STATE_IDLE&&(w.error("auto restart channel media relay failed",o.toString()),this.errorCode=Zf.SERVER_CONNECTION_LOST,this.state=ts.RELAY_STATE_FAILURE)}))})),this.joinInfo=t,this.clientId=n,this.sid=Rh(),this.signal=new uX(this.joinInfo,this.clientId,r),this.httpRetryConfig=i,this._resolution=s}async startChannelMediaRelay(t){if(this.state!==ts.RELAY_STATE_IDLE)throw new le(V.INVALID_OPERATION);this.state=ts.RELAY_STATE_CONNECTING,await this.connect(),w.debug("[".concat(this.clientId,"] startChannelMediaRelay: connect success"));try{await this.sendStartRelayMessage(t)}catch(n){throw n.data&&n.data.serverResponse&&n.data.serverResponse.command==="SetSourceChannel"?new le(V.CROSS_CHANNEL_FAILED_JOIN_SRC):n.data&&n.data.serverResponse&&n.serverResponse.command==="SetDestChannelStatus"?new le(V.CROSS_CHANNEL_FAILED_JOIN_DEST):n.data&&n.data.serverResponse&&n.serverResponse.command==="StartPacketTransfer"?new le(V.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST):n}this.prevChannelMediaConfig=t}async updateChannelMediaRelay(t){if(this.state!==ts.RELAY_STATE_RUNNING)throw new le(V.INVALID_OPERATION);await this.sendUpdateMessage(t),this.prevChannelMediaConfig=t}async setVideoProfile(t){if(this._resolution=t,this.state!==ts.RELAY_STATE_RUNNING)throw new le(V.INVALID_OPERATION);const n=this.genMessage(Ni.SetVideoProfile);await this.signal.request(n),w.debug("[".concat(this.clientId,"] startChannelMediaRelay: setVideoProfile success"))}async stopChannelMediaRelay(){await this.sendStopRelayMessage(),w.debug("[".concat(this.clientId,"] stopChannelMediaRelay: send stop message success")),this.state=ts.RELAY_STATE_IDLE,this.dispose()}dispose(){w.debug("[".concat(this.clientId,"] disposeChannelMediaRelay")),this.cancelToken.cancel(),this.cancelToken=ji.CancelToken.source(),this.state=ts.RELAY_STATE_IDLE,this.emit("dispose"),this.signal.dispose(),this.prevChannelMediaConfig=void 0}async connect(){const t=await w7(this.joinInfo,this.cancelToken.token,this.httpRetryConfig);this.workerToken=t.workerToken,await this.signal.connect(t.addressList),this.emit("event",Tl.NETWORK_CONNECTED),this.signal.on("status",this.onStatus),this.signal.on("reconnecting",this.onReconnect)}async sendStartRelayMessage(t){const n=this.genMessage(Ni.StopPacketTransfer);await this.signal.request(n),await this.signal.waitStatus("Normal Quit"),w.debug("[".concat(this.clientId,"] startChannelMediaRelay: StopPacketTransfer success"));const r=this.genMessage(Ni.SetSdkProfile,t);await this.signal.request(r),w.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSdkProfile success"));const i=this.genMessage(Ni.SetSourceChannel,t);await this.signal.request(i),await this.signal.waitStatus("SetSourceChannelStatus"),this.emit("event",Tl.PACKET_JOINED_SRC_CHANNEL),w.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceChannel success"));const s=this.genMessage(Ni.SetSourceUserId,t);await this.signal.request(s),w.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceUserId success"));const o=this.genMessage(Ni.SetDestChannel,t);await this.signal.request(o),await this.signal.waitStatus("SetDestChannelStatus"),this.emit("event",Tl.PACKET_JOINED_DEST_CHANNEL),w.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetDestChannel success"));const c=this.genMessage(Ni.StartPacketTransfer,t);await this.signal.request(c),this.emit("event",Tl.PACKET_SENT_TO_DEST_CHANNEL),this.state=ts.RELAY_STATE_RUNNING,w.debug("[".concat(this.clientId,"] startChannelMediaRelay: StartPacketTransfer success")),this.setVideoProfile(this._resolution)}async sendUpdateMessage(t){const n=this.genMessage(Ni.UpdateDestChannel,t);await this.signal.request(n),this.emit("event",Tl.PACKET_UPDATE_DEST_CHANNEL),w.debug("[".concat(this.clientId,"] sendUpdateMessage: UpdateDestChannel success"))}async sendStopRelayMessage(){const t=this.genMessage(Ni.StopPacketTransfer);await this.signal.request(t),w.debug("[".concat(this.clientId,"] sendStopRelayMessage: StopPacketTransfer success"))}genMessage(t,n){const r=[],i=[],s=[];this.requestId+=1;const o={appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sdkVersion:ro,sid:this.sid,ts:Date.now(),requestId:this.requestId,seq:this.requestId,allocate:!0,clientRequest:{}};o.sdkVersion==="4.24.0"&&(o.sdkVersion="0.0.1");let c=null,d=null;switch(t){case Ni.SetSdkProfile:return o.clientRequest={command:"SetSdkProfile",type:"multi_channel"},o;case Ni.SetSourceChannel:if(d=n&&n.getSrcChannelMediaInfo(),!d)throw new le(V.UNEXPECTED_ERROR,"can not find source config");return o.clientRequest={command:"SetSourceChannel",uid:"0",channelName:d.channelName,token:d.token||this.joinInfo.appId},o;case Ni.SetSourceUserId:if(d=n&&n.getSrcChannelMediaInfo(),!d)throw new le(V.UNEXPECTED_ERROR,"can not find source config");return o.clientRequest={command:"SetSourceUserId",uid:d.uid+""},o;case Ni.SetDestChannel:if(c=n&&n.getDestChannelMediaInfo(),!c)throw new le(V.UNEXPECTED_ERROR,"can not find dest config");return c.forEach((h=>{r.push(h.channelName),i.push(h.uid+""),s.push(h.token||this.joinInfo.appId)})),o.clientRequest={command:"SetDestChannel",channelName:r,uid:i,token:s},o;case Ni.StartPacketTransfer:return o.clientRequest={command:"StartPacketTransfer"},o;case Ni.Reconnect:return o.clientRequest={command:"Reconnect"},o;case Ni.StopPacketTransfer:return o.clientRequest={command:"StopPacketTransfer"},o;case Ni.UpdateDestChannel:if(c=n&&n.getDestChannelMediaInfo(),!c)throw new le(V.UNEXPECTED_ERROR,"can not find dest config");return c.forEach((h=>{r.push(h.channelName),i.push(h.uid+""),s.push(h.token||this.joinInfo.appId)})),o.clientRequest={command:"UpdateDestChannel",channelName:r,uid:i,token:s},o;case Ni.SetVideoProfile:o.clientRequest={command:"SetVideoProfile",width:this._resolution.width,height:this._resolution.height}}return o}}const pX={name:"ChannelMediaRelay",create:function(e){return new hX(e.joinInfo,e.clientId,e.websocketRetryConfig||rr,e.httpRetryConfig||rr,e.resolution)}};function lV(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable}))),n.push.apply(n,r)}return n}function UE(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?lV(Object(n),!0).forEach((function(r){x(e,r,n[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):lV(Object(n)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))}))}return e}class fX extends xn{constructor(t,n,r,i){super(),x(this,"spec",void 0),x(this,"token",void 0),x(this,"websocket",void 0),x(this,"pingpongTimer",void 0),x(this,"reconnectMode","retry"),x(this,"serviceMode",void 0),x(this,"reqId",0),x(this,"commandReqId",0),x(this,"handleWebSocketOpen",(()=>{this.reconnectMode="retry",this.startPingPong()})),x(this,"handleWebSocketMessage",(s=>{if(!s.data)return;const o=JSON.parse(s.data);o.requestId?this.emit("@".concat(o.requestId,"-").concat(o.sid),o):(We.workerEvent(this.spec.sid,{actionType:"status",serverCode:o.code,workerType:this.serviceMode===Sl.TRANSCODE?1:2}),this.emit(Pd.PUBLISH_STREAM_STATUS,o))})),this.spec=n,this.token=t,this.serviceMode=i,this.websocket=new cE("live-streaming",r),this.websocket.on(Et.CONNECTED,this.handleWebSocketOpen),this.websocket.on(Et.ON_MESSAGE,this.handleWebSocketMessage),this.websocket.on(Et.REQUEST_NEW_URLS,((s,o)=>{Gr(this,Pd.REQUEST_NEW_ADDRESS).then(s).catch(o)})),this.websocket.on(Et.RECONNECTING,(()=>{this.websocket.reconnectMode=this.reconnectMode}))}init(t){return this.websocket.init(t)}async request(t,n,r,i){this.reqId+=1,t==="request"&&(this.commandReqId+=1);const s=this.commandReqId,o=this.reqId;if(!o||!this.websocket)throw new le(V.UNEXPECTED_ERROR);const c=UE({command:t,sdkVersion:ro==="4.24.0"?"0.0.1":ro,seq:o,requestId:o,allocate:r,cname:this.spec.cname,appId:this.spec.appId,sid:this.spec.sid,uid:this.spec.uid.toString(),ts:Math.floor(Date.now()/1e3)},n);if(this.websocket.state==="closed")throw new le(V.WS_DISCONNECT);const d=()=>new ke(((E,S)=>{this.websocket.once(Et.CLOSED,(()=>S(new le(V.WS_ABORT)))),this.websocket.once(Et.CONNECTED,E)}));this.websocket.state!=="connected"&&await d(),c.clientRequest&&(c.clientRequest.workerToken=this.token);const h=new ke(((E,S)=>{const O=()=>{S(new le(V.WS_ABORT))};this.websocket.once(Et.RECONNECTING,O),this.websocket.once(Et.CLOSED,O),this.once("@".concat(o,"-").concat(this.spec.sid),(A=>{E(A)}))}));i&&We.workerEvent(this.spec.sid,UE(UE({},i),{},{requestId:s,actionType:"request",payload:JSON.stringify(n.clientRequest),serverCode:0,code:0}));const f=Date.now();this.websocket.sendMessage(c);let g=null;try{g=await h}catch(E){if(this.websocket.state==="closed")throw E;return await d(),await this.request(t,n,r)}return i&&We.workerEvent(this.spec.sid,UE(UE({},i),{},{requestId:s,actionType:"response",payload:JSON.stringify(g.serverResponse),serverCode:g.code,success:g.code===200,responseTime:Date.now()-f})),g.code!==200&&this.handleResponseError(g),g}tryNextAddress(){this.reconnectMode="tryNext",this.websocket.reconnect("tryNext")}close(){const t=ro==="4.24.0"?"0.0.1":ro;this.reqId+=1,this.websocket.state==="connected"?(this.websocket.sendMessage({command:"request",appId:this.spec.appId,cname:this.spec.cname,uid:this.spec.uid.toString(),sdkVersion:t,sid:this.spec.sid,seq:this.reqId,ts:Math.floor(Date.now()/1e3),requestId:this.reqId,clientRequest:{command:"DestroyWorker"}}),this.websocket.close(!1,!0)):this.websocket.close(!1),this.pingpongTimer&&(window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0)}handleResponseError(t){switch(t.code){case lr.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM:return void w.warning("live stream response already exists stream");case lr.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR:case lr.LIVE_STREAM_RESPONSE_BAD_STREAM:case lr.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR:return new le(V.LIVE_STREAMING_INVALID_ARGUMENT,"",{code:t.code}).throw();case lr.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST:if(t.serverResponse.command==="UnpublishStream")return;throw new le(V.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case lr.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED:return new le(V.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED,"",{code:t.code}).throw();case lr.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const n=new le(V.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE);return this.emit(Pd.WARNING,n,t.serverResponse.url)}case lr.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN:{const n=new le(V.LIVE_STREAMING_WARN_FREQUENT_REQUEST);return this.emit(Pd.WARNING,n,t.serverResponse.url)}case lr.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH:throw new le(V.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case lr.LIVE_STREAM_RESPONSE_NOT_SUPPORTED:return new le(V.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED,"",{code:t.code}).throw();case lr.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM:{const n=new le(V.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT);return this.emit(Pd.WARNING,n,t.serverResponse.url)}case lr.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR:return new le(V.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:t.code}).throw();case lr.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT:throw new le(V.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream resource limit",{retry:!0,changeAddress:!0});case lr.LIVE_STREAM_RESPONSE_WORKER_LOST:case lr.LIVE_STREAM_RESPONSE_WORKER_QUIT:if(t.serverResponse.command==="UnpublishStream")return;throw new le(V.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case lr.ERROR_FAIL_SEND_MESSAGE:if(t.serverResponse.command==="UnpublishStream")return;if(t.serverResponse.command==="UpdateTranscoding"||t.serverResponse.command==="ControlStream")return new le(V.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{code:t.code}).throw();throw new le(V.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case lr.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case lr.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case lr.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case lr.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:return new le(V.LIVE_STREAMING_CDN_ERROR,"",{code:t.code}).throw()}}startPingPong(){this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval((()=>{this.websocket.state==="connected"&&this.request("ping",{}).catch(KS)}),6e3)}}function dV(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable}))),n.push.apply(n,r)}return n}function ns(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?dV(Object(n),!0).forEach((function(r){x(e,r,n[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):dV(Object(n)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))}))}return e}class mX extends xn{constructor(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:rr,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:rr;super(),x(this,"onLiveStreamWarning",void 0),x(this,"onLiveStreamError",void 0),x(this,"spec",void 0),x(this,"retryTimeout",1e4),x(this,"connection",void 0),x(this,"httpRetryConfig",void 0),x(this,"wsRetryConfig",void 0),x(this,"streamingTasks",new Map),x(this,"isStartingStreamingTask",!1),x(this,"taskMutex",new Jr("live-streaming")),x(this,"cancelToken",ji.CancelToken.source()),x(this,"transcodingConfig",void 0),x(this,"uapResponse",void 0),x(this,"lastTaskId",1),x(this,"statusError",new Map),this.spec=t,this.httpRetryConfig=r,this.wsRetryConfig=n}async setTranscodingConfig(t){const n=ns(ns({},n7),t);n.videoCodecProfile!==66&&n.videoCodecProfile!==77&&n.videoCodecProfile!==100&&(w.debug("[".concat(this.spec.clientId,"] set transcoding config, fix video codec profile: ").concat(n.videoCodecProfile," -> 100")),n.videoCodecProfile=100),n.transcodingUsers||(n.transcodingUsers=n.userConfigs),n.transcodingUsers&&(n.transcodingUsers=n.transcodingUsers.map((o=>ns(ns(ns({},t7),o),{},{zOrder:o.zOrder?o.zOrder+1:1})))),(function(o){Vn(o.width)||cn(o.width,"config.width",0,1e4),Vn(o.height)||cn(o.height,"config.height",0,1e4),Vn(o.videoBitrate)||cn(o.videoBitrate,"config.videoBitrate",1,1e6),Vn(o.videoFrameRate)||cn(o.videoFrameRate,"config.videoFrameRate"),Vn(o.lowLatency)||wa(o.lowLatency,"config.lowLatency"),Vn(o.audioSampleRate)||pr(o.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),Vn(o.audioBitrate)||cn(o.audioBitrate,"config.audioBitrate",1,128),Vn(o.audioChannels)||pr(o.audioChannels,"config.audioChannels",[1,2,3,4,5]),Vn(o.videoGop)||cn(o.videoGop,"config.videoGop"),Vn(o.videoCodecProfile)||pr(o.videoCodecProfile,"config.videoCodecProfile",[66,77,100]),Vn(o.userCount)||cn(o.userCount,"config.userCount",0,17),Vn(o.backgroundColor)||cn(o.backgroundColor,"config.backgroundColor",0,16777215),Vn(o.userConfigExtraInfo)||kr(o.userConfigExtraInfo,"config.userConfigExtraInfo",0,4096,!1),o.transcodingUsers&&!Vn(o.transcodingUsers)&&(yl(o.transcodingUsers,"config.transcodingUsers"),o.transcodingUsers.forEach(((c,d)=>{mT(c.uid),Vn(c.x)||cn(c.x,"transcodingUser[".concat(d,"].x"),0,1e4),Vn(c.y)||cn(c.y,"transcodingUser[".concat(d,"].y"),0,1e4),Vn(c.width)||cn(c.width,"transcodingUser[".concat(d,"].width"),0,1e4),Vn(c.height)||cn(c.height,"transcodingUser[".concat(d,"].height"),0,1e4),Vn(c.zOrder)||cn(c.zOrder-1,"transcodingUser[".concat(d,"].zOrder"),0,100),Vn(c.alpha)||cn(c.alpha,"transcodingUser[".concat(d,"].alpha"),0,1,!1)}))),Vn(o.watermark)||rI(o.watermark,"watermark"),Vn(o.backgroundImage)||rI(o.backgroundImage,"backgroundImage"),o.images&&!Vn(o.images)&&(yl(o.images,"config.images"),o.images.forEach(((c,d)=>{rI(c,"images[".concat(d,"]"))})))})(n);const r=[];n.images&&r.push(...n.images.map((o=>ns(ns(ns({},nI),o),{},{zOrder:255})))),n.backgroundImage&&(r.push(ns(ns(ns({},nI),n.backgroundImage),{},{zOrder:0})),delete n.backgroundImage),n.watermark&&(r.push(ns(ns(ns({},nI),n.watermark),{},{zOrder:255})),delete n.watermark),n.images=r,n.transcodingUsers&&(n.userConfigs=n.transcodingUsers.map((o=>ns({},o))),n.userCount=n.transcodingUsers.length,delete n.transcodingUsers);const i=(n.userConfigs||[]).map((o=>typeof o.uid=="number"?ke.resolve(o.uid):L2(o.uid,this.spec,this.cancelToken.token,this.httpRetryConfig)));if((await ke.all(i)).forEach(((o,c)=>{n.userConfigs&&n.userConfigs[c]&&(n.userConfigs[c].uid=o)})),this.transcodingConfig=n,this.connection)try{var s;const o=await this.connection.request("request",{clientRequest:{command:"UpdateTranscoding",transcodingConfig:this.transcodingConfig}},!1,{command:"UpdateTranscoding",workerType:1,requestByUser:!0,tid:Array.from(fs(s=this.streamingTasks).call(s)).map((c=>c.taskId)).join("#")});w.debug("[".concat(this.spec.clientId,"] update live transcoding config success, code: ").concat(o.code,", config:"),JSON.stringify(this.transcodingConfig))}catch(o){if(!o.data||!o.data.retry)throw o;o.data.changeAddress&&this.connection.tryNextAddress(),this.streamingTasks.forEach((c=>{w.warning("[".concat(this.spec.clientId,"] live streaming receive error"),o.toString(),"try to republish",c.url),this.startLiveStreamingTask(c.url,c.mode,o).then((()=>{w.debug("[".concat(this.spec.clientId,"] live streaming republish ").concat(c.url," success"))})).catch((d=>{w.error("[".concat(this.spec.clientId,"] live streaming republish failed"),c.url,d.toString()),this.onLiveStreamError&&this.onLiveStreamError(c.url,d)}))}))}}async startLiveStreamingTask(t,n,r){if(!this.transcodingConfig&&n===Sl.TRANSCODE)throw new le(V.INVALID_OPERATION,"[LiveStreaming] no transcoding config found, can not start transcoding streaming task");const i={command:"PublishStream",ts:Date.now(),url:t,uid:this.spec.uid.toString(),autoDestroyTime:100,acceptImageTimeout:!0};w.debug("[".concat(this.spec.clientId,"] start live streaming ").concat(t,", mode: ").concat(n));const s=await this.taskMutex.lock();if(!this.connection&&r)return void s();if(this.streamingTasks.get(t)&&!r)return s(),new le(V.LIVE_STREAMING_TASK_CONFLICT).throw();try{this.connection||(this.connection=await this.connect(n))}catch(c){throw s(),c}switch(n){case Sl.TRANSCODE:i.transcodingConfig=ns({},this.transcodingConfig)}this.uapResponse&&this.uapResponse.vid&&(i.vid=this.uapResponse.vid),this.isStartingStreamingTask=!0;const o=this.lastTaskId++;try{const c=new ke(((h,f)=>{xr(this.retryTimeout).then((()=>{if(r)return f(r);const g=this.statusError.get(t);return g?(this.statusError.delete(t),f(g)):void 0}))})),d=await ke.race([this.connection.request("request",{clientRequest:i},!0,{url:t,command:"PublishStream",workerType:n===Sl.TRANSCODE?1:2,requestByUser:!r,tid:o.toString()}),c]);this.isStartingStreamingTask=!1,w.debug("[".concat(this.spec.clientId,"] live streaming started, code: ").concat(d.code)),this.streamingTasks.set(t,{clientRequest:i,mode:n,url:t,taskId:o}),s()}catch(c){if(s(),this.isStartingStreamingTask=!1,!c.data||!c.data.retry||r)throw c;return c.data.changeAddress?(this.connection.tryNextAddress(),await this.startLiveStreamingTask(t,n,c)):await this.startLiveStreamingTask(t,n,c)}}stopLiveStreamingTask(t){return new ke(((n,r)=>{const i=this.streamingTasks.get(t);if(!i||!this.connection)return new le(V.UNEXPECTED_ERROR,"can not find streaming task to stop").throw();const s=i.mode;i.abortTask=()=>{w.debug("[".concat(this.spec.clientId,"] stop live streaming success(worker exception)")),this.streamingTasks.delete(t),n()},this.connection.request("request",{clientRequest:{command:"UnpublishStream",url:i.url}},!1,{url:t,command:"UnPublishStream",workerType:s===Sl.TRANSCODE?1:2,requestByUser:!0,tid:(this.lastTaskId++).toString()}).then((o=>{w.debug("[".concat(this.spec.clientId,"] stop live streaming success, code: ").concat(o.code)),this.streamingTasks.delete(t),this.streamingTasks.size===0&&(this.connection&&this.connection.close(),this.connection=void 0),n()})).catch(r)}))}resetAllTask(){var t;const n=Array.from(fs(t=this.streamingTasks).call(t));this.terminate();for(const r of n)this.startLiveStreamingTask(r.url,r.mode).catch((i=>{this.onLiveStreamError&&this.onLiveStreamError(r.url,i)}))}terminate(){this.cancelToken&&this.cancelToken.cancel(),this.streamingTasks=new Map,this.isStartingStreamingTask=!1,this.statusError=new Map,this.cancelToken=ji.CancelToken.source(),this.uapResponse=void 0,this.connection&&this.connection.close(),this.connection=void 0}async connect(t){if(this.connection)throw new le(V.UNEXPECTED_ERROR,"live streaming connection has already connected");const n=await Gr(this,iI.REQUEST_WORKER_MANAGER_LIST,t);return this.uapResponse=n,this.connection=new fX(n.workerToken,this.spec,this.wsRetryConfig,t),this.connection.on(Pd.WARNING,((r,i)=>this.onLiveStreamWarning&&this.onLiveStreamWarning(i,r))),this.connection.on(Pd.PUBLISH_STREAM_STATUS,(r=>this.handlePublishStreamServer(r))),this.connection.on(Pd.REQUEST_NEW_ADDRESS,((r,i)=>{if(!this.connection)return i(new le(V.UNEXPECTED_ERROR,"can not get new live streaming address list"));Gr(this,iI.REQUEST_WORKER_MANAGER_LIST,t).then((s=>{this.uapResponse=s,r(s.addressList)})).catch(i)})),await this.connection.init(n.addressList),this.connection}handlePublishStreamServer(t){const n=t.serverStatus&&t.serverStatus.url||"empty_url",r=this.streamingTasks.get(n),i=t.reason;switch(t.code){case lr.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case lr.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case lr.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case lr.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:{const o=new le(V.LIVE_STREAMING_CDN_ERROR,"",{code:t.code});if(r)return w.error(o.toString()),this.onLiveStreamError&&this.onLiveStreamError(n,o);if(!this.isStartingStreamingTask)return;this.statusError.set(n,o)}case lr.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const o=new le(V.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE,i);return this.onLiveStreamWarning&&this.onLiveStreamWarning(n,o)}case lr.LIVE_STREAM_RESPONSE_WORKER_LOST:case lr.LIVE_STREAM_RESPONSE_WORKER_QUIT:{var s;if(!this.connection)return;this.connection.tryNextAddress();const o=Array.from(fs(s=this.streamingTasks).call(s));for(const c of o)c.abortTask?c.abortTask():(w.warning("[".concat(this.spec.clientId,"] publish stream status code"),t.code,"try to republish",c.url),this.startLiveStreamingTask(c.url,c.mode,new le(V.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:t.code})).then((()=>{w.debug("[".concat(this.spec.clientId,"] republish live stream success"),c.url)})).catch((d=>{w.error(d.toString()),this.onLiveStreamError&&this.onLiveStreamError(c.url,d)})));return}}}hasUrl(t){return this.streamingTasks.has(t)}}const _X={name:"LiveStreaming",create:function(e){return new mX(e.joinInfo,e.websocketRetryConfig||rr,e.httpRetryConfig||rr)}};function gX(e){let t=pV();return(function(n,r){let i=n.appId;i!==void 0&&(rn(r,10),Mc(r,i));let s=n.cid;s!==void 0&&(rn(r,16),rn(r,s));let o=n.cname;o!==void 0&&(rn(r,26),Mc(r,o));let c=n.deviceId;c!==void 0&&(rn(r,34),Mc(r,c));let d=n.elapse;d!==void 0&&(rn(r,40),Yd(r,d));let h=n.fileSize;h!==void 0&&(rn(r,48),Yd(r,mm(h)));let f=n.height;f!==void 0&&(rn(r,56),Yd(r,mm(f)));let g=n.jpg;g!==void 0&&(rn(r,66),rn(r,g.length),(function(ti,_e){let Ae=_m(ti,_e.length);ti.bytes.set(_e,Ae)})(r,g));let E=n.networkType;E!==void 0&&(rn(r,72),Yd(r,mm(E)));let S=n.osType;S!==void 0&&(rn(r,80),Yd(r,mm(S)));let O=n.requestId;O!==void 0&&(rn(r,90),Mc(r,O));let A=n.sdkVersion;A!==void 0&&(rn(r,98),Mc(r,A));let N=n.sequence;N!==void 0&&(rn(r,104),Yd(r,mm(N)));let j=n.sid;j!==void 0&&(rn(r,114),Mc(r,j));let U=n.timestamp;U!==void 0&&(rn(r,120),Yd(r,U));let W=n.uid;W!==void 0&&(rn(r,128),rn(r,W));let $=n.vid;$!==void 0&&(rn(r,136),rn(r,$));let Z=n.width;Z!==void 0&&(rn(r,144),Yd(r,mm(Z)));let Y=n.service;Y!==void 0&&(rn(r,152),rn(r,Y));let ie=n.callbackData;ie!==void 0&&(rn(r,162),Mc(r,ie));let ue=n.jpgEncryption;ue!==void 0&&(rn(r,168),rn(r,ue));let ge=n.requestType;ge!==void 0&&(rn(r,176),rn(r,ge));let Re=n.scorePorn;Re!==void 0&&(rn(r,185),lA(r,Re));let St=n.scoreSexy;St!==void 0&&(rn(r,193),lA(r,St));let Ct=n.scoreNeutral;Ct!==void 0&&(rn(r,201),lA(r,Ct));let at=n.scene;at!==void 0&&(rn(r,208),rn(r,at));let Qt=n.ossFilePrefix;Qt!==void 0&&(rn(r,218),Mc(r,Qt));let qt=n.serviceVendor;if(qt!==void 0)for(let ti of qt){rn(r,226);let _e=pV();yX(ti,_e),rn(r,_e.limit),wX(r,_e),RX(_e)}})(e,t),(function(n){let r=n.bytes,i=n.limit;return r.length===i?r:r.subarray(0,i)})(t)}function EX(e){return(function(n){let r={};e:for(;!fV(n);){let i=Uc(n);switch(i>>>3){case 0:break e;case 1:r.code=Uc(n);break;case 2:r.msg=mV(n,Uc(n));break;case 3:{let s=SX(n);r.data=vX(n),n.limit=s;break}default:uV(n,7&i)}}return r})({bytes:t=e,offset:0,limit:t.length});var t}function vX(e){let t={};e:for(;!fV(e);){let n=Uc(e);switch(n>>>3){case 0:break e;case 1:t.requestId=mV(e,Uc(e));break;case 2:t.requestType=Uc(e)>>>0;break;case 3:t.scorePorn=cA(e);break;case 4:t.scoreSexy=cA(e);break;case 5:t.scoreNeutral=cA(e);break;case 6:t.requestScene=Uc(e)>>>0;break;case 7:t.scene=Uc(e)>>>0;break;default:uV(e,7&n)}}return t}function yX(e,t){let n=e.service;n!==void 0&&(rn(t,8),rn(t,n));let r=e.vendor;r!==void 0&&(rn(t,16),rn(t,r));let i=e.token;i!==void 0&&(rn(t,26),Mc(t,i));let s=e.callbackUrl;s!==void 0&&(rn(t,34),Mc(t,s))}function SX(e){let t=Uc(e),n=e.limit;return e.limit=e.offset+t,n}function uV(e,t){switch(t){case 0:for(;128&_V(e););break;case 2:oA(e,Uc(e));break;case 5:oA(e,4);break;case 1:oA(e,8);break;default:throw new Error("Unimplemented type: "+t)}}let TX=new Float32Array(1);new Uint8Array(TX.buffer);let sA=new Float64Array(1),rs=new Uint8Array(sA.buffer);function mm(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}let hV=[];function pV(){const e=hV.pop();return e?(e.offset=e.limit=0,e):{bytes:new Uint8Array(64),offset:0,limit:0}}function RX(e){hV.push(e)}function oA(e,t){if(e.offset+t>e.limit)throw new Error("Skip past limit");e.offset+=t}function fV(e){return e.offset>=e.limit}function _m(e,t){let n=e.bytes,r=e.offset,i=e.limit,s=r+t;if(s>n.length){let o=new Uint8Array(2*s);o.set(n),e.bytes=o}return e.offset=s,s>i&&(e.limit=s),r}function aA(e,t){let n=e.offset;if(n+t>e.limit)throw new Error("Read past limit");return e.offset+=t,n}function mV(e,t){let n=aA(e,t),r=String.fromCharCode,i=e.bytes,s="�",o="";for(let c=0;c<t;c++){let d,h,f,g,E=i[c+n];(128&E)==0?o+=r(E):(224&E)==192?c+1>=t?o+=s:(d=i[c+n+1],(192&d)!=128?o+=s:(g=(31&E)<<6|63&d,g<128?o+=s:(o+=r(g),c++))):(240&E)==224?c+2>=t?o+=s:(d=i[c+n+1],h=i[c+n+2],(49344&(d|h<<8))!=32896?o+=s:(g=(15&E)<<12|(63&d)<<6|63&h,g<2048||g>=55296&&g<=57343?o+=s:(o+=r(g),c+=2))):(248&E)==240?c+3>=t?o+=s:(d=i[c+n+1],h=i[c+n+2],f=i[c+n+3],(12632256&(d|h<<8|f<<16))!=8421504?o+=s:(g=(7&E)<<18|(63&d)<<12|(63&h)<<6|63&f,g<65536||g>1114111?o+=s:(g-=65536,o+=r(55296+(g>>10),56320+(1023&g)),c+=3))):o+=s}return o}function Mc(e,t){let n=t.length,r=0;for(let o=0;o<n;o++){let c=t.charCodeAt(o);c>=55296&&c<=56319&&o+1<n&&(c=(c<<10)+t.charCodeAt(++o)-56613888),r+=c<128?1:c<2048?2:c<65536?3:4}rn(e,r);let i=_m(e,r),s=e.bytes;for(let o=0;o<n;o++){let c=t.charCodeAt(o);c>=55296&&c<=56319&&o+1<n&&(c=(c<<10)+t.charCodeAt(++o)-56613888),c<128?s[i++]=c:(c<2048?s[i++]=c>>6&31|192:(c<65536?s[i++]=c>>12&15|224:(s[i++]=c>>18&7|240,s[i++]=c>>12&63|128),s[i++]=c>>6&63|128),s[i++]=63&c|128)}}function wX(e,t){let n=_m(e,t.limit),r=e.bytes,i=t.bytes;for(let s=0,o=t.limit;s<o;s++)r[s+n]=i[s]}function _V(e){return e.bytes[aA(e,1)]}function gV(e,t){let n=_m(e,1);e.bytes[n]=t}function cA(e){let t=aA(e,8),n=e.bytes;return rs[0]=n[t++],rs[1]=n[t++],rs[2]=n[t++],rs[3]=n[t++],rs[4]=n[t++],rs[5]=n[t++],rs[6]=n[t++],rs[7]=n[t++],sA[0]}function lA(e,t){let n=_m(e,8),r=e.bytes;sA[0]=t,r[n++]=rs[0],r[n++]=rs[1],r[n++]=rs[2],r[n++]=rs[3],r[n++]=rs[4],r[n++]=rs[5],r[n++]=rs[6],r[n++]=rs[7]}function Uc(e){let t,n=0,r=0;do t=_V(e),n<32&&(r|=(127&t)<<n),n+=7;while(128&t);return r}function rn(e,t){for(t>>>=0;t>=128;)gV(e,127&t|128),t>>>=7;gV(e,t)}function Yd(e,t){let n=t.low>>>0,r=(t.low>>>28|t.high<<4)>>>0,i=t.high>>>24,s=i===0?r===0?n<16384?n<128?1:2:n<1<<21?3:4:r<16384?r<128?5:6:r<1<<21?7:8:i<128?9:10,o=_m(e,s),c=e.bytes;switch(s){case 10:c[o+9]=i>>>7&1;case 9:c[o+8]=s!==9?128|i:127&i;case 8:c[o+7]=s!==8?r>>>21|128:r>>>21&127;case 7:c[o+6]=s!==7?r>>>14|128:r>>>14&127;case 6:c[o+5]=s!==6?r>>>7|128:r>>>7&127;case 5:c[o+4]=s!==5?128|r:127&r;case 4:c[o+3]=s!==4?n>>>21|128:n>>>21&127;case 3:c[o+2]=s!==3?n>>>14|128:n>>>14&127;case 2:c[o+1]=s!==2?n>>>7|128:n>>>7&127;case 1:c[o]=s!==1?128|n:127&n}}function EV(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable}))),n.push.apply(n,r)}return n}const CX=new Map([["moderation",1],["supervise",2]]);class bX extends xn{get connectionState(){return this._connectionState}set connectionState(t){if(this._connectionState===t)return;const n=this._connectionState;this._connectionState=t,this.emit(Cr.CONNECTION_STATE_CHANGE,n,t)}get inspectType(){return this._inspectType}set inspectType(t){var n;this._inspectMode=Yi(n=t.map((r=>CX.get(r)||0))).call(n,((r,i)=>r+i)),this._inspectType=t}get quality(){return this._quality}set quality(t){this._quality=t>1?1:t<.1?.1:t,this.qualityTimer&&(window.clearTimeout(this.qualityTimer),this.qualityTimer=null),this._quality>=1||(this.qualityTimer=window.setTimeout((()=>{this.quality=this._quality/this.qualityRatio}),6e4))}constructor(t){super(),x(this,"name","AgoraRTCVideoContentInspect"),x(this,"_connectionState",Ho.CONNECTING),x(this,"_innerConnectionState",void 0),x(this,"sequence",0),x(this,"inspectStartTime",void 0),x(this,"workerManagerConnection",void 0),x(this,"workerConnection",void 0),x(this,"workerMessageLengthLimit",void 0),x(this,"inspectIntervalMinimum",void 0),x(this,"qualityRatio",void 0),x(this,"_connectInfo",void 0),x(this,"_cancelTokenSource",ji.CancelToken.source()),x(this,"_retryConfig",void 0),x(this,"wmSequence",0),x(this,"inspectInterval",void 0),x(this,"inspectTimer",null),x(this,"ossFilePrefix",void 0),x(this,"extraInfo",void 0),x(this,"_inspectType",void 0),x(this,"_inspectMode",void 0),x(this,"_quality",1),x(this,"qualityTimer",null),x(this,"_inspectId",void 0),x(this,"_needWorkUrlOnly",!1),x(this,"inspectImage",(()=>{if(this.connectionState!==Ho.CONNECTED)throw new le(V.OPERATION_ABORTED,"content inspect service connection status is ".concat(this.connectionState));this.inspectTimer&&(window.clearInterval(this.inspectTimer),this.inspectTimer=null),this.inspectTimer=window.setInterval((()=>{this.connectionState===Ho.CONNECTED?this.requestToInspectImage():w.debug("[".concat(this._inspectId,"] Inspect State is not connected , "),this.connectionState)}),this.inspectInterval<this.inspectIntervalMinimum?this.inspectIntervalMinimum:this.inspectInterval),this.requestToInspectImage()})),this._inspectId=hn(5,"inspect-"),this.workerMessageLengthLimit=B("VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT"),this.inspectIntervalMinimum=B("VIDEO_INSPECT_INTERVAL_MINIMUM"),this.qualityRatio=B("VIDEO_INSPECT_QUALITY_RATIO"),this.inspectInterval=t.interval,this.ossFilePrefix=t.ossFilePrefix,this.extraInfo=t.extraInfo,this.inspectType=t.inspectType,this.inspectStartTime=Number(Date.now()),this.workerManagerConnection=new cE("worker-manager-"+this._inspectId,rr),this.on(Cr.STATE_CHANGE,((n,r)=>{this._innerConnectionState=n,w.debug("[".concat(this._inspectId,"] Inspect operation :").concat(Ko[n]," ").concat(r||""))})),this.handleWorkerManagerEvents(),this.workerConnection=new cE("worker-"+this._inspectId,rr),this.handleWorkerEvents()}async init(t,n){this.emit(Cr.STATE_CHANGE,Ko.CONNECT_AP),this._connectInfo=t;const r=this._cancelTokenSource.token;return this._retryConfig=n,new ke(((i,s)=>{this.on(Cr.CONNECTION_STATE_CHANGE,((o,c)=>{c===Ho.CONNECTED&&i()})),this.requestAP(t,r,n).then((o=>{this.connectWorkerManager(o)})).catch((o=>{s(o)}))}))}async requestAP(t,n,r){const i=B("WEBCS_DOMAIN").map((c=>"https://".concat(c,"/api/v1"))),s=await(function(c,d,h,f){let{appId:g,areaCode:E,cname:S,sid:O,token:A,uid:N}=d;sm++;const j="image_moderation_api",U={service_name:j,json_body:JSON.stringify({appId:g,areaCode:E,cname:S,command:"allocateEdge",requestId:sm,seq:sm,sid:O,token:A,ts:Date.now(),uid:N+""})};let W,$,Z=c[0];return Ca((async()=>{W=Date.now();const Y=await Oa(Z,{data:U,cancelToken:h,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if($=Date.now()-W,Y.code!==0){const Re=new le(V.UNEXPECTED_RESPONSE,"image inspect ap error, code"+Y.code,{retry:!0,responseTime:$});throw w.error(Re.toString()),Re}const ie=JSON.parse(Y.json_body);if(ie.code!==200){const Re=new le(V.UNEXPECTED_RESPONSE,"image inspect ap error, code: ".concat(ie.code,", reason: ").concat(ie.reason),{code:ie.code,responseTime:$});throw w.error(Re.toString()),Re}if(!ie.servers||!Array.isArray(ie.servers)||ie.servers.length===0){const Re=new le(V.UNEXPECTED_RESPONSE,"image inspect ap empty server",{code:ie.code,responseTime:$});throw w.error(Re.toString()),Re}const ue=B("VIDEO_INSPECT_WORKER_MANAGER_HOST"),ge=B("VIDEO_INSPECT_WORKER_MANAGER_PORT");return{addressList:ie.servers.map((Re=>{let{address:St,wss:Ct}=Re;if(St&&Ct)return"wss://".concat(St.replace(/\./g,"-"),".").concat(ue,":").concat(ge||Ct)})).filter((Re=>!!Re)),workerToken:ie.workerToken,vid:ie.vid,responseTime:$}}),((Y,ie)=>(We.apworkerEvent(O,{success:!0,sc:200,serviceName:j,responseDetail:JSON.stringify(Y.addressList),firstSuccess:ie===0,responseTime:$,serverIp:c[ie%c.length]}),!1)),((Y,ie)=>(We.apworkerEvent(O,{success:!1,sc:Y.data&&Y.data.code||200,serviceName:j,responseTime:$,serverIp:c[ie%c.length]}),!!(Y.code!==V.OPERATION_ABORTED&&Y.code!==V.UNEXPECTED_RESPONSE||Y.data&&Y.data.retry)&&(Z=c[(ie+1)%c.length],!0))),f)})(i,t,n,r);this.emit(Cr.STATE_CHANGE,Ko.AP_CONNECTED);const{addressList:o}=s;return this.wmSequence++,o}async connectWorkerManager(t){let n=arguments.length>1&&arguments[1]!==void 0&&arguments[1];this._needWorkUrlOnly=n,this.emit(Cr.STATE_CHANGE,Ko.CONNECT_WORKER_MANAGER),await this.workerManagerConnection.init(t,1e4)}async connectWorker(t){await this.workerConnection.init([t])}handleWorkerManagerEvents(){this.workerManagerConnection.on(Et.CONNECTED,(async()=>{this.emit(Cr.STATE_CHANGE,Ko.WORKER_MANAGER_CONNECTED,this.workerManagerConnection.url),this.workerManagerConnection.sendMessage({appId:this._connectInfo.appId,cname:this._connectInfo.cname,uid:this._connectInfo.uid+"",sdkVersion:"4.24.0",sid:this._connectInfo.sid,seq:this.wmSequence,ts:Number(Date.now()),requestId:Math.floor(1e12*Math.random()),allocate:!0,clientRequest:{command:"join"}},!0)})),this.workerManagerConnection.on(Et.CLOSED,(()=>{this._innerConnectionState<Ko.GET_WORKER_MANAGER_RESPONSE&&w.debug("[".concat(this._inspectId,"] Inspect worker manager is closed before connecting worker"))})),this.workerManagerConnection.on(Et.FAILED,(()=>{this._innerConnectionState<Ko.GET_WORKER_MANAGER_RESPONSE&&w.debug("[".concat(this._inspectId,"] Connecting inspect worker manager is failed before connecting worker"))})),this.workerManagerConnection.on(Et.RECONNECTING,(()=>{this._innerConnectionState<Ko.GET_WORKER_MANAGER_RESPONSE&&w.debug("[".concat(this._inspectId,"] Inspect worker manager is reconnecting before connecting worker"))})),this.workerManagerConnection.on(Et.ON_MESSAGE,(async t=>{this.emit(Cr.STATE_CHANGE,Ko.GET_WORKER_MANAGER_RESPONSE);const n=this.workerManagerConnection.url;this.workerManagerConnection.close();const r=JSON.parse(t.data);if(r.code!==200)throw w.error("[".concat(this._inspectId,"] Unexpected code ").concat(r.code," from worker manager")),new le(V.UNEXPECTED_RESPONSE,"response code of worker is unexpected",r);if(!(r.serverResponse&&r.serverResponse.portWss&&n))throw w.error("[".concat(this._inspectId,"] Unexpected content from worker manager : ").concat(JSON.stringify(r))),new le(V.UNEXPECTED_RESPONSE,"response content of worker is unexpected",r);{const i=B("VIDEO_INSPECT_WORKER_PORT")||r.serverResponse.portWss,s=n.replace(/:\d+\/?$/,":".concat(i));this.emit(Cr.STATE_CHANGE,Ko.CONNECT_WORKER,s),this._needWorkUrlOnly?this.emit(Cr.REQUEST_NEW_WORKER_URL,s):await this.connectWorker(s)}})),this.workerManagerConnection.on(Et.WILL_RECONNECT,((t,n,r)=>{r(t)})),this.workerManagerConnection.on(Et.REQUEST_NEW_URLS,((t,n)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(t).catch(n)}))}handleWorkerEvents(){this.workerConnection.on(Et.CONNECTED,(async()=>{this.emit(Cr.STATE_CHANGE,Ko.WORKER_CONNECTED,this.workerConnection.url),this.connectionState=Ho.CONNECTED})),this.workerConnection.on(Et.ON_MESSAGE,(async t=>{if(t.data instanceof ArrayBuffer){const r=EX(new Uint8Array(t.data));if(B("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")&&w.debug("[".concat(this._inspectId,"] Response message for worker of inspect content "),JSON.stringify(r)),r.code===200){if(Array.isArray(this.inspectType)&&this.inspectType.length===1&&this.inspectType[0]==="supervise")return void this.emit(Cr.INSPECT_RESULT,void 0,void 0);if(r.data&&r.data.scorePorn&&r.data.scoreSexy&&r.data.scoreNeutral){var n;const i={porn:r.data.scorePorn,sexy:r.data.scoreSexy,neutral:r.data.scoreNeutral},s=Yi(n=Object.keys(i)).call(n,((c,d)=>i[c]>i[d]?c:d),"porn"),o=Object.keys(i).find((c=>c===s));this.emit(Cr.INSPECT_RESULT,o)}else this.emit(Cr.INSPECT_RESULT,void 0,new le(V.UNEXPECTED_RESPONSE,r.code+"","There is an unexpected data on message"))}else this.emit(Cr.INSPECT_RESULT,void 0,new le(V.UNEXPECTED_RESPONSE,r.code+"",r.msg))}else w.error("[".concat(this._inspectId,"] Unexpected message type from worker")),this.emit(Cr.INSPECT_RESULT,void 0,new le(V.UNEXPECTED_RESPONSE,"invalid worker message type"))})),this.workerConnection.on(Et.CLOSED,(()=>{this.connectionState=Ho.CLOSED})),this.workerConnection.on(Et.FAILED,(()=>{this.connectionState=Ho.CLOSED})),this.workerConnection.on(Et.RECONNECTING,(()=>{this.connectionState=this.connectionState===Ho.CONNECTED?Ho.RECONNECTING:Ho.CONNECTING})),this.workerConnection.on(Et.WILL_RECONNECT,((t,n,r)=>{t==="recover"&&r(t),r("tryNext")})),this.workerConnection.on(Et.REQUEST_NEW_URLS,((t,n)=>{this.workerManagerConnection.close(),this.once(Cr.REQUEST_NEW_WORKER_URL,(r=>{t([r])})),this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then((r=>{this.connectWorkerManager(r,!0)})).catch((r=>{n(r)}))}))}async requestToInspectImage(){this.sequence++;const t=As(this,Cr.CLIENT_LOCAL_VIDEO_TRACK),n={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(t){if(!t.isPlaying)return void this.emit(Cr.INSPECT_RESULT,void 0,new le(V.INVALID_OPERATION,"Only the track being played can be inspected"));const r=await this.generateRequestData(t,n);this.workerConnection.sendMessage(r,!0,!0)}else this.emit(Cr.INSPECT_RESULT,void 0,new le(V.INVALID_OPERATION,"Only the track being published can be inspected"))}async generateRequestData(t,n){let{appId:r,cname:i,cid:s,vid:o,sid:c,uid:d}=n;const h=Date.now(),f=await t.getCurrentFrameImage("image/jpeg",this.quality),g=await Z1(f,r,i),E=this.sequence+"-"+s+"-"+d+"-"+h+"-"+hn(12,""),S={appId:r,cid:s,cname:i,deviceId:"",elapse:(O=Number(h-this.inspectStartTime),{low:O|=0,high:O>>31,unsigned:O>=0}),fileSize:g.byteLength,jpgEncryption:2,height:f.height,width:f.width,jpg:g,networkType:6,osType:7,requestId:E,sdkVersion:"4.24.0",sequence:this.sequence,sid:c,timestamp:bU(h),uid:d,vid:o,service:this._inspectMode,callbackData:this.extraInfo,ossFilePrefix:this.ossFilePrefix};var O;this.extraInfo===void 0&&delete S.callbackData,this.ossFilePrefix===void 0&&delete S.ossFilePrefix;const A=gX(S);if(A.byteLength<this.workerMessageLengthLimit){if(B("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")){const N=(function(j){for(var U=1;U<arguments.length;U++){var W=arguments[U]!=null?arguments[U]:{};U%2?EV(Object(W),!0).forEach((function($){x(j,$,W[$])})):Object.getOwnPropertyDescriptors?Object.defineProperties(j,Object.getOwnPropertyDescriptors(W)):EV(Object(W)).forEach((function($){Object.defineProperty(j,$,Object.getOwnPropertyDescriptor(W,$))}))}return j})({},S);delete N.jpg,w.debug("[".concat(this._inspectId,"] Request message for worker of inspect content "),JSON.stringify(N))}return A}{const N=this.quality*this.qualityRatio;return this.quality=N,await this.generateRequestData(t,{appId:r,cname:i,cid:s,vid:o,sid:c,uid:d})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=ji.CancelToken.source(),this.workerManagerConnection&&this.workerManagerConnection.close(),this.workerConnection&&this.workerConnection.close(),this.inspectTimer&&window.clearInterval(this.inspectTimer),this.inspectTimer=null,this.connectionState=Ho.CLOSED,this.emit(Cr.STATE_CHANGE,Ko.CLOSED)}}const IX={name:"ContentInspect",create:function(e){let{config:t}=e;return(function(n){if(!n)throw new le(V.INVALID_PARAMS,"inspectConfig is necessary.");if(!n.inspectType||!Array.isArray(n.inspectType))throw new le(V.INVALID_PARAMS,"inspectConfig.inspectType is necessary and is an instance of Array.");{const r=[...new Set(n.inspectType)];r.forEach((i=>{var s;if(!be(s=["supervise","moderation"]).call(s,i))throw new le(V.INVALID_PARAMS,"".concat(i," is not a valid inspect type."))})),n.inspectType=r}if(n&&n.extraInfo&&n.extraInfo.length>1024)throw new le(V.INVALID_PARAMS,"inspectConfig.extraInfo length cannot exceed 1024 bytes")})(t),new bX(t)}};var vV=R(ci.Object.getOwnPropertySymbols),AX=Zt,NX=mp.indexOf,OX=Au,dA=gt([].indexOf),yV=!!dA&&1/dA([1],1,-0)<0;AX({target:"Array",proto:!0,forced:yV||!OX("indexOf")},{indexOf:function(e){var t=arguments.length>1?arguments[1]:void 0;return yV?dA(this,e,t)||0:NX(this,e,t)}});var PX=cs("Array","indexOf"),DX=ee,kX=PX,uA=Array.prototype,xX=function(e){var t=e.indexOf;return e===uA||DX(uA,e)&&t===uA.indexOf?kX:t},SV=R(xX);function LX(e,t){if(e==null)return{};var n,r,i=(function(o,c){if(o==null)return{};var d={};for(var h in o)if({}.hasOwnProperty.call(o,h)){if(SV(c).call(c,h)!==-1)continue;d[h]=o[h]}return d})(e,t);if(vV){var s=vV(e);for(r=0;r<s.length;r++)n=s[r],SV(t).call(t,n)===-1&&{}.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}let TV=class{get localCapabilities(){return On(this._localCapabilities)}get rtpCapabilities(){return On(this._rtpCapabilities)}get candidates(){return On(this._candidates)}get iceParameters(){return On(this._iceParameters)}get dtlsParameters(){return On(this._dtlsParameters)}constructor(e){x(this,"sessionDesc",void 0),x(this,"_localCapabilities",void 0),x(this,"_rtpCapabilities",void 0),x(this,"_candidates",void 0),x(this,"_iceParameters",void 0),x(this,"_dtlsParameters",void 0),x(this,"setup",void 0),x(this,"currentMidIndex",void 0),x(this,"cname","o/i14u9pJrxRKAsu"),x(this,"firefoxSsrcMidMap",new Map),e=On(e);const{remoteIceParameters:t,remoteDtlsParameters:n,candidates:r,remoteRTPCapabilities:i,localCapabilities:s,direction:o,setup:c,videoCodec:d,audioCodec:h}=e;let f;this.setup=c,f=o===Ai.RECEIVE_ONLY?$i(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`):$i(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`),this._rtpCapabilities=i,this._candidates=r,this._iceParameters=t,this._dtlsParameters=n,this._localCapabilities=s;const g=o===Ai.RECEIVE_ONLY?this.rtpCapabilities.send:this.rtpCapabilities.recv,E=o===Ai.RECEIVE_ONLY?this._localCapabilities.recv:this._localCapabilities.send,S=o===Ai.RECEIVE_ONLY?i.send.videoCodecs:hE(Me.VIDEO,g,E,d),O=o===Ai.RECEIVE_ONLY?i.send.audioCodecs:hE(Me.AUDIO,g,E,h);for(const A of f.mediaDescriptions)A.attributes.iceUfrag=t.iceUfrag,A.attributes.icePwd=t.icePwd,A.attributes.fingerprints=n.fingerprints,A.attributes.candidates=r,A.attributes.setup=this.setup,A.media.mediaType==="application"&&(A.attributes.sctpPort="5000"),A.media.mediaType==="video"&&(A.media.fmts=S.map((N=>N.payloadType.toString(10))),A.attributes.payloads=S,A.attributes.extmaps=g.videoExtensions),A.media.mediaType==="audio"&&(A.media.fmts=O.map((N=>N.payloadType.toString(10))),A.attributes.payloads=O,A.attributes.extmaps=g.audioExtensions,im(A));this.sessionDesc=f,this.currentMidIndex=f.mediaDescriptions.length-1}toString(){return Nd(this.sessionDesc)}hasMid(e){return Array.isArray(e)?e.every((t=>this.hasMid(t))):this.sessionDesc.mediaDescriptions.some((t=>t.attributes.mid===e))}send(e,t,n,r,i){n=n.replace(/ /g,"-");const{ssrcs:s,ssrcGroups:o}=uE(t,this.cname,B("SYNC_GROUP")?n:void 0),c=this.findPreloadMediaDesc(s);if(c){if(jn()&&this.firefoxSsrcMidMap.set(s[0].ssrcId,c.attributes.mid),i&&(i.twcc||i.remb)){const d=this.sessionDesc.mediaDescriptions.indexOf(c);return this.sessionDesc.mediaDescriptions[d]=this.mungSendMediaDesc(c,i),{mid:c.attributes.mid,needExchangeSDP:!0}}return{mid:c.attributes.mid,needExchangeSDP:!1}}{const d=this.findAvailableMediaIndex(e,s,r);let h;return d===-1?(h=this.createOrRecycleSendMedia(e,s,o,"sendonly",r,i),this.updateBundleMids()):(h=On(this.sessionDesc.mediaDescriptions[d]),h.attributes.direction="sendonly",h.attributes.ssrcs=s,h.attributes.ssrcGroups=o,this.sessionDesc.mediaDescriptions[d]=this.mungSendMediaDesc(h,i)),jn()&&this.firefoxSsrcMidMap.set(s[0].ssrcId,h.attributes.mid),{needExchangeSDP:!0,mid:h.attributes.mid}}}stopSending(e){const t=this.sessionDesc.mediaDescriptions.filter((n=>n.attributes.mid&&e.indexOf(n.attributes.mid)!==-1));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");t.forEach((n=>{n.attributes.ssrcs=[]})),this.updateBundleMids()}receive(e,t,n){const r=[];return e.forEach((i=>{const s=i._mediaStreamTrack.kind,o=this.findAvailableRecvMediaIndex(s);let c,d=!1;o===-1?(d=!0,c=this.createOrRecycleRecvMedia(i,[],"recvonly",t,n),this.updateBundleMids()):(c=On(this.sessionDesc.mediaDescriptions[o]),c.attributes.direction="recvonly"),r.push({mid:c.attributes.mid,needCreateTransceiver:d})})),r}stopReceiving(e){const t=this.sessionDesc.mediaDescriptions.filter((n=>e.indexOf(n.attributes.mid)!==-1));if(t.length!==e.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");t.forEach((n=>{n.media.port="0",n.attributes.direction="inactive"})),this.updateBundleMids()}addRemoteCandidate(e){const{foundation:t,protocol:n,address:r,port:i,type:s,relatedAddress:o,relatedPort:c,priority:d}=new RTCIceCandidate(e),h={foundation:t??"",componentId:"1",transport:n??"",priority:d?d+"":"",connectionAddress:r??"",port:i?i+"":"",type:s?s+"":"",relAddr:o??"",relPort:c?c+"":"",extension:{}};this.candidates.some((f=>f.priority===h.priority&&f.connectionAddress===h.connectionAddress&&f.port===h.port))||(this._candidates.push(h),this.sessionDesc.mediaDescriptions.forEach((f=>{f.attributes.candidates=this.candidates})))}clearRemoteCandidate(){this._candidates=[],this.sessionDesc.mediaDescriptions[0].attributes.candidates=this._candidates}createOrRecycleRecvMedia(e,t,n,r,i){const s=e._mediaStreamTrack.kind,o=this.rtpCapabilities.recv,c=hE(s,o,this.localCapabilities.send,s===Me.AUDIO?i:r),d=s===Me.VIDEO?o.videoExtensions:o.audioExtensions,h="".concat(++this.currentMidIndex);let f={media:{mediaType:s,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:c.map((E=>E.payloadType.toString(10)))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:d,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:c,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:n,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(h)}};f=this.mungRecvMediaDsec(f,e);const g=this.findFirstClosedMedia(s);if(g){const E=this.sessionDesc.mediaDescriptions.indexOf(g);this.sessionDesc.mediaDescriptions[E]=f}else this.sessionDesc.mediaDescriptions.push(f);return f}muteRemote(e){const t=this.sessionDesc.mediaDescriptions.filter((n=>be(e).call(e,n.attributes.mid||"")));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach((n=>{n.attributes.direction="inactive"}))}unmuteRemote(e){const t=this.sessionDesc.mediaDescriptions.filter((n=>be(e).call(e,n.attributes.mid||"")));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach((n=>{n.attributes.direction="recvonly"}))}findAvailableMediaIndex(e,t,n){return this.sessionDesc.mediaDescriptions.findIndex((r=>{const i=r.media.mediaType===e&&r.media.port!=="0"&&(r.attributes.direction==="sendonly"||r.attributes.direction==="sendrecv")&&r.attributes.ssrcs.length===0;if(jn()){if(i){const s=this.firefoxSsrcMidMap.get(t[0].ssrcId);return!(s||r.attributes.mid!=="0"&&r.attributes.mid!=="1")||!(!s||s!==r.attributes.mid)}return!1}return i&&r.attributes.mid===n}))}findAvailableRecvMediaIndex(e){return this.sessionDesc.mediaDescriptions.findIndex((t=>{const n=t.media.mediaType===e&&t.media.port!=="0"&&(t.attributes.direction==="recvonly"||t.attributes.direction==="sendrecv");return t.attributes.mid!=="0"&&t.attributes.mid!=="1"&&n}))}predictReceivingMids(e){const t=[];for(let n=0;n<e;n++)t.push((this.currentMidIndex+n+1).toString(10));return t}restartICE(e){e=On(e),this._iceParameters=e,this.sessionDesc.mediaDescriptions.forEach((t=>{t.attributes.iceUfrag=e.iceUfrag,t.attributes.icePwd=e.icePwd}))}createOrRecycleSendMedia(e,t,n,r,i,s){const o=this.rtpCapabilities.send,c=e===Me.VIDEO?o.videoCodecs:o.audioCodecs,d=e===Me.VIDEO?o.videoExtensions:o.audioExtensions;jn()&&(i="".concat(++this.currentMidIndex));let h={media:{mediaType:e,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:c.map((g=>g.payloadType.toString(10)))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:d,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:n,rtcpFeedbackWildcards:[],payloads:c,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:r,rtcpMux:!0,rtcpRsize:!0,mid:i}};h=this.mungSendMediaDesc(h,s);const f=this.findFirstClosedMedia(e);if(f){const g=this.sessionDesc.mediaDescriptions.indexOf(f);this.sessionDesc.mediaDescriptions[g]=h}else this.sessionDesc.mediaDescriptions.push(h);return h}mungRecvMediaDsec(e,t,n){const r=On(e);return dI(r),rm(r,t),uI(r,t),m2(r),RT(r,n,this.localCapabilities.send),r}mungSendMediaDesc(e,t){const n=On(e);return RT(n,t,this.localCapabilities.recv),im(n),n}updateRecvMedia(e,t){const n=this.sessionDesc.mediaDescriptions.findIndex((r=>r.attributes.mid===e));if(n!==-1){const r=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[n],t);this.sessionDesc.mediaDescriptions[n]=r}}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter((e=>e.media.port!=="0")).map((e=>e.attributes.mid))}findPreloadMediaDesc(e){return this.sessionDesc.mediaDescriptions.find((t=>{var n;return((n=t.attributes)===null||n===void 0||(n=n.ssrcs[0])===null||n===void 0?void 0:n.ssrcId)===e[0].ssrcId}))}findFirstClosedMedia(e){return this.sessionDesc.mediaDescriptions.find((t=>jn()?t.media.port==="0"&&t.media.mediaType===e:t.media.port==="0"))}};const MX=["sdp"];var Tn;function RV(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable}))),n.push.apply(n,r)}return n}function qd(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?RV(Object(n),!0).forEach((function(r){x(e,r,n[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):RV(Object(n)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))}))}return e}let wV=(Tn=class Sm extends QM{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var t,n;return(t=(n=this.peerConnection.getReceivers()[0])===null||n===void 0||(n=n.transport)===null||n===void 0?void 0:n.state)!==null&&t!==void 0?t:null}get localCodecs(){return[]}set isInRestartIce(t){this._isInRestartIce=t}get isInRestartIce(){return this._isInRestartIce}constructor(t,n,r){super(t,n),x(this,"direction",void 0),x(this,"name",void 0),x(this,"store",void 0),x(this,"spec",void 0),x(this,"peerConnection",void 0),x(this,"initialOffer",void 0),x(this,"transport",void 0),x(this,"statsFilter",void 0),x(this,"localCandidateCount",0),x(this,"_isInRestartIce",!1),x(this,"mutex",void 0),x(this,"onLocalCandidate",void 0),x(this,"remoteSDP",void 0),x(this,"pendingCandidates",[]),x(this,"localCapabilities",void 0),x(this,"isReady",!1),x(this,"restartCnt",0),x(this,"curTurnServerIndex",0),this.store=n,this.spec=t,this.mutex=new Jr("P2PConnection-mutex",n.clientId),this.peerConnection=new RTCPeerConnection(Sm.resolvePCConfiguration(t,n.p2pTransport),{optional:[{googDscp:!0}]}),this.direction=r??Ai.SEND_ONLY,this.name=this.direction===Ai.SEND_ONLY?"sendP2PConnection":"recvP2PConnection",this.statsFilter=vb(this.peerConnection,B("STATS_UPDATE_INTERVAL"),void 0,jn()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1}async establish(t){try{const n=await g2();if(this.localCapabilities=wT(n),t){const{sdp:r}=t,i=LX(t,MX),s=(function(){const f={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},g=dE(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"sendonly"),E={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},S={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},O={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(zo(g,f,"videoExtensions",E,S,O),zo(g,f,"videoCodecs",E,S,O),zo(g,f,"audioExtensions",E,S,O),zo(g,f,"audioCodecs",E,S,O),B("RAISE_H264_BASELINE_PRIORITY")){const A=O.videoCodecs.findIndex((N=>N.rtpMap&&N.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&N.fmtp&&N.fmtp.parameters["profile-level-id"]==="42001f"));if(A!==-1){const N=O.videoCodecs.findIndex((j=>j.rtpMap&&j.rtpMap.encodingName.toLocaleLowerCase()==="h264"));if(N<A){w.debug("raising H264 baseline profile priority");const j=O.videoCodecs[A];O.videoCodecs.splice(A,1),O.videoCodecs.splice(N,0,j)}N!==-1&&B("FILTER_SEND_H264_BASELINE")&&(E.videoCodecs=E.videoCodecs.filter((j=>!(j.rtpMap&&j.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&j.fmtp&&j.fmtp.parameters["profile-level-id"]!=="42001f"))))}}return{send:E,recv:S,sendrecv:O}})({},{},r);this.remoteSDP=new TV({remoteIceParameters:i.iceParameters,remoteDtlsParameters:i.dtlsParameters,candidates:[],remoteRTPCapabilities:s,localCapabilities:this.localCapabilities,direction:this.direction,setup:"actpass",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()}),this.isReady=!0;const o=await this.peerConnection.createAnswer();if(!o.sdp)throw new Error("Cannot get answer sdp when trying to establish PeerConnection.");const c=Ld(o.sdp);await this.peerConnection.setLocalDescription(o);const d=await E2({},{},o.sdp);this.localCapabilities=wT(d);const h=this.peerConnection.getTransceivers()[0];return h!=null&&h.receiver&&h.receiver.transport&&this.tryBindTransportEvents(h.receiver.transport),qd(qd({},c),{},{sdp:o.sdp})}{this.peerConnection.addTransceiver("video",{direction:"sendonly"}),this.peerConnection.addTransceiver("audio",{direction:"sendonly"});const r=await this.peerConnection.createOffer();if(!r.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const i=Ld(r.sdp);return this.initialOffer=r,qd(qd({},i),{},{sdp:r.sdp})}}catch(n){throw new de(V.GET_LOCAL_CONNECTION_PARAMS_FAILED,n.toString())}}async connect(t){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");await this.peerConnection.setLocalDescription(this.initialOffer);const{sdp:n,iceParameters:r,dtlsParameters:i}=t,s=await E2({},{},n);this.remoteSDP=new TV({remoteIceParameters:r,remoteDtlsParameters:i,candidates:[],remoteRTPCapabilities:s,localCapabilities:this.localCapabilities,direction:this.direction,setup:"active",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()});const o=this.peerConnection.getTransceivers()[0];o!=null&&o.sender&&o.sender.transport&&this.tryBindTransportEvents(o.sender.transport)}catch(n){throw new de(V.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(n.toString()))}}async addRemoteCandidate(t){try{t&&this.pendingCandidates.push(t),this.peerConnection.remoteDescription&&this.isReady&&(this.pendingCandidates.forEach((n=>{this.peerConnection.addIceCandidate(n)})),this.pendingCandidates=[])}catch(n){throw new de(V.ADD_CANDIDATE_FAILED,"P2PConnection.addRemoteCandidate failed; ".concat(n.toString()))}}send(t,n,r){var i=this;return no((function*(){const s=yield Ft(i.mutex.lock("From P2PConnection.send"));try{if(!i.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const o=[],c=i.remoteSDP.receive(t,n,r);t.forEach(((N,j)=>{if(c[j].needCreateTransceiver){const U=i.peerConnection.addTransceiver(N._mediaStreamTrack,{direction:"sendonly"});o.push(U),N._updateRtpTransceiver(U)}else{const U=i.peerConnection.getTransceivers().find((W=>W.mid===c[j].mid));if(!U)throw new Error("cannot find transceiver when sendPeerconnection send, mid is ".concat(c[j].mid));o.push(U),N._updateRtpTransceiver(U)}})),jn()&&B("SIMULCAST")===!0&&(yield Ft(i.applySimulcastForFirefox(o,t)));const d=c.map((N=>N.mid)),h=yield Ft(i.peerConnection.createOffer()),f=i.mungSendOfferSDP(h.sdp,t,d),g=$i(f),E=d.map((N=>{const j=g.mediaDescriptions.find((U=>U.attributes.mid===N));if(!j)throw new Error("Cannot extract ssrc from mediaDescription.");return h2(j,B("USE_PUB_RTX"))})),S=o.map(((N,j)=>{const U=d[j];return{localSSRC:E[j],id:U}}));yield Ft(i.peerConnection.setLocalDescription({type:"offer",sdp:f}));try{yield S}catch(N){const j=i.remoteSDP.toString();throw yield Ft(i.peerConnection.setLocalDescription({type:"offer",sdp:f})),yield Ft(i.peerConnection.setRemoteDescription({type:"answer",sdp:j})),yield Ft(i.stopSending(d,!0)),N}yield Ft(i.applySimulcastEncodings(o,t)),yield Ft(i.applySendEncodings(o,t));const O=i.remoteSDP.toString(),A=i.logSDPExchange(f,"offer","local","send");return A?.(O),yield Ft(i.setRemoteDescription({type:"answer",sdp:O})),o.map(((N,j)=>{const U=d[j];return{localSSRC:E[j],id:U}}))}catch(o){throw o instanceof de?o:new de(V.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(o.toString()))}finally{s()}}))()}async stopSending(t,n){const r=n?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const i=this.peerConnection.getTransceivers().filter((d=>t.indexOf(d.mid)!==-1));if(i.length!==t.length)throw new Error("Transceivers' length (".concat(i.length,") doesn't match mids' length (").concat(t.length,") when trying to call P2PConnection.stopSending."));i.map((d=>{var h;d.direction="inactive",(h=d.stop)===null||h===void 0||h.call(d)}));const s=await this.peerConnection.createOffer(),o=this.logSDPExchange(s.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(s),this.remoteSDP.stopReceiving(t);const c=this.remoteSDP.toString();o?.(c),await this.setRemoteDescription({type:"answer",sdp:c})}catch(i){throw new de(V.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(i.toString()))}finally{r&&r()}}async receive(t,n,r,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));const{mid:s,needExchangeSDP:o}=this.remoteSDP.send(t,n,r,i);if(o){const d=this.remoteSDP.toString(),h=this.logSDPExchange(d,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:d});const f=await this.peerConnection.createAnswer(),g=this.mungReceiveAnswerSDP(f.sdp,s,t);h?.(g||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:g}),w.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," by exchanging SDP."))}else w.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," no need to exchange SDP."));const c=this.peerConnection.getTransceivers().find((d=>d.mid===s));if(!c||c.mid===null)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:c.receiver.track,mid:c.mid,transceiver:c}}catch(s){throw new de(V.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(s.toString()))}}async mockReceive(t,n,r,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));const{mid:s,needExchangeSDP:o}=this.remoteSDP.send(t,n,r,i);if(o){const c=this.remoteSDP.toString(),d=this.logSDPExchange(c,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:c});const h=await this.peerConnection.createAnswer(),f=this.mungReceiveAnswerSDP(h.sdp,s,t);d?.(f||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:f}),w.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," by exchanging SDP."))}else w.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," no need to exchange SDP."))}catch(s){throw new de(V.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(s.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(t);const n=this.remoteSDP.toString(),r=this.logSDPExchange(n,"offer","remote","stopReceiving");await this.setRemoteDescription({type:"offer",sdp:n});const i=await this.peerConnection.createAnswer();r?.(i.sdp||""),await this.peerConnection.setLocalDescription(i)}catch(n){throw new de(V.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n.toString()))}}async restartICE(t){try{if(this.store.p2pTransport===wh.Auto&&(this.store.p2pTransport=wh.SdRtn,Bt().supportPCSetConfiguration&&this.peerConnection.setConfiguration(Sm.resolvePCConfiguration(this.spec,this.store.p2pTransport))),this.restartCnt>3&&(this.restartCnt=0,Bt().supportPCSetConfiguration&&this.peerConnection.setConfiguration(Sm.resolvePCConfiguration(this.spec,this.store.p2pTransport,++this.curTurnServerIndex))),!t){this.restartCnt++,this.isReady=!1;const n=await this.peerConnection.createOffer({iceRestart:!0});if(!n.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const{iceParameters:r}=Ld(n.sdp);return this.store.descriptionStart(),this.direction===Ai.SEND_ONLY&&await this.peerConnection.setLocalDescription(n),r}if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");if(this.remoteSDP.restartICE(t),this.store.descriptionStart(),this.direction===Ai.RECEIVE_ONLY){this.restartCnt++,await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()});const n=await this.peerConnection.createAnswer();if(!n.sdp)throw new Error("Cannot get answer sdp when trying to iceRestart.");const{iceParameters:r}=Ld(n.sdp);return await this.peerConnection.setLocalDescription(n),r}await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()}),this.isReady=!0}catch(n){throw new de(V.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n.toString()))}}close(){var t;this.peerConnection.close(),this.peerConnection.onicecandidate=null,(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.transport=void 0,this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const r=await this.peerConnection.createOffer(),i=this.mungSendOfferSDP(r.sdp,[n],[t]);this.remoteSDP.updateRecvMedia(t,n);const s=this.remoteSDP.toString(),o=this.logSDPExchange(i,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:i}),o?.(s),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(r){throw new de(V.EXCHANGE_SDP_FAILED,r.toString())}}async updateSendParameters(t,n){const r=this.peerConnection.getTransceivers().filter((i=>i.mid===t));r.length===1&&(this.isVP8Simulcast(n)?jn()||await this.applySimulcastEncodings(r,[n]):await this.applySendEncodings(r,[n]))}setStatsRemoteVideoIsReady(t,n){this.statsFilter.setVideoIsReady2(t,n)}async replaceTrack(t,n){const r=this.peerConnection.getTransceivers().find((i=>i.mid===n));r&&await r.sender.replaceTrack(t._mediaStreamTrack)}async getSelectedCandidatePair(){const t=this.peerConnection.getReceivers();if(t.length>0&&t[0].transport&&t[0].transport.iceTransport&&t[0].transport.iceTransport.getSelectedCandidatePair&&t[0].transport.iceTransport.getSelectedCandidatePair()){const n=t[0].transport.iceTransport,{local:r,remote:i}=n.getSelectedCandidatePair();return{local:qd(qd({},Cc),{},{candidateType:r.type,protocol:r.protocol,address:r.address,port:r.port}),remote:qd(qd({},Cc),{},{candidateType:i.type,protocol:i.protocol,address:i.address,port:i.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t,n;be(t=["connected","completed"]).call(t,this.peerConnection.iceConnectionState)&&(this.isReady=!1),(n=this.onICEConnectionStateChange)===null||n===void 0||n.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;this.peerConnection.connectionState==="connected"&&(this.restartCnt=0),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.startICECandidate()}startICECandidate(){this.peerConnection.onicecandidate||(this.localCandidateCount=0,this.peerConnection.onicecandidate=t=>{if(t.candidate){var n;t.candidate.candidate&&((n=this.onLocalCandidate)===null||n===void 0||n.call(this,t.candidate.toJSON())),this.localCandidateCount+=1}else w.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount)})}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const i={iceServers:[]};var s;return t.iceServers?i.iceServers=t.iceServers:t.turnServer&&t.turnServer.mode!=="off"&&(Xg(t.turnServer.servers)?i.iceServers=t.turnServer.servers:(i.iceServers&&i.iceServers.push(...Sm.turnServerConfigToIceServers(t.turnServer.servers,n,r)),B("USE_TURN_SERVER_OF_GATEWAY")&&i.iceServers&&t.turnServer.serversFromGateway&&i.iceServers.push(...Sm.turnServerConfigToIceServers(t.turnServer.serversFromGateway,n,r)),be(s=[wh.Relay,wh.SdRtn]).call(s,n)&&(i.iceTransportPolicy="relay"),B("FORCE_TURN_TCP")?i.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach((o=>{o.forceturn&&(i.iceTransportPolicy="relay")})))),B("ENABLE_ENCODED_TRANSFORM")&&Bt().supportWebRTCEncodedTransform&&(i.encodedInsertableStreams=!0),w.debug("P2PConnection p2pTransport is ".concat(n)),i}static turnServerConfigToIceServers(t,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const i=[],s=t.filter((c=>c.tcpport));w.debug("P2PConnection turnServers is ".concat(s,", current index is ").concat(r));const o=s.length>r?s[r]:s[0];switch(n){case wh.SdRtn:const c=t.filter((h=>{var f;return be(f=h.username).call(f,"glb:")&&h.turnServerURL==h.turnServerURL})),d=c.length>r?c[r]:c[0];d&&(i.push({username:d.username,credential:d.password,credentialType:"password",urls:"turn:".concat(kd(d.turnServerURL),":").concat(d.tcpport,"?transport=udp")}),i.push({username:d.username,credential:d.password,credentialType:"password",urls:"turns:".concat(kd(d.turnServerURL),":").concat(d.tcpport,"?transport=tcp")}));break;case wh.Relay:o&&(i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":").concat(o.tcpport,"?transport=udp")}),i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turns:".concat(kd(o.turnServerURL),":").concat(o.tcpport,"?transport=tcp")}));break;default:o&&(i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":").concat(o.tcpport,"?transport=udp")}),i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turns:".concat(kd(o.turnServerURL),":").concat(o.tcpport,"?transport=tcp")}),i.push({username:o.username,credential:o.password,credentialType:"password",urls:"stun:".concat(o.turnServerURL,":").concat(o.tcpport)}))}return i}tryBindTransportEvents(t){if(t){this.transport=t,t.onstatechange=()=>{var r;t!=null&&t.state&&((r=this.onDTLSTransportStateChange)===null||r===void 0||r.call(this,t.state))},t.onerror=r=>{var i;(i=this.onDTLSTransportError)===null||i===void 0||i.call(this,"error"in r?r.error:r)};const n=t.iceTransport;n&&(n.onstatechange=()=>{const r=t?.iceTransport.state;var i;r&&((i=this.onICETransportStateChange)===null||i===void 0||i.call(this,r))},n.getSelectedCandidatePair&&(n.onselectedcandidatepairchange=()=>{if(n.getSelectedCandidatePair()){const{local:r,remote:i}=n.getSelectedCandidatePair()||{};if(r&&i){const s=r.address+":"+r.port,o=i.address+":"+i.port;w.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify(Dh(s)),", remote ").concat(JSON.stringify(Dh(o))))}}}))}}tryUnbindTransportEvents(){this.transport&&(this.transport.onstatechange=null,this.transport.onerror=null,this.transport.iceTransport&&(this.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(t,n){var r;if(n||(n=this.peerConnection.getSenders().find((f=>f.track===t._mediaStreamTrack))),!n)return w.warn("[".concat(t.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(t))return w.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!Bt().supportSetRtpSenderParameters)return w.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const i={},s={};switch(t._optimizationMode){case"motion":i.degradationPreference="maintain-framerate";break;case"detail":i.degradationPreference="maintain-resolution";break;default:i.degradationPreference="balanced"}if(t._encoderConfig){var o;const{bitrateMax:f,frameRate:g,scaleResolutionDownBy:E}=t._encoderConfig;f&&(s.maxBitrate=1e3*f),be(o=t._hints).call(o,ln.LOW_STREAM)&&(g&&(s.maxFramerate=Es(g)),E&&E>=1&&(s.scaleResolutionDownBy=E))}if(B("DSCP_TYPE")&&vl()){var c;const f=B("DSCP_TYPE");be(c=["very-low","low","medium","high"]).call(c,f)&&(s.networkPriority=f)}const d=n.getParameters(),h=(r=d.encodings)===null||r===void 0?void 0:r[0];jn()&&!h&&(i.encodings=[s]),h&&Object.assign(h,s),Object.assign(d,i),w.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(d.encodings))),await n.setParameters(d)}async applySendEncodings(t,n){try{if(!Bt().supportSetRtpSenderParameters||t.length!==n.length)return;for(let r=0;r<t.length;r++){const i=t[r],s=n[r];s instanceof Sn&&!this.isVP8Simulcast(s)&&await this.updateRtpSenderEncodings(s,i.sender)}}catch{w.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(t,n,r){const i=$i(t);return n.forEach(((s,o)=>{const c=r[o],d=i.mediaDescriptions.find((h=>h.attributes.mid===c));d&&(rm(d,s),_2(d,s,this.store.codec))})),Nd(i)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var n;(n=this.onFirstAudioReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var n;(n=this.onFirstVideoReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var n;(n=this.onFirstAudioDecoded)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,n,r)=>{var i;(i=this.onFirstVideoDecoded)===null||i===void 0||i.call(this,t,n,r)},this.statsFilter.onSelectedLocalCandidateChanged=(t,n)=>{var r;(r=this.onSelectedLocalCandidateChanged)===null||r===void 0||r.call(this,t,n)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,n)=>{var r;(r=this.onSelectedRemoteCandidateChanged)===null||r===void 0||r.call(this,t,n)},this.statsFilter.onFirstVideoDecodedTimeout=t=>{var n;(n=this.onFirstVideoDecodedTimeout)===null||n===void 0||n.call(this,t)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(t,n){if(t.length===n.length)for(let d=0;d<t.length;d++){var r,i,s,o,c;const h=t[d],f=n[d];if(f instanceof Sn&&!be(r=f._hints).call(r,ln.LOW_STREAM)&&(i=f._encoderConfig)!==null&&i!==void 0&&i.bitrateMax&&((s=f._encoderConfig)===null||s===void 0?void 0:s.bitrateMax)>200&&(o=f._scalabilityMode)!==null&&o!==void 0&&o.numSpatialLayers&&((c=f._scalabilityMode)===null||c===void 0?void 0:c.numSpatialLayers)>1&&this.store.codec==="vp8"){const g={},E={high:1e3*(f._encoderConfig.bitrateMax-50),medium:5e4};g.encodings=[{rid:"m",active:!0,maxBitrate:E.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:E.high}];const S=h.sender.getParameters();await h.sender.setParameters(Object.assign(S,g))}}}async applySimulcastEncodings(t,n){if(!jn()&&t.length===n.length)for(let r=0;r<t.length;r++){const i=n[r];if(i instanceof Sn&&this.isVP8Simulcast(i)){const s=t[r],o={},c={high:1e3*(i._encoderConfig.bitrateMax-50),medium:5e4};o.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:c.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:c.medium,scaleResolutionDownBy:4}];const d=s.sender.getParameters();await s.sender.setParameters(Object.assign(d,o))}}}isVP8Simulcast(t){var n,r,i,s,o;return!!(t instanceof Sn&&B("SIMULCAST")&&this.store.codec==="vp8"&&!be(n=t._hints).call(n,ln.LOW_STREAM)&&(r=t._encoderConfig)!==null&&r!==void 0&&r.bitrateMax&&((i=t._encoderConfig)===null||i===void 0?void 0:i.bitrateMax)>200&&(s=t._scalabilityMode)!==null&&s!==void 0&&s.numSpatialLayers&&((o=t._scalabilityMode)===null||o===void 0?void 0:o.numSpatialLayers)>1)}logSDPExchange(t,n,r,i){if(B("SDP_LOGGING"))return w.upload("[".concat(this.store.clientId,"] exchanging ").concat(r," ").concat(n," SDP during P2PConnection.").concat(i,`
`),t),n==="offer"?s=>{this.logSDPExchange(s,"answer",r==="local"?"remote":"local",i)}:void 0}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter((o=>o.mid&&t.indexOf(o.mid)!==-1));if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map((o=>{o.direction="inactive"}));const r=await this.peerConnection.createOffer(),i=this.logSDPExchange(r.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(r),this.remoteSDP.muteRemote(t);const s=this.remoteSDP.toString();i?.(s),await this.setRemoteDescription({type:"answer",sdp:s})}catch(n){throw new de(V.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(n.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter((o=>o.mid&&t.indexOf(o.mid)!==-1));if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map((async o=>{o.direction="sendonly"}));const r=await this.peerConnection.createOffer(),i=this.logSDPExchange(r.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(r),this.remoteSDP.unmuteRemote(t);const s=this.remoteSDP.toString();i?.(s),await this.setRemoteDescription({type:"answer",sdp:s})}catch(n){throw new de(V.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(n.toString()))}}async getRemoteSSRC(t,n){var r;if(n=n??((r=this.currentRemoteDescription)===null||r===void 0?void 0:r.sdp)){var i;const s=(i=$i(n).mediaDescriptions.find((o=>o.attributes.mid===t)))===null||i===void 0?void 0:i.attributes.ssrcs;return s?.[0].ssrcId}}async setRemoteDescription(t){var n;await this.peerConnection.setRemoteDescription(t),be(n=["connected","completed"]).call(n,this.peerConnection.iceConnectionState)||(this.isReady=!0,this.addRemoteCandidate())}mungReceiveAnswerSDP(t,n,r){const i=$i(t),s=i.mediaDescriptions.find((o=>o.attributes.mid===n));return s&&r===Me.AUDIO&&s.media.mediaType==="audio"&&im(s),Nd(i)}},Be(Tn.prototype,"establish",[Qo],Object.getOwnPropertyDescriptor(Tn.prototype,"establish"),Tn.prototype),Be(Tn.prototype,"connect",[Qo],Object.getOwnPropertyDescriptor(Tn.prototype,"connect"),Tn.prototype),Be(Tn.prototype,"receive",[Qo],Object.getOwnPropertyDescriptor(Tn.prototype,"receive"),Tn.prototype),Be(Tn.prototype,"mockReceive",[Qo],Object.getOwnPropertyDescriptor(Tn.prototype,"mockReceive"),Tn.prototype),Be(Tn.prototype,"stopReceiving",[Qo],Object.getOwnPropertyDescriptor(Tn.prototype,"stopReceiving"),Tn.prototype),Be(Tn.prototype,"restartICE",[Qo],Object.getOwnPropertyDescriptor(Tn.prototype,"restartICE"),Tn.prototype),Be(Tn.prototype,"close",[Qo],Object.getOwnPropertyDescriptor(Tn.prototype,"close"),Tn.prototype),Be(Tn.prototype,"updateEncoderConfig",[Qo],Object.getOwnPropertyDescriptor(Tn.prototype,"updateEncoderConfig"),Tn.prototype),Be(Tn.prototype,"updateSendParameters",[Qo],Object.getOwnPropertyDescriptor(Tn.prototype,"updateSendParameters"),Tn.prototype),Be(Tn.prototype,"replaceTrack",[Qo],Object.getOwnPropertyDescriptor(Tn.prototype,"replaceTrack"),Tn.prototype),Be(Tn.prototype,"muteLocal",[Qo],Object.getOwnPropertyDescriptor(Tn.prototype,"muteLocal"),Tn.prototype),Be(Tn.prototype,"unmuteLocal",[Qo],Object.getOwnPropertyDescriptor(Tn.prototype,"unmuteLocal"),Tn.prototype),Tn);function Qo(e,t,n){const r=e[t];if(typeof r!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const i=this.mutex,s=await i.lock("From P2PConnection.".concat(t));try{for(var o=arguments.length,c=new Array(o),d=0;d<o;d++)c[d]=arguments[d];return await r.apply(this,c)}finally{s()}},n}let ka=(function(e){return e.SEND_ONLY="SEND_ONLY",e.RECEIVE_ONLY="RECEIVE_ONLY",e})({});var CV,bV,IV,AV,NV,OV,PV,DV,kV,xV,LV,Pn;function MV(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable}))),n.push.apply(n,r)}return n}function aR(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?MV(Object(n),!0).forEach((function(r){x(e,r,n[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):MV(Object(n)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))}))}return e}let UX=(CV=xa(ka.SEND_ONLY),bV=xa(ka.SEND_ONLY),IV=xa(),AV=xa(ka.RECEIVE_ONLY),NV=xa(ka.RECEIVE_ONLY),OV=xa(ka.RECEIVE_ONLY),PV=xa(ka.RECEIVE_ONLY),DV=xa(ka.RECEIVE_ONLY),kV=xa(ka.RECEIVE_ONLY),xV=xa(),LV=xa(ka.RECEIVE_ONLY),Pn=class extends xn{get state(){return this._state}set state(e){const t=this._state;this._state=e,this.emit(Xe.StateChange,t,this._state)}constructor(e,t){super(),x(this,"isPlanB",!1),x(this,"store",void 0),x(this,"statsUploader",void 0),x(this,"sendConnection",void 0),x(this,"recvConnection",void 0),x(this,"localTrackMap",new Map),x(this,"remoteUserMap",new Map),x(this,"localDataChannels",[]),x(this,"pendingLocalTracks",[]),x(this,"pendingRemoteTracks",[]),x(this,"statsCollector",void 0),x(this,"dtlsFailedCount",0),x(this,"sendMutex",void 0),x(this,"recvMutex",void 0),x(this,"_state",en.Disconnected),x(this,"_restartStates",["disconnected","failed"]),x(this,"reconnectInterval",void 0),x(this,"uploadUnplinkStarted",!1),x(this,"uploadDownlinkStarted",!1),x(this,"uplinkStateUploadInterval",void 0),x(this,"downlinkStatsUploadInterval",void 0),x(this,"handleMuteLocalTrack",(async(n,r,i)=>{const s=await this.sendMutex.lock("Locking from P2PChannel2.handleMuteLocalTrack");try{if(!this.sendConnection||this.state!==en.Connected)return void i(new de(V.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established."));const d=this.filterTobeMutedTracks(n);if(d.length===0)return void r();const h=d.find((S=>S[0]==="videoLowTrack"));h&&h[1].track._originMediaStreamTrack.stop(),await this.sendConnection.muteLocal(d.map((S=>{let[,{id:O}]=S;return O})));let f=!1;var o,c;n.trackMediaType==="video"?f=!((o=this.localTrackMap.get(ve.LocalAudioTrack))===null||o===void 0||!o.track._muted):f=((c=this.localTrackMap.get(ve.LocalVideoTrack))===null||c===void 0?void 0:c.id)===void 0;const g=this.createMuteMessage(d);await un(this,Xe.RequestMuteLocal,g);const E=n.trackMediaType==="video"?Dd.MUTE_LOCAL_VIDEO:Dd.MUTE_LOCAL_AUDIO;await un(this,Xe.RequestP2PMuteLocal,{action:E,message:g,isMuteAll:f}),r()}catch(d){i(d)}finally{s()}})),x(this,"handleUnmuteLocalTrack",(async(n,r,i)=>{const s=await this.sendMutex.lock("Locking from P2PChannel2.handleUnmuteLocalTrack");try{if(!this.sendConnection||this.state!==en.Connected)return void i(new de(V.INVALID_OPERATION,"Cannot call P2PChannel2.handleUnmuteLocalTrack before sendConnection established."));const o=this.filterTobeUnmutedTracks(n);if(o.length===0)return void r();await this.sendConnection.unmuteLocal(o.map((h=>{let[,{id:f}]=h;return f})));const c=this.createUnmuteMessage(o),d=n.trackMediaType==="video"?Dd.UNMUTE_LOCAL_VIDEO:Dd.UNMUTE_LOCAL_AUDIO;await un(this,Xe.RequestP2PMuteLocal,{action:d,message:c}),r()}catch(o){i(o)}finally{s()}})),x(this,"handleUpdateVideoEncoder",(async(n,r,i,s)=>{let o;typeof s=="boolean"&&s||(o=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoEncoder"));try{const d=this.localTrackMap.get(ve.LocalVideoTrack);if(!this.sendConnection||!d||d.track!==n||this.state!==en.Connected)return void r();const{id:h,track:f}=d;h&&(await this.sendConnection.updateSendParameters(h,f),await this.sendConnection.updateEncoderConfig(h,f),this.emit(Xe.UpdateVideoEncoder,f)),r()}catch(d){i(d)}finally{var c;(c=o)===null||c===void 0||c()}})),x(this,"handleUpdateVideoSendParameters",(async(n,r,i)=>{const s=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoSendParameters");try{const o=this.localTrackMap.get(ve.LocalVideoTrack);if(!this.sendConnection||!o||o.track!==n||this.state!==en.Connected)return void r();const{id:c,track:d}=o;c&&await this.sendConnection.updateSendParameters(c,d),r()}catch(o){i(o)}finally{s()}})),x(this,"handleReplaceTrack",(async(n,r,i,s)=>{let o;w.debug("[".concat(this.store.clientId,"] P2PChannel2 handleReplaceTrack for [track-id-").concat(n.getTrackId(),"]")),typeof s=="boolean"&&s||(o=await this.sendMutex.lock("From P2PChannel2.handleReplaceTrack"));try{var c;const h=Array.from(this.localTrackMap.entries()).find((f=>{let[,{track:g}]=f;return n===g}));if(!this.sendConnection||!h||h[1].id===void 0||this.state!==en.Connected)return void r();if(await((c=this.sendConnection)===null||c===void 0?void 0:c.replaceTrack(n,h[1].id)),h[0]===ve.LocalVideoTrack&&Bt().supportDualStreamEncoding){const f=this.localTrackMap.get(ve.LocalVideoLowTrack);if(f){const g=n._mediaStreamTrack.clone();f.track._originMediaStreamTrack.stop(),f.track._mediaStreamTrack=g,f.track._originMediaStreamTrack=g,await new ke(((E,S)=>{this.handleReplaceTrack(f.track,E,S,!0)}))}}r()}catch(h){i(h)}finally{var d;(d=o)===null||d===void 0||d()}})),x(this,"handleGetLocalVideoStats",(n=>{n(this.statsCollector.getLocalVideoTrackStats())})),x(this,"handleGetLocalAudioStats",(n=>{n(this.statsCollector.getLocalAudioTrackStats())})),x(this,"handleGetRemoteVideoStats",(n=>this.statsCollector.getRemoteVideoTrackStats(n.uid)[n.uid])),x(this,"handleGetRemoteAudioStats",(n=>this.statsCollector.getRemoteAudioTrackStats(n.uid)[n.uid])),this.store=e,this.statsCollector=t,this.statsCollector.addP2PChannel(this),this.statsUploader=new $2(e),this.bindStatsUploaderEvents(),this.sendMutex=new Jr("P2PChannel2-send-mutex",e.clientId),this.recvMutex=new Jr("P2PChannel2-recv-mutex",e.clientId),this.reconnectInterval=window.setInterval((()=>{[this.sendConnection,this.recvConnection].forEach((n=>{n&&(n.iceConnectionState!=="disconnected"&&n.iceConnectionState!=="failed"||this.handleDisconnect(n.direction))}))}),B("ICE_RESTART_INTERVAL"))}async startP2PConnection(e,t){throw new de(V.NOT_SUPPORTED,"p2p mode does not support startP2PConnection.")}async connect(e){throw new de(V.NOT_SUPPORTED,"p2p mode does not support connect.")}async startP2P(e,t){let n;try{if(t){this.recvConnection&&(w.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset recvConnection.")),this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection)),n=await this.recvMutex.lock("From P2PChannel.startP2P"),this.recvConnection=new wV(e,this.store,Ai.RECEIVE_ONLY),this.bindConnectionEvents(this.recvConnection);const r=await this.recvConnection.establish(t);return{iceParameters:r.iceParameters,dtlsParameters:r.dtlsParameters,sdp:r.sdp}}{this.state=en.New,this.sendConnection&&(w.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset sendConnection.")),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection)),n=await this.sendMutex.lock("From P2PChannel.startP2P"),this.sendConnection=new wV(e,this.store),this.store.peerConnectionStart(),this.bindConnectionEvents(this.sendConnection);const r=await this.sendConnection.establish();return{iceParameters:r.iceParameters,dtlsParameters:r.dtlsParameters,sdp:r.sdp}}}finally{n&&n()}}async p2pConnect(e){if(!this.sendConnection)throw new de(V.UNEXPECTED_ERROR,"Cannot P2PChannel2.p2pConnect before P2PChannel2.startP2PConnection .");this.store.peerConnectionStart(),await this.sendConnection.connect(e),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=en.Connected}async addRemoteCandidate(e,t){if(t===Ai.RECEIVE_ONLY){if(!this.sendConnection)throw new de(V.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.sendConnection.addRemoteCandidate(e)}else{if(!this.recvConnection)throw new de(V.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.recvConnection.addRemoteCandidate(e)}}publish(e,t,n){var r=this;return no((function*(){const i=yield Ft(r.sendMutex.lock("From P2PChannel.publish"));try{if(!r.sendConnection||r.state!==en.Connected){r.throwIfTrackTypeNotMatch(e);const h=e.filter((f=>r.pendingLocalTracks.indexOf(f)===-1));return void(r.pendingLocalTracks=r.pendingLocalTracks.concat(h))}r.store.pubId=r.store.pubId+1,ei.markPublishStart(r.store.clientId,r.store.pubId);const s=r.filterTobePublishedTracks(e,t,n);if(s.length===0)return void(yield Ft(r.tryToUnmuteAudio(e)));s.forEach((h=>{let{track:f,type:g}=h;const E=Date.now();r.store.publish(f.getTrackId(),g===ve.LocalAudioTrack?"audio":"video",E)})),r.bindLocalTrackEvents(s);const o=yield Ft(r.sendConnection.send(s.map((h=>{let{track:f}=h;return f})),r.store.codec,r.store.audioCodec)),c=(yield Ft(o.next())).value,d=r.createGatewayPublishMessage(s,c);try{yield d}catch(h){throw o.throw(h),h?.code===V.WS_ABORT&&s.forEach((f=>{let{track:g}=f;r.pendingLocalTracks.indexOf(g)===-1&&r.pendingLocalTracks.push(g)})),r.unbindLocalTrackEvents(s),h}yield Ft(o.next()),s.forEach((h=>{let{type:f}=h;r.statsCollector.addLocalStats(f)})),r.statsUploader.startUploadOutboundStats(),r.assignLocalTracks(s,c),s.forEach((h=>{let{track:f,type:g}=h;const E=Date.now();r.store.publish(f.getTrackId(),g===ve.LocalAudioTrack?"audio":"video",void 0,E)})),r.startUploadUplinkState()}finally{i()}}))()}async unpublish(e){if(!this.sendConnection||this.state!==en.Connected)return void(e.length===0?this.pendingLocalTracks.length=0:this.pendingLocalTracks=this.pendingLocalTracks.filter((i=>!be(e).call(e,i))));const t=this.filterTobeUnpublishedTracks(e);if(t.length===0)return;const n=t.find((i=>i[0]==="videoLowTrack"));n&&n[1].track.close();const r=this.createGatewayUnpublishMessage(t);if(await this.sendConnection.stopSending(t.map((i=>{let[,{id:s}]=i;return s}))),this.withdrawLocalTracks(t),this.unbindLocalTrackEvents(t.map((i=>{let[s,{track:o}]=i;return{type:s,track:o}}))),t.forEach((i=>{let[s]=i;this.statsCollector.removeLocalStats(s)})),this.localTrackMap.size===0&&(this.statsUploader.stopUploadOutboundStats(),this.stopUploadUplinkState()),this.sendConnection&&this.state===en.Connected)return n&&n[1].track.close(),r;e.forEach((i=>{const s=this.pendingLocalTracks.indexOf(i);s!==-1&&this.pendingLocalTracks.splice(s,1)}))}startUploadUplinkState(){if(this.uploadUnplinkStarted)return;this.uploadUnplinkStarted=!0,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval);const e=()=>{const t=[],n=[];Array.from(this.localTrackMap.entries()).forEach((r=>{let[i,{track:s,ssrcs:o}]=r;const c={stream_type:N7(s,i),ssrcs:o};s._muted||!s._enabled?t.push(c):n.push(c)})),t.length>0&&t.forEach((r=>{un(this,Xe.RequestMuteLocal,[r])})),n.length>0&&n.forEach((r=>{un(this,Xe.RequestUnmuteLocal,[r])}))};e(),this.uplinkStateUploadInterval=window.setInterval((()=>{e()}),3e3)}stopUploadUplinkState(){this.uploadUnplinkStarted&&(this.uploadUnplinkStarted=!1,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval))}publishLowStream(e){return no((function*(){throw new de(V.NOT_SUPPORTED,"p2p mode does not support publishLowStream.")}))()}async republish(){this.pendingLocalTracks.length>0&&(w.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await Gr(this,Xe.RequestRePublish,this.pendingLocalTracks),this.emit(Xe.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[])}async unpublishLowStream(){throw new de(V.NOT_SUPPORTED,"p2p mode does not support unpublishLowStream.")}async subscribe(e,t,n,r){var i;if(!this.recvConnection)throw new de(V.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");if((i=this.remoteUserMap.get(e))!==null&&i!==void 0&&i.has(t))return;const{track:s,mid:o,transceiver:c}=await this.recvConnection.receive(t,[{ssrcId:n}],String(e.uid),r);t===Me.AUDIO?(e._audioTrack?e._audioTrack._updateOriginMediaStreamTrack(s):(e._audioTrack=new Xf(s,e.uid,e._uintid,this.store),w.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(e._audioTrack.getTrackId()))),c&&e._audioTrack._updateRtpTransceiver(c),this.bindRemoteTrackEvents(e,e._audioTrack)):(e._videoSSRC=n,e._videoTrack?e._videoTrack._updateOriginMediaStreamTrack(s):(e._videoTrack=new qf(s,e.uid,e._uintid,this.store),w.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(e._videoTrack.getTrackId()))),c&&e._videoTrack._updateRtpTransceiver(c),this.bindRemoteTrackEvents(e,e._videoTrack));const d=this.remoteUserMap.get(e);d?d.set(t,o):this.remoteUserMap.set(e,new Map([[t,o]])),this.statsCollector.addRemoteStats(e.uid),this.statsUploader.startUploadInboundStats(),this.startUploadDownlinkState();const h=this.pendingRemoteTracks.findIndex((f=>{let{user:g,kind:E}=f;return g.uid===e.uid&&t===E}));h!==-1&&(this.pendingRemoteTracks.splice(h,1),this.emit(Xe.MediaReconnectEnd,e.uid))}async mockSubscribe(e,t,n,r){if(!this.recvConnection)throw new de(V.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");await this.recvConnection.mockReceive(t,[{ssrcId:n}],String(e.uid),r)}async unsubscribe(e,t,n){const r=this.pendingRemoteTracks.filter((s=>{let{user:o,kind:c}=s;return t!==void 0?o.uid===e.uid&&t===c:o.uid===e.uid}));if(r.forEach((s=>{const o=this.pendingRemoteTracks.indexOf(s);this.pendingRemoteTracks.splice(o,1)})),this.recvConnection||n||r.forEach((s=>{let{kind:o}=s;var c;if(o===Me.AUDIO)(c=e._audioTrack)===null||c===void 0||c._destroy(),e._audioTrack=void 0;else if(o===Me.VIDEO){var d;(d=e._videoTrack)===null||d===void 0||d._destroy(),e._videoTrack=void 0}})),!this.recvConnection)return;const i=this.filterTobeUnSubscribedTracks(e,t);i.length!==0&&(await this.recvConnection.stopReceiving(i.map((s=>{let[,{id:o}]=s;return o}))),this.withdrawRemoteTracks(i),this.remoteUserMap.size===0&&(this.statsUploader.stopUploadInboundStats(),this.stopUploadDownlinkState()),i.forEach((s=>{let[o,{kind:c}]=s;var d,h;if(c===Me.VIDEO&&o._videoSSRC&&((d=this.recvConnection)===null||d===void 0||d.setStatsRemoteVideoIsReady(o._videoSSRC,!1)),c===Me.VIDEO)this.unbindRemoteTrackEvents(o._videoTrack),n||((h=o._videoTrack)===null||h===void 0||h._destroy(),o._videoTrack=void 0);else if(c===Me.AUDIO){var f;this.unbindRemoteTrackEvents(o._audioTrack),!n&&((f=o._audioTrack)===null||f===void 0||f._destroy(),o._audioTrack=void 0)}})),i.forEach((s=>{let[,{kind:o}]=s;un(this,Xe.RequestP2PMuteRemote,o)})))}startUploadDownlinkState(){if(this.uploadDownlinkStarted)return;this.uploadDownlinkStarted=!0,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval);const e=()=>Array.from(this.remoteUserMap.entries()).forEach((t=>{let[,n]=t;[Me.VIDEO,Me.AUDIO].forEach((r=>{n.has(r)?un(this,Xe.RequestP2PUnmuteRemote,r):un(this,Xe.RequestP2PMuteRemote,r)}))}));e(),this.downlinkStatsUploadInterval=window.setInterval((()=>{e()}),3e3)}stopUploadDownlinkState(){this.uploadDownlinkStarted&&(this.uploadDownlinkStarted=!1,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval))}getAllDataChannels(){return this.localDataChannels}async massSubscribe(e){throw new de(V.NOT_SUPPORTED,"p2p mode does not support massSubscribe.")}async massSubscribeNoLock(e){throw new de(V.NOT_SUPPORTED,"p2p mode does not support massSubscribeNoLock.")}async massUnsubscribe(e){throw new de(V.NOT_SUPPORTED,"p2p mode does not support massUnsubscribe.")}async massUnsubscribeNoLock(e){throw new de(V.NOT_SUPPORTED,"p2p mode does not support massUnsubscribeNoLock.")}async muteRemote(e,t){if(!this.recvConnection)return;const n=this.remoteUserMap.get(e);if(!n)return void w.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(e.uid,"."));if(!n.get(t))return void w.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."));const r=t===Me.VIDEO?e._videoSSRC:e._audioSSRC;r!==void 0&&this.recvConnection.setStatsRemoteVideoIsReady(r,!1)}async unmuteRemote(e,t){return this.unmuteRemoteNoLock(e,t)}async unmuteRemoteNoLock(e,t){if(!this.recvConnection)return;const n=this.remoteUserMap.get(e);if(!n)return void w.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(e.uid,"."));n.get(t)||w.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."))}getAllTracks(e){const t=this.localTrackMap.get(ve.LocalAudioTrack);if(t?.track instanceof cr){const n=t.track;return Array.from(this.localTrackMap.entries()).filter((r=>{let[i]=r;return i!==ve.LocalAudioTrack})).filter((r=>{let[i]=r;return!(e&&i===ve.LocalVideoLowTrack)})).map((r=>{let[,{track:i}]=r;return i})).concat(n.trackList)}return Array.from(this.localTrackMap.entries()).filter((n=>{let[r]=n;return!(e&&r===ve.LocalVideoLowTrack)})).map((n=>{let[,{track:r}]=n;return r}))}reportPublishEvent(e,t,n,r,i){if(e){const o=this.localTrackMap.get(ve.LocalAudioTrack),c=r?this.localTrackMap.get(ve.LocalVideoLowTrack):this.localTrackMap.get(ve.LocalVideoTrack);We.publish(this.store.sessionId,{eventElapse:ei.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:o?.track.getTrackLabel(),videoName:c?.track.getTrackLabel(),screenshare:c?.track._hints.indexOf(ln.SCREEN_TRACK)!==-1,audio:!!o,video:!!c,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:i})}else{var s;n||(n=[]);const o=n.find((d=>d instanceof Wn)),c=r?(s=this.localTrackMap.get(ve.LocalVideoTrack))===null||s===void 0?void 0:s.track:n.find((d=>d instanceof Sn));We.publish(this.store.sessionId,{eventElapse:ei.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:o?.getTrackLabel(),videoName:c?.getTrackLabel(),screenshare:c?._hints.indexOf(ln.SCREEN_TRACK)!==-1,audio:!!o,video:!!c,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:i})}}reportSubscribeEvent(e,t,n,r){const i=r===Me.VIDEO?n._videoSSRC:n._audioSSRC;i&&We.subscribe(this.store.sessionId,{succ:e,ec:t,video:r===Me.VIDEO,audio:r===Me.AUDIO,peerid:n.uid,subscribeRequestid:r===Me.VIDEO?n._videoSSRC:n._audioSSRC,p2pid:this.store.p2pId,eventElapse:ei.measureFromSubscribeStart(this.store.clientId,i)})}reset(){w.debug("[".concat(this.store.clientId,"] P2PChannel2.reset")),this.sendMutex=new Jr("P2PChannel2-send-mutex",this.store.clientId),this.sendMutex=new Jr("P2PChannel2-recv-mutex",this.store.clientId),this.sendConnection&&(this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0),this.recvConnection&&(this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const e=this.localTrackMap.get(ve.LocalAudioTrack);if(e?.track instanceof cr){if(e.track.trackList.length>0){const t=e.track;e.track.trackList.forEach((n=>{t.removeAudioTrack(n)}))}e.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.reconnectInterval&&(window.clearInterval(this.reconnectInterval),this.reconnectInterval=void 0),this.state=en.Disconnected}getStats(e){var t,n;return e?(n=this.recvConnection)===null||n===void 0?void 0:n.getStats():(t=this.sendConnection)===null||t===void 0?void 0:t.getStats()}getRemoteVideoIsReady(e){var t;return((t=this.recvConnection)===null||t===void 0?void 0:t.getRemoteVideoIsReady(e))||!1}getLocalAudioVolume(){const e=this.localTrackMap.get(ve.LocalAudioTrack);if(e)return e.track.getVolumeLevel()}getLocalVideoSize(){const e=this.localTrackMap.get(ve.LocalVideoTrack);if(e)return{width:e.track.videoWidth||0,height:e.track.videoHeight||0}}getEncoderConfig(e){const t=this.localTrackMap.get(e);return t&&t.track instanceof Sn||t&&t.track instanceof Wn?t.track._encoderConfig:void 0}getLocalMedia(e){return this.localTrackMap.get(e)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(e,t){if(!e)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(e);return!!n&&(!t||n.has(t))}async hasRemoteMediaWithLock(e,t){if(!e)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(e);return!!n&&(!t||n.has(t))}getRemoteMedia(e){var t;const n=Array.from(es(t=this.remoteUserMap).call(t)).find((r=>r.uid===e));return n?{audioTrack:n.audioTrack,audioSSRC:n._audioSSRC,videoTrack:n.videoTrack,videoSSRC:n._videoSSRC}:{}}getAudioLevels(){let e=Array.from(this.remoteUserMap.entries()).map((n=>{let[r]=n;return{uid:r.uid,level:r.audioTrack?100*r.audioTrack._source.getAccurateVolumeLevel():0}}));const t=this.localTrackMap.get(ve.LocalAudioTrack);return t&&e.push({level:100*t.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e=hh(e).call(e,((n,r)=>n.level-r.level)),e}async disconnectForReconnect(){this.sendConnection&&this.recvConnection&&(w.debug("[".concat(this.store.clientId,"] P2PChannel2.disconnectForReconnect closing P2PConnection")),this.state=en.Reconnecting,B("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach((e=>{let[t]=e;var n;t._videoTrack&&t._videoTrack._player&&((n=t._videoTrack._player.getVideoElement())===null||n===void 0||n.pause(),t._videoTrack._player.isKeepLastFrame=!0,t._videoTrack._originMediaStreamTrack.stop())})),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0,this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0,this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach((e=>{var t;let[n,{track:r}]=e;switch(n){case ve.LocalVideoTrack:be(t=r._hints).call(t,ln.LOW_STREAM)?r.close():this.pendingLocalTracks.push(r);break;case ve.LocalAudioTrack:r instanceof cr?this.pendingLocalTracks=this.pendingLocalTracks.concat(r.trackList):this.pendingLocalTracks.push(r);case ve.LocalVideoLowTrack:}})),this.emit(Xe.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach((e=>{let[t,n]=e;Array.from(es(n).call(n)).forEach((r=>{this.setPendingRemoteMedia(t,r)})),this.emit(Xe.MediaReconnectStart,t.uid)})),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),w.debug("[".concat(this.store.clientId,"] P2PChannel2 disconnected, waiting to reconnect.")))}hasPendingRemoteMedia(e,t){for(const n of this.pendingRemoteTracks){const{user:r,kind:i}=n;if((e instanceof Vd?e.uid:e)===r.uid&&t===i)return!0}return!1}setPendingRemoteMedia(e,t){this.hasPendingRemoteMedia(e,t)||this.pendingRemoteTracks.push({user:e,kind:t})}async restartICE(e,t){let n,r;if(e===Ai.SEND_ONLY){if(!this.sendConnection)throw new de(V.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established.");n=await this.sendMutex.lock("From P2PChannel.restartICE"),r=this.sendConnection}else{if(!this.recvConnection)throw new de(V.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before recvConnection established.");n=await this.recvMutex.lock("From P2PChannel.restartICE"),r=this.recvConnection}try{if(t){const i=await r.restartICE(t);return r.isInRestartIce=!1,i}{const i=await r.restartICE();if(i){const s=await Gr(this,Xe.RequestP2PRestartICE,{direction:Ai.RECEIVE_ONLY,iceParameter:i});await r.restartICE(s),r.isInRestartIce=!1}}}finally{n()}}getUplinkNetworkQuality(){if(!this.sendConnection)return 0;const e=this.sendConnection.getStats(),t=this.localTrackMap.get(ve.LocalVideoTrack),n=this.localTrackMap.get(ve.LocalAudioTrack),r=e.videoSend.find((S=>{var O;return S.ssrc===(t==null||(O=t.ssrcs)===null||O===void 0?void 0:O[0].ssrcId)})),i=e.audioSend.find((S=>{var O;return S.ssrc===(n==null||(O=n.ssrcs)===null||O===void 0?void 0:O[0].ssrcId)}));if(!r||!i)return 1;const s=As(this,Xe.NeedSignalRTT),o=r?r.rttMs:void 0,c=i?i.rttMs:void 0,d=o&&c?(o+c)/2:o||c,h=(d&&s?(d+s)/2:d||s)||0,f=100*e.sendPacketLossRate*.7/50+.3*h/1500,g=f<.17?1:f<.36?2:f<.59?3:f<.1?4:5,E=t?.track;if(E&&E._encoderConfig&&E._hints.indexOf(ln.SCREEN_TRACK)===-1){const S=E._encoderConfig.bitrateMax,O=e.bitrate.actualEncoded;if(S&&O){const A=(1e3*S-O)/(1e3*S);return GM[A<.15?0:A<.3?1:A<.45?2:A<.6?3:4][g]}}return g}getDownlinkNetworkQuality(){if(!this.recvConnection)return 0;const e=this.recvConnection.getStats();let t=0;return Array.from(this.remoteUserMap.entries()).forEach((n=>{let[r]=n;const i=r._audioSSRC,s=r._videoSSRC,o=e.audioRecv.find((O=>O.ssrc===i)),c=e.videoRecv.find((O=>O.ssrc===s));if(!o&&!c)return void(t+=1);const d=As(this,Xe.NeedSignalRTT),h=e.rtt,f=(h&&d?(h+d)/2:h||d)||0,g=o?o.jitterMs:void 0,E=e.recvPacketLossRate;let S=.7*E*100/50+.3*f/1500;g&&(S=.6*E*100/50+.2*f/1500+.2*g/400),t+=S<.1?1:S<.17?2:S<.36?3:S<.59?4:5})),this.remoteUserMap.size>0?Math.round(t/this.remoteUserMap.size):t}async muteLocalTrack(e){return new ke(((t,n)=>{this.handleMuteLocalTrack(e,t,n)}))}filterTobePublishedTracks(e,t,n){const r=[],i=Bt(),s=this.getAllTracks();e=Lf(e=e.filter((d=>s.indexOf(d)===-1)));let o=!1,c=!1;for(const d of e){if(d instanceof Sn&&(this.localTrackMap.has(ve.LocalVideoTrack)||o?new de(V.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(r.push({track:d,type:ve.LocalVideoTrack}),o=!0),t)){const h=this.getLowVideoTrack(d,n);r.push({track:h,type:ve.LocalVideoLowTrack})}if(d instanceof Wn){const h=this.localTrackMap.get(ve.LocalAudioTrack);if(h){if(!(h.track instanceof cr))throw new de(V.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(d._bypassWebAudio)throw new de(V.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");h.track.addAudioTrack(d),this.bindLocalAudioTrackEvents(d,!0)}else if(c){const f=r.find((g=>{let{type:E}=g;return E===ve.LocalAudioTrack}));if(!(f.track instanceof cr))throw new de(V.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(d._bypassWebAudio)throw new de(V.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");f.track.addAudioTrack(d)}else{if(!i.webAudioMediaStreamDest||d instanceof cr||d._bypassWebAudio)r.push({track:d,type:ve.LocalAudioTrack});else{const f=new cr;f.addAudioTrack(d),r.push({track:f,type:ve.LocalAudioTrack})}c=!0}}}return r}filterTobeUnpublishedTracks(e){const t=[],n=this.getAllTracks();e=Lf(e=e.filter((r=>n.indexOf(r)!==-1)));for(const r of e){if(r instanceof Wn){const i=this.localTrackMap.get(ve.LocalAudioTrack);if(!i)continue;i.track instanceof cr?(i.track.removeAudioTrack(r),this.unbindLocalAudioTrackEvents(r),i.track.trackList.length===0&&(t.push([ve.LocalAudioTrack,i]),i.track.close())):t.push([ve.LocalAudioTrack,i])}if(r instanceof Sn){const i=this.localTrackMap.get(ve.LocalVideoTrack);if(!i)continue;t.push([ve.LocalVideoTrack,i]);const s=this.localTrackMap.get(ve.LocalVideoLowTrack);s&&t.push([ve.LocalVideoLowTrack,s])}}return t}bindLocalTrackEvents(e){e.forEach((t=>{let{track:n,type:r}=t;switch(r){case ve.LocalVideoTrack:n.addListener(Ve.GET_STATS,this.handleGetLocalVideoStats),n.addListener(Ve.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(Ve.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(Ve.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n.addListener(Ve.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),n.addListener(Ve.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.addListener(Ve.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(Ve.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case ve.LocalAudioTrack:this.bindLocalAudioTrackEvents(n);case ve.LocalVideoLowTrack:}}))}bindLocalAudioTrackEvents(e,t){e instanceof cr?e.trackList.forEach((n=>{n.addListener(Ve.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(Ve.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(Ve.GET_STATS,this.handleGetLocalAudioStats),n.addListener(Ve.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(Ve.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)})):(e.addListener(Ve.GET_STATS,this.handleGetLocalAudioStats),e.addListener(Ve.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(Ve.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(Ve.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(Ve.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),t||e.addListener(Ve.NEED_REPLACE_TRACK,this.handleReplaceTrack))}unbindLocalTrackEvents(e){e||(e=Array.from(this.localTrackMap.entries()).map((t=>{let[n,{track:r}]=t;return{track:r,type:n}}))),e.forEach((t=>{let{track:n,type:r}=t;switch(r){case ve.LocalVideoTrack:n.off(Ve.GET_STATS,this.handleGetLocalVideoStats),n.off(Ve.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.off(Ve.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.off(Ve.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n.off(Ve.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),n.off(Ve.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.off(Ve.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.off(Ve.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case ve.LocalAudioTrack:this.unbindLocalAudioTrackEvents(n);case ve.LocalVideoLowTrack:}}))}unbindLocalAudioTrackEvents(e){e instanceof cr?e.trackList.forEach((t=>{t.off(Ve.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(Ve.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(Ve.GET_STATS,this.handleGetLocalAudioStats),t.off(Ve.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(Ve.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)})):(e.off(Ve.GET_STATS,this.handleGetLocalAudioStats),e.off(Ve.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(Ve.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(Ve.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(Ve.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(Ve.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(e,t){t instanceof qf&&t.addListener(Ve.GET_STATS,(n=>{n(this.handleGetRemoteVideoStats(e))})),t instanceof Xf&&t.addListener(Ve.GET_STATS,(n=>{n(this.handleGetRemoteAudioStats(e))}))}unbindRemoteTrackEvents(e){e&&e.removeAllListeners(Ve.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach((e=>{let[t,n]=e;n.has(Me.AUDIO)&&this.unbindRemoteTrackEvents(t._audioTrack),n.has(Me.VIDEO)&&this.unbindRemoteTrackEvents(t._videoTrack)}))}createGatewayPublishMessage(e,t){return e.map(((n,r)=>{var i;let s,{track:o,type:c}=n;switch(c){case ve.LocalAudioTrack:s=tn.Audio;break;case ve.LocalVideoTrack:s=be(i=o._hints).call(i,ln.SCREEN_TRACK)?tn.Screen:tn.High;break;case ve.LocalVideoLowTrack:s=tn.Low}return{kind:c===ve.LocalAudioTrack?Me.AUDIO:Me.VIDEO,stream_type:s,mid:t[r].id,ssrcs:t[r].localSSRC,isMuted:o.muted||!o.enabled}}))}createGatewayUnpublishMessage(e){return e.map((t=>{var n;let r,[i,{track:s,ssrcs:o,id:c}]=t;switch(i){case ve.LocalVideoTrack:r=be(n=s._hints).call(n,ln.SCREEN_TRACK)?tn.Screen:tn.High;break;case ve.LocalAudioTrack:r=tn.Audio;break;case ve.LocalVideoLowTrack:r=tn.Low}return{stream_type:r,ssrcs:o,mid:c}}))}assignLocalTracks(e,t){e.forEach(((n,r)=>{let{track:i,type:s}=n;this.localTrackMap.set(s,{track:i,id:t[r].id,ssrcs:t[r].localSSRC})}))}withdrawLocalTracks(e){e.forEach((t=>{let[n]=t;this.localTrackMap.delete(n)}))}bindConnectionEvents(e){e.onConnectionStateChange=async t=>{var n;w.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: ").concat(e.name,".onConnectionStateChange(").concat(t,")")),this.emit(Xe.PeerConnectionStateChange,t),t!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),t==="connected"&&(e.isInRestartIce=!1),be(n=this._restartStates).call(n,t)&&!e.isInRestartIce&&(t==="disconnected"&&await xr(800),e.iceConnectionState!=="disconnected"&&e.iceConnectionState!=="failed"||this.handleDisconnect(e.direction))},e.onICEConnectionStateChange=t=>{t!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),w.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(t,")")),We.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:t,tag:Nn.TRACER}).onSuccess(),this.emit(Xe.IceConnectionStateChange,t)},e.onICETransportStateChange=t=>{w.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(t,")"))},e.onDTLSTransportStateChange=t=>{w.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(t,")"))},e.onDTLSTransportError=t=>{w.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(t,")"))},e.onFirstAudioDecoded=t=>{var n;const r=Array.from(es(n=this.remoteUserMap).call(n)).find((s=>s._audioSSRC===t));var i;r&&(this.store.subscribe(r.uid,"audio",void 0,void 0,void 0,Date.now()),(i=r.audioTrack)===null||i===void 0||i.emit(so.FIRST_FRAME_DECODED),We.firstRemoteFrame(this.store.sessionId,fr.FIRST_AUDIO_DECODE,In.FIRST_AUDIO_DECODE,{peer:r._uintid,subscribeElapse:ei.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId}))},e.onFirstAudioReceived=t=>{var n;const r=Array.from(es(n=this.remoteUserMap).call(n)).find((i=>i._audioSSRC===t));r&&We.firstRemoteFrame(this.store.sessionId,fr.FIRST_AUDIO_RECEIVED,In.FIRST_AUDIO_RECEIVED,{peer:r._uintid,subscribeElapse:ei.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onFirstVideoDecoded=(t,n,r)=>{this.reportVideoFirstFrameDecoded(t,n,r)},e.onFirstVideoReceived=t=>{var n;const r=Array.from(es(n=this.remoteUserMap).call(n)).find((i=>i._videoSSRC===t));r&&We.firstRemoteFrame(this.store.sessionId,fr.FIRST_VIDEO_RECEIVED,In.FIRST_VIDEO_RECEIVED,{peer:r._uintid,subscribeElapse:ei.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onSelectedLocalCandidateChanged=(t,n)=>{const r=t.candidateType==="relay",i=n.candidateType==="relay";n.candidateType!=="unknown"&&r===i||this.emit(Xe.ConnectionTypeChange,r),w.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(xd(n))," -> ").concat(JSON.stringify(xd(t)),")"))},e.onSelectedRemoteCandidateChanged=(t,n)=>{w.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(xd(n))," -> ").concat(JSON.stringify(xd(t)),")"))},e.onFirstVideoDecodedTimeout=t=>{this.reportVideoFirstFrameDecoded(t,void 0,void 0,!0)},e.onLocalCandidate=t=>{this.emit(Xe.LocalCandidate,{candidate:t,direction:e.direction})}}unbindConnectionEvents(e){e.onConnectionStateChange=void 0,e.onICEConnectionStateChange=void 0,e.onICETransportStateChange=void 0,e.onDTLSTransportStateChange=void 0,e.onDTLSTransportError=void 0,e.onFirstAudioDecoded=void 0,e.onFirstAudioReceived=void 0,e.onFirstVideoDecoded=void 0,e.onFirstVideoReceived=void 0,e.onSelectedLocalCandidateChanged=void 0,e.onSelectedRemoteCandidateChanged=void 0,e.onFirstVideoDecodedTimeout=void 0,e.onLocalCandidate=void 0}async handleDisconnect(e){const t=e===Ai.SEND_ONLY?this.sendConnection:this.recvConnection;t&&!t.isInRestartIce&&(t.isInRestartIce=!0,w.debug("[".concat(this.store.clientId,"] [P2PChannel-").concat(t.name,"] start use restartICE")),e===Ai.SEND_ONLY?this.restartICE(e):Gr(this,Xe.RequestP2PRestartICE,{direction:Ai.SEND_ONLY}))}filterTobeMutedTracks(e){const t=[];if(this.getAllTracks().indexOf(e)===-1)return t;const n=this.localTrackMap.get(ve.LocalAudioTrack);if(e instanceof Wn&&n?.track instanceof cr)return n.track.isActive||t.push([ve.LocalAudioTrack,n]),t;const r=Array.from(this.localTrackMap.entries()).find((i=>{let[,{track:s}]=i;return e===s}));if(r&&(t.push(r),r[0]===ve.LocalVideoTrack)){const i=this.localTrackMap.get(ve.LocalVideoLowTrack);i&&t.push([ve.LocalVideoLowTrack,i])}return t}filterTobeUnmutedTracks(e){const t=[],n=this.localTrackMap.get(ve.LocalAudioTrack);if(e instanceof Wn&&n?.track instanceof cr)return n.track.isActive&&t.push([ve.LocalAudioTrack,n]),t;const r=Array.from(this.localTrackMap.entries()).find((i=>{let[,{track:s}]=i;return e===s}));if(r)if(r[0]===ve.LocalVideoTrack){t.push(r);const i=this.localTrackMap.get(ve.LocalVideoLowTrack);i&&t.push([ve.LocalVideoLowTrack,i])}else t.push(r);return t}createMuteMessage(e){return e.map((t=>{var n;let r,[i,{track:s,ssrcs:o,id:c}]=t;switch(i){case ve.LocalAudioTrack:r=tn.Audio;break;case ve.LocalVideoTrack:r=be(n=s._hints).call(n,ln.SCREEN_TRACK)?tn.Screen:tn.High;break;case ve.LocalVideoLowTrack:r=tn.Low}return{stream_type:r,ssrcs:o,mid:c}}))}createUnmuteMessage(e){return e.map((t=>{var n;let r,[i,{track:s,ssrcs:o,id:c}]=t;switch(i){case ve.LocalAudioTrack:r=tn.Audio;break;case ve.LocalVideoTrack:r=be(n=s._hints).call(n,ln.SCREEN_TRACK)?tn.Screen:tn.High;break;case ve.LocalVideoLowTrack:r=tn.Low}return{stream_type:r,ssrcs:o,mid:c}}))}filterTobeUnSubscribedTracks(e,t){const n=[],r=this.remoteUserMap.get(e);if(!r)return n;if(t){const i=r.get(t);if(!i)return n;n.push([e,{kind:t,id:i}])}else Array.from(r.entries()).forEach((i=>{let[s,o]=i;n.push([e,{kind:s,id:o}])}));return n}createUnsubscribeMessage(e){const t=[];return e.forEach((n=>{let[r,{kind:i,id:s}]=n;switch(i){case Me.VIDEO:return void(r._videoSSRC&&t.push({stream_type:Me.VIDEO,ssrcId:r._videoSSRC}));case Me.AUDIO:return void(r._audioSSRC&&t.push({stream_type:Me.AUDIO,ssrcId:r._audioSSRC}))}})),t}withdrawRemoteTracks(e){e.forEach((t=>{let[n,{kind:r}]=t;const i=this.remoteUserMap.get(n);i&&(i.delete(r),Array.from(i.entries()).length===0&&this.remoteUserMap.delete(n))}))}async updateBitrateLimit(e){const t=this.localTrackMap.get(ve.LocalVideoTrack),n=this.localTrackMap.get(ve.LocalVideoLowTrack);t&&(await t.track.setBitrateLimit(e.uplink),await new ke(((r,i)=>{this.handleUpdateVideoEncoder(t.track,r,i,!0)}))),n&&e.low_stream_uplink&&(await n.track.setBitrateLimit({max_bitrate:e.low_stream_uplink.bitrate,min_bitrate:e.low_stream_uplink.bitrate||0}),await new ke(((r,i)=>{this.handleUpdateVideoEncoder(n.track,r,i,!0)})))}isP2PDisconnected(){if(this.sendConnection&&this.recvConnection){const e=this.sendConnection.peerConnectionState,t=this.recvConnection.peerConnectionState;return e!=="connected"&&t!=="connected"}return!0}async tryToUnmuteAudio(e){for(let t=0;t<e.length;t++)if(e[t]instanceof Wn){const n=this.filterTobeUnmutedTracks(e[t]);if(n.length===0)continue;const r=this.createUnmuteMessage(n);return void await un(this,Xe.RequestUnmuteLocal,r)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=e=>this.getStats(e),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()).filter((e=>{let[,{ssrcs:t}]=e;return!!t})),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=e=>{var t;return!((t=this.recvConnection)===null||t===void 0||!t.getRemoteVideoIsReady(e))},this.statsUploader.requestUpload=(e,t)=>this.emit(Xe.RequestUpload,e,t),this.statsUploader.requestUploadStats=e=>this.emit(Xe.RequestUploadStats,e),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await xr(pb(this.dtlsFailedCount,rr)),this.emit(Xe.RequestReconnect)}async reconnectP2P(){}canPublishLowStream(){return this.localTrackMap.has(ve.LocalVideoTrack)||this.pendingLocalTracks.some((e=>e instanceof Sn))}throwIfTrackTypeNotMatch(e){if(e.filter((t=>t instanceof Sn)).length>1)throw new de(V.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e.filter((t=>t instanceof Wn)).length>1&&(e.some((t=>t instanceof Wn&&t._bypassWebAudio))||!Bt().webAudioMediaStreamDest))throw new de(V.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const t of e){if(t instanceof Sn&&this.pendingLocalTracks.some((n=>n instanceof Sn)))throw new de(V.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t instanceof Wn&&this.pendingLocalTracks.some((n=>n instanceof Wn))&&(!Bt().webAudioMediaStreamDest||t._bypassWebAudio||this.pendingLocalTracks.some((n=>n instanceof Wn&&n._bypassWebAudio))))throw new de(V.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(e,t){const n=!B("DISABLE_DUAL_STREAM_USE_ENCODING")&&Bt().supportDualStreamEncoding,r=aR(aR({},{width:160,height:120,framerate:15,bitrate:50}),t);let i;i=n?e._mediaStreamTrack.clone():NI(e,r);const s=hn(8,"track-low-"),o=new Sn(i,aR(aR({},n&&{scaleResolutionDownBy:lI(r,e)}),{},{frameRate:r.framerate,bitrateMax:r.bitrate,bitrateMin:r.bitrate}),void 0,void 0,s);return o.on(Ch.TRANSCEIVER_UPDATED,(c=>{e._updateRtpTransceiver(c,Wf.LOW_STREAM)})),o._hints.push(ln.LOW_STREAM),e.addListener(Ve.NEED_CLOSE,(()=>{o.close()})),o}async globalLock(){return this.recvMutex.lock("From P2PChannel2.globalLock")}reportVideoFirstFrameDecoded(e,t,n,r){var i;const s=Array.from(es(i=this.remoteUserMap).call(i)).find((o=>o._videoSSRC===e));if(s){r||this.store.subscribe(s.uid,"video",void 0,void 0,void 0,void 0,Date.now());const o=this.store.keyMetrics,c=o.subscribe.find((d=>d.userId===s.uid&&d.type==="video"));We.firstRemoteVideoDecode(this.store.sessionId,fr.FIRST_VIDEO_DECODE,In.FIRST_VIDEO_DECODE,{peer:s._uintid,videowidth:t,videoheight:n,subscribeElapse:ei.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId,apEnd:o.requestAPEnd||0,apStart:o.requestAPStart||0,joinGwEnd:o.joinGatewayEnd||0,joinGwStart:o.joinGatewayStart||0,pcEnd:o.peerConnectionEnd||0,pcStart:o.peerConnectionStart||0,subscriberEnd:c?.subscribeEnd||0,subscriberStart:c?.subscribeStart||0,videoAddNotify:c?.streamAdded||0,state:r?1:0})}}async remoteMediaSsrcChanged(e,t,n){if(!this.recvConnection)return!1;const r=this.remoteUserMap.get(e);if(!r)return!1;const i=r.get(t);if(!i)return!1;const s=await this.recvConnection.getRemoteSSRC(i);return s!==void 0&&s!==n}isPreSubScribe(e){return!1}async publishDataChannel(e){throw new de(V.NOT_SUPPORTED)}async unpublishDataChannel(e){throw new de(V.NOT_SUPPORTED)}async subscribeDataChannel(e,t){throw new de(V.NOT_SUPPORTED)}async unsubscribeDataChannel(e,t){throw new de(V.NOT_SUPPORTED)}hasPendingRemoteDataChannel(e,t){throw new de(V.NOT_SUPPORTED)}setPendingRemoteDataChannel(e,t){throw new de(V.NOT_SUPPORTED)}async preConnect(e){throw new de(V.NOT_SUPPORTED)}getEstablishParams(){throw new de(V.NOT_SUPPORTED)}async reSubscribe(e){throw new de(V.NOT_SUPPORTED)}reportVideoFirstFrameRender(e){}async updateVideoStreamParameter(e,t){throw new de(V.NOT_SUPPORTED)}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach((e=>{let[t,{track:n}]=e;t===ve.LocalVideoLowTrack?n._updateRtpTransceiver(void 0,Wf.LOW_STREAM):n._updateRtpTransceiver(void 0)}))}},Be(Pn.prototype,"p2pConnect",[CV],Object.getOwnPropertyDescriptor(Pn.prototype,"p2pConnect"),Pn.prototype),Be(Pn.prototype,"unpublish",[bV],Object.getOwnPropertyDescriptor(Pn.prototype,"unpublish"),Pn.prototype),Be(Pn.prototype,"unpublishLowStream",[IV],Object.getOwnPropertyDescriptor(Pn.prototype,"unpublishLowStream"),Pn.prototype),Be(Pn.prototype,"subscribe",[AV],Object.getOwnPropertyDescriptor(Pn.prototype,"subscribe"),Pn.prototype),Be(Pn.prototype,"mockSubscribe",[NV],Object.getOwnPropertyDescriptor(Pn.prototype,"mockSubscribe"),Pn.prototype),Be(Pn.prototype,"unsubscribe",[OV],Object.getOwnPropertyDescriptor(Pn.prototype,"unsubscribe"),Pn.prototype),Be(Pn.prototype,"muteRemote",[PV],Object.getOwnPropertyDescriptor(Pn.prototype,"muteRemote"),Pn.prototype),Be(Pn.prototype,"unmuteRemote",[DV],Object.getOwnPropertyDescriptor(Pn.prototype,"unmuteRemote"),Pn.prototype),Be(Pn.prototype,"hasRemoteMediaWithLock",[kV],Object.getOwnPropertyDescriptor(Pn.prototype,"hasRemoteMediaWithLock"),Pn.prototype),Be(Pn.prototype,"disconnectForReconnect",[xV],Object.getOwnPropertyDescriptor(Pn.prototype,"disconnectForReconnect"),Pn.prototype),Be(Pn.prototype,"remoteMediaSsrcChanged",[LV],Object.getOwnPropertyDescriptor(Pn.prototype,"remoteMediaSsrcChanged"),Pn.prototype),Pn);function xa(e){return function(t,n,r){const i=t[n];if(typeof i!="function")throw new Error("Cannot use mutex on object property.");return r.value=async function(){for(var s=arguments.length,o=new Array(s),c=0;c<s;c++)o[c]=arguments[c];switch(e){case ka.SEND_ONLY:{const d=await this.sendMutex.lock("From P2PChannel2.".concat(n));try{return await i.apply(this,o)}finally{d()}}case ka.RECEIVE_ONLY:{const d=await this.recvMutex.lock("From P2PChannel2.".concat(n));try{return await i.apply(this,o)}finally{d()}}default:{const d=await this.sendMutex.lock("From P2PChannel2.".concat(n)),h=await this.recvMutex.lock("From P2PChannel2.".concat(n));try{return await i.apply(this,o)}finally{d(),h()}}}},r}}class Gh extends xn{constructor(t,n){super(),x(this,"signal",void 0),x(this,"token",void 0),x(this,"tokenTimeout",void 0),x(this,"tokenInterval",void 0),x(this,"_sequence",0),x(this,"userMap",new Map),x(this,"encoder",new TextEncoder),this.signal=t,this.token=n;const r=()=>{this.signal.connectionState===vn.CONNECTED&&this.check(),this.userMap.size===0?this.tokenInterval=window.setTimeout(r,1e3):this.tokenInterval=window.setTimeout(r,3*B("P2P_TOKEN_INTERVAL"))};r()}async send(t,n,r,i,s){var o;if(this.userMap.size===0)return;const c=Array.from(fs(o=this.userMap).call(o))[0].token;typeof n!="string"&&(n=JSON.stringify(n)),i=i??hn(6,""),s=s??this._sequence++;const d={_id:i,_type:t,_seq:s,_message:n,token:"".concat(this.token,"_").concat(c)};B("SHOW_P2P_LOG")&&w.debug("send message",d,"noNeedResponse : ".concat(r)),this.splitMessage(JSON.stringify(d)).forEach((f=>{this.signal.request(ot.DATA_STREAM,{payload:Ad(this.encoder.encode(f))})}));const h=new ke(((f,g)=>{const E=window.setTimeout((()=>{this.off("res-@".concat(i,"_ack"),S),this.off("res-@".concat(i),A),this.off(em.ABORT,O),w.debug("[external-signal] request timeout, type: ".concat(t,", requestId: ").concat(i)),this.userMap.size===0?g(new de(V.INVALID_REMOTE_USER)):g(new de(V.TIMEOUT))}),B("EXTERNAL_SIGNAL_REQUEST_TIMEOUT")),S=()=>{E&&window.clearTimeout(E),this.off(em.ABORT,O),r&&f()},O=()=>{E&&window.clearTimeout(E),this.off("res-@".concat(i,"_ack"),S),this.off("res-@".concat(i),A),g(new de(V.EXTERNAL_SIGNAL_ABORT,"type: ".concat(t,", requestId: ").concat(i)))};this.once(em.ABORT,O),this.once("res-@".concat(i,"_ack"),S);const A=(j,U)=>{N=!0,E&&window.clearTimeout(E),this.off("res-@".concat(i,"_ack"),S),this.off(em.ABORT,O),j==="success"?f(U):g(new de(V.P2P_MESSAGE_FAILED,"request ".concat(t," failed, requestId: ").concat(i)))};let N=!1;r||(this.once("res-@".concat(i),A),xr(B("SIGNAL_REQUEST_TIMEOUT")).then((()=>{N||w.warning("external_signal request timeout, type: ".concat(t,", requestId: ").concat(i,", ").concat(d))})))}));try{return await h}catch(f){if(f.code===V.TIMEOUT)return await this.send(t,n,r,i,s);throw f}}onMessage(t){var n;const{_uid:r}=t;let i,s=this.userMap.get(r);if(s)i=s.splitMessageMap;else{if(this.userMap.size>0||!("_type"in t)||t._type!==Kn.CHECK)return;const{token:h}=t;i=new Map,s={uid:r,isStart:!0,token:h,splitMessageMap:i,nextExpectedSequenceNumber:0,receivedMessagesMap:new Map},this.userMap.set(r,s),this.signal.emit(Dt.ON_USER_ONLINE,{uid:r}),this.handleUserOnline()}if("id"in t&&"total"in t){var o;const{id:h,total:f}=t,g=(o=i.get(h))!==null&&o!==void 0?o:[];if(g.push(t),i.has(h)||i.set(h,g),g.length!==f)return;{const E=hh(g).call(g,((S,O)=>S.index-O.index)).map((S=>S.payload)).join("");i.delete(h),(t=JSON.parse(E))._uid=r}}const{_type:c,token:d}=t;if(be(n=[Kn.ACK,Kn.CHECK]).call(n,c))return c===Kn.CHECK&&this.handleCheckToken(s,d),void this.receiveMessage(t);d==="".concat(s.token,"_").concat(this.token)?this.handleReceivedMessage(t):w.debug('Receive unexpected message", '.concat(d,", cur_token: ").concat(s.token,"_").concat(this.token),t)}check(){const t={_id:hn(6,""),token:this.token,_type:Kn.CHECK};B("SHOW_P2P_LOG")&&w.debug("send message",t),this.signal.request(ot.DATA_STREAM,{payload:Ad(this.encoder.encode(JSON.stringify(t)))})}ack(t){const n={_id:t,_type:Kn.ACK,token:this.token};B("SHOW_P2P_LOG")&&w.debug("send message",n),this.signal.request(ot.DATA_STREAM,{payload:Ad(this.encoder.encode(JSON.stringify(n)))})}response(t,n,r){this.send(Kn.RESPONSE,JSON.stringify({success:!r,message:n}),!0,t)}handleReceivedMessage(t){const n=()=>{this.userMap.forEach((h=>{const{receivedMessagesMap:f,nextExpectedSequenceNumber:g}=h;for(;f.has(g);){const E=f.get(g);f.delete(g),this.receiveMessage(E),h.nextExpectedSequenceNumber++}}))};if(!t)return void n();const{_uid:r,_seq:i}=t,s=this.userMap.get(r),{receivedMessagesMap:o,isStart:c,nextExpectedSequenceNumber:d}=s;if(i<d)return this.ack(t._id),void w.debug("[external-signal] receive old message, seq: ".concat(i,", ").concat(t._message));o.set(i,t),c&&i===d&&(this.receiveMessage(t),o.delete(d),s.nextExpectedSequenceNumber++,n())}receiveMessage(t){const{_id:n,_type:r,_message:i,_uid:s}=t;if(B("SHOW_P2P_LOG")&&w.debug("receive message",t),n){let o;switch(t._type!==Kn.ACK&&(i&&(o=JSON.parse(i)),this.ack(t._id)),t._type){case Kn.CANDIDATE:case Kn.CONTROL:this.signal.emit(r,o,s);break;case Kn.PUBLISH:case Kn.UNPUBLISH:case Kn.RESTART_ICE:case Kn.CALL:o.uid=s,Gr(this.signal,r,o).then((c=>{this.response(t._id,c)})).catch((()=>{this.response(t._id,void 0,!0)}));break;case Kn.ACK:this.getListeners("res-@".concat(n,"_ack")).length>0&&this.emit("res-@".concat(n,"_ack"));break;case Kn.RESPONSE:{const{success:c,message:d}=o;this.emit("res-@".concat(n),c?"success":"failed",d);break}}}}splitMessage(t){if(t.length<Gh.MAX_MESSAGE_SIZE)return[t];const n=[],{remoteToken:r}=JSON.parse(t),i=hn(6,"");let s=0,o=800;const c=Math.ceil(t.length/o);for(;t.length>0;){s++;const d={id:i,index:s,total:c,payload:t.slice(0,o),token:"".concat(this.token,"_").concat(r)};JSON.stringify(d).length>Gh.MAX_MESSAGE_SIZE?o-=50:(n.push(d),t=t.slice(o))}return n.map((d=>JSON.stringify(d)))}handleCheckToken(t,n){return t.token!==n?(w.debug("token changed, from ".concat(t.token," to ").concat(n)),this.reset(t.uid,n),!1):(this.tokenTimeout&&(window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0),this.tokenTimeout=window.setTimeout((()=>{w.debug("token timeout, ".concat(n)),this.reset(t.uid)}),B("MAX_P2P_TIMEOUT")),!0)}async handleUserOnline(){const t=await Gr(this.signal,Kn.CALL,void 0),n=await this.send(Kn.CALL,t);this.signal.emit(ct.P2P_CONNECTION,n,!0)}async reset(t,n){const r=this.userMap.get(t);r&&(this.emit(em.ABORT),this.signal.emit(Dt.ON_USER_OFFLINE,{uid:r.uid,reason:r7.P2P_TOKEN_CHANGED}),this._sequence=0,this.userMap.clear(),n||(w.debug("change local token from ".concat(n," to ").concat(n)),this.token=hn(6,"")))}clear(){this._sequence=0,this.userMap.clear(),this.tokenInterval&&window.clearTimeout(this.tokenInterval),this.tokenInterval=void 0,this.tokenTimeout&&window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0,this.emit(em.ABORT)}}x(Gh,"MAX_SIZE",1),x(Gh,"MAX_MESSAGE_SIZE",1024);class jX extends xn{get connectionState(){return this._connectionState}set connectionState(t){t!==this._connectionState&&(this._connectionState=t,t===vn.CONNECTED?this.emit(ct.WS_CONNECTED):t===vn.RECONNECTING?this.emit(ct.WS_RECONNECTING,this._websocketReconnectReason):t===vn.CLOSED&&this.emit(ct.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(t,n){super(),x(this,"_disconnectedReason",void 0),x(this,"_websocketReconnectReason",void 0),x(this,"_connectionState",vn.CLOSED),x(this,"reconnectToken",void 0),x(this,"p2pToken",void 0),x(this,"websocket",void 0),x(this,"openConnectionTime",void 0),x(this,"clientId",void 0),x(this,"lastMsgTime",Date.now()),x(this,"uploadCache",[]),x(this,"uploadCacheInterval",void 0),x(this,"rttRolling",new u1(5)),x(this,"pingpongTimer",void 0),x(this,"pingpongTimeoutCount",0),x(this,"joinResponse",void 0),x(this,"multiIpOption",void 0),x(this,"initError",void 0),x(this,"spec",void 0),x(this,"store",void 0),x(this,"_external_signal",void 0),x(this,"onWebsocketMessage",(r=>{if(r.data instanceof ArrayBuffer)return void this.emit(ct.ON_BINARY_DATA,r.data);const i=JSON.parse(r.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(i,"_id")){const s="res-@".concat(i._id);this.emit(s,i._result,i._message)}else if(Object.prototype.hasOwnProperty.call(i,"_type")){switch(i._type){case Dt.ON_DATA_STREAM:return void this.handleDataStream(i._message);case Dt.MUTE_AUDIO:case Dt.MUTE_VIDEO:case Dt.ON_P2P_LOST:case Dt.ON_USER_ONLINE:return;case Dt.ON_USER_OFFLINE:const{uid:s}=i._message;return w.debug("[".concat(this.clientId,"] user-offline uid: ").concat(s)),void this._external_signal.reset(s)}if(this.emit(i._type,i._message),i._type===Dt.ON_NOTIFICATION&&this.handleNotification(i._message),i._type===Dt.ON_USER_BANNED)switch(i._message.error_code){case 14:this.close($t.UID_BANNED);break;case 15:this.close($t.IP_BANNED);break;case 16:this.close($t.CHANNEL_BANNED)}if(i._type===Dt.ON_USER_LICENSE_BANNED)switch(i._message.error_code){case Ze.ERR_LICENSE_MISSING:this.close($t.LICENSE_MISSING);break;case Ze.ERR_LICENSE_EXPIRED:this.close($t.LICENSE_EXPIRED);break;case Ze.ERR_LICENSE_MINUTES_EXCEEDED:this.close($t.LICENSE_MINUTES_EXCEEDED);break;case Ze.ERR_LICENSE_PERIOD_INVALID:this.close($t.LICENSE_PERIOD_INVALID);break;case Ze.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close($t.LICENSE_MULTIPLE_SDK_SERVICE);break;case Ze.ERR_LICENSE_ILLEGAL:this.close($t.LICENSE_ILLEGAL);break;default:this.close()}}})),this.clientId=t.clientId,this.spec=t,this.store=n,this.websocket=new aI("gateway-".concat(this.clientId),this.spec.retryConfig,!0,B("JOIN_GATEWAY_USE_DUAL_DOMAIN"),B("JOIN_GATEWAY_USE_443PORT_ONLY"),n),this.handleWebsocketEvents(),window.addEventListener("offline",(()=>{this.connectionState===vn.CONNECTED&&this.reconnect("retry",Wr.OFFLINE)})),this.p2pToken=hn(6,""),this._external_signal=new Gh(this,this.p2pToken)}async request(t,n,r,i){const s=hn(6,""),o={_id:s,_type:t,_message:n},c=this.websocket.connectionID,d=()=>new ke(((O,A)=>{if(this.connectionState===vn.CONNECTED)return O();const N=()=>{this.off(ct.WS_CLOSED,j),O()},j=()=>{this.off(ct.WS_CONNECTED,N),A(new de(V.WS_ABORT))};this.once(ct.WS_CONNECTED,N),this.once(ct.WS_CLOSED,j)}));if(this.connectionState!==vn.CONNECTING&&this.connectionState!==vn.RECONNECTING||t===ot.JOIN||t===ot.REJOIN||await d(),this.websocket.sendMessage(o,!0),i)return;const h=new ke(((O,A)=>{let N=!1;const j=(W,$)=>{N=!0,O({isSuccess:W==="success",message:$||{}}),this.off(ct.WS_CLOSED,U),this.off(ct.WS_RECONNECTING,U),this.emit(ct.REQUEST_SUCCESS,t,n)};this.once("res-@".concat(s),j);const U=()=>{A(new de(V.WS_ABORT,"type: ".concat(t))),this.off(ct.WS_CLOSED,U),this.off(ct.WS_RECONNECTING,U),this.off("res-@".concat(s),j)};this.once(ct.WS_CLOSED,U),this.once(ct.WS_RECONNECTING,U),xr(B("SIGNAL_REQUEST_TIMEOUT")).then((()=>{this.websocket.connectionID!==c||N||(w.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(t)),this.emit(ct.REQUEST_TIMEOUT,t,n))}))}));let f=null;try{f=await h}catch(O){if(this.connectionState===vn.CLOSED||t===ot.LEAVE)throw new de(V.WS_ABORT);return!this.spec.forceWaitGatewayResponse||r?O.throw():t===ot.JOIN||t===ot.REJOIN?null:(await d(),await this.request(t,n))}if(f.isSuccess)return f.message;const g=Number(f.message.error_code||f.message.code),E=aE(g),S=new de(V.UNEXPECTED_RESPONSE,"".concat(E.desc,": ").concat(f.message.error_str),{code:g,data:f.message,desc:E.desc});return E.action==="success"?f.message:(w.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(t,", error_code: ").concat(g,", message: ").concat(E.desc,", action: ").concat(E.action)),g===Ze.ERR_TOO_MANY_BROADCASTERS?((t===ot.JOIN||t===ot.REJOIN)&&(this.initError=S,this.close()),S.throw()):E.action==="failed"?S.throw():E.action==="quit"?(this.initError=S,this.close(),S.throw()):(g===Ze.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=f.message.option,w.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",Wr.MULTI_IP)):this.reconnect(E.action,Wr.SERVER_ERROR),t===ot.JOIN||t===ot.REJOIN?null:await this.request(t,n)))}waitMessage(t,n){return new ke((r=>{const i=s=>{(!n||n(s))&&(this.off(t,i),r(s))};this.on(t,i)}))}uploadWRTCStats(t){if(!this.store.sessionId)return void w.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const n={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:t};this.upload(sE.WRTC_STATS,n)}upload(t,n){const r={_type:t,_message:n};try{this.websocket.sendMessage(r)}catch{const s=B("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(r),this.uploadCache.length>s&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval((()=>{if(this.connectionState!==vn.CONNECTED)return;const o=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(o._type,o._message)}),B("UPLOAD_CACHE_INTERVAL")||2e3))}}send(t,n){const r={_type:t,_message:n};this.websocket.sendMessage(r)}async sendExtensionMessage(t,n,r){return await this._external_signal.send(t,n,r)}init(t){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new ke(((n,r)=>{this.once(ct.WS_CONNECTED,(()=>n(this.joinResponse))),this.once(ct.WS_CLOSED,(()=>r(this.initError||new de(V.WS_ABORT)))),this.connectionState=vn.CONNECTING,this.websocket.init(t).catch(r)}))}close(t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._external_signal.clear(),this._disconnectedReason=t||$t.LEAVE,this.connectionState=vn.CLOSED,w.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),this.p2pToken=hn(6,""),this._external_signal.clear(),this._external_signal=new Gh(this,this.p2pToken)}async join(){if(!this.joinResponse){this.emit(ct.ABORT_P2P_EXECUTION);const t=await Gr(this,ct.REQUEST_JOIN_INFO),n=await this.request(ot.JOIN,t);if(!n)return this.emit(ct.REPORT_JOIN_GATEWAY,V.TIMEOUT,this.url||""),!1;this.joinResponse=n,this.emit(ct.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=vn.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}reconnect(t,n){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(t,n)}async downgradeCodec(t){return!1}handleDataStream(t){try{var n;const r=Th(t.payload),i=new TextDecoder().decode(r),s=JSON.parse(i);"total"in s&&"id"in s||be(n=Object.values(Kn)).call(n,s._type)?(s._uid=t.uid,this._external_signal.onMessage(s)):this.emit(Dt.ON_DATA_STREAM,t)}catch{this.emit(Dt.ON_DATA_STREAM,t)}}handleNotification(t){w.debug("[".concat(this.clientId,"] receive notification: "),t);const n=aE(t.code);if(n.action!=="success"){if(n.action!=="failed")return n.action==="quit"?(n.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close($t.UID_BANNED),void this.close()):void this.reconnect(n.action,Wr.SERVER_ERROR);w.error("[".concat(this.clientId,"] ignore error: "),n.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const t=B("PING_PONG_TIME_OUT"),n=Date.now();this.pingpongTimeoutCount>=t&&(w.warning("[".concat(this.clientId,"] PINGPONG Timeout. Last Socket Message: ").concat(n-this.lastMsgTime,"ms")),n-this.lastMsgTime>B("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",Wr.TIMEOUT):this.request(ot.PING,void 0,!0).then((()=>{this.pingpongTimeoutCount=0;const r=Date.now()-n;this.rttRolling.add(r),B("REPORT_STATS")&&this.send(ot.PING_BACK,{pingpongElapse:r})})).catch((r=>{}))}handleWebsocketEvents(){this.websocket.on(Et.RECONNECT_CREATE_CONNECTION,(t=>{this.emit(ct.WS_RECONNECT_CREATE_CONNECTION,t)})),this.websocket.on(Et.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(Et.CLOSED,(()=>{this.connectionState=vn.CLOSED})),this.websocket.on(Et.FAILED,(()=>{this._disconnectedReason=$t.NETWORK_ERROR,this.connectionState=vn.CLOSED})),this.websocket.on(Et.RECONNECTING,(t=>{this._websocketReconnectReason=t,this.joinResponse=void 0,this.connectionState===vn.CONNECTED?this.connectionState=vn.RECONNECTING:this.connectionState=vn.CONNECTING})),this.websocket.on(Et.WILL_RECONNECT,((t,n,r)=>{t!=="retry"?(w.debug("".concat(this.clientId," websocket will_connect event, renewSession reconnectMode is ").concat(t)),this.reconnectToken=void 0):w.debug("".concat(this.clientId," reconnect mode is retry, no need to renew session")),r(t)})),this.websocket.on(Et.CONNECTED,(()=>{this.openConnectionTime=Date.now(),this.join().catch((t=>{if(this.emit(ct.REPORT_JOIN_GATEWAY,t,this.url||""),t instanceof de&&t.code===V.UNEXPECTED_RESPONSE&&t.data.code===Ze.ERR_NO_AUTHORIZED)return w.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",Wr.SERVER_ERROR);w.error("[".concat(this.clientId,"] join gateway request failed"),t.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",Wr.SERVER_ERROR):(this.initError=t,this.close())}))})),this.websocket.on(Et.REQUEST_NEW_URLS,((t,n)=>{Gr(this,ct.REQUEST_RECOVER,this.multiIpOption).then(t).catch(n)})),this.websocket.on(Et.ON_TOKEN_PRIVILEGE_DID_EXPIRE,(()=>{this.emit(Dt.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}))}}const VX={name:"P2PChannel",create:function(e){let{store:t,statsCollector:n}=e;return new UX(t,n)},createSubmodule:function(e){let{store:t,spec:n}=e;return new jX(n,t)}};function UV(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable}))),n.push.apply(n,r)}return n}function jV(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?UV(Object(n),!0).forEach((function(r){x(e,r,n[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):UV(Object(n)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))}))}return e}class FX{constructor(t){x(this,"sessionDesc",void 0),x(this,"localCapabilities",void 0),x(this,"rtpCapabilities",void 0),x(this,"candidates",void 0),x(this,"_originCandidates",void 0),x(this,"iceParameters",void 0),x(this,"dtlsParameters",void 0),x(this,"setup",void 0),x(this,"currentMidIndex",void 0),x(this,"cname",void 0),t=On(t);const{iceParameters:n,dtlsParameters:r,candidates:i,rtpCapabilities:s,setup:o,localCapabilities:c,sdkCodec:d,cname:h}=t,f=$i(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE audio video
a=msid-semantic: WMS
a=ice-lite
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:audio
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:video
`);this.rtpCapabilities=s,this.candidates=i,this._originCandidates=On(i),this.iceParameters=n,this.dtlsParameters=r,this.setup=o,this.localCapabilities=c,this.cname=h;for(let g=0;g<f.mediaDescriptions.length;g++){const E=f.mediaDescriptions[g];if(E.attributes.iceUfrag=n.iceUfrag,E.attributes.icePwd=n.icePwd,E.attributes.fingerprints=r.fingerprints,E.attributes.candidates=i,E.attributes.setup=o,E.media.mediaType==="video"){E.media.fmts=s.videoCodecs.map((A=>A.payloadType.toString(10)));const S=s.videoCodecs.filter((A=>{var N,j;return(N=A.rtpMap)===null||N===void 0?void 0:be(j=N.encodingName.toLowerCase()).call(j,d)})),O=s.videoCodecs.filter((A=>!be(S).call(S,A)));E.attributes.payloads=[...S,...O],E.attributes.extmaps=s.videoExtensions}E.media.mediaType==="audio"&&(E.media.fmts=s.audioCodecs.map((S=>S.payloadType.toString(10))),E.attributes.payloads=s.audioCodecs,E.attributes.extmaps=s.audioExtensions),f.mediaDescriptions[g]=this.mungMediaDesc(E)}this.sessionDesc=f,this.currentMidIndex=f.mediaDescriptions.length-1}toString(){return Nd(this.sessionDesc)}send(t,n,r){const{ssrcs:i,ssrcGroups:s}=uE(n,this.cname),o=this.sessionDesc.mediaDescriptions.find((h=>t===Me.VIDEO?h.media.mediaType==="video":h.media.mediaType==="audio")),c=i[0].attributes.label,d=i[0].attributes.mslabel;return o.attributes.ssrcs=o.attributes.ssrcs.concat(i),o.attributes.ssrcGroups=o.attributes.ssrcGroups.concat(s),{id:c,mslabel:d}}batchSend(t){return t.map((n=>{let{kind:r,ssrcMsg:i}=n;return this.send(r,i,void 0)}))}stopSending(t){this.sessionDesc.mediaDescriptions.forEach((n=>{const r=[],i=[],s=[];n.attributes.ssrcs.forEach((o=>{be(t).call(t,o.attributes.label||"")?s.push(o):r.push(o)})),n.attributes.ssrcGroups.forEach((o=>{var c;be(c=s.map((d=>d.ssrcId))).call(c,o.ssrcIds[0])||i.push(o)})),n.attributes.ssrcs=r,n.attributes.ssrcGroups=i}))}mute(t){const n=this.sessionDesc.mediaDescriptions.find((r=>r.attributes.mid===t));if(!n)throw new Error("mediaDescription not found with ".concat(t," in remote SDP when calling RemoteSDP.mute."));n.attributes.direction="inactive"}unmute(t){const n=this.sessionDesc.mediaDescriptions.find((r=>r.attributes.mid===t));if(!n)throw new Error("mediaDescription not found with ".concat(t," in remote SDP when calling RemoteSDP.unmute."));n.attributes.direction="sendonly"}receive(t,n,r){t.forEach(((i,s)=>{const o=i._mediaStreamTrack,c=this.sessionDesc.mediaDescriptions.findIndex((h=>h.attributes.mid===o.kind)),d=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[c],i);this.sessionDesc.mediaDescriptions[c]=d}))}stopReceiving(t){}updateCandidates(t){const n=this._originCandidates.filter((i=>i.transport==="udp")),r=[];if(n.forEach((i=>{r.push(jV(jV({},i),{},{foundation:"tcpcandidate",priority:Number(i.priority)-1+"",transport:"tcp",port:Number(i.port)+90+""}))})),n.length!==0){switch(t){case $r.TCP_RELAY:this.candidates=r;break;case $r.UDP_TCP_RELAY:case $r.RELAY:this.candidates=[...n,...r];break;default:this.candidates=n}for(const i of this.sessionDesc.mediaDescriptions)i.attributes.candidates=this.candidates}}restartICE(t){t=On(t),this.iceParameters=t,this.sessionDesc.mediaDescriptions.forEach((n=>{n.attributes.iceUfrag=t.iceUfrag,n.attributes.icePwd=t.icePwd}))}predictReceivingMids(t){const n=[];for(let r=0;r<t;r++)n.push((this.currentMidIndex+r+1).toString(10));return n}mungRecvMediaDsec(t,n){const r=On(t);return rm(r,n),uI(r,n),r}updateRecvMedia(t,n){const r=this.sessionDesc.mediaDescriptions.findIndex((i=>i.attributes.mid===t));if(r!==-1){const i=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[r],n);this.sessionDesc.mediaDescriptions[r]=i}}bumpMid(t){this.currentMidIndex+=t}updateTrackLabel(t,n,r){const i=this.sessionDesc.mediaDescriptions.find((o=>t===Me.VIDEO?o.attributes.mid==="video":o.attributes.mid==="audio"));if(i){const o=i.attributes.ssrcs.find((c=>c.attributes.label===n));var s;o&&(o.attributes.label=r,(s=o.attributes.msid)===null||s===void 0||s.replace(n,r))}}mungMediaDesc(t){const n=On(t);return dI(n),(function(r){const i=r.attributes.extmaps.find((s=>TT(s.extensionName)));i&&r.attributes.extmaps.splice(r.attributes.extmaps.indexOf(i),1),r.attributes.payloads.forEach((s=>{const o=s.rtcpFeedbacks.findIndex((c=>c.type==="transport-cc"));o!==-1&&s.rtcpFeedbacks.splice(o,1)}))})(n),n}getSSRC(t){for(const n of this.sessionDesc.mediaDescriptions)for(const r of n.attributes.ssrcs)if(r.attributes.label===t)return[r]}}var pn;function VV(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable}))),n.push.apply(n,r)}return n}function cR(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?VV(Object(n),!0).forEach((function(r){x(e,r,n[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):VV(Object(n)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))}))}return e}let BX=(pn=class HE extends ZM{get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.videoCodecs.map((t=>t.rtpMap&&t.rtpMap.encodingName.toLowerCase()||"")).filter((t=>{var n;return be(n=Object.keys(eE)).call(n,t)})))]}constructor(t,n){super(t,n),x(this,"store",void 0),x(this,"peerConnection",void 0),x(this,"remoteSDP",void 0),x(this,"initialOffer",void 0),x(this,"statsFilter",void 0),x(this,"useRTX",!1),x(this,"localCapabilities",void 0),x(this,"localCandidateCount",0),x(this,"allCandidatesReceived",!1),x(this,"establishPromise",void 0),x(this,"mutex",void 0),this.store=n,this.mutex=new Jr("P2PConnection-mutex",n.clientId),this.peerConnection=new RTCPeerConnection(HE.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.statsFilter=vb(this.peerConnection,B("STATS_UPDATE_INTERVAL"),void 0,jn()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(){try{const t=await this.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});if(!t.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const n=Ld(t.sdp),r=dE(t.sdp,{filterRTX:!this.useRTX,filterVideoFec:B("FILTER_VIDEO_FEC"),filterAudioFec:B("FILTER_AUDIO_FEC"),filterAudioCodec:["opus"]});return this.localCapabilities=r,this.initialOffer=t,cR(cR({},n),{},{rtpCapabilities:{send:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},recv:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},sendrecv:r},offerSDP:t.sdp})}catch(t){throw new de(V.GET_LOCAL_CONNECTION_PARAMS_FAILED,t.toString())}}async updateRemoteConnect(){}async connect(t){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new FX(cR(cR({},t),{},{rtpCapabilities:t.rtpCapabilities.send,localCapabilities:this.localCapabilities,sdkCodec:this.store.codec}));const n=this.remoteSDP.toString();await this.peerConnection.setLocalDescription(this.initialOffer),await this.peerConnection.setRemoteDescription({type:"answer",sdp:n})}catch(n){throw new de(V.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(n.toString()))}}async updateRemoteRTPCapabilities(t,n){throw new de(V.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}getPreMedia(t){}send(t,n){var r=this;return no((function*(){const i=yield Ft(r.mutex.lock());try{if(!r.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const s=t.map((E=>r.peerConnection.addTrack(E._mediaStreamTrack))),o=yield Ft(r.peerConnection.createOffer()),c=$i(o.sdp),d=t.map((E=>{const S=E._mediaStreamTrack,O=c.mediaDescriptions.find((A=>A.attributes.mid===S.kind));if(!O)throw new Error("Cannot extract ssrc from mediaDescription.");return(function(A,N,j){const U=A.attributes.ssrcs.filter(($=>$.attributes.label===N)),W=A.attributes.ssrcGroups;if(U.length===0)throw new Error("Cannot extract ssrc from plan-b SDP.");if(W&&U.length>1){const $=W.find((Z=>Z.ssrcIds.indexOf(U[0].ssrcId)!==-1));return $?[{ssrcId:$.ssrcIds[0],rtx:j?$.ssrcIds[1]:void 0}]:[{ssrcId:U[0].ssrcId}]}return[{ssrcId:U[0].ssrcId}]})(O,S.id,r.useRTX)}));let h;try{h=yield d}catch(E){throw s.forEach((S=>{Br()&&S.replaceTrack(null),r.peerConnection.removeTrack(S)})),E}const f=r.mungSendOfferSDP(o.sdp,t);r.remoteSDP.receive(t,n,h);const g=r.remoteSDP.toString();return yield Ft(r.peerConnection.setLocalDescription({type:"offer",sdp:f})),yield Ft(r.applySendEncodings(s,t)),yield Ft(r.peerConnection.setRemoteDescription({type:"answer",sdp:g})),t.map(((E,S)=>{const O=E._mediaStreamTrack.id;return{localSSRC:d[S],id:O}}))}catch(s){throw new de(V.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(s.toString()))}finally{i()}}))()}async stopSending(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const n=this.peerConnection.getSenders().filter((s=>{var o;return t.indexOf(((o=s.track)===null||o===void 0?void 0:o.id)||"")!==-1}));if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");n.map((s=>{Br()&&s.replaceTrack(null),this.peerConnection.removeTrack(s)}));const r=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(r),this.remoteSDP.stopReceiving(t);const i=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:i})}catch(n){throw new de(V.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(n.toString()))}}async receive(t,n,r,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));const{id:s,mslabel:o}=this.remoteSDP.send(t,n,i),c=new ke(((f,g)=>{const E=setTimeout((()=>{g(new Error("Cannot receive track, id: ".concat(s)))}),1e4),S=O=>{const A=Mt();if((A.name==="Safari"&&Number(A.version)===11||ii())&&O.track.id!==s&&O.streams[0].id===o){var N;const j=O.streams[0].getTracks()[0];return(N=this.remoteSDP)===null||N===void 0||N.updateTrackLabel(t,s,O.track.id),this.peerConnection.removeEventListener("track",S),clearTimeout(E),void f(j)}if(O.track.id===s)return this.peerConnection.removeEventListener("track",S),clearTimeout(E),void f(O.track)};this.peerConnection.addEventListener("track",S)})),d=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:d});const h=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(h),{track:await c,id:s}}catch(s){throw new de(V.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(s.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(t);const n=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const r=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(r)}catch(n){throw new de(V.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n.toString()))}}async muteRemote(t){}async unmuteRemote(t){}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const n=this.peerConnection.getSenders().filter((r=>{var i;return t.indexOf(((i=r.track)===null||i===void 0?void 0:i.id)||"")!==-1}));if(n.length!==t.length)throw new Error("sender' length doesn't match mids' length.");n.map((r=>{if(Br()&&r.track)r.track.enabled=!1;else{const i=r.getParameters();i.encodings.forEach((s=>s.active=!1)),r.setParameters(i)}}))}catch(n){throw new de(V.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(n.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const n=this.peerConnection.getSenders().filter((s=>{var o;return t.indexOf(((o=s.track)===null||o===void 0?void 0:o.id)||"")!==-1}));if(n.length!==t.length)throw new Error("Senders' length doesn't match mids' length.");n.map((async s=>{if(Br()&&s.track)s.track.enabled=!0;else{const o=s.getParameters();o.encodings.forEach((c=>c.active=!0)),await s.setParameters(o)}}));const r=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(r);const i=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:i})}catch(n){throw new de(V.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(n.toString()))}}restartICE(t){var n=this;return no((function*(){const r=yield Ft(n.mutex.lock("From P2PConnection.restartICE"));try{if(!n.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const i=Bt().supportPCSetConfiguration;if(t===$r.RELAY&&!i)return;if(i){const h=n.peerConnection.getConfiguration(),f=t===$r.RELAY?"relay":"all";h.iceTransportPolicy!==f&&(w.debug("[".concat(n.store.clientId,"] restartICE change iceTransportPolicy from [").concat(h.iceTransportPolicy,"] to [").concat(f,"]")),h.iceTransportPolicy=f,n.peerConnection.setConfiguration(h))}t!==$r.RELAY&&n.remoteSDP.updateCandidates(t);const s=yield Ft(n.peerConnection.createOffer({iceRestart:!0}));if(!s.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const o=Ld(s.sdp),{remoteIceParameters:c}=yield o.iceParameters;n.remoteSDP.restartICE(c);const d=n.remoteSDP.toString();yield Ft(n.peerConnection.setLocalDescription(s)),yield Ft(n.peerConnection.setRemoteDescription({type:"answer",sdp:d}))}catch(i){w.warning("[".concat(n.store.clientId,"] restart ICE failed, abort operation"),i)}finally{r()}}))()}close(){var t;this.peerConnection.close(),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const r=await this.peerConnection.createOffer(),i=this.mungSendOfferSDP(r.sdp,[n]);this.remoteSDP.updateRecvMedia(n._mediaStreamTrack.kind,n);const s=this.remoteSDP.toString();await this.peerConnection.setLocalDescription({type:"offer",sdp:i}),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(r){throw new de(V.EXCHANGE_SDP_FAILED,r.toString())}}async updateSendParameters(t,n){const r=this.peerConnection.getSenders().filter((i=>{var s;return((s=i.track)===null||s===void 0?void 0:s.id)===t}));r.length===1&&await this.applySendEncodings(r,[n])}setStatsRemoteVideoIsReady(t,n){this.statsFilter.setVideoIsReady2(t,n)}async replaceTrack(t,n){const r=this.peerConnection.getSenders().find((i=>{var s;return((s=i.track)===null||s===void 0?void 0:s.id)===n}));r&&await r.replaceTrack(t._mediaStreamTrack)}createDataChannels(t,n){throw new de(V.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}stopDataChannels(t){throw new de(V.NOT_SUPPORTED,"Planb mode does not support stopDataChannels.")}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t;(t=this.onICEConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=t=>{t.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,w.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout((()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,w.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))}),B("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){const n={iceServers:[],sdpSemantics:"plan-b"};return t.iceServers?n.iceServers=t.iceServers:t.turnServer&&t.turnServer.mode!=="off"&&(Xg(t.turnServer.servers)?n.iceServers=t.turnServer.servers:(n.iceServers&&n.iceServers.push(...HE.turnServerConfigToIceServers(t.turnServer.servers)),B("USE_TURN_SERVER_OF_GATEWAY")&&n.iceServers&&t.turnServer.serversFromGateway&&n.iceServers.push(...HE.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach((r=>{r.forceturn&&(n.iceTransportPolicy="relay")})))),n}static turnServerConfigToIceServers(t){const n=[];return t.forEach((r=>{r.security?r.tcpport&&n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turns:".concat(r.turnServerURL,":").concat(r.tcpport,"?transport=tcp")}):(r.udpport&&n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":").concat(r.udpport,"?transport=udp")}),r.tcpport&&n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":").concat(r.tcpport,"?transport=tcp")}))})),n}async updateRtpSenderEncodings(t,n){var r;if(n||(n=this.peerConnection.getSenders().find((h=>{var f;return((f=h.track)===null||f===void 0?void 0:f.id)===t._mediaStreamTrack.id}))),!n)return w.warn("[".concat(t.getTrackId(),"] no rtpSender found}"));if(!Bt().supportSetRtpSenderParameters)return w.warn("Browser not support set rtp-sender parameters");const i={},s={};if(t instanceof Sn)switch(t._optimizationMode){case"motion":i.degradationPreference="maintain-framerate";break;case"detail":i.degradationPreference="maintain-resolution";break;default:i.degradationPreference="balanced"}if(B("DSCP_TYPE")&&vl()){var o;const h=B("DSCP_TYPE");be(o=["very-low","low","medium","high"]).call(o,h)&&(s.networkPriority=h)}const c=n.getParameters(),d=(r=c.encodings)===null||r===void 0?void 0:r[0];d&&Object.assign(d,s),Object.assign(c,i),w.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(c.encodings))),await n.setParameters(c)}async applySendEncodings(t,n){try{if(!Bt().supportSetRtpSenderParameters||t.length!==n.length)return;for(let r=0;r<t.length;r++){const i=t[r],s=n[r];i&&s&&await this.updateRtpSenderEncodings(s,i)}}catch{w.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(t,n){const r=$i(t);return n.forEach(((i,s)=>{const o=i._mediaStreamTrack,c=r.mediaDescriptions.find((d=>d.attributes.mid===o.kind));c&&rm(c,i)})),Nd(r)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var n;(n=this.onFirstAudioReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var n;(n=this.onFirstVideoReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var n;(n=this.onFirstAudioDecoded)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,n,r)=>{var i;(i=this.onFirstVideoDecoded)===null||i===void 0||i.call(this,t,n,r)},this.statsFilter.onSelectedLocalCandidateChanged=(t,n)=>{var r;(r=this.onSelectedLocalCandidateChanged)===null||r===void 0||r.call(this,t,n)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,n)=>{var r;(r=this.onSelectedRemoteCandidateChanged)===null||r===void 0||r.call(this,t,n)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0}async batchReceive(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const n=this.remoteSDP.batchSend(t).map(((s,o)=>{let{id:c,mslabel:d}=s;const{kind:h}=t[o];return new ke(((f,g)=>{const E=setTimeout((()=>{g(new Error("Cannot receive track, id: ".concat(c)))}),1e4),S=O=>{const A=Mt();if(A.name==="Safari"&&Number(A.version)===11&&O.track.id!==c&&O.streams[0].id===d){var N;const j=O.streams[0].getTracks()[0];return(N=this.remoteSDP)===null||N===void 0||N.updateTrackLabel(h,c,O.track.id),this.peerConnection.removeEventListener("track",S),clearTimeout(E),void f({track:j,id:c})}if(O.track.id===c)return this.peerConnection.removeEventListener("track",S),clearTimeout(E),void f({track:O.track,id:c})};this.peerConnection.addEventListener("track",S)}))})),r=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:r});const i=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(i),await ke.all(n)}catch(n){throw new de(V.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(n.toString()))}}async getRemoteSSRC(t){if(!this.remoteSDP)return;const n=this.remoteSDP.getSSRC(t);return n?.[0].ssrcId}setConfiguration(t){if(Bt().supportPCSetConfiguration){const n=HE.resolvePCConfiguration(t);this.peerConnection.setConfiguration(n)}}},Be(pn.prototype,"connect",[ho],Object.getOwnPropertyDescriptor(pn.prototype,"connect"),pn.prototype),Be(pn.prototype,"stopSending",[ho],Object.getOwnPropertyDescriptor(pn.prototype,"stopSending"),pn.prototype),Be(pn.prototype,"receive",[ho],Object.getOwnPropertyDescriptor(pn.prototype,"receive"),pn.prototype),Be(pn.prototype,"stopReceiving",[ho],Object.getOwnPropertyDescriptor(pn.prototype,"stopReceiving"),pn.prototype),Be(pn.prototype,"muteRemote",[ho],Object.getOwnPropertyDescriptor(pn.prototype,"muteRemote"),pn.prototype),Be(pn.prototype,"unmuteRemote",[ho],Object.getOwnPropertyDescriptor(pn.prototype,"unmuteRemote"),pn.prototype),Be(pn.prototype,"muteLocal",[ho],Object.getOwnPropertyDescriptor(pn.prototype,"muteLocal"),pn.prototype),Be(pn.prototype,"unmuteLocal",[ho],Object.getOwnPropertyDescriptor(pn.prototype,"unmuteLocal"),pn.prototype),Be(pn.prototype,"close",[ho],Object.getOwnPropertyDescriptor(pn.prototype,"close"),pn.prototype),Be(pn.prototype,"updateEncoderConfig",[ho],Object.getOwnPropertyDescriptor(pn.prototype,"updateEncoderConfig"),pn.prototype),Be(pn.prototype,"updateSendParameters",[ho],Object.getOwnPropertyDescriptor(pn.prototype,"updateSendParameters"),pn.prototype),Be(pn.prototype,"replaceTrack",[ho],Object.getOwnPropertyDescriptor(pn.prototype,"replaceTrack"),pn.prototype),Be(pn.prototype,"getRemoteSSRC",[ho],Object.getOwnPropertyDescriptor(pn.prototype,"getRemoteSSRC"),pn.prototype),pn);function ho(e,t,n){const r=e[t];if(typeof r!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const i=this.mutex,s=await i.lock("Locking from P2PConnection.".concat(t));try{for(var o=arguments.length,c=new Array(o),d=0;d<o;d++)c[d]=arguments[d];return await r.apply(this,c)}finally{s()}},n}const WX={name:"PlanBConnection",create:function(e){let{store:t,spec:n}=e;return new BX(n,t)}},GX={interceptLocalAudioFrame:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!Bt().supportWebRTCEncodedTransform)return void w.warning("browser not support audio encoded transform");if(sT.has(e)||!e.track)return;const n={track:e.track};if(El()){if(!e.createEncodedStreams)return void w.warning("browser not support createEncodedStreams() API");let i=null;try{i=e.createEncodedStreams()}catch(o){return void w.error("create audio-encoded-streams error",o&&o.message)}const s=new TransformStream({transform(o,c){n.controller||(n.controller=c),e.track&&e.track.id!==n.track.id&&(w.debug("audio track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",r),n.track=e.track,n.track.addEventListener("ended",r));const d=t.metadata&&t.metadata();d?(function(h,f){const{chunk:g,controller:E}=f,S=Od.METADATA;g.data=(function(O,A,N){const j=N.byteLength,U=j+Hb+LM,W=Wb+Gb+U,$=new ArrayBuffer(O.byteLength+W),Z=new DataView($);Z.setUint8(0,xM),Z.setUint16(1,U),Z.setUint8(3,A),Z.setUint16(4,j);for(let ie=0;ie<j;ie++)Z.setUint8(6+ie,N[ie]);const Y=new Uint8Array(Z.buffer);return Y.set(new Uint8Array(O),W),Y.buffer})(g.data,S,h),E.enqueue(g)})(d,{chunk:o,controller:c}):c.enqueue(o)}});i.readable.pipeThrough(s).pipeTo(i.writable)}else if(Br()){if(typeof RTCRtpScriptTransform>"u")return void w.warning("browser not support RTCRtpScriptTransform");const i=iT(),s=new MessageChannel;await new ke((c=>i.onmessage=d=>{d.data==="registered"&&c(void 0)}));const o=new RTCRtpScriptTransform(i,{name:"audio-metadata-tx",port:s.port2},[s.port2]);e.transform=o,await new ke((c=>i.onmessage=d=>{d.data==="started"&&c(void 0)})),s.port1.onmessage=c=>{var d;if(c.data.transformed&&e.track&&((d=e.track)===null||d===void 0?void 0:d.id)!==n.track.id)w.debug("audio track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",r),n.track=e.track,n.track.addEventListener("ended",r);else if(c.data.getMetadata){const h=t.metadata&&t.metadata();h&&s.port1.postMessage({metadata:h})}},n.worker=i}function r(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",r)}const i=sT.get(e);if(i){sT.delete(e);try{var s,o;(s=i.controller)===null||s===void 0||s.terminate(),(o=i.worker)===null||o===void 0||o.terminate()}catch(c){w.warning(c&&c.message)}}}sT.set(e,n),e.track.addEventListener("ended",r)},interceptRemoteAudioFrame:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!Bt().supportWebRTCEncodedTransform)return void w.warning("browser not support audio encoded transform");if(uT.has(e))return;const n={track:e.track,onMetadata:t.onMetadata,onPts:t.onPts};if(El()&&!ii()){if(!e.createEncodedStreams)return void w.warning("browser not support createEncodedStreams() API");$0(Kt.CHROME,87,116)||(t.enableTopn=!1);let i=null;try{i=e.createEncodedStreams()}catch(o){return void w.error("create audio-encoded-streams error",o&&o.message)}const s=new TransformStream({transform(o,c){n.controller||(n.controller=c),e.track&&e.track.id!==n.track.id&&(w.debug("audio track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",r),n.track=e.track,n.track.addEventListener("ended",r)),t.enableTopn?(function(d,h,f){var g;const E=Kb(new DataView(h.data));if(!E)return f.enqueue(h);const S=d.track.id;w9.set(S,d.track);const O=(g=E.tlv.find(($=>$.tag===Od.AUDIO_LEVEL)))===null||g===void 0?void 0:g.value;let A=0;typeof O=="number"&&(A=127-O);const N=Math.round(Math.pow(10,A/60)-1),{selected:j,speaker:U}=(function($,Z){let Y=Jf.get($);if(Y||(Y=(function(ie){const ue=new UM;return Jf.set(ie,ue),Ia||(Ia=new T9(B("TOPN_SILENCE_THRESHOLD")||500),Ia.on("ActiveSpeakerChanged",(ge=>{ge!=null&&(cT=ge)}))),Ia.addSpeakers([ue]),ue})($)),Jf.size<=jM)return{selected:!0,speaker:Y};if(!Ia)throw new Error("no active speaker detector");return Ia.levelChanged(Y.id,Z),Nh=Ia.loudest.map((ie=>ie.id)),cT&&!be(Nh).call(Nh,cT)&&Nh.length>=jM&&Nh.pop(),{selected:be(Nh).call(Nh,Y.id)||Y.id===cT,speaker:Y}})(d,N),W=(function($,Z,Y){const ie=Aa.get($)||new R9($,Z);return ie.score=Y,Aa.set($,ie),(function(ue){if(lT.set(ue,!0),!dT)return void(dT=Date.now());const ge=Date.now();ge-dT>1e3&&(lT.get(ue)?lT.set(ue,!1):(VM(ue),lT.delete(ue)),dT=ge)})($),ie})(S,d.track,U.energyScore);W.addSample(j),W.active&&(h.data=E.frame.buffer,f.enqueue(h))})(e,o,c):t.enableMetadata||t.enablePts?(function(d,h,f,g){const E=new DataView(d.data),S=E.getUint8(0);let O;if((128&S)!=0&&S!==71){const j=(function(U){if(U.byteLength<=0)return[];const W=[];let $=0;for(;$<U.byteLength;){const Y=(128&U.getUint8($))>>7,ie=127&U.getUint8($);if(!(Y&&$+4<=U.byteLength)){$++;break}{const ue=U.getUint32($,!1),ge=(16776192&ue)>>10,Re=1023&ue;W.push({pt:ie,ts_offset:ge,length:Re,data:new Uint8Array}),$+=4}}let Z=U.byteLength-$;for(const Y of W){if(Y.length>Z)return console.warn("Broken red payload"),[];Y.length>0&&(Y.data=new Uint8Array(U.buffer,U.byteOffset+$,Y.length),$+=Y.length,Z-=Y.length)}if(Z>0){const Y={pt:W.length>0?W[W.length-1].pt:0,ts_offset:0,length:Z,data:new Uint8Array(U.buffer,U.byteOffset+$,Z)};W.push(Y)}return W})(E);if(j.length>0){const U=(function(W){let $=0;for(let ie=0;ie<W.length;ie++)$+=ie<W.length-1?4:1,$+=W[ie].length;const Z=new Uint8Array($);let Y=0;for(let ie=0;ie<W.length;ie++)if(ie<W.length-1){const ue=(2147483648|(127&W[ie].pt)<<24|(262143&W[ie].ts_offset)<<10|1023&W[ie].length)>>>0;Z[Y++]=ue>>24&255,Z[Y++]=ue>>16&255,Z[Y++]=ue>>8&255,Z[Y++]=255&ue}else Z[Y++]=127&W[ie].pt;for(const ie of W)Z.set(ie.data,Y),Y+=ie.length;return Z})(j.map((W=>{const $=new Uint8Array(W.length);$.set(W.data);const Z=Kb(new DataView($.buffer));return Z!=null&&Z.frame&&(W.data=Z?.frame),O=Z,W})));d.data=U.buffer}}else O=Kb(E),O&&(d.data=O.frame.buffer);if(h.enqueue(d),!O)return;const A=O.tlv.find((j=>j.tag===Od.METADATA));A&&f&&A.value instanceof Uint8Array&&f(A.value);const N=O.tlv.find((j=>j.tag===Od.AUDIO_64_BIT_PTS));N&&g&&N.value instanceof Uint8Array&&N.value.length==8&&g(new DataView(N.value.buffer).getBigUint64(0,!0))})(o,c,t.onMetadata,t.onPts):c.enqueue(o)}});i.readable.pipeThrough(s).pipeTo(i.writable)}else{if(typeof RTCRtpScriptTransform>"u")return void w.warning("browser not support RTCRtpScriptTransform");const i=iT(),s=new MessageChannel;await new ke((c=>i.onmessage=d=>{d.data==="registered"&&c(void 0)}));const o=new RTCRtpScriptTransform(i,{name:"audio-metadata-rx",port:s.port2},[s.port2]);e.transform=o,await new ke((c=>i.onmessage=d=>{d.data==="started"&&c(void 0)})),s.port1.onmessage=c=>{var d;c.data.transformed&&e.track&&((d=e.track)===null||d===void 0?void 0:d.id)!==n.track.id?(w.debug("audio track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",r),n.track=e.track,n.track.addEventListener("ended",r)):c.data.metadata&&n.onMetadata?n.onMetadata(c.data.metadata):c.data.pts&&n.onPts&&n.onPts(c.data.pts)},n.worker=i}function r(){e.track.removeEventListener("ended",r),(function(i){const s=uT.get(i);if(s){(function(d){const h=Jf.get(d);h&&(Jf.delete(d),Ia&&(Ia.removeSpeakers([h]),Jf.size===0&&(Ia.destroy(),Ia=null)))})(i),VM(i.track.id),uT.delete(i);try{var o,c;(o=s.controller)===null||o===void 0||o.terminate(),(c=s.worker)===null||c===void 0||c.terminate()}catch(d){w.warning(d&&d.message)}}})(e)}uT.set(e,n),e.track.addEventListener("ended",r)},interceptLocalVideoFrame:async function(e,t){if(!Bt().supportWebRTCEncodedTransform)return void w.warning("browser not support video encoded transform");if(hT.has(e)||!e.track)return;const n={track:e.track};if(El()){if(!e.createEncodedStreams)return void w.warning("browser not support createEncodedStreams() API");let i=null;try{i=e.createEncodedStreams()}catch(c){return void w.error("create video-encoded-streams error",c&&c.message)}const s=[];t.on("sei-to-send",(c=>{s.push(c)}));const o=new TransformStream({transform(c,d){n.controller||(n.controller=d),e.track&&e.track.id!==n.track.id&&(w.debug("video track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",r),n.track=e.track,n.track.addEventListener("ended",r));const h=WM(new Uint8Array(c.data)),f=s.shift();if(f){const g=(function(E,S,O){switch(O){case Xb:return(function(A,N){const j=BM(N),U=j.length,W=Math.floor(U/255),$=U%255,Z=new Uint8Array(6+W+1+U+A.byteLength);Z[0]=0,Z[1]=0,Z[2]=0,Z[3]=1,Z[4]=6,Z[5]=101;let Y=0;for(;Y<W;)Z[6+Y]=255,Y++;return Z[6+Y]=$,Y++,Z.set(j,6+Y),Z.set(new Uint8Array(A),6+Y+U),Z.buffer})(E,S);case Jb:return(function(A,N){const j=BM(N),U=j.length,W=Math.floor(U/255),$=U%255,Z=new Uint8Array(7+W+1+U+1+A.byteLength);Z[0]=0,Z[1]=0,Z[2]=0,Z[3]=1,Z[4]=78,Z[5]=1,Z[6]=101;let Y=0;for(;Y<W;)Z[7+Y]=255,Y++;return Z[7+Y]=$,Y++,Z.set(j,7+Y),Y+=U,Z[7+Y]=128,Y++,Z.set(new Uint8Array(A),7+Y),Z.buffer})(E,S);default:return null}})(c.data,f,h);g&&(c.data=g)}d.enqueue(c)}});i.readable.pipeThrough(o).pipeTo(i.writable)}else{if(!Br())return;{if(typeof RTCRtpScriptTransform>"u")return void w.warning("browser not support RTCRtpScriptTransform");const i=iT(),s=new MessageChannel;await new ke((c=>i.onmessage=d=>{d.data==="registered"&&c(void 0)}));const o=new RTCRtpScriptTransform(i,{name:"sei-tx",port:s.port2},[s.port2]);e.transform=o,await new ke((c=>i.onmessage=d=>{d.data==="started"&&c(void 0)})),t.on("sei-to-send",(c=>{s.port1.postMessage({sei:c})})),s.port1.onmessage=c=>{var d;c.data.transformed&&e.track&&((d=e.track)===null||d===void 0?void 0:d.id)!==n.track.id&&(w.debug("video track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",r),n.track=e.track,n.track.addEventListener("ended",r))},n.worker=i}}function r(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",r)}const i=hT.get(e);if(i){hT.delete(e);try{var s,o;(s=i.controller)===null||s===void 0||s.terminate(),(o=i.worker)===null||o===void 0||o.terminate()}catch(c){w.warning(c&&c.message)}}}hT.set(e,n),e.track.addEventListener("ended",r)},interceptRemoteVideoFrame:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!Bt().supportWebRTCEncodedTransform)return void w.warning("browser not support video encoded transform");if(!e.track)return;if(iE.has(e)){const i=iE.get(e);return void(i&&(i.onSei=t.onSei))}const n={track:e.track,onSei:t.onSei};if(El()){if(!e.createEncodedStreams)return void w.warning("browser not support createEncodedStreams() API");let i=null;try{i=e.createEncodedStreams()}catch(o){return void w.error("create video-encoded-streams error",o&&o.message)}const s=new TransformStream({transform(o,c){n.controller||(n.controller=c),e.track&&e.track.id!==n.track.id&&(w.debug("video track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",r),n.track=e.track,n.track.addEventListener("ended",r));const d=(function(h,f){switch(f){case Xb:return(function(g){const E=new DataView(g.data);let S=0;for(;S+4<g.data.byteLength;){if(E.getUint8(S+0)===0&&E.getUint8(S+1)===0&&E.getUint8(S+2)===0&&E.getUint8(S+3)===1&&E.getUint8(S+4)===6){let O=S+6,A=0,N=0;for(;(N=E.getUint8(O++))===255;)A+=255;A+=N;const j=FM(g.data,O,A);return new Uint8Array(j)}S++}return null})(h);case Jb:return(function(g){const E=new DataView(g.data);let S=0;for(;S+5<g.data.byteLength;){if(E.getUint8(S+0)===0&&E.getUint8(S+1)===0&&E.getUint8(S+2)===0&&E.getUint8(S+3)===1&&E.getUint8(S+4)===78&&E.getUint8(S+5)===1&&E.getUint8(S+6)===101){let O=S+7,A=0,N=0;for(;(N=E.getUint8(O++))===255;)A+=255;A+=N;const j=FM(g.data,O,A);return new Uint8Array(j)}S++}return null})(h);default:return null}})(o,WM(new Uint8Array(o.data)));d&&n.onSei&&n.onSei(d),c.enqueue(o)}});i.readable.pipeThrough(s).pipeTo(i.writable)}else if(Br()){if(typeof RTCRtpScriptTransform>"u")return void w.warning("browser not support RTCRtpScriptTransform");const i=iT(),s=new MessageChannel;await new ke((c=>i.onmessage=d=>{d.data==="registered"&&c(void 0)}));const o=new RTCRtpScriptTransform(i,{name:"sei-rx",port:s.port2},[s.port2]);e.transform=o,await new ke((c=>i.onmessage=d=>{d.data==="started"&&c(void 0)})),s.port1.onmessage=c=>{var d;c.data.transformed&&e.track&&((d=e.track)===null||d===void 0?void 0:d.id)!==n.track.id?(w.debug("video track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",r),n.track=e.track,n.track.addEventListener("ended",r)):c.data.sei&&n.onSei&&n.onSei(c.data.sei)},n.worker=i}function r(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",r)}(function(i){const s=iE.get(i);if(s){iE.delete(i);try{var o,c;(o=s.controller)===null||o===void 0||o.terminate(),(c=s.worker)===null||c===void 0||c.terminate()}catch(d){w.warning(d&&d.message)}}})(e)}iE.set(e,n),e.track.addEventListener("ended",r)}},HX={name:"InterceptFrame",create:()=>GX};yb(),sn("PROCESS_ID","process-".concat(hn(8,""),"-").concat(hn(4,""),"-").concat(hn(4,""),"-").concat(hn(4,""),"-").concat(hn(12,""))),(function(){let e;try{e=window.localStorage.getItem("websdk_ng_global_parameter")}catch(t){return void w.error("Error loading sdk config",t.message)}if(e)try{const t=JSON.parse(window.atob(e)),n=Date.now();w.debug("Loading global parameters from cache",t),Object.keys(t).forEach((r=>{if(Object.prototype.hasOwnProperty.call(bn,r)){const{value:i,expires:s}=t[r];if(s&&s<=n)return;ba[r]=i,bn[r]=i}}))}catch(t){w.error("Error loading mutableParamsCache: ".concat(e),t.message)}})(),Array.isArray(ba.AREAS)&&ba.AREAS.length>0&&mI(ba.AREAS,!0);const FV=(e,t,n)=>{w.debug("setParameter key:".concat(e,", value:").concat(JSON.stringify(t))),sn(e,t,n)};jd(pX,!1),jd(_X,!1),jd(X7,!1),jd(IX,!1),jd(dX,!1),jd(VX,!1),jd(WX,!1),jd(HX,!1);const ir=(function(e){const t=new xn,n=e,r={getListeners:t.getListeners.bind(t),on:(i,s)=>((function(o,c){o===Nc.SECURITY_POLICY_VIOLATION&&yj(c,!0)})(i,s),t.on.bind(t)(i,s)),addListener:t.addListener.bind(t),once:t.once.bind(t),off:t.off.bind(t),removeAllListeners:t.removeAllListeners.bind(t),emit:t.emit.bind(t),safeEmit:t.safeEmit.bind(t)};return vj(vj({},n),r)})({__TRACK_LIST__:Bf,VERSION:ro,BUILD:Rb,ESM_BUNDLER:!1,ESM:!1,UMD:!0,DEV:!1,setParameter:FV,getParameter:B,getSupportedCodec:async function(){let e={audio:[],video:[]};try{let t=new RTCPeerConnection;const n=await(async function(r){let i;return Bt().supportUnifiedPlan?(r.addTransceiver("video",{direction:"recvonly"}),r.addTransceiver("audio",{direction:"recvonly"}),i=(await r.createOffer()).sdp):i=(await r.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0})).sdp,i})(t);if(!n)return e;t.close(),t=null,e=(function(r){const i={video:[],audio:[]};return r.match(/ VP8/i)&&i.video.push("VP8"),r.match(/ VP9/i)&&i.video.push("VP9"),r.match(/ AV1/i)&&i.video.push("AV1"),r.match(/ H264/i)&&i.video.push("H264"),r.match(/ H265/i)&&i.video.push("H265"),r.match(/ opus/i)&&i.audio.push("OPUS"),r.match(/ PCMU/i)&&i.audio.push("PCMU"),r.match(/ PCMA/i)&&i.audio.push("PCMA"),r.match(/ G722/i)&&i.audio.push("G722"),i})(n)}catch(t){throw new le(V.CREATE_OFFER_FAILED,t.toString&&t.toString()).print()}return e},checkSystemRequirements:function(){const e=We.reportApiInvoke(null,{name:Gn.CHECK_SYSTEM_REQUIREMENTS,options:[],tag:Nn.TRACER});let t=!1;try{const s=window.RTCPeerConnection,o=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,c=window.WebSocket;t=!!(s&&o&&c),t&&sb()&&Fx(75)&&new s().close()}catch(s){return w.error("check system requirement failed: ",s),!1}let n=!1;const r=Mt();r.name===Kt.CHROME&&Number(r.version)>=58&&(Ra.engine.name!=="WebKit"||(function(){const s=Mt();if(BS()){if(s.os===Er.MAC_OS)return!0;if(s.os===Er.IOS){const o=Ra.os.version&&Ra.os.version.split(".");if(o&&Number(o[0])===14&&o[1]&&Number(o[1])>=3||o&&Number(o[0])>14)return!0}}return!1})())&&(n=!0),(r.name===Kt.FIREFOX&&Number(r.version)>=56||r.name===Kt.OPERA&&Number(r.version)>=45||r.name===Kt.SAFARI&&Number(r.version)>=11||r.name==="WebKit"&&(ii()||Vo())&&r.osVersion&&Number(r.osVersion.split(".")[0])>=11||zx()||Mt().name===Kt.QQ)&&(n=!0),w.debug("checkSystemRequirements, api:",t,"browser",n);const i=t&&n;return e.onSuccess(i),i},getDevices:function(e){return xs.enumerateDevices(!0,!0,e)},getMicrophones:function(e){return xs.getRecordingDevices(e)},getCameras:function(e){return xs.getCamerasDevices(e)},getElectronScreenSources:F1,getPlaybackDevices:function(e){return xs.getSpeakers(e)},createClient:function(){var e;let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{codec:"vp8",audioCodec:"opus",mode:"rtc"};const n=hn(5,"client-"),r=We.reportApiInvoke(null,{id:n,name:Gn.CREATE_CLIENT,options:[t],tag:Nn.TRACER});try{(function(i){pr(i.codec,"config.codec",["vp8","vp9","av1","h264","h265"]),pr(i.mode,"config.mode",["rtc","live","p2p"]),i.audioCodec!==void 0&&pr(i.audioCodec,"config.audioCodec",["opus","pcmu","pcma","g722"]),i.proxyServer!==void 0&&kr(i.proxyServer,"config.proxyServer",1,1e4),i.turnServer!==void 0&&e1(i.turnServer),i.httpRetryConfig!==void 0&&$x(i.httpRetryConfig),i.websocketRetryConfig!==void 0&&$x(i.websocketRetryConfig)})(t)}catch(i){throw r.onError(i),i}return(Gx(16,0)||nb(16,0,!0))&&(t.codec==="vp9"&&(t.codec="vp8",w.debug("browser not support vp9, force use vp8")),sn("UNSUPPORTED_VIDEO_CODEC",["vp9"])),t.audioCodec===void 0&&(t.audioCodec="opus"),r.onSuccess(),new J7(qo(qo({forceWaitGatewayResponse:!0},t),{},{role:be(e=["rtc","p2p"]).call(e,t.mode)?"host":t.role||"audience"}),n)},createCameraVideoTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=B("CAMERA_CAPTURE_CONFIG"),n=hn(8,"track-cam-"),r=We.reportApiInvoke(null,{id:n,tag:Nn.TRACER,name:Gn.CREATE_CAM_VIDEO_TRACK,options:[En({},e),t]});t&&(e.encoderConfig=t);const i=nT(e);let s=null;w.info("start create camera video track with config",JSON.stringify(e),"trackId",n);try{s=(await ks({video:i},n)).getVideoTracks()[0]||null}catch(c){throw r.onError(c),c}if(!s){const c=new de(V.UNEXPECTED_ERROR,"can not find track in media stream");return r.onError(c),c.throw(w)}if(e.optimizationMode&&Bb(n,s,e,Wo(e.encoderConfig)),B("USE_STANDARD_BITRATE_DEFAULT")){const c=Wo(e.encoderConfig);e.encoderConfig=c,delete c.bitrateMax,delete c.bitrateMin}const o=new rT(s,e,i,e.scalabiltyMode?ZS(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,n);return r.onSuccess(o.getTrackId()),w.info("create camera video success, trackId:",n),o},createCustomVideoTrack:function(e){const t=hn(8,"track-cus-"),n=We.reportApiInvoke(null,{id:t,tag:Nn.TRACER,name:Gn.CREATE_CUSTOM_VIDEO_TRACK,options:[e]});B("USE_STANDARD_BITRATE_DEFAULT")&&(delete e.bitrateMax,delete e.bitrateMin);const r=new Sn(e.mediaStreamTrack,{width:e.width,height:e.height,frameRate:e.frameRate,bitrateMax:e.bitrateMax,bitrateMin:e.bitrateMin},e.scalabiltyMode?ZS(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,t,[ln.CUSTOM_TRACK]);return n.onSuccess(r.getTrackId()),w.info("create custom video track success with config",e,"trackId",r.getTrackId()),r},createScreenVideoTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"disable";const n=typeof t=="object"?(function(E){return J1(E)})(t):void 0;n&&(t="auto");const r=hn(8,"track-scr-v-"),i=We.reportApiInvoke(null,{id:r,tag:Nn.TRACER,name:Gn.CREATE_SCREEN_VIDEO_TRACK,options:[En({},e),t]});e.encoderConfig?typeof e.encoderConfig=="string"||e.encoderConfig.width&&e.encoderConfig.height||(e.encoderConfig.width={max:1920},e.encoderConfig.height={max:1080}):e.encoderConfig="1080p_2";const s=(function(E){const S={};E.screenSourceType&&(S.mediaSource=E.screenSourceType),E.extensionId&&El()&&(S.extensionId=E.extensionId);const{displaySurface:O,selfBrowserSurface:A,surfaceSwitching:N,systemAudio:j,preferCurrentTab:U}=E;(Df(107)||eb(107)||rb(93))&&(O&&(pr(O,"displaySurface",["browser","window","monitor"]),S.displaySurface=O),A?(pr(A,"selfBrowserSurface",["exclude","include"]),S.selfBrowserSurface=A):S.selfBrowserSurface="include",N&&(pr(N,"surfaceSwitching",["exclude","include"]),S.surfaceSwitching=N)),(Df(105)||eb(105)||rb(91))&&j&&(pr(j,"systemAudio",["exclude","include"]),S.systemAudio=j),(Df(94)||eb(94)||rb(80))&&U&&(S.preferCurrentTab=!0),E.electronScreenSourceId&&(S.sourceId=E.electronScreenSourceId);const W=E.encoderConfig?Nb(E.encoderConfig):null;return S.mandatory={chromeMediaSource:"desktop",maxWidth:W?W.width:void 0,maxHeight:W?W.height:void 0},W&&(W.frameRate&&(typeof W.frameRate=="number"?(S.mandatory.maxFrameRate=W.frameRate,S.mandatory.minFrameRate=W.frameRate):(S.mandatory.maxFrameRate=W.frameRate.max||W.frameRate.ideal||W.frameRate.exact||void 0,S.mandatory.minFrameRate=W.frameRate.min||W.frameRate.ideal||W.frameRate.exact||void 0),S.frameRate=W.frameRate),W.width&&(S.width=W.width),W.height&&(S.height=W.height)),S})(e);let o=null,c=null;const d=Bt();if(!d.supportShareAudio&&t==="enable"){const E=new de(V.NOT_SUPPORTED,"your browser or platform is not support share-screen with audio");return i.onError(E),E.throw(w)}w.info("start create screen video track with config",e,"withAudio",t,"trackId",r);const h=d.supportShareAudio&&t!=="disable";try{const E=await ks({screen:s,screenAudio:h?n||!0:void 0},r);o=E.getVideoTracks()[0]||null,c=E.getAudioTracks()[0]||null}catch(E){throw i.onError(E),E}if(!o){const E=new de(V.UNEXPECTED_ERROR,"can not find track in media stream");return i.onError(E),E.throw(w)}if(!c&&t==="enable"){o&&o.stop();const E=new de(V.SHARE_AUDIO_NOT_ALLOWED);return i.onError(E),E.throw(w)}e.optimizationMode||(e.optimizationMode="detail"),e.optimizationMode&&(Bb(r,o,e,e.encoderConfig&&Nb(e.encoderConfig)||void 0),e.encoderConfig&&typeof e.encoderConfig!="string"&&(e.encoderConfig.bitrateMin=e.encoderConfig.bitrateMax));const f=new Sn(o,e.encoderConfig?Nb(e.encoderConfig):{},e.scalabiltyMode?ZS(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,r,[ln.SCREEN_TRACK]);if(!c)return i.onSuccess(f.getTrackId()),w.info("create screen video track success","video:",f.getTrackId()),f;const g=new Wn(c,void 0,hn(8,"track-scr-a-"),!1);return i.onSuccess([f.getTrackId(),g.getTrackId()]),w.info("create screen video track success","video:",f.getTrackId(),"audio:",g.getTrackId()),[f,g]},createMicrophoneAndCameraTracks:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=B("CAMERA_CAPTURE_CONFIG"),r=hn(8,"track-mic-"),i=hn(8,"track-cam-"),s=We.reportApiInvoke(null,{id:"".concat(r,"-").concat(i),tag:Nn.TRACER,name:Gn.CREATE_MIC_AND_CAM_TRACKS,options:[e,t,n]});n&&(t.encoderConfig=n);const o=nT(t),c=Q1(e);let d=null,h=null;w.info("start create camera video track(".concat(i,") and microphone audio track(").concat(r,") with config, audio: ").concat(JSON.stringify(e),", video: ").concat(JSON.stringify(t)));try{const E=await ks({audio:c,video:o},"".concat(r,"-").concat(i));d=E.getAudioTracks()[0],h=E.getVideoTracks()[0]}catch(E){throw s.onError(E),E}if(!d||!h){const E=new de(V.UNEXPECTED_ERROR,"can not find tracks in media stream");return s.onError(E),E.throw(w)}if(t.optimizationMode&&Bb(i,h,t,Wo(t.encoderConfig)),B("USE_STANDARD_BITRATE_DEFAULT")){const E=Wo(t.encoderConfig);t.encoderConfig=E,delete E.bitrateMax,delete E.bitrateMin}const f=new rE(d,e,c,r),g=new rT(h,t,o,t.scalabiltyMode?ZS(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,i);return s.onSuccess([f.getTrackId(),g.getTrackId()]),w.info("create camera video track(".concat(i,") and microphone audio track(").concat(r,") success")),[f,g]},createMicrophoneAudioTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=hn(8,"track-mic-"),n=We.reportApiInvoke(null,{id:t,tag:Nn.TRACER,name:Gn.CREATE_MIC_AUDIO_TRACK,options:[e]}),r=Q1(e);let i=null;w.info("start create microphone audio track with config",JSON.stringify(e),"trackId",t);try{i=(await ks({audio:r},t)).getAudioTracks()[0]||null}catch(o){throw n.onError(o),o}if(!i){const o=new de(V.UNEXPECTED_ERROR,"can not find track in media stream");return n.onError(o),o.throw(w)}const s=new rE(i,e,r,t);return n.onSuccess(s.getTrackId()),w.info("create microphone audio track success, trackId:",t),s},createCustomAudioTrack:function(e){const t=hn(8,"track-cus-"),n=We.reportApiInvoke(null,{id:t,tag:Nn.TRACER,name:Gn.CREATE_CUSTOM_AUDIO_TRACK,options:[e]}),r=new Wn(e.mediaStreamTrack,e.encoderConfig?$S(e.encoderConfig):{},t,!1);return w.info("create custom audio track success with config",e,"trackId",r.getTrackId()),n.onSuccess(r.getTrackId()),r},createBufferSourceAudioTrack:async function(e){var t;const{cacheOnlineFile:n,encoderConfig:r}=e;let{source:i}=e;const s={source:i instanceof AudioBuffer?"AudioBuffer":i instanceof File?(t=File.name)!==null&&t!==void 0?t:"File":i,cacheOnlineFile:n,encoderConfig:r},o=hn(8,"track-buf-"),c=We.reportApiInvoke(null,{id:o,tag:Nn.TRACER,name:Gn.CREATE_BUFFER_AUDIO_TRACK,options:[s]});if(B("DISABLE_WEBAUDIO"))throw new de(V.NOT_SUPPORTED,"can not create BufferSourceAudioTrack when WebAudio disabled");w.info("start create buffer source audio track with config",JSON.stringify(s),"trackId",o);const d=i;if(!(i instanceof AudioBuffer))try{i=await(async function(g,E){let S=null;if(typeof g=="string"){const A=UL.get(g);if(A)return w.debug("use cached audio resource: ",g),A;try{S=(await Ca((()=>ji.get(g,{responseType:"arraybuffer"})),void 0,void 0,{maxRetryCount:3})).data}catch(N){throw new de(V.FETCH_AUDIO_FILE_FAILED,N.toString())}}else S=await new ke(((N,j)=>{const U=new FileReader;U.onload=W=>{W.target?N(W.target.result):j(new de(V.READ_LOCAL_AUDIO_FILE_ERROR))},U.onerror=()=>{j(new de(V.READ_LOCAL_AUDIO_FILE_ERROR))},U.readAsArrayBuffer(g)}));const O=await(function(A){const N=zf();return new ke(((j,U)=>{N.decodeAudioData(A,(W=>{j(W)}),(W=>{U(new de(V.DECODE_AUDIO_FILE_FAILED,W.toString()))}))}))})(S);return typeof g=="string"&&E&&UL.set(g,O),O})(i,n)}catch(g){return c.onError(g),g.throw(w)}const h=new g9(i),f=new _9(d,h,r?$S(r):{},o);return w.info("create buffer source audio track success, trackId:",o),c.onSuccess(f.getTrackId()),f},setAppType:function(e){if(w.debug("setAppType: ".concat(e)),!(Number.isInteger(e)&&e>=0))throw w.debug("Invalid appType"),new le(V.INVALID_PARAMS,"invalid app type",e);sn("APP_TYPE",Math.floor(e))},setLogLevel:function(e){w.setLogLevel(e)},enableLogUpload:function(){B("USE_NEW_LOG")?sn("UPLOAD_LOG",!0):w.enableLogUpload()},disableLogUpload:function(){B("USE_NEW_LOG")?sn("UPLOAD_LOG",!1):w.disableLogUpload()},createChannelMediaRelayConfiguration:function(){return new F2},checkAudioTrackIsActive:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const n=We.reportApiInvoke(null,{tag:Nn.TRACER,name:Gn.CHECK_AUDIO_TRACK_IS_ACTIVE,options:[t]});if(!(e instanceof Wn||e instanceof Xf)){const d=new le(V.INVALID_TRACK,"the parameter is not a audio track");return n.onError(d),d.throw()}t&&t<1e3&&(t=1e3);const r=e instanceof Wn?e.getTrackLabel():"remote_track",i=e.getVolumeLevel();let s=i,o=i;const c=Date.now();return new ke((d=>{const h=setInterval((()=>{const f=e.getVolumeLevel();s=f>s?f:s,o=f<o?f:o;const g=s-o>1e-4,E=Date.now()-c;if(g||E>t){clearInterval(h);const S=g,O={duration:E,deviceLabel:r,maxVolumeLevel:s,result:S};w.info("[track-".concat(e.getTrackId(),"] check audio track active completed. ").concat(JSON.stringify(O))),n.onSuccess(O),d(S)}}),200)}))},checkVideoTrackIsActive:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const n=We.reportApiInvoke(null,{tag:Nn.TRACER,name:Gn.CHECK_VIDEO_TRACK_IS_ACTIVE,options:[t]});if(!(e instanceof Sn||e instanceof qf)){const g=new le(V.INVALID_TRACK,"the parameter is not a video track");return n.onError(g),g.throw()}t&&t<1e3&&(t=1e3);const r=e instanceof Sn?e.getTrackLabel():"remote_track",i=e.getMediaStreamTrack(!0),s=document.createElement("video");s.style.width="1px",s.style.height="1px",s.setAttribute("muted",""),s.muted=!0,s.setAttribute("playsinline",""),s.controls=!1,(Br()||BS())&&(s.style.opacity="0.01",s.style.position="fixed",s.style.left="0",s.style.top="0",document.body.appendChild(s)),s.srcObject=new MediaStream([i]),s.play();const o=document.createElement("canvas");o.width=160,o.height=120;let c=0,d=0;try{const g=Date.now();c=await(function(E,S,O,A){let N,j=0,U=null;return new ke(((W,$)=>{function Z(){j>A&&N&&(N(),W(j));const Y=O.getContext("2d");if(!Y){const ge=new le(V.UNEXPECTED_ERROR,"can not get canvas 2d context.");return w.error(ge.toString()),void $(ge)}Y.drawImage(E,0,0,160,120);const ie=Y.getImageData(0,0,O.width,O.height),ue=Math.floor(ie.data.length/3);if(U){for(let ge=0;ge<ue;ge+=3)if(ie.data[ge]!==U[ge])return j+=1,void(U=ie.data);U=ie.data}else U=ie.data}setTimeout((()=>{N&&(N(),W(j))}),S),N=xb((()=>{Z()}),30)}))})(s,t,o,4),d=Date.now()-g}catch(g){throw n.onError(g),g}M7===Kt.SAFARI&&(s.pause(),s.remove()),s.srcObject=null;const h=c>4,f={duration:d,changedPicNum:c,deviceLabel:r,result:h};return w.info("[track-".concat(e.getTrackId(),"] check video track active completed. ").concat(JSON.stringify(f))),n.onSuccess(f),h},setArea:mI,audioElementPlayCenter:Vi,resumeAudioContext:function(){Vi.autoResumeAfterInterruption(!0)},processExternalMediaAEC:function(e){Z7.processExternalMediaAEC(e)},registerExtensions:function(e){const t=B("PLUGIN_INFO")||[];e.forEach((n=>{"name"in n&&!be(t).call(t,n.name)&&t.push(n.name);const r=n;r.__registered__=!0,r.logger.hookLog=w.extLog,r.reporter.hookApiInvoke=We.extApiInvoke,r.parameters&&Object.keys(r.parameters).forEach((i=>{r.parameters[i]=B(i)}))})),FV("PLUGIN_INFO",t)},ChannelMediaRelayError:Zf,ChannelMediaRelayEvent:Tl,ChannelMediaRelayState:ts,RemoteStreamFallbackType:l9,RemoteStreamType:c9,ConnectionDisconnectedReason:$t,AudienceLatencyLevelType:VY,AREAS:Jt,preload:async function(e,t,n,r){return dU(e,t,n,r)}});return Object.defineProperties(ir,{onAudioAutoplayFailed:{get:()=>Ls.onAudioAutoplayFailed,set:e=>{Ls.onAudioAutoplayFailed=e}},onAutoplayFailed:{get:()=>Ls.onAutoplayFailed,set:e=>{Ls.onAutoplayFailed=e}},_onSecurityPolicyViolation:{value:void 0,writable:!0},_cspEventHandlerPointer:{value:void 0,writable:!0},onSecurityPolicyViolation:{get:()=>ir._onSecurityPolicyViolation,set(e){ir._onSecurityPolicyViolation=e,yj(e)}},__CLIENT_LIST__:{get:()=>B("SHOW_GLOBAL_CLIENT_LIST")?Oh:[]}}),xs.on(bh.CAMERA_DEVICE_CHANGED,(e=>{w.info("camera device changed",JSON.stringify(e)),ir.onCameraChanged&&ir.onCameraChanged(e),ir.safeEmit(Nc.CAMERA_CHANGED,e)})),xs.on(bh.RECORDING_DEVICE_CHANGED,(e=>{w.info("microphone device changed",JSON.stringify(e)),ir.onMicrophoneChanged&&ir.onMicrophoneChanged(e),ir.safeEmit(Nc.MICROPHONE_CHANGED,e)})),xs.on(bh.PLAYOUT_DEVICE_CHANGED,(e=>{w.debug("playout device changed",JSON.stringify(e)),ir.onPlaybackDeviceChanged&&ir.onPlaybackDeviceChanged(e),ir.safeEmit(Nc.PLAYBACK_DEVICE_CHANGED,e)})),Vi.onAutoplayFailed=()=>{w.info("detect audio element autoplay failed"),Ls.onAudioAutoplayFailed&&Ls.onAudioAutoplayFailed()},on.on("autoplay-failed",(()=>{w.info("detect webaudio autoplay failed"),Ls.onAudioAutoplayFailed&&Ls.onAudioAutoplayFailed(),ir.safeEmit(Nc.AUTOPLAY_FAILED)})),on.on(Mr.STATE_CHANGE,((e,t)=>{w.info("audio context state changed: ".concat(t," => ").concat(e)),ir.onAudioContextStateChanged&&ir.onAudioContextStateChanged(e,t),ir.safeEmit(Nc.AUDIO_CONTEXT_STATE_CHANGED,e,t)})),Qn.on(xf.NETWORK_STATE_CHANGE,((e,t)=>{w.info("[network-indicator] network state changed, ".concat(t," => ").concat(e))})),window&&(window.__ARTC__=ir),ir}))})(NR)),NR.exports}var Bie=Fie();const TR=cN(Bie);function Wie(){const l=L.useRef(null),p=L.useRef(null),m=L.useRef(null),y=L.useRef(null),[R,C]=L.useState([]),[P,k]=L.useState(""),[M,F]=L.useState(""),[H,K]=L.useState(""),[ee,X]=L.useState(""),[re,G]=L.useState(!1),[J,te]=L.useState(!1),[ne,se]=L.useState(!1),{toast:ae}=Gc(),pe=L.useMemo(()=>(l.current||(l.current=TR.createClient({mode:"rtc",codec:"vp8"})),l.current),[]);L.useEffect(()=>{const Ue=pe,tt=async(pt,Fe)=>{await Ue.subscribe(pt,Fe),Fe==="audio"&&pt.audioTrack&&pt.audioTrack.play(),C(Array.from(Ue.remoteUsers))},gt=()=>{C(Array.from(Ue.remoteUsers))},ht=()=>C(Array.from(Ue.remoteUsers)),Ge=()=>C(Array.from(Ue.remoteUsers));return Ue.on("user-published",tt),Ue.on("user-unpublished",gt),Ue.on("user-joined",ht),Ue.on("user-left",Ge),()=>{Ue.off("user-published",tt),Ue.off("user-unpublished",gt),Ue.off("user-joined",ht),Ue.off("user-left",Ge)}},[pe]);const Se=async({appId:Ue,channel:tt,token:gt,uid:ht})=>{if(!Ue||!tt){ae({title:"Missing fields",description:"Please enter App ID and Channel",variant:"destructive"});return}const Ge=pe;try{se(!0),TR.setLogLevel(2);let pt=gt?.trim()||"",Fe=ht&&ht!==""?ht:null;if(!pt)try{const wt=await hne({channel:tt.trim(),uid:Fe??0,role:"publisher",expireSeconds:3600});pt=wt.token,Fe=wt.uid}catch(wt){throw console.error("Failed to fetch token:",wt),new Error("Could not fetch token from server. Ensure server .env has AGORA_APP_ID and AGORA_APP_CERTIFICATE.")}await Ge.join(Ue.trim(),tt.trim(),pt||null,Fe),p.current=await TR.createMicrophoneAudioTrack(),m.current=await TR.createCameraVideoTrack(),te(!0),await Ge.publish([p.current,m.current]),te(!1),y.current&&m.current&&m.current.play(y.current),G(!0),ae({title:"Joined",description:`Channel "${tt}" joined successfully.`})}catch(pt){try{p.current&&(p.current.stop(),p.current.close(),p.current=null),m.current&&(m.current.stop(),m.current.close(),m.current=null)}catch(wt){console.error("Error during cleanup after join failure:",wt)}console.error("Failed to join/publish:",pt);const Fe=pt instanceof Error?pt.message:"Unknown error";ae({title:"Join failed",description:Fe,variant:"destructive"})}finally{se(!1),te(!1)}},Te=async()=>{const Ue=pe;try{p.current&&(p.current.stop(),p.current.close()),m.current&&(m.current.stop(),m.current.close()),p.current=null,m.current=null,C([]),Ue.connectionState!=="DISCONNECTED"&&await Ue.leave()}finally{G(!1)}};return v.jsx("div",{className:"container mx-auto pt-24 pb-8",children:v.jsxs(An,{children:[v.jsx(Ir,{children:v.jsx(Pi,{children:"Video Call"})}),v.jsxs(Dn,{children:[v.jsxs("div",{className:"grid gap-4 md:grid-cols-4",children:[v.jsx(ea,{placeholder:"App ID",value:P,onChange:Ue=>k(Ue.target.value)}),v.jsx(ea,{placeholder:"Channel",value:M,onChange:Ue=>F(Ue.target.value)}),v.jsx(ea,{placeholder:"Token (optional)",value:H,onChange:Ue=>K(Ue.target.value)}),v.jsx(ea,{placeholder:"UID (optional)",value:ee,onChange:Ue=>X(Ue.target.value)})]}),v.jsx("div",{className:"mt-4 flex gap-3",children:re?v.jsx(At,{variant:"destructive",onClick:Te,disabled:J,children:"Leave"}):v.jsx(At,{onClick:()=>Se({appId:P,channel:M,token:H||null,uid:ee||null}),disabled:!P||!M||ne,children:ne?"Joining...":"Join & Publish"})}),v.jsxs("div",{className:"mt-6 grid gap-4 md:grid-cols-2",children:[v.jsx("div",{className:"w-full aspect-video bg-muted rounded relative overflow-hidden",children:v.jsx("div",{ref:y,className:"w-full h-full"})}),v.jsxs("div",{className:"grid gap-4",children:[R.length===0&&v.jsx("div",{className:"p-4 text-sm text-muted-foreground border rounded",children:"No remote users yet. Share the channel name with others to join."}),R.map(Ue=>v.jsx("div",{className:"w-full aspect-video bg-muted rounded overflow-hidden",children:v.jsx("div",{id:`remote-player-${Ue.uid}`,className:"w-full h-full",ref:tt=>{tt&&Ue.videoTrack&&Ue.videoTrack.play(tt)}})},Ue.uid))]})]})]})]})})}function zh({children:l}){const[p,m]=L.useState(!0),[y,R]=L.useState(!1),C=Lm(),P=rp();return L.useEffect(()=>{(()=>{try{const M=localStorage.getItem("user");if(M){const F=JSON.parse(M);F&&F.id?(console.log("🔵 [AUTH] User authenticated:",F.name||F.alias),R(!0)):(console.log("🔴 [AUTH] Invalid user data, redirecting to login"),localStorage.removeItem("user"),localStorage.setItem("redirectAfterLogin",P.pathname),C("/auth"))}else console.log("🔴 [AUTH] No user data found, redirecting to login"),localStorage.setItem("redirectAfterLogin",P.pathname),C("/auth")}catch(M){console.error("🔴 [AUTH] Error checking authentication:",M),localStorage.removeItem("user"),localStorage.setItem("redirectAfterLogin",P.pathname),C("/auth")}finally{m(!1)}})()},[C,P.pathname]),p?v.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:v.jsxs("div",{className:"text-center",children:[v.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto mb-4"}),v.jsx("p",{className:"text-sm text-muted-foreground",children:"Checking authentication..."})]})}):y?v.jsx(v.Fragment,{children:l}):null}class Gie extends L.Component{state={hasError:!1};static getDerivedStateFromError(p){return{hasError:!0,error:p}}componentDidCatch(p,m){console.error("Uncaught error:",p,m)}render(){return this.state.hasError?v.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:v.jsxs("div",{className:"text-center space-y-4",children:[v.jsx("h1",{className:"text-2xl font-bold text-destructive",children:"Something went wrong"}),v.jsx("p",{className:"text-muted-foreground",children:"The application encountered an error. Please refresh the page."}),v.jsx("button",{onClick:()=>window.location.reload(),className:"px-4 py-2 bg-primary text-primary-foreground rounded-md hover:bg-primary/90",children:"Refresh Page"})]})}):this.props.children}}const Hie=new Bee,Kie=()=>v.jsx(Gie,{children:v.jsx(Gee,{client:Hie,children:v.jsx(zte,{attribute:"class",defaultTheme:"system",enableSystem:!0,disableTransitionOnChange:!0,children:v.jsxs(gee,{children:[v.jsx(XQ,{}),v.jsx(DZ,{}),v.jsx(Wte,{basename:"/",children:v.jsxs(Lte,{children:[v.jsx($o,{path:"/",element:v.jsx(qte,{})}),v.jsx($o,{path:"/auth",element:v.jsx(Cne,{})}),v.jsx($o,{path:"/feed",element:v.jsx(zh,{children:v.jsx(Une,{})})}),v.jsx($o,{path:"/create",element:v.jsx(zh,{children:v.jsx(Vne,{})})}),v.jsx($o,{path:"/rooms",element:v.jsx(zh,{children:v.jsx(Jre,{})})}),v.jsx($o,{path:"/rooms/:roomId",element:v.jsx(zh,{children:v.jsx(Qre,{})})}),v.jsx($o,{path:"/profile",element:v.jsx(zh,{children:v.jsx(Zre,{})})}),v.jsx($o,{path:"/settings",element:v.jsx(zh,{children:v.jsx(Mie,{})})}),v.jsx($o,{path:"/about",element:v.jsx(Uie,{})}),v.jsx($o,{path:"/video-call",element:v.jsx(zh,{children:v.jsx(Wie,{})})}),v.jsx($o,{path:"*",element:v.jsx(jie,{})})]})})]})})})}),pW=document.getElementById("root");if(!pW)throw new Error("Root element not found");setTimeout(()=>{$X.createRoot(pW).render(v.jsx(Kie,{}))},0);
